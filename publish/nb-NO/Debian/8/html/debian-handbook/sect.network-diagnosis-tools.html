<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">10.8. Diagnoseverktøy for nettverk</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-nb-NO-1.0-1" /><meta
        name="keywords"
        content="Nettverk, Innfallsport (gateway), TCP/IP, IPv6, DNS, Bind, DHCP, QoS" /><link
        rel="home"
        href="index.html"
        title="Debian-administratorens håndbok" /><link
        rel="up"
        href="network-infrastructure.html"
        title="Kapittel 10. Nettverksinfrastruktur" /><link
        rel="prev"
        href="sect.dhcp.html"
        title="10.7. DHCP" /><link
        rel="next"
        href="network-services.html"
        title="Kapittel 11. Network Services: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/nb-NO/stable/sect.network-diagnosis-tools.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.dhcp.html"><strong>Forrige</strong></a></li><li
          class="home">Debian-administratorens håndbok</li><li
          class="next"><a
            accesskey="n"
            href="network-services.html"><strong>Neste</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.network-diagnosis-tools"></a>10.8. Diagnoseverktøy for nettverk</h2></div></div></div><div
          class="para">
			Når et nettverksprogram ikke kjører som forventet, er det viktig å kunne se under panseret. Selv når alt ser ut til å kjøre greit, kan det å kjører en nettverkdiagnose bidra til å sikre at alt fungerer som det skal. Det finnes flere diagnoseverktøy for dette formålet; hvert opererer på et ulikt nivå.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.netstat"></a>10.8.1. Lokale diagnoser: <code
                    class="command">netstat</code></h3></div></div></div><a
            id="id-1.13.11.3.2"
            class="indexterm"></a><div
            class="para">
				La oss først nevne <code
              class="command">netstat</code> kommandoen (i <span
              class="pkg pkg">net-tools</span>-pakken); Den viser en umiddelbar oppsummering av maskinens nettverksaktivitet. Når det blir kjørt uten argument, lister denne kommandoen opp alle åpne tilkoblinger; Denne listen kan være svært detaljert, siden det inneholder mange Unix-domene socketer (mye brukt av nisser) som ikke involverer nettverket i det hele tatt (for eksempel <code
              class="literal">dbus</code> kommunikasjon, <code
              class="literal">X11</code>-trafikk, og kommunikasjon mellom virtuelle filsystemer og skrivebordet).
			</div><div
            class="para">
				Vanlige oppkallinger bruker derfor alternativer som endrer hvordan <code
              class="command">netstat</code> virker. De vanligst brukte valgene omfatter:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">-t</code>, som filtrerer resultatene til å bare inkludere TCP-forbindelser;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">-u</code>, som fungerer på samme måte for UDP-tilkoblinger; disse alternativene er ikke gjensidig ekskluderende, og en av dem er nok til å stoppe visning av Unix sine domenetilkoblinger;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">-a</code>, for også å liste sockets (som venter på innkommende forbindelser);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">-n</code>, til å vise resultatene numerisk: IP-adresser (ingen DNS resolution), portnumre (ingen aliaser som definert i <code
                    class="filename">/etc/services</code>) og brukerID-er (ingen påloggingsnavn);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">-p</code>, for å liste opp de prosessene som er involvert, er dette alternativet er bare nyttig når <code
                    class="command">netstat</code> kjøres som rot, siden vanlige brukere bare vil se sine egne prosesser;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">-c</code>, til å kontinuerlig oppdatere listen med tilkoblinger.
					</div></li></ul></div><div
            class="para">
				Andre alternativer, dokumentert på <span
              class="citerefentry"><span
                class="refentrytitle">netstat</span>(8)</span> manuelle side, gir en enda bedre kontroll over resultatene som vises. I praksis blir de første fem alternativene så ofte brukt sammen at systemer og nettverksadministratorer praktisk talt skaffet <code
              class="command">netstat -tupan</code> som en refleks. Typiske resultater på en lett lastet maskin, kan se ut som følger:
			</div><pre
            class="screen scale">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>netstat -tupan</code></strong>
<code
              class="computeroutput">Active Internet connections (servers and established)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:111             0.0.0.0:*               LISTEN      397/rpcbind     
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      431/sshd        
tcp        0      0 0.0.0.0:36568           0.0.0.0:*               LISTEN      407/rpc.statd   
tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      762/exim4       
tcp        0    272 192.168.1.242:22        192.168.1.129:44452     ESTABLISHED 1172/sshd: roland [
tcp6       0      0 :::111                  :::*                    LISTEN      397/rpcbind     
tcp6       0      0 :::22                   :::*                    LISTEN      431/sshd        
tcp6       0      0 ::1:25                  :::*                    LISTEN      762/exim4       
tcp6       0      0 :::35210                :::*                    LISTEN      407/rpc.statd   
udp        0      0 0.0.0.0:39376           0.0.0.0:*                           916/dhclient    
udp        0      0 0.0.0.0:996             0.0.0.0:*                           397/rpcbind     
udp        0      0 127.0.0.1:1007          0.0.0.0:*                           407/rpc.statd   
udp        0      0 0.0.0.0:68              0.0.0.0:*                           916/dhclient    
udp        0      0 0.0.0.0:48720           0.0.0.0:*                           451/avahi-daemon: r
udp        0      0 0.0.0.0:111             0.0.0.0:*                           397/rpcbind     
udp        0      0 192.168.1.242:123       0.0.0.0:*                           539/ntpd        
udp        0      0 127.0.0.1:123           0.0.0.0:*                           539/ntpd        
udp        0      0 0.0.0.0:123             0.0.0.0:*                           539/ntpd        
udp        0      0 0.0.0.0:5353            0.0.0.0:*                           451/avahi-daemon: r
udp        0      0 0.0.0.0:39172           0.0.0.0:*                           407/rpc.statd   
udp6       0      0 :::996                  :::*                                397/rpcbind     
udp6       0      0 :::34277                :::*                                407/rpc.statd   
udp6       0      0 :::54852                :::*                                916/dhclient    
udp6       0      0 :::111                  :::*                                397/rpcbind     
udp6       0      0 :::38007                :::*                                451/avahi-daemon: r
udp6       0      0 fe80::5054:ff:fe99::123 :::*                                539/ntpd        
udp6       0      0 2001:bc8:3a7e:210:a:123 :::*                                539/ntpd        
udp6       0      0 2001:bc8:3a7e:210:5:123 :::*                                539/ntpd        
udp6       0      0 ::1:123                 :::*                                539/ntpd        
udp6       0      0 :::123                  :::*                                539/ntpd        
udp6       0      0 :::5353                 :::*                                451/avahi-daemon: r
</code></pre><div
            class="para">
				Som forventet, dette lister etablerte tilkoblinger, i dette tilfelle to SSH forbindelser, og programmer som venter på innkommende forbindelser (listet som <code
              class="literal">LISTEN</code>), særlig Exim4 e-posttjeneren som lytter på port 25.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.nmap"></a>10.8.2. Fjerndiagnostikk: <code
                    class="command">nmap</code></h3></div></div></div><a
            id="id-1.13.11.4.2"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">nmap</code> (i pakken med tilsvarende navn) er, på en måte, ekstern-motstykket som tilsvarer til <code
              class="command">netstat</code>. Den kan skanne et sett med "kjente" porter for en eller flere eksterne tjenere, og liste portene der det er funnet et program som svarer på innkommende tilkoblinger. Videre kan <code
              class="command">nmap</code> identifisere noen av disse programmene, noen ganger til og med versjonsnummeret. Motstykket til dette verktøyet er at, siden det kjører eksternt, kan det ikke gi informasjon om prosesser eller brukere. Det kan imidlertid operere med flere mål samtidig.
			</div><div
            class="para">
				En typisk <code
              class="command">nmap</code> påkalling bruker bare <code
              class="literal">-A</code>-valget (slik at <code
              class="command">nmap</code> forsøker å identifisere versjoner av tjenerprogramvaren den finner) etterfulgt av én eller flere IP-adresser eller DNS-navn på maskiner som skal skannes. Igjen, det finnes mange muligheter til finkontroll av hvordan <code
              class="command">nmap</code> kjøres. Referer gjerne til dokumentasjonen i <span
              class="citerefentry"><span
                class="refentrytitle">nmap</span>(1)</span> manualside.
			</div><pre
            class="screen scale"
            width="80">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>nmap mirtuel</code></strong>
<code
              class="computeroutput">
Starting Nmap 6.47 ( http://nmap.org ) at 2015-03-09 16:46 CET
Nmap scan report for mirtuel (192.168.1.242)
Host is up (0.000013s latency).
rDNS record for 192.168.1.242: mirtuel.internal.placard.fr.eu.org
Not shown: 998 closed ports
PORT    STATE SERVICE
22/tcp  open  ssh
111/tcp open  rpcbind

Nmap done: 1 IP address (1 host up) scanned in 2.41 seconds
# </code><strong
              class="userinput"><code>nmap -A localhost</code></strong>
<code
              class="computeroutput">
Starting Nmap 6.47 ( http://nmap.org ) at 2015-03-09 16:46 CET
Nmap scan report for localhost (127.0.0.1)
Host is up (0.000013s latency).
Other addresses for localhost (not scanned): 127.0.0.1
Not shown: 997 closed ports
PORT    STATE SERVICE VERSION
22/tcp  open  ssh     OpenSSH 6.7p1 Debian 3 (protocol 2.0)
|_ssh-hostkey: ERROR: Script execution failed (use -d to debug)
25/tcp  open  smtp    Exim smtpd 4.84
| smtp-commands: mirtuel Hello localhost [127.0.0.1], SIZE 52428800, 8BITMIME, PIPELINING, HELP, 
|_ Commands supported: AUTH HELO EHLO MAIL RCPT DATA NOOP QUIT RSET HELP 
111/tcp open  rpcbind 2-4 (RPC #100000)
| rpcinfo: 
|   program version   port/proto  service
|   100000  2,3,4        111/tcp  rpcbind
|   100000  2,3,4        111/udp  rpcbind
|   100024  1          36568/tcp  status
|_  100024  1          39172/udp  status
Device type: general purpose
Running: Linux 3.X
OS CPE: cpe:/o:linux:linux_kernel:3
OS details: Linux 3.7 - 3.15
Network Distance: 0 hops
Service Info: Host: mirtuel; OS: Linux; CPE: cpe:/o:linux:linux_kernel

OS and Service detection performed. Please report any incorrect results at http://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 11.54 seconds
</code></pre><div
            class="para">
				As expected, the SSH and Exim4 applications are listed. Note that not all applications listen on all IP addresses; since Exim4 is only accessible on the <code
              class="literal">lo</code> loopback interface, it only appears during an analysis of <code
              class="literal">localhost</code> and not when scanning <code
              class="literal">mirtuel</code> (which maps to the <code
              class="literal">eth0</code> interface on the same machine).
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.sniffers"></a>10.8.3. Sniffers: <code
                    class="command">tcpdump</code> and <code
                    class="command">wireshark</code></h3></div></div></div><div
            class="para">
				Sometimes, one needs to look at what actually goes on the wire, packet by packet. These cases call for a “frame analyzer”, more widely known as a <span
              class="emphasis"><em>sniffer</em></span>. Such a tool observes all the packets that reach a given network interface, and displays them in a user-friendly way.
			</div><a
            id="id-1.13.11.5.3"
            class="indexterm"></a><div
            class="para">
				The venerable tool in this domain is <code
              class="command">tcpdump</code>, available as a standard tool on a wide range of platforms. It allows many kinds of network traffic capture, but the representation of this traffic stays rather obscure. We will therefore not describe it in further detail.
			</div><a
            id="id-1.13.11.5.5"
            class="indexterm"></a><div
            class="para">
				A more recent (and more modern) tool, <code
              class="command">wireshark</code> (in the <span
              class="pkg pkg">wireshark</span> package), has become the new reference in network traffic analysis due to its many decoding modules that allow for a simplified analysis of the captured packets. The packets are displayed graphically with an organization based on the protocol layers. This allows a user to visualize all protocols involved in a packet. For example, given a packet containing an HTTP request, <code
              class="command">wireshark</code> displays, separately, the information concerning the physical layer, the Ethernet layer, the IP packet information, the TCP connection parameters, and finally the HTTP request itself.
			</div><div
            class="figure"><a
              xmlns=""
              id="figure.wireshark"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/wireshark.png"
                  alt="The wireshark network traffic analyzer" /></div></div><p
              class="title"><strong>Figur 10.1. The <code
                  class="command">wireshark</code> network traffic analyzer</strong></p></div><div
            class="para">
				In our example, the packets traveling over SSH are filtered out (with the <code
              class="literal">!tcp.port == 22</code> filter). The packet currently displayed was developed at the HTTP layer.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> <code
                        class="command">wireshark</code> with no graphical interface: <code
                        class="command">tshark</code></strong></p></div></div></div><a
              id="id-1.13.11.5.9.2"
              class="indexterm"></a><div
              class="para">
				When one cannot run a graphical interface, or does not wish to do so for whatever reason, a text-only version of <code
                class="command">wireshark</code> also exists under the name <code
                class="command">tshark</code> (in a separate <span
                class="pkg pkg">tshark</span> package). Most of the capture and decoding features are still available, but the lack of a graphical interface necessarily limits the interactions with the program (filtering packets after they've been captured, tracking of a given TCP connection, and so on). It can still be used as a first approach. If further manipulations are intended and require the graphical interface, the packets can be saved to a file and this file can be loaded into a graphical <code
                class="command">wireshark</code> running on another machine.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.dhcp.html"><strong>Forrige</strong>10.7. DHCP</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Opp</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Hjem</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="network-services.html"><strong>Neste</strong>Kapittel 11. Network Services: Postfix, Apache, N...</a></li></ul></body></html>
