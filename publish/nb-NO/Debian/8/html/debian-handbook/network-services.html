<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">Kapittel 11. Nettverkstjenester: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-nb-NO-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Håndbok for Debian-administratoren" /><link
        rel="up"
        href="index.html"
        title="Håndbok for Debian-administratoren" /><link
        rel="prev"
        href="sect.network-diagnosis-tools.html"
        title="10.8. Diagnoseverktøy for nettverk" /><link
        rel="next"
        href="sect.http-web-server.html"
        title="11.2. Nett-tjener (HTTP)" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/nb-NO/stable/network-services.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>Forrige</strong></a></li><li
          class="home">Håndbok for Debian-administratoren</li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>Neste</strong></a></li></ul><div
        xml:lang="nb-NO"
        class="chapter"
        lang="nb-NO"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  xmlns=""
                  id="network-services"></a>Kapittel 11. Nettverkstjenester: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="network-services.html#sect.smtp-mail-server">11.1. Posttjener</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.7">11.1.1. Å installere Postfix</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.configuring-virtual-domains">11.1.2. Konfigurering av virtuelle domener</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.restrictions-for-receiving-and-sending">11.1.3. Restriksjoner for å motta og sende</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.setting-up-greylisting">11.1.4. Å sette opp <span
                        class="foreignphrase"><em
                          class="foreignphrase">greylisting</em></span></a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.11">11.1.5. Å tilpasse filtre basert på mottakeren</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.postfix-antivirus">11.1.6. Å integrere en antivirus</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.authenticated-smtp">11.1.7. Godkjent SMTP</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-web-server.html">11.2. Nett-tjener (HTTP)</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.9">11.2.1. Å installere Apache</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.10">11.2.2. Å konfigurere virtuelle verter</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.11">11.2.3. Vanlige direktiver</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.12">11.2.4. Logg-analysatorer</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ftp-file-server.html">11.3. FTP-filtjener</a></span></dt><dt><span
                class="section"><a
                  href="sect.nfs-file-server.html">11.4. NFS-filtjener</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.10">11.4.1. Å sikre NFS</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.11">11.4.2. NFS-tjener</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.12">11.4.3. NFS-klient</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.windows-file-server-with-samba.html">11.5. Oppsett av Windows Shares med Samba</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.9">11.5.1. Samba-tjener</a></span></dt><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.10">11.5.2. Samba-klient</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-ftp-proxy.html">11.6. HTTP/FTP-mellomtjener</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.8">11.6.1. Å installere</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.9">11.6.2. Å konfigurere et hurtiglager</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.10">11.6.3. Å sette opp et filter</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ldap-directory.html">11.7. LDAP-mappe</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.7">11.7.1. Å installere</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.8">11.7.2. Å fylle ut mappen</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.9">11.7.3. Å håndtere kontoer med LDAP</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.rtc-services.html">11.8. Sanntids kommunikasjonstjenester</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-dns-settings">11.8.1. DNS-innstillinger for RTC-tjenester</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.turn-server">11.8.2. TURN-tjener</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.sip-server">11.8.3. SIP-mellomtjener</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.xmpp-server">11.8.4. XMPP-tjener</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-port-443">11.8.5. Å kjøre tjenester på port 443</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-webrtc">11.8.6. Å legge til WebRTC</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		Nettjenester er de programmene som brukerne direkte samhandler med i sitt daglige arbeid. De er toppen av informasjonssystemets isfjell, og dette kapittelet fokuserer på dem - de skjulte delene de er avhengige av er den infrastrukturen vi allerede har beskrevet.
	</div><div
            class="para">
		Mange moderne nettverkstjenester krever krypteringsteknologi for å fungere på en pålitelig og sikker måte, spesielt når de brukes på det offentlige Internettet. X.509-sertifikater (som også kan refereres til som SSL-sertifikater) eller TLS-sertifikater) brukes ofte til dette formålet. Et sertifikat for et bestemt domene kan ofte deles mellom mer enn en av tjenestene som er omtalt i dette kapittelet.
	</div><a
            id="id-1.14.3.3"
            class="indexterm"></a><a
            id="id-1.14.3.4"
            class="indexterm"></a><a
            id="id-1.14.3.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    xmlns=""
                    id="sect.smtp-mail-server"></a>11.1. Posttjener</h2></div></div></div><div
            class="para">
			Administratorer i Falcot Corp valgte ut Postfix som elektronisk posttjener, på grunn av påliteligheten og en enkel konfigurasjon. Designet sikrer fakstisk at hver oppgave blir gjennomført i en prosess med et minimum sett av nødvendige tillatelser, et godt forebyggende tiltak mot sikkerhetsproblemer.
		</div><a
            id="id-1.14.4.3"
            class="indexterm"></a><a
            id="id-1.14.4.4"
            class="indexterm"></a><a
            id="id-1.14.4.5"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIV</em></span> Exim4-tjeneren</strong></p></div></div></div><a
              id="id-1.14.4.6.2"
              class="indexterm"></a><div
              class="para">
			Debian bruker Exim4 som standard e-posttjener (som er grunnen til at den første installasjonen inkluderer Exim4). Konfigurasjonen er levert av en egen pakke, <span
                class="pkg pkg">exim4-config</span>, og automatisk tilpasset basert på svar på et sett med Debconf-spørsmål svært lik spørsmålene fra <span
                class="pkg pkg">postfix</span>-pakken.
		</div><div
              class="para">
			Konfigurasjonen kan enten være i en enkelt fil (<code
                class="filename">/etc/exim4/exim4.conf.template</code>), eller delt på tvers av en rekke konfigurasjonssnutter lagret under <code
                class="filename">/etc/exim4/conf.d/</code>. I begge tilfeller brukes filene av <code
                class="command">update-exim4.conf</code> som maler for å generere <code
                class="filename">/var/lib/exim4/config.autogenerated</code>. Den sistnevnte er filen som brukes av Exim4. Takket være denne mekanismen kan verdier som fås gjennom Exims debconf-konfigurasjon - som er lagret i <code
                class="filename">/etc/exim4/update-exim4.conf.conf</code> - legges inn i Exims konfigurasjonsfil, selv når administratoren eller en annen pakke har endret Exims standardoppsett.
		</div><div
              class="para">
			Syntaksen til Exim4s konfigurasjonsfil har sine særegenheter og sin læringskurve; men når disse særegenheter blir forstått, er Exim4 en svært komplett og kraftig e-posttjener, noe som gjenspeiles av de titalls sidene med dokumentasjon. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.exim.org/docs.html">http://www.exim.org/docs.html</a></div>
		</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.14.4.7"></a>11.1.1. Å installere Postfix</h3></div></div></div><div
              class="para">
				Pakken <span
                class="pkg pkg">postfix</span> omfatter den viktigste SMTP-nissen. Andre pakker (slik som <span
                class="pkg pkg">postfix-ldap</span> og <span
                class="pkg pkg">postfix-pgsql</span>) legger til ekstra funksjonalitet til Postfix, medregnet tilgang til kartdatabaser. Du bør bare installere dem hvis du vet at du trenger dem.
			</div><div
              class="sidebar"><a
                xmlns=""
                id="sidebar.smtp"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>DET GRUNNLEGGENDE</em></span> SMTP</strong></p></div></div></div><a
                id="id-1.14.4.7.3.2"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.3"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.4"
                class="indexterm"></a><div
                class="para">
				SMTP (<span
                  class="emphasis"><em>Simple Mail Transfer Protocol</em></span>) er protokollen som brukes av e-posttjenere for å utveksle og rute e-poster.
			</div></div><div
              class="para">
				Flere Debconf-spørsmål stilles under installasjonen av pakken. Svarene tillater å generere en første versjon av <code
                class="filename">/etc/postfix/main.cf</code>-konfigureringsfil.
			</div><div
              class="para">
				Det første spørsmålet håndterer typen oppsett. Bare to av de foreslåtte svarene passer for en Internett-tilkoblet tjener, «Internet site» (Internett-nettsted) og «Internet with smarthost» (Internett med smartvert). Førstnevnte passer for en tjener som mottar innkommende e-post, og sender utgående e-post direkte til sine mottakere, og er derfor godt tilpasset i Falcot Corps tilfelle. Sistnevnte passer for en tjener som mottar innkommende e-post som normalt, men som sender utgående e-post via en mellomliggende SMTP-tjener - en «smartvert» - i stedet for direkte til mottakerens tjener. Dette er mest nyttig for personer med en dynamisk IP-adresse, siden mange e-posttjenere avviser meldinger som kommer rett fra en slik IP-adresse. I dette tilfellet vil en smartvert vanligvis være ISPs SMTP-tjener, som alltid er konfigurert til å godta e-post som kommer fra ISPs brukere, og videresende den på riktig måte. Dette oppsettet (med smartvert) passer også for tjenere som ikke er permanent koblet til Internett, da det unngår å måtte håndtere en kø med ikke-leverbare meldinger som ikke kan leveres, og som må prøves igjen senere.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ORDFORRÅD</em></span> ISP</strong></p></div></div></div><a
                id="id-1.14.4.7.6.2"
                class="indexterm"></a><div
                class="para">
				ISP er en forkortelse for «Internet Service Provider». Den dekker en enhet, ofte et kommersielt selskap, som leverer Internett-tilkoblinger og tilhørende basistjenester (e-post, nyheter og så videre).
			</div><div
                class="para">
			</div></div><div
              class="para">
				Det andre spørsmålet omfatter det fulle navnet på maskinen, som brukes til å generere e-postadresser fra et lokalt brukernavn; hele navnet på maskinen kommer opp som en del etter at-skiltet/krøllalfa («@»). For Falcots del bør svaret være <code
                class="literal">mail.falcot.com</code>. Dette er det eneste spørsmålet ved oppstart, men oppsettet den fører til er ikke komplett nok for behovene til Falcot, noe som er grunnen til at administratorene kjører <code
                class="command">dpkg-reconfigure postfix</code>, slik at man er i stand til å tilpasse flere parametre.
			</div><div
              class="para">
				Ett av de ekstra spørsmålene gjelder å få alle domenenavn knyttet til denne maskinen. Standardlisten inneholder dets fulle navn, samt noen få synonymer for <code
                class="literal">localhost</code>, men hoveddomenet <code
                class="literal">falcot.com</code> må legges for hånd. Mer generelt bør dette spørsmålet vanligvis besvares med alle domenenavnene som denne maskinen skal tjene som MX-tjener for; med andre ord, alle domenenavnene for hvem DNS sier at denne maskinen vil akseptere e-post. Denne informasjonen ender opp i <code
                class="literal">mydestination</code>-variabelen i Postfixs hovedoppsettsfil - <code
                class="filename">/etc/postfix/main.cf</code>.
			</div><a
              id="id-1.14.4.7.9"
              class="indexterm"></a><a
              id="id-1.14.4.7.10"
              class="indexterm"></a><div
              class="figure"><a
                xmlns=""
                id="id-1.14.4.7.11"></a><div
                class="figure-contents"><div
                  class="mediaobject"><img
                    src="images/mail-server.png"
                    alt="Rollen til DNS MX-registrering ved sending av en e-post" /></div></div><p
                class="title"><strong>Figur 11.1. Rollen til DNS <span
                    class="emphasis"><em>MX</em></span>-registrering ved sending av en e-post</strong></p></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>EKSTRA</em></span> Å spørre MX-registreringene</strong></p></div></div></div><div
                class="para">
				Når DNS ikke har en MX-registrering for et domene, vil e-posttjeneren prøve å sende meldingene til verten selv ved hjelp av den matchende A-posten (eller AAAA i IPv6).
			</div></div><div
              class="para">
				I noen tilfeller kan installasjonen også spørre hvilke nettverk som skal få lov til å sende e-post via maskinen. I standardkonfigurasjonen aksepterer Postfix kun e-postmeldinger som kommer fra selve maskinen; det lokale nettverket vil vanligvis bli lagt til. Falcot Corp-administratorene la til <code
                class="literal">192.168.0.0/16</code> til standardsvaret. Hvis spørsmålet ikke er spurt, er den relevante variabel i konfigurasjonsfilen <code
                class="literal">mynetworks</code>, slik som i eksemplet nedenfor.
			</div><div
              class="para">
				Lokal e-post kan også leveres via <code
                class="command">procmail</code>. Dette verktøyet tillater brukere å sortere sin innkommende e-post etter regler som er lagret i deres <code
                class="filename">~/.procmailrc</code>-fil.
			</div><a
              id="id-1.14.4.7.15"
              class="indexterm"></a><a
              id="id-1.14.4.7.16"
              class="indexterm"></a><a
              id="id-1.14.4.7.17"
              class="indexterm"></a><div
              class="para">
				Etter dette første trinnet, fikk administratorene den etterfølgende konfigurasjonsfil; den vil bli brukt som et utgangspunkt for å legge til noe ekstra funksjonalitet i de neste seksjonene.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.7.19"></a><p
                class="title"><strong>Eksempel 11.1. Innledende <code
                    class="filename">/etc/postfix/main.cf</code>-fil</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# See /usr/share/postfix/main.cf.dist for a commented, more complete version


# Debian specific:  Specifying a file name will cause the first
# line of that file to be used as the name.  The Debian default
# is /etc/mailname.
#myorigin = /etc/mailname

smtpd_banner = $myhostname ESMTP $mail_name (Debian/GNU)
biff = no

# appending .domain is the MUA's job.
append_dot_mydomain = no

# Uncomment the next line to generate "delayed mail" warnings
#delay_warning_time = 4h

readme_directory = no

# TLS parameters
smtpd_tls_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
smtpd_tls_key_file=/etc/ssl/private/ssl-cert-snakeoil.key
smtpd_use_tls=yes
smtpd_tls_session_cache_database = btree:${data_directory}/smtpd_scache
smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache

# See /usr/share/doc/postfix/TLS_README.gz in the postfix-doc package for
# information on enabling SSL in the smtp client.

smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination
myhostname = mail.falcot.com
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
myorigin = /etc/mailname
mydestination = mail.falcot.com, falcot.com, localhost.localdomain, localhost
relayhost = 
mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 192.168.0.0/16
mailbox_command = procmail -a "$EXTENSION"
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
inet_protocols = all
</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>SECURITY</em></span> <span
                          class="emphasis"><em>Snake oil</em></span> SSL certificates</strong></p></div></div></div><div
                class="para">
				<span
                  class="emphasis"><em>snake oil</em></span>-sertifikatene, som ble solgt som <span
                  class="emphasis"><em>snake oil</em></span>-«medisin» av skruppelløse kvakksalvere i gamle dager, har absolutt ingen verdi Du kan ikke stole på dem til å godkjenne tjeneren, for de blir automatisk generert med selvsignerte sertifikater. Men de er nyttige for å bedre personvernet ved utvekslingene.
			</div><div
                class="para">
				Generelt bør de bare brukes til testformål, og i vanlig drift må en bruke ekte sertifikater. Disse kan genereres med fremgangsmåten beskrevet i <a
                  class="xref"
                  href="sect.virtual-private-network.html#sect.easy-rsa">Seksjon 10.2.1.1, «Offentlig nøkkel-infrastruktur: <span
                    class="emphasis"><em>easy-rsa</em></span>»</a>.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.configuring-virtual-domains"></a>11.1.2. Konfigurering av virtuelle domener</h3></div></div></div><a
              id="id-1.14.4.8.2"
              class="indexterm"></a><a
              id="id-1.14.4.8.3"
              class="indexterm"></a><div
              class="para">
				E-posttjeneren kan motta e-post adressert til andre domener i tillegg til hoveddomenet. Disse er da kjent som virtuelle domener. I de fleste tilfeller der dette skjer, blir e-postene i siste instans ikke ment for lokale brukere. Postfix gir to interessante funksjoner for håndtering av virtuelle domener.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>VÆR VARSOM</em></span> Virtuelle domener og «kanoniske» (autoriserte) domener</strong></p></div></div></div><div
                class="para">
				Ingen av de virtuelle domener må være referert i <code
                  class="literal">mydestination</code>-variabelen. Denne variabelen inneholder kun navnene på «kanoniske» (autoriserte) domener direkte knyttet til maskinen og dens lokale brukere.
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.8.6"></a>11.1.2.1. Vituelle alias-domener</h4></div></div></div><a
                id="id-1.14.4.8.6.2"
                class="indexterm"></a><a
                id="id-1.14.4.8.6.3"
                class="indexterm"></a><div
                class="para">
					Et virtuelt alias-domene inneholder kun aliaser, dvs. adresser som bare videresender e-post til andre adresser.
				</div><div
                class="para">
					Et slikt domene aktiveres ved å legge navnet sitt til <code
                  class="literal">virtual_alias_domains</code>-variabelen, og vise til en adressekartleggingsfil i <code
                  class="literal">virtual_alias_maps</code>-variabelen.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.6.6"></a><p
                  class="title"><strong>Eksempel 11.2. Direktiver til å legge i <code
                      class="filename">/etc/postfix/main.cf</code>-filen</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_alias_domains = falcotsbrand.com
virtual_alias_maps = hash:/etc/postfix/virtual</pre></div></div><div
                class="para">
					Filen <code
                  class="filename">/etc/postfix/virtual</code> beskriver en kartlegging med en ganske grei syntaks: Hver linje inneholder to felt adskilt med mellomrom: Det første feltet er alias-navnet, det andre feltet er en liste over e-postadresser der det omdirigeres. Den spesielle <code
                  class="literal">@domain.com</code>-syntaksen dekker alle gjenstående aliaser i et domene.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.6.8"></a><p
                  class="title"><strong>Eksempel 11.3. Eksempel <code
                      class="filename">/etc/postfix/virtual</code>-fil</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
webmaster@falcotsbrand.com  jean@falcot.com
contact@falcotsbrand.com    laure@falcot.com, sophie@falcot.com
# The alias below is generic and covers all addresses within 
# the falcotsbrand.com domain not otherwise covered by this file.
# These addresses forward email to the same user name in the
# falcot.com domain.
@falcotsbrand.com           @falcot.com</pre></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.8.7"></a>11.1.2.2. Virtuelle postboksdomener</h4></div></div></div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>VÆR VARSOM</em></span> Kombinert virtuelt domene?</strong></p></div></div></div><div
                  class="para">
					Postfix tillater ikke bruk av det samme domenet i både <code
                    class="literal">virtual_alias_domains</code>, og <code
                    class="literal">virtual_mailbox_domains</code>. Imidlertid, alle domener hos <code
                    class="literal">virtual_mailbox_domains</code> er implisitt inkludert i <code
                    class="literal">virtual_alias_domains</code>, som gjør det mulig å blande aliaser og postkasser i et virtuelt domene.
				</div></div><a
                id="id-1.14.4.8.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.8.7.4"
                class="indexterm"></a><div
                class="para">
					Meldinger adressert til et virtuelt postboksdomene er lagret i postkasser som ikke er lagt til en lokal systembruker.
				</div><div
                class="para">
					Aktivering av et virtuelt postboksdomene krever navngiving av dette domenet i <code
                  class="literal">virtual_mailbox_domains</code>-variabelen, og refererer til en postkassekartleggingsfil i <code
                  class="literal">virtual_mailbox_maps</code>. Parameteren <code
                  class="literal">virtual_mailbox_base</code> inneholder katalogen der postkasser vil bli lagret.
				</div><div
                class="para">
					Parameteret <code
                  class="literal">virtual_uid_maps</code> (respektivt <code
                  class="literal">virtual_gid_maps</code>) refererer til filen som inneholder kartleggingen mellom e-postadressen og systembrukeren (henholdsvis gruppen) som «eier» den tilsvarende postkassen. For å få alle postkasser som eies av samme eier/gruppe tilordner <code
                  class="literal">static:5000</code> syntaksen en fast UID/GID (med verdien 5000 her).
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.7.8"></a><p
                  class="title"><strong>Eksempel 11.4. Direktiver til å legge i <code
                      class="filename">/etc/postfix/main.cf</code>-filen</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_mailbox_domains = falcot.org
virtual_mailbox_maps = hash:/etc/postfix/vmailbox
virtual_mailbox_base = /var/mail/vhosts</pre></div></div><div
                class="para">
					Igjen, syntaksen til <code
                  class="filename">/etc/postfix/vmailbox</code>-filen er ganske enkel: To felt adskilt med mellomrom. Det første feltet er en e-postadresse i et av de virtuelle domenene, og det andre feltet er plasseringen av den tilhørende postkasse (i forhold til katalogen spesifisert i <span
                  class="emphasis"><em>virtual_mailbox_base</em></span>). Hvis postboksen ender med en skråstrek (<code
                  class="literal">/</code>), blir e-postene lagret i <span
                  class="emphasis"><em>maildir</em></span>-formatet; ellers blir det tradisjonelle <span
                  class="emphasis"><em>mbox</em></span>-formatet brukt. Formatet <span
                  class="emphasis"><em>maildir</em></span> bruker en hel katalog for å lagre en postkasse, hver enkelt melding blir lagret i en egen fil. I <span
                  class="emphasis"><em>mbox</em></span>-formatet, på den andre siden, er hele postboksen lagret i en fil, og hver linje som starter med «<code
                  class="literal">From </code>» (<code
                  class="literal">From</code> fulgt av et mellomrom) signaliserer starten på en ny e-post.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.7.10"></a><p
                  class="title"><strong>Eksempel 11.5. Filen <code
                      class="filename">/etc/postfix/vmailbox</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
# Jean's email is stored as maildir, with
# one file per email in a dedicated directory
jean@falcot.org falcot.org/jean/
# Sophie's email is stored in a traditional "mbox" file,
# with all mails concatenated into one single file
sophie@falcot.org falcot.org/sophie
</pre></div></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.restrictions-for-receiving-and-sending"></a>11.1.3. Restriksjoner for å motta og sende</h3></div></div></div><div
              class="para">
				Det økende antall uønskede e-poster (<span
                class="emphasis"><em>spam</em></span>) krever større strenghet når man bestemmer hvilke e-postmeldinger en tjener bør akseptere. Denne seksjonen presenterer noen av de strategiene som inngår i Postfix.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>KULTUR</em></span> Spamproblemet</strong></p></div></div></div><a
                id="id-1.14.4.9.3.2"
                class="indexterm"></a><div
                class="para">
				«Spam» er et generelt begrep som brukes for å betegne alle uønskede kommersielle e-poster (også kjent som UCES) som oversvømmer våre elektroniske postkasser. De skruppelløse individer som sender dem, er kjent som spammere. De bryr seg lite om de ordensforstyrrelser de forårsaker, siden det å sende en e-post koster svært lite, og bare en svært liten andel av mottakerne trenger å bli tiltrukket av tilbudene for at spamming-operasjonen tjener mer penger enn det koster. Prosessen er for det meste automatisert, og en offentliggjort e-postadresse (for eksempel på et nettforum, registrert på en adresseliste, eller på en blogg, og så videre) vil bli oppdaget av spammeroboter, og utsatt for en endeløs strøm av uønskede meldinger.
			</div><div
                class="para">
				Alle systemadministratorer prøver å møte denne ordensforstyrrelser med spamfiltre, men selvfølgelig vil spammere holde seg oppdatert for å prøve å omgå disse filtrene. Noen leier til og med nettverk av maskiner kompromittert med en orm fra ulike kriminelle organisasjoner. Nyere statistikk anslår at opptil 95 % av all e-post som sirkulerer på Internett er spam!
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.4"></a>11.1.3.1. IP-baserte adgangsrestriksjoner</h4></div></div></div><div
                class="para">
					Direktivet <code
                  class="literal">smtpd_client_restrictions</code> styrer hvilke maskiner som får lov til å kommunisere med e-posttjeneren.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.4.3"></a><p
                  class="title"><strong>Eksempel 11.6. Restriksjoner basert på klientadresse</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_client_restrictions = permit_mynetworks,
    warn_if_reject reject_unknown_client,
    check_client_access hash:/etc/postfix/access_clientip,
    reject_rbl_client sbl-xbl.spamhaus.org,
    reject_rbl_client list.dsbl.org</pre></div></div><div
                class="para">
					Når en variabel inneholder en liste med regler, som i eksempelet ovenfor, er disse reglene evaluert i rekkefølge fra den første til den siste. Hver regel kan akseptere meldingen, avvise den, eller overlate avgjørelsen til en følgende regel. Som en konsekvens, rekkefølge betyr noe, og ganske enkelt å bytte om på to regler kan føre til et vidt forskjellig resultat.
				</div><div
                class="para">
					Direktivet <code
                  class="literal">permit_mynetworks</code>, brukt som den første regelen, godtar alle e-poster som kommer fra en maskin i det lokale nettverket (som definert av konfigureringsvariabelen <span
                  class="emphasis"><em>mynetworks</em></span>).
				</div><div
                class="para">
					Det andre direktivet vil normalt avvise e-post fra maskiner uten en helt gyldig DNS-konfigurasjon. En slik gyldig konfigurasjon betyr at IP-adressen kan løses til et navn, og at dette navnet i sin tur går over til IP-adressen. Denne begrensningen er ofte altfor streng, siden mange e-posttjenere ikke vil ha en omvendt DNS for deres IP-adresse. Dette forklarer hvorfor Falcot administratorer forvalgte <code
                  class="literal">warn_if_reject</code>-modifikatoren til <code
                  class="literal">reject_unknown_client</code>-direktivet: Denne modifikatoren gjør om avvisningen til en enkel varsling registrert i loggene. Administratorene kan deretter holde et øye med antall meldinger som ville bli avvist hvis regelen faktisk ble håndhevet, og ta en avgjørelse senere hvis de ønsker å muliggjøre slik håndheving.
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>TIPS</em></span> <span
                            class="emphasis"><em>access</em></span>-tabeller</strong></p></div></div></div><div
                  class="para">
					Restriksjonskriteriet omfatter administrator-modifiserbare tabeller som lister kombinasjoner av avsendere, IP-adresser, og tillatte eller forbudte vertsnavn. Disse tabellene kan opprettes fra en ukomprimert kopi av <code
                    class="filename">/usr/share/doc/postfix-doc/examples/access.gz</code>-filen. Denne modellen er selv dokumentert i sine kommentarer, noe som betyr hver tabell beskriver sin egen syntaks.
				</div><div
                  class="para">
					Tabellen <code
                    class="filename">/etc/postfix/access_clientip</code> viser IP-adresser og nettverk; <code
                    class="filename">/etc/postfix/access_helo</code> lister domenenavn; <code
                    class="filename">/etc/postfix/access_sender</code> inneholder e-postadresser til avsendere. Alle disse filene må bli omgjort til nøkkeltabeller (et format som er optimalisert for rask tilgang) etter hver endring med <code
                    class="command">postmap /etc/postfix/<em
                      class="replaceable">fil</em></code>-kommandoen.
				</div></div><div
                class="para">
					Den tredje direktivet tillater administratoren å sette opp en svarteliste og en hviteliste med e-postservere, lagret i <code
                  class="filename">/etc/postfix/access_clientip</code>-filen. Tjenere i hvitelisten anses som klarert, og e-poster som kommer derfra går derfor ikke gjennom følgende filtreringsregler.
				</div><div
                class="para">
					De to siste regler avviser enhver melding som kommer fra en tjener oppført i en av de angitte svartelister. RBL er en forkortelse for <span
                  class="emphasis"><em>Remote Black List</em></span>. Det er flere slike lister, men alle lister dårlig konfigurerte tjenere som spammere bruker for å videresende sin e-post, samt uventede post-formidlere, for eksempel maskiner infisert med ormer eller virus.
				</div><a
                id="id-1.14.4.9.4.10"
                class="indexterm"></a><a
                id="id-1.14.4.9.4.11"
                class="indexterm"></a><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>TIPS</em></span> Hviteliste og RBL-er</strong></p></div></div></div><div
                  class="para">
					Svartelister omfatter noen ganger en legitim tjener som har vært offer for en hendelse. I slike situasjoner vil alle e-poster som kommer fra en av disse tjenerne bli avvist dersom tjeneren er oppført i en hviteliste definert av <code
                    class="filename">/etc/postfix/access_clientip</code>.
				</div><div
                  class="para">
					Ut fra forsiktighetshensyn anbefales derfor å hviteliste alle klarerte tjenere som mange e-poster vanligvis kommer fra.
				</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.5"></a>11.1.3.2. Sjekke validiteten til <code
                        class="literal">EHLO</code> eller <code
                        class="literal">HELO</code>-kommandoer</h4></div></div></div><div
                class="para">
					Hver SMTP-utveksling starter med en <code
                  class="literal">HELO</code> (eller <code
                  class="literal">EHLO</code>)-kommando, etterfulgt av navnet på e-posttjeneren som sender; det kan være interessant å kontrollere gyldigheten av dette navnet.
				</div><a
                id="id-1.14.4.9.5.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.5.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.5.5"></a><p
                  class="title"><strong>Eksempel 11.7. Restriksjoner på navnet som er meldt i <code
                      class="literal">EHLO</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_helo_restrictions = permit_mynetworks,
    reject_invalid_hostname,
    check_helo_access hash:/etc/postfix/access_helo,
    reject_non_fqdn_hostname,
    warn_if_reject reject_unknown_hostname</pre></div></div><div
                class="para">
					Det første <code
                  class="literal">permit_mynetworks</code>-direktivet tillater alle maskiner på det lokale nettverket fritt å legge seg til. Dette er viktig, fordi noen e-postprogrammer ikke respekterer denne delen av SMTP-protokollen godt nok, og de kan legge seg til med meningsløse navn.
				</div><div
                class="para">
					Regelen <code
                  class="literal">reject_invalid_hostname</code> avviser e-poster når <code
                  class="literal">EHLO</code>-visningen lister et vertsnavn med feilaktig syntaks. Regelen <code
                  class="literal">reject_non_fqdn_hostname</code> avviser meldinger når annonserte vertsnavn ikke er et fullt kvalifisert domenenavn (inkludert et domenenavn så vel som et vertsnavn). Regelen <code
                  class="literal">reject_unknown_hostname</code> avviser meldinger hvis det annonserte navnet ikke finnes i DNS. Siden denne siste regelen dessverre fører til altfor mange avslag, snudde administratorene denne virkningen med en enkel advarsel ved hjelp av <code
                  class="literal">warn_if_reject</code>-modifikatoren som et første skritt; de kan fjerne denne modifikatoren på et senere tidspunkt, etter å ha gjennomgått resultatene av å bruke regelen.
				</div><div
                class="para">
					Å bruke <code
                  class="literal">permit_mynetworks</code> som den første regelen har en interessant bieffekt: De følgende regler gjelder kun verter utenfor det lokale nettverket. Dette tillater svartelisting av alle verter som varsler seg selv som en del av <code
                  class="literal">falcot.com</code>, for eksempel for å legge til en <code
                  class="literal">falcot.com REJECT You are not in our network!</code>-linje til <code
                  class="filename">/etc/postfix/access_helo</code>-filen.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.6"></a>11.1.3.3. Godta eller nekte basert på annonsert avsender</h4></div></div></div><div
                class="para">
					Hver melding har en avsender, annonsert av <code
                  class="literal">MAIL FROM</code>-kommandoen fra SMTP-protokollen; igjen, denne informasjonen kan bli validert på flere forskjellige måter.
				</div><a
                id="id-1.14.4.9.6.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.6.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.6.5"></a><p
                  class="title"><strong>Eksempel 11.8. Sjekking av sender</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_sender_restrictions = 
    check_sender_access hash:/etc/postfix/access_sender,
    reject_unknown_sender_domain, reject_unlisted_sender,
    reject_non_fqdn_sender</pre></div></div><div
                class="para">
					Tabellen <code
                  class="filename">/etc/postfix/access_sender</code> gir en noe spesiell behandling for noen avsendere. Dette betyr vanligvis å liste noen av avsenderne i en hviteliste eller en svarteliste.
				</div><div
                class="para">
					Regelen <code
                  class="literal">reject_unknown_sender_domain</code> krever et gyldig avsenderdomene, siden det er nødvendig for en gyldig adresse. Regelen <code
                  class="literal">reject_unlisted_sender</code> avviser lokale sendere hvis adressen ikke eksisterer; dette forhindrer e-poster å blir sendt fra en ugyldig adresse i <code
                  class="literal">falcot.com</code>-domenet, og meldinger som skriver seg fra <code
                  class="literal">joe.bloggs@falcot.com</code> aksepteres kun dersom en slik adresse virkelig eksisterer.
				</div><div
                class="para">
					Til slutt, <code
                  class="literal">reject_non_fqdn_sender</code>-regelen avviser e-post som angivelig kommer fra adresser uten et fullt kvalifisert domenenavn. I praksis betyr dette å avvise e-postmeldinger som kommer fra <code
                  class="literal">user@machine</code>: Adressen må bli annonsert som enten <code
                  class="literal">user@machine.example.com</code>, eller <code
                  class="literal">user@example.com</code>.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.7"></a>11.1.3.4. Akesept eller avvising basert på mottaker</h4></div></div></div><div
                class="para">
					Hver e-post har minst én mottaker, kunngjort med <code
                  class="literal">RCPT TO</code>-kommandoen i SMTP-protokollen. Disse adressene garanterer også validering, selv om det kan være mindre relevant enn kontrollene av avsenderadressen.
				</div><a
                id="id-1.14.4.9.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.7.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.7.5"></a><p
                  class="title"><strong>Eksempel 11.9. Sjekk av mottaker</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks, 
    reject_unauth_destination, reject_unlisted_recipient, 
    reject_non_fqdn_recipient</pre></div></div><div
                class="para">
					Regelen <code
                  class="literal">reject_unauth_destination</code> er den grunnleggende regelen som krever at meldinger utenfra adresseres til oss; meldinger sendt til en adresse som ikke er betjent med denne tjeneren, blir avvist. Uten denne regelen, blir tjeneren et åpent relé som tillater spammere å sende uønsket e-post. Denne regelen er derfor obligatorisk, og den er tas best inn nær begynnelsen av listen, slik at ingen andre regler kan autorisere meldingen før destinasjonen er kontrollert.
				</div><div
                class="para">
					Regelen <code
                  class="literal">reject_unlisted_recipient</code> avviser meldinger som sendes til ikke-eksisterende lokale brukere, noe som gir mening. Endelig avslår <code
                  class="literal">reject_non_fqdn_recipient</code>-regelen ikke-fullt-kvalifiserte adresser; dette gjør det umulig å sende en e-post til <code
                  class="literal">jean</code>, eller <code
                  class="literal">jean@machine</code>, og krever bruk av hele adressen i stedet, som for eksempel <code
                  class="literal">jean@machine.falcot.com</code>, eller <code
                  class="literal">jean@falcot.com</code>.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.8"></a>11.1.3.5. Restriksjoner knyttet til <code
                        class="literal">DATA</code>-kommandoen</h4></div></div></div><div
                class="para">
					<code
                  class="literal">DATA</code>-kommandoen til SMTP avgis før innholdet i meldingen. Den gir ikke noen informasjon per se (av seg selv), bortsett fra annonsere hva som kommer etterpå. Den kan fortsatt være underlagt sjekk.
				</div><a
                id="id-1.14.4.9.8.3"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.8.4"></a><p
                  class="title"><strong>Eksempel 11.10. <code
                      class="literal">DATA</code>-sjekk</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_data_restrictions = reject_unauth_pipelining</pre></div></div><div
                class="para">
					Direktivene <code
                  class="literal">reject_unauth_pipelining</code> fører til at meldingen blir avvist hvis avsender sender en kommando før svaret på den forrige kommando er blitt sendt. Dette beskytter mot en vanlig optimalisering som brukes av spamroboter, siden de vanligvis ikke bryr seg det grann om svar, og bare fokuserer på å sende så mange e-poster som mulig på så kort tid som mulig.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.9"></a>11.1.3.6. Å bruke restriksjoner</h4></div></div></div><div
                class="para">
					Selv om de ovennevnte kommandoene validerer informasjon på ulike stadier av SMTP-utvekslingen, sender Postfix bare selve avslaget som et svar på <code
                  class="literal">RCPT TO</code>-kommandoen.
				</div><div
                class="para">
					Dette betyr at selv om meldingen blir avvist på grunn av en ugyldig <code
                  class="literal">EHLO</code>-kommando, kjenner Postfix avsenderen og mottakeren da avvisningen ble varslet. Den kan da logge et mer eksplisitt budskap enn om transaksjonen hadde blitt avbrutt fra starten. I tillegg trenger ikke en rekke SMTP-klienter å forvente feil med de tidlige SMTP-kommandoene, og disse klientene blir mindre forstyrret av dette ved denne senere avvisningen.
				</div><div
                class="para">
					En siste fordel ved dette valget er at reglene kan akkumulere informasjon fra de ulike stadier i SMTP-utvekslingen. Dette tillater å definere mer finkornede tillatelser, som for eksempel avvise en ikke-lokal tilkobling hvis den melder seg med en lokal avsender.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.10"></a>11.1.3.7. Filtrering basert på meldingsinnholdet</h4></div></div></div><div
                class="para">
					Validerings- og begrensningssystemet ville ikke være komplett uten å kunne sjekke meldingsinnholdet. Postfix skiller mellom sjekking av topptekster i e-postene - fra den som gjelder selve meldingskroppen.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.10.3"></a><p
                  class="title"><strong>Eksempel 11.11. Å aktivere innholdsbaserte filtre</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
header_checks = regexp:/etc/postfix/header_checks
body_checks = regexp:/etc/postfix/body_checks</pre></div></div><a
                id="id-1.14.4.9.10.4"
                class="indexterm"></a><div
                class="para">
					Begge filer inneholder en liste med vanlige uttrykk (kjent som <span
                  class="emphasis"><em>regexps</em></span> eller <span
                  class="emphasis"><em>regexes</em></span>), og tilhørende tiltak som skal utløses når e-posthoder (eller kroppen) samsvarer med uttrykket.
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>HURTIGVISNING (QUICK LOOK)</em></span> Regexp-tabeller</strong></p></div></div></div><div
                  class="para">
					Filen <code
                    class="filename">/usr/share/doc/postfix-doc/examples/header_checks.gz</code> inneholder mange forklaringer, og kan brukes som et utgangspunkt for å lage <code
                    class="filename">/etc/postfix/header_checks</code> og <code
                    class="filename">/etc/postfix/body_checks</code>-filer.
				</div></div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.10.7"></a><p
                  class="title"><strong>Eksempel 11.12. Eksempelfil <code
                      class="filename">/etc/postfix/header_checks</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
/^X-Mailer: GOTO Sarbacane/ REJECT I fight spam (GOTO Sarbacane)
/^Subject: *Your email contains VIRUSES/ DISCARD virus notification
</pre></div></div><div
                class="sidebar"><a
                  xmlns=""
                  id="sidebar.regexp"></a><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>DET GRUNNLEGGENDE</em></span> Regulært utrykk</strong></p></div></div></div><div
                  class="para">
					Betegnelsen <span
                    class="emphasis"><em>regulært utrykk </em></span> (forkortet til <span
                    class="emphasis"><em>regexp</em></span>, eller <span
                    class="emphasis"><em>regex</em></span>) refererer til et felles tegnsystem for å gi en beskrivelse av innholdet og/eller strukturen til en streng med tegn. Visse spesialtegn tillater å definere alternativer (for eksempel <code
                    class="literal">foo|bar</code> samsvarer med enten «foo» eller «bar»), setter tillate tegn (for eksempel betyr, <code
                    class="literal">[0-9]</code> hvilket som helst tall, og <code
                    class="literal">.</code> - et punktum - betyr hvilket som helst tegn), kvantifiseringer (<code
                    class="literal">s?</code> samsvarer enten med <code
                    class="literal">s</code>, eller den tomme strengen, med andre ord 0 eller 1 forekomsten av <code
                    class="literal">s</code>; <code
                    class="literal">s+</code> samsvarer med en eller flere påfølgende <code
                    class="literal">s</code> tegn; og så videre). Parenteser tillater gruppering av søkeresultater.
				</div><div
                  class="para">
					Den presise syntaksen til disse uttrykkene varierer mellom de verktøyene som bruker dem, men de grunnleggende funksjonene er like. <div
                    xmlns=""
                    class="url">→ <a
                      xmlns="http://www.w3.org/1999/xhtml"
                      href="http://en.wikipedia.org/wiki/Regular_expression">http://en.wikipedia.org/wiki/Regular_expression</a></div>
				</div></div><div
                class="para">
					Den første sjekker toppteksten som viser til programvaren for e-mail; hvis <code
                  class="literal">GOTO Sarbacane</code> (en samling e-post-programvare) blir funnet, blir meldingen avvist. Det andre uttrykket styrer meldingens subjekt; hvis det nevner et virusvarsel, kan vi bestemme oss for ikke å avvise meldingen, men straks å forkaste den i stedet.
				</div><div
                class="para">
					Bruk av disse filtrene er et tveegget sverd, fordi det er lett å gjøre reglene for allmenne, og som resultat miste legitim e-post. I disse tilfellene vil ikke bare meldingene gå tapt, men avsenderne får uønskede (og irriterende) feilmeldinger.
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.setting-up-greylisting"></a>11.1.4. Å sette opp <span
                      class="foreignphrase"><em
                        class="foreignphrase">greylisting</em></span></h3></div></div></div><a
              id="id-1.14.4.10.2"
              class="indexterm"></a><div
              class="para">
				«Grålisting» («Greylisting») er en filtreringsteknikk der en melding som i utgangspunktet er avvist med en midlertidig feilkode, og bare aksepteres etter et ytterligere forsøk etter noen tid. Denne filtreringen er spesielt effektiv mot spam som sendes av de mange maskinene som er infisert av ormer og virus, fordi denne programvaren sjelden fungerer som en full SMTP-agent (ved å kontrollere feilkode ,og prøve meldinger som har feilet på nytt senere), spesielt fordi mange av de oppsamlede adressene virkelig er ugyldige, og prøve dem på nytt bare ville bety å miste tid.
			</div><div
              class="para">
				Postfix leverer ikke grålisting (greylisting) fritt, men det er en funksjon, der beslutningen om å godta eller forkaste en gitt melding, kan delegeres til et eksternt program. Pakken <span
                class="pkg pkg">postgrey</span> inneholder akkurat et slikt program, laget for å være bindeleddet til denne delegerte adgangspolitikktjenesten.
			</div><div
              class="para">
				Så snart <span
                class="pkg pkg">postgrey</span> er installert, kjører den som en nisse, og lytter på port 10023. Postfix kan så konfigureres til å bruke den ved å legge til <code
                class="literal">check_policy_service</code>-parameteret som en ekstra begrensning:
			</div><pre
              class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks,
    [...]
    check_policy_service inet:127.0.0.1:10023</pre><div
              class="para">
				Hver gang Postfix treffer denne regelen i regelsettet, vil den koble til <code
                class="command">postgrey</code>-nissen, og sende den informasjon om den aktuelle meldingen. På sin side, vurderer Postgrey trillingen/trippelen IP-«adresse/avsende/mottaker», og sjekker i sin database om det samme trillingen er sett i det siste. Hvis ja, svarer Postgrey at meldingen skal godtas; hvis ikke, indikerer svaret at meldingen skal avvises midlertidig, og trillingen blir registrert i databasen.
			</div><div
              class="para">
				Den største ulempen med grålisting er at legitime meldinger bli forsinket, noe som ikke alltid er akseptabelt. Det øker også belastningen på tjenerne som sender mange legitime e-poster.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>I PRAKSIS</em></span> Svakhetene i grålisting</strong></p></div></div></div><div
                class="para">
				Teoretisk bør grålisting bare forsinke den første posten fra en gitt sender til en gitt mottaker, og den typiske forsinkelsen er i størrelsesorden minutter. Virkeligheten kan, imidlertid, avvike noe. Noen store ISP-er bruker klynger av SMTP-tjenere, og når en melding innledningsvis er avslått, er kanskje den tjeneren som prøver å gjenoppta overføringen, ikke den samme som den opprinnelige. Når det skjer, får den andre tjeneren også en midlertidig feilmelding på grunn av grålisting, og så videre. Det kan ta flere timer før overføringen er forsøkt av en tjener som allerede har vært involvert, ettersom SMTP-tjenere ved hver feil vanligvis øke forsinkelsen.
			</div><div
                class="para">
				Som en konsekvens kan den innkommende IP-adressen variere i tid, selv for en enkelt sender. Men det går videre; selv avsenderadressen kan endres. For eksempel; mange postlistetjenere koder inn ekstra informasjon i avsenderadressen, for å være i stand til å håndtere feilmeldinger (kjent som <span
                  class="emphasis"><em>bounces</em></span>). Hver ny melding sendt til en adresseliste kan så trenge å gå gjennom grålisting, noe som betyr at den må lagres (midlertidig) på senderens tjener. For svært store e-postlister (med titusenvis av abonnenter), kan dette fort bli et problem.
			</div><div
                class="para">
				For å redusere disse ulempene administrerer Postgrey en hviteliste med slike steder, og meldinger som kommer fra dem, blir umiddelbart akseptert uten å gå gjennom grålisting. Denne listen kan lett tilpasses de lokale behov, ettersom det er lagret i <code
                  class="filename">/etc/postgrey/whitelist_clients</code>-filen.
			</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>FOR VIDEREKOMMENDE</em></span> Selektiv grålisting med <span
                          class="pkg pkg">milter-greylist</span></strong></p></div></div></div><div
                class="para">
				Ulempene med grålisting kan reduseres ved å bruke grålisting bare på undergruppen av klienter som allerede regnes som sannsynlige kilder til spam (fordi de er oppført i en DNS-svarteliste). Dette er ikke mulig med <span
                  class="pkg pkg">postgrey</span> men <span
                  class="pkg pkg">milter-greylist</span> kan anvendes på en slik måte.
			</div><div
                class="para">
				I dette scenariet, ettersom DNS-svartelister aldri utløser en endelig avvisning, blir det naturlig å bruke aggressive svartelister, medregnet de som viser alle dynamiske IP-adresser fra ISP-klienter (for eksempel<code
                  class="literal">pbl.spamhaus.org</code>, eller <code
                  class="literal">dul.dnsbl.sorbs.net</code>).
			</div><div
                class="para">
				Siden milter-grålisting bruker Sendmails milter-grensesnitt, er postfix-siden av konfigurasjonen begrenset til «<code
                  class="literal">smtpd_milters = unix:/var/run/milter-greylist/milter-greylist.sock</code>». Manualsiden <span
                  class="citerefentry"><span
                    class="refentrytitle">greylist.conf</span>(5)</span> dokumenterer <code
                  class="filename">/etc/milter-greylist/greylist.conf</code>, og de utallige måter å konfigurere milter-grålisting på. Du vil også måtte redigere <code
                  class="filename">/etc/default/milter-greylist</code> for faktisk å aktivere tjenesten.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.14.4.11"></a>11.1.5. Å tilpasse filtre basert på mottakeren</h3></div></div></div><div
              class="para">
				<a
                class="xref"
                href="network-services.html#sect.restrictions-for-receiving-and-sending">Seksjon 11.1.3, «Restriksjoner for å motta og sende»</a> og <a
                class="xref"
                href="network-services.html#sect.setting-up-greylisting">Seksjon 11.1.4, «Å sette opp <span
                  class="foreignphrase"><em
                    class="foreignphrase">greylisting</em></span>»</a> gjennomgikk mange av de mulige restriksjonene. De har alle sin nytte ved å begrense mengden mottatt spam, men har alle også sine ulemper. Det er derfor mer og mer vanlig å tilpasse filtrene til mottakeren. På Falcot Corp er grålisting interessant for de fleste brukere, men det hindrer arbeidet til noen brukere som har behov for korte forsinkelser på sine e-poster (som for eksempel teknisk supporttjeneste). Tilsvarende, den kommersielle tjenesten har noen ganger problemer med å motta e-post fra noen asiatiske leverandører som kan være oppført i svartelister; trenger denne tjenesten en ikke-filtrert adresse for å kunne utveksle e-poster.
			</div><div
              class="para">
				Postfix gir en slik filtertilpasning med «restriction class»-konseptet. Klassene er deklarert i <code
                class="literal">smtpd_restriction_classes</code>-parameteret, og definert på den samme måten som <code
                class="literal">smtpd_recipient_restrictions</code>. Direktivet <code
                class="literal">check_recipient_access</code> definerer deretter en tabell som legger en gitt mottaker til det riktige settet med restriksjoner.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.11.4"></a><p
                class="title"><strong>Eksempel 11.13. Definere begrensningsklasser i <code
                    class="filename">main.cf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">smtpd_restriction_classes = greylisting, aggressive, permissive

greylisting = check_policy_service inet:127.0.0.1:10023
aggressive = reject_rbl_client sbl-xbl.spamhaus.org,
        check_policy_service inet:127.0.0.1:10023
permissive = permit

smtpd_recipient_restrictions = permit_mynetworks,
        reject_unauth_destination,Defining restriction classes in
        check_recipient_access hash:/etc/postfix/recipient_access</pre></div></div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.11.5"></a><p
                class="title"><strong>Eksempel 11.14. Filen <code
                    class="filename">/etc/postfix/recipient_access</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Unfiltered addresses
postmaster@falcot.com  permissive
support@falcot.com     permissive
sales-asia@falcot.com  permissive

# Aggressive filtering for some privileged users
joe@falcot.com         aggressive

# Special rule for the mailing-list manager
sympa@falcot.com       reject_unverified_sender

# Greylisting by default
falcot.com             greylisting
</pre></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.postfix-antivirus"></a>11.1.6. Å integrere en antivirus</h3></div></div></div><a
              id="id-1.14.4.12.2"
              class="indexterm"></a><div
              class="para">
				Med mange virus som sirkulerer som e-postvedlegg, blir det viktig å sette opp et antivirus på inngangspunktet til bedriftens nettverk, da, til tross for en holdningskampanje, vil noen brukere fortsatt åpne vedlegg i åpenbart frynsete meldinger.
			</div><div
              class="para">
				Falcot administrators valgte <code
                class="command">clamav</code> som sin frie antivirus. Hovedpakken er <span
                class="pkg pkg">clamav</span>, men de installerte også noen få ekstra pakker, som <span
                class="pkg pkg">arj</span>, <span
                class="pkg pkg">unzoo</span>, <span
                class="pkg pkg">unrar</span> og <span
                class="pkg pkg">lha</span>, siden de er nødvendige for at antiviruset skal analysere vedlegg arkivert i ett av disse formatene.
			</div><a
              id="id-1.14.4.12.5"
              class="indexterm"></a><a
              id="id-1.14.4.12.6"
              class="indexterm"></a><div
              class="para">
				Oppgaven med å koble sammen antivirus og e-postserveren legges til <code
                class="command">clamav-milter</code>. Et <span
                class="emphasis"><em>milter</em></span> (kort for <span
                class="emphasis"><em>postfilter (mail filter)</em></span>) er et filterprogram spesielt utviklet for å kommunisere med e-posttjenere. Et milter bruker et standard programmeringsgrensesnitt (API) som gir mye bedre ytelse enn eksterne e-posttjenerfiltre. Milters ble først introdusert av <span
                class="emphasis"><em>Sendmail</em></span>, men <span
                class="emphasis"><em>Postfix</em></span> kom snart etter.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>HURTIGVISNING</em></span> Et milter for Spamassassin</strong></p></div></div></div><a
                id="id-1.14.4.12.8.2"
                class="indexterm"></a><div
                class="para">
				Pakken <span
                  class="pkg pkg">spamass-milter</span> gir et milter basert på <span
                  class="emphasis"><em>SpamAssassin</em></span>, den berømte detektoren for uønsket e-post. Den kan brukes til å flagge meldinger som er mulige spam (ved å legge til en ekstra topptekst) og/eller for helt å avvise meldinger hvis spam-poengene («spaminess» score) går utover en gitt terskel.
			</div></div><div
              class="para">
				Så snart pakken <span
                class="pkg pkg">clamav-milter</span> er installert, skal milter konfigureres til å kjøre på en TCP-port i stedet for på standarden som heter socket. Dette kan oppnås med <code
                class="command">dpkg-reconfigure clamav-milter</code>. Når du blir bedt om «Communication interface with Sendmail», svar «<code
                class="literal">inet:10002@127.0.0.1</code>».
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>NOTE</em></span> Ekte TCP port vs heter socket</strong></p></div></div></div><div
                class="para">
				Grunnen til at vi bruker en ekte TCP-port i stedet for den navngitte socketen, er at postfix-nisser ofte kjører chroot, og ikke har tilgang til katalogen som er vertskap for den navngitte socketen. Du kan også velge å fortsette å bruke en navngitt socket, og velge et sted i chroot (<code
                  class="filename">/var/spool/postfix/</code>).
			</div></div><div
              class="para">
				Standard ClamAV-konfigurasjon passer til de fleste situasjoner, men noen viktige parametere kan fortsatt tilpasses med <code
                class="command">dpkg-reconfigure clamav-base</code>.
			</div><div
              class="para">
				Det siste trinnet er å be Postfix å bruke det nettopp konfigurerte filteret. Det er en enkel sak å legge følgende direktiv til <code
                class="filename">/etc/postfix/main.cf</code>:
			</div><pre
              class="programlisting">
# Virus check with clamav-milter
smtpd_milters = inet:[127.0.0.1]:10002
</pre><div
              class="para">
				Hvis antivirus skaper problemer, kan denne linjen kommenteres ut, og <code
                class="command">service postfix reload</code> skal kjøres slik at denne endringen er tatt hensyn til.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>I PRAKSIS</em></span> Testing av antivirus</strong></p></div></div></div><div
                class="para">
				Når antivirus er satt opp, skal det testes om oppførselen er korrekt. Den enkleste måten å gjøre det på, er å sende en test-e-post med et vedlegg som inneholder <code
                  class="filename">eicar.com</code> (eller <code
                  class="filename">eicar.com.zip</code>)-filen, som kan lastes ned fra nettet: <div
                  xmlns=""
                  class="url">→ <a
                    xmlns="http://www.w3.org/1999/xhtml"
                    href="http://www.eicar.org/86-0-Intended-use.html">http://www.eicar.org/86-0-Intended-use.html</a></div>
			</div><div
                class="para">
				Denne filen er ikke en ekte virus, men en test-fil som all antivirusprogramvare på markedet diagnostiserer som et virus, for å tillate sjekking av installasjoner.
			</div></div><div
              class="para">
				Alle meldinger som Postfix håndterer, går nå igjennom antivirusfilteret.
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.authenticated-smtp"></a>11.1.7. Godkjent SMTP</h3></div></div></div><div
              class="para">
				Å kunne sende e-poster krever tilgang på en SMTP-tjener; det krever også nevnte SMTP-tjener for å sende e-post igjennom den. For flyttbare enheter kan det trenges jevnlig endring av konfigurasjonen til SMTP-klienten, ettersom Falcots SMTP-tjener avviser meldinger som kommer fra IP-adresser som tilsynelatende ikke tilhører selskapet. To løsninger finnes: Enten installerer brukeren en SMTP-tjener på datamaskinen sin, eller de fortsetter å bruke selskapets tjener med noen metoder for å autentisere seg som en ansatt. Den første løsningen er ikke anbefalt siden maskinen ikke vil være permanent tilkoblet, og ikke være i stand til igjen å prøve å sende meldinger i tilfelle problemer. Vi vil fokusere på sistnevnte løsning.
			</div><div
              class="para">
				SMTP-autentisering i Postfix hviler på SASL (<span
                class="emphasis"><em>Simple Authentication and Security Layer</em></span>). Det krever installasjon av <span
                class="pkg pkg">libsasl2-modules</span> og <span
                class="pkg pkg">sasl2-bin</span>-pakker, deretter å registrere et passord i SASL-databasen for hver bruker som trenger autentisering på SMTP-tjeneren. Dette gjøres med <code
                class="command">saslpasswd2</code>-kommandoen, som krever flere parametre. Valget <code
                class="literal">-u</code> definerer godkjenningsdomenet, som må samsvare med <code
                class="literal">smtpd_sasl_local_domain</code>-parameteret i Postfix-oppsettet. Valget <code
                class="literal">-c</code> tillater å lage en bruker, og <code
                class="literal">-f</code> kan spesifisere filen som skal brukes hvis SASL-databasen må lagres på et annet sted enn opprinnelig (<code
                class="filename">/etc/sasldb2</code>).
			</div><pre
              class="screen scale">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>saslpasswd2 -u `postconf -h myhostname` -f /var/spool/postfix/etc/sasldb2 -c jean</code></strong>
<code
                class="computeroutput">[... skriv inn passordet til jean to ganger ...]</code></pre><div
              class="para">
				Merk at SASL-databasen ble opprettet i Postfix-katalogen. For å sikre sammenhengen, omgjør vi også <code
                class="filename">/etc/sasldb2</code> til en symbolsk lenke som peker på databasen som brukes av Postfix, med <code
                class="command">ln -sf /var/spool/postfix/etc/sasldb2 /etc/sasldb2</code>-kommandoen.
			</div><div
              class="para">
				Nå trenger vi å sette opp Postfix til å bruke SASL. Først må <code
                class="literal">postfix</code>-brukeren legges til <code
                class="literal">sasl</code>-gruppen, slik at den kan få tilgang til SASL-kontoens database. Et par nye parametere må også til for å aktivere SASL, og <code
                class="literal">smtpd_recipient_restrictions</code>-parameteret må konfigureres til å tillate at SASL-godkjente klienter fritt kan sende e-post.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.13.7"></a><p
                class="title"><strong>Eksempel 11.15. Å sette opp SASL i <code
                    class="filename">/etc/postfix/main.cf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Enable SASL authentication
smtpd_sasl_auth_enable = yes
# Define the SASL authentication domain to use
smtpd_sasl_local_domain = $myhostname
[...]
# Adding permit_sasl_authenticated before reject_unauth_destination
# allows relaying mail sent by SASL-authenticated users
smtpd_recipient_restrictions = permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination,
[...]
</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>EKSTRA</em></span> Autentisert SMTP-klient</strong></p></div></div></div><div
                class="para">
				De fleste e-postklienter er i stand til å autentisere til en SMTP-tjener før den sender utgående meldinger, og ved hjelp av denne funksjonen er det en enkel sak å konfigurere de riktige parameterne. Dersom klienten som brukes ikke leverer den funksjonen, er den midlertidige løsningen å bruke en lokal Postfix-tjener, og konfigurere den til å videresende e-post via den eksterne SMTP-tjeneren. I dette tilfellet vil den lokale Postfixen selv være klienten som autentiserer med SASL. Her er de nødvendige parameterne:
			</div><pre
                class="programlisting">
smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
relay_host = [mail.falcot.com]</pre><div
                class="para">
				Filen <code
                  class="filename">/etc/postfix/sasl_passwd</code> må inneholde brukernavnet og passordet for å autentisere på <code
                  class="literal">mail.falcot.com</code>-tjeneren. Her er et eksempel:
			</div><pre
                class="programlisting">
[mail.falcot.com]   joe:LyinIsji</pre><div
                class="para">
				Som for alle Postfix-funksjoner, må denne filen bli omgjort til <code
                  class="filename">/etc/postfix/sasl_passwd.db</code> med <code
                  class="command">postmap</code>-kommandoen.
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>Forrige</strong>10.8. Diagnoseverktøy for nettverk</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Opp</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Hjem</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>Neste</strong>11.2. Nett-tjener (HTTP)</a></li></ul></body></html>
