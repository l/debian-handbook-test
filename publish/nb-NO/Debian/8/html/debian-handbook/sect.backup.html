<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">9.10. Sikkerhetskopiering</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-nb-NO-1.0-1" /><meta
        name="keywords"
        content="Systemoppstart, Initskript, SSH, Telnet, Rettigheter, Tillatelser, Overvåking, Inetd, Cron, Sikkerhetskopiering, Hot-plugging, PCMCIA, APM, ACPI" /><link
        rel="home"
        href="index.html"
        title="Debian-administratorens håndbok" /><link
        rel="up"
        href="unix-services.html"
        title="Kapittel 9. Unix-tjenester" /><link
        rel="prev"
        href="sect.quotas.html"
        title="9.9. Kvoter (Quotas)" /><link
        rel="next"
        href="sect.hotplug.html"
        title="9.11. Varm tilkobling: hotplug" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/nb-NO/stable/sect.backup.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.quotas.html"><strong>Forrige</strong></a></li><li
          class="home">Debian-administratorens håndbok</li><li
          class="next"><a
            accesskey="n"
            href="sect.hotplug.html"><strong>Neste</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.backup"></a>9.10. Sikkerhetskopiering</h2></div></div></div><div
          class="para">
			Sikkerhetskopiering er en av hovedoppgavene for en administrator, men det er et komplekst tema, som involverer kraftige verktøy som det ofte er vanskelig å mestre.
		</div><a
          id="id-1.12.13.3"
          class="indexterm"></a><a
          id="id-1.12.13.4"
          class="indexterm"></a><div
          class="para">
			Mange programmer finnes, slike som <code
            class="command">amanda</code>, <code
            class="command">bacula</code>, <code
            class="command">BackupPC</code>. De er klient/server-systemer med mange muligheter, men konfigurasjonen er ganske vanskelig. Noen av dem har brukervennlige nett-grensesnitt for å redusere denne. Men Debian inneholder dusinvis av andre backup-programvarer som dekker alle mulige bruksmåter, som du enkelt kan bekrefte med<code
            class="command">apt-cache search backup</code>.
		</div><a
          id="id-1.12.13.6"
          class="indexterm"></a><a
          id="id-1.12.13.7"
          class="indexterm"></a><a
          id="id-1.12.13.8"
          class="indexterm"></a><div
          class="para">
			Snarere enn en detaljert gjennomgang av noen av dem, vil dette avsnittet presentere de tanker Falcot Corp-administratorene har når de definerer sin strategi for sikkerhetskopiering.
		</div><div
          class="para">
			Hos Falcot Corp, har sikkerhetskopiering to mål: Å gjenopprette feilaktig slettede filer, og raskt gjenopprette en datamaskin (tjener eller desktop) hvis harddisken har feilet.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.12.13.11"></a>9.10.1. Sikkerhetskopiering med <code
                    class="command">rsync</code></h3></div></div></div><div
            class="para">
				Da sikkerhetskopier på tape har blitt ansett for å være tregt og dyrt, blir data sikkerhetskopiert på harddisker på en øremerket tjener, der bruk av programvare-RAID (se <a
              class="xref"
              href="advanced-administration.html#sect.raid-soft">Seksjon 12.1.1, «Software RAID»</a>) vil beskytte data fra feil på harddisken. Stasjonære datamaskiner støttes ikke opp individuelt, men brukerne gjøres oppmerksom på at deres personlige konto på deres avdelings filtjener blir sikkerhetskopiert. <code
              class="command">rsync</code>-kommando (fra pakken med samme navn) brukes daglig for å sikkerhetskopiere disse forskjellige tjenerne.
			</div><a
            id="id-1.12.13.11.3"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TILBAKE TIL BASIS</em></span> Den harde linken, et annet navn for filen</strong></p></div></div></div><a
              id="id-1.12.13.11.4.2"
              class="indexterm"></a><a
              id="id-1.12.13.11.4.3"
              class="indexterm"></a><div
              class="para">
				En hard kobling, i motsetning til en symbolsk kobling, kan ikke differensieres fra den den koblede filen. Å lage en hard lenke er egentlig det samme som å gi en eksisterende fil et annet navn. Dette er grunnen til sletting av en hard lenke bare fjerner ett av navnene forbundet med filen. Så lenge et annet navn er fortsatt tildelt filen, er dataene der fortsatt til stede i filsystemet. Det er interessant å merke seg at, i motsetning til en kopi, tar ikke den hard linken opp tilleggsplass på harddisken.
			</div><div
              class="para">
				En hard er lenke laget med <code
                class="command">ln <em
                  class="replaceable">mål</em> <em
                  class="replaceable">lenke</em></code>-kommandoen. <em
                class="replaceable">lenke</em>-filen er så det nye navnet for <em
                class="replaceable">mål</em>-filen. Harde lenker kan bare opprettes på samme filsystem, mens symbolske lenker er ikke underlagt denne begrensningen.
			</div></div><div
            class="para">
				Den tilgjengelige harddiskplassen forbyr gjennomføring av en komplett daglig sikkerhetskopiering. Som sådan, <code
              class="command">rsync</code>-kommandoen innledes med en duplisering av innholdet i den forrige sikkerhetskopien med harde lenker, som forhindrer bruk av for mye plass på harddisken. Prosessen <code
              class="command">rsync</code> erstatter da bare filer som har blitt endret siden siste backup. Med denne mekanismen kan et stort antall sikkerhetskopier holdes på en liten mengde plass. Ettersom alle sikkerhetskopier er umiddelbart tilgjengelige, og med adgang (for eksempel i ulike kataloger av en gitt andel på nettverket), kan du raskt gjøre sammenligninger mellom to gitte datoer.
			</div><a
            id="id-1.12.13.11.6"
            class="indexterm"></a><a
            id="id-1.12.13.11.7"
            class="indexterm"></a><a
            id="id-1.12.13.11.8"
            class="indexterm"></a><div
            class="para">
				Denne sikkerhetskopi-mekanismen kan lett implementeres med <code
              class="command">dirvish</code>-programmet. Den bruker en sikkerhetskopi-lagringsplass («bank» i sitt vokabular) hvor det plasserer tidsmerkede kopier av settene med sikkerhetskopi-filer (disse settene er kalt «vaults» i dirvish-dokumentasjon).
			</div><div
            class="para">
				Hovedoppsettet er i <code
              class="filename">/etc/dirvish/master.conf</code>-filen. Den definerer plasseringen av lagringsplassen for sikkerhetskopien, listen over «vaults» for å administere, og standardverdier for utløpstidspunktet for sikkerhetskopier. Resten av konfigurasjonen er plassert i <code
              class="filename"><em
                class="replaceable">bank</em>/<em
                class="replaceable">vault</em>/dirvish/default.conf</code>-filer, og inneholder det spesifikke oppsettet for det tilsvarende settet med filer.
			</div><div
            class="example"><a
              xmlns=""
              id="example.dirvish-master"></a><p
              class="title"><strong>Eksempel 9.3. Filen <code
                  class="filename">/etc/dirvish/master.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">bank:
    /backup
exclude:
    lost+found/
    core
    *~
Runall:
    root    22:00
expire-default: +15 days
expire-rule:
#   MIN HR    DOM MON       DOW  STRFTIME_FMT
    *   *     *   *         1    +3 months
    *   *     1-7 *         1    +1 year
    *   *     1-7 1,4,7,10  1
</pre></div></div><div
            class="para">
				Innstillingen <code
              class="literal">bank</code> angir katalogen hvor sikkerhetskopiene er lagret. Med <code
              class="literal">exclude</code>-innstillingen kan du angi filer (eller filtyper) som kan utelukkes fra sikkerhetskopieringen. <code
              class="literal">Runall</code> er en liste med filsett som kan sikkerhetskopieres med et tidsstempel for hvert sett, noe som gjør det mulig å tildele riktig dato til kopien, i tilfelle sikkerhetskopiering ikke er utløst på nøyaktig den tildelte tiden. Du må angi et tidspunkt like før selve utføringstidspunktet (som er, som standard, 10:04 pm i Debian, ifølge <code
              class="filename">/etc/cron.d/dirvish</code>). Til slutt, <code
              class="literal">expire-default</code> og <code
              class="literal">expire-rule</code>-settingene definerer opplegget for når tiden for sikkerhetskopier utløper. Eksempelet ovenfor beholder for alltid sikkerhetskopier som er generert på den første søndagen i hvert kvartal, sletter etter ett år de fra den første søndagen i hver måned, og etter 3 måneder de fra andre søndager. Andre daglige sikkerhetskopier er beholdt i 15 dager. Rekkefølgen av reglene spiller en rolle, Dirvish bruker siste samsvarende regel, eller <code
              class="literal">expire-default</code> hvis ingen andre <code
              class="literal">expire-rule</code> samsvarer.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>I PRAKSIS</em></span> Planlagt utløp</strong></p></div></div></div><div
              class="para">
				Utløpsreglene blir ikke brukt av <code
                class="command">dirvish-expire</code> for å gjøre jobben sin. I realiteten blir utløpsregler brukt når du oppretter en ny sikkerhetskopi for å definere den utløpsdatoen som er knyttet til denne kopien. <code
                class="command">dirvish-expire</code> leser ganske enkelt igjennom de lagrede kopiene, og sletter dem om utløpsdatoen har passert.
			</div></div><div
            class="example"><a
              xmlns=""
              id="example.dirvish-vault"></a><p
              class="title"><strong>Eksempel 9.4. Filen <code
                  class="filename">/backup/root/dirvish/default.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">client: rivendell.falcot.com
tree: /
xdev: 1
index: gzip
image-default: %Y%m%d
exclude:
    /var/cache/apt/archives/*.deb
    /var/cache/man/**
    /tmp/**
    /var/tmp/**
    *.bak
</pre></div></div><div
            class="para">
				Eksempelet ovenfor spesifiserer settet med filer som skal sikkerhetskopieres: Dette er filer på maskinen <span
              class="emphasis"><em>rivendell.falcot.com</em></span> (for lokal sikkerhetskopiering av data, ganske enkelt angi navnet på den lokale maskinen som angitt av <code
              class="command">hostname</code>), særlig de i rot-treet (<code
              class="literal">tree: /</code>), untatt de som er listet i <code
              class="literal">exclude</code>. Sikkerhetskopien vil være avgrenset til innholdet i ett filsystem (<code
              class="literal">xdev: 1</code>). Den vil ikke inkludere filer fra andre monteringspunkter. En indeks over lagrede filer vil generes (<code
              class="literal">index: gzip</code>), og bildet blir navngitt med dagens dato (<code
              class="literal">image-default: %Y%m%d</code>).
			</div><div
            class="para">
				Det er mange alternativer tilgjengelig, alle dokumentert i manualsiden <span
              class="citerefentry"><span
                class="refentrytitle">dirvish.conf</span>(5)</span>. Når disse konfigurasjonsfiler er opprettet, må du starte hvert filsett med <code
              class="command">dirvish --vault <em
                class="replaceable">vault</em> --init</code>-kommandoen. Fra da av vil den daglige påkallelsen fra <code
              class="command">dirvish-runall</code> automatisk opprette en ny sikkerhetskopi like etter å ha slettet de som er utløpt.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>I PRAKSIS</em></span> Ekstern sikkerhetskopiering via SSH</strong></p></div></div></div><div
              class="para">
				Når dirvish trenger å lagre data på en ekstern maskin, vil den bruke <code
                class="command">ssh</code> for å koble seg til den, og vil starte <code
                class="command">rsync</code> som en tjener. Dette krever at rotbrukeren automatisk kan koble seg til den. Å bruke en SSH-autentiseringsnøkkel tillater nettopp dette (se <a
                class="xref"
                href="sect.remote-login.html#sect.ssh-key-based-auth">Seksjon 9.2.1.1, «Nøkkel-basert autentisering»</a>).
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.12.13.12"></a>9.10.2. Å gjenopprette maskiner uten sikkerhetskopier</h3></div></div></div><div
            class="para">
				Stasjonære datamaskiner, som ikke er sikkerhetskopiert, kan enkelt installeres fra tilpassede DVD-ROM-er klargjort med <span
              class="emphasis"><em>Simple-CDD</em></span> (se <a
              class="xref"
              href="sect.automated-installation.html#sect.simple-cdd">Seksjon 12.3.3, «Simple-CDD: The All-In-One Solution»</a>). Siden dette lager en installasjon fra bunnen av, mistes noe tilpasning som kan ha blitt gjort etter den første installasjonen. Dette er greit, siden systemene alle er koblet til en sentral LDAP-katalog for kontoer, og de fleste skrivebordsprogrammer er forhåndskonfigurert takket være dconf (se <a
              class="xref"
              href="sect.graphical-desktops.html#sect.gnome-desktop">Seksjon 13.3.1, «GNOME»</a> for mer informasjon om dette).
			</div><div
            class="para">
				Falcot Corp administratorer er klar over begrensningene i sin sikkerhetskopi-politikk. Siden de ikke kan beskytte sikkerhetskopi-tjeneren samt et bånd (tape) i en brannsikker safe, har de installert det i et eget rom, slik at hendelser, for eksempel en brann i tjenerrommet, ikke ødelegger sikkerhetskopier sammen med alt annet. Videre lager de en trinnvis sikkerhetskopiering på DVD-ROM en gang per uke - kun de filer som er endret siden siste sikkerhetskopiering er inkludert.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>GÅR VIDERE</em></span> Sikkerhetskopiere SQL- og LDAP-tjenester</strong></p></div></div></div><div
              class="para">
				Mange tjenester (som for eksempel SQL- eller LDAP-databaser) kan ikke sikkerhetskopieres bare ved å kopiere filene deres (med mindre de er riktig avbrutt når sikkerhetskopiene lages, noe som ofte er problematisk, siden de er ment å være tilgjengelig til enhver tid). Dermed er det nødvendig å bruke en «eksport»-mekanisme for å lage en «data dump» som trygt kan sikkerhetskopieres. Disse er ofte ganske store, men de komprimeres godt. For å redusere plassbehovet som trengs kan du bare lagre komplett tekstfil per uke, og en <code
                class="command">diff</code> hver dag, som lages med en kommando av typen <code
                class="command">diff <em
                  class="replaceable">gårsdagens_fil</em> <em
                  class="replaceable">dagens_fil</em></code>. Programmet <code
                class="command">xdelta</code> lager økende forskjeller fra binære dumper.
			</div><a
              id="id-1.12.13.12.4.3"
              class="indexterm"></a><a
              id="id-1.12.13.12.4.4"
              class="indexterm"></a><a
              id="id-1.12.13.12.4.5"
              class="indexterm"></a></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>KULTUR</em></span> <span
                        class="emphasis"><em>TAR</em></span>, standarden for sikkerhetskopiering på tape (bånd)</strong></p></div></div></div><a
              id="id-1.12.13.12.5.2"
              class="indexterm"></a><a
              id="id-1.12.13.12.5.3"
              class="indexterm"></a><a
              id="id-1.12.13.12.5.4"
              class="indexterm"></a><div
              class="para">
				De enkleste måtene for å lage en sikkerhetskopi på Unix var, historisk sett, å lagre et <span
                class="emphasis"><em>TAR</em></span>-arkiv på et bånd. Kommandoen <code
                class="command">tar</code> fikk til og med sitt navn fra «Tape ARchive».
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.quotas.html"><strong>Forrige</strong>9.9. Kvoter (Quotas)</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Opp</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Hjem</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.hotplug.html"><strong>Neste</strong>9.11. Varm tilkobling: hotplug</a></li></ul></body></html>
