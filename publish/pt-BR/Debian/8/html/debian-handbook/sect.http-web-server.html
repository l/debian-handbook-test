<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.2. Servidor web (HTTP)</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-pt-BR-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="O Manual do Administrador Debian" /><link
        rel="up"
        href="network-services.html"
        title="Capítulo 11. Serviços de Rede: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="network-services.html"
        title="Capítulo 11. Serviços de Rede: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="next"
        href="sect.ftp-file-server.html"
        title="11.3. Servidor de Arquivos FTP" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/pt-BR/stable/sect.http-web-server.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="network-services.html"><strong>Anterior</strong></a></li><li
          class="home">O Manual do Administrador Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.ftp-file-server.html"><strong>Próxima</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.http-web-server"></a>11.2. Servidor web (HTTP)</h2></div></div></div><div
          class="para">
			Os administradores da Falcot Corp decidiram usar o servidor HTTP da Apache, incluído no Debian <span
            class="distribution distribution">Jessie</span> na versão 2.4.10.
		</div><a
          id="id-1.14.5.3"
          class="indexterm"></a><a
          id="id-1.14.5.4"
          class="indexterm"></a><a
          id="id-1.14.5.5"
          class="indexterm"></a><a
          id="id-1.14.5.6"
          class="indexterm"></a><a
          id="id-1.14.5.7"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>ALTERNATIVA</em></span> Outros servidores web</strong></p></div></div></div><div
            class="para">
			O Apache é apenas o mais conhecido (e amplamente utilizado) servidor web, porém existem outros; eles podem oferecer um melhor desempenho sob certas cargas de trabalho, mas ao custo de terem um número menor de funcionalidades e módulos disponíveis. Contudo, quando o servidor web em perspectiva é feito para servir arquivos estáticos ou agir como um proxy, alternativas tais como <span
              class="pkg pkg">nginx</span> e <span
              class="pkg pkg">lighttpd</span>, valem a pena serem investigadas.
		</div><a
            id="id-1.14.5.8.3"
            class="indexterm"></a><a
            id="id-1.14.5.8.4"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.9"></a>11.2.1. Instalação do Apache</h3></div></div></div><div
            class="para">
				Instalar o pacote <span
              class="pkg pkg">apache2</span> é tudo o que é preciso. ele contém todos os môdulos, incluíndo os <span
              class="emphasis"><em>Multi-Processing Modules</em></span> (MPMs) que afetam como o Apache lida com processamento paralelo de muitas requisições (aqueles que costumeiramente eram fornecidos em pacotes <span
              class="pkg pkg">apache2-mpm-*</span> separados). Ele irá também puxar o <span
              class="pkg pkg">apache2-utils</span> que contém os utilitários de linha de comando que nós iremos descobrir mais tarde.
			</div><div
            class="para">
				O MPM em uso afeta significantemente a forma com que o Apache irá lidar com as requisições simultâneas. Com o MPM <span
              class="pkg pkg">worker</span>, ele usa <span
              class="emphasis"><em>threads</em></span> (processos leves), enquanto que com o MPM <span
              class="pkg pkg">prefork</span> ele usa um grupo de processos criados antecipadamente. Com o MPM <span
              class="pkg pkg">event</span> ele também usa threads, porém as conexões inativas (notavelmente aquelas mantidas abertas pelo recurso HTTP <span
              class="emphasis"><em>keep-alive</em></span>) são devolvidas a um segmento de gerenciamento dedicado.
			</div><div
            class="para">
				Os administradores da Falcot também instalaram o <span
              class="pkg pkg">libapache2-mod-php5</span> a fim de incluir suporte a PHP no Apache. Isso faz com que o <span
              class="pkg pkg">evento</span> padrão MPM seja desabilitado, e o <span
              class="pkg pkg">prefork</span> seja instalado em seu lugar, já que o PHP só funciona sob esse MPM em particular.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SEGURANÇA</em></span> Execução sob o usuário <code
                        class="literal">www-data</code></strong></p></div></div></div><a
              id="id-1.14.5.9.5.2"
              class="indexterm"></a><a
              id="id-1.14.5.9.5.3"
              class="indexterm"></a><div
              class="para">
				Por padrão, o Apache lida com as requisições de entrada sob a identidade de usuário <code
                class="literal">www-data</code>. Isso significa que uma vulnerabilidade em um script CGI executado pelo Apache (para uma página dinâmica) não comprometa todo o sistema, mas apenas os arquivos pertencentes a esse usuário em particular.
			</div><div
              class="para">
				O uso do módulo <span
                class="emphasis"><em>suexec</em></span> permite contornar essa regra para que alguns scripts CGI sejam executados sob a identidade de outro usuário. Isso é configurado com a diretiva <code
                class="literal">SuexecUserGroup <em
                  class="replaceable">user</em><em
                  class="replaceable">group</em></code> na configuração do Apache.
			</div><a
              id="id-1.14.5.9.5.6"
              class="indexterm"></a><div
              class="para">
				Outra possibilidade é usar um MPM dedicado, como o fornecido pelo <span
                class="pkg pkg">libapache2-mpm-itk</span>. Esse módulo em particular tem um comportamento um pouco diferente: ele permite o “isolamento” de hosts virtuais (na verdade, conjuntos de páginas) para que cada um deles seja executado como um usuário diferente. Portanto, uma vulnerabilidade em um site web não pode comprometer arquivos pertencentes ao dono de outro site web.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>OLHADA RÁPIDA</em></span> Lista de módulos</strong></p></div></div></div><div
              class="para">
				Uma lista completa dos módulos padrão do Apache pode ser encontrada online. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://httpd.apache.org/docs/2.4/mod/index.html">http://httpd.apache.org/docs/2.4/mod/index.html</a></div>
			</div></div><div
            class="para">
				O Apache é um servidor modular, e muitos recursos são implementados através de módulos externos que o programa principal carrega durante sua inicialização. A configuração padrão apenas habilita os módulos mais comuns, porém habilitar módulos novos é uma simples questão de rodar <code
              class="command">a2enmod <em
                class="replaceable">módulo</em></code>; para desabilitar um módulo, o comando é <code
              class="command">a2dismod <em
                class="replaceable">módulo</em></code>. Esses programas na verdade apenas criam (ou apagam) ligações simbólicas em <code
              class="filename">/etc/apache2/mods-enabled/</code>, que apontam para para os arquivos reais (armazenados em <code
              class="filename">/etc/apache2/mods-available/</code>).
			</div><div
            class="para">
				Com sua configuração padrão, o servidor web ouve na porta 80 (como configurado em <code
              class="filename">/etc/apache2/ports.conf</code>), e serve páginas a partir do diretório <code
              class="filename">/var/www/html/</code> (como configurado em <code
              class="filename">/etc/apache2/sites-enabled/000-default.conf</code>).
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>INDO ALÉM</em></span> Compatibilidade com SSL</strong></p></div></div></div><a
              id="id-1.14.5.9.9.2"
              class="indexterm"></a><a
              id="id-1.14.5.9.9.3"
              class="indexterm"></a><div
              class="para">
				O Apache 2.4 inclui o módulo SSL, necessário para HTTP seguro (HTTPS) "de fábrica". Ele apenas precisa ser habilitado com <code
                class="command">a2enmod ssl</code>, e então as diretivas necesssárias têm que ser adicionadas aos arquivos de configuração. Um exemplo de configuração é fornecido em <code
                class="filename">/etc/apache2/sites-available/default-ssl.conf</code>. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://httpd.apache.org/docs/2.4/mod/mod_ssl.html">http://httpd.apache.org/docs/2.4/mod/mod_ssl.html</a></div>
			</div><div
              class="para">
				Alguns cuidados extra devem ser tomados se você quer fornecer conexões SSL com <span
                class="emphasis"><em>Perfect Forward Secrecy</em></span> (essas conexões usam chaves de sessão efêmera, que garantem que um comprometimento da chave secreta do servidor não resulte no comprometimento de tráfego criptografado antigo que poderia ter sido armazenado durante um "sniffing" na rede). Dê uma olhada nas recomendações da Mozilla, em particular: <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="https://wiki.mozilla.org/Security/Server_Side_TLS#Apache">https://wiki.mozilla.org/Security/Server_Side_TLS#Apache</a></div>
			</div><a
              id="id-1.14.5.9.9.6"
              class="indexterm"></a></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.10"></a>11.2.2. Configuração de servidores virtuais</h3></div></div></div><div
            class="para">
				Um servidor virtual é uma identidade adicional para o servidor web.
			</div><a
            id="id-1.14.5.10.3"
            class="indexterm"></a><div
            class="para">
				Apache considera dois tipos diferentes de hosts virtuais: aqueles que se baseiam no endereço IP (ou na porta) e aqueles que se baseiam no nome de domínio do servidor web. O primeiro método requer a alocação de um endereço IP diferente (ou porta) para cada site, enquanto o segundo pode funcionar em um único endereço IP (e porta), os sites são diferenciados pelo nome de máquina enviado pelo cliente HTTP (que só funciona na versão 1.1 do protocolo HTTP — Felizmente essa versão é antiga o bastante, e assim, é utilizada por todos os clientes).
			</div><div
            class="para">
				A (crescente) escassez de endereços IPv4 geralmente favorece o segundo método; contudo, fica mais complexo se os hosts virtuais precisam fornecer HTTPS também, pois o protocolo SSL nem sempre é fornecido para hospedagem virtual baseada em nome; a extensão SNI (<span
              class="emphasis"><em>Server Name Indication</em></span>) que permite uma combinação desse tipo não é suportada por todos os navegadores. Quando vários sites HTTPS precisam ser rodados no mesmo servidor, eles geralmente irão ser diferenciados ou por rodar em uma porta diferente ou um endereço IP diferente (IPv6 pode ajudar aqui).
			</div><div
            class="para">
				A configuração padrão do Apache 2 habilita hosts virtuais baseados em nomes. Além disso, um host virtual padrão é definido no arquivo <code
              class="literal">/etc/apache2/sites-enabled/000-default.conf</code>; esse host virtual será usado se não for encontrado nenhum host que corresponda à solicitação enviada pelo cliente.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ATENÇÃO</em></span> Primeiro servidor virtual</strong></p></div></div></div><div
              class="para">
				Requisições relativas a hosts virtuais desconhecidos sempre serão servidas pelo primeiro host virtual definido, é por isso que nós definimos <code
                class="literal">www.falcot.com</code> em primeiro lugar aqui.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>OLHADA RÁPIDA</em></span> Suporte Apache ao SNI</strong></p></div></div></div><a
              id="id-1.14.5.10.8.2"
              class="indexterm"></a><div
              class="para">
				O servidor Apache suporta uma extensão do protocolo SSL chamada <span
                class="emphasis"><em>Server Name Indication</em></span> (SNI). Esta extensão permite ao navegador enviar o nome do nome do host do servidor web durante o estabelecimento da conexão SSL, muito antes do que o HTTP o solicitaria, que foi usado anteriormente para identificar o host virtual solicitado entre aqueles hospedados no mesmo servidor (com o mesmo endereço IP e porta). Isso permite ao Apache selecionar o certificado SSL mais adequado para a transação a proceder.
			</div><div
              class="para">
				Antes do SNI, o Apache sempre usava o certificado definido no host virtual padrão. Clientes que tentavam acessar outro host virtual iriam então exibir avisos (warnings), pois eles recebiam o certificado que não correspondia com o site que eles estavam tentando acessar. Felizmente, a maioria dos navegadores agora trabalham com SNI; Isso inclui o Microsoft Internet Explorer a partir da versão 7.0 (começando no Vista), Mozilla Firefox começando com a versão 2.0, o Safari da Apple desde a versão 3.2.1 e todas as versões do Google Chrome.
			</div><div
              class="para">
				O pacote Apache fornecido pelo Debian é construído com suporte a SNI; portanto, nenhuma configuração em particular é necessária.
			</div><div
              class="para">
				Devemos também ter cuidado para garantir que a configuração do primeiro host virtual (aquele usado por padrão) habilite TLSv1, pois o Apache utiliza os parâmetros deste primeiro hospedeiro virtual para estabelecer conexões seguras e eles tem a melhor permissividade para isso!
			</div></div><div
            class="para">
				Cada host virtual extra é então descrito por um arquivo armazenado em <code
              class="filename">/etc/apache2/sites-available/</code>. Configurar um site web para o domínio <code
              class="literal">falcot.org</code> é portanto uma simples questão de criar o seguinte arquivo, e então, habilita o host virtual com <code
              class="command">a2ensite www.falcot.org</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.10.10"></a><p
              class="title"><strong>Exemplo 11.16. o arquivo <code
                  class="filename">/etc/apache2/sites-available/www.falcot.org.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">
&lt;VirtualHost *:80&gt;
ServerName www.falcot.org
ServerAlias falcot.org
DocumentRoot /srv/www/www.falcot.org
&lt;/VirtualHost&gt;</pre></div></div><div
            class="para">
				O servidor Apache, como configurado até agora, usa os mesmos arquivos de log para todos os hosts virtuais (embora isso possa ser alterado adicionando as diretivas <code
              class="literal">CustomLog</code> na definição de hosts virtuais). É, entretanto, boa prática customizar o formato desse arquivo de log para ter incluído o nome do host virtual. Isso pode ser feito criando um arquivo <code
              class="filename">/etc/apache2/conf-available/customlog.conf</code>, que define um novo formato para todos os arquivos de log (com a diretiva <code
              class="literal">LogFormat</code>), e habilitando-o com <code
              class="command">a2enconf customlog</code> . A linha <code
              class="literal">CustomLog</code> tem também que ser removida (ou comentada) do arquivo <code
              class="filename">/etc/apache2/sites-available/000-default.conf</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.10.12"></a><p
              class="title"><strong>Exemplo 11.17. O arquivo <code
                  class="filename">/etc/apache2/conf.d/customlog.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting scale">
# New log format including (virtual) host name
LogFormat "%v %h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\"" vhost

# Now let's use this "vhost" format by default
CustomLog /var/log/apache2/access.log vhost</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.11"></a>11.2.3. Diretivas comuns</h3></div></div></div><div
            class="para">
				Essa seção revê, brevemente, algumas das diretivas comumente usadas na configuração do Apache.
			</div><a
            id="id-1.14.5.11.3"
            class="indexterm"></a><a
            id="id-1.14.5.11.4"
            class="indexterm"></a><div
            class="para">
				O principal arquivo de configuração inclui vários blocos <code
              class="literal">Directory</code>; eles permitem especificar diferentes comportamentos para o servidor dependendo da localização do arquivo que está sendo servido. Um bloco desse tipo comumente inclui as diretivas <code
              class="literal">Options</code> e <code
              class="literal">AllowOverride</code>.
			</div><a
            id="id-1.14.5.11.6"
            class="indexterm"></a><a
            id="id-1.14.5.11.7"
            class="indexterm"></a><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.11.8"></a><p
              class="title"><strong>Exemplo 11.18. Bloco Directory</strong></p><div
              class="example-contents"><pre
                class="programlisting">
&lt;Directory /var/www&gt;
Options Includes FollowSymlinks
AllowOverride All
DirectoryIndex index.php index.html index.htm
&lt;/Directory&gt;</pre></div></div><div
            class="para">
				A diretiva <code
              class="literal">DirectoryIndex</code> contém uma lista de arquivos a serem experimentados quando uma requisição do cliente coincide com um diretório. O primeiro arquivo existente da lista é usado e enviado como resposta.
			</div><a
            id="id-1.14.5.11.10"
            class="indexterm"></a><div
            class="para">
				A diretiva <code
              class="literal">Options</code> é seguida de uma lista de opções a serem habilitadas. O valor <code
              class="literal">None</code> desabilita todas as opções; correspondentemente, <code
              class="literal">All</code> habilita todas elas exceto <code
              class="literal">MultiViews</code>. As opções disponíveis incluem:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ExecCGI</code> indica que scripts CGI podem ser executados. <a
                    id="id-1.14.5.11.12.1.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">FollowSymlinks</code> diz ao servidor que ligações simbólicas podem ser seguidas, e que a resposta deve conter o conteúdo do alvo de uma ligação como essa. <a
                    id="id-1.14.5.11.12.2.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SymlinksIfOwnerMatch</code> também diz ao servidor para seguir ligações simbólicas, mas apenas quando a ligação e seu alvo são do mesmo dono. <a
                    id="id-1.14.5.11.12.3.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">Includes</code> habilita <span
                    class="emphasis"><em>Server Side Includes</em></span> (<span
                    class="emphasis"><em>SSI</em></span> para abreviar). Essas são diretivas embutidas nas páginas HTML e executadas em tempo de execução de cada requisição. <a
                    id="id-1.14.5.11.12.4.1.4"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">Indexes</code> diz ao servidor para listar o conteúdo de um diretório se a requisição HTTP enviada pelo cliente aponta para um diretório sem um arquivo index (ie, quando nenhum arquivo mencionado na diretiva <code
                    class="literal">DirectoryIndex</code> existe nesse diretório). <a
                    id="id-1.14.5.11.12.5.1.3"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">MultiViews</code> habilita a negociação de conteúdo; isso pode ser usado pelo servidor para retornar uma página web que coincida com a língua preferida configurada no navegador. <a
                    id="id-1.14.5.11.12.6.1.2"
                    class="indexterm"></a>
					</div></li></ul></div><div
            class="para">
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DE VOLTA AO BÁSICO</em></span> Arquivo <code
                        class="filename">.htaccess</code></strong></p></div></div></div><div
              class="para">
				O arquivo <code
                class="filename">.htaccess</code> contém as diretivas de configuração do Apache que são aplicadas cada vez que uma requisição diz respeito a um elemento do diretório aonde ele é armazenado. O âmbito dessas diretivas também repercute para todos os subdiretórios dentro desse diretório.
			</div><a
              id="id-1.14.5.11.14.3"
              class="indexterm"></a><div
              class="para">
				A maioria das diretivas que podem ser definidas no bloco <code
                class="literal">Directory</code> também podem ser definidas no arquivo <code
                class="filename">.htaccess</code>.
			</div></div><div
            class="para">
				A diretiva <code
              class="literal">AllowOverride</code> lista todas as opções que podem ser habilitadas ou desabilitadas pelo arquivo <code
              class="filename">.htaccess</code>. Um uso comum dessa opção é restringir <code
              class="literal">ExecCGI</code>, para que o administrador escolha quais usuários tem permissão para rodar programas sob a identidade do servidor web (o usuário <code
              class="literal">www-data</code>).
			</div><a
            id="id-1.14.5.11.16"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.5.11.17"></a>11.2.3.1. Autenticação obrigatória</h4></div></div></div><a
              id="id-1.14.5.11.17.2"
              class="indexterm"></a><div
              class="para">
					Em algumas circunstâncias, o acesso a parte do site web precisa ser restrita, para que apenas usuários legítimos que fornecerem um nome de usuário e uma senha tenham acesso ao conteúdo.
				</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.5.11.17.4"></a><p
                class="title"><strong>Exemplo 11.19. Arquivo <code
                    class="filename">.htaccess</code> para autenticação obrigatária</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
Require valid-user
AuthName "Private directory"
AuthType Basic
AuthUserFile /etc/apache2/authfiles/htpasswd-private</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>SEGURANÇA</em></span> Sem segurança</strong></p></div></div></div><div
                class="para">
					O sistema de autenticação usado no exemplo acima (<code
                  class="literal">Basic</code>) tem uma segurança mínima já que a senha é enviada em texto puro (ela apenas é codificada com <span
                  class="emphasis"><em>base64</em></span>, que é uma codificação simples, ao invés de um método criptografado). Também deve ser notado que os documentos “protegidos” por esse mecanismo também trafegam pela rede em texto puro. Se segurança é importante, toda a conexão HTTP deve ser criptografada com SSL.
				</div></div><div
              class="para">
					O arquivo <code
                class="filename">/etc/apache2/authfiles/htpasswd-private</code> contém uma lista de usuários e senhas; ele é comumente manipulado com o comando <code
                class="command">htpasswd</code>. Por exemplo, o seguinte comando é usado para adicionar um usuário ou alterar a senha: <a
                id="id-1.14.5.11.17.6.3"
                class="indexterm"></a>
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>htpasswd /etc/apache2/authfiles/htpasswd-private <em
                    class="replaceable">user</em>
</code></strong><code
                class="computeroutput">New password:
Re-type new password:
Adding password for user <em
                  class="replaceable">user</em>
</code></pre></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.5.11.18"></a>11.2.3.2. Restringindo Acesso</h4></div></div></div><a
              id="id-1.14.5.11.18.2"
              class="indexterm"></a><div
              class="para">
					A diretiva <code
                class="literal">Require</code> controla as restrições de acesso em um diretório (e seus sub-diretórios, recursivamente).
				</div><a
              id="id-1.14.5.11.18.4"
              class="indexterm"></a><a
              id="id-1.14.5.11.18.5"
              class="indexterm"></a><a
              id="id-1.14.5.11.18.6"
              class="indexterm"></a><div
              class="para">
					Isso pode ser usado para restringir acesso com base em muitos critérios; nós iremos parar na descrição de restrição de acesso com base no endereço IP de um cliente, mas isso pode ser feito de maneira muito mais poderosa, especialmente quando várias diretivas <code
                class="literal">Require</code> são combinadas dentro de um bloco <code
                class="literal">RequireAll</code>.
				</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.5.11.18.8"></a><p
                class="title"><strong>Exemplo 11.20. Apenas permite a partir da rede local</strong></p><div
                class="example-contents"><pre
                  class="programlisting">Require ip 192.168.0.0/16</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ALTERNATIVA</em></span> Sintaxe antiga</strong></p></div></div></div><div
                class="para">
					A sintaxe do <code
                  class="literal">Require</code> só está disponível no Apache 2.4 (a versão na <span
                  class="distribution distribution">Jessie</span>). Para usuários do <span
                  class="distribution distribution">Wheezy</span>, a sintaxe no Apache 2.2 é diferente, e nós a descrevemos aqui principalmente para referência, embora ela possa também ficar disponível no Apache 2.4 usando o môdulo<code
                  class="literal">mod_access_compat</code>.
				</div><div
                class="para">
					As diretivas <code
                  class="literal">Allow from</code> e <code
                  class="literal">Deny from</code> controlam as restrições de acesso em um diretório (e seus sub-diretórios, recursivamente).
				</div><a
                id="id-1.14.5.11.18.9.4"
                class="indexterm"></a><a
                id="id-1.14.5.11.18.9.5"
                class="indexterm"></a><a
                id="id-1.14.5.11.18.9.6"
                class="indexterm"></a><div
                class="para">
					A diretiva <code
                  class="literal">Order</code> informa ao servidor a ordem em que as diretivas <code
                  class="literal">Allow from</code> e <code
                  class="literal">Deny from</code> são aplicadas; A última que coincidir tem precedência. Em termos concretos, <code
                  class="literal">Order deny,allow</code> permite acesso se nenhum <code
                  class="literal">Deny from</code> se aplica, ou se uma diretiva <code
                  class="literal">Allow from</code> aplica. Por outro lado, <code
                  class="literal">Order allow,deny</code> rejeita acesso se nenhuma diretiva <code
                  class="literal">Allow from</code> coincide (ou se uma diretiva <code
                  class="literal">Deny from</code> se aplica).
				</div><div
                class="para">
					As diretivas <code
                  class="literal">Allow from</code> e <code
                  class="literal">Deny from</code> podem ser seguidas de um endereço IP, uma rede (como <code
                  class="literal">192.168.0.0/255.255.255.0</code>, <code
                  class="literal">192.168.0.0/24</code> ou mesmo <code
                  class="literal">192.168.0</code>), um nome de máquina ou nome de domínio, ou a palavra chave <code
                  class="literal">all</code>, designando todos.
				</div><div
                class="para">
					Por exemplo, para rejeitar conexões por padrão mas permití-las a partir da rede local, você poderia usar isso:
				</div><pre
                class="programlisting">
Order deny,allow
Allow from 192.168.0.0/16
Deny from all</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.12"></a>11.2.4. Analisadores de Log</h3></div></div></div><div
            class="para">
				Um analisador de log é frequentemente instalado em um servidor web; já que o primeiro fornece aos administradores uma ideia precisa do padrão de uso do último.
			</div><div
            class="para">
				Os administradores da Falcot Corp selecionaram o <span
              class="emphasis"><em>AWStats</em></span> (<span
              class="emphasis"><em>Advanced Web Statistics</em></span>) para analisar seus arquivos de log do Apache.
			</div><a
            id="id-1.14.5.12.4"
            class="indexterm"></a><a
            id="id-1.14.5.12.5"
            class="indexterm"></a><a
            id="id-1.14.5.12.6"
            class="indexterm"></a><a
            id="id-1.14.5.12.7"
            class="indexterm"></a><div
            class="para">
				O primeiro passo de configuração é a customização do arquivo <code
              class="filename">/etc/awstats/awstats.conf</code>. O administradores da Falcot o mantiveram inalterado, exceto os seguintes parâmetros:
			</div><pre
            class="programlisting">
LogFile="/var/log/apache2/access.log"
LogFormat = "%virtualname %host %other %logname %time1 %methodurl %code %bytesd %refererquot %uaquot"
SiteDomain="www.falcot.com"
HostAliases="falcot.com REGEX[^.*\.falcot\.com$]"
DNSLookup=1
LoadPlugin="tooltips"</pre><div
            class="para">
				Todos esses parâmetros são documentados através de comentários no arquivo de exemplo. Em particular, os parâmetros <code
              class="varname">LogFile</code> e <code
              class="varname">LogFormat</code> descrevem a localização e o formato do arquivo de log e a informação que ele contém; <code
              class="varname">SiteDomain</code> e <code
              class="varname">HostAliases</code> listam os vários nomes pelos quais o site web principal é conhecido.
			</div><div
            class="para">
				Para sites com alto tráfego, <code
              class="varname">DNSLookup</code> geralmente não deveria ser configurado como <code
              class="literal">1</code>; para sites menores, como o da Falcot descrito acima, essa configuração permite ter relatórios mais legíveis, que incluem o nome completo da máquina ao invés de simplesmente endereços IP.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SEGURANÇA</em></span> Acesso as estatísticas</strong></p></div></div></div><div
              class="para">
				O AWStats deixa suas estatísticas disponíveis no site web sem restrições por padrão, mas restrições podem ser configuradas para que apenas alguns endereços IP (provavelmente internos) possam ter acesso a elas; a lista de endereços IP com permissão precisa ser definida no parâmetro <code
                class="varname">AllowAccessFromWebToFollowingIPAddresses</code>
			</div></div><div
            class="para">
				O AWStats também será habilitado para outros hosts virtuais; cada host virtual precisa de um arquivo de configuração próprio como <code
              class="filename">/etc/awstats/awstats.www.falcot.org.conf</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.12.14"></a><p
              class="title"><strong>Exemplo 11.21. Arquivo de configuração dO AWStats para um servidor virtual</strong></p><div
              class="example-contents"><pre
                class="programlisting">
Include "/etc/awstats/awstats.conf"
SiteDomain="www.falcot.org"
HostAliases="falcot.org"</pre></div></div><div
            class="para">
				O AWStats usa muitos ícones que estão armazenados no diretório <code
              class="filename">/usr/share/awstats/icon/</code>. Para que esses ícones fiquem disponíveis no site web, a configuração do Apache precisa ser adaptada para incluir as seguintes diretivas:
			</div><pre
            class="programlisting">
Alias /awstats-icon/ /usr/share/awstats/icon/</pre><div
            class="para">
				Após alguns minutos (e uma vez que o script tenha sido rodado algumas vezes), os resultados ficarão disponíveis online: <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://www.falcot.com/cgi-bin/awstats.pl">http://www.falcot.com/cgi-bin/awstats.pl</a></div><div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://www.falcot.org/cgi-bin/awstats.pl">http://www.falcot.org/cgi-bin/awstats.pl</a></div>
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ATENÇÃO</em></span> Rotação dos arquivos de registro</strong></p></div></div></div><div
              class="para">
				Para que as estatísticas levem em consideração todos os logs, o <span
                class="emphasis"><em>AWStats</em></span> precisa ser executado antes que os arquivos de log do Apache sejam rotacionados. Olhando a diretiva <code
                class="literal">prerotate</code> do arquivo <code
                class="filename">/etc/logrotate.d/apache2</code>, isso pode ser resolvido colocando um link simbólico em <code
                class="filename">/usr/share/awstats/tools/update.sh</code> no <code
                class="filename">/etc/logrotate.d/httpd-prerotate</code>:
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>cat /etc/logrotate.d/apache2
</code></strong><code
                class="computeroutput">/var/log/apache2/*.log {
  daily
  missingok
  rotate 14
  compress
  delaycompress
  notifempty
  create 644 root adm
  sharedscripts
  postrotate
    if /etc/init.d/apache2 status &gt; /dev/null ; then \
      /etc/init.d/apache2 reload &gt; /dev/null; \
    fi;
  endscript
  prerotate
    if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
      run-parts /etc/logrotate.d/httpd-prerotate; \
    fi; \
  endscript
}
$ </code><strong
                class="userinput"><code>sudo mkdir -p /etc/logrotate.d/httpd-prerotate
</code></strong><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>sudo ln -sf /usr/share/awstats/tools/update.sh \
  /etc/logrotate.d/httpd-prerotate/awstats
</code></strong></pre><div
              class="para">
				Note também que os arquivos de log criados pelo <code
                class="command">logrotate</code> precisam ter permissão de leitura para todos, especialmente o AWStats. No exemplo acima, isso é garantido pela linha <code
                class="literal">create 644 root adm</code> (ao invés da permissão padrão <code
                class="literal">640</code>).
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="network-services.html"><strong>Anterior</strong>Capítulo 11. Serviços de Rede: Postfix, Apache, N...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Acima</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Principal</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.ftp-file-server.html"><strong>Próxima</strong>11.3. Servidor de Arquivos FTP</a></li></ul></body></html>
