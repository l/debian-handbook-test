<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">14.2. Firewall ou Filtragem de pacotes</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-pt-BR-1.0-1" /><meta
        name="keywords"
        content="Firewall, Netfilter, IDS/NIDS" /><link
        rel="home"
        href="index.html"
        title="O Manual do Administrador Debian" /><link
        rel="up"
        href="security.html"
        title="Capítulo 14. Segurança" /><link
        rel="prev"
        href="security.html"
        title="Capítulo 14. Segurança" /><link
        rel="next"
        href="sect.supervision.html"
        title="14.3. Supervisão: Prevenção, Detecção, Desencorajamento" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/pt-BR/stable/sect.firewall-packet-filtering.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>Anterior</strong></a></li><li
          class="home">O Manual do Administrador Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>Próxima</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.firewall-packet-filtering"></a>14.2. Firewall ou Filtragem de pacotes</h2></div></div></div><a
          id="id-1.17.5.2"
          class="indexterm"></a><a
          id="id-1.17.5.3"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>DE VOLTA AO BÁSICO</em></span> Firewall</strong></p></div></div></div><a
            id="id-1.17.5.4.2"
            class="indexterm"></a><div
            class="para">
			Um <span
              class="emphasis"><em>firewall</em></span> é uma peça de equipamento de informática com hardware e/ou software que classifica os pacotes de entrada ou saída de rede (chegando de ou indo para uma rede local) e só deixa passar aqueles satisfazendo certas condições pré-definidas.
		</div></div><div
          class="para">
			Um firewall é um portal de filtragem da saída de rede e é efetivo apenas em pacotes que devem passar por ele. Portanto, o firewall só será eficaz quando a única rota para estes pacotes for através dele.
		</div><div
          class="para">
			A falta de uma configuração padrão (e do lema "processo, e não produto") explica a falta de uma solução chave. Existem, no entanto, ferramentas que simplificam a configuração do firewall <span
            class="emphasis"><em>netfilter</em></span>, com uma representação gráfica das regras de filtragem. <code
            class="command">fwbuilder</code> está, sem dúvida, entre os melhores.
		</div><a
          id="id-1.17.5.7"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>CASO ESPECÍFICO</em></span> Firewall Local</strong></p></div></div></div><div
            class="para">
			Um firewall pode ser restrito a uma determinada máquina (em oposição a uma rede completa), caso em que seu papel é o de filtrar ou restringir o acesso a alguns serviços, ou possivelmente para evitar que as conexões de saída por softwares maliciosos que um usuário poderia, por vontade própria ou não, ter instalado.
		</div></div><div
          class="para">
			O kernel do Linux incorpora o firewall <span
            class="emphasis"><em>netfilter</em></span>. Ele pode ser controlado a partir do espaço do usuário com os comandos <code
            class="command">iptables</code> e <code
            class="command">ip6tables</code>. A diferença entre estes dois comandos é que o primeiro atua sobre rede IPv4, enquanto que o último sobre o IPv6. Uma vez que ambas pilhas de protocolo de rede provavelmente estarão circulando por muitos anos, ambas as ferramentas serão utilizadas em paralelo.
		</div><a
          id="id-1.17.5.10"
          class="indexterm"></a><a
          id="id-1.17.5.11"
          class="indexterm"></a><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.netfilter"></a>14.2.1. Funcionamento do Netfilter</h3></div></div></div><div
            class="para">
				<span
              class="emphasis"><em>netfilter</em></span> utiliza quatro tabelas distintas que armazenam regras que regulam três tipos de operações sobre pacotes:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">filtro</code> se ocupa das regras de filtragem (aceitando, recusando ou ignorando um pacote);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">nat</code> diz respeito a tradução de endereços e portas de origem ou destino de pacotes;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">mangle</code> diz respeito a outras alterações nos pacotes IP (incluindo campos e opções de ToS - <span
                    class="emphasis"><em>Tipo de Serviço</em></span>);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">raw</code> permite outras modificações manuais em pacotes antes deles chegarem ao sistema de rastreamento de conexões.
					</div></li></ul></div><div
            class="para">
				Cada tabela contém listas de regras chamadas <span
              class="emphasis"><em>cadeias</em></span>. O firewall usa cadeias padrão para lidar com pacotes com base em circunstâncias pré-definidas. O administrador pode criar outras cadeias, que só serão usadas quando referenciadas por uma das cadeias padrão (tanto direta quanto indiretamente).
			</div><a
            id="id-1.17.5.12.5"
            class="indexterm"></a><a
            id="id-1.17.5.12.6"
            class="indexterm"></a><div
            class="para">
				A tabela <code
              class="literal">filter (filtro)</code> possui três cadeias padrão:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">INPUT (ENTRADA)</code>: lida com os pacotes cujo destino é o próprio firewall;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">OUTPUT (SAÍDA)</code>: lida com os pacotes emitidos pelo firewall;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">FORWARD (REPASSAR)</code>: lida com os pacotes em trânsito através do firewall (que não é nem a sua origem nem o seu destino).
					</div></li></ul></div><div
            class="para">
				A tabela <code
              class="literal">nat</code> também tem três cadeias de padrão:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">PREROUTING (PRÉ ROTEAMENTO)</code>: altera pacotes assim que eles chegam;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">POSTROUTING (PÓS ROTEAMENTO)</code>: altera pacotes quando eles estão prontos para seguir seu caminho;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">OUTPUT (SAÍDA)</code>: altera pacotes gerados pelo próprio firewall.
					</div></li></ul></div><div
            class="figure"><a
              xmlns=""
              id="figure.chaines-netfilter"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/netfilter.png"
                  alt="Como cadeias netfilter são chamadas" /></div></div><p
              class="title"><strong>Figura 14.1. Como cadeias <span
                  class="emphasis"><em>netfilter</em></span> são chamadas</strong></p></div><div
            class="para">
				Cada cadeia é uma lista de regras, cada regra é um conjunto de condições e uma ação a ser executada quando as condições forem satisfeitas. Ao processar um pacote, o firewall examina a correspondente, uma regra após a outra; quando as condições para uma regra são satisfeitas, "pula" (daí a opção <code
              class="literal">-j </code>, de jump, nos comandos) para a especificada ação para continuar o processamento. Os comportamentos mais comuns são padronizados, e existem ações específicas para eles. fazer uma destas ações padrão interrompe o processamento da cadeia, já que o destino do pacote já está selado (salvo uma exceção mencionada a seguir):
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DE VOLTA AO BÁSICO</em></span> ICMP</strong></p></div></div></div><div
              class="para">
				ICMP (<span
                class="emphasis"><em>Internet Control Message</em></span> Protocol) é o protocolo usado para transmitir informações complementares sobre as comunicações. Permite testar a conectividade de rede com o comando <code
                class="command">ping</code> (que envia uma mensagem ICMP <span
                class="emphasis"><em>echo request</em></span> (solicitação de eco), que o destinatário deve responder com uma mensagem ICMP <span
                class="emphasis"><em>echo reply</em></span>) (resposta echo). Ele sinaliza quando um firewall está rejeitando um pacote, indica um estouro de memoria no buffer de recebimento, propõe uma melhor rota para os pacotes seguintes na conexão, e assim por diante. Este protocolo é definido por vários documentos RFC, o inicial RFC777 e RFC792 logo foram concluídos e ampliados. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc777.html">http://www.faqs.org/rfcs/rfc777.html</a></div> <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc792.html">http://www.faqs.org/rfcs/rfc792.html</a></div>
			</div><div
              class="para">
				Para referência, um buffer de recepção é uma pequena região de memória para armazenamento de dados entre o tempo que chega na rede e o tempo que o kernel o manipula. Se esta região está cheia, os novos dados não podem ser recebidos, e o ICMP sinaliza o problema, de modo que o emissor possa diminuir a sua taxa de transferência (que deve, idealmente, chegar a um equilíbrio após algum tempo).
			</div><a
              id="id-1.17.5.12.13.4"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.5"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.6"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.7"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.8"
              class="indexterm"></a><div
              class="para">
				Observe que, embora uma rede IPv4 possa funcionar sem ICMP, ICMPv6 é estritamente necessário para uma rede IPv6, uma vez que combina várias funções que eram, no mundo IPv4, espalhados por ICMPv4, IGMP (<span
                class="emphasis"><em>Internet Group Membership Protocol</em></span>) e ARP (<span
                class="emphasis"><em>Address Resolution Protocol</em></span>). ICMPv6 é definido na RFC4443. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc4443.html">http://www.faqs.org/rfcs/rfc4443.html</a></div>
			</div></div><div
            class="para">
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ACCEPT</code>: permite que o pacote siga seu caminho;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">REJECT</code>: rejeita o pacote com um erro ICMP (a opção <code
                    class="literal">--reject-with<em
                      class="replaceable">tipo</em></code> para <code
                    class="command">iptables</code> permite seleccionar o tipo de erro);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DROP</code>: apaga (ignora) o pacote;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">LOG</code>: loga (via <code
                    class="command">syslogd</code>) uma mensagem com uma descrição do pacote; observe que esta ação não interrompe o processamento, e a execução da cadeia continua na próxima regra, razão pela qual logar pacotes recusados exige tanto uma regra LOG quando uma regra REJECT/DROP;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ULOG</code>: loga uma mensagem via <code
                    class="command">ulogd</code>, que pode ser melhor adaptado e mais eficiente que o <code
                    class="command">syslogd</code> para lidar com um grande número de mensagens; observe que esta ação, como LOG, também retorna o processamento para a próxima regra na cadeia chamada;
					</div></li><li
                class="listitem"><div
                  class="para">
						<em
                    class="replaceable">chain_name</em>: Vai para a cadeia dada e processa as suas regras;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">RETURN</code>: interrompe o processamento da cadeia atual, e volta para a cadeia chamada; no caso da cadeia atual ser uma das padrão, não há nenhuma cadeia de chamada, de modo que a ação padrão (definida com a opção <code
                    class="literal">-P</code> para o <code
                    class="command">iptables</code>) é executada em vez disto;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SNAT</code> (apenas na tabela <code
                    class="literal">nat</code>): aplica <span
                    class="emphasis"><em>Source NAT</em></span> (opções extras descrevem as alterações exatas para aplicar);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DNAT</code> (apenas na tabela <code
                    class="literal">nat</code>): aplica <span
                    class="emphasis"><em>Destination NAT</em></span> (opções extras descrevem as alterações exatas para aplicar);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">MASQUERADE</code> (apenas na tabela <code
                    class="literal">nat</code>): aplica <span
                    class="emphasis"><em>masquerading</em></span> (um caso especial de <span
                    class="emphasis"><em>Source (origem) NAT</em></span>);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">REDIRECT</code> (apenas na tabela <code
                    class="literal">nat</code>): redireciona um pacote para uma determinada porta do firewall, isto pode ser usado para configurar um proxy web transparente que funciona sem nenhuma configuração no lado do cliente, uma vez que o cliente pensa que ele se conecta ao destinatário e as comunicações realmente passam pelo proxy.
					</div></li></ul></div><div
            class="para">
				Outras ações, particularmente as relativas à tabela <code
              class="literal">mangle</code>, estão fora do escopo deste texto. O <span
              class="citerefentry"><span
                class="refentrytitle">iptables</span>(8)</span> e <span
              class="citerefentry"><span
                class="refentrytitle">ip6tables</span>(8)</span> tem um lista completa.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.iptables"></a>14.2.2. Sintaxe do <code
                    class="command">iptables</code> e do <code
                    class="command">ip6tables</code></h3></div></div></div><div
            class="para">
				Os comandos <code
              class="command">iptables</code> e <code
              class="command">ip6tables</code> permitem manipulação de tabelas, cadeias e regrass. Sua opção <code
              class="literal"><em
                class="replaceable">tabela</em> -t</code> indica em qual tabela operar (por padrão, <code
              class="literal">filtro</code>).
			</div><a
            id="id-1.17.5.13.3"
            class="indexterm"></a><a
            id="id-1.17.5.13.4"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.iptables-command"></a>14.2.2.1. Comandos</h4></div></div></div><div
              class="para">
					A opção <code
                class="literal">-N <em
                  class="replaceable">cadeia</em></code> cria uma nova cadeia. A <code
                class="literal">-X <em
                  class="replaceable">cadeia</em></code> exclui uma cadeia vazia e sem uso. A <code
                class="literal">-A <em
                  class="replaceable">cadeia</em> <em
                  class="replaceable">regra</em></code> adiciona uma regra no final da cadeia dada. A opção <code
                class="literal">-I <em
                  class="replaceable">cadeia</em> <em
                  class="replaceable">número_regra</em> <em
                  class="replaceable">regra</em></code> insere uma regra antes da regra número <em
                class="replaceable">número_regra</em>. A opção <code
                class="literal">-D <em
                  class="replaceable">cadeia</em> <em
                  class="replaceable">número_regra</em></code> (ou <code
                class="literal">-D <em
                  class="replaceable">cadeia</em> <em
                  class="replaceable">regra</em></code>) remove uma regra na cadeia, a primeira sintaxe identifica a regra a ser removida pelo seu número, enquanto o segundo o identifica pelo seu conteúdo. A opção <code
                class="literal">-F <em
                  class="replaceable">cadeia</em></code> esvazia uma cadeia (remove todas suas regras); se nenhuma cadeia é mencionada, todas as regras da tabela são removidas. A opção <code
                class="literal">-L <em
                  class="replaceable">cadeia</em></code> lista as regras na cadeia. Finalmente, a opção <code
                class="literal">-P <em
                  class="replaceable">cadeia</em> <em
                  class="replaceable">ação</em></code> define a ação padrão, ou "política", para uma dada cadeia; observe que apenas as cadeias padrão podem ter essa política.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.iptables-rules"></a>14.2.2.2. Regras</h4></div></div></div><a
              id="id-1.17.5.13.6.2"
              class="indexterm"></a><div
              class="para">
					Cada regra é expressa como <code
                class="literal"><em
                  class="replaceable">condições</em> -j <em
                  class="replaceable">ação</em> <em
                  class="replaceable">opcoes_acoes</em></code>. Se várias condições são descritas na mesma regra, então o critério é a conjunção (lógica <span
                class="emphasis"><em>e</em></span>) das condições, que é pelo menos tão restritiva quanto cada condição individual.
				</div><div
              class="para">
					A condição <code
                class="literal">-p <em
                  class="replaceable">protocolo</em></code> corresponde ao campo protocolo do pacote IP. Os valores mais comuns são <code
                class="literal">tcp</code>, <code
                class="literal">udp</code>, <code
                class="literal">icmp</code>, e <code
                class="literal">ICMPv6</code>. Prefixando a condição com um ponto de exclamação nega a condição, que se transforma numa correspondência para "todos os pacotes com um protocolo diferente da especificada". Este mecanismo de negação não é específico para a opção <code
                class="literal">-p</code> e também pode ser aplicada a todas outras condições.
				</div><div
              class="para">
					A condição <code
                class="literal">-s <em
                  class="replaceable">endereço</em></code> ou <code
                class="literal">-s <em
                  class="replaceable">rede/máscara</em></code> corresponde o endereço de origem do pacote. Do mesmo modo, <code
                class="literal">-d <em
                  class="replaceable">endereço</em></code> ou <code
                class="literal">-d <em
                  class="replaceable">rede/máscara</em></code> corresponde o endereço de destino.
				</div><div
              class="para">
					A condicao <code
                class="literal">-i <em
                  class="replaceable">interface</em></code> seleciona os pacotes provenientes da interface de rede. <code
                class="literal">-o <em
                  class="replaceable">interface</em></code> seleciona pacotes saindo em uma interface específica.
				</div><div
              class="para">
					Existem condições mais específicas, dependendo das condições genéricas acima descritas. Por exemplo, a condição <code
                class="literal">-p TCP</code> pode ser complementada com condições sobre as portas TCP, com cláusulas como <code
                class="literal">-- porta-origem <em
                  class="replaceable">porta</em></code> e <code
                class="literal">--porta-destino <em
                  class="replaceable">porta</em></code>.
				</div><div
              class="para">
					A condição <code
                class="literal">--estado <em
                  class="replaceable">estado</em></code> corresponde ao estado de um pacote em uma conexão (isto requer o módulo <code
                class="command">ipt_conntrack</code> do kernel, para rastreamento de conexões). O estado <code
                class="literal">NEW</code> descreve um pacote iniciando uma nova conexão; O pacote <code
                class="literal">ESTABLISHED</code> corresponde aos pacotes pertencentes a uma conexão já existente, e <code
                class="literal">RELATED</code> correspondem aos pacotes iniciando uma nova conexão relacionada a um já existente (o que é útil para as conexões <code
                class="literal">ftp-data</code> no modo "active" do protocolo FTP).
				</div><div
              class="para">
					A seção anterior lista as ações disponíveis, mas não suas respectivas opções. A ação <code
                class="literal">LOG</code>, por exemplo, tem as seguintes opções:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-priority</code>, com valor padrão <code
                      class="literal">warning</code> (aviso), indica o nível de severidade do <code
                      class="command">syslog</code>;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-prefix</code> permite especificar um prefixo de texto para diferenciar mensagens registradas;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-tcp-sequence</code>, <code
                      class="literal">--log-tcp-options</code> e <code
                      class="literal">--log-ip-options</code> indicam dados extras a serem integrados na mensagem: respectivamente, o número de seqüência TCP, opções TCP, e as opções IP.
						</div></li></ul></div><div
              class="para">
					A acao <code
                class="literal">DNAT</code> fornece a <code
                class="literal">--to-destination <em
                  class="replaceable">endereço</em>: opção <em
                  class="replaceable">porta</em></code> para indicar o novo endereço IP de destino e/ou porta. Da mesma forma, <code
                class="literal">SNAT</code> fornece <code
                class="literal">--to-source <em
                  class="replaceable">endereço</em>:<em
                  class="replaceable">porta</em></code> para indicar o novo endereço IP de origem e/ou porta.
				</div><div
              class="para">
					A ação <code
                class="literal">REDIRECT</code> (disponível apenas se o NAT está disponível) fornece a opção <code
                class="literal">--to-ports <em
                  class="replaceable">porta(s)</em></code> para indicar a porta, ou intervalo de portas, para onde os pacotes devem ser redirecionados.
				</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.creating-rules"></a>14.2.3. Criando Regras</h3></div></div></div><div
            class="para">
				Cada criação de regra exige uma invocação de <code
              class="command">iptables</code>/<code
              class="command">ip6tables</code>. Digitando estes comandos manualmente pode ser tedioso, por isso as chamadas são normalmente armazenados em um script para que a mesma configuração seja criada automaticamente a cada vez que a máquina inicia. Este script pode ser escrito à mão, mas também pode ser interessante prepará lo com uma ferramenta de alto nível, tais como <code
              class="command">fwbuilder</code>.
			</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>apt install fwbuilder</code></strong></pre><div
            class="para">
				O princípio é simples. Na primeira etapa, é preciso descrever todos os elementos que estarão envolvidos nas atuais regras:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						o firewall, com suas interfaces de rede;
					</div></li><li
                class="listitem"><div
                  class="para">
						as redes, com suas faixas de IP correspondentes;
					</div></li><li
                class="listitem"><div
                  class="para">
						os servidores;
					</div></li><li
                class="listitem"><div
                  class="para">
						as portas que pertencem aos serviços hospedados nos servidores.
					</div></li></ul></div><div
            class="para">
				As regras são então criadas com simples ações de arrastar-e-soltar nos objetos. Alguns menus contextuais podem alterar a condição (negando o, por exemplo). Em seguida, a ação deve ser escolhida e configurada.
			</div><div
            class="para">
				Quanto IPv6 está ativo, pode se criar dois conjuntos de regras distintas para IPv4 e IPv6, ou criar uma só e deixar <code
              class="command">fwbuilder</code> traduzir as regras de acordo com os endereços atribuídos aos objetos.
			</div><div
            class="figure"><a
              xmlns=""
              id="figure.fwbuilder"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/fwbuilder.png"
                  alt="janela principal do Fwbuilder" /></div></div><p
              class="title"><strong>Figura 14.2. janela principal do Fwbuilder</strong></p></div><a
            id="id-1.17.5.14.9"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">fwbuilder</code> pode gerar um script de configuração do firewall de acordo com as regras que foram definidas. Sua arquitetura modular lhe confere a capacidade de gerar scripts que visam diferentes sistemas (<code
              class="command">iptables</code> para Linux, <code
              class="command">ipf</code> para o FreeBSD e <code
              class="command">pf</code> para OpenBSD).
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.install-rules-at-boot"></a>14.2.4. Instalando as Regras em cada inicializacao</h3></div></div></div><div
            class="para">
				Em outros casos, a maneira recomendada é registrar o script de configuração em uma directiva <code
              class="literal">up</code> do <code
              class="filename">/etc/network/interfaces</code>. No exemplo a seguir, o script é armazenado em <code
              class="filename">/usr/local/etc/arrakis.fw</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="example.network-interfaces-firewall"></a><p
              class="title"><strong>Exemplo 14.1. arquivo <code
                  class="filename">interfaces</code> chamando script firewall</strong></p><div
              class="example-contents"><pre
                class="programlisting">auto eth0
iface eth0 inet static
    address 192.168.0.1
    network 192.168.0.0
    netmask 255.255.255.0
    broadcast 192.168.0.255
    up /usr/local/etc/arrakis.fw</pre></div></div><div
            class="para">
				Isso obviamente assume que você está usando o <span
              class="pkg pkg">ifupdown</span> para configurar as interfaces de rede. Se você está usando algo diferente (como o <span
              class="emphasis"><em>NetworkManager</em></span> ou <span
              class="emphasis"><em>systemd-networkd</em></span>), então referêncie suas respectivas documentações para encontrar maneiras de executar um script após a interface ter sido levantada.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>Anterior</strong>Capítulo 14. Segurança</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Acima</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Principal</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>Próxima</strong>14.3. Supervisão: Prevenção, Detecção, Desencoraj...</a></li></ul></body></html>
