<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.5. Configurando um Compartilhamento Windows com o Samba</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-pt-BR-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="O Manual do Administrador Debian" /><link
        rel="up"
        href="network-services.html"
        title="Capítulo 11. Serviços de Rede: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="sect.nfs-file-server.html"
        title="11.4. Servidor de Arquivos NFS" /><link
        rel="next"
        href="sect.http-ftp-proxy.html"
        title="11.6. Proxy HTTP/FTP" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/pt-BR/stable/sect.windows-file-server-with-samba.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.nfs-file-server.html"><strong>Anterior</strong></a></li><li
          class="home">O Manual do Administrador Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.http-ftp-proxy.html"><strong>Próxima</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.windows-file-server-with-samba"></a>11.5. Configurando um Compartilhamento Windows com o Samba</h2></div></div></div><div
          class="para">
			O Samba é um conjunto de ferramentas para lidar com o protocolo SMB (também conhecido como “CIFS”) no Linux. Esse protocolo é usado pelo Windows para compartilhamento de rede e impressoras compartilhadas.
		</div><a
          id="id-1.14.8.3"
          class="indexterm"></a><a
          id="id-1.14.8.4"
          class="indexterm"></a><a
          id="id-1.14.8.5"
          class="indexterm"></a><a
          id="id-1.14.8.6"
          class="indexterm"></a><a
          id="id-1.14.8.7"
          class="indexterm"></a><div
          class="para">
			Samba também pode atuar como um controlador de domínio Windows. Esta é uma excelente ferramenta para garantir a perfeita integração de servidores Linux e as máquinas desktop de escritório ainda com o Windows.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.8.9"></a>11.5.1. Servidor Samba</h3></div></div></div><div
            class="para">
				O pacote <span
              class="pkg pkg">samba</span> contém os dois principais servidores do Samba 4, <code
              class="command">smbd</code> e <code
              class="command">nmbd</code>.
			</div><a
            id="id-1.14.8.9.3"
            class="indexterm"></a><a
            id="id-1.14.8.9.4"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DOCUMENTAÇÃO</em></span> Aprofundando</strong></p></div></div></div><div
              class="para">
				O servidor Samba é extremamente configurável e versátil, e pode se adaptar a um grande número de casos de uso diferentes se encaixando em muitos requerimentos e arquiteturas de rede diferentes. Esse livro apenas foca no caso de uso aonde o Samba é usado como servidor autônomo, mas ele também pode ser um Controlador de Domínio NT4 ou um completo Controlador de Domínio de Diretório Ativo ("Active Directory Domain Controller"), ou um simples membro de um domínio existente (o qual poderia ser gerenciado po um servidor Windows).
			</div><a
              id="id-1.14.8.9.5.3"
              class="indexterm"></a><a
              id="id-1.14.8.9.5.4"
              class="indexterm"></a><div
              class="para">
				O pacote <span
                class="pkg pkg">samba-doc</span> contém, com riqueza de comentários, arquivos de exemplo em <code
                class="filename">/usr/share/doc/samba-doc/examples/</code>.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>FERRAMENTA</em></span> Autenticando com um Servidor Windows</strong></p></div></div></div><div
              class="para">
				Winbind dá aos administradores de sistema a opção de usar um servidor Windows como um servidor de autenticação. Winbind também se integra de forma limpa com PAM e NSS. Isso permite configurar máquinas Linux aonde todos os usuários de um domínio Windows automaticamente tenham uma conta.
			</div><a
              id="id-1.14.8.9.6.3"
              class="indexterm"></a><div
              class="para">
				Mais informações podem ser obtidas no diretório <code
                class="filename">/usr/share/doc/samba-doc/examples/pam_winbind/</code>.
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.9.7"></a>11.5.1.1. Configurando com <code
                      class="command">debconf</code></h4></div></div></div><div
              class="para">
					O pacote realiza uma configuração mínima durante a instalação inicial mas você realmente deve rodar <code
                class="command">dpkg-reconfigure samba-common</code> para adaptá-la:
				</div><div
              class="para">
					O primeiro item de informação necessária é o nome do grupo de trabalho ("workgroup") ao qual o servidor Samba pertencerá (a resposta é <code
                class="literal">FALCOTNET</code> em nosso caso).
				</div><div
              class="para">
					O pacote também propõe a identificação do servidor WINS a partir da informação fornecida pelo daemon DHCP. Os administradores da Falcot Corp rejeitaram essa opção, já que eles tem a intenção de usar o próprio servidor Samba como um servidor WINS.
				</div><a
              id="id-1.14.8.9.7.5"
              class="indexterm"></a></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.9.8"></a>11.5.1.2. Configurando Manualmente</h4></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.14.8.9.8.2"></a>11.5.1.2.1. Mudanças no <code
                        class="filename">smb.conf</code></h5></div></div></div><div
                class="para">
						Os requerimentos na Falcot fazem necessário que outras opção sejam modificadas no arquivo de configuração <code
                  class="filename">/etc/samba/smb.conf</code>. O trecho a seguir resumem as alterações que foram feitas na seção <code
                  class="literal">[global]</code>.
					</div><pre
                class="programlisting">
[global]

## Browsing/Identification ###

# Change this to the workgroup/NT-domain name your Samba server will part of
   workgroup = FALCOTNET

# Windows Internet Name Serving Support Section:
# WINS Support - Tells the NMBD component of Samba to enable its WINS Server
   wins support = yes <span
                  id="smb.conf.wins"><img
                    class="callout"
                    src="Common_Content/images/1.png"
                    alt="1" /></span>

[...]

####### Authentication #######

# Server role. Defines in which mode Samba will operate. Possible
# values are "standalone server", "member server", "classic primary
# domain controller", "classic backup domain controller", "active
# directory domain controller". 
#
# Most people will want "standalone sever" or "member server".
# Running as "active directory domain controller" will require first
# running "samba-tool domain provision" to wipe databases and create a
# new domain.
   server role = standalone server

# "security = user" is always a good idea. This will require a Unix account
# in this server for every user accessing the server.
   security = user <span
                  id="smb.conf.security"><img
                    class="callout"
                    src="Common_Content/images/2.png"
                    alt="2" /></span>

[...]</pre><div
                class="calloutlist"><table
                  border="0"
                  summary="Callout list"><tr><td
                      width="5%"
                      valign="top"
                      align="left"><p><a
                          href="#smb.conf.wins"><img
                            class="callout"
                            src="Common_Content/images/1.png"
                            alt="1" /></a> </p></td><td
                      valign="top"
                      align="left"><div
                        class="para">
								Indica que o Samba deveria atuar como um servidor de nomes Netbios (WINS) para a rede local.
							</div></td></tr><tr><td
                      width="5%"
                      valign="top"
                      align="left"><p><a
                          href="#smb.conf.security"><img
                            class="callout"
                            src="Common_Content/images/2.png"
                            alt="2" /></a> </p></td><td
                      valign="top"
                      align="left"><div
                        class="para">
								Esse é o valor padrão para esse parâmetro; contudo, como ele é central para a configuração do Samba, o recomendado é preenchê-lo explicitamente. cada usuário tem que se autenticar antes de acessar qualquer compartilhamento.
							</div></td></tr></table></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.14.8.9.8.3"></a>11.5.1.2.2. Adicionando Usuários</h5></div></div></div><div
                class="para">
						Cada usuário do Samba precisa ter uma conta no servidor; as contas Unix tem que ser criadas primeiro, depois o usuário precisa ser registrado no banco de dados do Samba. O passo no Unix é feito bem facilmente (usando o <code
                  class="command">adduser</code> por exemplo).
					</div><div
                class="para">
						Adicionar um usuário existente ao banco de dados do Samba é uma questão de rodar o comando <code
                  class="command">smbpasswd -a <em
                    class="replaceable">usuário</em></code>; esse comando pergunta pela senha interativamente.
					</div><div
                class="para">
						Um usuário pode ser apagado com o comando <code
                  class="command">smbpasswd -x <em
                    class="replaceable">usuário</em></code>. Uma conta Samba também pode ser temporariamente desabilitada (com <code
                  class="command">smbpasswd -d <em
                    class="replaceable">usuário</em></code>) e reabilitada mais tarde (com <code
                  class="command">smbpasswd -e <em
                    class="replaceable">usuário</em></code>).
					</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.8.10"></a>11.5.2. Cliente Samba</h3></div></div></div><div
            class="para">
				Os recursos do cliente no Samba permitem que uma máquina Linux acesse compartilhamentos Windows e impressoras compartilhadas. Os programas necessários estão disponíveis nos pacotes <span
              class="pkg pkg">cifs-utils</span> e <span
              class="pkg pkg">smbclient</span>.
			</div><a
            id="id-1.14.8.10.3"
            class="indexterm"></a><a
            id="id-1.14.8.10.4"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.10.5"></a>11.5.2.1. O Programa <code
                      class="command">smbclient</code></h4></div></div></div><div
              class="para">
					O programa <code
                class="command">smbclient</code> consulta servidores SMB. Ele aceita a opção <code
                class="literal">-U <em
                  class="replaceable">usuário</em></code>, para conectar em um servidor sob uma identidade específica. <code
                class="command">smbclient //<em
                  class="replaceable">servidor</em>/<em
                  class="replaceable">compartilhamento</em></code> acessa o compartilhamento de maneira interativa, similar a linha de comando de um cliente FTP. <code
                class="command">smbclient -L <em
                  class="replaceable">servidor</em></code> lista todos os compartilhamentos disponíveis (e visíveis) em um servidor.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.10.6"></a>11.5.2.2. Montando Compartilhamentos Windows</h4></div></div></div><div
              class="para">
					O comando <code
                class="command">mount</code> permite montar um compartilhamento Windows na hierarquia do sistema de arquivos do Linux (com a ajuda do <code
                class="command">mount.cifs</code> fornecido pelo <span
                class="pkg pkg">cifs-utils</span>).
				</div><a
              id="id-1.14.8.10.6.3"
              class="indexterm"></a><a
              id="id-1.14.8.10.6.4"
              class="indexterm"></a><div
              class="example"><a
                xmlns=""
                id="id-1.14.8.10.6.5"></a><p
                class="title"><strong>Exemplo 11.24. Montando um compartilhamento Windows</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
mount -t cifs //arrakis/shared /shared \
      -o credentials=/etc/smb-credentials</pre></div></div><div
              class="para">
					O arquivo <code
                class="filename">/etc/smb-credentials</code> (o qual não deve ser legível pelos usuários) tem o seguinte formato:
				</div><pre
              class="programlisting">
username = <em
                class="replaceable">user</em>
password = <em
                class="replaceable">password</em></pre><div
              class="para">
					Outras opções podem ser especificadas pela linha de comando; sua lista completa está disponível na página de manual <span
                class="citerefentry"><span
                  class="refentrytitle">mount.cifs</span>(1)</span>. Duas opções em particular podem ser interessantes: <code
                class="literal">uid</code> e <code
                class="literal">gid</code> permitem forçar o dono e grupo dos arquivos disponíveis na montagem, de modo a não restringir o acesso para o root.
				</div><div
              class="para">
					A montagem de um compartilhamento Windows também pode ser configurada em <code
                class="filename">/etc/fstab</code>:
				</div><pre
              class="programlisting">
//<em
                class="replaceable">servidor</em>/shared /shared cifs credentials=/etc/smb-credentials</pre><div
              class="para">
					Desmontando um compartilhamento SMB/CIFS é feito com o comando padrão <code
                class="command">umount</code>.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.10.7"></a>11.5.2.3. Imprimindo com uma Impressora Compartilhada</h4></div></div></div><div
              class="para">
					CUPS é uma solução elegante para impressão a partir de uma estação de trabalho Linux em uma impressora compartilhada por uma máquina Windows. Quando o <span
                class="pkg pkg">smbclient</span> está instalado, o CUPS permite a instalação de impressoras Windows compartilhadas automaticamente.
				</div><a
              id="id-1.14.8.10.7.3"
              class="indexterm"></a><div
              class="para">
					Aqui estão os passos necessários:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							Entre na interface de configuração do CUPS: <code
                      class="literal">http://localhost:631/admin</code>
						</div></li><li
                  class="listitem"><div
                    class="para">
							Clique em "Adicionar Impressora".
						</div></li><li
                  class="listitem"><div
                    class="para">
							Selecione o dispositivo de impressora, escolha “Impressora Windows via SAMBA”.
						</div></li><li
                  class="listitem"><div
                    class="para">
							Insira a conexão URI para a impressora de rede. Deve se parecer com o seguinte:
						</div><div
                    class="para">
							<code
                      class="literal">smb://<em
                        class="replaceable">usuário</em>:<em
                        class="replaceable">senha</em>@<em
                        class="replaceable">servidor</em>/<em
                        class="replaceable">impressora</em></code>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							Digite o nome que irá identificar de maneira única essa impressora. Em seguida digite a descrição e localização da impressora. Essas são as cadeias de caracteres que irão ser mostradas aos usuários finais para ajudá-los a identificar as impressoras.
						</div></li><li
                  class="listitem"><div
                    class="para">
							Indicar o fabricante/modelo da impressora, ou fornecer diretamente um arquivo funcional de descrição da impressora (PPD).
						</div></li></ul></div><div
              class="para">
					Voilà, a impressora está operacional!
				</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.nfs-file-server.html"><strong>Anterior</strong>11.4. Servidor de Arquivos NFS</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Acima</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Principal</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.http-ftp-proxy.html"><strong>Próxima</strong>11.6. Proxy HTTP/FTP</a></li></ul></body></html>
