<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">8.10. Компиляция Ядра</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-ru-RU-1.0-1" /><meta
        name="keywords"
        content="Конфигурация, Локализация, Локали, Сеть, Разрешение имён, Пользователи, Группы, Аккаунты, Интерпретатор командной строки, Оболочка, Печать, Загрузчик, Компиляция ядра" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="basic-configuration.html"
        title="Глава 8. Базовая конфигурация: Сеть, Аккаунты, Печать..." /><link
        rel="prev"
        href="sect.config-misc.html"
        title="8.9. Другие настройки: Синхронизация времени, Журналы, Разделение Доступа…" /><link
        rel="next"
        href="sect.kernel-installation.html"
        title="8.11. Установка ядра" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ru-RU/stable/sect.kernel-compilation.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.config-misc.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.kernel-installation.html"><strong>След.</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.kernel-compilation"></a>8.10. Компиляция Ядра</h2></div></div></div><a
          id="id-1.11.14.2"
          class="indexterm"></a><a
          id="id-1.11.14.3"
          class="indexterm"></a><div
          class="para">
			Включаемые в дистибутивы Debian ядра содержат в себе максимально количество функциональных возможностей, а также максимум драйверов. В результате этого становится возможным с помощью ядра настроить как можно больше аппаратных устройств уже на стадии установки, загрузки и дальнейшей эксплуатации системы (которые могут быть установлены на компьютерах пользователей. Большинство их такая ситуация устраивает - максимально опознаются аппаратные средства, а расточительное использование ресурсов компьютера для них не критично). Но некоторые предпочитают перекомпилировать (пересобрать) ядро, включив в них только то, что им действительно нужно. Для такого подхода имеются две причины. Первая - возможность оптимизации использования физической памяти (RAM) поскольку код ядра постоянно находится в ней (и никогда не “выгружается”, даже часть его, на файл подкачки). Избыточное использование ядром физической памяти (а она недёшева, и её часто не хватает на компьютерах пользователей) может уменьшить общую производительность системы. Вторая причина - локально скомпилированные ядра помогут снизить риск проблем безопасности. За счёт исключения ненужного (только незначительное количество кода ядра будет включено в состав ядра, скомпилировано и в дальнейшем выполняться) в конечном итоге повысится защищённость и производительность системы.
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>ЗАМЕТКА</em></span> Обновления Системы Безопасности</strong></p></div></div></div><div
            class="para">
			Если вы решитесь скомпилировать собственную версию ядра, вы должны понимать (и принимать) последствия, к которым это вас приведёт: Debian не сможет гарантировать обновления системы безопасности для вашего самосборного ядра. И напротив, сохраняя (и используя) ядро, поддерживаемое Debian, вы получите пользу от таких обновлений, подготовливаемых регулярно командой безопасности Проекта Debian.
		</div></div><div
          class="para">
			Перекомпиляция ядра необходима также, если вы хотите использовать некоторые особенности, которые доступны только как заплатки (и не включены в стандартную версию ядра).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Настольная Книга по Ядру Debian</strong></p></div></div></div><a
            id="id-1.11.14.7.2"
            class="indexterm"></a><div
            class="para">
			The Debian kernel teams maintains the “Debian Kernel Handbook” (also available in the <span
              class="pkg pkg">debian-kernel-handbook</span> package) with comprehensive documentation about most kernel related tasks and about how official Debian kernel packages are handled. This is the first place you should look into if you need more information than what is provided in this section. <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="https://kernel-team.pages.debian.net/kernel-handbook/">https://kernel-team.pages.debian.net/kernel-handbook/</a></div>
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.kernel-compilation-prerequisites"></a>8.10.1. Введение и предпосылки</h3></div></div></div><div
            class="para">
				Неудивительно, что в Debian управление ядром организовано в виде готового пакета, а не как ранее - традиционная компиляция и устанавка вручную. Поскольку ядро (в составе пакета) всегда остается под контролем системы управления пакетами, то удаление или установка ядра на одной, или на нескольких машинах сразу, выполняется чисто. Кроме того, в пакетах кроме ядра имеются ещё и сценарии, автоматизирующие процесс подключения устанавливаемого ядра в загрузчик и создающие образ initrd для загрузки.
			</div><div
            class="para">
				Скачиваемый из хранилища Debian пакет с исходным кодом ядра Linux содержит в себе всё необходимое для построения Debian пакета, включающего в себя скомпилированное вами ядро. Но кроме этого, рекомендуется проверить установлены ли у вас пакеты вспомогательного назначения (которые необходимо доустановить, если они отсутствуют в вашей системе). К ним относятся: 1) пакет <span
              class="pkg pkg">build-essential</span>. 2) Для этапа конфигурирования ядра нужен пакет <span
              class="pkg pkg">libncurses5-dev</span>. 3) С помощью пакета <span
              class="pkg pkg">fakeroot</span> создаются условия сборки Debian пакета не прибегая к правам администратора.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>КУЛЬТУРА</em></span> Старые добрые времена пакета <span
                        class="pkg pkg">kernel-package</span></strong></p></div></div></div><a
              id="id-1.11.14.8.4.2"
              class="indexterm"></a><div
              class="para">
				Ранее рекомендованным способом сборки пакетов было использование программы <code
                class="command">make-kpkg</code> из пакета <span
                class="pkg pkg">kernel-package</span>. В настоящее время у системы построения пакетов Linux уже появилась возможность создания пакетов Debian надлежащего качества.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.kernel-sources"></a>8.10.2. Получение исходного кода</h3></div></div></div><a
            id="id-1.11.14.9.2"
            class="indexterm"></a><a
            id="id-1.11.14.9.3"
            class="indexterm"></a><a
            id="id-1.11.14.9.4"
            class="indexterm"></a><div
            class="para">
				Like anything that can be useful on a Debian system, the Linux kernel sources are available in a package. To retrieve them, just install the <span
              class="pkg pkg">linux-source-<em
                class="replaceable">version</em></span> package. The <code
              class="command">apt search ^linux-source</code> command lists the various kernel versions packaged by Debian. The latest version is available in the <span
              class="distribution distribution">Unstable</span> distribution: you can retrieve them without much risk (especially if your APT is configured according to the instructions of <a
              class="xref"
              href="sect.apt-get.html#sect.apt-mix-distros">Раздел 6.2.6, «Работа с отдельными дистрибутивами»</a>). Note that the source code contained in these packages does not correspond precisely with that published by Linus Torvalds and the kernel developers; like all distributions, Debian applies a number of patches, which might (or might not) find their way into the upstream version of Linux. These modifications include backports of fixes/features/drivers from newer kernel versions, new features not yet (entirely) merged in the upstream Linux tree, and sometimes even Debian specific changes.
			</div><div
            class="para">
				The remainder of this section focuses on the 4.9 version of the Linux kernel, but the examples can, of course, be adapted to the particular version of the kernel that you want.
			</div><div
            class="para">
				We assume the <span
              class="pkg pkg">linux-source-4.9</span> package has been installed. It contains <code
              class="filename">/usr/src/linux-source-4.9.tar.xz</code>, a compressed archive of the kernel sources. You must extract these files in a new directory (not directly under <code
              class="filename">/usr/src/</code>, since there is no need for special permissions to compile a Linux kernel): <code
              class="filename">~/kernel/</code> is appropriate.
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>mkdir ~/kernel; cd ~/kernel</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>tar -xaf /usr/src/linux-source-4.9.tar.xz</code></strong></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>КУЛЬТУРА</em></span> Месторасположение исходных кодов ядра</strong></p></div></div></div><div
              class="para">
				Традиционно, исходные коды ядра Linux размещаются в <code
                class="filename">/usr/src/linux/</code>, следовательно, при компилировании ядра нужно иметь права доступа администратора. Однако, надо стараться избегать работать с правами администратора, если в этом нет острой необходимости. Участникам существующей группы <code
                class="literal">src</code> позволяется работать в этом каталоге, тем не менее следует избегать работать в каталоге <code
                class="filename">/usr/src/</code>. Сохраняя коды ядра в персональный каталог, вы обеспечите безопасность по всем пунктам: нет файлов в каталоге <code
                class="filename">/usr/</code>, неизвестных системе управления пакетами, и нет риска ввести в заблуждение программы, что читают каталог <code
                class="filename">/usr/src/linux</code>, когда они пытаются получить информацию об используемом ядре.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.config-kernel"></a>8.10.3. Настройка ядра</h3></div></div></div><a
            id="id-1.11.14.10.2"
            class="indexterm"></a><a
            id="id-1.11.14.10.3"
            class="indexterm"></a><a
            id="id-1.11.14.10.4"
            class="indexterm"></a><div
            class="para">
				Следующий шаг содержит настройку ядра в соответствии с вашими потребностями. Более точный алгоритм работы зависит от ваших целей.
			</div><div
            class="para">
				При перекомпиляции более современной версии ядра (возможно с дополнительными заплатками), конфигурация ядра должна быть как можно ближе к тому, что предлагает Debian. В этом случае достаточно просто скопировать файл <code
              class="filename">/boot/config-<em
                class="replaceable">version</em></code> (узнать версию ядра, работающего сейчас на вашем компьютере, можно командой <code
              class="command">uname -r</code> command) в новый файл с именем <code
              class="filename">.config</code>, разместив его в каталог, содержащий исходные коды ядра. Это будет намного быстрее чем пересобрать ядро с нуля.
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>cp /boot/config-4.9.0-3-amd64 ~/kernel/linux-source-4.9/.config</code></strong></pre><div
            class="para">
				Если вам не нужно изменять конфигурацию ядра, вы можете остановиться здесь и пропустить раздел <a
              class="xref"
              href="sect.kernel-compilation.html#sect.kernel-build">Раздел 8.10.4, «Компиляция и Сборка Пакета»</a>. В противном случае, если необходимо внести изменения в конфигурацию ядра или вы решили сами всё настроить с нуля, то необходимо выделить достаточно время на эту работу. В каталоге с исходными кодами ядра присутствуют и различные специальные интерфейсы, которые могут быть использованы посредством вызова команды <code
              class="command">make <em
                class="replaceable">target</em></code>, где в качестве <em
              class="replaceable">target</em> выступает одно из значений, описанных ниже.
			</div><div
            class="para">
				<code
              class="command">make menuconfig</code> компилирует и выполняет в псевдографическом интерфейсе (для этого необходимо установить пакет <span
              class="pkg pkg">libncurses5-dev</span>). В программе можно передвигаться и выбирать опции в иерархической структуре. Нажатием клавиши <span
              class="keycap"><strong>Space</strong></span> изменяется значение выбираемой опции, а нажатием <span
              class="keycap"><strong>Enter</strong></span> войти внутрь того названия, на котором расположен в тот момент указатель; кнопка интерфейса <span
              class="guibutton"><strong>Select</strong></span> возвращает на выбранное подменю; <span
              class="guibutton"><strong>Exit</strong></span> закрывает настоящий экран и сдвигает позицию курсора назад по иерархии; <span
              class="guibutton"><strong>Help</strong></span> отобразит более детальную информацию о роли выбранной опции. Клавиши навигации позволяют передвигаться в списке опций и кнопок. Для выхода из программы выберете <span
              class="guibutton"><strong>Exit</strong></span> из главного меню. В этот момент программа предложит сохранить сделанные изменения - если вы удовлетворены сделанными изменениями, то сохраните.
			</div><div
            class="para">
				Другие интерфейсы имеют похожие функциональные возможности, но они работают в более современных графических оболочках; такие как <code
              class="command">make xconfig</code>, которая использует графический интерфейс Qt, и <code
              class="command">make gconfig</code>, использующий GTK+. Первый нуждается в пакете <span
              class="pkg pkg">libqt4-dev</span>, в то время как второй зависит от наличия пакетов <span
              class="pkg pkg">libglade2-dev</span> и <span
              class="pkg pkg">libgtk2.0-dev</span>.
			</div><div
            class="para">
				Хорошей идеей было бы использовать совместно с теми интерфейсами одну из конфигураций по умолчанию, имеющиеся в комплекте с исходным кодом ядра. Они спроектированы оптимальным образом и расположены в <code
              class="filename">arch/<em
                class="replaceable">arch</em>/configs/*_defconfig</code>. Вы можете взять выбранную вами оттуда конфигурацию поместив её в новое место командой похожей на <code
              class="command">make x86_64_defconfig</code> (в случае 64-битного ПК) или <code
              class="command">make i386_defconfig</code> (в случае 32-разрядный ПК). Программа возьмёт .config из заготовленных разработчиками оптимальных конфигураций и сохраняет его в каталог, где будет компилироваться ядро, то есть по сути копирует этот файл.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> Применение устаревших файлов <code
                        class="filename">.config</code></strong></p></div></div></div><div
              class="para">
				Если вы хотите использовать старый файл <code
                class="filename">.config</code>, который был создан ранее в другой (обычно старой) версии ядра, вам необходимо будет его обновить. Для этого имеются три варианта. Первый - при запуске <code
                class="command">make oldconfig</code> программа в интерактивной форме задаст вам вопросы, касающиеся вновь введённых в ядро опций или изменений, которые возможно имели место быть в новой версии ядра (длительный по времени процесс). Второй - запуск <code
                class="command">make olddefconfig</code> уведомит программу о том, что вы, как бы, ответили на все задаваемые ею вопросы положительно. Третий - команда <code
                class="command">make oldnoconfig</code> даст понять команде, что на все вопросы вы дали отрицательные ответы.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.kernel-build"></a>8.10.4. Компиляция и Сборка Пакета</h3></div></div></div><a
            id="id-1.11.14.11.2"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ЗАМЕТКА</em></span> Очистка каталога до пересборки</strong></p></div></div></div><div
              class="para">
				Если вы уже компилировали в данном каталоге а теперь желаете пересобрать в нём с нуля другое новое ядро (к примеру потому, что вы существенно изменили конфигурацию ядра), то вам необходимо будет выполнить команду <code
                class="command">make clean</code> для удаления скомпилированных файлов. Команда <code
                class="command">make distclean</code> удалит даже больше сгенерированных ранее файлов, включая также и ваш файл <code
                class="filename">.config</code>. Так что не забудьте и сохраните вначале всё, что вам может понадобиться в дальнейшем, например файл .config, и только потом выполняйте эти команды.
			</div></div><div
            class="para">
				Как только вы определились с конфигурацией вашего будущего ядра, выполнение команды <code
              class="command">make deb-pkg</code> сгенерирует до 5 пакетов Debian: 1) <span
              class="pkg pkg">linux-image-<em
                class="replaceable">version</em></span>, который содержит образ ядра и связанные с ними модули, 2) <span
              class="pkg pkg">linux-headers-<em
                class="replaceable">version</em></span>, который содержит заголовочные файлы, необходимые для сборки внешних модулей, 3) <span
              class="pkg pkg">linux-firmware-image-<em
                class="replaceable">version</em></span>, который содержит файлы прошивки аппаратной части, нужные некоторым драйверам (эти пакеты могут отсутствовать, если вы строите из исходных кодов ядра, поддерживаемого Debian), 4) <span
              class="pkg pkg">linux-image-<em
                class="replaceable">version</em>-dbg</span>, который содержит символы отладки для образа ядра и его модулей, и 5) <span
              class="pkg pkg">linux-libc-dev</span>, который содержит заголовки, актуальные для некоторых библиотек, поддерживающих пространство пользователя подобно GNU glibc.
			</div><div
            class="para">
				Слово-приставка, добавляемая в конце к названию ядра, <em
              class="replaceable">version</em> образуется путём слияния нескольких значений, характеризующих место данной версии в цепочке нумерации ядра (следующие переменные <code
              class="literal">VERSION</code>, <code
              class="literal">PATCHLEVEL</code>, <code
              class="literal">SUBLEVEL</code> и <code
              class="literal">EXTRAVERSION</code> определены в файле <code
              class="filename">Makefile</code>), параметра настройки <code
              class="literal">LOCALVERSION</code>, и переменной окружения <code
              class="literal">LOCALVERSION</code>. Вновь создаваемые пакеты с ядром для своего наименования заимствуют часть строки от названия версии ядра с добавлением номера ревизии, который регулярно увеличивается (и сохраняется в файле <code
              class="filename">.version</code>). Из этого правила есть исключение: если вы сами определите имя новой версии ядра с помощью переменной окружения <code
              class="literal">KDEB_PKGVERSION</code>.
			</div><pre
            class="screen"><code
              class="computeroutput">$ </code><strong
              class="userinput"><code>make deb-pkg LOCALVERSION=-falcot KDEB_PKGVERSION=$(make kernelversion)-1
</code></strong><code
              class="computeroutput">[...]
$ </code><strong
              class="userinput"><code>ls ../*.deb
</code></strong><code
              class="computeroutput">../linux-headers-4.9.30-ckt4-falcot_4.9.30-1_amd64.deb
../linux-image-4.9.30-ckt4-falcot_4.9.30-1_amd64.deb
../linux-image-4.9.30-ckt4-falcot-dbg_4.9.30-1_amd64.deb
../linux-libc-dev_4.9.30-1_amd64.deb
</code></pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.modules-build"></a>8.10.5. Компиляция Внешних Модулей (динамически загружаемые модули ядра)</h3></div></div></div><a
            id="id-1.11.14.12.2"
            class="indexterm"></a><a
            id="id-1.11.14.12.3"
            class="indexterm"></a><a
            id="id-1.11.14.12.4"
            class="indexterm"></a><div
            class="para">
				Некоторые модули, не включённые в официальный проект ядра Linux, поддерживаются за его пределами. Чтобы была возможность их использовать, они должны быть скомпилированы рядом с соответствующим ядром. Определённое количество таких модулей поддерживается Debian путём включения их в специальные пакеты, такие как <span
              class="pkg pkg">xtables-addons-source</span> (дополнительные модули для iptables) или <span
              class="pkg pkg">oss4-source</span> (некоторые альтернативные звуковые драйверы).
			</div><div
            class="para">
				Так как этих внешних модулей (и пакетов с ними) имеется великое множество и все они разные, то мы не будем перечислять их здесь все. Помощь вам может сослужить команда <code
              class="command">apt-cache search source$</code>, которая проведёт поиск только по заголовкам пакетов (установленных и неустановленных в системе). Однако, знание полного перечня врешних модулей не принесёт вам большой пользы, поскольку в большинстве случаев компиляция внешних модулей не нужна, за редким исключением, когда вы сами знаете, что вам надо. В таких случаях, документация на аппаратное устройство, как правило, детально описывает, каким образом данный конкретный модуль функционирует под операционной системой Linux.
			</div><div
            class="para">
				Для примера, давайте рассмотрим пакет <span
              class="pkg pkg">xtables-addons-source</span>: после его установки появится архив исходного кода модуля <code
              class="filename">.tar.bz2</code>, располагающийся в каталоге <code
              class="filename">/usr/src/</code>. Далее можно было бы вручную извлечь данные из архива и построить модуль, но на практике предпочтительным способом является использование DKMS (инфраструктура для поддержки динамически загружаемых модулей ядра). Пакеты, название которых оканчивается на суффикс <code
              class="literal">-dkms</code>, предлагаются для большинства модулей, которым необходима интеграция с ядром через DKMS. В приведённом примере, установка пакета <span
              class="pkg pkg">xtables-addons-dkms</span> добавит всё необходимое, что нужно для компиляции внешнего модуля для настоящего ядра. Обратите только внимание, чтобы был установлен и пакет <span
              class="pkg pkg">linux-headers-*</span>, соответствующий версии ядра. Например, если вы используете <span
              class="pkg pkg">linux-image-amd64</span>, то вам необходимо доустановить и пакет <span
              class="pkg pkg">linux-headers-amd64</span>.
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>sudo apt install xtables-addons-dkms</code></strong>
<code
              class="computeroutput">
[...]
Setting up xtables-addons-dkms (2.12-0.1) ...
Loading new xtables-addons-2.12 DKMS files...
Building for 4.9.0-3-amd64
Building initial module for 4.9.0-3-amd64
Done.

xt_ACCOUNT:
Running module version sanity check.
 - Original module
   - No original module exists within this kernel
 - Installation
   - Installing to /lib/modules/4.9.0-3-amd64/updates/dkms/
[...]
DKMS: install completed.
$ </code><strong
              class="userinput"><code>sudo dkms status</code></strong>
<code
              class="computeroutput">xtables-addons, 2.12, 4.9.0-3-amd64, x86_64: installed
$ </code><strong
              class="userinput"><code>sudo modinfo xt_ACCOUNT</code></strong>
<code
              class="computeroutput">filename:       /lib/modules/4.9.0-3-amd64/updates/dkms/xt_ACCOUNT.ko
license:        GPL
alias:          ipt_ACCOUNT
author:         Intra2net AG &lt;opensource@intra2net.com&gt;
description:    Xtables: per-IP accounting for large prefixes
[...]
</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>АЛЬТЕРНАТИВА</em></span> модуль-помошник</strong></p></div></div></div><a
              id="id-1.11.14.12.9.2"
              class="indexterm"></a><div
              class="para">
				До появления DKMS, <span
                class="pkg pkg">module-assistant</span> был простейшим решением построения и развёртывания модулей ядра. Такое решение и сегодня ещё используется, в частности для тех пакетов, которым не хватает возможностей, заложенных в механизм интеграции через DKMS с ядром: после выполнения простой команды, подобной этой, <code
                class="command">module-assistant auto-install xtables-addons</code> (или <code
                class="command">m-a a-i xtables-addons</code> для краткости), модули будут скомпилированы для настоящего ядра, помещены в новый пакет Debian, и этот новый пакет будет установлен в систему. Всё это будет проделано "на летỳ".
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.kernel-patch"></a>8.10.6. Установка Заплатки на Ядро</h3></div></div></div><a
            id="id-1.11.14.13.2"
            class="indexterm"></a><a
            id="id-1.11.14.13.3"
            class="indexterm"></a><div
            class="para">
				Некоторые особенности не включены в стандартное ядро из-за недостатка завершённости кода или некоторых разногласий с сопровождающими ядро. Они могут быть включены в отдельные заплатки и распространяться в таком виде (разработчиками заплатки). В дальнейшем кто угодно может установить такую заплатку на исходные коды ядра.
			</div><div
            class="para">
				Debian sometimes provides some of these patches in <span
              class="pkg pkg">linux-patch-*</span> packages but they often don't make it into stable releases (sometimes for the very same reasons that they are not merged into the official upstream kernel). These packages install files in the <code
              class="filename">/usr/src/kernel-patches/</code> directory.
			</div><div
            class="para">
				После установки в систему пакета с заплаткой, наложить её на исходные коды ядра можно следующей командой <code
              class="command">patch</code>. В этот момент необходимо находиться курсором в каталоге с исходными кодами ядра (а сама заплатка должна находиться на один уровень выше). Пример: "xz -cd ../linux-patch-3.16-rt.patch.xz | patch -p1". Далее, перейдите к этапу конфигурирования нового ядра и его компилиляции, как было описано выше.
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>cd ~/kernel/linux-source-4.9</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>make clean</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>zcat /usr/src/kernel-patches/diffs/grsecurity2/grsecurity-3.1-4.9.11-201702181444.patch.gz | patch -p1</code></strong></pre><div
            class="para">
				Обратите внимание, что устанавливаемая заплатка не обязательно будет совместима с каждой версией ядра. Может случиться, что команда <code
              class="command">patch</code>, при попытке наложить заплатку на исходные коды ядра, потерпит неудачу. Возникшие ошибки будут показаны и даны некоторые подробности, касательно возникшего сбоя. В этом случае, руководствуйтесь документацией, доступной в Debian пакете данной заплатки (в каталоге <code
              class="filename">/usr/share/doc/linux-patch-*/</code>). В большинстве случаев, сопровождающие заплаток указывают, для каких версий ядра они предназначены.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.config-misc.html"><strong>Пред.</strong>8.9. Другие настройки: Синхронизация времени, Жур...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.kernel-installation.html"><strong>След.</strong>8.11. Установка ядра</a></li></ul></body></html>
