<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">3.2. Как мигрировать</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ru-RU-1.0-1" /><meta
        name="keywords"
        content="Существующая установка, Повторное использование, Миграция" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="existing-setup.html"
        title="Глава 3. Анализ существующей установки и миграция" /><link
        rel="prev"
        href="existing-setup.html"
        title="Глава 3. Анализ существующей установки и миграция" /><link
        rel="next"
        href="installation.html"
        title="Глава 4. Установка" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ru-RU/stable/sect.how-to-migrate.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="existing-setup.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="installation.html"><strong>След.</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.how-to-migrate"></a>3.2. Как мигрировать</h2></div></div></div><a
          id="id-1.6.5.2"
          class="indexterm"></a><div
          class="para">
			Необходимо планировать миграцию каждого компьютера и следовать этому плану с целью предоставления бесперебойной работы служб. Этот принцип применим вне зависимости от используемой операционной системы.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.6.5.4"></a>3.2.1. Обследование и определение служб</h3></div></div></div><div
            class="para">
				Данный этап очень важен вне зависимости от того, насколько простым он кажется. Ответственный администратор хорошо осознаёт роль каждого сервера, но эти роли могут изменяться, а опытные пользователи могут самостоятельно установить некоторые службы. Информация о таких службах позволит вам принять взвешенное решение о их необходимости, и вы не удалите такие службы случайно.
			</div><div
            class="para">
				Поэтому вам стоит проинформировать пользователей о предстоящем проекте до переноса сервера. Вы можете установить наиболее распространённые свободные программы на рабочие места пользователей до начала процесса миграции и тем самым привлечь самих пользователей к проекту; лучшими примерами здесь будут Libre Office и пакет программ Mozilla.
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.6.5.4.4"></a>3.2.1.1. Сеть и процессы</h4></div></div></div><a
              id="id-1.6.5.4.4.2"
              class="indexterm"></a><div
              class="para">
					Инструмент <code
                class="command">nmap</code> (из одноимённого пакета) позволит вам быстро определить службы сети Интернет, которые размещены на подключенной к сети машине, при этом вам даже не потребуется входить на эту машину под своей учётной записью. Просто наберите следующую команду на любой другой машине, подключенной к той же сети:
				</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>nmap mirwiz</code></strong>
<code
                class="computeroutput">Starting Nmap 6.47 ( http://nmap.org ) at 2015-03-24 11:34 CET
Nmap scan report for mirwiz (192.168.1.104)
Host is up (0.0037s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 0.13 seconds</code></pre><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>АЛЬТЕРНАТИВА</em></span> Использование <code
                          class="command">netstat</code> для составления списка доступных служб</strong></p></div></div></div><div
                class="para">
					Запустите <code
                  class="command">netstat -tupan</code> на компьютере с системой Linux, и эта команда выведет список активных или ожидающих TCP соединений, а также портов UDP, которые прослушивают запущенные программы. Данная команда упростит определение доступных в сети служб.
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> IPv6</strong></p></div></div></div><div
                class="para">
					Некоторые сетевые команды могут работать либо с протоколом IPv4 (поведение по умолчанию), либо с IPv6. К таким командам относятся <code
                  class="command">nmap</code> и <code
                  class="command">netstat</code>, а также <code
                  class="command">route</code> и <code
                  class="command">ip</code>. В соответствии с соглашением стоит использовать опцию командной строки <em
                  class="parameter"><code>-6</code></em> для работы с протоколом IPv6.
				</div></div><div
              class="para">
					Если сервер является Unix-машиной, предоставляющей пользователям учётные записи в командной оболочке, то необходимо определить процессы, выполняемые в фоновом режиме во время отсутствия своего владельца. Команда <code
                class="command">ps auxw</code> отобразит список всех процессов совместно с идентификаторами пользователей. Сравнив полученный список с выводом команды <code
                class="command">who</code>, которая отображает список всех зарегистрированных пользователей, вы можете установить несанкционированно установленные серверы и программы, работающие в фоновом режиме. Просмотр <code
                class="filename">crontabs</code> (список автоматически выполняемых действий, запланированных пользователем) часто помогает выявить интересные детали о выполняемых сервером функциях (полное описание <code
                class="command">cron</code> находится по ссылке <a
                class="xref"
                href="sect.task-scheduling-cron-atd.html">Раздел 9.7, «Планирование задач с помощью <code
                  class="command">cron</code> и <code
                  class="command">atd</code>»</a>).
				</div><div
              class="para">
					Создание резервной копии вашего сервера — важная процедура в любом случае. Вы можете восстановить информацию из резервной копии после того, как пользователи сообщат об особых проблемах в процессе миграции.
				</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.6.5.5"></a>3.2.2. Создание резервной копии настроек</h3></div></div></div><div
            class="para">
				Имеет смысл сохранить конфигурацию каждой обнаруженной службы с тем, чтобы восстановить аналогичные настройки на обновлённом сервере. Как минимум стоит сделать резервную копию конфигурационных файлов.
			</div><div
            class="para">
				Для компьютеров с системой Unix конфигурационные файлы обычно находятся в <code
              class="filename">/etc/</code>, но они также могут быть в подкаталоге <code
              class="filename">/usr/local/</code>. Такое часто бывает при установке программы из исходных кодов, а не из пакета. В отдельных случаях настройки могут быть в каталоге <code
              class="filename">/opt/</code>.
			</div><div
            class="para">
				В случае служб управления данными (такие как базы данных) мы настоятельно рекомендуем экспортировать данные в какой-либо стандартный формат, который можно будет легко импортировать в новом программном обеспечении. Обычно такие форматы имеют текстовый вид и хорошо документированы; например, это может быть SQL дамп для базы данных или файл LDIF в случае LDAP сервера.
			</div><div
            class="figure"><a
              xmlns=""
              id="id-1.6.5.5.5"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/existing-setup-2.png"
                  alt="Резервные копии баз данных" /></div></div><p
              class="title"><strong>Рисунок 3.2. Резервные копии баз данных</strong></p></div><div
            class="para">
				Каждый сервер имеет свой собственный набор программного обеспечения, и детально описать все существующие варианты практически невозможно. Внимательно прочтите документацию на существующее и новое программное обеспечение с целью установления экспортируемых (а следовательно и импортируемых) форматов, а также тех форматов, которые потребуют переноса данных в ручном режиме. После прочтения этой книги у вас будет больше ясности по вопросам настройки основных программ, используемых на серверах под управлением Linux.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.6.5.6"></a>3.2.3. Анализ существующего сервера под управлением Debian</h3></div></div></div><a
            id="id-1.6.5.6.2"
            class="indexterm"></a><a
            id="id-1.6.5.6.3"
            class="indexterm"></a><a
            id="id-1.6.5.6.4"
            class="indexterm"></a><div
            class="para">
				Для эффективного начала работы с принятой в обслуживание системой Debian вы можете проанализировать уже настроенную и работающую систему Debian.
			</div><div
            class="para">
				Первый файл, на который следует обратить внимание, — <code
              class="filename">/etc/debian_version</code>, в котором обычно содержится номер версии установленной системы Debian (файл является частью пакета <span
              class="emphasis"><em>base-files</em></span>). Если в этом файле содержится строка <code
              class="literal"><em
                class="replaceable">кодовое_имя</em>/sid</code>, то в системе установлены пакеты из одного из находящихся в разработке дистрибутивов (либо тестируемый, либо нестабильный).
			</div><div
            class="para">
				Программа <code
              class="command">apt-show-versions</code> (из одноимённого пакета Debian) проверит список установленных пакетов и определит доступные версии этих пакетов. С этой же целью можно использовать <code
              class="command">aptitude</code>, хоть и менее систематичным образом.
			</div><div
            class="para">
				Взглянув на файл <code
              class="filename">/etc/apt/sources.list</code> (и на каталог <code
              class="filename">/etc/apt/sources.list.d/</code>), вы сможете определить вероятный источник установленных пакетов Debian. Если этот файл содержит множество неизвестных источников, то администратор может предпочесть полностью переустановить систему для обеспечения оптимальной совместимости с тем программным обеспечением, которое предоставляется проектом Debian.
			</div><div
            class="para">
				Файл <code
              class="filename">sources.list</code> часто служит хорошим индикатором: большинство администраторов содержат полный список всех использованных ранее источников APT, хотя бы и в закомментированном виде. Не стоит забывать, что использованные ранее источники могли быть удалены, а некоторые пакеты могли быть загружены из сети Интернет и установлены вручную (командой <code
              class="command">dpkg</code>). В этом случае система может быть ошибочно принята за «стандартную» систему Debian. Именно по этой причине вам следует обратить внимание на любые признаки, которые помогут вам определить присутствие внешних пакетов (наличие файлов <code
              class="filename">deb</code> в необычных для них каталогах; номера версий пакетов со специальными суффиксами, которые могут указывать на происхождения пакетов не из проекта Debian, а из таких проектов как <code
              class="literal">ubuntu</code> или <code
              class="literal">lmde</code>, и т. д.)
			</div><div
            class="para">
				По этой же причине полезно проанализировать содержимое каталога <code
              class="filename">/usr/local/</code>, который предназначен для собранных и установленных вручную программ. Список установленного таким образом программного обеспечения может быть поучительным в том плане, что вам предстоит установить причины, по которым не были использованы соответствующие пакеты Debian, если они существуют.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>КРАТКИЙ ЭКСКУРС</em></span> <span
                        class="pkg pkg">cruft</span></strong></p></div></div></div><div
              class="para">
				Пакет <span
                class="pkg pkg">cruft</span> поможет составить список тех файлов, что не входят в состав ни одного пакета. В нём присутствуют несколько фильтров (более или менее эффективных и обновляемых), которые помогут исключить некоторые доверенные файлы (те что созданы пакетами Debian или некоторые конфигурационные файлы, которые не находятся под контролем <code
                class="command">dpkg</code> и т. д.).
			</div><div
              class="para">
				Будьте внимательны и не удалите всё то, что <code
                class="command">cruft</code> может занести в свой список!
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.6.5.7"></a>3.2.4. Установка Debian</h3></div></div></div><div
            class="para">
				Как только вы собрали всю необходимую информацию о текущем сервере, можно его вывести из работы и начать установку Debian.
			</div><a
            id="id-1.6.5.7.3"
            class="indexterm"></a><div
            class="para">
				Нам потребуется установить архитектуру компьютера для выбора соответствующей версии дистрибутива. В случае достаточно нового компьютера архитектура будет amd64 (для более старых компьютеров — i386). Во всех остальных случаях выбор сведётся к той архитектуре, что использовалась на предыдущей системе.
			</div><div
            class="para">
				<a
              class="xref"
              href="sect.how-to-migrate.html#tab-corresp">Таблица 3.1</a> не является исчерпывающей, но может быть полезной. В любом случае, оригинальная документация на компьютер является наиболее надёжным источником информации подобного рода.
			</div><div
            class="table"><a
              xmlns=""
              id="tab-corresp"></a><p
              class="title"><strong>Таблица 3.1. Выбор операционной системы для вашей архитектуры</strong></p><div
              class="table-contents"><table
                xmlns:d="http://docbook.org/ns/docbook"
                class="lt-4-cols gt-7-rows"
                summary="Выбор операционной системы для вашей архитектуры"><colgroup><col /><col /></colgroup><thead><tr><th>Операционная система</th><th>Архитектура(ы)</th></tr></thead><tbody><tr><td>DEC Unix (OSF/1)</td><td>alpha, mipsel</td></tr><tr><td>HP Unix</td><td>ia64, hppa</td></tr><tr><td>IBM AIX</td><td>powerpc</td></tr><tr><td>Irix</td><td>mips</td></tr><tr><td>OS X</td><td>amd64, powerpc, i386</td></tr><tr><td>z/OS, MVS</td><td>s390x, s390</td></tr><tr><td>Solaris, SunOS</td><td>sparc, i386, m68k</td></tr><tr><td>Ultrix</td><td>mips</td></tr><tr><td>VMS</td><td>alpha</td></tr><tr><td>Windows 95/98/ME</td><td>i386</td></tr><tr><td>Windows NT/2000</td><td>i386, alpha, ia64, mipsel</td></tr><tr><td>Windows XP / Windows Server 2008</td><td>i386, amd64, ia64</td></tr><tr><td>Windows Vista / Windows 7 / Windows 8</td><td>i386, amd64</td></tr></tbody></table></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>АППАРАТНОЕ ОБЕСПЕЧЕНИЕ</em></span> 64 бита или 32 бита</strong></p></div></div></div><a
              id="id-1.6.5.7.7.2"
              class="indexterm"></a><a
              id="id-1.6.5.7.7.3"
              class="indexterm"></a><div
              class="para">
				Современные компьютеры оснащены 64-разрядными процессорами Intel или AMD, совместимыми с предыдущим поколением 32-разрядных процессоров, поэтому на них работают программы, собранные для архитектуры «i386». С другой стороны, все возможности этих новых процессоров используются не полностью в таком режиме совместимости. По этой причине Debian предоставляет архитектуру «amd64», которая работает как с современными процессорами AMD, так и с процессорами Intel «em64t» (включая большую часть линейки Core), которые очень похожи на AMD64.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.6.5.8"></a>3.2.5. Установка и настройка выбранных служб</h3></div></div></div><div
            class="para">
				Как только Debian будет установлен, нам потребуется поочерёдно установить и настроить все службы, которые закреплены за данным компьютером. Новая конфигурация должна учитывать предыдущую с целью плавного перехода между ними. Для успешного завершения этой части пригодится вся информация, собранная за первые два шага.
			</div><div
            class="figure"><a
              xmlns=""
              id="id-1.6.5.8.3"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/existing-setup-4.png"
                  alt="Установка выбранных служб" /></div></div><p
              class="title"><strong>Рисунок 3.3. Установка выбранных служб</strong></p></div><div
            class="para">
				Прежде чем с головой погрузиться в это занятие, мы настоятельно рекомендуем вам прочитать оставшуюся часть книги. После прочтения вы будете точно знать, как настраиваются необходимые вам службы.
			</div><div
            class="para">
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="existing-setup.html"><strong>Пред.</strong>Глава 3. Анализ существующей установки и миграция</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="installation.html"><strong>След.</strong>Глава 4. Установка</a></li></ul></body></html>
