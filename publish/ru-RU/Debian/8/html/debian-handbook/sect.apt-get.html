<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">6.2. Команды aptitude, apt-get и apt</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ru-RU-1.0-1" /><meta
        name="keywords"
        content="apt, apt-get, apt-cache, aptitude, synaptic, sources.list, apt-cdrom" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="apt.html"
        title="Глава 6. Обслуживание и обновление: инструменты APT" /><link
        rel="prev"
        href="apt.html"
        title="Глава 6. Обслуживание и обновление: инструменты APT" /><link
        rel="next"
        href="sect.apt-cache.html"
        title="6.3. The apt-cache Command" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ru-RU/stable/sect.apt-get.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>След.</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.apt-get"></a>6.2. Команды <code
                  class="command">aptitude</code>, <code
                  class="command">apt-get</code> и <code
                  class="command">apt</code></h2></div></div></div><a
          id="id-1.9.11.2"
          class="indexterm"></a><a
          id="id-1.9.11.3"
          class="indexterm"></a><a
          id="id-1.9.11.4"
          class="indexterm"></a><div
          class="para">
			APT является большим проектом, в исходные планы которого входило создание графического интерфейса. Он основан на библиотеке, которая содержит приложение ядра, а <code
            class="command">apt-get</code> является первым интерфейсом (основанным на режиме командной строки), который был разработан в рамках этого проекта. <code
            class="command">apt</code> является вторым интерфейсом командной строки, предоставляемым APT, который устраняет некоторые ошибки проектирования <code
            class="command">apt-get</code>.
		</div><div
          class="para">
			Большое число графических интерфейсов появилось позже как внешние проекты: <code
            class="command">synaptic</code>, <code
            class="command">aptitude</code> (который включает и текстовый интерфейс, и графический — хоть и не завершённый до сих пор), <code
            class="command">wajig</code>, и т.д. Наиболее рекомендуемый интерфейс, <code
            class="command">apt</code>, мы будем использовать в примерах, приведённых в этом разделе. Обратите внимание, что <code
            class="command">apt-get</code> и <code
            class="command">aptitude</code> имеют весьма схожий синтаксис командной строки. В случае, когда существуют значительные различия между <code
            class="command">apt</code>, <code
            class="command">apt-get</code> и <code
            class="command">aptitude</code>, эти различия будут разобраны более подробно.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.11.7"></a>6.2.1. Инициализация</h3></div></div></div><div
            class="para">
				При необходимости работы с APT должен быть обновлён список доступных пакетов; это просто сделать с помощью команды <code
              class="command">apt update</code>. В зависимости от скорости вашего соединения, эта операция может занять достаточно времени, поскольку она включает загрузку определённого числа <code
              class="filename">Packages</code>/<code
              class="filename">Sources</code>/<code
              class="filename">Translation-<em
                class="replaceable">language-code</em></code> файлов, которые постепенно становятся всё больше и больше в процессе разработки Debian (по меньшей мере 10 МБ данных для секции <code
              class="literal">main</code>). Конечно, установка с набора CD-ROM не требует никакой загрузки — в этом случае операция является очень быстрой.
			</div><a
            id="id-1.9.11.7.3"
            class="indexterm"></a><a
            id="id-1.9.11.7.4"
            class="indexterm"></a><a
            id="id-1.9.11.7.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.11.8"></a>6.2.2. Установка и удаление</h3></div></div></div><a
            id="id-1.9.11.8.2"
            class="indexterm"></a><a
            id="id-1.9.11.8.3"
            class="indexterm"></a><a
            id="id-1.9.11.8.4"
            class="indexterm"></a><a
            id="id-1.9.11.8.5"
            class="indexterm"></a><div
            class="para">
				С помощью APT пакеты могут быть добавлены или удалены из системы командами <code
              class="command">apt install <em
                class="replaceable">пакет</em></code> and <code
              class="command">apt remove <em
                class="replaceable">пакет</em></code> соответственно. В обоих случаях APT автоматически установит необходимые пакеты, от которого зависит данный, или удалит пакеты, которые зависят от удаляемого пакета. Команды <code
              class="command">apt purge <em
                class="replaceable">пакет</em></code> вызывают полное удаление — файлы настройки также будут удалены.
			</div><a
            id="id-1.9.11.8.7"
            class="indexterm"></a><a
            id="id-1.9.11.8.8"
            class="indexterm"></a><a
            id="id-1.9.11.8.9"
            class="indexterm"></a><a
            id="id-1.9.11.8.10"
            class="indexterm"></a><a
            id="id-1.9.11.8.11"
            class="indexterm"></a><a
            id="id-1.9.11.8.12"
            class="indexterm"></a><a
            id="id-1.9.11.8.13"
            class="indexterm"></a><a
            id="id-1.9.11.8.14"
            class="indexterm"></a><a
            id="id-1.9.11.8.15"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> Установка одного и того же набора пакетов несколько раз</strong></p></div></div></div><div
              class="para">
				Это может оказаться полезным при установке одного и того же перечня пакетов на различные компьютеры. И это может быть сделано достаточно просто.
			</div><div
              class="para">
				Во-первых, необходимо определить перечень пакетов, установленных на компьютере, который будет служить "моделью" для копирования.
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --get-selections &gt;pkg-list</code></strong></pre><div
              class="para">
				После этого файл <code
                class="filename">pkg-list</code> будет содержать перечень установленных пактов. Следующим шагом необходимо передать файл <code
                class="filename">pkg-list</code> на компьютеры, на которых необходимо произвести обновление, и использовать следующие команды:
			</div><pre
              class="screen">## Обновить базу данных dpkg's об известных пакетах
# <strong
                class="userinput"><code>avail=`mktemp`</code></strong>
# <strong
                class="userinput"><code>apt-cache dumpavail &gt; "$avail"</code></strong>
# <strong
                class="userinput"><code>dpkg --merge-avail "$avail"</code></strong>
# <strong
                class="userinput"><code>rm -f "$avail"</code></strong>
## Обновить выбор dpkg's
# <strong
                class="userinput"><code>dpkg --set-selections &lt; pkg-list</code></strong>
## Запросить у apt-get установку выбранных пакетов
# <strong
                class="userinput"><code>apt-get dselect-upgrade</code></strong></pre><div
              class="para">
				Первая команда записывает перечень доступных пакетов в базу данных dpkg database, затем <code
                class="command">dpkg --set-selections</code> восстанавливает выбор пакетов, которые вы хотите установить, а вызов <code
                class="command">apt-get</code> выполняет требуемые операции! <code
                class="command">aptitude</code> не имеет этой команды.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> Удаление и установка в одной команде</strong></p></div></div></div><div
              class="para">
				Можно использовать <code
                class="command">apt</code> (или <code
                class="command">apt-get</code>, или <code
                class="command">aptitude</code>) для установки одних пакетов и удаления других одной командой путем добавления суффикса. Используя <code
                class="command">apt install</code> добавьте «<code
                class="literal">–</code>» к именам пакетов, которые вы хотите удалить. Для <code
                class="command">apt remove</code> добавьте «<code
                class="literal">+</code>» к именам пакетов, которые вы хотите установить.
			</div><div
              class="para">
				В следующем примере показано два разных способа для установки <em
                class="replaceable">packet1</em> и удаления <em
                class="replaceable">packet2</em>.
			</div><pre
              class="screen"># <strong
                class="userinput"><code>apt install <em
                    class="replaceable">package1</em> <em
                    class="replaceable">package2-</em></code></strong>
[...]
# <strong
                class="userinput"><code>apt remove <em
                    class="replaceable">package1+</em> <em
                    class="replaceable">package2</em></code></strong>
[...]</pre><div
              class="para">
				Это можно использовать для исключения пакетов, которые бы в противном случае были установлены, например из-за <code
                class="literal">Recommends</code>. В общем для разрешения зависимостей будет использована эта информация как подсказка для поиска альтернативных решений.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> <code
                        class="command">apt --reinstall</code> и <code
                        class="command">aptitude reinstall</code></strong></p></div></div></div><a
              id="id-1.9.11.8.18.2"
              class="indexterm"></a><div
              class="para">
				После удаления или изменения файлов в пакете, система может быть повреждена. Самый простой способ для восстановления этих файлов является переустановка таких пакет. К сожалению, система упаковки считает, что пакет уже установлен и вежливо отказывается переустановить его. Чтобы избежать этого, добавьте <code
                class="literal">--reinstall</code> к <code
                class="command">apt</code> или <code
                class="command">apt-get</code>. Следующая команда переустановит <span
                class="pkg pkg">postfix</span> даже если он уже установлен:
			</div><pre
              class="screen"><code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt --reinstall install postfix</code></strong></pre><div
              class="para">
				Команда <code
                class="command">aptitude</code> немного отличается, но позволяет достичь такого же результата: <code
                class="command">aptitude reinstall postfix</code>.
			</div><div
              class="para">
				Такая проблема не возникает при использовании <code
                class="command">dpkg</code>, но сама команда редко используется.
			</div><div
              class="para">
				Будьте осторожны! Использование <code
                class="command">apt --reinstall</code> для восстановления пакетов изменённых во время атак не восстановит систему до прежнего состояния. <a
                class="xref"
                href="sect.dealing-with-compromised-machine.html">Раздел 14.7, «Dealing with a Compromised Machine»</a> содержит подробную информацию по восстановлению систем, подвергнувшихся атаке злоумышленниками.
			</div></div><div
            class="para">
				Если в файле <code
              class="filename">sources.list</code> упоминается несколько дистрибутивов, можно задать версию пакета для установки. Номер версии может быть запрошен, используя <code
              class="command">apt install <em
                class="replaceable">packet</em>= <em
                class="replaceable">version</em></code>, с указанием происхождения (<span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span> или <span
              class="distribution distribution">Unstable</span>) — <code
              class="command">apt install <em
                class="replaceable">package</em>/<em
                class="replaceable">distribution</em></code> — обычно предпочтительно. Используя эту команду можно вернуться к старой версии пакета (если например вы знаете, что она работает хорошо), при условии, что он по-прежнему доступен в одном из источников, на которые ссылается файл <code
              class="filename">sources.list</code>. В противном случае может помочь архив <code
              class="literal">snapshot.debian.org</code> (см. <a
              class="xref"
              href="apt.html#sidebar.snapshot.debian.org"><span
                class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Старые версии пакетов: <code
                class="literal">snapshot.debian.org</code></a>).
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.9.11.8.20"></a><p
              class="title"><strong>Пример 6.3. Установка <span
                  class="distribution distribution">unstable</span> версии <span
                  class="pkg pkg">spamassassin</span></strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>apt install spamassassin/unstable</code></strong></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Кэш файлов <code
                        class="filename">.deb</code></strong></p></div></div></div><div
              class="para">
				APT сохраняет копию каждого загруженного <code
                class="filename">.deb</code> файла в каталоге <code
                class="filename">/var/cache/apt/archives/</code>. В случае частых обновлений этот каталог может занять много места на диске и иметь несколько версий одного пакета. Для очистки можно использовать две команды: <code
                class="command">apt clean</code> полностью очищает каталог; <code
                class="command">apt-get autoclean</code> удаляет пакеты, которые не могут быть больше загружены (потому что они исчезли из зеркала Debian) и поэтому явно бесполезны (параметр конфигурации <code
                class="literal">APT::Clean-Installed</code> может предотвратить удаление файлов <code
                class="filename">.deb</code> которые установлены). Обратите внимание, что <code
                class="command">apt</code> не поддерживает эти команды.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-upgrade"></a>6.2.3. Обновление системы</h3></div></div></div><a
            id="id-1.9.11.9.2"
            class="indexterm"></a><a
            id="id-1.9.11.9.3"
            class="indexterm"></a><a
            id="id-1.9.11.9.4"
            class="indexterm"></a><a
            id="id-1.9.11.9.5"
            class="indexterm"></a><div
            class="para">
				Регулярные обновления рекомендуется, поскольку они включают последние обновления системы безопасности. Для обновления, используйте <code
              class="command">apt upgrade</code>, <code
              class="command">apt-get upgrade</code> или <code
              class="command">aptitude safe-upgrade</code> (конечно после использования <code
              class="command">apt update</code>). Эта команда ищет установленные пакеты, которые можно обновить без удаления других пакетов. Другими словами цель заключается в том, чтобы обеспечить наименее ограничительное возможность установки обновлений. Команда <code
              class="command">apt-get</code> является немного более требовательной, чем <code
              class="command">aptitude</code> или <code
              class="command">apt</code> потому что она не будет устанавливать пакеты, которые не были установлены до этого.
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.apt-pdiff"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> Инкрементальное обновление</strong></p></div></div></div><div
              class="para">
				Как мы уже выяснили ранее, целью команды <code
                class="command">apt update</code> является загрузка каждого исходного пакета (package source) соответствующего файлу <code
                class="filename">Packages</code> (или <code
                class="filename">Sources</code>). Тем не менее, даже после сжатия <code
                class="command">bzip2</code> эти файлы остаются довольно большими (размер файла <code
                class="filename">Packages.xz</code> в <span
                class="foreignphrase"><em
                  class="foreignphrase">основной</em></span> части <span
                class="distribution distribution">Jessie</span> занимает более 6 Мбайт). Если вы хотите обновляться регулярно, то загрузка может занимать много времени.
			</div><div
              class="para">
				Чтобы ускорить этот процесс APT может загружать “diff” файлы содержащие изменения с момента предыдущего обновления вместо загрузки всего файла целиком. Для достижения этой цели официальные зеркала Debian распространяют файлы различий, в которых содержится список изменений между одной версией файла <code
                class="filename">Packages</code> от следующей версии. Они генерируются с каждым обновлением архивов, а история сохраняется в течение одной недели. Каждый из этих «diff» файлов занимает несколько десятков килобайт для <span
                class="distribution distribution">Unstable</span>, так что количество загружаемых еженедельных данных <code
                class="command">apt update</code> зачастую становится меньше в десять раз. Для дистрибутивов таких как Debian <span
                class="distribution distribution">Stable</span> и <span
                class="distribution distribution">Testing</span>, в которые вносится меньше изменений, выигрыш становится ещё более заметным.
			</div><div
              class="para">
				Однако, иногда необходимо принудительно загрузить целый файл <code
                class="filename">Packages</code>. Это обычно происходит в случаях, когда последнее обновление сильно устарело, а выполненные пошаговые обновления не особо помогли. Это также может представлять интерес, если доступ к сети очень быстрый, но процессор компьютера довольно медленный для процесса обновления. Так как время загрузки файла будет меньше, чем время, затраченное компьютером на вычисление новых версии этих файлов (начиная с более старых версий и применяя загруженные различия). Чтобы это сделать, вы можете использовать параметр конфигурации <code
                class="literal">Acquire::Pdiffs</code> и установить его значение в <code
                class="literal">false</code>.
			</div></div><div
            class="para">
				<code
              class="command">apt</code> обычно будет выбирать последние версии (за исключением пакетов из <span
              class="distribution distribution">Experimental</span> и <span
              class="distribution distribution">stable-backports</span>, которые игнорируются независимо от номера версии). Если вы указали <span
              class="distribution distribution">Testing</span> или <span
              class="distribution distribution">Unstable</span> в своем <code
              class="filename">sources.list</code>, <code
              class="command">apt upgrade</code> переключит большую часть вашей системы со <span
              class="distribution distribution">Stable</span> на <span
              class="distribution distribution">Testing</span> или <span
              class="distribution distribution">Unstable</span>, что может быть не тем, чего вы ожидали.
			</div><div
            class="para">
				Чтобы <code
              class="command">apt</code> искал обновлённые версии пакетов для определённого дистрибутива, используйте опцию <code
              class="literal">-t</code> или <code
              class="literal">--target-release</code>. После опции надо указать название выбранного вами дистрибутива (например: <code
              class="command">apt -t stable upgrade</code>). Чтобы не указывать эту опцию каждый раз , когда вы используете <code
              class="command">apt</code>, вы можете добавить <code
              class="literal">APT::Default-Release "stable";</code> в файл <code
              class="filename">/etc/apt/apt.conf.d/local</code>.
			</div><a
            id="id-1.9.11.9.10"
            class="indexterm"></a><a
            id="id-1.9.11.9.11"
            class="indexterm"></a><a
            id="id-1.9.11.9.12"
            class="indexterm"></a><a
            id="id-1.9.11.9.13"
            class="indexterm"></a><a
            id="id-1.9.11.9.14"
            class="indexterm"></a><div
            class="para">
				Для более важных обновлений, таких как переход от одной основной версии Debian к следующей, вы должны использовать <code
              class="command">apt full-upgrade</code>. С помощью этой инструкции <code
              class="command">apt</code> выполнит обновление, при этом он удалит некоторые устаревшие пакеты и установит новые зависимости. Также эта команда используется пользователями, которые ежедневно работают с <span
              class="distribution distribution">Unstable</span> выпуском Debian и следят за его развитием день за днем. Это так просто, что вряд ли нуждается в объяснении: репутация APT основана на большой функциональности.
			</div><div
            class="para">
				В отличие от <code
              class="command">apt</code> и <code
              class="command">aptitude</code>, <code
              class="command">apt-get</code> не знает команды <code
              class="command">full-upgrade</code>. Вместо этого, вы должны использовать <code
              class="command">apt-get dist-upgrade</code> («обновление дистрибутива»). <code
              class="command">apt</code> и <code
              class="command">aptitude</code> также принимают эту историческую и хорошо известную команду для удобства тех пользователей, которые привыкли пользоваться ей.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-config"></a>6.2.4. Параметры конфигурации</h3></div></div></div><a
            id="id-1.9.11.10.2"
            class="indexterm"></a><a
            id="id-1.9.11.10.3"
            class="indexterm"></a><a
            id="id-1.9.11.10.4"
            class="indexterm"></a><div
            class="para">
				Кроме уже упомянутых деталей конфигурации, можно сделать дополнительную настройку APT. Для этого надо внести дополнительные параметры в файл , расположенный в <code
              class="filename"> /etc/apt/apt.conf.d/</code>. Помните, что APT может указать <code
              class="command"> dpkg</code> игнорировать конфликты файлов, установив <code
              class="literal"> DPkg::options { "--force-overwrite"; }</code>.
			</div><div
            class="para">
				If the Web can only be accessed through a proxy, add a line like <code
              class="literal">Acquire::http::proxy "http://<em
                class="replaceable">yourproxy</em>:3128"</code>. For an FTP proxy, write <code
              class="literal">Acquire::ftp::proxy "ftp://<em
                class="replaceable">yourproxy</em>"</code>. To discover more configuration options, read the <span
              class="citerefentry"><span
                class="refentrytitle">apt.conf</span>(5)</span> manual page with the <code
              class="command">man apt.conf</code> command (for details on manual pages, see <a
              class="xref"
              href="solving-problems.html#sect.manual-pages">Раздел 7.1.1, «Страницы руководств»</a>).
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.directory.d"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ВЕРНЁМСЯ К ОСНОВАМ</em></span> Каталоги, оканчивающиеся на <code
                        class="filename">.d</code></strong></p></div></div></div><a
              id="id-1.9.11.10.7.2"
              class="indexterm"></a><div
              class="para">
				Каталоги, название которых заканчивается на <code
                class="filename">.d</code>, встречаются всё чаще и чаще. Каждый каталог представляет собой конфигурационный файл, разделенный на несколько файлов . Таким образом все файлы в <code
                class="filename">/etc/apt/apt.conf.d/</code> это инструкции, настраивающие APT. APT применяет их в алфавитном порядке, поэтому более поздняя инструкция может изменять параметры, установленные предшествующим ей инструкциями.
			</div><div
              class="para">
				Такая система создает некоторую гибкость как для администраторов, так и для разработчиков. Администратор может легко изменять настройки программы добавляя уже готовый файл настроек в такой каталог и не изменяя уже существующий файл настроек. Разработчик пакета точно так же адаптирует конфигурацию другой программы, чтобы она наилучшим образом взаимодействовала с его. Политики Debian явно запрещают изменений конфигурации других пакетов — это допустимо делать только пользователям. Помните, что во время обновления пакета, если было обнаружено внесение изменений в файл конфигурации, то пользователю будет предложено выбрать какую версию файла конфигурации оставить. Любое стороннее изменение файла вызовет такой запрос, что обеспокоит администратора, который уверен, что точно ничего не менял.
			</div><div
              class="para">
				Without a <code
                class="filename">.d</code> directory, it is impossible for an external package to change the settings of a program without modifying its configuration file. Instead it must invite the user to do it themselves and lists the operations to be done in the file <code
                class="filename">/usr/share/doc/<em
                  class="replaceable">package</em>/README.Debian</code>.
			</div><div
              class="para">
				Depending on the application, the <code
                class="filename">.d</code> directory is used directly or managed by an external script which will concatenate all the files to create the configuration file itself. It is important to execute the script after any change in that directory so that the most recent modifications are taken into account. In the same way, it is important not to work directly in the configuration file created automatically, since everything would be lost at the next execution of the script. The chosen method (<code
                class="filename">.d</code> directory used directly or a file generated from that directory) is usually dictated by implementation constraints, but in both cases the gains in terms of configuration flexibility more than make up for the small complications that they entail. The Exim 4 mail server is an example of the generated file method: it can be configured through several files (<code
                class="filename">/etc/exim4/conf.d/*</code>) which are concatenated into <code
                class="filename">/var/lib/exim4/config.autogenerated</code> by the <code
                class="command">update-exim4.conf</code> command.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt.priorities"></a>6.2.5. Управление приоритетами пакетов</h3></div></div></div><div
            class="para">
				Один из многих важных аспектов в конфигурировании APT-а является управление приоритетами, ассоциироваными с каждым исходным пакетом. Для примера, ты можешь захотеть расширить дистибутив (к примеру стабильный - Stable) одним или двуми пакетами из других дистибутивов <span
              class="distribution distribution"> тестируемый (Testing) </span> , <span
              class="distribution distribution"> нестабильный (Unstable) </span> или <span
              class="distribution distribution"> экспериментальный (Experimental) </span>. В этом случае имеется возможность определить приоритеты каждого доступного пакета (некоторые пакеты могут иметь свои приоритеты зависимостей к их версии или распространение -дистрибьютор предоставляет это). Те приоритеты будут влиять на поведение APT-а: для каждого пакета всегда будет выбираться версия с высочайшим приоритетом (кроме случаев, когда версия более старая, чем установлена в системе такая же и если его приоритет - меньше чем 1000).
			</div><a
            id="id-1.9.11.11.3"
            class="indexterm"></a><a
            id="id-1.9.11.11.4"
            class="indexterm"></a><a
            id="id-1.9.11.11.5"
            class="indexterm"></a><a
            id="id-1.9.11.11.6"
            class="indexterm"></a><a
            id="id-1.9.11.11.7"
            class="indexterm"></a><a
            id="id-1.9.11.11.8"
            class="indexterm"></a><a
            id="id-1.9.11.11.9"
            class="indexterm"></a><div
            class="para">
				APT определяет свои приоритеты по умолчанию. Каждая версия устанавливаемого пакета имеет приоритер 100. Не установленная версия имеет приоритет 500 по умолчанию, но это может прыгнуть (измениться) до 990 если это есть часть целевого (выпускаемого) релиза (определяется с <code
              class="literal">-t</code> опция командной строки или <code
              class="literal">APT::Default-Release</code> конфигурирование указание).
			</div><div
            class="para">
				Ты можешь изменить (модифицировать) приоритеты путем дополнения записей в <code
              class="filename">/etc/apt/preferences</code> файл с именами затрагиваемых пакетов, их версия, оригинальные (первоначальные) и их новые приоритеты.
			</div><div
            class="para">
				APT will never install an older version of a package (that is, a package whose version number is lower than the one of the currently installed package) except if its priority is higher than 1000. APT will always install the highest priority package which follows this constraint. If two packages have the same priority, APT installs the newest one (whose version number is the highest). If two packages of same version have the same priority but differ in their content, APT installs the version that is not installed (this rule has been created to cover the case of a package update without the increment of the revision number, which is usually required).
			</div><div
            class="para">
				In more concrete terms, a package whose priority is less than 0 will never be installed. A package with a priority ranging between 0 and 100 will only be installed if no other version of the package is already installed. With a priority between 100 and 500, the package will only be installed if there is no other newer version installed or available in another distribution. A package of priority between 501 and 990 will only be installed if there is no newer version installed or available in the target distribution. With a priority between 990 and 1000, the package will be installed except if the installed version is newer. A priority greater than 1000 will always lead to the installation of the package even if it forces APT to downgrade to an older version.
			</div><div
            class="para">
				When APT checks <code
              class="filename">/etc/apt/preferences</code>, it first takes into account the most specific entries (often those specifying the concerned package), then the more generic ones (including for example all the packages of a distribution). If several generic entries exist, the first match is used. The available selection criteria include the package's name and the source providing it. Every package source is identified by the information contained in a <code
              class="filename">Release</code> file that APT downloads together with the <code
              class="filename">Packages</code> files. It specifies the origin (usually “Debian” for the packages of official mirrors, but it can also be a person's or an organization's name for third-party repositories). It also gives the name of the distribution (usually <span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span>, <span
              class="distribution distribution">Unstable</span> or <span
              class="distribution distribution">Experimental</span> for the standard distributions provided by Debian) together with its version (for example 8 for Debian <span
              class="distribution distribution">Jessie</span>). Let's have a look at its syntax through some realistic case studies of this mechanism.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SPECIFIC CASE</em></span> Priority of <span
                        class="distribution distribution">experimental</span></strong></p></div></div></div><a
              id="id-1.9.11.11.15.2"
              class="indexterm"></a><div
              class="para">
				If you listed <span
                class="distribution distribution">Experimental</span> in your <code
                class="filename">sources.list</code> file, the corresponding packages will almost never be installed because their default APT priority is 1. This is of course a specific case, designed to keep users from installing <span
                class="distribution distribution">Experimental</span> packages by mistake. The packages can only be installed by typing <code
                class="command">aptitude install <em
                  class="replaceable">package</em>/experimental</code> — users typing this command can only be aware of the risks that they take. It is still possible (though <span
                class="emphasis"><em>not</em></span> recommended) to treat packages of <span
                class="distribution distribution">Experimental</span> like those of other distributions by giving them a priority of 500. This is done with a specific entry in <code
                class="filename">/etc/apt/preferences</code>:
			</div><div
              class="informalexample"><pre
                class="programlisting">Package: *
Pin: release a=experimental
Pin-Priority: 500
</pre></div></div><div
            class="para">
				Let's suppose that you only want to use packages from the stable version of Debian. Those provided in other versions should not be installed except if explicitly requested. You could write the following entries in the <code
              class="filename">/etc/apt/preferences</code> file:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: *
Pin: release a=stable
Pin-Priority: 900

Package: *
Pin: release o=Debian
Pin-Priority: -10
</pre></div><div
            class="para">
				<code
              class="literal">a=stable</code> defines the name of the selected distribution. <code
              class="literal">o=Debian</code> limits the scope to packages whose origin is “Debian”.
			</div><div
            class="para">
				Let's now assume that you have a server with several local programs depending on the version 5.14 of Perl and that you want to ensure that upgrades will not install another version of it. You could use this entry:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: perl
Pin: version 5.14*
Pin-Priority: 1001
</pre></div><div
            class="para">
				The reference documentation for this configuration file is available in the manual page <span
              class="citerefentry"><span
                class="refentrytitle">apt_preferences</span>(5)</span>, which you can display with <code
              class="command">man apt_preferences</code>.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> Comments in <code
                        class="filename">/etc/apt/preferences</code></strong></p></div></div></div><a
              id="id-1.9.11.11.22.2"
              class="indexterm"></a><a
              id="id-1.9.11.11.22.3"
              class="indexterm"></a><a
              id="id-1.9.11.11.22.4"
              class="indexterm"></a><div
              class="para">
				There is no official syntax to put comments in the <code
                class="filename">/etc/apt/preferences</code> file, but some textual descriptions can be provided by putting one or more “<code
                class="literal">Explanation</code>” fields at the start of each entry:
			</div><div
              class="informalexample"><pre
                class="programlisting">Explanation: The package xserver-xorg-video-intel provided
Explanation: in experimental can be used safely
Package: xserver-xorg-video-intel
Pin: release a=experimental
Pin-Priority: 500
</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-mix-distros"></a>6.2.6. Working with Several Distributions</h3></div></div></div><div
            class="para">
				<code
              class="command">apt</code> being such a marvelous tool, it is tempting to pick packages coming from other distributions. For example, after having installed a <span
              class="distribution distribution">Stable</span> system, you might want to try out a software package available in <span
              class="distribution distribution">Testing</span> or <span
              class="distribution distribution">Unstable</span> without diverging too much from the system's initial state.
			</div><div
            class="para">
				Even if you will occasionally encounter problems while mixing packages from different distributions, <code
              class="command">apt</code> manages such coexistence very well and limits risks very effectively. The best way to proceed is to list all distributions used in <code
              class="filename">/etc/apt/sources.list</code> (some people always put the three distributions, but remember that <span
              class="distribution distribution">Unstable</span> is reserved for experienced users) and to define your reference distribution with the <code
              class="literal">APT::Default-Release</code> parameter (see <a
              class="xref"
              href="sect.apt-get.html#sect.apt-upgrade">Раздел 6.2.3, «Обновление системы»</a>).
			</div><div
            class="para">
				Let's suppose that <span
              class="distribution distribution">Stable</span> is your reference distribution but that <span
              class="distribution distribution">Testing</span> and <span
              class="distribution distribution">Unstable</span> are also listed in your <code
              class="filename">sources.list</code> file. In this case, you can use <code
              class="command">apt install <em
                class="replaceable">package</em>/testing</code> to install a package from <span
              class="distribution distribution">Testing</span>. If the installation fails due to some unsatisfiable dependencies, let it solve those dependencies within <span
              class="distribution distribution">Testing</span> by adding the <code
              class="literal">-t testing</code> parameter. The same obviously applies to <span
              class="distribution distribution">Unstable</span>.
			</div><div
            class="para">
				In this situation, upgrades (<code
              class="command">upgrade</code> and <code
              class="command">full-upgrade</code>) are done within <span
              class="distribution distribution">Stable</span> except for packages already upgraded to another distribution: those will follow updates available in the other distributions. We will explain this behavior with the help of the default priorities set by APT below. Do not hesitate to use <code
              class="command">apt-cache policy</code> (see sidebar <a
              class="xref"
              href="sect.apt-get.html#sidebar.apt-cache-policy"><span
                class="emphasis"><em>TIP</em></span> <code
                class="command">apt-cache policy</code></a>) to verify the given priorities.
			</div><div
            class="para">
				Everything centers around the fact that APT only considers packages of higher or equal version than the installed one (assuming that <code
              class="filename">/etc/apt/preferences</code> has not been used to force priorities higher than 1000 for some packages).
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.apt-cache-policy"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> <code
                        class="command">apt-cache policy</code></strong></p></div></div></div><div
              class="para">
				To gain a better understanding of the mechanism of priority, do not hesitate to execute <code
                class="command">apt-cache policy</code> to display the default priority associated with each package source. You can also use <code
                class="command">apt-cache policy <em
                  class="replaceable">package</em></code> to display the priorities of all available versions of a given package.
			</div></div><div
            class="para">
				Let's assume that you have installed version 1 of a first package from <span
              class="distribution distribution">Stable</span> and that version 2 and 3 are available respectively in <span
              class="distribution distribution">Testing</span> and <span
              class="distribution distribution">Unstable</span>. The installed version has a priority of 100 but the version available in <span
              class="distribution distribution">Stable</span> (the very same) has a priority of 990 (because it is part of the target release). Packages in <span
              class="distribution distribution">Testing</span> and <span
              class="distribution distribution">Unstable</span> have a priority of 500 (the default priority of a non-installed version). The winner is thus version 1 with a priority of 990. The package “stays in <span
              class="distribution distribution">Stable</span>”.
			</div><div
            class="para">
				Let's take the example of another package whose version 2 has been installed from <span
              class="distribution distribution">Testing</span>. Version 1 is available in <span
              class="distribution distribution">Stable</span> and version 3 in <span
              class="distribution distribution">Unstable</span>. Version 1 (of priority 990 — thus lower than 1000) is discarded because it is lower than the installed version. This only leaves version 2 and 3, both of priority 500. Faced with this alternative, APT selects the newest version, the one from <span
              class="distribution distribution">Unstable</span>.If you don't want a package installed from <span
              class="distribution distribution">Testing</span> to migrate to <span
              class="distribution distribution">Unstable</span>, you have to assign a priority lower than 500 (490 for example) to packages coming from <span
              class="distribution distribution">Unstable</span>. You can modify <code
              class="filename">/etc/apt/preferences</code> to this effect:
			</div><pre
            class="programlisting">Package: *
Pin: release a=unstable
Pin-Priority: 490
</pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.automatic-tracking"></a>6.2.7. Tracking Automatically Installed Packages</h3></div></div></div><div
            class="para">
				One of the essential functionalities of <code
              class="command">apt</code> is the tracking of packages installed only through dependencies. These packages are called “automatic”, and often include libraries for instance.
			</div><div
            class="para">
				With this information, when packages are removed, the package managers can compute a list of automatic packages that are no longer needed (because there is no “manually installed” packages depending on them). <code
              class="command">apt-get autoremove</code> will get rid of those packages. <code
              class="command">aptitude</code> and <code
              class="command">apt</code> do not have this command: the former because it removes them automatically as soon as they are identified, and the latter probably because the user should not have to manually run such a command. In all cases, the tools display a clear message listing the affected packages.
			</div><a
            id="id-1.9.11.13.4"
            class="indexterm"></a><a
            id="id-1.9.11.13.5"
            class="indexterm"></a><a
            id="id-1.9.11.13.6"
            class="indexterm"></a><a
            id="id-1.9.11.13.7"
            class="indexterm"></a><div
            class="para">
				It is a good habit to mark as automatic any package that you don't need directly so that they are automatically removed when they aren't necessary anymore. <code
              class="command">apt-mark auto <em
                class="replaceable">package</em></code> will mark the given package as automatic whereas <code
              class="command">apt-mark manual <em
                class="replaceable">package</em></code> does the opposite. <code
              class="command">aptitude markauto</code> and <code
              class="command">aptitude unmarkauto</code> work in the same way although they offer more features for marking many packages at once (see <a
              class="xref"
              href="sect.apt-frontends.html#sect.aptitude">Раздел 6.4.1, «<code
                class="command">aptitude</code>»</a>). The console-based interactive interface of <code
              class="command">aptitude</code> also makes it easy to review the “automatic flag” on many packages.
			</div><a
            id="id-1.9.11.13.9"
            class="indexterm"></a><div
            class="para">
				People might want to know why an automatically installed package is present on the system. To get this information from the command line, you can use <code
              class="command">aptitude why <em
                class="replaceable">package</em></code> (<code
              class="command">apt</code> and <code
              class="command">apt-get</code> have no similar feature):
			</div><pre
            class="screen"><code
              class="computeroutput">$ </code><strong
              class="userinput"><code>aptitude why python-debian
</code></strong><code
              class="computeroutput">i   aptitude         Recommends apt-xapian-index         
i A apt-xapian-index Depends    python-debian (&gt;= 0.1.15)
</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIVE</em></span> <code
                        class="command">deborphan</code> and <code
                        class="command">debfoster</code></strong></p></div></div></div><a
              id="id-1.9.11.13.12.2"
              class="indexterm"></a><a
              id="id-1.9.11.13.12.3"
              class="indexterm"></a><div
              class="para">
				In days where <code
                class="command">apt</code>, <code
                class="command">apt-get</code> and <code
                class="command">aptitude</code> were not able to track automatic packages, there were two utilities producing lists of unnecessary packages: <code
                class="command">deborphan</code> and <code
                class="command">debfoster</code>.
			</div><div
              class="para">
				<code
                class="command">deborphan</code> is the most rudimentary of both. It simply scans the <code
                class="literal">libs</code> and <code
                class="literal">oldlibs</code> sections (in the absence of supplementary instructions) looking for the packages that are currently installed and that no other package depends on. The resulting list can then serve as a basis to remove unneeded packages.
			</div><div
              class="para">
				<code
                class="command">debfoster</code> has a more elaborate approach, very similar to APT's one: it maintains a list of packages that have been explicitly installed, and remembers what packages are really required between each invocation. If new packages appear on the system and if <code
                class="command">debfoster</code> doesn't know them as required packages, they will be shown on the screen together with a list of their dependencies. The program then offers a choice: remove the package (possibly together with those that depend on it), mark it as explicitly required, or ignore it temporarily.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>Пред.</strong>Глава 6. Обслуживание и обновление: инструменты A...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>След.</strong>6.3. The apt-cache Command</a></li></ul></body></html>
