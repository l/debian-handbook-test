<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">6.2. Команды aptitude, apt-get и apt</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ru-RU-1.0-1" /><meta
        name="keywords"
        content="apt, apt-get, apt-cache, aptitude, synaptic, sources.list, apt-cdrom" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="apt.html"
        title="Глава 6. Обслуживание и обновление: инструменты APT" /><link
        rel="prev"
        href="apt.html"
        title="Глава 6. Обслуживание и обновление: инструменты APT" /><link
        rel="next"
        href="sect.apt-cache.html"
        title="6.3. Команда apt-cache" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ru-RU/stable/sect.apt-get.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>След.</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.apt-get"></a>6.2. Команды <code
                  class="command">aptitude</code>, <code
                  class="command">apt-get</code> и <code
                  class="command">apt</code></h2></div></div></div><a
          id="id-1.9.11.2"
          class="indexterm"></a><a
          id="id-1.9.11.3"
          class="indexterm"></a><a
          id="id-1.9.11.4"
          class="indexterm"></a><div
          class="para">
			APT является большим проектом, в исходные планы которого входило создание графического интерфейса. Он основан на библиотеке, которая содержит приложение ядра, а <code
            class="command">apt-get</code> является первым интерфейсом (основанным на режиме командной строки), который был разработан в рамках этого проекта. <code
            class="command">apt</code> является вторым интерфейсом командной строки, предоставляемым APT, который устраняет некоторые ошибки проектирования <code
            class="command">apt-get</code>.
		</div><div
          class="para">
			Большое число графических интерфейсов появилось позже как внешние проекты: <code
            class="command">synaptic</code>, <code
            class="command">aptitude</code> (который включает и текстовый интерфейс, и графический — хоть и не завершённый до сих пор), <code
            class="command">wajig</code>, и т.д. Наиболее рекомендуемый интерфейс, <code
            class="command">apt</code>, мы будем использовать в примерах, приведённых в этом разделе. Обратите внимание, что <code
            class="command">apt-get</code> и <code
            class="command">aptitude</code> имеют весьма схожий синтаксис командной строки. В случае, когда существуют значительные различия между <code
            class="command">apt</code>, <code
            class="command">apt-get</code> и <code
            class="command">aptitude</code>, эти различия будут разобраны более подробно.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.11.7"></a>6.2.1. Инициализация</h3></div></div></div><div
            class="para">
				При необходимости работы с APT должен быть обновлён список доступных пакетов; это просто сделать с помощью команды <code
              class="command">apt update</code>. В зависимости от скорости вашего соединения, эта операция может занять достаточно времени, поскольку она включает загрузку определённого числа <code
              class="filename">Packages</code>/<code
              class="filename">Sources</code>/<code
              class="filename">Translation-<em
                class="replaceable">language-code</em></code> файлов, которые постепенно становятся всё больше и больше в процессе разработки Debian (по меньшей мере 10 МБ данных для секции <code
              class="literal">main</code>). Конечно, установка с набора CD-ROM не требует никакой загрузки — в этом случае операция является очень быстрой.
			</div><a
            id="id-1.9.11.7.3"
            class="indexterm"></a><a
            id="id-1.9.11.7.4"
            class="indexterm"></a><a
            id="id-1.9.11.7.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.11.8"></a>6.2.2. Установка и удаление</h3></div></div></div><a
            id="id-1.9.11.8.2"
            class="indexterm"></a><a
            id="id-1.9.11.8.3"
            class="indexterm"></a><a
            id="id-1.9.11.8.4"
            class="indexterm"></a><a
            id="id-1.9.11.8.5"
            class="indexterm"></a><div
            class="para">
				С помощью APT пакеты могут быть добавлены или удалены из системы командами <code
              class="command">apt install <em
                class="replaceable">пакет</em></code> and <code
              class="command">apt remove <em
                class="replaceable">пакет</em></code> соответственно. В обоих случаях APT автоматически установит необходимые пакеты, от которого зависит данный, или удалит пакеты, которые зависят от удаляемого пакета. Команды <code
              class="command">apt purge <em
                class="replaceable">пакет</em></code> вызывают полное удаление — файлы настройки также будут удалены.
			</div><a
            id="id-1.9.11.8.7"
            class="indexterm"></a><a
            id="id-1.9.11.8.8"
            class="indexterm"></a><a
            id="id-1.9.11.8.9"
            class="indexterm"></a><a
            id="id-1.9.11.8.10"
            class="indexterm"></a><a
            id="id-1.9.11.8.11"
            class="indexterm"></a><a
            id="id-1.9.11.8.12"
            class="indexterm"></a><a
            id="id-1.9.11.8.13"
            class="indexterm"></a><a
            id="id-1.9.11.8.14"
            class="indexterm"></a><a
            id="id-1.9.11.8.15"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> Установка одного и того же набора пакетов несколько раз</strong></p></div></div></div><div
              class="para">
				Это может оказаться полезным при установке одного и того же перечня пакетов на различные компьютеры. И это может быть сделано достаточно просто.
			</div><div
              class="para">
				Во-первых, необходимо определить перечень пакетов, установленных на компьютере, который будет служить "моделью" для копирования.
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --get-selections &gt;pkg-list</code></strong></pre><div
              class="para">
				После этого файл <code
                class="filename">pkg-list</code> будет содержать перечень установленных пактов. Следующим шагом необходимо передать файл <code
                class="filename">pkg-list</code> на компьютеры, на которых необходимо произвести обновление, и использовать следующие команды:
			</div><pre
              class="screen">## Обновить базу данных dpkg's об известных пакетах
# <strong
                class="userinput"><code>avail=`mktemp`</code></strong>
# <strong
                class="userinput"><code>apt-cache dumpavail &gt; "$avail"</code></strong>
# <strong
                class="userinput"><code>dpkg --merge-avail "$avail"</code></strong>
# <strong
                class="userinput"><code>rm -f "$avail"</code></strong>
## Обновить выбор dpkg's
# <strong
                class="userinput"><code>dpkg --set-selections &lt; pkg-list</code></strong>
## Запросить у apt-get установку выбранных пакетов
# <strong
                class="userinput"><code>apt-get dselect-upgrade</code></strong></pre><div
              class="para">
				Первая команда записывает перечень доступных пакетов в базу данных dpkg database, затем <code
                class="command">dpkg --set-selections</code> восстанавливает выбор пакетов, которые вы хотите установить, а вызов <code
                class="command">apt-get</code> выполняет требуемые операции! <code
                class="command">aptitude</code> не имеет этой команды.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> Удаление и установка в одной команде</strong></p></div></div></div><div
              class="para">
				Можно использовать <code
                class="command">apt</code> (или <code
                class="command">apt-get</code>, или <code
                class="command">aptitude</code>) для установки одних пакетов и удаления других одной командой путем добавления суффикса. Используя <code
                class="command">apt install</code> добавьте «<code
                class="literal">–</code>» к именам пакетов, которые вы хотите удалить. Для <code
                class="command">apt remove</code> добавьте «<code
                class="literal">+</code>» к именам пакетов, которые вы хотите установить.
			</div><div
              class="para">
				В следующем примере показано два разных способа для установки <em
                class="replaceable">packet1</em> и удаления <em
                class="replaceable">packet2</em>.
			</div><pre
              class="screen"># <strong
                class="userinput"><code>apt install <em
                    class="replaceable">package1</em> <em
                    class="replaceable">package2-</em></code></strong>
[...]
# <strong
                class="userinput"><code>apt remove <em
                    class="replaceable">package1+</em> <em
                    class="replaceable">package2</em></code></strong>
[...]</pre><div
              class="para">
				Это можно использовать для исключения пакетов, которые бы в противном случае были установлены, например из-за <code
                class="literal">Recommends</code>. В общем для разрешения зависимостей будет использована эта информация как подсказка для поиска альтернативных решений.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> <code
                        class="command">apt --reinstall</code> и <code
                        class="command">aptitude reinstall</code></strong></p></div></div></div><a
              id="id-1.9.11.8.18.2"
              class="indexterm"></a><div
              class="para">
				После удаления или изменения файлов в пакете, система может быть повреждена. Самый простой способ для восстановления этих файлов является переустановка таких пакет. К сожалению, система упаковки считает, что пакет уже установлен и вежливо отказывается переустановить его. Чтобы избежать этого, добавьте <code
                class="literal">--reinstall</code> к <code
                class="command">apt</code> или <code
                class="command">apt-get</code>. Следующая команда переустановит <span
                class="pkg pkg">postfix</span> даже если он уже установлен:
			</div><pre
              class="screen"><code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt --reinstall install postfix</code></strong></pre><div
              class="para">
				Команда <code
                class="command">aptitude</code> немного отличается, но позволяет достичь такого же результата: <code
                class="command">aptitude reinstall postfix</code>.
			</div><div
              class="para">
				Такая проблема не возникает при использовании <code
                class="command">dpkg</code>, но сама команда редко используется.
			</div><div
              class="para">
				Будьте осторожны! Использование <code
                class="command">apt --reinstall</code> для восстановления пакетов изменённых во время атак не восстановит систему до прежнего состояния. <a
                class="xref"
                href="sect.dealing-with-compromised-machine.html">Раздел 14.7, «Dealing with a Compromised Machine»</a> содержит подробную информацию по восстановлению систем, подвергнувшихся атаке злоумышленниками.
			</div></div><div
            class="para">
				Если в файле <code
              class="filename">sources.list</code> упоминается несколько дистрибутивов, можно задать версию пакета для установки. Номер версии может быть запрошен, используя <code
              class="command">apt install <em
                class="replaceable">packet</em>= <em
                class="replaceable">version</em></code>, с указанием происхождения (<span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span> или <span
              class="distribution distribution">Unstable</span>) — <code
              class="command">apt install <em
                class="replaceable">package</em>/<em
                class="replaceable">distribution</em></code> — обычно предпочтительно. Используя эту команду можно вернуться к старой версии пакета (если например вы знаете, что она работает хорошо), при условии, что он по-прежнему доступен в одном из источников, на которые ссылается файл <code
              class="filename">sources.list</code>. В противном случае может помочь архив <code
              class="literal">snapshot.debian.org</code> (см. <a
              class="xref"
              href="apt.html#sidebar.snapshot.debian.org"><span
                class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Старые версии пакетов: <code
                class="literal">snapshot.debian.org</code></a>).
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.9.11.8.20"></a><p
              class="title"><strong>Пример 6.3. Установка <span
                  class="distribution distribution">unstable</span> версии <span
                  class="pkg pkg">spamassassin</span></strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>apt install spamassassin/unstable</code></strong></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Кэш файлов <code
                        class="filename">.deb</code></strong></p></div></div></div><div
              class="para">
				APT сохраняет копию каждого загруженного <code
                class="filename">.deb</code> файла в каталоге <code
                class="filename">/var/cache/apt/archives/</code>. В случае частых обновлений этот каталог может занять много места на диске и иметь несколько версий одного пакета. Для очистки можно использовать две команды: <code
                class="command">apt clean</code> полностью очищает каталог; <code
                class="command">apt-get autoclean</code> удаляет пакеты, которые не могут быть больше загружены (потому что они исчезли из зеркала Debian) и поэтому явно бесполезны (параметр конфигурации <code
                class="literal">APT::Clean-Installed</code> может предотвратить удаление файлов <code
                class="filename">.deb</code> которые установлены). Обратите внимание, что <code
                class="command">apt</code> не поддерживает эти команды.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-upgrade"></a>6.2.3. Обновление системы</h3></div></div></div><a
            id="id-1.9.11.9.2"
            class="indexterm"></a><a
            id="id-1.9.11.9.3"
            class="indexterm"></a><a
            id="id-1.9.11.9.4"
            class="indexterm"></a><a
            id="id-1.9.11.9.5"
            class="indexterm"></a><div
            class="para">
				Регулярные обновления рекомендуется, поскольку они включают последние обновления системы безопасности. Для обновления, используйте <code
              class="command">apt upgrade</code>, <code
              class="command">apt-get upgrade</code> или <code
              class="command">aptitude safe-upgrade</code> (конечно после использования <code
              class="command">apt update</code>). Эта команда ищет установленные пакеты, которые можно обновить без удаления других пакетов. Другими словами цель заключается в том, чтобы обеспечить наименее ограничительное возможность установки обновлений. Команда <code
              class="command">apt-get</code> является немного более требовательной, чем <code
              class="command">aptitude</code> или <code
              class="command">apt</code> потому что она не будет устанавливать пакеты, которые не были установлены до этого.
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.apt-pdiff"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> Инкрементальное обновление</strong></p></div></div></div><div
              class="para">
				Как мы уже выяснили ранее, целью команды <code
                class="command">apt update</code> является загрузка каждого исходного пакета (package source) соответствующего файлу <code
                class="filename">Packages</code> (или <code
                class="filename">Sources</code>). Тем не менее, даже после сжатия <code
                class="command">bzip2</code> эти файлы остаются довольно большими (размер файла <code
                class="filename">Packages.xz</code> в <span
                class="foreignphrase"><em
                  class="foreignphrase">основной</em></span> части <span
                class="distribution distribution">Jessie</span> занимает более 6 Мбайт). Если вы хотите обновляться регулярно, то загрузка может занимать много времени.
			</div><div
              class="para">
				Чтобы ускорить этот процесс APT может загружать “diff” файлы содержащие изменения с момента предыдущего обновления вместо загрузки всего файла целиком. Для достижения этой цели официальные зеркала Debian распространяют файлы различий, в которых содержится список изменений между одной версией файла <code
                class="filename">Packages</code> от следующей версии. Они генерируются с каждым обновлением архивов, а история сохраняется в течение одной недели. Каждый из этих «diff» файлов занимает несколько десятков килобайт для <span
                class="distribution distribution">Unstable</span>, так что количество загружаемых еженедельных данных <code
                class="command">apt update</code> зачастую становится меньше в десять раз. Для дистрибутивов таких как Debian <span
                class="distribution distribution">Stable</span> и <span
                class="distribution distribution">Testing</span>, в которые вносится меньше изменений, выигрыш становится ещё более заметным.
			</div><div
              class="para">
				Однако, иногда необходимо принудительно загрузить целый файл <code
                class="filename">Packages</code>. Это обычно происходит в случаях, когда последнее обновление сильно устарело, а выполненные пошаговые обновления не особо помогли. Это также может представлять интерес, если доступ к сети очень быстрый, но процессор компьютера довольно медленный для процесса обновления. Так как время загрузки файла будет меньше, чем время, затраченное компьютером на вычисление новых версии этих файлов (начиная с более старых версий и применяя загруженные различия). Чтобы это сделать, вы можете использовать параметр конфигурации <code
                class="literal">Acquire::Pdiffs</code> и установить его значение в <code
                class="literal">false</code>.
			</div></div><div
            class="para">
				<code
              class="command">apt</code> обычно будет выбирать последние версии (за исключением пакетов из <span
              class="distribution distribution">Experimental</span> и <span
              class="distribution distribution">stable-backports</span>, которые игнорируются независимо от номера версии). Если вы указали <span
              class="distribution distribution">Testing</span> или <span
              class="distribution distribution">Unstable</span> в своем <code
              class="filename">sources.list</code>, <code
              class="command">apt upgrade</code> переключит большую часть вашей системы со <span
              class="distribution distribution">Stable</span> на <span
              class="distribution distribution">Testing</span> или <span
              class="distribution distribution">Unstable</span>, что может быть не тем, чего вы ожидали.
			</div><div
            class="para">
				Чтобы <code
              class="command">apt</code> искал обновлённые версии пакетов для определённого дистрибутива, используйте опцию <code
              class="literal">-t</code> или <code
              class="literal">--target-release</code>. После опции надо указать название выбранного вами дистрибутива (например: <code
              class="command">apt -t stable upgrade</code>). Чтобы не указывать эту опцию каждый раз , когда вы используете <code
              class="command">apt</code>, вы можете добавить <code
              class="literal">APT::Default-Release "stable";</code> в файл <code
              class="filename">/etc/apt/apt.conf.d/local</code>.
			</div><a
            id="id-1.9.11.9.10"
            class="indexterm"></a><a
            id="id-1.9.11.9.11"
            class="indexterm"></a><a
            id="id-1.9.11.9.12"
            class="indexterm"></a><a
            id="id-1.9.11.9.13"
            class="indexterm"></a><a
            id="id-1.9.11.9.14"
            class="indexterm"></a><div
            class="para">
				Для более важных обновлений, таких как переход от одной основной версии Debian к следующей, вы должны использовать <code
              class="command">apt full-upgrade</code>. С помощью этой инструкции <code
              class="command">apt</code> выполнит обновление, при этом он удалит некоторые устаревшие пакеты и установит новые зависимости. Также эта команда используется пользователями, которые ежедневно работают с <span
              class="distribution distribution">Unstable</span> выпуском Debian и следят за его развитием день за днем. Это так просто, что вряд ли нуждается в объяснении: репутация APT основана на большой функциональности.
			</div><div
            class="para">
				В отличие от <code
              class="command">apt</code> и <code
              class="command">aptitude</code>, <code
              class="command">apt-get</code> не знает команды <code
              class="command">full-upgrade</code>. Вместо этого, вы должны использовать <code
              class="command">apt-get dist-upgrade</code> («обновление дистрибутива»). <code
              class="command">apt</code> и <code
              class="command">aptitude</code> также принимают эту историческую и хорошо известную команду для удобства тех пользователей, которые привыкли пользоваться ей.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-config"></a>6.2.4. Параметры конфигурации</h3></div></div></div><a
            id="id-1.9.11.10.2"
            class="indexterm"></a><a
            id="id-1.9.11.10.3"
            class="indexterm"></a><a
            id="id-1.9.11.10.4"
            class="indexterm"></a><div
            class="para">
				Кроме уже упомянутых деталей конфигурации, можно сделать дополнительную настройку APT. Для этого надо внести дополнительные параметры в файл , расположенный в <code
              class="filename"> /etc/apt/apt.conf.d/</code>. Помните, что APT может указать <code
              class="command"> dpkg</code> игнорировать конфликты файлов, установив <code
              class="literal"> DPkg::options { "--force-overwrite"; }</code>.
			</div><div
            class="para">
				Если доступ в интернет осуществляется через прокси, добавьте строку подобную этой <code
              class="literal">Acquire::http::proxy "http://<em
                class="replaceable">yourproxy</em>:3128"</code>. Для FTP-прокси запишите <code
              class="literal">Acquire::ftp::proxy "ftp://<em
                class="replaceable">yourproxy</em>"</code>. Чтобы узнать более об опциях конфигурации читайте руководства и ман <span
              class="citerefentry"><span
                class="refentrytitle">apt.conf</span>(5)</span>. Для этого выполните команду <code
              class="command">man apt.conf</code> (подробнее о манах читайте <a
              class="xref"
              href="solving-problems.html#sect.manual-pages">Раздел 7.1.1, «Страницы руководств»</a>).
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.directory.d"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ВЕРНЁМСЯ К ОСНОВАМ</em></span> Каталоги, оканчивающиеся на <code
                        class="filename">.d</code></strong></p></div></div></div><a
              id="id-1.9.11.10.7.2"
              class="indexterm"></a><div
              class="para">
				Каталоги, название которых заканчивается на <code
                class="filename">.d</code>, встречаются всё чаще и чаще. Каждый каталог представляет собой конфигурационный файл, разделенный на несколько файлов . Таким образом все файлы в <code
                class="filename">/etc/apt/apt.conf.d/</code> это инструкции, настраивающие APT. APT применяет их в алфавитном порядке, поэтому более поздняя инструкция может изменять параметры, установленные предшествующим ей инструкциями.
			</div><div
              class="para">
				Такая система создает некоторую гибкость как для администраторов, так и для разработчиков. Администратор может легко изменять настройки программы добавляя уже готовый файл настроек в такой каталог и не изменяя уже существующий файл настроек. Разработчик пакета точно так же адаптирует конфигурацию другой программы, чтобы она наилучшим образом взаимодействовала с его. Политики Debian явно запрещают изменений конфигурации других пакетов — это допустимо делать только пользователям. Помните, что во время обновления пакета, если было обнаружено внесение изменений в файл конфигурации, то пользователю будет предложено выбрать какую версию файла конфигурации оставить. Любое стороннее изменение файла вызовет такой запрос, что обеспокоит администратора, который уверен, что точно ничего не менял.
			</div><div
              class="para">
				Каталог <code
                class="filename"> .d</code> нужен для того, чтобы можно было изменить конфигурационные настройки дополнительных (внешних, external) пакетов. Без этого каталога невозможно изменить конфигурационные файлы для этих пакетов. Взамен этого пользователь должен сам составить список операций - как это сделано в файле <code
                class="filename"> /usr/share/doc/<em
                  class="replaceable"> package</em> /README.Debian</code>.
			</div><div
              class="para">
				Каталог <code
                class="filename">.d</code> зависит от приложений. Он используется напрямую и управляется внешним скриптом (сценарием), который объединит все файлы и создаст конфигурационный файл сам. Очень важно выполнить скрипт после любого изменения в этом каталоге. И тогда большинство последних изменений будут учтены. В то же время крайне важно не редактировать напрямую конфигурационный файл. Он будет создан программой автоматически. Все внесенные напрямую изменения в конфигурационный файл будут потеряны в будущем после выполнения скрипта. Этот предпочитаемый метод (<code
                class="filename"> .d</code> - каталог, используемый напрямую для внесения изменений, дополнений или файл -сгенерированный на базе данного каталога) обычно диктуется ограничением реализации. Но в обоих случаях выгода в плане гибкости конфигурации с лихвой компенсируют небольшие усложнения, которые они за собой влекут. В программе почтового сервера Exim 4 есть пример метода сгенерированного таким образом файла: там можно внести изменения в разные файлы расположенные в каталоге (<code
                class="filename"> /etc/exim4/conf.d/*</code> ). Далее новые изменения будут присоединены в <code
                class="filename"> /var/lib/exim4/config.autogenerated </code> после выполнения команды <code
                class="command"> update-exim4.conf</code>.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt.priorities"></a>6.2.5. Управление приоритетами пакетов</h3></div></div></div><div
            class="para">
				Один из многих важных аспектов в конфигурировании APT-а является управление приоритетами, ассоциироваными с каждым исходным пакетом. Для примера, ты можешь захотеть расширить дистибутив (к примеру стабильный - Stable) одним или двуми пакетами из других дистибутивов <span
              class="distribution distribution"> тестируемый (Testing) </span> , <span
              class="distribution distribution"> нестабильный (Unstable) </span> или <span
              class="distribution distribution"> экспериментальный (Experimental) </span>. В этом случае имеется возможность определить приоритеты каждого доступного пакета (некоторые пакеты могут иметь свои приоритеты зависимостей к их версии или распространение -дистрибьютор предоставляет это). Те приоритеты будут влиять на поведение APT-а: для каждого пакета всегда будет выбираться версия с высочайшим приоритетом (кроме случаев, когда версия более старая, чем установлена в системе такая же и если его приоритет - меньше чем 1000).
			</div><a
            id="id-1.9.11.11.3"
            class="indexterm"></a><a
            id="id-1.9.11.11.4"
            class="indexterm"></a><a
            id="id-1.9.11.11.5"
            class="indexterm"></a><a
            id="id-1.9.11.11.6"
            class="indexterm"></a><a
            id="id-1.9.11.11.7"
            class="indexterm"></a><a
            id="id-1.9.11.11.8"
            class="indexterm"></a><a
            id="id-1.9.11.11.9"
            class="indexterm"></a><div
            class="para">
				APT определяет свои приоритеты по умолчанию. Каждая версия устанавливаемого пакета имеет приоритер 100. Не установленная версия имеет приоритет 500 по умолчанию, но это может прыгнуть (измениться) до 990 если это есть часть целевого (выпускаемого) релиза (определяется с <code
              class="literal">-t</code> опция командной строки или <code
              class="literal">APT::Default-Release</code> конфигурирование указание).
			</div><div
            class="para">
				Ты можешь изменить (модифицировать) приоритеты путем дополнения записей в <code
              class="filename">/etc/apt/preferences</code> файл с именами затрагиваемых пакетов, их версия, оригинальные (первоначальные) и их новые приоритеты.
			</div><div
            class="para">
				APT никогда не установит устаревшую версию пакета (то есть если версия устанавливаемого пакета ниже чем уже установленный в настоящий момент в системе). Исключение составляет случай если приоритет устанавливаемого пакета выше чем 1000. APT будет всегда устанавливать пакет с наивысшим приоритетом, делая это под давлением (в случаях - как описано выше в качестве исключения). Если два пакета имеют одинаковый приоритет, то APT установит более новую версию пакета (чей номер версии выше. Например- версии 0.6.8 и 0.6.9 - будет установлена 0.6.9). Если два пакета с одинаковой версией имеют равные приоритеты, но отличаются по своему содержанию, то APT установит ту версию, что еще не была установлена ранее (это правило было создано чтобы учесть случай обновления пакета без приращения номера ревизии-версии. Как правило при замене одного пакета на другой APT-ом происходит увеличение номера версии).
			</div><div
            class="para">
				Были выработаны реальные условия соглашения по приоритетам устанавливаемых пакетов: - Если приоритет меньше 0 - пакет не будет установлен. - Если приоритет находится в интервале от 0 до 100 - пакет будет установлен только в случае - если нет других версий пакета в настоящее время уже имеющихся в системе. - Если приоритет находится в интервале от 100 до 500 - пакет будет установлен только в случаях: 1) если в настоящее время в системе не установлен другой пакет более новой версии; 2) нет годного пакета в другом дистибутиве. - Если приоритет находится в интервале от 501 до 990 - пакет будет установлен только в случаях: 1) если в настоящее время в системе не установлена новейшая версия; 2) нет годного пакета в репозитории (хранилище) целевого дистибутива. - Если приоритет находится в интервале от 990 до 1000 - пакет будет установлен как исключение - если устанавливаемая версия является новейшей. - Если приоритет превышает 1000 - это приведет к тому - что пакет всегда будет установлен, несмотря на то, что будет установлена версия более старая - чем имеется в настоящий момент в системе (то есть APT сделает это принудительно, против своих правил).
			</div><div
            class="para">
				Когда APT проверяет <code
              class="filename">/etc/apt/preferences</code>, он сначала принимает во внимание наиболее специфичные (то есть особенные, характерные) указания (часто это указания соответствующего пакета). Затем проверяет и более обычные указания (включая для примера все пакеты дистибутива). Если существует несколько общих записей, используется первая подходящая. Каждый исходный пакет идентифицируется через информацию, содержащуюся в файле <code
              class="filename">Release</code>, что APT получил из репозитория (хранилища) вместе с файлами <code
              class="filename">Packages</code>. Это точно определяет источник (обычно “Debian” для пакетов из официальных источников - репозиториев (хранилищ), но это может быть также имя определенного лица или организации для сторонних репозиториев). Это также дает имя дистибутива (обычно <span
              class="distribution distribution">Стабильный (Stable)</span>, <span
              class="distribution distribution">Тестируемый (Testing)</span>, <span
              class="distribution distribution">Нестабильный (Unstable)</span> or <span
              class="distribution distribution">Экспериментальный (Experimental)</span> для стандартных дистибутивов, поддерживаемых Debian-ом) вместе с его версией (для примера 8 для Debian-а <span
              class="distribution distribution">Название - Jessie</span>). Давайте рассмотрим его синтаксис на практических примерах изучения этого механизма.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ОСОБЕННЫЙ СЛУЧАЙ</em></span> Приоритет <span
                        class="distribution distribution">экспериментальный</span></strong></p></div></div></div><a
              id="id-1.9.11.11.15.2"
              class="indexterm"></a><div
              class="para">
				Если внести в список <span
                class="distribution distribution">Экспериментальный</span> в твой <code
                class="filename">sources.list</code> файл, соответствующие пакеты никогда не будут установлены, так как их APT приоритет по умолчанию равен 1. Это есть осознанная линия поведения APT-а (такое правило создано чтобы предохранить пользователя от установки <span
                class="distribution distribution">Экспериментальных</span> пакетов по ошибке. Пакеты могут быть установлены только в случае явно выполненной <code
                class="command">aptitude install <em
                  class="replaceable">package</em>/experimental</code>. Пользователи могут выполнить эту команду только если отдают себе полный отчет о сопутствующих рисках, и соглашаются принять на себя ответственность за это. Это же можно сделать и другим способом (хотя <span
                class="emphasis"><em>не</em></span> рекомендуется) - обработать пакеты из <span
                class="distribution distribution">Экспериментальный</span> одинаково с обработкой пакетов из других дистибутивов с предоставлением им приоритета 500. Для этого надо сделать конкретную запись в <code
                class="filename">/etc/apt/preferences</code>:
			</div><div
              class="informalexample"><pre
                class="programlisting">Package: *
Pin: release a=experimental
Pin-Priority: 500
</pre></div></div><div
            class="para">
				Давайте предположим что вы хотите использовать пакеты только из стабильной (Stable) версии Debian-а. Пакеты из других версий (testing, unstable, experimental) не будут установлены, за исключением случаях - когда пользователь явно это запросит. Ты можешь записать следующие строчки в <code
              class="filename">/etc/apt/preferences</code> файл:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: *
Pin: release a=stable
Pin-Priority: 900

Package: *
Pin: release o=Debian
Pin-Priority: -10
</pre></div><div
            class="para">
				<code
              class="literal">a=stable</code> определяем имя выбранного дистибутива (stable-стабильный). <code
              class="literal">o=Debian</code> ограничиваем результаты поиска только пакетами чей оригинал (происхождение) есть “Debian”.
			</div><div
            class="para">
				Давай сейчас предположим что у вас имеется сервер с различными локальными программами, зависящими от версии 5.14 программы Perl. Вы хотите быть увереными, что обновление (upgrade) не установит другие версии этой программы. Для этого Вы можете использовать следующую запись:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: perl
Pin: version 5.14*
Pin-Priority: 1001
</pre></div><div
            class="para">
				Справочную документацию для этого конфигурационного файла можно посмотреть в странице руководстве (man) <span
              class="citerefentry"><span
                class="refentrytitle">apt_preferences</span>(5)</span>, которую можно вывести на просмотр (в консоле) выполнив <code
              class="command">man apt_preferences</code>.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> комментарии в <code
                        class="filename">/etc/apt/preferences</code></strong></p></div></div></div><a
              id="id-1.9.11.11.22.2"
              class="indexterm"></a><a
              id="id-1.9.11.11.22.3"
              class="indexterm"></a><a
              id="id-1.9.11.11.22.4"
              class="indexterm"></a><div
              class="para">
				Это -неофициальный синтаксис, который размещает комментарии в <code
                class="filename">/etc/apt/preferences</code> файле, но некоторые текстовые описания могут быть размещены - один или более - “<code
                class="literal">Explanation</code>” (секция "Explanation") заголовки вначале каждой записи (строки):
			</div><div
              class="informalexample"><pre
                class="programlisting">Explanation: The package xserver-xorg-video-intel provided
Explanation: in experimental can be used safely
Package: xserver-xorg-video-intel
Pin: release a=experimental
Pin-Priority: 500
</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-mix-distros"></a>6.2.6. Работа с отдельными дистрибутивами</h3></div></div></div><div
            class="para">
				<code
              class="command">apt</code> является замечательным инструментом. И это создает соблазн выискивать пакеты, приходящие из других дистибутивов. Для примера, после того, как вы установили <span
              class="distribution distribution">Стабильный (Stable)</span>, вы можете захотеть попробовать программный пакет годный в других дистибутивах - <span
              class="distribution distribution">Тестируемый (Testing)</span> или <span
              class="distribution distribution">Нестабильный (Unstable)</span> без расхождения слишком много от исходного состояния системы.
			</div><div
            class="para">
				Даже если вы будете изредка наталкиваться на трудности пока смешиваете пакеты из разных дистибутивов, <code
              class="command">apt</code> управляет таким совместным сосуществованием очень хорошо и ограничивает риски очень эффективно. Лучший путь - как надо поступить в данном случае - это внести в список все дистибутивы, что вы желаете использовать, в <code
              class="filename">/etc/apt/sources.list</code>. Некоторые люди всегда помещают три дистибутива, но запомни, что <span
              class="distribution distribution">Нестабильный (Unstable)</span> предназначен для опытных пользователей. И дополнительно установить значение вашего предпочтения дистибутива с <code
              class="literal">APT::Default-Release</code> параметром (смотри <a
              class="xref"
              href="sect.apt-get.html#sect.apt-upgrade">Раздел 6.2.3, «Обновление системы»</a>).
			</div><div
            class="para">
				Давайте предположим, что <span
              class="distribution distribution"> Stable (Стабильный)</span> является вашим рекомендованным (установленным) дистибутивом, однако строки <span
              class="distribution distribution">Testing</span> и <span
              class="distribution distribution">Unstable</span> также перечислены в вашем <code
              class="filename">sources.list</code> файле. В этом случае, вы можете использовать <code
              class="command">apt install <em
                class="replaceable">пакет</em>/testing</code> для установки пакета из <span
              class="distribution distribution">Testing</span>. Если в процессе установки будут возникать ошибки - из-за неудовлетворенных зависимостей, дайте решение этих зависимостей внутри <span
              class="distribution distribution">Testing</span> через добавление параметра <code
              class="literal">-t testing</code>. Это очевидно, что аналогично надо поступить и по отношению к <span
              class="distribution distribution">Unstable</span>.
			</div><div
            class="para">
				В этой ситуации, обновление пакетов (<code
              class="command">upgrade</code> и <code
              class="command">full-upgrade</code>) делаются внутри <span
              class="distribution distribution">Stable</span> за исключением тех пакетов, что уже обновлены из другого дистибутива: они будут обновляться доступными пакетами из своих дистибутивов. Мы объясним это поведение с помощью приоритетов по умолчанию устанавливаемых APT внизу (далее). Не стесняйся использовать <code
              class="command">apt-cache policy</code> (смотри вкладку <a
              class="xref"
              href="sect.apt-get.html#sidebar.apt-cache-policy"><span
                class="emphasis"><em>СОВЕТ</em></span> <code
                class="command">apt-cache policy</code></a>) для проверки данных приоритетов.
			</div><div
            class="para">
				Все концентрируется вокруг того факта, что APT только принимает во внимание пакеты выше или эквивалентной (равной) версии, которые установлены (беря на себя ответственность за то, что <code
              class="filename">/etc/apt/preferences</code> не будет использоваться для принудительного повышения приоритета выше значения 1000 для некоторых пакетов).
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.apt-cache-policy"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> <code
                        class="command">apt-cache policy</code></strong></p></div></div></div><div
              class="para">
				Чтобы лучше понять механизм приоритета, не сомневаться в выполнении команды <code
                class="command">apt-cache policy</code> обнаруживаем приоритет по умолчанию, который присвоен каждому исходныму пакетому. Вы можете также использовать <code
                class="command">apt-cache policy <em
                  class="replaceable">package</em></code> чтобы показать приоритеты всех доступных версий данных пакетов.
			</div></div><div
            class="para">
				Давайте предположим, что вы установили версию 1 первого пакета из <span
              class="distribution distribution">Стабильный (Stable)</span> и что версии 2 и 3 есть доступны (в указанном порядке) в <span
              class="distribution distribution">Тестируемый (Testing)</span> and <span
              class="distribution distribution">Нестабильный (Unstable)</span>. Установленная версия имеет приоритет 100, но доступные версии <span
              class="distribution distribution">Stable</span> (этот же пакет) имеет приоритет 990 (потому что это часть выпускаемого релиза - дистибутива). Пакеты в <span
              class="distribution distribution">Testing</span> and <span
              class="distribution distribution">Unstable</span> имеют приоритеты 500 (по умолчанию - приоритет неустановленной версии). Победитель таким образом будет версия 1 с приоритетом 990. Пакет - “расположенный в <span
              class="distribution distribution">Stable</span>”.
			</div><div
            class="para">
				Давайте возьмем пример другого пакета, чья версия 2 была установлена из <span
              class="distribution distribution">Testing</span>. Версия 1 доступна в <span
              class="distribution distribution">Stable</span> а версии 3 в <span
              class="distribution distribution">Unstable</span>. Версия 1 (чей приоритет 990 — таким образом ниже чем 1000) отбрасывается потому что ее номер (ниже) меньше чем установленная версия (1 меньше 2). Таким образом разрешенные версии только 2 и 3, обе с приоритетом 500. Встретившись с такой ситуацией APT выберет новейшую версию (то есть 3), что находится в <span
              class="distribution distribution">Unstable</span>. Если вы не хотите чтобы ваш пакет, установленный из <span
              class="distribution distribution">Testing</span> мигрировал (изменился) в <span
              class="distribution distribution">Unstable</span> версию, вы должны назначить приоритет ниже, чем 500 (490 для примера) для пакетов, приходящих из <span
              class="distribution distribution">Unstable</span>. Для этого вы можете модифицировать <code
              class="filename">/etc/apt/preferences</code>:
			</div><pre
            class="programlisting">Package: *
Pin: release a=unstable
Pin-Priority: 490
</pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.automatic-tracking"></a>6.2.7. Трассирование автоматически устнавливаемых пакетов (наблюдение)</h3></div></div></div><div
            class="para">
				Одной из важных функций команды <code
              class="command">apt</code> является трассирование (отслеживание, наблюдение) пакетов, которые устанавливаются только с зависимостями (эти пакеты, без взаимосвязанных с ними пакетов, не установятся). Зависимости - это такие пакеты, которые помечаются как “автоматические”, и часто включают в себя например библиотеки.
			</div><div
            class="para">
				При удалении пакетов, менеджер пакетов проверяет их зависимости и вычисляет перечень автоматически установленных ранее пакетов, которые не нужны более (так как данные пакеты устанавливались ранее не вручную, а автоматически, для удовлетворения зависимостей какого-то пакета). <code
              class="command">apt-get autoremove</code> будет избавляться (удалит) эти, ненужные более, пакеты. <code
              class="command">aptitude</code> и <code
              class="command">apt</code> не имеют этой команды. Предыдущая команда автоматически удалит те пакеты, как только они будут идентифицированы. И последнее - в тех командах нет такой возможности - возможно потому, что пользователь не может вручную выполнить эту команду. Во всех случаях средства (эти три команды) отобразят четкое сообщение, перечисляющее затрагивающие пакеты.
			</div><a
            id="id-1.9.11.13.4"
            class="indexterm"></a><a
            id="id-1.9.11.13.5"
            class="indexterm"></a><a
            id="id-1.9.11.13.6"
            class="indexterm"></a><a
            id="id-1.9.11.13.7"
            class="indexterm"></a><div
            class="para">
				Это есть хорошая привычка помечать как автоматически устанавливаемые любые пакеты, в которых вы не нуждаетесь немедленно. Поэтому данные пакеты в дальнейшем автоматически будут удалены, когда в них отпадет необходимость. <code
              class="command">apt-mark auto <em
                class="replaceable">package</em></code> будет отмечать данный пакет как автоматически установленный несмотря на то, что <code
              class="command">apt-mark manual <em
                class="replaceable">package</em></code> делает противоположное. <code
              class="command">aptitude markauto</code> и <code
              class="command">aptitude unmarkauto</code> работают одинаковым образом, хотя они предлагают больше возможностей чтобы отметить много пакетов одновременно (see <a
              class="xref"
              href="sect.apt-frontends.html#sect.aptitude">Раздел 6.4.1, «программа <code
                class="command">aptitude</code>»</a>). Не графический, а интерактивный интерфейс команды <code
              class="command">aptitude</code> в консоле (терминале) также может быстро просмотреть у каких пакетов установлен флаг (отметка) “automatic flag”.
			</div><a
            id="id-1.9.11.13.9"
            class="indexterm"></a><div
            class="para">
				Люди могут хотеть знать почему автоматически установленные пакеты присутствуют в системе. Для получения это информации из командной строки, вы можете использовать <code
              class="command">aptitude why <em
                class="replaceable">пакет</em></code> (<code
              class="command">apt</code> и <code
              class="command">apt- get</code> имеют непохожие особенности):
			</div><pre
            class="screen"><code
              class="computeroutput">$ </code><strong
              class="userinput"><code>aptitude why
python-debian
</code></strong><code
              class="computeroutput">i aptitude
Рекомендации apt-xapian-index 
i A apt-xapian-index Зависимости python-debian (&gt;= 0.1.15)
</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>АЛЬТЕРНАТИВА</em></span> <code
                        class="command">deborphan</code> и <code
                        class="command">debfoster</code></strong></p></div></div></div><a
              id="id-1.9.11.13.12.2"
              class="indexterm"></a><a
              id="id-1.9.11.13.12.3"
              class="indexterm"></a><div
              class="para">
				В дни, когда <code
                class="command">apt</code>, <code
                class="command">apt-get</code> и <code
                class="command">aptitude</code> были неспособны трассировать (отслеживать) автоматически установленные ранее пакеты, было две программы для составления списка ненужных пакетов: <code
                class="command">deborphan</code> и <code
                class="command">debfoster</code>.
			</div><div
              class="para">
				<code
                class="command">deborphan</code> наиболее элементарной из этих программ. Она просто сканирует секции (разделы) <code
                class="literal">libs</code> и <code
                class="literal">oldlibs</code>. При отсутствии дополнительных инструкций, она просто смотрит - какие пакеты в настоящее время установленны и что нет других пакетов, зависящих на них. Полученный перечень может быть полезным как база для удаления ненужных (более) пакетов.
			</div><div
              class="para">
				<code
                class="command">debfoster</code> имеет более тщательно продуманный подход, очень похожий на APT: она сохраняет перечень пакетов, что есть точно установленны, и запоминает те пакеты, которые действительно нужны между каждым вызовом. Если новые пакеты появляются в системе и если <code
                class="command">debfoster</code> не опознает их как нужные пакеты, они будут показаны на экране вместе с перечнем их зависимостей. Команда далее предложит выбор: удалить пакет (возможно вместе с другими пакетами, которые зависят только от этого удаляемого пакета), пометив его определенным образом, или проигнорировать это временно.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>Пред.</strong>Глава 6. Обслуживание и обновление: инструменты A...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>След.</strong>6.3. Команда apt-cache</a></li></ul></body></html>
