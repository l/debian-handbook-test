<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.4. Server di file NFS</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-it-IT-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Il Manuale dell'Amministratore Debian" /><link
        rel="up"
        href="network-services.html"
        title="Capitolo 11. Servizi di rete: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="sect.ftp-file-server.html"
        title="11.3. Server di file FTP" /><link
        rel="next"
        href="sect.windows-file-server-with-samba.html"
        title="11.5. Configurare condivisioni Windows con Samba" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/it-IT/stable/sect.nfs-file-server.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>Indietro</strong></a></li><li
          class="home">Il Manuale dell'Amministratore Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>Avanti</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.nfs-file-server"></a>11.4. Server di file NFS</h2></div></div></div><div
          class="para">
			NFS (<span
            class="emphasis"><em>Network File System</em></span>) è un protocollo che consente l'accesso remoto ad un filesystem attraverso la rete. Tutti i sistemi Unix possono utilizzare questo protocollo: quando i sistemi Windows sono coinvolti dev'essere utilizzato Samba al suo posto.
		</div><a
          id="id-1.14.7.3"
          class="indexterm"></a><a
          id="id-1.14.7.4"
          class="indexterm"></a><a
          id="id-1.14.7.5"
          class="indexterm"></a><a
          id="id-1.14.7.6"
          class="indexterm"></a><a
          id="id-1.14.7.7"
          class="indexterm"></a><div
          class="para">
			NFS è uno strumento molto utile ma, storicamente, ha sempre sofferto di molte limitazioni, la maggior parte delle quali sono state affrontate con la versione 4 del protocollo. Lo svantaggio è che l'ultima versione di NFS è più difficile da configurare quando si desidera fare uso di funzionalità di sicurezza di base come l'autenticazione e la crittografia di dati che si basa su Kerberos. E senza quelle, il protocollo NFS deve essere limitato a una rete locale fidata (trusted) in quanto i dati passano attraverso la rete in chiaro (una <span
            class="emphasis"><em>sniffer</em></span> può intercettarli) ed i diritti di accesso sono concessi in base all'indirizzo IP del client (che può essere falsificato).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>DOCUMENTAZIONE</em></span> NFS HOWTO</strong></p></div></div></div><div
            class="para">
			Una buona documentazione per spiegare NFSv4 è piuttosto scarsa. Ecco alcune indicazioni con contenuti di diversa qualità, ma che dovrebbero almeno dare alcuni suggerimenti su ciò che dovrebbe essere fatto. <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="https://help.ubuntu.com/community/NFSv4Howto">https://help.ubuntu.com/community/NFSv4Howto</a></div> <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration">http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration</a></div>
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.10"></a>11.4.1. Mettere in sicurezza NFS</h3></div></div></div><a
            id="id-1.14.7.10.2"
            class="indexterm"></a><div
            class="para">
				Se non si utilizzano le funzioni di sicurezza basate su Kerberos, è vitale assicurarsi che solo le macchine autorizzate all'uso di NFS possano connettersi ai vari server RPC richiesti, in quanto il protocollo di base si fida dei dati ricevuti dalla rete. Il firewall deve inoltre bloccare l'<span
              class="emphasis"><em>IP spoofing</em></span> per prevenire che macchine esterne possano agire come una interna, e limitare l'accesso alle porte appropriate alle solo macchine che devono accedere alle condivisioni NFS.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>FONDAMENTALI</em></span> RPC</strong></p></div></div></div><div
              class="para">
				RPC (<span
                class="emphasis"><em>Remote Procedure Call</em></span>) è uno standard Unix per i servizi remoti. NFS è uno di questi servizi.
			</div><a
              id="id-1.14.7.10.4.3"
              class="indexterm"></a><a
              id="id-1.14.7.10.4.4"
              class="indexterm"></a><div
              class="para">
				I servizi RPC si registrano in una directory conosciuta con il nome di <span
                class="emphasis"><em>portmapper</em></span>. Un client che desidera eseguire una richiesta NFS contatta prima di tutto il <span
                class="emphasis"><em>portmapper</em></span> (sulla porta 111, TCP o UDP) e chiede del server NFS: la risposta generalmente menziona la porta 2049 (quella predefinita per NFS). Non tutti i servizi RPC necessariamente usano una porta fissa.
			</div></div><div
            class="para">
				Le vecchie versioni del protocollo richiedono altri servizi RPC che usano porte assegnate dinamicamente. Fortunatamente, con NFS versione 4, sono necessarie solo porta 2049 (per NFS) e 111 (per il portmapper) e sono quindi facili da filtrare sul firewall.
			</div><a
            id="id-1.14.7.10.6"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.11"></a>11.4.2. Server NFS</h3></div></div></div><div
            class="para">
				Il server NFS è parte del kernel Linux: nei kernel forniti da Debian è compilato come modulo. Se il server NFS è eseguito automaticamente all'avvio il pacchetto <span
              class="pkg pkg">nfs-kernel-server</span> dev'essere installato poiché contiene gli script di avvio necessari.
			</div><div
            class="para">
				Il file di configurazione del server NFS, <code
              class="filename">/etc/exports</code>, elenca le directory che vengono rese disponibili attraverso la rete (<span
              class="emphasis"><em>esportate</em></span>). Per ogni condivisione NFS l'accesso è garantito solo alla lista di macchine fornita. Un controllo degli accessi più accurato può essere ottenuto con qualche opzione. La sintassi di questo file è piuttosto semplice:
			</div><a
            id="id-1.14.7.11.4"
            class="indexterm"></a><a
            id="id-1.14.7.11.5"
            class="indexterm"></a><pre
            class="programlisting">
/directory/da/condividere macchina1(opzione1,opzione2,...) macchina2(...) ...</pre><div
            class="para">
				Si noti che con NFSv4, tutte le directory esportate devono essere parte di un unica gerarchia e che la directory radice di quella gerarchia deve essere esportata e identificata con l'opzione <code
              class="literal">fsid=0</code> oppure <code
              class="literal">fsid=root</code>.
			</div><div
            class="para">
				Ogni macchina può essere identificata sia dal suo nome DNS che dal suo IP. È anche possibile specificare un intero insieme di macchine utilizzando una sintassi come <code
              class="literal">*.falcot.com</code> o un intervallo di indirizzi IP come <code
              class="literal">192.168.0.0/255.255.255.0</code> o <code
              class="literal">192.168.0.0/24</code>.
			</div><div
            class="para">
				Le directory sono rese disponibili in sola lettura in via predefinita (o con l'opzione <code
              class="literal">ro</code>). L'opzione <code
              class="literal">rw</code> permette l'accesso in lettura e scrittura. I client NFS si connettono tipicamente da una porta riservata a root (in altre parole inferiore a 1024): questa restrizione può essere sospesa con l'opzione <code
              class="literal">insecure</code> (l'opzione <code
              class="literal">secure</code> è implicita ma può essere resa esplicita, se necessario, per rendere le cose più chiare).
			</div><a
            id="id-1.14.7.11.10"
            class="indexterm"></a><div
            class="para">
				Per impostazione predefinita il server risponde ad una richiesta NFS unicamente quando l'operazione corrente sul disco è completata (opzione <code
              class="literal">sync</code>); questo comportamento può essere disabilitato con l'opzione <code
              class="literal">async</code>. La scrittura asincrona può aumentare un po' le prestazioni, ma diminuisce l'affidabilità poiché c'è il rischio di perdere dati nel caso in cui il server subisca un crash tra la conferma di scrittura e la reale scrittura sul disco. Poiché il valore predefinito è cambiato recentemente (rispetto al valore storico di NFS), si raccomanda di rendere esplicita questa impostazione.
			</div><div
            class="para">
				Per non fornire a qualsiasi client NFS l'accesso root al file system, tutte le richieste provenienti da un utente root sono considerate dal server come provenienti dall'utente <code
              class="literal">anonymous</code>. Questo comportamento corrisponde all'opzione <code
              class="literal">root_squash</code>, ed è abilitata per impostazione predefinita. L'opzione <code
              class="literal">no_root_squash</code>, che disabilita questo comportamento, è rischiosa e dovrebbe essere usata solo in ambienti controllati. Le opzioni <code
              class="literal">anonuid=<em
                class="replaceable">uid</em></code> e <code
              class="literal">anongid=<em
                class="replaceable">gid</em></code> permettono di specificare un altro falso utente da utilizzare al posto di UID/GID 65534 (che corrisponde all'utente <code
              class="literal">nobody</code> ed al gruppo <code
              class="literal">nogroup</code>).
			</div><div
            class="para">
				Con NFSv4, è possibile aggiungere l'opzione <code
              class="literal">sec</code> per indicare il livello di protezione desiderato: <code
              class="literal">sec=sys</code> è l'impostazione predefinita senza particolari caratteristiche di sicurezza, <code
              class="literal">sec=krb5</code> abilita solo l'autenticazione, <code
              class="literal">sec=krb5i</code> aggiunge protezione di integrità, e <code
              class="literal">sec=krb5p</code> è il livello più completo che comprende la tutela della privacy (con crittografia dei dati). Per questo lavoro bisogna lavorare alla configurazione di Kerberos (questo servizio non è coperto da questo libro).
			</div><div
            class="para">
				Sono disponibili altre opzioni: sono documentate nella pagina di manuale <span
              class="citerefentry"><span
                class="refentrytitle">exports</span>(5)</span>.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ATTENZIONE</em></span> Prima installazione</strong></p></div></div></div><div
              class="para">
				Lo script di avvio <code
                class="filename">/etc/init.d/nfs-kernel-server</code> avvia il server solo se <code
                class="filename">/etc/exports</code> elenca una o più condivisioni NFS valide. Durante la fase di configurazione iniziale, una volta che questo file è stato modificato per contenere delle condivisioni valide, il server NFS dev'essere avviato con il seguente comando:
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>service nfs-kernel-server start</code></strong></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.12"></a>11.4.3. Client NFS</h3></div></div></div><a
            id="id-1.14.7.12.2"
            class="indexterm"></a><a
            id="id-1.14.7.12.3"
            class="indexterm"></a><div
            class="para">
				Così come avviene con altri filesystem, integrare una condivisione NFS nella gerarchia del sistema richiede il mount. Poiché questo filesystem ha le sue peculiarità, sono necessari alcuni aggiustamenti alla sintassi del comando <code
              class="command">mount</code> ed al file <code
              class="filename">/etc/fstab</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.5"></a><p
              class="title"><strong>Esempio 11.22. Montare manualmente con il comando <code
                  class="command">mount</code></strong></p><div
              class="example-contents"><pre
                class="screen">
          <code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>mount -t nfs4 -o rw,nosuid arrakis.internal.falcot.com:/shared /srv/shared</code></strong></pre></div></div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.6"></a><p
              class="title"><strong>Esempio 11.23. Condivisione NFS nel file <code
                  class="filename">/etc/fstab</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">
arrakis.internal.falcot.com:/shared /srv/shared nfs4 rw,nosuid 0 0</pre></div></div><div
            class="para">
				La riga descritta in precedenza monta, all'avvio del sistema, la directory NFS <code
              class="filename">/srv/shared/</code> dal server <code
              class="literal">arrakis</code> nella directory locale <code
              class="filename">/shared/</code>. L'accesso in lettura-scrittura è richiesto (da qui il parametro <code
              class="literal">rw</code>). L'opzione <code
              class="literal">nosuid</code> è una misura di protezione che rimuove qualsiasi bit <code
              class="literal">setuid</code> o <code
              class="literal">setgit</code> dai programmi contenuti nella condivisione. Se la condivisione NFS è pensata unicamente per conservare documenti, un'altra opzione raccomandata è <code
              class="literal">noexec</code> che previene l'esecuzione di eventuali programmi conservati nella condivisione. Si noti che sul server, la directory <code
              class="filename">shared</code> è sotto NFSv4 root export (per esempio <code
              class="filename">/export/shared</code>), non è una directory di livello superiore.
			</div><div
            class="para">
				La pagina di manuale <span
              class="citerefentry"><span
                class="refentrytitle">nfs</span>(5)</span> descrive tutte le opzioni dettagliatamente.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>Indietro</strong>11.3. Server di file FTP</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Risali</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Partenza</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>Avanti</strong>11.5. Configurare condivisioni Windows con Samba</a></li></ul></body></html>
