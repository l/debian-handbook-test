<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">6.2. I Comandi aptitude, apt-get, e apt</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-it-IT-1.0-1" /><meta
        name="keywords"
        content="apt, apt-get, apt-cache, aptitude, synaptic, sources.list, apt-cdrom" /><link
        rel="home"
        href="index.html"
        title="Il Manuale dell'Amministratore Debian" /><link
        rel="up"
        href="apt.html"
        title="Capitolo 6. Manutenzione ed aggiornamento: gli strumenti APT" /><link
        rel="prev"
        href="apt.html"
        title="Capitolo 6. Manutenzione ed aggiornamento: gli strumenti APT" /><link
        rel="next"
        href="sect.apt-cache.html"
        title="6.3. Il comando apt-cache" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/it-IT/stable/sect.apt-get.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>Indietro</strong></a></li><li
          class="home">Il Manuale dell'Amministratore Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>Avanti</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.apt-get"></a>6.2. I Comandi <code
                  class="command">aptitude</code>, <code
                  class="command">apt-get</code>, e <code
                  class="command">apt</code></h2></div></div></div><a
          id="id-1.9.11.2"
          class="indexterm"></a><a
          id="id-1.9.11.3"
          class="indexterm"></a><a
          id="id-1.9.11.4"
          class="indexterm"></a><div
          class="para">
			APT è un progetto vasto, i cui piani originali includevano un'interfaccia grafica. Si basa su una libreria che contiene l'applicazione principale e <code
            class="command">apt-get</code> è stato il primo frontend, basato su riga di comando, che è stata sviluppato nell'ambito del progetto. <code
            class="command">apt</code> è un secondo front end basato su riga di comando fornito da APT che supera alcuni errori di progettazione di <code
            class="command">apt-get</code>.
		</div><div
          class="para">
			Numerose altre interfacce grafiche sono apparse come progetti esterni: <code
            class="command">synaptic</code>, <code
            class="command">aptitude</code> (che include sia un'interfaccia in modalità testo che una grafica, anche se non ancora completa), <code
            class="command">wajig</code>, ecc. L'interfaccia più consigliata, <code
            class="command">apt</code>, è quella che useremo negli esempi riportati in questa sezione. Si noti comunque che <code
            class="command">apt-get</code> e <code
            class="command">aptitude</code> hanno una sintassi della linea di comando molto simile. Quando ci saranno grandi differenze fra <code
            class="command">apt</code>, <code
            class="command">apt-get</code> e <code
            class="command">aptitude</code>, tali differenze verranno spiegate.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.11.7"></a>6.2.1. Inizializzazione</h3></div></div></div><div
            class="para">
				Per qualsiasi lavoro con APT, la lista dei pacchetti disponibili deve essere aggiornata; questo può essere fatto semplicemente attraverso <code
              class="command">apt update</code>. A seconda della velocità della connessione, l'operazione può richiedere un po' di tempo visto che deve scaricare un certo numero di file <code
              class="filename">Packages</code>/<code
              class="filename">Sources</code>/<code
              class="filename">Translation-<em
                class="replaceable">codice-lingua</em></code>, che sono gradualmente diventati sempre più grandi mano a mano che Debian si è sviluppata (almeno 10 MB di dati per la sezione <code
              class="literal">main</code>). Ovviamente, installare da un insieme di CD-ROM non richiede di scaricare nulla — in questo caso, l'operazione è molto veloce.
			</div><a
            id="id-1.9.11.7.3"
            class="indexterm"></a><a
            id="id-1.9.11.7.4"
            class="indexterm"></a><a
            id="id-1.9.11.7.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.11.8"></a>6.2.2. Installazione e rimozione</h3></div></div></div><a
            id="id-1.9.11.8.2"
            class="indexterm"></a><a
            id="id-1.9.11.8.3"
            class="indexterm"></a><a
            id="id-1.9.11.8.4"
            class="indexterm"></a><a
            id="id-1.9.11.8.5"
            class="indexterm"></a><div
            class="para">
				Con APT, i pacchetti possono essere aggiunti o rimossi dal sistema, rispettivamente con <code
              class="command">apt install <em
                class="replaceable">pacchetto</em></code> e <code
              class="command">apt remove <em
                class="replaceable">pacchetto</em></code>. In entrambi i casi, APT installerà automaticamente le dipendenze necessarie o rimuoverà i pacchetti che dipendono da quello che ci si appresta a rimuovere. Il comando <code
              class="command">apt purge <em
                class="replaceable">pacchetto</em></code> implica una completa disinstallazione: anche i file di configurazione vengono eliminati.
			</div><a
            id="id-1.9.11.8.7"
            class="indexterm"></a><a
            id="id-1.9.11.8.8"
            class="indexterm"></a><a
            id="id-1.9.11.8.9"
            class="indexterm"></a><a
            id="id-1.9.11.8.10"
            class="indexterm"></a><a
            id="id-1.9.11.8.11"
            class="indexterm"></a><a
            id="id-1.9.11.8.12"
            class="indexterm"></a><a
            id="id-1.9.11.8.13"
            class="indexterm"></a><a
            id="id-1.9.11.8.14"
            class="indexterm"></a><a
            id="id-1.9.11.8.15"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SUGGERIMENTO</em></span> Installare la stessa selezione di pacchetti diverse volte</strong></p></div></div></div><div
              class="para">
				Può risultare utile installare sistematicamente la stessa lista di pacchetti su diversi computer. Ciò può essere fatto abbastanza facilmente.
			</div><div
              class="para">
				Prima di tutto, ottenere la lista dei pacchetti installati sul computer che servirà come «modello» da copiare.
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --get-selections &gt;pkg-list</code></strong></pre><div
              class="para">
				Il file <code
                class="filename">pkg-list</code> contiene quindi la lista dei pacchetti installati. Poi, trasferire il file <code
                class="filename">pkg-list</code> sui computer che si desiderano aggiornare e usare i seguenti comandi:
			</div><pre
              class="screen">## Aggiornare il database di dpkg dei pacchetti conosciuti
# <strong
                class="userinput"><code>avail=`mktemp`</code></strong>
# <strong
                class="userinput"><code>apt-cache dumpavail &gt; "$avail"</code></strong>
# <strong
                class="userinput"><code>dpkg --merge-avail "$avail"</code></strong>
# <strong
                class="userinput"><code>rm -f "$avail"</code></strong>
## Aggiornare le selezioni di dpkg
# <strong
                class="userinput"><code>dpkg --set-selections &lt; pkg-list</code></strong>
## Chiedere ad apt-get di installare i pacchetti selezionati
# <strong
                class="userinput"><code>apt-get dselect-upgrade</code></strong></pre><div
              class="para">
				Il primo comando registra la lista dei pacchetti disponibili nel database di dpkg, poi <code
                class="command">dpkg --set-selections</code> ripristina la selezione di pacchetti che si desidera installare, e l'invocazione di <code
                class="command">apt-get</code> esegue le operazioni necessarie! <code
                class="command">aptitude</code> non ha questo comando.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SUGGERIMENTO</em></span> Rimozione e installazione nello stesso momento</strong></p></div></div></div><div
              class="para">
				È possibile richiedere ad <code
                class="command">apt</code> (o <code
                class="command">apt-get</code>, o <code
                class="command">aptitude</code>) di installare certi pacchetti e rimuoverne altri nella stessa riga di comando aggiungendo un suffisso. Con il comando <code
                class="command">apt install</code>, aggiungere "<code
                class="literal">-</code>" ai nomi dei pacchetti da rimuovere. Con un comando <code
                class="command">apt remove</code>, aggiungere "<code
                class="literal">+</code>" ai nomi dei pacchetti da installare.
			</div><div
              class="para">
				Il prossimo esempio mostra due modi differenti di installare il <em
                class="replaceable">pacchetto1</em> e rimuovere <em
                class="replaceable">pacchetto2</em>.
			</div><pre
              class="screen"># <strong
                class="userinput"><code>apt install <em
                    class="replaceable">pacchetto1</em> <em
                    class="replaceable">pacchetto2-</em></code></strong>
[...]
# <strong
                class="userinput"><code>apt remove <em
                    class="replaceable">pacchetto1+</em> <em
                    class="replaceable">pacchetto2</em></code></strong>
[...]</pre><div
              class="para">
				Ciò può essere usato anche per escludere pacchetti che verrebbero altrimenti installati, per esempio a causa di una relazione <code
                class="literal">Recommends</code>. In generale il risolutore di dipendenze userà quella informazione come un invito a trovare soluzioni alternative.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SUGGERIMENTO</em></span> <code
                        class="command">apt --reinstall</code> e <code
                        class="command">aptitude reinstall</code></strong></p></div></div></div><a
              id="id-1.9.11.8.18.2"
              class="indexterm"></a><div
              class="para">
				Il sistema può a volte danneggiarsi a seguito della rimozione o delle modifiche ai file in un pacchetto. Il modo più facile per recuperare questi file è di reinstallare il pacchetto interessato. Purtroppo, il sistema di pacchettizzazione rileva che quest'ultimo è già installato e si rifiuta cortesemente di reinstallarlo; per evitare questo, usare l'opzione <code
                class="literal">--reinstall</code> dei comandi <code
                class="command">apt</code> <code
                class="command">apt-get</code>. Il seguente comando reinstalla <span
                class="pkg pkg">postfix</span> anche se è già presente:
			</div><pre
              class="screen"><code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt --reinstall install postfix</code></strong></pre><div
              class="para">
				La riga di comando per <code
                class="command">aptitude</code> è un po' diversa, ma ottiene lo stesso risultato con <code
                class="command">aptitude reinstall postfix</code>.
			</div><div
              class="para">
				Il problema non si pone con <code
                class="command">dpkg</code>, ma raramente l'amministratore lo utilizza direttamente.
			</div><div
              class="para">
				Fate attenzione! Usando <code
                class="command">apt-get --reinstall</code> per ripristinare i pacchetti modificati durante un attacco certamente non verrà ripristinato il sistema com'era. La <a
                class="xref"
                href="sect.dealing-with-compromised-machine.html">Sezione 14.7, «Gestire una macchina compromessa»</a> spiega in dettaglio i passi necessari da adottare in caso di sistema compromesso.
			</div></div><div
            class="para">
				Se il file <code
              class="filename">sources.list</code> cita diverse distribuzioni, è possibile specificare la versione del pacchetto da installare. Un numero di versione specifico può essere richiesto con <code
              class="command">apt install <em
                class="replaceable">pacchetto</em>=<em
                class="replaceable">versione</em></code>, ma è in genere preferito indicare la sua distribuzione di origine (<span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span> o <span
              class="distribution distribution">Unstable</span>): con <code
              class="command">apt install <em
                class="replaceable">pacchetto</em>/<em
                class="replaceable">distribuzione</em></code>. Con questo comando è possibile tornare ad una versione precedente di un pacchetto (se per esempio si sa che funziona bene), a condizione che sia ancora disponibile in una delle sorgenti a cui fa riferimento il file <code
              class="filename">sources.list</code>. Altrimenti l'archivio <code
              class="literal">snapshot.debian.org</code> può venire in soccorso (vedere il riquadro <a
              class="xref"
              href="apt.html#sidebar.snapshot.debian.org"><span
                class="emphasis"><em>APPROFONDIMENTO</em></span> Le vecchie versioni dei pacchetti: <code
                class="literal">snapshot.debian.org</code></a>).
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.9.11.8.20"></a><p
              class="title"><strong>Esempio 6.3. Installazione della versione <span
                  class="distribution distribution">unstable</span> di <span
                  class="pkg pkg">spamassassin</span></strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>apt install spamassassin/unstable</code></strong></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>APPROFONDIMENTO</em></span> La cache dei file <code
                        class="filename">.deb</code></strong></p></div></div></div><div
              class="para">
				APT conserva una copia di ogni file <code
                class="filename">.deb</code> scaricato nella directory <code
                class="filename">/var/cache/apt/archives/</code>. In caso di aggiornamenti frequenti, questa cartella può rapidamente occupare molto spazio su disco con diverse versioni per ogni pacchetto; si dovrebbe regolarmente metterli in ordine. Possono essere utilizzati due comandi: <code
                class="command">apt-get clean</code> svuota completamente la directory; <code
                class="command">apt-get autoclean</code> rimuove solo i pacchetti che non possono più essere scaricati (perché scomparsi dal mirror Debian) e sono quindi chiaramente inutili (il parametro di configurazione <code
                class="literal">APT::Clean-Installed</code> può impedire la rimozione dei file <code
                class="filename">.deb</code> che sono attualmente installati). Nota che <code
                class="command">apt</code> non supporta questi comandi.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-upgrade"></a>6.2.3. Aggiornamento del sistema</h3></div></div></div><a
            id="id-1.9.11.9.2"
            class="indexterm"></a><a
            id="id-1.9.11.9.3"
            class="indexterm"></a><a
            id="id-1.9.11.9.4"
            class="indexterm"></a><a
            id="id-1.9.11.9.5"
            class="indexterm"></a><div
            class="para">
				Sono raccomandati aggiornamenti regolari, perché includono gli ultimi aggiornamenti di sicurezza. Per aggiornare, usare <code
              class="command">apt upgrade</code>, <code
              class="command">apt-get upgrade</code> o <code
              class="command">aptitude safe-upgrade</code> (ovviamente dopo <code
              class="command">apt update</code>). Questo comando controlla i pacchetti installati che possono essere aggiornati senza la rimozione di alcun pacchetto. In altre parole, l'obiettivo è quello di garantire l'aggiornamento meno intrusivo possibile. <code
              class="command">apt-get</code> è un po' più esigente di <code
              class="command">aptitude</code> o <code
              class="command">apt</code> perché si rifiuta di installare pacchetti che erano già installati in precedenza.
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.apt-pdiff"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SUGGERIMENTO</em></span> Aggiornamento incrementale</strong></p></div></div></div><div
              class="para">
				Come spiegato in precedenza, l'obiettivo del comando <code
                class="command">apt update</code> è quello di scaricare per ogni sorgente del pacchetto il corrispondente file <code
                class="filename">Packages</code> (o <code
                class="filename">Sources</code>). Tuttavia, anche dopo la compressione con <code
                class="command">bzip2</code>, questi file possono rimanere piuttosto grandi (il <code
                class="filename">Packages.bz2</code> per la sezione <span
                class="foreignphrase"><em
                  class="foreignphrase">main</em></span> di <span
                class="distribution distribution">Jessie</span> occupa più di 6 MB). Se si desidera aggiornare regolarmente, questi scaricamenti possono durare molto tempo.
			</div><div
              class="para">
				Per velocizzare il processo, APT può scaricare file «diff» contenenti le modifiche rispetto al precedente aggiornamento, invece che l'intero file. Per raggiungere questo obiettivo, i mirror Debian ufficiali distribuiscono diversi file che elencano le differenze fra una versione del file <code
                class="filename">Packages</code> e la versione successiva. Sono generati ad ogni aggiornamento degli archivi e viene mantenuto uno storico di una settimana. Ognuno di questi file «diff» occupa solo poche decine di kilobyte per <span
                class="distribution distribution">Unstable</span>, in modo che la quantità di dati scaricati con un <code
                class="command">apt update</code> settimanale sia spesso divisa per 10. Per distribuzioni come <span
                class="distribution distribution">Stable</span> e <span
                class="distribution distribution">Testing</span>, che cambiano di meno, il guadagno è ancora più evidente.
			</div><div
              class="para">
				Tuttavia, a volte può essere interessante forzare lo scaricamento di tutto il file <code
                class="filename">Packages</code>, specialmente quando l'ultimo aggiornamento è molto vecchio e quando il meccanismo di differenze incrementali non servirebbe a molto. Può essere anche interessante quando l'accesso alla rete è molto veloce ma il processore della macchina da aggiornare è piuttosto lento, poiché il risparmio di tempo nello scaricamento è più che perso quando il computer calcola le nuove versioni dei file (partendo dalle versioni più vecchie e applicando le differenze). Per fare questo, è possibile utilizzare il parametro di configurazione <code
                class="literal">Acquire::Pdiffs</code> e impostarlo a <code
                class="literal">false</code>.
			</div></div><div
            class="para">
				<code
              class="command">apt</code> in genere seleziona il numero di versione più recente (ad eccezione dei pacchetti <span
              class="distribution distribution">Experimental</span> e <span
              class="distribution distribution">stable-backports</span>, che vengono ignorati per impostazione predefinita a prescindere dal loro numero di versione). Se si è specificato <span
              class="distribution distribution">Testing</span> o <span
              class="distribution distribution">Unstable</span> nel proprio <code
              class="filename">sources.list</code>, <code
              class="command">apt upgrade</code> porterà la maggior parte di un sistema <span
              class="distribution distribution">Stable</span> a <span
              class="distribution distribution">Testing</span> o <span
              class="distribution distribution">Unstable</span>, e ciò potrebbe non essere quello che si desiderava fare.
			</div><div
            class="para">
				Per dire ad <code
              class="command">apt</code> di usare una specifica distribuzione quando cerca degli aggiornamenti, si deve usare l'opzione <code
              class="literal">-t</code> o <code
              class="literal">--target-release</code>, seguita dal nome della distribuzione voluta (ad esempio: <code
              class="command">apt -t stable upgrade</code>). Per evitare di specificare questa opzione ogni volta che si utilizza <code
              class="command">apt</code>, si può aggiungere la riga <code
              class="literal">APT::Default-Release "stable";</code> nel file <code
              class="filename">/etc/apt/apt.conf.d/local</code>.
			</div><a
            id="id-1.9.11.9.10"
            class="indexterm"></a><a
            id="id-1.9.11.9.11"
            class="indexterm"></a><a
            id="id-1.9.11.9.12"
            class="indexterm"></a><a
            id="id-1.9.11.9.13"
            class="indexterm"></a><a
            id="id-1.9.11.9.14"
            class="indexterm"></a><div
            class="para">
				Per gli aggiornamenti più importanti, come il passaggio da una versione principale di Debian a quella successiva, è necessario utilizzare <code
              class="command">apt full-upgrade</code>. Con questa istruzione, <code
              class="command">apt</code> completerà l'aggiornamento anche nel caso in cui debba eliminare dei pacchetti obsoleti o installare nuove dipendenze. Questo è anche il comando usato dagli utenti che lavorano quotidianamente con il rilascio <span
              class="distribution distribution">Unstable</span> di Debian e che seguono la sua evoluzione giorno per giorno. È così semplice che non ha certo bisogno di spiegazione: la reputazione di APT si basa su questa sua grande funzionalità.
			</div><div
            class="para">
				A differenza di <code
              class="command">apt</code> e <code
              class="command">aptitude</code>, <code
              class="command">apt-get</code> non usa il comando <code
              class="command">full-upgrade</code>. Invece, si dobrebbe usare <code
              class="command">apt-get dist-upgrade</code> (”aggiornamento della distribuzione”), lo storico e ben noto comando che è accettato anche da <code
              class="command">apt</code> e <code
              class="command">aptitude</code> per comodità degli utenti che si sono abituati.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-config"></a>6.2.4. Opzioni di configurazione</h3></div></div></div><a
            id="id-1.9.11.10.2"
            class="indexterm"></a><a
            id="id-1.9.11.10.3"
            class="indexterm"></a><a
            id="id-1.9.11.10.4"
            class="indexterm"></a><div
            class="para">
				Oltre agli elementi di configurazione già citati, è possibile configurare certi aspetti di APT aggiungendo direttive in un file della directory <code
              class="filename">/etc/apt/apt.conf.d/</code>. Ricordare per esempio che APT può dire a <code
              class="command">dpkg</code> di ignorare i conflitti fra i file se si specifica <code
              class="literal">DPkg::options { "--force-overwrite"; }</code>.
			</div><div
            class="para">
				Se si può accedere al Web solo attraverso proxy, bisogna aggiungere una riga come <code
              class="literal">Acquire::http::proxy "http://<em
                class="replaceable">proprioproxy</em>:3128"</code>. Per un proxy FTP, scrivere <code
              class="literal">Acquire::ftp::proxy "ftp://<em
                class="replaceable">proprioproxy</em>"</code>. Per scoprire più opzioni di configurazione, leggere la pagina di manuale <span
              class="citerefentry"><span
                class="refentrytitle">apt.conf</span>(5)</span> con il comando <code
              class="command">man apt.conf</code> (per i dettagli sulle pagine del manuale, vedere la <a
              class="xref"
              href="solving-problems.html#sect.manual-pages">Sezione 7.1.1, «Pagine di manuale»</a>).
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.directory.d"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>FONDAMENTALI</em></span> Directory terminanti in <code
                        class="filename">.d</code></strong></p></div></div></div><a
              id="id-1.9.11.10.7.2"
              class="indexterm"></a><div
              class="para">
				Le directory con il suffisso <code
                class="filename">.d</code> vengono utilizzate sempre più spesso. Ogni directory rappresenta un file di configurazione che viene suddiviso in più file. In questo senso, tutti i file in <code
                class="filename">/etc/apt/apt.conf.d/</code> sono istruzioni per la configurazione di APT. APT li include in ordine alfabetico, così che gli ultimi file possono modificare un elemento di configurazione definito in uno dei primi.
			</div><div
              class="para">
				Questa struttura offre una certa flessibilità all'amministratore della macchina e ai manutentori dei pacchetti. In effetti, l'amministratore può modificare facilmente la configurazione del software aggiungendo un file già pronto nella directory in questione senza dover modificare un file esistente. I manutentori dei pacchetti utilizzano lo stesso approccio quando hanno bisogno di adattare la configurazione di un altro software per assicurarsi che coesista perfettamente con il loro. La politica di Debian proibisce esplicitamente la modifica dei file di configurazione di altri pacchetti: solo gli utenti sono autorizzati a farlo. Ricordare che durante l'aggiornamento di un pacchetto, l'utente può scegliere la versione del file di configurazione che deve essere mantenuta quando viene rilevata una modifica. Qualsiasi modifica esterna del file innescherebbe questa richiesta, che disturberebbe l'amministratore, il quale è sicuro di non aver cambiato nulla.
			</div><div
              class="para">
				Senza una directory <code
                class="filename">.d</code>, è impossibile per un programma esterno cambiare le impostazioni di un programma senza modificare il suo file di configurazione. Al contrario deve invitare l'utente a farlo da solo e deve elencare le operazioni da fare nel file <code
                class="filename">/usr/share/doc/<em
                  class="replaceable">pacchetto</em>/README.Debian</code>.
			</div><div
              class="para">
				A seconda dell'applicazione, la directory <code
                class="filename">.d</code> è usata direttamente o gestita da uno script esterno che collega tutti i file per creare il file di configurazione stesso. È importante eseguire lo script dopo ogni cambiamento in quella directory in modo che le più recenti modifiche siano prese in considerazione. Allo stesso modo, è importante non lavorare direttamente sul file di configurazione creato automaticamente, dal momento ogni modifica andrebbe persa alla successiva esecuzione dello script. Il metodo scelto (la directory <code
                class="filename">.d</code> usata direttamente o un file generato da quella directory) è solitamente imposto da vincoli di implementazione, ma in entrambi i casi i guadagni in termini di flessibilità di configurazione sono maggiori rispetto alle piccole complicazioni che comportano. Il server di posta Exim 4 è un esempio del metodo del file generato: può essere configurato attraverso diversi file (<code
                class="filename">/etc/exim4/conf.d/*</code>) che sono concatenati in <code
                class="filename">/var/lib/exim4/config.autogenerated</code> dal comando <code
                class="command">update-exim4.conf</code>.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt.priorities"></a>6.2.5. Gestire le priorità dei pacchetti</h3></div></div></div><div
            class="para">
				Uno degli aspetti più importanti nella configurazione di APT è la gestione delle priorità assegnate ad ogni fonte di pacchetti. Per esempio, si potrebbe volere estendere una distribuzione con uno o due pacchetti più nuovi da <span
              class="distribution distribution">Testing</span>, <span
              class="distribution distribution">Unstable</span> o <span
              class="distribution distribution">Experimental</span>. È possibile assegnare una priorità a ciascun pacchetto disponibile (lo stesso pacchetto può avere diverse priorità a seconda della sua versione o della distribuzione che lo fornisce). Queste priorità influenzeranno il comportamento di APT: per ogni pacchetto, selezionerà sempre la versione con la priorità più alta (tranne se questa è più vecchia di quella installata e se la sua priorità è inferiore a 1000).
			</div><a
            id="id-1.9.11.11.3"
            class="indexterm"></a><a
            id="id-1.9.11.11.4"
            class="indexterm"></a><a
            id="id-1.9.11.11.5"
            class="indexterm"></a><a
            id="id-1.9.11.11.6"
            class="indexterm"></a><a
            id="id-1.9.11.11.7"
            class="indexterm"></a><a
            id="id-1.9.11.11.8"
            class="indexterm"></a><a
            id="id-1.9.11.11.9"
            class="indexterm"></a><div
            class="para">
				APT definisce diverse priorità predefinite. Ogni versione installata di un pacchetto ha priorità 100. Una versione non installata ha priorità 500 per impostazione predefinita, ma può arrivare a 990 se è parte del rilascio di destinazione prescelto (definito con l'opzione a riga di comando <code
              class="literal">-t</code> o con la direttiva di configurazione <code
              class="literal">APT::Default-Release</code>).
			</div><div
            class="para">
				È possibile modificare le priorità con l'aggiunta di voci nel file <code
              class="filename">/etc/apt/preferences</code> con i nomi dei pacchetti interessati, la loro versione, la loro origine e la loro nuova priorità.
			</div><div
            class="para">
				APT non installerà mai una versione più vecchia di un pacchetto (cioè un pacchetto il cui numero di versione è più basso di quello del pacchetto attualmente installato) tranne se la sua priorità è superiore a 1000. APT installerà sempre il pacchetto con priorità più alta che soddisfa questa regola. Se due pacchetti hanno la stessa priorità, APT installerà il più recente (quello con numero di versione più alto). Se due pacchetti hanno le stesse versione e priorità ma diverso contenuto, APT installerà la versione non installata (questa regola è stata creata per coprire il caso di un aggiornamento di pacchetto senza incremento del numero di revisione, che normalmente è richiesto).
			</div><div
            class="para">
				Più in concreto, non sarà mai installato un pacchetto la cui priorità è minore di 0. Un pacchetto con priorità compresa tra 0 e 100 verrà installato solo se nessun'altra versione del pacchetto è già installata. Con una priorità da 100 a 500, il pacchetto sarà installato solo se non c'è un'altra versione più recente installata o disponibile in un'altra distribuzione. Un pacchetto con priorità fra 501 e 990 verrà installato solo se non ci sono nuove versioni installate o disponibili nella distribuzione di riferimento. Con una priorità da 990 a 1000, il pacchetto verrà installato a meno che la versione installata non è più recente. Una priorità superiore a 1000 porterà sempre all'installazione del pacchetto anche se costringe APT a retrocedere ad una versione precedente.
			</div><div
            class="para">
				Quando APT controlla <code
              class="filename">/etc/apt/preferences</code>, prende prima in considerazione le voci più specifiche (spesso quelle che specificano il pacchetto interessato), poi quelle più generiche (tra cui per esempio tutti i pacchetti di una distribuzione). Se sono presenti più voci generiche, viene utilizzata la prima. I criteri di selezione disponibili includono il nome del pacchetto e la fonte che lo fornisce. Ogni fonte è identificata dalle informazioni contenute in un file <code
              class="filename">Release</code> che APT scarica insieme ai file <code
              class="filename">Packages</code>. Esso specifica l'origine (di solito "Debian" per i pacchetti di mirror ufficiali, ma può essere anche un nome di una persona o di un'organizzazione per repository di terze parti). Fornisce anche il nome della distribuzione (solitamente <span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span>, <span
              class="distribution distribution">Unstable</span> o <span
              class="distribution distribution">Experimental</span> per le distribuzioni standard fornite da Debian) insieme con la sua versione (per esempio 8 per Debian <span
              class="distribution distribution">Jessie</span>). Diamo dunque un'occhiata alla sua sintassi attraverso alcuni casi di studio realistici di questo meccanismo.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CASO SPECIFICO</em></span> Priorità di <span
                        class="distribution distribution">experimental</span></strong></p></div></div></div><a
              id="id-1.9.11.11.15.2"
              class="indexterm"></a><div
              class="para">
				Se si è elencato <span
                class="distribution distribution">Experimental</span> nel proprio file <code
                class="filename">sources.list</code>, i pacchetti corrispondenti non saranno quasi mai installati perché la loro priorità predefinita è 1. Questo naturalmente è un caso specifico, progettato per impedire agli utenti di installare pacchetti <span
                class="distribution distribution">Experimental</span> per errore. I pacchetti possono essere installati solo digitando <code
                class="command">aptitude install <em
                  class="replaceable">pacchetto</em>/experimental</code>; gli utenti che digitano questo comando non possono che essere consapevoli dei rischi che corrono. È sempre possibile (anche se <span
                class="emphasis"><em>non</em></span> consigliato) trattare i pacchetti <span
                class="distribution distribution">Experimental</span> come quelli di altre distribuzioni dando loro priorità 500. Questo viene fatto con una voce specifica in <code
                class="filename">/etc/apt/preferences</code>:
			</div><div
              class="informalexample"><pre
                class="programlisting">Package: *
Pin: release a=experimental
Pin-Priority: 500</pre></div></div><div
            class="para">
				Supponiamo che si vogliano usare solamente i pacchetti della versione stabile di Debian. Quelli forniti in altre versioni non devono essere installati tranne se esplicitamente richiesto. Si dovrebbero scrivere le seguenti voci nel file <code
              class="filename">/etc/apt/preferences</code>:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: *
Pin: release a=stable
Pin-Priority: 900

Package: *
Pin: release o=Debian
Pin-Priority: -10</pre></div><div
            class="para">
				<code
              class="literal">a=stable</code> definisce il nome della distribuzione selezionata. <code
              class="literal">o=Debian</code> limita l'impostazione ai pacchetti la cui origine è "Debian".
			</div><div
            class="para">
				Si supponga ora di avere un server con diversi programmi locali dipendenti dalla versione 5.14 di Perl e che si voglia garantire che non vengano installati gli aggiornamenti ad un'altra versione. Si potrebbe usare questa riga:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: perl
Pin: version 5.14*
Pin-Priority: 1001</pre></div><div
            class="para">
				La documentazione di riferimento per questo file di configurazione è disponibile nella pagina di manuale <span
              class="citerefentry"><span
                class="refentrytitle">apt_preferences</span>(5)</span>, che è possibile visualizzare con <code
              class="command">man apt_preferences</code>.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SUGGERIMENTO</em></span> Commenti in <code
                        class="filename">/etc/apt/preferences</code></strong></p></div></div></div><a
              id="id-1.9.11.11.22.2"
              class="indexterm"></a><a
              id="id-1.9.11.11.22.3"
              class="indexterm"></a><a
              id="id-1.9.11.11.22.4"
              class="indexterm"></a><div
              class="para">
				Non esiste una sintassi ufficiale per mettere dei commenti nel file <code
                class="filename">/etc/apt/preferences</code>, ma possono essere fornite alcune descrizioni testuali mettendo uno o più campi "<code
                class="literal">Explanation</code>" all'inizio di ogni voce:
			</div><div
              class="informalexample"><pre
                class="programlisting">Explanation: Il pacchetto xserver-xorg-video-intel fornito
Explanation: in experimental può essere usato tranquillamente
Package: xserver-xorg-video-intel
Pin: release a=experimental
Pin-Priority: 500</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-mix-distros"></a>6.2.6. Lavorare con più distribuzioni</h3></div></div></div><div
            class="para">
				Dato che <code
              class="command">apt</code> è uno strumento così meraviglioso, si può essere tentati di prendere pacchetti provenienti da altre distribuzioni. Ad esempio, dopo aver installato un sistema <span
              class="distribution distribution">Stable</span>, si potrebbe desiderare di provare un pacchetto software disponibile in <span
              class="distribution distribution">Testing</span> o <span
              class="distribution distribution">Unstable</span>, senza scostarsi troppo dallo stato iniziale del sistema.
			</div><div
            class="para">
				Anche se a volte si incontrano problemi mischiando pacchetti di diverse distribuzioni, <code
              class="command">apt</code> gestisce tale coesistenza molto bene e limita i rischi in modo molto efficace. Il miglior modo di procedere è quello di elencare tutte le distribuzioni utilizzate in <code
              class="filename">/etc/apt/sources.list</code> (alcune persone mettono sempre le tre distribuzioni, ma ricordare che <span
              class="distribution distribution">Unstable</span> è riservata agli utenti esperti) e di definire la distribuzione di riferimento con il parametro <code
              class="literal">APT::Default-Release</code> (vedere la <a
              class="xref"
              href="sect.apt-get.html#sect.apt-upgrade">Sezione 6.2.3, «Aggiornamento del sistema»</a>).
			</div><div
            class="para">
				Supponiamo che <span
              class="distribution distribution">Stable</span> sia la propria distribuzione di riferimento ma che <span
              class="distribution distribution">Testing</span> e <span
              class="distribution distribution">Unstable</span> siano comunque elencate nel proprio file <code
              class="filename">sources.list</code>. In questo caso, è possibile usare <code
              class="command">apt install <em
                class="replaceable">pacchetto</em>/testing</code> per installare un pacchetto da <span
              class="distribution distribution">Testing</span>. Se l'installazione non riesce a causa di alcune dipendenze che non possono essere soddisfatte, si può lasciare che risolva queste dipendenze in <span
              class="distribution distribution">Testing</span> aggiungendo il parametro <code
              class="literal">-t testing</code>. Lo stesso vale ovviamente per <span
              class="distribution distribution">Unstable</span>.
			</div><div
            class="para">
				In questa situazione, gli aggiornamenti (<code
              class="command">upgrade</code> e <code
              class="command">full-upgrade</code>) vengono fatti all'interno di <span
              class="distribution distribution">Stable</span> eccetto per i pacchetti già aggiornati ad altre distribuzioni: questi seguiranno gli aggiornamenti disponibili nelle altre distribuzioni. Questo comportamento verrà spiegato più avanti con l'aiuto delle priorità predefinite impostate da APT. Non esitare ad usare <code
              class="command">apt-cache policy</code> (vedere riquadro <a
              class="xref"
              href="sect.apt-get.html#sidebar.apt-cache-policy"><span
                class="emphasis"><em>SUGGERIMENTO</em></span> <code
                class="command">apt-cache policy</code></a>) per verificare le priorità assegnate.
			</div><div
            class="para">
				Tutto ruota intorno al fatto che APT considera solo i pacchetti con versione più alta o uguale a quella installata (assumendo che non è stato usato <code
              class="filename">/etc/apt/preferences</code> per forzare priorità più alte di 1000 per alcuni pacchetti).
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.apt-cache-policy"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SUGGERIMENTO</em></span> <code
                        class="command">apt-cache policy</code></strong></p></div></div></div><div
              class="para">
				Per capire meglio il meccanismo delle priorità, si può eseguire senza esitazioni <code
                class="command">apt-cache policy</code> per visualizzare la priorità predefinita associata ad ogni fonte di pacchetti. È possibile inoltre usare <code
                class="command">apt-cache policy <em
                  class="replaceable">pacchetto</em></code> per vedere le priorità di tutte le versioni disponibili di un determinato pacchetto.
			</div></div><div
            class="para">
				Supponiamo di avere installato la versione 1 di un primo pacchetto da <span
              class="distribution distribution">Stable</span> e che le versioni 2 e 3 siano disponibili rispettivamente in <span
              class="distribution distribution">Testing</span> e <span
              class="distribution distribution">Unstable</span>. La versione installata ha una priorità di 100, ma la versione disponibile in <span
              class="distribution distribution">Stable</span> (la stessa) ha priorità 990 (perché fa parte della versione di riferimento). I pacchetti in <span
              class="distribution distribution">Testing</span> e <span
              class="distribution distribution">Unstable</span> hanno priorità 500 (la priorità predefinita per una versione non installata). Il vincitore è dunque la versione 1 con una priorità di 990. Il pacchetto «rimane in <span
              class="distribution distribution">Stable</span>».
			</div><div
            class="para">
				Prendiamo ora l'esempio di un altro pacchetto la cui versione 2 è stata installata da <span
              class="distribution distribution">Testing</span>. La versione 1 è disponibile in <span
              class="distribution distribution">Stable</span> e la versione 3 in <span
              class="distribution distribution">Unstable</span>. La versione 1 (di priorità 990, quindi minore di 1000) è scartata perché è più bassa della versione installata. Questo lascia in gioco solo le versioni 2 e 3, entrambe con priorità 500. Di fronte a questa alternativa, APT sceglie la versione più recente, quella da <span
              class="distribution distribution">Unstable</span>. Se non si desidera che un pacchetto installato da <span
              class="distribution distribution">Testing</span> venga migrato a <span
              class="distribution distribution">Unstable</span>, è necessario assegnare una priorità minore di 500 (490 ad esempio) ai pacchetti provenienti da <span
              class="distribution distribution">Unstable</span>. Si può modificare <code
              class="filename">/etc/apt/preferences</code> con queste righe:
			</div><pre
            class="programlisting">Package: *
Pin: release a=unstable
Pin-Priority: 490</pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.automatic-tracking"></a>6.2.7. Tenere traccia dei pacchetti installati automaticamente</h3></div></div></div><div
            class="para">
				Una delle funzionalità essenziali di <code
              class="command">apt</code> è il tenere traccia dei pacchetti installati solo come dipendenze. Questi pacchetti vengono chiamati «automatici» e spesso comprendono, ad esempio, le librerie.
			</div><div
            class="para">
				Con queste informazioni, quando i pacchetti vengono rimossi, i gestori di pacchetti possono elaborare un elenco di pacchetti automatici che non sono più necessari (perché non ci sono pacchetti "installati manualmente" che dipendono da essi). <code
              class="command">apt-get autoremove</code> eliminerà tali pacchetti. <code
              class="command">aptitude</code> e <code
              class="command">apt</code> non hanno questo comando: il primo perché li rimuove automaticamente non appena vengono identificati, e quest'ultimo probabilmente perché l'utente non deve eseguire manualmente tale comando. In ogni caso, gli strumenti visualizzano un messaggio chiaro che elenca i pacchetti interessati.
			</div><a
            id="id-1.9.11.13.4"
            class="indexterm"></a><a
            id="id-1.9.11.13.5"
            class="indexterm"></a><a
            id="id-1.9.11.13.6"
            class="indexterm"></a><a
            id="id-1.9.11.13.7"
            class="indexterm"></a><div
            class="para">
				È buona abitudine marcare come automatico ogni pacchetto di cui non si ha direttamente bisogno, in modo che venga automaticamente rimosso quando non è più necessario. <code
              class="command">apt-mark auto <em
                class="replaceable">pacchetto</em></code> marca il pacchetto specificato come automatico, mentre <code
              class="command">apt-mark manual <em
                class="replaceable">pacchetto</em></code> fa l'opposto. <code
              class="command">aptitude markauto</code> e <code
              class="command">aptitude unmarkauto</code> funzionano nello stesso modo, anche se offrono più funzionalità per marcare molti pacchetti contemporaneamente (vedere la <a
              class="xref"
              href="sect.apt-frontends.html#sect.aptitude">Sezione 6.4.1, «<code
                class="command">aptitude</code>»</a>). L'interfaccia interattiva basata su console di <code
              class="command">aptitude</code> rende anche facile revisionare il «contrassegno automatico» per molti pacchetti.
			</div><a
            id="id-1.9.11.13.9"
            class="indexterm"></a><div
            class="para">
				Si potrebbe voler sapere perché un pacchetto installato automaticamente è presente nel sistema. Per ottenere queste informazioni dalla riga di comando, è possibile utilizzare <code
              class="command">aptitude why <em
                class="replaceable">pacchetto</em></code> (<code
              class="command">apt</code> e <code
              class="command">apt-get</code> non hanno una funzionalità simile):
			</div><pre
            class="screen"><code
              class="computeroutput">$ </code><strong
              class="userinput"><code>aptitude why python-debian
</code></strong><code
              class="computeroutput">i   aptitude         Raccomanda apt-xapian-index       
i A apt-xapian-index Dipende    python-debian (&gt;= 0.1.15)
</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIVA</em></span> <code
                        class="command">deborphan</code> e <code
                        class="command">debfoster</code></strong></p></div></div></div><a
              id="id-1.9.11.13.12.2"
              class="indexterm"></a><a
              id="id-1.9.11.13.12.3"
              class="indexterm"></a><div
              class="para">
				In passato quando <code
                class="command">apt</code>, <code
                class="command">apt-get</code> e <code
                class="command">aptitude</code> non erano in grado di tenere traccia dei pacchetti automatici, esistevano due utilità per produrre elenchi dei pacchetti non necessari: <code
                class="command">deborphan</code> e <code
                class="command">debfoster</code>.
			</div><div
              class="para">
				<code
                class="command">deborphan</code> è la più rudimentale delle due. Scansiona semplicemente le sezioni <code
                class="literal">libs</code> e <code
                class="literal">oldlibs</code> (in assenza di istruzioni supplementari) cercando i pacchetti che sono attualmente installati e da cui non dipende nessun altro pacchetto. L'elenco risultante può servire come base per rimuovere i pacchetti non necessari.
			</div><div
              class="para">
				<code
                class="command">debfoster</code> ha un approccio più elaborato, molto simile a quello di APT: mantiene una lista dei pacchetti che sono stati installati esplicitamente, e ricorda quali pacchetti sono veramente necessari da un'esecuzione all'altra. Se nuovi pacchetti compaiono nel sistema e <code
                class="command">debfoster</code> non li conosce come pacchetti necessari, li visualizzerà sullo schermo insieme alla lista delle loro dipendenze. Il programma spesso offre una scelta: rimuovere il pacchetto (eventualmente insieme a ciò che dipende da esso), marcarlo come esplicitamente richiesto o ignorarlo temporaneamente.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>Indietro</strong>Capitolo 6. Manutenzione ed aggiornamento: gli st...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Risali</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Partenza</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>Avanti</strong>6.3. Il comando apt-cache</a></li></ul></body></html>
