<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">14.2. Pare-feu ou filtre de paquets</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-fr-FR-1.0-1" /><meta
        name="keywords"
        content="Pare-feu, Netfilter, IDS/NIDS" /><link
        rel="home"
        href="index.html"
        title="Le cahier de l'administrateur Debian" /><link
        rel="up"
        href="security.html"
        title="Chapitre 14. Sécurité" /><link
        rel="prev"
        href="security.html"
        title="Chapitre 14. Sécurité" /><link
        rel="next"
        href="sect.supervision.html"
        title="14.3. Supervision : prévention, détection, dissuasion" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/fr-FR/stable/sect.firewall-packet-filtering.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>Précédent</strong></a></li><li
          class="home">Le cahier de l'administrateur Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>Suivant</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.firewall-packet-filtering"></a>14.2. Pare-feu ou filtre de paquets</h2></div></div></div><a
          id="id-1.17.5.2"
          class="indexterm"></a><a
          id="id-1.17.5.3"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>B.A.-BA</em></span> Pare-feu</strong></p></div></div></div><a
            id="id-1.17.5.4.2"
            class="indexterm"></a><div
            class="para">
			Un pare-feu <span
              class="foreignphrase"><em
                class="foreignphrase">(firewall)</em></span> est un ensemble matériel ou logiciel qui trie les paquets qui circulent par son intermédiaire, en provenance ou vers le réseau local, et ne laisse passer que ceux qui vérifient certaines conditions.
		</div></div><div
          class="para">
			Un pare-feu est une passerelle filtrante : il applique des règles de filtrage aux paquets qui le traversent (c'est pourquoi il n'est utile qu'en tant que point de passage obligé).
		</div><div
          class="para">
			L'absence de configuration standard explique qu'il n'y ait pas de solution prête à l'emploi. Des outils permettent en revanche de simplifier la configuration du pare-feu netfilter en visualisant graphiquement les règles définies. L'un des meilleurs est sans doute <code
            class="command">fwbuilder</code>.
		</div><a
          id="id-1.17.5.7"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>CAS PARTICULIER</em></span> Pare-feu local</strong></p></div></div></div><div
            class="para">
			Un pare-feu peut limiter son action à une seule machine (et non pas un réseau local complet) ; son rôle principal est alors de refuser ou limiter l'accès à certains services, voire de se prémunir contre l'établissement de connexions sortantes par des logiciels indésirables que l'utilisateur pourrait avoir installés (volontairement ou pas).
		</div></div><div
          class="para">
			Le noyau Linux intègre le pare-feu netfilter ; les outils <code
            class="command">iptables</code> et <code
            class="command">ip6tables</code> permettent de le configurer. La différence entre ces deux outils se limite à ce que le premier agit sur le réseau IPv4 alors que le second intervient sur le réseau IPv6. Les deux piles réseau étant amenées à cohabiter pendant de nombreuses années, il faudra faire usage des deux outils en parallèle.
		</div><a
          id="id-1.17.5.10"
          class="indexterm"></a><a
          id="id-1.17.5.11"
          class="indexterm"></a><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.netfilter"></a>14.2.1. Fonctionnement de netfilter</h3></div></div></div><div
            class="para">
				netfilter dispose de quatre tables distinctes, donnant les règles régissant trois types d'opérations sur les paquets :
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">filter</code> pour les règles de filtrage (accepter, refuser, ignorer un paquet) ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">nat</code> pour modifier les adresses IP et les ports sources ou destinataires des paquets ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">mangle</code> pour modifier d'autres paramètres des paquets IP (notamment le champ ToS — <span
                    class="foreignphrase"><em
                      class="foreignphrase">Type Of Service</em></span> — et les options) ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">raw</code> pour effectuer des manipulations manuelles sur les paquets avant que le suivi de connexion entre en jeu.
					</div></li></ul></div><div
            class="para">
				Chaque table contient des listes de règles appelées chaînes ; les chaînes standards servent au pare-feu pour traiter les paquets dans différentes circonstances prédéfinies. L'administrateur peut créer d'autres chaînes, qui ne seront employées que si l'une des chaînes standards les appelle.
			</div><a
            id="id-1.17.5.12.5"
            class="indexterm"></a><a
            id="id-1.17.5.12.6"
            class="indexterm"></a><div
            class="para">
				La table <code
              class="literal">filter</code> compte trois chaînes standards :
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">INPUT</code> : concerne les paquets destinés au pare-feu ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">OUTPUT</code> : concerne les paquets émis par le pare-feu ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">FORWARD</code> : appliquée aux paquets transitant via le pare-feu (et dont il n'est donc ni la source ni le destinataire).
					</div></li></ul></div><div
            class="para">
				La table <code
              class="literal">nat</code> dispose également de trois chaînes standards :
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">PREROUTING</code> : modifie les paquets dès qu'ils arrivent ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">POSTROUTING</code> : modifie les paquets alors qu'ils sont prêts à partir ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">OUTPUT</code> : modifie les paquets générés par le pare-feu lui-même.
					</div></li></ul></div><div
            class="figure"><a
              xmlns=""
              id="figure.chaines-netfilter"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/netfilter.png"
                  alt="Ordre d'emploi des chaînes de netfilter" /></div></div><p
              class="title"><strong>Figure 14.1. Ordre d'emploi des chaînes de <span
                  class="emphasis"><em>netfilter</em></span></strong></p></div><div
            class="para">
				Chaque chaîne est une liste de règles, prévoyant une action à exécuter quand certaines conditions sont remplies. Le pare-feu parcourt séquentiellement la chaîne s'appliquant au paquet traité et dès qu'une règle est satisfaite, il « saute » (l'option <code
              class="literal">-j</code> vient de <span
              class="foreignphrase"><em
                class="foreignphrase">jump</em></span>) à l'emplacement indiqué pour continuer le traitement. Certains de ces emplacements sont standardisés et correspondent aux actions les plus courantes. Une fois une de ces actions enclenchée, le parcours de la chaîne est interrompu parce que le sort du paquet est normalement décidé (sauf exception explicitement mentionnée ci-après) :
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>B.A.-BA</em></span> ICMP</strong></p></div></div></div><div
              class="para">
				ICMP (<span
                class="foreignphrase"><em
                  class="foreignphrase">Internet Control Message Protocol</em></span>, ou protocole des messages de contrôle sur Internet) est très employé pour transmettre des compléments d'information sur les communications : il permet de tester le fonctionnement du réseau avec la commande <code
                class="command">ping</code> (qui envoie un message ICMP <span
                class="foreignphrase"><em
                  class="foreignphrase">echo request</em></span> auquel le correspondant est normalement tenu de répondre par un message <span
                class="foreignphrase"><em
                  class="foreignphrase">echo reply</em></span>), signale le refus d'un paquet par un pare-feu, indique la saturation d'un tampon de réception, propose une meilleure route (un meilleur trajet pour les prochains paquets à émettre), etc. Plusieurs RFC définissent ce protocole ; les premières, 777 et 792, furent rapidement complétées et étendues. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc777.html">http://www.faqs.org/rfcs/rfc777.html</a></div> <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc792.html">http://www.faqs.org/rfcs/rfc792.html</a></div>
			</div><div
              class="para">
				Rappelons qu'un tampon de réception est une petite zone mémoire contenant les données reçues par le réseau avant qu'elles ne soient traitées par le noyau. Si cette zone est pleine, il est alors impossible de recevoir d'autres données et ICMP signale le problème de sorte que le correspondant réduise la vitesse de transfert pour essayer d'atteindre un équilibre.
			</div><a
              id="id-1.17.5.12.13.4"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.5"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.6"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.7"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.8"
              class="indexterm"></a><div
              class="para">
				Alors qu'un réseau IPv4 peut fonctionner sans ICMP, ICMPv6 est absolument indispensable dans le cadre d'un réseau IPv6 car il combine des fonctions jusqu'alors partagées entre ICMPv4, IGMP <span
                class="foreignphrase"><em
                  class="foreignphrase">(Internet Group Membership Protocol)</em></span> et ARP <span
                class="foreignphrase"><em
                  class="foreignphrase">(Address Resolution Protocol)</em></span>. La RFC 4 443 définit ce protocole. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc4443.html">http://www.faqs.org/rfcs/rfc4443.html</a></div>
			</div></div><div
            class="para">
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ACCEPT</code> : autoriser le paquet à poursuivre son parcours ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">REJECT</code> : rejeter le paquet (ICMP signale une erreur, l'option <code
                    class="literal">--reject-with <em
                      class="replaceable">type</em></code> d'<code
                    class="command">iptables</code> permet de choisir le type d'erreur renvoyée) ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DROP</code> : supprimer (ignorer) le paquet ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">LOG</code> : enregistrer (via <code
                    class="command">syslogd</code>) un message de log contenant une description du paquet traité (cette action retourne après exécution à sa position dans la chaîne appelante — celle qui a invoquée l'action — c'est pourquoi il est nécessaire de la faire suivre par une règle REJECT ou DROP si l'on veut simplement enregistrer la trace d'un paquet qui doit être refusé) ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ULOG</code> : enregistrer un message de log via <code
                    class="command">ulogd</code>, plus adapté et plus efficace que <code
                    class="command">syslogd</code> pour gérer de grandes quantités de messages (cette action renvoie aussi le fil d'exécution à sa position dans la chaîne appelante) ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<em
                    class="replaceable">nom_de_chaîne</em> : évaluer les règles de la chaîne indiquée ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">RETURN</code> : stopper l'évaluation de la chaîne courante et revenir sur la chaîne appelante (si la chaîne courante est une chaîne standard, dépourvue de chaîne appelante, effectuer l'action par défaut — il s'agit d'une action particulière qui se configure avec l'option <code
                    class="literal">-P</code> de <code
                    class="command">iptables</code>) ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SNAT</code> (seulement dans la table <code
                    class="literal">nat</code> : effectuer du <span
                    class="foreignphrase"><em
                      class="foreignphrase">Source NAT</em></span> (des options précisent les modifications à effectuer) ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DNAT</code> (seulement dans la table <code
                    class="literal">nat</code>) : effectuer du <span
                    class="foreignphrase"><em
                      class="foreignphrase">Destination NAT</em></span> (des options précisent les modifications à effectuer) ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">MASQUERADE</code> (seulement dans la table <code
                    class="literal">nat</code>) : effectuer du <code
                    class="command">masquerading</code> (SNAT particulier) ;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">REDIRECT</code> (seulement dans la table <code
                    class="literal">nat</code>) : rediriger un paquet vers un port particulier du pare-feu lui-même ; action notamment utile pour mettre en place un mandataire (ou proxy) web transparent (il s'agit d'un service pour lequel aucune configuration côté client n'est nécessaire, puisque le client a l'impression de se connecter directement au destinataire alors que ses échanges avec le serveur transitent systématiquement par le mandataire).
					</div></li></ul></div><div
            class="para">
				D'autres actions, concernant davantage la table <code
              class="literal">mangle</code>, ne sont pas mentionnées ici. Vous en trouverez la liste exhaustive dans les pages de manuel <span
              class="citerefentry"><span
                class="refentrytitle">iptables</span>(8)</span> et <span
              class="citerefentry"><span
                class="refentrytitle">ip6tables</span>(8)</span>.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.iptables"></a>14.2.2. Syntaxe de <code
                    class="command">iptables</code> et <code
                    class="command">ip6tables</code></h3></div></div></div><div
            class="para">
				Les commandes <code
              class="command">iptables</code> et <code
              class="command">ip6tables</code> permettent de manipuler les tables, les chaînes et les règles. L'option <code
              class="literal">-t <em
                class="replaceable">table</em></code> indique la table sur laquelle opérer (par défaut, c'est <code
              class="literal">filter</code>).
			</div><a
            id="id-1.17.5.13.3"
            class="indexterm"></a><a
            id="id-1.17.5.13.4"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.iptables-command"></a>14.2.2.1. Les commandes</h4></div></div></div><div
              class="para">
					L'option <code
                class="literal">-N <em
                  class="replaceable">chaîne</em></code> crée une nouvelle chaîne ; l'option <code
                class="literal">-X <em
                  class="replaceable">chaîne</em></code> supprime une chaîne vide et inutilisée. L'option <code
                class="literal">-A <em
                  class="replaceable">chaîne</em> <em
                  class="replaceable">règle</em></code> ajoute une règle à la fin de la chaîne indiquée. L'option <code
                class="literal">-I <em
                  class="replaceable">chaîne</em> <em
                  class="replaceable">numrègle</em> <em
                  class="replaceable">règle</em></code> insère une règle avant la règle numérotée <em
                class="replaceable">numrègle</em>. L'option <code
                class="literal">-D <em
                  class="replaceable">chaîne</em> <em
                  class="replaceable">numrègle</em></code> ou <code
                class="literal">-D <em
                  class="replaceable">chaîne</em> <em
                  class="replaceable">règle</em></code> supprime une règle dans la chaîne (la première syntaxe l'identifie par son numéro et la seconde par son contenu). L'option <code
                class="literal">-F <em
                  class="replaceable">chaîne</em></code> supprime toutes les règles de la chaîne (si celle-ci n'est pas mentionnée, elle supprime toutes les règles de la table). L'option <code
                class="literal">-L <em
                  class="replaceable">chaîne</em></code> affiche le contenu de la chaîne. Enfin, l'option <code
                class="literal">-P <em
                  class="replaceable">chaîne</em> <em
                  class="replaceable">action</em></code> définit l'action par défaut pour la chaîne donnée (seules les chaînes standards peuvent en avoir une).
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.iptables-rules"></a>14.2.2.2. Les règles</h4></div></div></div><a
              id="id-1.17.5.13.6.2"
              class="indexterm"></a><div
              class="para">
					Chaque règle s'exprime sous la forme <code
                class="literal"><em
                  class="replaceable">conditions</em> -j <em
                  class="replaceable">action</em> <em
                  class="replaceable">options_de_l'action</em></code>. En écrivant bout à bout plusieurs conditions dans la même règle, on en produit la conjonction (elles sont liées par des <span
                class="emphasis"><em>et</em></span> logiques), donc une condition plus restrictive.
				</div><div
              class="para">
					La condition <code
                class="literal">-p <em
                  class="replaceable">protocole</em></code> sélectionne selon le champ protocole du paquet IP, dont les valeurs les plus courantes sont <code
                class="literal">tcp</code>, <code
                class="literal">udp</code>, <code
                class="literal">icmp</code> et <code
                class="literal">icmpv6</code>. Préfixer la condition par un point d'exclamation inverse la condition (qui correspond alors à tous les paquets n'ayant pas le protocole indiqué). Cette manipulation est possible pour toutes les autres conditions énoncées ci-dessous.
				</div><div
              class="para">
					La condition <code
                class="literal">-s <em
                  class="replaceable">adresse</em></code> ou <code
                class="literal">-s <em
                  class="replaceable">réseau/masque</em></code> vérifie l'adresse source du paquet ; <code
                class="literal">-d <em
                  class="replaceable">adresse</em></code> ou <code
                class="literal">-d <em
                  class="replaceable">réseau/masque</em></code> en est le pendant pour l'adresse de destination.
				</div><div
              class="para">
					La condition <code
                class="literal">-i <em
                  class="replaceable">interface</em></code> sélectionne les paquets provenant de l'interface réseau indiquée ; <code
                class="literal">-o <em
                  class="replaceable">interface</em></code> sélectionne les paquets en fonction de leur interface réseau d'émission.
				</div><div
              class="para">
					D'autres conditions plus spécifiques existent, qui dépendent des conditions génériques déjà définies. La condition <code
                class="literal">-p tcp</code> peut par exemple être accompagnée de conditions sur les ports TCP avec <code
                class="literal">--source-port <em
                  class="replaceable">port</em></code> et <code
                class="literal">--destination-port <em
                  class="replaceable">port</em></code>.
				</div><div
              class="para">
					L'option <code
                class="literal">--state <em
                  class="replaceable">état</em></code> indique le statut du paquet dans une connexion (le module <code
                class="command">ipt_conntrack</code>, qui implémente le suivi des connexions, lui est nécessaire). L'état <code
                class="literal">NEW</code> désigne un paquet qui débute une nouvelle connexion. L'état <code
                class="literal">ESTABLISHED</code> concerne les paquets d'une connexion existante et l'état <code
                class="literal">RELATED</code> les paquets d'une nouvelle connexion liée à une connexion existante (c'est le cas des connexions <code
                class="literal">ftp-data</code> d'une session <code
                class="literal">ftp</code> en mode "actif").
				</div><div
              class="para">
					La section précédente détaille la liste des actions possibles, mais pas les options qui leur sont associées. L'action <code
                class="literal">LOG</code> dispose ainsi de plusieurs options visant à :
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							indiquer le niveau de sévérité du message à <code
                      class="command">syslog</code> (<code
                      class="literal">--log-level</code>, dont la valeur par défaut est <code
                      class="literal">warning</code>) ;
						</div></li><li
                  class="listitem"><div
                    class="para">
							préciser un préfixe textuel pour différencier les messages (<code
                      class="literal">--log-prefix</code>) ;
						</div></li><li
                  class="listitem"><div
                    class="para">
							indiquer les données à intégrer dans le message (<code
                      class="literal">--log-tcp-sequence</code> pour le numéro de séquence TCP, <code
                      class="literal">--log-tcp-options</code> pour les options TCP et <code
                      class="literal">--log-ip-options</code> pour les options IP).
						</div></li></ul></div><div
              class="para">
					L'action <code
                class="literal">DNAT</code> dispose de l'option <code
                class="literal">--to-destination <em
                  class="replaceable">adresse</em>:<em
                  class="replaceable">port</em></code> pour indiquer la nouvelle adresse IP et/ou le nouveau port de destination. De la même manière, l'action <code
                class="literal">SNAT</code> dispose de l'option <code
                class="literal">--to-source <em
                  class="replaceable">adresse</em>:<em
                  class="replaceable">port</em></code> pour indiquer la nouvelle adresse et/ou le nouveau port source.
				</div><div
              class="para">
					L'action <code
                class="literal">REDIRECT</code> (seulement disponible si le NAT est disponible) a une option <code
                class="literal">--to-ports <em
                  class="replaceable">port(s)</em></code> pour indiquer le port ou l'intervalle de ports vers lesquels rediriger les paquets.
				</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.creating-rules"></a>14.2.3. Créer les règles</h3></div></div></div><div
            class="para">
				Il faut invoquer <code
              class="command">iptables</code>/<code
              class="command">ip6tables</code> une fois par règle à créer ; c'est pourquoi on consigne habituellement tous les appels à cette commande dans un fichier de script pour mettre en place la même configuration à chaque redémarrage de la machine. On peut écrire ce script à la main mais il est souvent intéressant de le préparer à l'aide d'un outil de plus haut niveau, tel que <code
              class="command">fwbuilder</code>.
			</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>apt install fwbuilder</code></strong></pre><div
            class="para">
				Son principe est simple. Dans une première étape, il faut décrire tous les éléments susceptibles d'intervenir dans les différentes règles :
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						le pare-feu et ses interfaces réseau ;
					</div></li><li
                class="listitem"><div
                  class="para">
						les réseaux (et plages d'IP associées) ;
					</div></li><li
                class="listitem"><div
                  class="para">
						les serveurs ;
					</div></li><li
                class="listitem"><div
                  class="para">
						les ports correspondant aux services hébergés sur les différents serveurs.
					</div></li></ul></div><div
            class="para">
				On crée ensuite les règles par simple glisser/déposer des différents objets, quelques menus contextuels servant à modifier la condition (l'inverser, par exemple). Il ne reste qu'à saisir l'action souhaitée et à la paramétrer.
			</div><div
            class="para">
				On peut soit créer 2 jeux de règles différents pour IPv4 et IPv6, soit n'en créer qu'un seul et laisser <code
              class="command">fwbuilder</code> traduire les règles adéquates en fonction des différentes adresses assignées aux objets manipulés.
			</div><div
            class="figure"><a
              xmlns=""
              id="figure.fwbuilder"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/fwbuilder.png"
                  alt="Fwbuilder en action" /></div></div><p
              class="title"><strong>Figure 14.2. Fwbuilder en action</strong></p></div><a
            id="id-1.17.5.14.9"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">fwbuilder</code> peut alors générer un script de configuration du pare-feu selon les règles saisies. Son architecture modulaire lui permet de générer des scripts pour les pare-feu de différents systèmes (<code
              class="command">iptables</code> pour Linux, <code
              class="command">ipf</code> pour FreeBSD et <code
              class="command">pf</code> pour OpenBSD).
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.install-rules-at-boot"></a>14.2.4. Installer les règles à chaque démarrage</h3></div></div></div><div
            class="para">
				Dans les autres cas, le plus simple est d'inscrire le script de configuration du pare-feu dans une directive <code
              class="literal">up</code> du fichier <code
              class="filename">/etc/network/interfaces</code>. Dans l'exemple ci-dessous, ce script s'appelle <code
              class="filename">/usr/local/etc/arrakis.fw</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="example.network-interfaces-firewall"></a><p
              class="title"><strong>Exemple 14.1. Fichier <code
                  class="varname">interfaces</code> avec appel du script de pare-feu</strong></p><div
              class="example-contents"><pre
                class="programlisting">auto eth0
iface eth0 inet static
    address 192.168.0.1
    network 192.168.0.0
    netmask 255.255.255.0
    broadcast 192.168.0.255
    up /usr/local/etc/arrakis.fw
</pre></div></div><div
            class="para">
				Ces exemples supposent que les interfaces réseau sont configurées par <span
              class="pkg pkg">ifupdown</span>. Si vous utilisez un autre outil (par exemple <span
              class="emphasis"><em>NetworkManager</em></span> ou <span
              class="emphasis"><em>systemd-networkd</em></span>), il faudra vous référer à la documentation spécifique de cet outil pour trouver le moyen d'exécuter un script après la mise en marche de l'interface.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>Précédent</strong>Chapitre 14. Sécurité</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Niveau supérieur</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Sommaire</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>Suivant</strong>14.3. Supervision : prévention, détection, dissua...</a></li></ul></body></html>
