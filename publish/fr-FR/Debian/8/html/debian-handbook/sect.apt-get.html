<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">6.2. Commandes aptitude, apt-get et apt</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-fr-FR-1.0-1" /><meta
        name="keywords"
        content="apt, apt-get, apt-cache, aptitude, synaptic, sources.list, apt-cdrom" /><link
        rel="home"
        href="index.html"
        title="Le cahier de l'administrateur Debian" /><link
        rel="up"
        href="apt.html"
        title="Chapitre 6. Maintenance et mise à jour : les outils APT" /><link
        rel="prev"
        href="apt.html"
        title="Chapitre 6. Maintenance et mise à jour : les outils APT" /><link
        rel="next"
        href="sect.apt-cache.html"
        title="6.3. Commande apt-cache" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/fr-FR/stable/sect.apt-get.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>Précédent</strong></a></li><li
          class="home">Le cahier de l'administrateur Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>Suivant</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.apt-get"></a>6.2. Commandes <code
                  class="command">aptitude</code>, <code
                  class="command">apt-get</code> et <code
                  class="command">apt</code></h2></div></div></div><a
          id="id-1.9.11.2"
          class="indexterm"></a><a
          id="id-1.9.11.3"
          class="indexterm"></a><a
          id="id-1.9.11.4"
          class="indexterm"></a><div
          class="para">
			APT est un projet relativement vaste, qui prévoyait à l'origine une interface graphique. Il repose sur une bibliothèque contenant le cœur de l'application et <code
            class="command">apt-get</code> est la première interface — en ligne de commande — développée dans le cadre du projet. <code
            class="command">apt</code> est une deuxième interface en ligne de commande fournie par APT qui corrige quelques erreurs de conception de <code
            class="command">apt-get</code>.
		</div><div
          class="para">
			De nombreuses interfaces graphiques sont ensuite apparues en tant que projets extérieurs : <code
            class="command">synaptic</code> (interface graphique), <code
            class="command">aptitude</code> (qui inclut à la fois une interface en mode texte et une interface graphique, bien que pas encore complète), <code
            class="command">wajig</code>, etc. Le frontal le plus recommandé, <code
            class="command">apt</code>, est celui que nous utiliserons pour les exemples de cette section. Notez cependant que les syntaxes en ligne de commande d'<code
            class="command">aptitude</code> et d'<code
            class="command">apt-get</code> sont très similaires. En cas de différences notables entre <code
            class="command">apt</code>, <code
            class="command">apt-get</code> et <code
            class="command">aptitude</code> celles-ci seront détaillées.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.11.7"></a>6.2.1. Initialisation</h3></div></div></div><div
            class="para">
				Un préalable à tout travail avec APT est la mise à jour de la liste des paquets disponibles, qui s'effectue avec un simple <code
              class="command">apt update</code>. Selon le débit de votre connexion, cette opération peut durer puisqu'elle télécharge un certain nombre de fichiers <code
              class="filename">Packages</code>/<code
              class="filename">Sources</code>/<code
              class="filename">Translation-<em
                class="replaceable">code_langue</em></code>, devenus assez volumineux au fil de la croissance de Debian (plus de 10 Mo pour la section <code
              class="literal">main</code>). Évidemment, une installation à partir d'un jeu de CD-Rom ne nécessite aucun téléchargement — cette opération est alors très rapide.
			</div><a
            id="id-1.9.11.7.3"
            class="indexterm"></a><a
            id="id-1.9.11.7.4"
            class="indexterm"></a><a
            id="id-1.9.11.7.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.11.8"></a>6.2.2. Installation et suppression</h3></div></div></div><a
            id="id-1.9.11.8.2"
            class="indexterm"></a><a
            id="id-1.9.11.8.3"
            class="indexterm"></a><a
            id="id-1.9.11.8.4"
            class="indexterm"></a><a
            id="id-1.9.11.8.5"
            class="indexterm"></a><div
            class="para">
				APT permet d'ajouter ou de supprimer des paquets sur le système, respectivement avec <code
              class="command">apt install <em
                class="replaceable">paquet</em></code> et <code
              class="command">apt remove <em
                class="replaceable">paquet</em></code>. Dans chaque cas, APT installera automatiquement les dépendances nécessaires ou supprimera les paquets dépendant du paquet en cours de désinstallation. La commande <code
              class="command">apt purge <em
                class="replaceable">paquet</em></code> demande une désinstallation complète — les fichiers de configuration sont alors également supprimés.
			</div><a
            id="id-1.9.11.8.7"
            class="indexterm"></a><a
            id="id-1.9.11.8.8"
            class="indexterm"></a><a
            id="id-1.9.11.8.9"
            class="indexterm"></a><a
            id="id-1.9.11.8.10"
            class="indexterm"></a><a
            id="id-1.9.11.8.11"
            class="indexterm"></a><a
            id="id-1.9.11.8.12"
            class="indexterm"></a><a
            id="id-1.9.11.8.13"
            class="indexterm"></a><a
            id="id-1.9.11.8.14"
            class="indexterm"></a><a
            id="id-1.9.11.8.15"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ASTUCE</em></span> Installer la même sélection de paquets plusieurs fois</strong></p></div></div></div><div
              class="para">
				Il est parfois souhaitable de pouvoir installer systématiquement la même liste de paquets sur plusieurs ordinateurs. C'est possible assez facilement.
			</div><div
              class="para">
				Récupérons d'abord la liste des paquets installés sur l'ordinateur qui servira de « modèle » à dupliquer.
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --get-selections &gt;liste-pkg</code></strong></pre><div
              class="para">
				Le fichier <code
                class="filename">liste-pkg</code> contient la liste des paquets installés. Il faut alors transférer le fichier <code
                class="filename">liste-pkg</code> sur les ordinateurs à mettre à jour et y employer les commandes suivantes :
			</div><pre
              class="screen">## Mettre à jour la base de données des paquets connus par dpkg
# <strong
                class="userinput"><code>avail=`mktemp`</code></strong>
# <strong
                class="userinput"><code>apt-cache dumpavail &gt; "$avail"</code></strong>
# <strong
                class="userinput"><code>dpkg --merge-avail "$avail"</code></strong>
# <strong
                class="userinput"><code>rm -f "$avail"</code></strong>
## Mettre à jour les sélections de dpkg
# <strong
                class="userinput"><code>dpkg --set-selections &lt; pkg-list</code></strong>
## Demander à apt-get d'installer les paquets sélectionnés
# <strong
                class="userinput"><code>apt-get dselect-upgrade</code></strong></pre><div
              class="para">
				La première commande enregistre la liste des paquets disponibles dans la base de données de dpkg, puis <code
                class="command">dpkg --set-selections</code> restaure les vœux de paquets à installer, que l'invocation d'<code
                class="command">apt-get</code> exauce ensuite ! <code
                class="command">aptitude</code> n'offre pas cette commande.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ASTUCE</em></span> Supprimer et installer en même temps</strong></p></div></div></div><div
              class="para">
				Il est possible, en ajoutant un suffixe, de demander à <code
                class="command">apt</code> (ou <code
                class="command">apt-get</code>, ou <code
                class="command">aptitude</code>) d'installer certains paquets et d'en supprimer d'autres sur la même ligne de commande. Lors d'une commande <code
                class="command">apt install</code>, ajoutez un « <code
                class="literal">-</code> » aux noms des paquets que vous souhaitez supprimer. Lors d'une commande <code
                class="command">apt remove</code>, ajoutez un « <code
                class="literal">+</code> » aux noms des paquets que vous souhaitez installer.
			</div><div
              class="para">
				L'exemple suivant montre deux manières d'installer <em
                class="replaceable">paquet1</em> et de supprimer <em
                class="replaceable">paquet2</em>.
			</div><pre
              class="screen"># <strong
                class="userinput"><code>apt install <em
                    class="replaceable">paquet1</em> <em
                    class="replaceable">paquet2-</em></code></strong>
[...]
# <strong
                class="userinput"><code>apt remove <em
                    class="replaceable">paquet1+</em> <em
                    class="replaceable">paquet2</em></code></strong>
[...]
</pre><div
              class="para">
				Ceci permet également d'exclure des paquets qui seraient installés sinon, par exemple à cause d'un champ <code
                class="literal">Recommends</code>. De manière générale, le résolveur de dépendances utilisera cette information pour ajuster sa recherche de solutions alternatives.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ASTUCE</em></span> <code
                        class="command">apt --reinstall</code> et <code
                        class="command">aptitude reinstall</code></strong></p></div></div></div><a
              id="id-1.9.11.8.18.2"
              class="indexterm"></a><div
              class="para">
				Il arrive que le système soit endommagé suite à la suppression ou à la modification de fichiers appartenant à un paquet. Le moyen le plus simple de récupérer ces fichiers est alors de réinstaller le paquet concerné. Malheureusement, le système de paquetage considère que ce dernier est déjà installé et refuse poliment de s'exécuter ; l'option <code
                class="literal">--reinstall</code> des commandes <code
                class="command">apt</code> et <code
                class="command">apt-get</code> permet précisément d'éviter cet écueil. La commande ci-dessous réinstalle <span
                class="pkg pkg">postfix</span> même si ce dernier est déjà présent.
			</div><pre
              class="screen"><code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt --reinstall install postfix</code></strong></pre><div
              class="para">
				La ligne de commande d'<code
                class="command">aptitude</code> est un peu différente, mais le même effet s'obtient avec <code
                class="command">aptitude reinstall postfix</code>.
			</div><div
              class="para">
				Le problème ne se pose pas avec <code
                class="command">dpkg</code>, mais il est rare que l'administrateur emploie directement ce dernier.
			</div><div
              class="para">
				Attention ! Recourir à <code
                class="command">apt --reinstall</code> pour restaurer des paquets modifiés au cours d'une attaque ne suffit certainement pas à retrouver un système identique à ce qu'il était au préalable. La <a
                class="xref"
                href="sect.dealing-with-compromised-machine.html">Section 14.7, « En cas de piratage »</a> détaille la marche à suivre si vous avez subi un tel incident de sécurité.
			</div></div><div
            class="para">
				Si le fichier <code
              class="filename">sources.list</code> mentionne plusieurs distributions, il est possible de préciser la version du paquet à installer. On peut demander un numéro de version précis avec <code
              class="command">apt install <em
                class="replaceable">paquet</em>=<em
                class="replaceable">version</em></code>, mais on se contentera en général d'indiquer la distribution d'origine du paquet (<span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span> ou <span
              class="distribution distribution">Unstable</span>) avec la syntaxe <code
              class="command">apt install <em
                class="replaceable">paquet</em>/<em
                class="replaceable">distribution</em></code>. Avec cette commande, on pourra donc revenir à une ancienne version d'un paquet (si par exemple on sait qu'elle fonctionne bien), à condition qu'elle soit encore disponible dans une des sources référencées par le fichier <code
              class="filename">sources.list</code>. On pourra au besoin utiliser l'archive <code
              class="literal">snapshot.debian.org</code> (voir encadré <a
              class="xref"
              href="apt.html#sidebar.snapshot.debian.org"><span
                class="emphasis"><em>POUR ALLER PLUS LOIN</em></span> Anciennes versions des paquets : <code
                class="literal">snapshot.debian.org</code></a>).
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.9.11.8.20"></a><p
              class="title"><strong>Exemple 6.3. Installation de la version <span
                  class="distribution distribution">Unstable</span> de <span
                  class="pkg pkg">spamassassin</span></strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>apt install spamassassin/unstable</code></strong></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>POUR ALLER PLUS LOIN</em></span> Cache des fichiers <code
                        class="filename">.deb</code></strong></p></div></div></div><div
              class="para">
				APT conserve dans le répertoire <code
                class="filename">/var/cache/apt/archives/</code> une copie de chaque fichier <code
                class="filename">.deb</code> téléchargé. Dans le cas de mises à jour fréquentes, ce répertoire peut rapidement occuper beaucoup d'espace disque avec plusieurs versions de chaque paquet ; il convient donc d'y faire régulièrement le tri. Deux commandes existent pour cela : <code
                class="command">apt-get clean</code> vide entièrement le répertoire ; <code
                class="command">apt-get autoclean</code> ne supprime que les paquets qui, n'étant plus téléchargeables (car ayant disparu du miroir Debian), sont clairement inutiles (le paramètre de configuration <code
                class="literal">APT::Clean-Installed</code> permet d'empêcher la suppression de fichiers <code
                class="filename">.deb</code> encore actuellement installés). Signalons que <code
                class="command">apt</code> ne supporte pas ces commandes.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-upgrade"></a>6.2.3. Mise à jour</h3></div></div></div><a
            id="id-1.9.11.9.2"
            class="indexterm"></a><a
            id="id-1.9.11.9.3"
            class="indexterm"></a><a
            id="id-1.9.11.9.4"
            class="indexterm"></a><a
            id="id-1.9.11.9.5"
            class="indexterm"></a><div
            class="para">
				Des mises à jour régulières sont recommandées, car elles mettront en place les derniers correctifs de sécurité. Pour cela, on invoquera <code
              class="command">apt upgrade</code>, <code
              class="command">apt-get upgrade</code> ou <code
              class="command">aptitude safe-upgrade</code> (évidemment précédé par <code
              class="command">apt update</code>). Cette commande cherche les mises à jour des paquets installés, réalisables sans supprimer de paquets. Autrement dit, l'objectif est d'assurer une mise à jour la moins intrusive possible. Pour cette action, <code
              class="command">apt-get</code> est un peu plus exigeant que <code
              class="command">aptitude</code> ou <code
              class="command">apt</code> parce qu'il refusera d'installer des paquets qui ne l'étaient pas préalablement.
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.apt-pdiff"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ASTUCE</em></span> Mise à jour incrémentale</strong></p></div></div></div><div
              class="para">
				On l'a vu, le but de la commande <code
                class="command">apt update</code> est de télécharger pour chacune des sources de paquets le fichier <code
                class="filename">Packages</code> (ou <code
                class="filename">Sources</code>) correspondant. Cependant, même après compression <code
                class="command">bzip2</code>, ces fichiers restent volumineux (le <code
                class="filename">Packages.xz</code> pour la section <span
                class="foreignphrase"><em
                  class="foreignphrase">main</em></span> de <span
                class="distribution distribution">Jessie</span> occupe plus de 5 Mo). Si l'on souhaite effectuer des mises à jour régulières, ces téléchargements peuvent prendre du temps inutilement.
			</div><div
              class="para">
				Pour accélérer le processus, APT peut télécharger non plus le fichier entier mais simplement les différences par rapport à une version précédente. Les miroirs Debian officiels distribuent pour cela différents fichiers recensant les différences d'une version du fichier <code
                class="filename">Packages</code> à la suivante, lors des mises à jour des archives, avec un historique d'une semaine. Chacun de ces fichiers de différences ne pesant en général que quelques dizaines de kilo-octets pour <span
                class="distribution distribution">Unstable</span>, la quantité de données téléchargées par un <code
                class="command">apt update</code> hebdomadaire est typiquement divisée par 10. Pour les distributions moins mobiles, comme <span
                class="distribution distribution">Stable</span> et <span
                class="distribution distribution">Testing</span>, le gain est encore plus flagrant.
			</div><div
              class="para">
				On notera cependant qu'il est parfois intéressant de forcer le téléchargement du fichier <code
                class="filename">Packages</code> complet, notamment lorsque la dernière mise à jour est vraiment trop ancienne et que le mécanisme des différences incrémentales n'apporterait rien. Cela peut également être intéressant dans les cas où l'accès réseau est très rapide mais où le processeur de la machine à mettre à jour est relativement lent, le temps gagné sur le téléchargement des fichiers étant plus que perdu lors du calcul des nouvelles versions de ces fichiers à partir des anciennes versions et des différences téléchargées. Pour cela, on pourra utiliser le paramètre de configuration <code
                class="literal">Acquire::Pdiffs</code>, que l'on règlera à <code
                class="literal">false</code>.
			</div></div><div
            class="para">
				Remarquons cependant qu'<code
              class="command">apt</code> retiendra en général le numéro de version le plus récent (à l'exception des paquets <span
              class="distribution distribution">Experimental</span> et des rétroportages, ignorés par défaut quel que soit leur numéro de version). Si vous avez mentionné <span
              class="distribution distribution">Testing</span> ou <span
              class="distribution distribution">Unstable</span> dans votre <code
              class="filename">sources.list</code>, <code
              class="command">apt upgrade</code> migrera une grande partie de votre système <span
              class="distribution distribution">Stable</span> en <span
              class="distribution distribution">Testing</span> ou <span
              class="distribution distribution">Unstable</span>, ce qui n'est peut-être pas l'effet recherché.
			</div><div
            class="para">
				Pour indiquer à <code
              class="command">apt</code> d'utiliser telle ou telle distribution pour ses recherches de paquets mis à jour, il faut utiliser l'option <code
              class="literal">-t</code> ou <code
              class="literal">--target-release</code> (version cible), suivie du nom de la distribution en question (exemple : <code
              class="command">apt -t stable upgrade</code>). Pour éviter de spécifier cette option à chaque invocation d'<code
              class="command">apt</code>, vous pouvez ajouter <code
              class="literal">APT::Default-Release "stable";</code> dans le fichier <code
              class="filename">/etc/apt/apt.conf.d/local</code>.
			</div><a
            id="id-1.9.11.9.10"
            class="indexterm"></a><a
            id="id-1.9.11.9.11"
            class="indexterm"></a><a
            id="id-1.9.11.9.12"
            class="indexterm"></a><a
            id="id-1.9.11.9.13"
            class="indexterm"></a><a
            id="id-1.9.11.9.14"
            class="indexterm"></a><div
            class="para">
				Pour les mises à jour plus importantes, comme lors du basculement d'une version majeure de Debian à la suivante, il faut utiliser <code
              class="command">apt full-upgrade</code>. Cela effectue la mise à jour même s'il y a des paquets obsolètes à supprimer et de nouvelles dépendances à installer. C'est également la commande employée par ceux qui exploitent quotidiennement la version <span
              class="distribution distribution">Unstable</span> de Debian et suivent ses évolutions au jour le jour. Elle est si simple qu'elle parle d'elle-même : c'est bien cette fonctionnalité qui a fait la renommée d'APT.
			</div><div
            class="para">
				Contrairement à <code
              class="command">apt</code> et <code
              class="command">aptitude</code>, <code
              class="command">apt-get</code> n'a pas la commande <code
              class="command">full-upgrade</code>. À la place, on utilisera <code
              class="command">apt-get dist-upgrade</code> (mise à jour de la distribution), qui est la commande historique et bien connue que <code
              class="command">apt</code> et <code
              class="command">aptitude</code> acceptent également pour le confort des utilisateurs qui sont habitués à les utiliser.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-config"></a>6.2.4. Options de configuration</h3></div></div></div><a
            id="id-1.9.11.10.2"
            class="indexterm"></a><a
            id="id-1.9.11.10.3"
            class="indexterm"></a><a
            id="id-1.9.11.10.4"
            class="indexterm"></a><div
            class="para">
				Outre les éléments de configuration déjà mentionnés, il est possible de configurer quelques aspects d'APT en ajoutant des directives dans un fichier du répertoire <code
              class="filename">/etc/apt/apt.conf.d/</code>. Rappelons par exemple qu'il est possible pour APT d'indiquer à <code
              class="command">dpkg</code> d'ignorer les erreurs de collision de fichiers en précisant <code
              class="literal">DPkg::options { "--force-overwrite"; }</code>.
			</div><div
            class="para">
				Si l'accès au Web n'est possible qu'à travers un mandataire (proxy), il faut ajouter une ligne semblable à <code
              class="literal">Acquire::http::proxy "http://<em
                class="replaceable">monproxy</em>:3128"</code>. Pour un proxy FTP, on écrira <code
              class="literal">Acquire::ftp::proxy "ftp://<em
                class="replaceable">monproxy</em>"</code>. Découvrez par vous-même les autres options de configuration en consultant la page de manuel <span
              class="citerefentry"><span
                class="refentrytitle">apt.conf</span>(5)</span>, avec la commande <code
              class="command">man apt.conf</code> (pour plus de détails sur les pages de manuel, voir <a
              class="xref"
              href="solving-problems.html#sect.manual-pages">Section 7.1.1, « Les pages de manuel »</a>).
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.directory.d"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>B.A.-BA</em></span> Répertoire en <code
                        class="filename">.d</code></strong></p></div></div></div><a
              id="id-1.9.11.10.7.2"
              class="indexterm"></a><div
              class="para">
				Les répertoires de suffixe <code
                class="filename">.d</code> sont de plus en plus souvent employés. Chacun abrite des fichiers ventilant un fichier de configuration. Ainsi, tous les fichiers contenus dans <code
                class="filename">/etc/apt/apt.conf.d/</code> constituent les instructions de configuration d'APT. APT les inclura dans l'ordre alphabétique, de sorte que les derniers pourront modifier un élément de configuration défini dans l'un des premiers.
			</div><div
              class="para">
				Cette structure apporte une certaine souplesse à l'administrateur de la machine et aux mainteneurs de paquets. En effet, l'administrateur peut facilement modifier la configuration du logiciel en déposant un fichier tout prêt dans le répertoire en question sans devoir modifier de fichier existant. Les mainteneurs de paquets ont la même problématique lorsqu'ils doivent adapter la configuration d'un autre logiciel pour assurer une parfaite cohabitation avec le leur. La charte Debian interdit explicitement toute modification de fichiers de configuration relevant d'autres paquets, interdiction justifiée par le fait que seuls les utilisateurs sont habilités à intervenir ainsi. Rappelons en effet que <code
                class="command">dpkg</code> invite l'utilisateur, lors d'une installation, à choisir la version du fichier de configuration qu'il souhaite conserver lorsqu'une modification y est détectée. Toute modification externe du fichier déclencherait une telle requête, qui ne manquerait pas de perturber l'administrateur certain de n'avoir rien altéré.
			</div><div
              class="para">
				En l'absence de répertoire <code
                class="filename">.d</code>, il est impossible à un paquet externe d'adapter les réglages d'un logiciel sans en modifier le fichier de configuration. Il doit alors inviter l'utilisateur à intervenir lui-même, en documentant les opérations à effectuer dans le fichier <code
                class="filename">/usr/share/doc/<em
                  class="replaceable">paquet</em>/README.Debian</code>.
			</div><div
              class="para">
				Selon les applications, le répertoire <code
                class="filename">.d</code> est directement exploité, ou géré par un script externe qui en concaténera tous les fichiers pour créer le fichier de configuration à proprement parler. Il est alors important d'exécuter ce script après toute intervention dans ce répertoire pour que les plus récentes modifications soient prises en compte. De même, on prendra soin de ne pas travailler directement sur le fichier de configuration construit automatiquement, sous peine de tout perdre lors de l'exécution suivante du script. Le choix de la méthode (répertoire <code
                class="filename">.d</code> utilisé directement ou fichier généré à partir de ce répertoire) est généralement dicté par des contraintes de mise en œuvre, mais dans les deux cas, les gains en termes de souplesse de configuration compensent largement les petites complications induites. Comme exemple de la méthode du fichier généré, on peut citer le serveur de messagerie Exim 4, dont la configuration peut être découpée en plusieurs fichiers (<code
                class="filename">/etc/exim4/conf.d/*</code>) qui sont agrégés en un seul (<code
                class="filename">/var/lib/exim4/config.autogenerated</code>) par la commande <code
                class="command">update-exim4.conf</code>.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt.priorities"></a>6.2.5. Gérer les priorités associées aux paquets</h3></div></div></div><div
            class="para">
				Une des problématiques les plus importantes dans la configuration d'APT est la gestion des priorités des différentes sources de paquets. Il arrive en effet assez fréquemment qu'on souhaite compléter une distribution d'un ou deux paquets plus récents issus de <span
              class="distribution distribution">Testing</span>, <span
              class="distribution distribution">Unstable</span> ou <span
              class="distribution distribution">Experimental</span>. Il est possible d'affecter une priorité à chaque paquet disponible (un même paquet pouvant recevoir plusieurs priorités, selon sa version ou sa distribution d'appartenance). Ces priorités dicteront à APT son comportement : pour chaque paquet, il sélectionnera systématiquement la version de plus haute priorité (sauf si cette version est plus ancienne que celle installée et si la priorité associée est inférieure à 1 000).
			</div><a
            id="id-1.9.11.11.3"
            class="indexterm"></a><a
            id="id-1.9.11.11.4"
            class="indexterm"></a><a
            id="id-1.9.11.11.5"
            class="indexterm"></a><a
            id="id-1.9.11.11.6"
            class="indexterm"></a><a
            id="id-1.9.11.11.7"
            class="indexterm"></a><a
            id="id-1.9.11.11.8"
            class="indexterm"></a><a
            id="id-1.9.11.11.9"
            class="indexterm"></a><div
            class="para">
				APT définit un certain nombre de priorités par défaut. Chaque version de paquetage déjà installée a une priorité de 100, une version non installée reçoit une priorité de 500 sauf si elle fait partie de la distribution cible <span
              class="foreignphrase"><em
                class="foreignphrase">(Target Release)</em></span>, qu'on spécifie avec l'option <code
              class="literal">-t</code> ou la directive <code
              class="literal">APT::Default-Release</code>, auquel cas sa priorité passe à 990.
			</div><div
            class="para">
				On modifiera ces priorités en intervenant sur le fichier <code
              class="filename">/etc/apt/preferences</code> pour y ajouter des entrées de quelques lignes décrivant le nom des paquets concernés, leur version, leur origine et leur nouvelle priorité.
			</div><div
            class="para">
				APT refusera toujours d'installer une version antérieure d'un paquet (portant un numéro de version inférieur à celui de la version actuelle), sauf si la priorité du paquet concerné est supérieure à 1 000. APT installera toujours la version de priorité la plus élevée. Si deux versions ont la même priorité, APT installe la plus récente (le numéro de version le plus grand). Si deux paquets de même version ont la même priorité mais diffèrent par leurs contenus, APT installe la version qui n'est pas installée (cette règle doit couvrir le cas d'une mise à jour de paquet sans incrément — normalement indispensable — du numéro de révision).
			</div><div
            class="para">
				Concrètement, un paquet de priorité inférieure à 0 ne sera jamais installé. Un paquet de priorité comprise entre 0 et 100 ne sera installé que si aucune autre version du même paquet n'est installée. Avec une priorité comprise entre 100 et 500, le paquet ne sera installé que s'il n'en existe aucune version plus récente, installée ou disponible dans une autre distribution. Un paquet de priorité entre 501 et 990 ne sera installé qu'à défaut de version plus récente, installée ou disponible dans la distribution cible. Une priorité entre 990 et 1 000 fera installer le paquet, sauf si la version installée est plus récente. Une priorité supérieure à 1 000 provoquera l'installation du paquet, même si cela force APT à installer une version plus ancienne que la version actuelle.
			</div><div
            class="para">
				Quand APT consulte le fichier <code
              class="filename">/etc/apt/preferences</code>, il prend d'abord en compte les entrées les plus précises (souvent, celles spécifiant le paquet concerné), puis les plus génériques (incluant par exemple tous les paquets d'une distribution). Si plusieurs entrées génériques existent, la première correspondant au paquet dont on cherche la priorité est utilisée. Les critères de sélection disponibles comprennent notamment le nom du paquet et la source d'où il provient. Chaque source de paquets est identifiée par un ensemble d'informations contenues dans un fichier <code
              class="filename">Release</code>, qu'APT télécharge en même temps que les fichiers <code
              class="filename">Packages.gz</code>. Ce dernier spécifie l'origine (habituellement « Debian » pour les paquets des miroirs officiels, mais il peut s'agir du nom d'une personne ou d'un organisme proposant une archive de paquets Debian) ; il précise également le nom de la distribution (habituellement <span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span>, <span
              class="distribution distribution">Unstable</span> ou <span
              class="distribution distribution">Experimental</span> pour les distributions standards fournies par Debian) ainsi que sa version (par exemple 8 pour Debian <span
              class="distribution distribution">Jessie</span>). Étudions-en la syntaxe précise au travers de quelques cas vraisemblables d'emploi de ce mécanisme.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CAS PARTICULIER</em></span> Priorité d'<span
                        class="distribution distribution">Experimental</span></strong></p></div></div></div><a
              id="id-1.9.11.11.15.2"
              class="indexterm"></a><div
              class="para">
				Si vous avez inscrit <span
                class="distribution distribution">Experimental</span> dans votre fichier <code
                class="filename">sources.list</code>, les paquets correspondants ne seront quasiment jamais installés, leur priorité APT étant de 1. C'est un cas particulier qui évite que les utilisateurs installent des paquets <span
                class="distribution distribution">Experimental</span> par erreur et les oblige à opérer en tapant <code
                class="command">aptitude install <em
                  class="replaceable">paquet</em>/experimental</code> — ils ont donc pleinement conscience des risques encourus. Il est possible, mais ce n'est <span
                class="emphasis"><em>pas</em></span> recommandé, de considérer les paquets <span
                class="distribution distribution">Experimental</span> comme ceux des autres distributions en leur affectant une priorité de 500 grâce à une entrée dans le fichier <code
                class="filename">/etc/apt/preferences</code> :
			</div><div
              class="informalexample"><pre
                class="programlisting">Package: *
Pin: release a=experimental
Pin-Priority: 500</pre></div></div><div
            class="para">
				Supposons qu'on souhaite utiliser exclusivement des paquets provenant de la version stable de Debian, sans jamais installer ceux des autres versions sauf demande explicite. Il est possible d'écrire ce qui suit dans le fichier <code
              class="filename">/etc/apt/preferences</code> :
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: *
Pin: release a=stable
Pin-Priority: 900

Package: *
Pin: release o=Debian
Pin-Priority: -10</pre></div><div
            class="para">
				<code
              class="literal">a=stable</code> précise le nom de la distribution concernée. <code
              class="literal">o=Debian</code> restreint l'entrée aux paquets dont l'origine est « Debian ». Le terme <span
              class="foreignphrase"><em
                class="foreignphrase">pin</em></span> (épingle en anglais), est généralement traduit, dans ce contexte, par « étiquetage », car il permet d'accrocher à un paquet une étiquette désignant de quelle distribution il doit provenir.
			</div><div
            class="para">
				Supposons maintenant que nous disposions d'un serveur ayant installé de nombreux programmes spécifiques à la version 5.14 de Perl et que l'on veuille s'assurer qu'aucune mise à jour n'en installera une autre version. On peut pour cela utiliser cette entrée :
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: perl
Pin: version 5.14*
Pin-Priority: 1001
</pre></div><div
            class="para">
				La documentation de référence sur ce fichier de configuration est disponible dans la page de manuel <span
              class="citerefentry"><span
                class="refentrytitle">apt_preferences</span>(5)</span>, accessible par la commande <code
              class="command">man apt_preferences</code>.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ASTUCE</em></span> Commentaires dans <code
                        class="filename">/etc/apt/preferences</code></strong></p></div></div></div><a
              id="id-1.9.11.11.22.2"
              class="indexterm"></a><a
              id="id-1.9.11.11.22.3"
              class="indexterm"></a><a
              id="id-1.9.11.11.22.4"
              class="indexterm"></a><div
              class="para">
				Il n'existe pas de syntaxe standard pour introduire des commentaires dans le fichier <code
                class="filename">/etc/apt/preferences</code>, mais il est possible d'y expliquer le rôle de chaque entrée à l'aide d'un ou plusieurs champs « <code
                class="literal">Explanation</code> » (explication) placés en début de bloc :
			</div><div
              class="informalexample"><pre
                class="programlisting">Explanation: Le paquet xserver-xorg-video-intel contenu dans
Explanation: experimental peut être utilisé
Package: xserver-xorg-video-intel
Pin: release a=experimental
Pin-Priority: 500</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-mix-distros"></a>6.2.6. Travailler avec plusieurs distributions</h3></div></div></div><div
            class="para">
				L'outil formidable qu'est <code
              class="command">apt</code> incite fortement à mettre en place des paquets provenant d'autres distributions. Ainsi, après avoir installé une version <span
              class="distribution distribution">Stable</span>, vous voulez tester un logiciel présent dans <span
              class="distribution distribution">Testing</span> ou <span
              class="distribution distribution">Unstable</span>, sans trop vous éloigner de son état initial.
			</div><div
            class="para">
				Même si vous n'êtes pas complètement à l'abri de bogues d'interactions entre les paquets de différentes distributions, <code
              class="command">apt</code> se révèle fort heureusement très habile pour gérer une telle cohabitation et en minimiser les risques. La meilleure manière de procéder est de préciser toutes les distributions employées dans le fichier <code
              class="filename">/etc/apt/sources.list</code> (certains y placent toujours les trois distributions, mais rappelons que l'utilisation d'<span
              class="distribution distribution">Unstable</span> est réservée aux utilisateurs expérimentés) et de préciser votre distribution de référence avec le paramètre <code
              class="literal">APT::Default-Release</code> (voir <a
              class="xref"
              href="sect.apt-get.html#sect.apt-upgrade">Section 6.2.3, « Mise à jour »</a>).
			</div><div
            class="para">
				Supposons que <span
              class="distribution distribution">Stable</span> soit votre distribution de référence, mais que <span
              class="distribution distribution">Testing</span> et <span
              class="distribution distribution">Unstable</span> apparaissent également dans votre fichier <code
              class="filename">sources.list</code>. Dans ce cas, vous pouvez employer <code
              class="command">apt install <em
                class="replaceable">paquet</em>/testing</code> pour installer un paquet depuis <span
              class="distribution distribution">Testing</span>. Si l'installation échoue parce que certaines dépendances ne peuvent pas être satisfaites, autorisez-le à satisfaire ces dernières dans <span
              class="distribution distribution">Testing</span> en ajoutant le paramètre <code
              class="literal">-t testing</code>. Il en ira évidemment de même pour <span
              class="distribution distribution">Unstable</span>.
			</div><div
            class="para">
				Dans cette situation, les mises à jour (« <code
              class="command">upgrade</code> » et « <code
              class="command">full-upgrade</code> ») ont lieu dans le cadre de <span
              class="distribution distribution">Stable</span>, sauf pour les paquets mis à jour depuis une autre distribution : ces derniers suivront les dernières évolutions dans celles-là. Nous donnons ci-après l'explication de ce comportement grâce aux priorités automatiques employées par APT. N'hésitez pas à employer <code
              class="command">apt-cache policy</code> (voir encadré <a
              class="xref"
              href="sect.apt-get.html#sidebar.apt-cache-policy"><span
                class="emphasis"><em>ASTUCE</em></span> <code
                class="command">apt-cache policy</code></a>) pour vérifier les priorités indiquées.
			</div><div
            class="para">
				Tout est lié au fait que APT ne considère que les paquets de version supérieure ou égale à la version installée (sauf configuration particulière dans <code
              class="filename">/etc/apt/preferences</code> forçant la priorité de certains paquets au-delà de 1 000).
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.apt-cache-policy"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ASTUCE</em></span> <code
                        class="command">apt-cache policy</code></strong></p></div></div></div><div
              class="para">
				Pour mieux comprendre le mécanisme des priorités, n'hésitez pas à employer <code
                class="command">apt-cache policy</code> pour voir la priorité par défaut associée à chaque source de paquets, et <code
                class="command">apt-cache policy <em
                  class="replaceable">paquet</em></code> pour consulter les priorités des différentes versions disponibles d'un paquet donné.
			</div></div><div
            class="para">
				Considérons un premier paquet installé depuis <span
              class="distribution distribution">Stable</span> et qui en est à la version 1, dont la version 2 se trouve dans <span
              class="distribution distribution">Testing</span> et la 3 dans <span
              class="distribution distribution">Unstable</span>. La version installée a une priorité de 100, mais la version disponible dans <span
              class="distribution distribution">Stable</span> (la même) a une priorité de 990 (en tant que version dans la distribution cible). Les paquets de <span
              class="distribution distribution">Testing</span> et <span
              class="distribution distribution">Unstable</span> ont une priorité de 500 (priorité par défaut d'une version non installée). Le vainqueur est donc la version 1 avec une priorité de 990. Le paquet « reste dans <span
              class="distribution distribution">Stable</span> ».
			</div><div
            class="para">
				Prenons le cas d'un autre paquet, dont la version 2 a été installée depuis <span
              class="distribution distribution">Testing</span> ; la version 1 est disponible dans <span
              class="distribution distribution">Stable</span> et la 3 dans <span
              class="distribution distribution">Unstable</span>. La version 1 (de priorité 990 — donc inférieure à 1 000) est ignorée car plus petite que la version installée. Restent donc les versions 2 et 3, toutes deux de priorité 500. Face à ce choix, APT choisit la version la plus récente, celle de la distribution <span
              class="distribution distribution">Unstable</span>. Si vous ne souhaitez pas qu'un paquet installé depuis <span
              class="distribution distribution">Testing</span> puisse migrer vers <span
              class="distribution distribution">Unstable</span>, il faut associer une priorité inférieure à 500 (par exemple, 490) aux paquets provenant d'<span
              class="distribution distribution">Unstable</span> en modifiant <code
              class="filename">/etc/apt/preferences</code> :
			</div><pre
            class="programlisting">Package: *
Pin: release a=unstable
Pin-Priority: 490</pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.automatic-tracking"></a>6.2.7. Suivi des paquets installés automatiquement</h3></div></div></div><div
            class="para">
				Une des fonctionnalités essentielles d'<code
              class="command">apt</code> est le suivi des paquets qui ne sont installés que pour satisfaire des dépendances. Ces paquets sont dits « automatiques » et ils incluent souvent des bibliothèques.
			</div><div
            class="para">
				Avec cette information, lorsque des paquets sont supprimés, les gestionnaires de paquets peuvent calculer une liste des paquets automatiques qui ne sont plus requis (parce qu'il ne reste plus de paquets installés « manuellement » qui en dépendent). <code
              class="command">apt-get autoremove</code> est la commande pour supprimer ces paquets. <code
              class="command">aptitude</code> et <code
              class="command">apt</code> ne disposent pas d'une commande équivalente, parce qu'ils suppriment ces paquets automatiquement dès qu'ils sont identifiés comme superflus. Dans tous les cas, les programmes mentionnent clairement les paquets affectés lors de leurs opérations.
			</div><a
            id="id-1.9.11.13.4"
            class="indexterm"></a><a
            id="id-1.9.11.13.5"
            class="indexterm"></a><a
            id="id-1.9.11.13.6"
            class="indexterm"></a><a
            id="id-1.9.11.13.7"
            class="indexterm"></a><div
            class="para">
				Il est sain d'adopter l'habitude de marquer comme automatiques les paquets dont on n'a pas besoin directement, de sorte qu'ils soient automatiquement supprimés lorsqu'ils ne sont plus nécessaires. <code
              class="command">apt-mark auto <em
                class="replaceable">paquet</em></code> marque le paquet concerné comme automatique et <code
              class="command">apt-mark manual <em
                class="replaceable">package</em></code> fait le contraire. <code
              class="command">aptitude markauto</code> et <code
              class="command">aptitude unmarkauto</code> fonctionnent de la même manière, mais offrent plus de fonctionnalités permettant de marquer plusieurs paquets d'un coup (voir <a
              class="xref"
              href="sect.apt-frontends.html#sect.aptitude">Section 6.4.1, « <code
                class="command">aptitude</code> »</a>). L'interface interactive en mode semi-graphique d'<code
              class="command">aptitude</code> facilite également la maintenance de ce marqueur « automatique » sur de nombreux paquets.
			</div><a
            id="id-1.9.11.13.9"
            class="indexterm"></a><div
            class="para">
				Il arrive que l'on veuille savoir pourquoi un paquet automatiquement installé est présent sur le système. Pour obtenir cette information directement depuis la ligne de commande, on peut employer <code
              class="command">aptitude why <em
                class="replaceable">paquet</em></code> (<code
              class="command">apt</code> et <code
              class="command">apt-get</code> ne disposent pas de cette fonctionnalité) :
			</div><pre
            class="screen"><code
              class="computeroutput">$ </code><strong
              class="userinput"><code> aptitude why python-debian
</code></strong><code
              class="computeroutput">i   aptitude         Recommande apt-xapian-index         
i A apt-xapian-index Dépend     python-debian (&gt;= 0.1.15)
</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIVE</em></span> <code
                        class="command">deborphan</code> et <code
                        class="command">debfoster</code></strong></p></div></div></div><a
              id="id-1.9.11.13.12.2"
              class="indexterm"></a><a
              id="id-1.9.11.13.12.3"
              class="indexterm"></a><div
              class="para">
				Avant l'apparition du suivi des paquets automatiques par <code
                class="command">apt</code>, <code
                class="command">apt-get</code> et <code
                class="command">aptitude</code>, il existait deux utilitaires qui permettaient de déterminer une liste de paquets non nécessaires, <code
                class="command">deborphan</code> et <code
                class="command">debfoster</code>.
			</div><div
              class="para">
				<code
                class="command">deborphan</code>, le plus rudimentaire des deux, recherche simplement dans les sections <code
                class="literal">libs</code> et <code
                class="literal">oldlibs</code> (à défaut d'instructions supplémentaires) les paquets actuellement installés dont aucun autre paquet installé ne dépend. Cette liste peut ensuite servir de point de départ pour supprimer les paquets inutiles.
			</div><div
              class="para">
				<code
                class="command">debfoster</code> a une approche plus évoluée, qui se rapproche un peu de celle d'APT : il maintient une liste de paquets installés explicitement et se rappelle d'une invocation sur l'autre quels paquets sont réellement requis. Si de nouveaux paquets sont apparus sur le système, et si <code
                class="command">debfoster</code> ne les connaît pas comme des paquets requis, ils seront présentés à l'écran, ainsi qu'une liste de leurs dépendances. Le programme propose alors un choix, permettant de supprimer le paquet (ainsi que ceux dont il dépend, le cas échéant), de le marquer comme explicitement requis, ou de l'ignorer temporairement.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>Précédent</strong>Chapitre 6. Maintenance et mise à jour : les outi...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Niveau supérieur</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Sommaire</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>Suivant</strong>6.3. Commande apt-cache</a></li></ul></body></html>
