<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.4. NFS-Dateiserver</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-de-DE-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Das Debian Administrationshandbuch" /><link
        rel="up"
        href="network-services.html"
        title="Kapitel 11. Network Services: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="sect.ftp-file-server.html"
        title="11.3. FTP-Dateiserver" /><link
        rel="next"
        href="sect.windows-file-server-with-samba.html"
        title="11.5. Einrichten von Windows-Freigaben mit Samba" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/de-DE/stable/sect.nfs-file-server.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>Zurück</strong></a></li><li
          class="home">Das Debian Administrationshandbuch</li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>Weiter</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.nfs-file-server"></a>11.4. NFS-Dateiserver</h2></div></div></div><div
          class="para">
			NFS (<span
            class="emphasis"><em>Network File System</em></span>) ist ein Protokoll, das den Fernzugriff auf ein Dateisystem über ein Netzwerk ermöglicht. Alle Unix-Systeme sind in der Lage, mit diesem Protokoll umzugehen; wenn Windows-Systeme beteiligt sind, muss stattdessen Samba eingesetzt werden.
		</div><a
          id="id-1.14.7.3"
          class="indexterm"></a><a
          id="id-1.14.7.4"
          class="indexterm"></a><a
          id="id-1.14.7.5"
          class="indexterm"></a><a
          id="id-1.14.7.6"
          class="indexterm"></a><a
          id="id-1.14.7.7"
          class="indexterm"></a><div
          class="para">
			NFS is a very useful tool but, historically, it has suffered from many limitations, most of which have been addressed with version 4 of the protocol. The downside is that the latest version of NFS is harder to configure when you want to make use of basic security features such as authentication and encryption since it relies on Kerberos for those parts. And without those, the NFS protocol must be restricted to a trusted local network since data goes over the network unencrypted (a <span
            class="emphasis"><em>sniffer</em></span> can intercept it) and access rights are granted based on the client's IP address (which can be spoofed).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>DOKUMENTATION</em></span> NFS-HOWTO</strong></p></div></div></div><div
            class="para">
			Good documentation to deploy NFSv4 is rather scarce. Here are some pointers with content of varying quality but that should at least give some hints on what should be done. <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="https://help.ubuntu.com/community/NFSv4Howto">https://help.ubuntu.com/community/NFSv4Howto</a></div> <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration">http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration</a></div>
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.10"></a>11.4.1. NFS absichern</h3></div></div></div><a
            id="id-1.14.7.10.2"
            class="indexterm"></a><div
            class="para">
				If you don't use the Kerberos-based security features, it is vital to ensure that only the machines allowed to use NFS can connect to the various required RPC servers, because the basic protocol trusts the data received from the network. The firewall must also block <span
              class="emphasis"><em>IP spoofing</em></span> so as to prevent an outside machine from acting as an inside one, and access to the appropriate ports must be restricted to the machines meant to access the NFS shares.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ZURÜCK ZU DEN GRUNDLAGEN</em></span> RPC</strong></p></div></div></div><div
              class="para">
				RPC (<span
                class="emphasis"><em>Remote Procedure Call</em></span>) ist ein Unix-Standard für entfernte Dienste. NFS ist ein solcher Dienst.
			</div><a
              id="id-1.14.7.10.4.3"
              class="indexterm"></a><a
              id="id-1.14.7.10.4.4"
              class="indexterm"></a><div
              class="para">
				RPC-Dienste tragen sich in einem als <span
                class="emphasis"><em>portmapper</em></span> bekannten Verzeichnis ein. Ein Client, der eine NFS-Anfrage durchführen möchte, wendet sich zunächst an den <span
                class="emphasis"><em>portmapper</em></span> (auf Port 111, entweder TCP oder UDP) und fragt nach dem NFS-Server; die Antwort nennt normalerweise Port 2049 (den Standardport für NFS). Nicht alle RPC-Dienste verwenden notwendigerweise einen festen Port.
			</div></div><div
            class="para">
				Older versions of the protocol required other RPC services which used dynamically assigned ports. Fortunately, with NFS version 4, only port 2049 (for NFS) and 111 (for the portmapper) are needed and they are thus easy to firewall.
			</div><a
            id="id-1.14.7.10.6"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.11"></a>11.4.2. NFS-Server</h3></div></div></div><div
            class="para">
				Der NFS-Server ist Teil des Linux-Kernels; in den von Debian bereitgestellten Kerneln ist er als Kernel-Modul eingebaut. Falls der NFS-Server beim Hochfahren automatisch anlaufen soll, sollte das Paket <span
              class="pkg pkg">nfs-kernel-server</span> installiert werden; es enthält die entsprechenden Start-Skripten.
			</div><div
            class="para">
				Die Konfigurationsdatei des NFS-Servers, <code
              class="filename">/etc/exports</code>, listet die Verzeichnisse auf, die über das Netzwerk zur Verfügung gestellt werden (<span
              class="emphasis"><em>exported</em></span>). Zu jeder NFS-Freigabe wird nur den Rechnern Zugang gewährt, die auf dieser Liste stehen. Eine feiner eingestellte Zugangskontrolle kann durch einige Optionen erzielt werden. Die Syntax dieser Datei ist recht einfach:
			</div><a
            id="id-1.14.7.11.4"
            class="indexterm"></a><a
            id="id-1.14.7.11.5"
            class="indexterm"></a><pre
            class="programlisting">
/freizugebendes/verzeichnis rechner1(option1,option2,...) rechner2(...) ...</pre><div
            class="para">
				Note that with NFSv4, all exported directories must be part of a single hierarchy and that the root directory of that hierarchy must be exported and identified with the option <code
              class="literal">fsid=0</code> or <code
              class="literal">fsid=root</code>.
			</div><div
            class="para">
				Jeder Rechner kann entweder durch seinen DNS-Namen oder seine IP-Adresse bestimmt werden. Ganze Rechnergruppen können auch festgelegt werden, indem entweder eine Syntax wie <code
              class="literal">*.falcot.com</code> oder ein IP-Adressbereich wie <code
              class="literal">192.168.0.0/255.255.255.0</code> oder <code
              class="literal">192.168.0.0/24</code> verwendet wird.
			</div><div
            class="para">
				Verzeichnisse werden in der Standardeinstellung (oder durch die Option <code
              class="literal">ro</code>) schreibgeschützt bereitgestellt. Die Option <code
              class="literal">rw</code> ermöglicht Schreibzugriff. NFS-Clients nehmen typischerweise über einen Port Verbindung auf, der Administratorrechte erfordert (mit anderen Worten, unterhalb von 1024); diese Einschränkung kann mit der Option <code
              class="literal">insecure</code> aufgehoben werden (die Option <code
              class="literal">secure</code> ist stillschweigend eingestellt, kann aber auch ausdrücklich angegeben werden, wenn dies der Deutlichkeit halber erforderlich ist).
			</div><a
            id="id-1.14.7.11.10"
            class="indexterm"></a><div
            class="para">
				By default, the server only answers an NFS query when the current disk operation is complete (<code
              class="literal">sync</code> option); this can be disabled with the <code
              class="literal">async</code> option. Asynchronous writes increase performance a bit, but they decrease reliability since there is a data loss risk in case of the server crashing between the acknowledgment of the write and the actual write on disk. Since the default value changed recently (as compared to the historical value of NFS), an explicit setting is recommended.
			</div><div
            class="para">
				Um einem NFS-Client keinen Root-Zugriff auf das Dateisystem zu geben, werden alle Anfragen, die von einem Root-Benutzer zu kommen scheinen, vom Server so angesehen, als kämen sie vom Benutzer <code
              class="literal">nobody</code>. Dieses Verhalten entspricht der Option <code
              class="literal">root_squash</code> und ist standardmäßig aktiviert. Die Option <code
              class="literal">no_root_squash</code>, die dieses Verhalten abstellt, ist gefährlich und sollte nur in überwachten Umgebungen eingesetzt werden. Die Optionen <code
              class="literal">anonuid=<em
                class="replaceable">uid</em></code> und <code
              class="literal">anongid=<em
                class="replaceable">gid</em></code> ermöglichen es, anstelle von UID/GID 65534 (was dem User <code
              class="literal">nobody</code> und der Gruppe <code
              class="literal">nogroup</code> entspricht) einen anderen fingierten Benutzer anzugeben.
			</div><div
            class="para">
				With NFSv4, you can add a <code
              class="literal">sec</code> option to indicate the security level that you want: <code
              class="literal">sec=sys</code> is the default with no special security features, <code
              class="literal">sec=krb5</code> enables authentication only, <code
              class="literal">sec=krb5i</code> adds integrity protection, and <code
              class="literal">sec=krb5p</code> is the most complete level which includes privacy protection (with data encryption). For this to work you need a working Kerberos setup (that service is not covered by this book).
			</div><div
            class="para">
				Weitere Optionen stehen zur Verfügung; sie sind auf der Handbuchseite <span
              class="citerefentry"><span
                class="refentrytitle">exports</span>(5)</span> dokumentiert.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>VORSICHT</em></span> Erste Installation</strong></p></div></div></div><div
              class="para">
				Das Start-Skript <code
                class="filename">/etc/init.d/nfs-kernel-server</code> startet den Server nur dann, wenn <code
                class="filename">/etc/exports</code> eine oder mehrere gültig NFS-Freigaben auflistet. Daher muss der NFS-Server, sobald diese Datei bei der Erstkonfigurierung dahingehend geändert wurde, dass sie gültige Einträge enthält, mit folgendem Befehl gestartet werden:
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>service nfs-kernel-server start</code></strong></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.12"></a>11.4.3. NFS-Client</h3></div></div></div><a
            id="id-1.14.7.12.2"
            class="indexterm"></a><a
            id="id-1.14.7.12.3"
            class="indexterm"></a><div
            class="para">
				Wie bei anderen Dateisystemen, so erfordert auch das Einbinden einer NFS-Freigabe in die Systemhierarchie, dass sie eingehängt wird. Da dieses Dateisystem seine Besonderheiten hat, waren einige Anpassungen in den Syntaxen des Befehls <code
              class="command">mount</code> und der Datei <code
              class="filename">/etc/fstab</code> erforderlich.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.5"></a><p
              class="title"><strong>Beispiel 11.22. Manuelles Einhängen mit dem Befehl <code
                  class="command">mount</code></strong></p><div
              class="example-contents"><pre
                class="screen">
          <code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>mount -t nfs4 -o rw,nosuid arrakis.internal.falcot.com:/shared /srv/shared</code></strong></pre></div></div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.6"></a><p
              class="title"><strong>Beispiel 11.23. NFS-Eintrag in der Datei <code
                  class="filename">/etc/fstab</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">
arrakis.internal.falcot.com:/shared /srv/shared nfs4 rw,nosuid 0 0
</pre></div></div><div
            class="para">
				The entry described above mounts, at system startup, the <code
              class="filename">/shared/</code> NFS directory from the <code
              class="literal">arrakis</code> server into the local <code
              class="filename">/srv/shared/</code> directory. Read-write access is requested (hence the <code
              class="literal">rw</code> parameter). The <code
              class="literal">nosuid</code> option is a protection measure that wipes any <code
              class="literal">setuid</code> or <code
              class="literal">setgid</code> bit from programs stored on the share. If the NFS share is only meant to store documents, another recommended option is <code
              class="literal">noexec</code>, which prevents executing programs stored on the share. Note that on the server, the <code
              class="filename">shared</code> directory is below the NFSv4 root export (for example <code
              class="filename">/export/shared</code>), it is not a top-level directory.
			</div><div
            class="para">
				Die Handbuchseite <span
              class="citerefentry"><span
                class="refentrytitle">nfs</span>(5)</span> beschreibt alle Optionen näher.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>Zurück</strong>11.3. FTP-Dateiserver</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Nach oben</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Zum Anfang</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>Weiter</strong>11.5. Einrichten von Windows-Freigaben mit Samba</a></li></ul></body></html>
