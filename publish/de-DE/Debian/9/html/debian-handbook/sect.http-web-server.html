<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.2. Webserver (HTTP)</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-de-DE-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Das Debian Administrationshandbuch" /><link
        rel="up"
        href="network-services.html"
        title="Kapitel 11. Netzwerkdienste: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="network-services.html"
        title="Kapitel 11. Netzwerkdienste: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="next"
        href="sect.ftp-file-server.html"
        title="11.3. FTP-Dateiserver" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/de-DE/stable/sect.http-web-server.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="network-services.html"><strong>Zurück</strong></a></li><li
          class="home">Das Debian Administrationshandbuch</li><li
          class="next"><a
            accesskey="n"
            href="sect.ftp-file-server.html"><strong>Weiter</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.http-web-server"></a>11.2. Webserver (HTTP)</h2></div></div></div><div
          class="para">
			Die Falcot Corp. Administratoren haben sich entschlossen, den Apache HTTP-Server zu verwenden, der in der Version 2.4.10 in Debian <span
            class="distribution distribution">Jessie</span> enthalten ist.
		</div><a
          id="id-1.14.5.3"
          class="indexterm"></a><a
          id="id-1.14.5.4"
          class="indexterm"></a><a
          id="id-1.14.5.5"
          class="indexterm"></a><a
          id="id-1.14.5.6"
          class="indexterm"></a><a
          id="id-1.14.5.7"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>ALTERNATIVE</em></span> Andere Webserver</strong></p></div></div></div><div
            class="para">
			Apache ist lediglich der am besten bekannte (und meistbenutzte) Webserver, es gibt jedoch auch andere; sie können bei bestimmten Beanspruchungen bessere Leistungen bieten, dies hat jedoch eine Kehrseite in der geringeren Anzahl verfügbarer Leistungsmerkmale und Module. Wenn aber der zu verwendende Webserver zur Bereitstellung statischer Dateien eingesetzt werden oder als Proxy fungieren soll, sind Alternativen wie <span
              class="pkg pkg">nginx</span> und <span
              class="pkg pkg">lighttpd</span> eine nähere Betrachtung wert.
		</div><a
            id="id-1.14.5.8.3"
            class="indexterm"></a><a
            id="id-1.14.5.8.4"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.9"></a>11.2.1. Apache installieren</h3></div></div></div><div
            class="para">
				Die Installation des Pakets <span
              class="pkg pkg">apache2</span> genügt. Es enthält alle Module, einschließlich der <span
              class="emphasis"><em>Multi-Processing-Module</em></span> (MPMs), die beeinflussen, wie der Apache mit der parallelen Verarbeitung vieler Anfragen umgeht (die früher in separaten <span
              class="pkg pkg">apache2-mpm-*</span>-Paketen bereitgestellt wurden). Auch wird es <span
              class="pkg pkg">apache2-utils</span> mit den Kommandozeilenprogrammen, die wir später behandeln werden, nachladen.
			</div><div
            class="para">
				The MPM in use affects significantly the way Apache will handle concurrent requests. With the <span
              class="emphasis"><em>worker</em></span> MPM, it uses <span
              class="emphasis"><em>threads</em></span> (lightweight processes), whereas with the <span
              class="emphasis"><em>prefork</em></span> MPM it uses a pool of processes created in advance. With the <span
              class="emphasis"><em>event</em></span> MPM it also uses threads, but the inactive connections (notably those kept open by the HTTP <span
              class="emphasis"><em>keep-alive</em></span> feature) are handed back to a dedicated management thread.
			</div><div
            class="para">
				The Falcot administrators also install <span
              class="pkg pkg">libapache2-mod-php5</span> so as to include the PHP support in Apache. This causes the default <span
              class="emphasis"><em>event</em></span> MPM to be disabled, and <span
              class="emphasis"><em>prefork</em></span> to be used instead, since PHP only works under that particular MPM.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SICHERHEIT</em></span> Ausführung unter dem Benutzer <code
                        class="literal">www-data</code></strong></p></div></div></div><a
              id="id-1.14.5.9.5.2"
              class="indexterm"></a><a
              id="id-1.14.5.9.5.3"
              class="indexterm"></a><div
              class="para">
				Standardmäßig verarbeitet Apache ankommende Anfragen unter der Identität des Benutzers <code
                class="literal">www-data</code>. Dies bedeutet, dass eine Sicherheitslücke in einem CGI-Skript, das von Apache (für eine dynamische Seite) ausgeführt wird, nicht das ganze System gefährden würde, sondern nur die Dateien im Besitz dieses speziellen Benutzers.
			</div><div
              class="para">
				Der Einsatz der <span
                class="emphasis"><em>suexec</em></span>-Module macht es möglich, diese Regel zu umgehen, so dass einige CGI-Skripte unter der Identität eines anderen Benutzers ausgeführt werden. Dies wird mit einer Anweisung der Art <code
                class="literal">SuexecUserGroup <em
                  class="replaceable">benutzer</em><em
                  class="replaceable">gruppe</em></code> in der Apache-Konfiguration eingestellt.
			</div><a
              id="id-1.14.5.9.5.6"
              class="indexterm"></a><div
              class="para">
				Eine weitere Möglichkeit besteht darin, ein speziell hierfür vorgesehenes MPM zu benutzen, wie das von <span
                class="pkg pkg">libapache2-mpm-itk</span> bereitgestellte. Dieses Modul weist ein etwas abweichendes Verhalten auf: es ermöglicht das „Isolieren“ virtueller Hosts (eigentlich eine Anzahl Seiten), so dass jeder von ihnen als ein anderer Benutzer läuft. Eine Schwachstelle in einer Website kann somit keine Dateien gefährden, die dem Benutzer einer anderen Website gehören.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>KURZER BLICK</em></span> Liste der Module</strong></p></div></div></div><div
              class="para">
				Eine vollständige Liste der Apache-Standardmodule ist online zu finden. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://httpd.apache.org/docs/2.4/mod/index.html">http://httpd.apache.org/docs/2.4/mod/index.html</a></div>
			</div></div><div
            class="para">
				Apache ist ein modularer Server, und viele Leistungsmerkmale werden durch externe Module umgesetzt, die das Hauptprogramm während der Initialisierung lädt. Die Standardkonfiguration aktiviert nur die gebräuchlichsten Module, aber das Aktivieren neuer Module geschieht einfach mit dem Befehl <code
              class="command">a2enmod <em
                class="replaceable">modul</em></code>; der Befehl zum Abschalten eines Moduls lautet <code
              class="command">a2dismod <em
                class="replaceable">modul</em></code>. Diese Programme erstellen (oder löschen) in Wirklichkeit nur symbolische Verknüpfungen in der Datei <code
              class="filename">/etc/apache2/mods-enabled/</code>, die auf die tatsächlichen Dateien zeigen (die in <code
              class="filename">/etc/apache2/mods-available/</code> gespeichert sind).
			</div><div
            class="para">
				In seiner Standardkonfiguration nimmt der Webserver an Port 80 Verbindungen an (wie in <code
              class="filename">/etc/apache2/ports.conf</code> konfiguriert), und liefert Seiten aus dem Verzeichnis <code
              class="filename">/var/www/html/</code> (wie in <code
              class="filename">/etc/apache2/sites-enabled/000-default.conf</code> konfiguriert).
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>WEITERE SCHRITTE</em></span> SSL-Unterstützung hinzufügen</strong></p></div></div></div><a
              id="id-1.14.5.9.9.2"
              class="indexterm"></a><a
              id="id-1.14.5.9.9.3"
              class="indexterm"></a><div
              class="para">
				Apache 2.4 bringt von vornherein das für sicheres HTTP (HTTPS) erforderliche Modul mit. Man muss es nur durch den Befehl <code
                class="command">a2enmod ssl</code> aktivieren und danach die erforderlichen Anweisungen zur Konfigurationsdatei hinzufügen. Ein Konfigurationsbeispiel wird in <code
                class="filename">/etc/apache2/sites-available/default-ssl.conf</code> bereitgestellt. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://httpd.apache.org/docs/2.4/mod/mod_ssl.html">http://httpd.apache.org/docs/2.4/mod/mod_ssl.html</a></div>
			</div><div
              class="para">
				Besondere Vorsicht ist angebracht, wenn Sie SSL-Verbindungen mit <span
                class="emphasis"><em>Perfect Forward Secrecy</em></span> favorisieren (diese Verbindungen verwenden kurzlebige Sitzungsschlüssel die sicherstellen, dass durch das Knacken des geheimen Schlüssels des Servers nicht auch die Schlüssel vorangegangener verschlüsselter Verbindungen kompromittiert werden, die möglicherweise bei früheren Einbrüchen ins Netzwerk mitgeschnitten wurden). Zu Einzelheiten schauen Sie die Empfehlungen von Mozilla an: <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="https://wiki.mozilla.org/Security/Server_Side_TLS#Apache">https://wiki.mozilla.org/Security/Server_Side_TLS#Apache</a></div>
			</div><a
              id="id-1.14.5.9.9.6"
              class="indexterm"></a></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.10"></a>11.2.2. Virtuelle Hosts konfigurieren</h3></div></div></div><div
            class="para">
				Ein virtueller Host ist eine zusätzliche Identität des Web-Servers.
			</div><a
            id="id-1.14.5.10.3"
            class="indexterm"></a><div
            class="para">
				Apache berücksichtigt zwei verschiedene Arten virtueller Hosts: diejenigen, die auf der IP-Adresse (oder dem Port) basieren, und diejenigen, die sich auf den Domainnamen des Web-Servers stützen. Bei der ersten Methode muss jeder Seite eine andere IP-Adresse (oder ein anderer Port) zugeordnet werden, während die zweite mit einer einzigen IP-Adresse (und einem einzigen Port) auskommt und die Seiten durch den Hostnamen, der vom HTTP-Client gesendet wird, unterschieden werden (was nur in Version 1.1 des HTTP-Protokolls funktioniert - glücklicherweise ist diese Version schon so alt, dass alle Clients sie verwenden).
			</div><div
            class="para">
				Die (zunehmende) Knappheit von IPv4-Adressen begünstigt gewöhnlich die zweite Methode; jedoch ist sie komplizierter, wenn der virtuelle Host auch HTTPS bereitstellen muss, da das SSL-Protokoll nicht von jeher virtuelles Hosting auf Namensbasis ermöglicht hat. Nicht alle Browser können mit der SNI-Erweiterung (<span
              class="emphasis"><em>Server Name Indication</em></span>), die diese Kombination ermöglicht, umgehen. Wenn mehrere HTTPS-Seiten auf demselben Server laufen müssen, werden sie gewöhnlich dadurch unterschieden, dass sie auf verschiedenen Ports laufen oder unter verschiedenen IP-Adressen (IPv6 ist hier hilfreich).
			</div><div
            class="para">
				Die Standardkonfiguration für Apache 2 aktiviert virtuelle Hosts auf Namensbasis. Zusätzlich wird ein voreingestellter virtueller Host in der Datei <code
              class="literal">/etc/apache2/sites-enabled/000-default.conf</code> ausgewiesen; dieser virtuelle Host wird verwendet, wenn es keinen anderen Host gibt, der zur Anfrage des Clients passt.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>VORSICHT</em></span> Erster virtueller Host</strong></p></div></div></div><div
              class="para">
				Anfragen an unbekannte virtuelle Hosts werden stets vom ersten ausgewiesenen virtuellen Host bedient, weshalb wir hier als erstes <code
                class="literal">www.falcot.com</code> bestimmt haben.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>KURZER BLICK</em></span> Apache unterstützt SNI</strong></p></div></div></div><a
              id="id-1.14.5.10.8.2"
              class="indexterm"></a><div
              class="para">
				Der Apache-Server unterstützt eine SSL-Protokollerweiterung namens <span
                class="emphasis"><em>Server Name Indication</em></span> (SNI). Diese Erweiterung ermöglicht es dem Browser, den Hostnamen während des Aufbaus der SSL-Verbindung zu senden, viel früher als die HTTP-Anfrage selbst, die vorher dazu benutzt wurde, den gewünschten virtuellen Host unter denen zu identifizieren, die auf demselben Server (mit derselben IP-Adresse und demselben Port) untergebracht sind.
			</div><div
              class="para">
				Vor SNI hätte Apache stets das Zertifikat des voreingestellten virtuellen Hosts verwendet. Clients, die auf einen anderen virtuellen Host zugreifen wollten, würden dann Warnmeldungen anzeigen, da das erhaltene Zertifikat nicht zu der Website passte, auf die sie zugreifen wollten. Glücklicherweise arbeiten die meisten Browser inzwischen mit SNI; hierzu gehören Microsoft Internet Explorer ab Version 7.0 (ab Vista), Mozilla Firefox ab Version 2.0, Apple Safari ab Version 3.2.1 und alle Versionen von Google Chrome.
			</div><div
              class="para">
				Das in Debian bereitgestellte Apache-Paket wird mit Unterstützung für SNI erstellt; daher ist keine besondere Konfiguration erforderlich.
			</div><div
              class="para">
				Man sollte auch darauf achten, dass die Konfiguration des ersten virtuellen Hosts (des standardmäßig verwendeten) TLSv1 aktiviert, da Apache die Parameter dieses ersten virtuellen Hosts verwendet, um sichere Verbindungen aufzubauen, und dies muss ihm auf jeden Fall erlaubt sein!
			</div></div><div
            class="para">
				Jeder zusätzliche virtuelle Host wird dann in einer unter <code
              class="filename">/etc/apache2/sites-available/</code> gespeicherten Datei festgelegt. Die Einrichtung einer Website für die Domain <code
              class="literal">falcot.org</code> erfordert daher nur die Erstellung der folgenden Datei und anschließend die Aktivierung des virtuellen Hosts mit dem Befehl <code
              class="command">a2ensite www.falcot.org</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.10.10"></a><p
              class="title"><strong>Beispiel 11.16. Die Datei <code
                  class="filename">/etc/apache2/sites-available/www.falcot.org.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">
&lt;VirtualHost *:80&gt;
ServerName www.falcot.org
ServerAlias falcot.org
DocumentRoot /srv/www/www.falcot.org
&lt;/VirtualHost&gt;</pre></div></div><div
            class="para">
				The Apache server, as configured so far, uses the same log files for all virtual hosts (although this could be changed by adding <code
              class="literal">CustomLog</code> directives in the definitions of the virtual hosts). It therefore makes good sense to customize the format of this log file to have it include the name of the virtual host. This can be done by creating a <code
              class="filename">/etc/apache2/conf-available/customlog.conf</code> file that defines a new format for all log files (with the <code
              class="literal">LogFormat</code> directive) and by enabling it with <code
              class="command">a2enconf customlog</code>. The <code
              class="literal">CustomLog</code> line must also be removed (or commented out) from the <code
              class="filename">/etc/apache2/sites-available/000-default.conf</code> file.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.10.12"></a><p
              class="title"><strong>Beispiel 11.17. Die Datei <code
                  class="filename">/etc/apache2/conf.d/customlog.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting scale">
# Neues Log-Format einschließlich des (virtuellen) Hostnamens
LogFormat "%v %h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\"" vhost

# Jetzt soll dieses „vhost“-Format standardmäßig benutzt werden
CustomLog /var/log/apache2/access.log vhost</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.11"></a>11.2.3. Gebräuchliche Anweisungen</h3></div></div></div><div
            class="para">
				Dieser Abschnitt rekapituliert in Kürze einige der häufig genutzten Konfigurations-Direktiven von Apache.
			</div><a
            id="id-1.14.5.11.3"
            class="indexterm"></a><a
            id="id-1.14.5.11.4"
            class="indexterm"></a><div
            class="para">
				Die Hauptkonfigurationsdatei enthält gewöhnlich mehrere <code
              class="literal">Directory</code>-Blöcke; sie ermöglichen es, unterschiedliches Verhalten des Servers in Abhängigkeit von der zu liefernden Datei festzulegen. Solch ein Block enthält häufig Anweisungen des Typs <code
              class="literal">Options</code> und <code
              class="literal">AllowOverride</code>.
			</div><a
            id="id-1.14.5.11.6"
            class="indexterm"></a><a
            id="id-1.14.5.11.7"
            class="indexterm"></a><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.11.8"></a><p
              class="title"><strong>Beispiel 11.18. Verzeichnisblock</strong></p><div
              class="example-contents"><pre
                class="programlisting">
&lt;Directory /var/www&gt;
Options Includes FollowSymlinks
AllowOverride All
DirectoryIndex index.php index.html index.htm
&lt;/Directory&gt;</pre></div></div><div
            class="para">
				Die Anweisung <code
              class="literal">DirectoryIndex</code> enthält eine Liste von Dateien, die ausgewählt werden sollen, wenn die Client-Anfrage auf ein Verzeichnis zutrifft. Die in der Liste als erste aufgeführte Datei wird herangezogen und als Antwort gesendet.
			</div><a
            id="id-1.14.5.11.10"
            class="indexterm"></a><div
            class="para">
				Auf die Anweisung <code
              class="literal">Options</code> folgt eine Liste von zu aktivierenden Optionen. Der Wert <code
              class="literal">None</code> deaktiviert alle Optionen; dementsprechend aktiviert <code
              class="literal">All</code> alle außer <code
              class="literal">MultiViews</code>. Unter anderem stehen folgende Optionen zur Verfügung:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ExecCGI</code> bedeutet, dass CGI-Skripte ausgeführt werden können. <a
                    id="id-1.14.5.11.12.1.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">FollowSymlinks</code> teilt dem Server mit, dass er symbolischen Verweisen folgen kann, und dass die Antwort den Inhalt des Ziels solcher Verweise enthalten soll. <a
                    id="id-1.14.5.11.12.2.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SymlinksIfOwnerMatch</code> weist den Server ebenfalls an, symbolischen Verweisen zu folgen, aber nur, wenn der Verweis und sein Ziel demselben Benutzer gehören. <a
                    id="id-1.14.5.11.12.3.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">Includes</code> aktiviert <span
                    class="emphasis"><em>Server Side Includes</em></span> (abgekürzt <span
                    class="emphasis"><em>SSI</em></span>). Dies sind in HTML-Seiten eingebettete Anweisungen, die bei jeder Anforderung im laufenden Betrieb ausgeführt werden. <a
                    id="id-1.14.5.11.12.4.1.4"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">Indexes</code> weist den Server an, den Inhalt eines Verzeichnisses aufzulisten, falls die von einem Client gesendete HTTP-Anforderung auf ein Verzeichnis ohne Indexdatei weist (das heißt, wenn es in diesem Verzeichnis keine der von der Anweisung <code
                    class="literal">DirectoryIndex</code> genannten Dateien gibt). <a
                    id="id-1.14.5.11.12.5.1.3"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">MultiViews</code> aktiviert die Inhaltsabstimmung; diese kann vom Server dazu verwendet werden, eine Webseite in der im Browser eingestellten bevorzugten Sprache anzuzeigen. <a
                    id="id-1.14.5.11.12.6.1.2"
                    class="indexterm"></a>
					</div></li></ul></div><div
            class="para">
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ZURÜCK ZU DEN GRUNDLAGEN</em></span> Die Datei <code
                        class="filename">.htaccess</code></strong></p></div></div></div><div
              class="para">
				Die Datei <code
                class="filename">.htaccess</code> enthält Apache-Konfigurationsanweisungen, die jedes Mal ausgeführt werden, wenn eine Anforderung ein Element des Verzeichnisses betrifft, in dem diese Datei gespeichert ist. Der Geltungsbereich dieser Anweisungen erstreckt sich auch auf alle darunter befindlichen Unterverzeichnisse.
			</div><a
              id="id-1.14.5.11.14.3"
              class="indexterm"></a><div
              class="para">
				Die meisten Anweisungen, die in einem <code
                class="literal">Directory</code>-Block auftreten können, gelten auch in einer <code
                class="filename">.htaccess</code>-Datei.
			</div></div><div
            class="para">
				Die Anweisung <code
              class="literal">AllowOverride</code> führt alle Optionen auf, die mithilfe einer <code
              class="filename">.htaccess</code>-Datei aktiviert oder deaktiviert werden können. Eine verbreitete Anwendung dieser Option besteht darin, <code
              class="literal">ExecCGI</code> einzuschränken, so dass der Administrator entscheidet, welchen Benutzern es erlaubt ist, Programme unter der Identität des Web-Servers (des Benutzers <code
              class="literal">www-data</code>) auszuführen.
			</div><a
            id="id-1.14.5.11.16"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.5.11.17"></a>11.2.3.1. Authentifizierung verlangen</h4></div></div></div><a
              id="id-1.14.5.11.17.2"
              class="indexterm"></a><div
              class="para">
					Unter manchen Umständen muss der Zugang zu Teilen einer Website beschränkt werden, so dass nur berechtigte Benutzer, die einen Benutzernamen und ein Passwort angeben, Zugang zum Inhalt erhalten.
				</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.5.11.17.4"></a><p
                class="title"><strong>Beispiel 11.19. Authentifizierung für die Datei <code
                    class="filename">.htaccess</code> verlangen</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
Require valid-user
AuthName "Private directory"
AuthType Basic
AuthUserFile /etc/apache2/authfiles/htpasswd-private</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>SICHERHEIT</em></span> Keine Sicherheit</strong></p></div></div></div><div
                class="para">
					Das in oben stehendem Beispiel verwendete Authentifizierungssystem (<code
                  class="literal">Basic</code>) bietet nur geringfügige Sicherheit, da das Passwort als Klartext gesendet wird (es ist nur als <span
                  class="emphasis"><em>base64</em></span> kodiert, die eine einfache Kodierungs- aber keine Verschlüsselungsmethode ist). Es sollte auch beachtet werden, dass die mit diesem Verfahren „geschützten“ Dokumente ebenfalls als Klartext über das Netzwerk laufen. Falls Sicherheit wichtig ist, sollte die gesamte HTTP-Verbindung mit SSL verschlüsselt sein.
				</div></div><div
              class="para">
					Die Datei <code
                class="filename">/etc/apache2/authfiles/htpasswd-private</code> enthält eine Liste von Benutzern und Passwörtern; sie wird normalerweise mit dem Befehl <code
                class="command">htpasswd</code> gehandhabt. Der folgende Befehl wird zum Beispiel dazu benutzt, einen Benutzer hinzuzufügen oder sein Passwort zu ändern: <a
                id="id-1.14.5.11.17.6.3"
                class="indexterm"></a>
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>htpasswd /etc/apache2/authfiles/htpasswd-private <em
                    class="replaceable">user</em>
</code></strong><code
                class="computeroutput">New password:
Re-type new password:
Adding password for user <em
                  class="replaceable">user</em>
</code></pre></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.5.11.18"></a>11.2.3.2. Zugang beschränken</h4></div></div></div><a
              id="id-1.14.5.11.18.2"
              class="indexterm"></a><div
              class="para">
					Die Direktive <code
                class="literal">Require</code> steuert Zugriffsbeschränkungen für Verzeichnisse (und rekursiv, deren Unterverzeichnisse).
				</div><a
              id="id-1.14.5.11.18.4"
              class="indexterm"></a><a
              id="id-1.14.5.11.18.5"
              class="indexterm"></a><a
              id="id-1.14.5.11.18.6"
              class="indexterm"></a><div
              class="para">
					Es kann eingesetzt werden, um den Zugriff auf der Grundlage vieler Kriterien zu beschränken. Wir werden uns darauf beschränken, die Zugriffsbeschränkung auf der Grundlage der IP-Adresse des Clients zu beschreiben, aber es kann viel mächtiger gemacht werden, besonders wenn mehrere <code
                class="literal">Require</code> Direktiven in einem <code
                class="literal">RequireAll</code>-Block kombiniert werden.
				</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.5.11.18.8"></a><p
                class="title"><strong>Beispiel 11.20. Only allow from the local network</strong></p><div
                class="example-contents"><pre
                  class="programlisting">Require ip 192.168.0.0/16</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ALTERNATIVE</em></span> Old syntax</strong></p></div></div></div><div
                class="para">
					Die Syntax <code
                  class="literal">Require</code> ist nur in Apache 2.4 verfügbar (die Version in <span
                  class="distribution distribution">Jessie</span>). Für Benutzer von <span
                  class="distribution distribution">Wheezy</span> ist die Syntax des Apache 2.2 anders, und wir beschreiben sie hier hauptsächlich als Referenz, obwohl sie auch in Apache 2.4 durch das Modul <code
                  class="literal">mod_access_compat</code> verfügbar ist.
				</div><div
                class="para">
					Die Direktiven <code
                  class="literal">Allow from</code> und <code
                  class="literal">Deny from</code> steuern Zugriffsbeschränkungen für Verzeichnisse (und, rekursiv, deren Unterverzeichnisse).
				</div><a
                id="id-1.14.5.11.18.9.4"
                class="indexterm"></a><a
                id="id-1.14.5.11.18.9.5"
                class="indexterm"></a><a
                id="id-1.14.5.11.18.9.6"
                class="indexterm"></a><div
                class="para">
					Die Anweisung <code
                  class="literal">Order</code> informiert den Server über die Reihenfolge, in der die Anweisungen <code
                  class="literal">Allow from</code> und <code
                  class="literal">Deny from</code> angewendet werden; die zuletzt zutreffende erhält Vorrang. Konkret erlaubt <code
                  class="literal">Order deny,allow</code> Zugang, falls kein <code
                  class="literal">Deny from</code> gilt, oder falls eine <code
                  class="literal">Allow from</code> Anweisung zutrifft. Umgekehrt verweigert <code
                  class="literal">Order allow,deny</code> den Zugang, falls keine <code
                  class="literal">Allow from</code> Anweisung zutrifft (oder falls eine <code
                  class="literal">Deny from</code> Anweisung gilt).
				</div><div
                class="para">
					Auf die Anweisungen <code
                  class="literal">Allow from</code> und <code
                  class="literal">Deny from</code> kann eine IP-Adresse folgen, ein Netzwerk (wie zum Beispiel <code
                  class="literal">192.168.0.0/255.255.255.0</code>, <code
                  class="literal">192.168.0.0/24</code> oder sogar <code
                  class="literal">192.168.0</code>), ein Host- oder Domain-Name oder das Schlüsselwort <code
                  class="literal">all</code>, das jeden bezeichnet.
				</div><div
                class="para">
					Zum Beispiel, um Verbindungen standardmäßig abzulehnen, sie aber aus dem lokalen Netzwerk zuzulassen, können Sie folgendes verwenden:
				</div><pre
                class="programlisting">
Order deny,allow
Allow from 192.168.0.0/16
Deny from all</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.12"></a>11.2.4. Protokoll-Analysatoren</h3></div></div></div><div
            class="para">
				Häufig wird ein Protokoll-Analysator auf einem Web-Server installiert, da er den Administratoren ein genaues Bild der Einsatzmuster des Servers vermittelt.
			</div><div
            class="para">
				Die Falcot Corp. Administratoren haben <span
              class="emphasis"><em>AWStats</em></span> (<span
              class="emphasis"><em>Advanced Web Statistics</em></span>) für die Analyse ihrer Apache-Protokolldateien ausgewählt.
			</div><a
            id="id-1.14.5.12.4"
            class="indexterm"></a><a
            id="id-1.14.5.12.5"
            class="indexterm"></a><a
            id="id-1.14.5.12.6"
            class="indexterm"></a><a
            id="id-1.14.5.12.7"
            class="indexterm"></a><div
            class="para">
				Der erste Konfigurierungsschritt besteht darin, die Datei <code
              class="filename">/etc/awstats/awstats.conf</code> anzupassen. Die Falcot Administratoren lassen sie bis auf die folgenden Parameter unverändert:
			</div><pre
            class="programlisting">
LogFile="/var/log/apache2/access.log"
LogFormat = "%virtualname %host %other %logname %time1 %methodurl %code %bytesd %refererquot %uaquot"
SiteDomain="www.falcot.com"
HostAliases="falcot.com REGEX[^.*\.falcot\.com$]"
DNSLookup=1
LoadPlugin="tooltips"</pre><div
            class="para">
				All diese Parameter sind durch Kommentare in der Vorlagendatei dokumentiert. Insbesondere bezeichnen die Parameter <code
              class="varname">LogFile</code> und <code
              class="varname">LogFormat</code> den Ort und das Format der Protokolldatei sowie die Information, die sie enthält; <code
              class="varname">SiteDomain</code> und <code
              class="varname">HostAliases</code> führen die verschiedenen Bezeichnungen auf, unter denen die Haupt-Website bekannt ist.
			</div><div
            class="para">
				Für Internet-Präsenzen mit starkem Datenverkehr sollte <code
              class="varname">DNSLookup</code> normalerweise nicht auf <code
              class="literal">1</code> gesetzt werden; für kleinere, wie die oben beschriebene Falcot-Site, ermöglicht diese Einstellung jedoch besser lesbare Berichte, die vollständige Rechnernamen enthalten statt unverarbeiteter IP-Adressen.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SICHERHEIT</em></span> Zugang zu Statistiken</strong></p></div></div></div><div
              class="para">
				AWStats stellt seine Statistiken auf der Website standardmäßig ohne Beschränkungen zur Verfügung, jedoch können Beschränkungen eingerichtet werden, so dass nur einige (wohl interne) IP-Adressen auf sie zugreifen können; die Liste der zugelassenen IP-Adressen muss in dem Parameter <code
                class="varname">AllowAccessFromWebToFollowingIPAddresses</code> festgelegt werden
			</div></div><div
            class="para">
				AWStats wird auch für andere virtuelle Hosts aktiviert; jeder virtuelle Host benötigt seine eigene Konfigurationsdatei, wie zum Beispiel <code
              class="filename">/etc/awstats/awstats.www.falcot.org.conf</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.12.14"></a><p
              class="title"><strong>Beispiel 11.21. AWStats-Konfigurationsdatei für einen virtuellen Host</strong></p><div
              class="example-contents"><pre
                class="programlisting">
Include "/etc/awstats/awstats.conf"
SiteDomain="www.falcot.org"
HostAliases="falcot.org"</pre></div></div><div
            class="para">
				AWStats verwendet zahlreiche im Verzeichnis <code
              class="filename">/usr/share/awstats/icon/</code> gespeicherte Piktogramme. Damit diese Symbole auf der Website zur Verfügung stehen, muss die Apache-Konfiguration durch das Hinzufügen folgender Anweisung angepasst werden:
			</div><pre
            class="programlisting">
Alias /awstats-icon/ /usr/share/awstats/icon/</pre><div
            class="para">
				Einige Minuten später (und nachdem das Skript einige Male gelaufen ist) stehen die Ergebnisse online zur Verfügung: <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://www.falcot.com/cgi-bin/awstats.pl">http://www.falcot.com/cgi-bin/awstats.pl</a></div><div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://www.falcot.org/cgi-bin/awstats.pl">http://www.falcot.org/cgi-bin/awstats.pl</a></div>
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>VORSICHT</em></span> Rotation von Protokolldateien</strong></p></div></div></div><div
              class="para">
				Damit die Statistiken alle Protokolle berücksichtigen, muss <span
                class="emphasis"><em>AWStats</em></span> unmittelbar vor dem Rotieren der Apache-Protokolldateien ausgeführt werden. Ein Blick auf die Direktive <code
                class="literal">prerotate</code> in der Datei <code
                class="filename">/etc/logrotate.d/apache2</code>, zeigt, dass man das durch Einfügen eines Symlinks auf <code
                class="filename">/usr/share/awstats/tools/update.sh</code> in <code
                class="filename">/etc/logrotate.d/httpd-prerotate</code> erreicht:
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>cat /etc/logrotate.d/apache2
</code></strong><code
                class="computeroutput">/var/log/apache2/*.log {
  daily
  missingok
  rotate 14
  compress
  delaycompress
  notifempty
  create 644 root adm
  sharedscripts
  postrotate
    if /etc/init.d/apache2 status &gt; /dev/null ; then \
      /etc/init.d/apache2 reload &gt; /dev/null; \
    fi;
  endscript
  prerotate
    if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
      run-parts /etc/logrotate.d/httpd-prerotate; \
    fi; \
  endscript
}
$ </code><strong
                class="userinput"><code>sudo mkdir -p /etc/logrotate.d/httpd-prerotate
</code></strong><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>sudo ln -sf /usr/share/awstats/tools/update.sh \
  /etc/logrotate.d/httpd-prerotate/awstats
</code></strong></pre><div
              class="para">
				Beachten Sie auch, dass die von <code
                class="command">logrotate</code> erzeugten Protokolldateien für jeden lesbar sein müssen, insbesondere für AWStats. In oben stehendem Beispiel wird dies durch die Zeile <code
                class="literal">create 644 root adm</code> (anstelle der voreingestellten Berechtigung <code
                class="literal">640</code>) gewährleistet.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="network-services.html"><strong>Zurück</strong>Kapitel 11. Netzwerkdienste: Postfix, Apache, NFS...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Nach oben</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Zum Anfang</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.ftp-file-server.html"><strong>Weiter</strong>11.3. FTP-Dateiserver</a></li></ul></body></html>
