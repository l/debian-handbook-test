<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">第 11 章 ネットワークサービス、Postfix、Apache、NFS、Samba、Squid、LDAP、SIP、XMPP、TURN</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-ja-JP-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="prev"
        href="sect.network-diagnosis-tools.html"
        title="10.8. ネットワーク診断ツール" /><link
        rel="next"
        href="sect.http-web-server.html"
        title="11.2. ウェブサーバ (HTTP)" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ja-JP/stable/network-services.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>次へ</strong></a></li></ul><div
        xml:lang="ja-JP"
        class="chapter"
        lang="ja-JP"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  xmlns=""
                  id="network-services"></a>第 11 章 ネットワークサービス、Postfix、Apache、NFS、Samba、Squid、LDAP、SIP、XMPP、TURN</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="network-services.html#sect.smtp-mail-server">11.1. メールサーバ</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.7">11.1.1. Postfix のインストール</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.configuring-virtual-domains">11.1.2. 仮想ドメインの設定</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.restrictions-for-receiving-and-sending">11.1.3. 受信と送信の制限</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.setting-up-greylisting">11.1.4. <span
                        class="foreignphrase"><em
                          class="foreignphrase">greylisting</em></span> の設定</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.11">11.1.5. 受信者アドレスに基づくフィルタのカスタマイズ</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.postfix-antivirus">11.1.6. アンチウイルスの統合</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.authenticated-smtp">11.1.7. SMTP 認証</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-web-server.html">11.2. ウェブサーバ (HTTP)</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.9">11.2.1. Apache のインストール</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.10">11.2.2. 仮想ホストの設定</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.11">11.2.3. よく使われる指示文</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.12">11.2.4. ログ解析ソフトウェア</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ftp-file-server.html">11.3. FTP ファイルサーバ</a></span></dt><dt><span
                class="section"><a
                  href="sect.nfs-file-server.html">11.4. NFS ファイルサーバ</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.10">11.4.1. NFS の安全確保</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.11">11.4.2. NFS サーバ</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.12">11.4.3. NFS クライアント</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.windows-file-server-with-samba.html">11.5. Samba を使った Windows 共有のセットアップ</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.9">11.5.1. Samba サーバ</a></span></dt><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.10">11.5.2. Samba クライアント</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-ftp-proxy.html">11.6. HTTP/FTP プロキシ</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.8">11.6.1. インストール</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.9">11.6.2. キャッシュの設定</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.10">11.6.3. フィルタの設定</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ldap-directory.html">11.7. LDAP ディレクトリ</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.7">11.7.1. インストール</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.8">11.7.2. ディレクトリへの書き込み</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.9">11.7.3. LDAP を用いたアカウントの管理</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.rtc-services.html">11.8. リアルタイムコミュニケーションサービス</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-dns-settings">11.8.1. RTC サービス用の DNS 設定</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.turn-server">11.8.2. TURN サーバ</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.sip-server">11.8.3. SIP プロキシサーバ</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.xmpp-server">11.8.4. XMPP サーバ</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-port-443">11.8.5. ポート 443 番でサービスを実行する</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-webrtc">11.8.6. WebRTC の追加</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		ネットワークサービスはユーザが毎日の仕事で直接使用するプログラムです。ネットワークサービスは情報システムの氷山の一角で、この章ではネットワークサービスに注目します。そして、水面下に隠された部分は既に説明したインフラに依存しています。
	</div><div
            class="para">
		多くの現代的なネットワークサービスは信頼性と安全性を確保して運用するために暗号化技術を必要としています。特に公開インターネットでは暗号化技術が必要不可欠です。X.509 証明書 (SSL 証明書および TLS 証明書とも呼ばれる場合もあります) は暗号化という目的を果たす際に最もよく使われています。特定のドメインに対する証明書はこの章で紹介するサービス間で共有される場合が多いです。
	</div><a
            id="id-1.14.3.3"
            class="indexterm"></a><a
            id="id-1.14.3.4"
            class="indexterm"></a><a
            id="id-1.14.3.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    xmlns=""
                    id="sect.smtp-mail-server"></a>11.1. メールサーバ</h2></div></div></div><div
            class="para">
			Falcot Corp の管理者は信頼性と設定の容易さから電子メールサーバに Postfix を選びました。実際、Postfix の設計によりそれぞれのタスクは必要な最低限のパーミッションを持つ単独のプロセスとして実装されることが強制されます。この制限によりセキュリティ問題を大きく軽減させることが可能です。
		</div><a
            id="id-1.14.4.3"
            class="indexterm"></a><a
            id="id-1.14.4.4"
            class="indexterm"></a><a
            id="id-1.14.4.5"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIVE</em></span> Exim4 サーバ</strong></p></div></div></div><a
              id="id-1.14.4.6.2"
              class="indexterm"></a><div
              class="para">
			Debian はデフォルト電子メールサーバとして Exim4 を使います (そのため Exim4 は Debian の初回インストール時に導入されます)。Exim4 の設定は別のパッケージ <span
                class="pkg pkg">exim4-config</span> で提供され、Debconf を使った一連の質問に答えることで自動的にカスタマイズされます。この質問は <span
                class="pkg pkg">postfix</span> パッケージの行う質問とよく似ています。
		</div><div
              class="para">
			設定は単独の設定ファイル (<code
                class="filename">/etc/exim4/exim4.conf.template</code>) か <code
                class="filename">/etc/exim4/conf.d/</code> の下に保存された数多くの設定ファイルを通じて行われます。どちらの場合も、<code
                class="command">update-exim4.conf</code> が設定ファイルをテンプレートとして利用して <code
                class="filename">/var/lib/exim4/config.autogenerated</code> を生成します。実際 Exim4 が使うファイルが <code
                class="filename">/var/lib/exim4/config.autogenerated</code> です。このメカニズムのおかげで、debconf を通じて Exim に設定した値 (<code
                class="filename">/etc/exim4/update-exim4.conf.conf</code> に保存されている値) は管理者や他のパッケージがデフォルトの Exim 設定を変更した場合でも Exim の設定ファイルに反映されます。
		</div><div
              class="para">
			Exim4 設定ファイルの構文は特殊で、構文の学習曲線も特殊です。しかしながら、その特殊性を理解すれば、Exim4 は数百ページにおよぶ文書からも明らかな通りとても完全で強力な電子メールサーバです。<div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.exim.org/docs.html">http://www.exim.org/docs.html</a></div>
		</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.14.4.7"></a>11.1.1. Postfix のインストール</h3></div></div></div><div
              class="para">
				<span
                class="pkg pkg">postfix</span> パッケージには主要な SMTP デーモンが含まれます。別のパッケージ (たとえば <span
                class="pkg pkg">postfix-ldap</span> と <span
                class="pkg pkg">postfix-pgsql</span> など) は特別な機能を Postfix に追加します。これらのパッケージはマッピングデータベースへのアクセスを可能にします。これらのパッケージは、それが必要と分かっている場合を除いて、インストールするべきではありません。
			</div><div
              class="sidebar"><a
                xmlns=""
                id="sidebar.smtp"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>BACK TO BASICS</em></span> SMTP</strong></p></div></div></div><a
                id="id-1.14.4.7.3.2"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.3"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.4"
                class="indexterm"></a><div
                class="para">
				メールサーバは SMTP (<span
                  class="emphasis"><em>Simple Mail Transfer Protocol</em></span>) を使ってメールを交換したり配送したりします。
			</div></div><div
              class="para">
				Debconf はパッケージのインストール中にいくつかの質問を行います。これに答えることで、<code
                class="filename">/etc/postfix/main.cf</code> 設定ファイルの最初のバージョンが作成されます。
			</div><div
              class="para">
				最初の質問はセットアップの形式に関するものです。インターネットに接続されたサーバに関連するのは提案された選択肢のうちの 2 種類だけです。「インターネットサイト」と「スマートホスト付きインターネット」です。「インターネットサイト」は入って来る電子メールを受け取り、外に出る電子メールを直接受信者に送信するサーバに適します。つまり Falcot Corp の場合にうまく適合します。「スマートホスト付きインターネット」は入って来る電子メールを通常通り受け取り、外に出る電子メールを直接受信者のサーバに送信するのではなく中間 SMTP サーバ「スマートホスト」を介して送信するサーバに適します。この選択肢は主に動的 IP アドレスを持つマシンで役に立ちます。なぜなら、多くの電子メールサーバは動的 IP アドレスを持つホストから配送されたメッセージを拒否するからです。この選択肢を選んだ場合、通常スマートホストに自分の ISP の SMTP サーバを設定します。ISP の SMTP サーバは自分の顧客からの電子メールを受け入れ、それを適切に転送するよう常に設定されています。この (スマートホストを使う) 選択肢はさらにインターネットから切断される可能性のあるサーバにも適しています。なぜなら、後から再試行する必要のある未配送メッセージのキューを管理する必要がなくなるからです。
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>VOCABULARY</em></span> ISP</strong></p></div></div></div><a
                id="id-1.14.4.7.6.2"
                class="indexterm"></a><div
                class="para">
				ISP とは「Internet Service Provider」の頭字語です。ISP は通常営利企業で、インターネット接続と関連する基本的サービス (電子メール、ニュースなど) を提供します。
			</div><div
                class="para">
			</div></div><div
              class="para">
				2 番目の質問はマシンのフルネームに関するもので、これはローカルユーザの電子メールアドレスを生成するために使われます。従って、マシンのフルネームとはアットマーク (「@」) のすぐ後ろに付けられるものです。Falcot の場合、この質問には <code
                class="literal">mail.falcot.com</code> と答えるべきです。デフォルトで聞かれる質問は以上ですが、Falcot にとってこの状態の Postfix はまだ十分に設定されていません。このため、管理者は <code
                class="command">dpkg-reconfigure postfix</code> を実行してさらに多くのパラメータをカスタマイズします。
			</div><div
              class="para">
				<code
                class="command">dpkg-reconfigure postfix</code> を実行したことで追加的に行われる質問の 1 つに、このマシンに関連するすべてのドメイン名を尋ねる質問があります。デフォルトで挙げられるドメイン名のリストには、マシンのフルネームといくつかの <code
                class="literal">localhost</code> の同義語が含まれていますが、主要なドメイン名である <code
                class="literal">falcot.com</code> を手作業で追加する必要があります。より一般的に言えば、この質問の回答には、通常 MX サーバを担当しているマシンに割り当てたすべてのドメイン名を含めるべきです。さらに言い換えれば、DNS の MX レコードを参照した際に電子メールを受け入れるサーバとして登録されているすべてのドメイン名を含めるべきです。この情報は最終的に Postfix 主要設定ファイル <code
                class="filename">/etc/postfix/main.cf</code> の <code
                class="literal">mydestination</code> 変数に設定されます。
			</div><a
              id="id-1.14.4.7.9"
              class="indexterm"></a><a
              id="id-1.14.4.7.10"
              class="indexterm"></a><div
              class="figure"><a
                xmlns=""
                id="id-1.14.4.7.11"></a><div
                class="figure-contents"><div
                  class="mediaobject"><img
                    src="images/mail-server.png"
                    alt="メール送信における DNS MX レコードの役割" /></div></div><p
                class="title"><strong>図 11.1 メール送信における DNS <span
                    class="emphasis"><em>MX</em></span> レコードの役割</strong></p></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>EXTRA</em></span> MX レコードの問い合わせ</strong></p></div></div></div><div
                class="para">
				宛先アドレスの DNS に MX レコードが含まれない場合、電子メールサーバは宛先アドレスの A レコード (IPv6 の場合 AAAA レコード) に送信することを試みます。
			</div></div><div
              class="para">
				インストール中に、このサーバが電子メールの送信要求を受け入れるネットワークを尋ねられる場合があります。デフォルトの設定で、Postfix はマシン自身からの電子メールの送信要求だけを受け入れます。従って、通常はローカルネットワークからの送信要求も受け入れるように設定します。Falcot Corp の管理者はデフォルトの回答に <code
                class="literal">192.168.0.0/16</code> を追加しました。この質問が尋ねられなければ、以下の例に示す通り、設定ファイル中の関連する変数 <code
                class="literal">mynetworks</code> にローカルネットワークを追加します。
			</div><div
              class="para">
				ローカル電子メールの配送に <code
                class="command">procmail</code> を使うことも可能です。<code
                class="command">procmail</code> を使うことで、ユーザは <code
                class="filename">~/.procmailrc</code> ファイルに書かれたルールに従って入って来る電子メールを仕分けすることが可能になります。
			</div><a
              id="id-1.14.4.7.15"
              class="indexterm"></a><a
              id="id-1.14.4.7.16"
              class="indexterm"></a><a
              id="id-1.14.4.7.17"
              class="indexterm"></a><div
              class="para">
				最初のステップの後、以下の設定ファイルが得られます。さらに次の節では、いくつかの特別な機能を追加するための足掛かりとしてこれを使います。
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.7.19"></a><p
                class="title"><strong>例 11.1 最初の <code
                    class="filename">/etc/postfix/main.cf</code> ファイル</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# より完全なコメント付きの設定ファイルは /usr/share/postfix/main.cf.dist を参照してください


# Debian 固有の設定方法になりますが、myorigin にファイル名を指定した場合、
# 指定ファイルの最初の行を値として使用します。Debian のデフォルトは
# /etc/mailname です。
#myorigin = /etc/mailname

smtpd_banner = $myhostname ESMTP $mail_name (Debian/GNU)
biff = no

# .domain の追加は MUA が行います。
append_dot_mydomain = no

# "delayed mail" 警告メールを送信するには以下の行を有効化してください
#delay_warning_time = 4h

readme_directory = no

# TLS パラメータ
smtpd_tls_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
smtpd_tls_key_file=/etc/ssl/private/ssl-cert-snakeoil.key
smtpd_use_tls=yes
smtpd_tls_session_cache_database = btree:${data_directory}/smtpd_scache
smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache

# smtp クライアントで SSL を有効化するための情報を見るには postfix-doc
# パッケージに含まれる /usr/share/doc/postfix/TLS_README.gz を参照してください。

smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination
myhostname = mail.falcot.com
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
myorigin = /etc/mailname
mydestination = mail.falcot.com, falcot.com, localhost.localdomain, localhost
relayhost = 
mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 192.168.0.0/16
mailbox_command = procmail -a "$EXTENSION"
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
inet_protocols = all</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>SECURITY</em></span> <span
                          class="emphasis"><em>Snake oil</em></span> SSL 証明書</strong></p></div></div></div><div
                class="para">
				<span
                  class="emphasis"><em>snake oil</em></span> 証明書 (昔に悪徳医者によって販売された<span
                  class="emphasis"><em>いんちき</em></span>「薬」のようなもの) には全く価値がありません。すなわち、<span
                  class="emphasis"><em>snake oil</em></span> 証明書を信頼してはいけません。なぜなら、<span
                  class="emphasis"><em>snake oil</em></span> 証明書は自動生成された自己署名証明書に過ぎないからです。しかしながら、<span
                  class="emphasis"><em>snake oil</em></span> 証明書は交換される情報のプライバシーを向上させるという意味では有用です。
			</div><div
                class="para">
				一般に <span
                  class="emphasis"><em>snake oil</em></span> 証明書の使用はテスト目的に限り、通常のサービスでは真の証明書を使うべきです。証明書の作成手順は<a
                  class="xref"
                  href="sect.virtual-private-network.html#sect.easy-rsa">第 10.2.1.1 節「公開鍵基盤、<span
                    class="emphasis"><em>easy-rsa</em></span>」</a>で説明されています。
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.configuring-virtual-domains"></a>11.1.2. 仮想ドメインの設定</h3></div></div></div><a
              id="id-1.14.4.8.2"
              class="indexterm"></a><a
              id="id-1.14.4.8.3"
              class="indexterm"></a><div
              class="para">
				メールサーバは主要ドメインに加えて他のドメイン宛の電子メールを受け取ることが可能です。これらは仮想ドメインとして知られています。仮想ドメインを使う場合のほとんどは、電子メールが永久的にローカルユーザに配送されない場合です。Postfix は仮想ドメインを取り扱う 2 種類の興味深い機能を提供します。
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>CAUTION</em></span> 仮想ドメインとカノニカルドメイン</strong></p></div></div></div><div
                class="para">
				<code
                  class="literal">mydestination</code> 変数の中で仮想ドメインを参照してはいけません。すなわち <code
                  class="literal">mydestination</code> 変数に指定できるのはマシンとローカルユーザに直接的に関連付けられた「カノニカル」ドメインの名前だけです。
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.8.6"></a>11.1.2.1. 仮想エイリアスドメイン</h4></div></div></div><a
                id="id-1.14.4.8.6.2"
                class="indexterm"></a><a
                id="id-1.14.4.8.6.3"
                class="indexterm"></a><div
                class="para">
					仮想エイリアスドメインにはエイリアスだけが含まれます。たとえば、電子メールを他のアドレスに転送するだけのアドレスがこれに該当します。
				</div><div
                class="para">
					仮想エイリアスドメインを有効化するには、<code
                  class="literal">virtual_alias_domains</code> 変数にそのドメイン名を追加し、<code
                  class="literal">virtual_alias_maps</code> 変数でアドレスマッピングファイルを参照します。
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.6.6"></a><p
                  class="title"><strong>例 11.2 <code
                      class="filename">/etc/postfix/main.cf</code> ファイルに追加する指示文</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_alias_domains = falcotsbrand.com
virtual_alias_maps = hash:/etc/postfix/virtual</pre></div></div><div
                class="para">
					<code
                  class="filename">/etc/postfix/virtual</code> ファイルはかなり直接的な構文で対応付けを記述します。すなわち、各行には空白で分割された 2 つのフィールドが含まれます。最初のフィールドは仮想エイリアス名、2 番目のフィールドはリダイレクトする電子メールアドレスのリストです。<code
                  class="literal">@domain.com</code> 特殊構文を使うことで、そのドメインに含まれるすべての残りの別名をカバーすることも可能です。
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.6.8"></a><p
                  class="title"><strong>例 11.3 <code
                      class="filename">/etc/postfix/virtual</code> ファイルの例</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
webmaster@falcotsbrand.com  jean@falcot.com
contact@falcotsbrand.com    laure@falcot.com, sophie@falcot.com
# 以下の仮想エイリアスは一般的なエイリアスです。このファイルで
# 指定されていない falcotsbrand.com ドメインに含まれるすべての
# アドレスを指定したことになります。これらのアドレス宛の電子メール
# は falcot.com ドメインに存在する同名のユーザに転送されます。
@falcotsbrand.com           @falcot.com</pre></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.8.7"></a>11.1.2.2. 仮想メールボックスドメイン</h4></div></div></div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>CAUTION</em></span> 統合された仮想ドメイン?</strong></p></div></div></div><div
                  class="para">
					Postfix は <code
                    class="literal">virtual_alias_domains</code> と <code
                    class="literal">virtual_mailbox_domains</code> で同じドメインを使うことを許しません。しかしながら、<code
                    class="literal">virtual_mailbox_domains</code> の各ドメインは明示せずとも <code
                    class="literal">virtual_alias_domains</code> に含まれます。そのおかげで、仮想ドメインの中でエイリアスとメールボックスを混在させることが可能になります。
				</div></div><a
                id="id-1.14.4.8.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.8.7.4"
                class="indexterm"></a><div
                class="para">
					仮想メールボックスドメイン宛のメッセージはローカルシステムユーザに割り当てられていないメールボックスに保存されます。
				</div><div
                class="para">
					仮想メールボックスドメインを有効化するには、<code
                  class="literal">virtual_mailbox_domains</code> 変数にそのドメイン名を追加し、<code
                  class="literal">virtual_mailbox_maps</code> 変数でメールボックスマッピングファイルを参照します。<code
                  class="literal">virtual_mailbox_base</code> パラメータには、メールボックスが保存されるディレクトリを指定します。
				</div><div
                class="para">
					<code
                  class="literal">virtual_uid_maps</code> (および <code
                  class="literal">virtual_gid_maps</code>) パラメータは電子メールアドレスとそれに対応するメールボックスを「所有する」システムユーザ (およびグループ) の対応関係を含むファイルを参照します。すべてのメールボックスを同じ所有者とグループによって所有されるようにするには <code
                  class="literal">static:5000</code> 構文を使って固定された UID/GID (ここでは 5000) を割り当てるようにします。
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.7.8"></a><p
                  class="title"><strong>例 11.4 <code
                      class="filename">/etc/postfix/main.cf</code> ファイルに追加する指示文</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_mailbox_domains = falcot.org
virtual_mailbox_maps = hash:/etc/postfix/vmailbox
virtual_mailbox_base = /var/mail/vhosts</pre></div></div><div
                class="para">
					繰り返しになりますが、<code
                  class="filename">/etc/postfix/vmailbox</code> ファイルの構文はかなり直接的です。つまり、空白で分けられた 2 種類のフィールドで対応関係を表現します。最初のフィールドは仮想ドメインの 1 つに属する電子メールアドレスで、2 番目のフィールドは関連するメールボックスの場所です (これは <span
                  class="emphasis"><em>virtual_mailbox_base</em></span> 以下から見た相対ディレクトリパスを指定します)。メールボックスの名前がスラッシュ (<code
                  class="literal">/</code>) で終わっていた場合、電子メールは <span
                  class="emphasis"><em>maildir</em></span> フォーマットで保存されます。一方、そうでなければ伝統的な <span
                  class="emphasis"><em>mbox</em></span> フォーマットで保存されます。<span
                  class="emphasis"><em>maildir</em></span> フォーマットはメールボックスを保存するためにディレクトリ全体を使い、それぞれのメッセージは 1 つのファイルとして保存されます。これに対して、<span
                  class="emphasis"><em>mbox</em></span> フォーマットでは、メールボックス全体が 1 つのファイルに保存されます。「<code
                  class="literal">From </code>」(<code
                  class="literal">From</code> の後に 1 つの空白) で始まる行が新しいメッセージの始まる目印です。
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.7.10"></a><p
                  class="title"><strong>例 11.5 <code
                      class="filename">/etc/postfix/vmailbox</code> ファイル</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
# Jean 宛の電子メールは専用ディレクトリ内の 1 ファイルを
# 1 メールに対応付ける maildir フォーマットで保存されます
jean@falcot.org falcot.org/jean/
# Sophie 宛の電子メールは 1 ファイルにすべてのメールを
# 連結する伝統的な "mbox" ファイルに保存されます
sophie@falcot.org falcot.org/sophie</pre></div></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.restrictions-for-receiving-and-sending"></a>11.1.3. 受信と送信の制限</h3></div></div></div><div
              class="para">
				迷惑メール (<span
                class="emphasis"><em>スパム</em></span>) の数が増加したことにより、サーバが受け入れる電子メールの判断基準をますます厳しくすることが要求されるようになっています。この節では Postfix が備えるいくつかの戦略を紹介します。
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>CULTURE</em></span> スパム問題</strong></p></div></div></div><a
                id="id-1.14.4.9.3.2"
                class="indexterm"></a><div
                class="para">
				「スパム」は一般的な用語で、電子メールボックスを満杯にするすべての迷惑メール (UCE としても知られています) を指す場合に使われます。そしてスパムを送信する悪人はスパマーとして知られています。スパマーは自分のやっている迷惑行為にほとんど関心がありません。なぜなら、電子メールを送信する費用はとても安く、受信者の内とても少ない割合がスパム行為の提供物に魅力を感じて送信コストより多くのお金を生むからです。スパム行為はほとんど自動化されています。公開している電子メールアドレス (たとえばウェブフォーラム、メーリングリストのアーカイブ、ブログなどに載せられているメールアドレス) はスパマーのロボットによって発見され、迷惑メッセージを絶えず送りつけられます。
			</div><div
                class="para">
				すべてのシステム管理者はスパムフィルタを使ってこの迷惑行為に立ち向かうことを試みます。しかし、もちろんスパマーはスパムフィルタを対処するように調整を続けます。一部のスパマーはさまざまな犯罪組織によりワームに感染させられたマシンのネットワークを借りるかもしれません。最近の統計によればインターネット上を流れるすべての電子メールの 95% 超がスパムであると推定されています!
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.4"></a>11.1.3.1. IP に基づくアクセス制限</h4></div></div></div><div
                class="para">
					<code
                  class="literal">smtpd_client_restrictions</code> 指示文を使うことで、電子メールサーバと通信することを許すマシンを制御することが可能です。
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.4.3"></a><p
                  class="title"><strong>例 11.6 クライアントアドレスに基づく制限</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_client_restrictions = permit_mynetworks,
    warn_if_reject reject_unknown_client,
    check_client_access hash:/etc/postfix/access_clientip,
    reject_rbl_client sbl-xbl.spamhaus.org,
    reject_rbl_client list.dsbl.org</pre></div></div><div
                class="para">
					上に挙げた例のように、変数に複数のルールのリストを設定する場合、これらのルールは最初から最後まで順番に評価されます。それぞれのルールはメッセージを受け入れたり、拒否したり、次のルールに決定を任せたりすることが可能です。その結果、順番が重要になります。2 つのルールを入れ替えるだけで挙動が全く違うものになる場合があります。
				</div><div
                class="para">
					最初のルールとして使われている <code
                  class="literal">permit_mynetworks</code> 指示文により、ローカルネットワーク (<span
                  class="emphasis"><em>mynetworks</em></span> 設定変数によって定義されています) 内のマシンからのすべての電子メールを受け入れるようになります。
				</div><div
                class="para">
					<code
                  class="literal">reject_unknown_client</code> 指示文により、完全に適切な DNS 設定のないマシンからの電子メールを通常拒否するようになります。ここで適切な設定とは、IP アドレスが名前に解決でき、その名前が同じ IP アドレスに解決できることを意味しています。この基準は厳しすぎる場合が多いでしょう。なぜなら、多くの電子メールサーバは IP アドレスに対応する逆引き DNS を持っていないからです。このため、Falcot の管理者は <code
                  class="literal">warn_if_reject</code> 修飾子を <code
                  class="literal">reject_unknown_client</code> 指示文の前に置きました。<code
                  class="literal">warn_if_reject</code> 修飾子を付けることで、拒否するのではなく警告をログに記録するようになります。管理者は、このルールが実際強制された場合に拒否されるかもしれないメッセージの数に目を光らせ、後から十分な情報に基づいてこのルールを強制するか否かを決断することが可能です。
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>TIP</em></span> <span
                            class="emphasis"><em>access</em></span> テーブル</strong></p></div></div></div><div
                  class="para">
					管理者は送信者、IP アドレス、許可および拒否ホスト名を組み合わせたテーブルを作成し、制限基準としてこれを使うことが可能です。これらのテーブルは <code
                    class="filename">/usr/share/doc/postfix-doc/examples/access.gz</code> ファイルを展開したコピーを使って作成することも可能です。このひな形には、説明がコメントとして書かれており、それぞれのテーブルがその構文を説明しています。
				</div><div
                  class="para">
					<code
                    class="filename">/etc/postfix/access_clientip</code> テーブルは IP アドレスとネットワーク、<code
                    class="filename">/etc/postfix/access_helo</code> テーブルはドメイン名、<code
                    class="filename">/etc/postfix/access_sender</code> テーブルは送信者の電子メールアドレスをリストしています。これらのファイルを変更した場合、その後に必ず <code
                    class="command">postmap /etc/postfix/<em
                      class="replaceable">file</em></code> コマンドを使ってファイルをハッシュテーブル (高速アクセスに最適化されたフォーマット) に変換する必要があります。
				</div></div><div
                class="para">
					<code
                  class="literal">check_client_access</code> 指示文を使うことで、管理者は <code
                  class="filename">/etc/postfix/access_clientip</code> ファイルに保存された電子メールサーバのブラックリストとホワイトリストを設定することが可能になります。ホワイトリストに含まれるサーバは信頼され、このサーバから来る電子メールは以降のフィルタリングルールを適用されません。
				</div><div
                class="para">
					<code
                  class="literal">reject_rbl_client</code> 指示文を使うことで、指定したブラックリストに含まれるサーバからのメッセージを拒否するようになります。RBL は <span
                  class="emphasis"><em>Remote Black List</em></span> の頭字語です。ブラックリストは複数存在しますが、どのブラックリストにもスパマーが電子メールを中継するために使う下手に設定されたサーバ、ワームやウイルスに感染したマシンのような本来の意図と異なりメール中継させられているサーバがリストされています。
				</div><a
                id="id-1.14.4.9.4.10"
                class="indexterm"></a><a
                id="id-1.14.4.9.4.11"
                class="indexterm"></a><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>TIP</em></span> ホワイトリストと RBL</strong></p></div></div></div><div
                  class="para">
					ブラックリストには過去に異常が発生した正当なサーバが含まれることもあります。この場合、そのようなサーバからのすべての電子メールは拒否されます。これを受け入れるには <code
                    class="filename">/etc/postfix/access_clientip</code> によって定義されたホワイトリストの中にそのサーバをリストするしかありません。
				</div><div
                  class="para">
					このため、よく考えた上で、通常電子メールを受け取るような信頼できるサーバはすべてホワイトリストの中に含めることを推奨します。
				</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.5"></a>11.1.3.2. <code
                        class="literal">EHLO</code> または <code
                        class="literal">HELO</code> コマンドの妥当性確認</h4></div></div></div><div
                class="para">
					SMTP でメールを送信するには、最初にサーバへ <code
                  class="literal">HELO</code> (または <code
                  class="literal">EHLO</code>) の後に送信元の名前を付けたコマンドを送ります。送信元の名前の妥当性を確認することは興味深いです。
				</div><a
                id="id-1.14.4.9.5.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.5.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.5.5"></a><p
                  class="title"><strong>例 11.7 <code
                      class="literal">EHLO</code> の引数に与えられる名前の制限</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_helo_restrictions = permit_mynetworks,
    reject_invalid_hostname,
    check_helo_access hash:/etc/postfix/access_helo,
    reject_non_fqdn_hostname,
    warn_if_reject reject_unknown_hostname</pre></div></div><div
                class="para">
					最初の <code
                  class="literal">permit_mynetworks</code> 指示文を使うことで、ローカルネットワーク上のすべてのマシンならば <code
                  class="literal">HELO</code> コマンドの引数にどのような名前を使っても良いことになります。これは重要です。なぜなら、一部の電子メールプログラムは SMTP プロトコルのこの部分を十分適切に尊重せず <code
                  class="literal">HELO</code> の引数に無意味な名前を使うからです。
				</div><div
                class="para">
					<code
                  class="literal">reject_invalid_hostname</code> ルールを使うことで、<code
                  class="literal">EHLO</code> で申告されたホスト名が構文的に不正な電子メールを拒否するようになります。<code
                  class="literal">reject_non_fqdn_hostname</code> ルールを使うことで、申告されたホスト名が完全修飾ドメイン名 (ホスト名まで含むドメイン名) でないメッセージを拒否するようになります。<code
                  class="literal">reject_unknown_hostname</code> ルールを使うことで、申告された名前が DNS に存在しないメッセージを拒否するようになります。<code
                  class="literal">reject_unknown_hostname</code> ルールを適用すると数多くの電子メールが拒否されることになるため、管理者は <code
                  class="literal">warn_if_reject</code> 修飾子を付けて警告するだけにしています。管理者は <code
                  class="literal">reject_unknown_hostname</code> ルールの結果を調査した後に、最後の段階で <code
                  class="literal">warn_if_reject</code> 修飾子を削除するか判断します。
				</div><div
                class="para">
					<code
                  class="literal">permit_mynetworks</code> をルール群の先頭で使うと、面白い副作用があります。すなわち、それ以降のルールがローカルネットワークの外のホストにのみ適用されるようになります。これを使うことで、自分を <code
                  class="literal">falcot.com</code> の一部と申告するすべてのホストをブラックリスト化できます。これを行うには、たとえば <code
                  class="literal">falcot.com REJECT You are not in our network!</code> のような行を <code
                  class="filename">/etc/postfix/access_helo</code> ファイルに追加します。
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.6"></a>11.1.3.3. 申告された送信者アドレスに基づく受け入れおよび拒否</h4></div></div></div><div
                class="para">
					各メッセージには送信者アドレスが必要です。送信者アドレスは SMTP プロトコルの <code
                  class="literal">MAIL FROM</code> コマンドで申告されます。繰り返しになりますが、さまざまな異なる方法で送信者アドレスの有効性を判断します。
				</div><a
                id="id-1.14.4.9.6.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.6.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.6.5"></a><p
                  class="title"><strong>例 11.8 送信者アドレスの確認</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_sender_restrictions = 
    check_sender_access hash:/etc/postfix/access_sender,
    reject_unknown_sender_domain, reject_unlisted_sender,
    reject_non_fqdn_sender</pre></div></div><div
                class="para">
					<code
                  class="literal">check_sender_access</code> ルールを使うことで、<code
                  class="filename">/etc/postfix/access_sender</code> テーブルで指定した一部の送信者を特別扱いすることが可能です。このルールは一部の送信者をホワイトリストやブラックリストに入れることを意味します。
				</div><div
                class="para">
					<code
                  class="literal">reject_unknown_sender_domain</code> ルールを使うことで、送信者アドレスに適切なドメインが含まれることを強制することが可能です。なぜなら、適切なアドレスならば必ず適切なドメインを含むからです。<code
                  class="literal">reject_unlisted_sender</code> ルールを使うことで、アドレスが存在しないローカル送信者を拒否します。さらに <code
                  class="literal">reject_unlisted_sender</code> ルールを使うことで、<code
                  class="literal">falcot.com</code> ドメイン内の不正なアドレスから電子メールが送信されること避けることが可能になり、<code
                  class="literal">joe.bloggs@falcot.com</code> などのアドレスが本当に存在する場合のみそのアドレスから送信されるメッセージを受け入れるようになります。
				</div><div
                class="para">
					最後に、<code
                  class="literal">reject_non_fqdn_sender</code> ルールを使うことで、完全修飾ドメイン名を持たないアドレスから送信されたと称する電子メールを拒否します。具体的には、<code
                  class="literal">user@machine</code> からの電子メールを拒否します。すなわち、送信者アドレスは必ず <code
                  class="literal">user@machine.example.com</code> または <code
                  class="literal">user@example.com</code> の形で申告されなければいけないということです。
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.7"></a>11.1.3.4. 受信者アドレスに基づく受け入れおよび拒否</h4></div></div></div><div
                class="para">
					各メッセージには少なくとも 1 つの受信者アドレスが必要です。受信者アドレスは SMTP プロトコルの <code
                  class="literal">RCPT TO</code> コマンドで申告されます。送信者アドレスに対して行った確認よりも関係性は低いとは言うものの、受信者アドレスの正当性を確認することは当然です。
				</div><a
                id="id-1.14.4.9.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.7.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.7.5"></a><p
                  class="title"><strong>例 11.9 受信者アドレスの確認</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks, 
    reject_unauth_destination, reject_unlisted_recipient, 
    reject_non_fqdn_recipient</pre></div></div><div
                class="para">
					<code
                  class="literal">reject_unauth_destination</code> は基本的なルールで、受け入れ要求のあったメッセージが自分の管理するユーザ宛であることを確認します。すなわち、このサーバにないアドレス宛のメッセージを拒否するということです。このルールを指定しなかった場合、サーバがスパマーによって迷惑メールを送信するための第三者中継サーバとして使われる可能性が出てきます。このため <code
                  class="literal">reject_unauth_destination</code> ルールは必須で、ルールリストの先頭に近い位置に置くのが最良です。そうすれば、メッセージの宛先をチェックする前に、他のルールがそのメッセージの受け入れを許可することを避けられます。
				</div><div
                class="para">
					<code
                  class="literal">reject_unlisted_recipient</code> ルールを使うことで、存在しないローカルユーザ宛のメッセージを拒否するようになります。これは道理に適ったルールです。最後に、<code
                  class="literal">reject_non_fqdn_recipient</code> ルールを使うことで、完全修飾ドメイン名でないアドレスを拒否するようになります。さらに <code
                  class="literal">reject_non_fqdn_recipient</code> ルールを使った場合、<code
                  class="literal">jean</code> や <code
                  class="literal">jean@machine</code> 宛の電子メールは送信できず、その代わりに <code
                  class="literal">jean@machine.falcot.com</code> や <code
                  class="literal">jean@falcot.com</code> などの完全なアドレスを使うことが要求されます。
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.8"></a>11.1.3.5. <code
                        class="literal">DATA</code> コマンドに関連付けられた制限</h4></div></div></div><div
                class="para">
					SMTP の <code
                  class="literal">DATA</code> コマンドはメッセージ内容の前に送信されます。<code
                  class="literal">DATA</code> コマンドの後に送信されるメッセージ内容はさておき、厳密な意味では <code
                  class="literal">DATA</code> コマンドはいかなる情報も提供しません。とは言っても、確認することは可能です。
				</div><a
                id="id-1.14.4.9.8.3"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.8.4"></a><p
                  class="title"><strong>例 11.10 <code
                      class="literal">DATA</code> の確認</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_data_restrictions = reject_unauth_pipelining</pre></div></div><div
                class="para">
					<code
                  class="literal">reject_unauth_pipelining</code> 指示文を使うことで、1 つ前に送信されたコマンドに応答する前に送信者が次のコマンドを送ったメッセージを拒否するようになります。この防御はスパマーロボットの使う一般的な最適化に対抗するものです。なぜなら、スパマーはサーバからの応答の結果を気にせず、可能な限り短い時間で可能な限り大量の電子メールを送信することだけに注目しているからです。
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.9"></a>11.1.3.6. 拒否応答の送信段階</h4></div></div></div><div
                class="para">
					上のコマンドを使うことで SMTP 交換のさまざまな段階で情報が検査されるにも関わらず、Postfix が実際の拒否を送信するのは <code
                  class="literal">RCPT TO</code> コマンドに対する応答の段階です。
				</div><div
                class="para">
					これは不正な <code
                  class="literal">EHLO</code> コマンドが原因でメッセージを拒否する場合でも、Postfix はメッセージの送信者と受信者を知った後に拒否応答を送信することを意味しています。こうすることで、すぐにトランザクションを拒否するよりも明確なログを残すことが可能です。加えて、多くの SMTP クライアントはトランザクションの最初の方の SMTP コマンドの失敗を予期していませんから、<code
                  class="literal">RCPT TO</code> の後に拒否応答を返したとしても問題になることは少ないです。
				</div><div
                class="para">
					こうすることによる最後の利点は SMTP 交換のさまざまなステージの間にやり取りした情報を総合的に検討することが可能であるという点です。これにより、パーミッションをきめ細かく調整することが可能です。たとえば、ローカル送信者のふりをする外部接続を拒否することなどが可能です。
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.10"></a>11.1.3.7. メッセージ内容に基づくフィルタリング</h4></div></div></div><div
                class="para">
					メッセージ内容を確認することにより、妥当性確認と制限システムが完成します。Postfix は電子メール本文や電子メールヘッダの内容に対して確認を適用し、その妥当性を識別することが可能です。
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.10.3"></a><p
                  class="title"><strong>例 11.11 内容に基づくフィルタの有効化</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
header_checks = regexp:/etc/postfix/header_checks
body_checks = regexp:/etc/postfix/body_checks</pre></div></div><a
                id="id-1.14.4.9.10.4"
                class="indexterm"></a><div
                class="para">
					どちらのファイルにも、正規表現 (<span
                  class="emphasis"><em>regexp</em></span> または <span
                  class="emphasis"><em>regex</em></span> としても知られます) のリストおよび、電子メールヘッダ (または本文) がその正規表現にマッチする場合に実行する動作の対応リストが含まれます。
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>QUICK LOOK</em></span> 正規表現テーブル</strong></p></div></div></div><div
                  class="para">
					<code
                    class="filename">/usr/share/doc/postfix-doc/examples/header_checks.gz</code> ファイルには多くの説明的なコメントが含まれます。またこのファイルを <code
                    class="filename">/etc/postfix/header_checks</code> と <code
                    class="filename">/etc/postfix/body_checks</code> ファイルの足掛かりとして使うことも可能です。
				</div></div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.10.7"></a><p
                  class="title"><strong>例 11.12 <code
                      class="filename">/etc/postfix/header_checks</code> ファイルの例</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
/^X-Mailer: GOTO Sarbacane/ REJECT I fight spam (GOTO Sarbacane)
/^Subject: *Your email contains VIRUSES/ DISCARD virus notification</pre></div></div><div
                class="sidebar"><a
                  xmlns=""
                  id="sidebar.regexp"></a><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>BACK TO BASICS</em></span> 正規表現</strong></p></div></div></div><div
                  class="para">
					<span
                    class="emphasis"><em>正規表現</em></span> (<span
                    class="emphasis"><em>regexp</em></span> または <span
                    class="emphasis"><em>regex</em></span> のように略されます) という用語は内容の説明や文字列の構造を表現する一般的な記法です。特別な文字を使って選択肢 (たとえば、<code
                    class="literal">foo|bar</code> は「foo」または「bar」にマッチします)、許容する文字 (たとえば、<code
                    class="literal">[0-9]</code> は任意の数字を意味し、単独のドット <code
                    class="literal">.</code> は任意の文字を意味します)、数量 (<code
                    class="literal">s?</code> は <code
                    class="literal">s</code> または空文字列にマッチします。言い換えれば <code
                    class="literal">s</code> が 0 または 1 回出現したらマッチします。<code
                    class="literal">s+</code> は 1 つかそれ以上の連続する <code
                    class="literal">s</code> 文字にマッチします) を表現します。丸括弧を使うことで検索結果のグループ化が可能です。
				</div><div
                  class="para">
					正規表現の正確な構文は正規表現を取り扱うツールに依存しますが、基本的な機能は似ています。<div
                    xmlns=""
                    class="url">→ <a
                      xmlns="http://www.w3.org/1999/xhtml"
                      href="http://en.wikipedia.org/wiki/Regular_expression">http://en.wikipedia.org/wiki/Regular_expression</a></div>
				</div></div><div
                class="para">
					最初の正規表現は電子メールソフトウェアに関するヘッダを確認します。そして <code
                  class="literal">GOTO Sarbacane</code> (大量の電子メールを送信するソフトウェア) が見つかったら、メッセージを拒否します。2 番目の正規表現はメッセージの件名を操作します。そしてメッセージの件名にウイルス通知が含まれる場合、そのメッセージを拒否しない代わりにすぐに捨てます。
				</div><div
                class="para">
					これらのフィルタを使うことは諸刃の剣です。なぜなら、一般的過ぎるルールを設定すれば結果的に適切なメールを失うことになるからです。そのような場合、メッセージが失われるだけでなく、送信者は望まない (そして煩い) エラーメッセージを受け取ることになるでしょう。
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.setting-up-greylisting"></a>11.1.4. <span
                      class="foreignphrase"><em
                        class="foreignphrase">greylisting</em></span> の設定</h3></div></div></div><a
              id="id-1.14.4.10.2"
              class="indexterm"></a><div
              class="para">
				「greylisting」はフィルタリング技術です。「greylisting」を使うことで、最初にメッセージを一時的なエラーコードとともに拒否し、少しの遅延の後に何回か試行すれば許可するというような挙動が可能です。「greylisting」は特にワームとウイルスに侵された数多くのマシンが送信するスパムに対して効果的です。なぜなら、ワームやウイルスは完全な SMTP エージェントとして振る舞うことはほとんどない (エラーコードを確認して失敗したメッセージを後から再試行することはほとんどない) ですし、特に収集されたアドレスのほとんどは実際のところ無価値なアドレスであるという点を考慮すると、再試行は時間の無駄にしかならないからです。
			</div><div
              class="para">
				Postfix それ自身は greylisting 機能を提供しませんが、あるメッセージを受け入れるか拒否するかの決定を外部プログラムに委任する機能を提供します。<span
                class="pkg pkg">postgrey</span> パッケージには greylisting 機能を提供するプログラムが含まれ、このプログラムはアクセスポリシー委任サービスへのインターフェースとして設計されています。
			</div><div
              class="para">
				<span
                class="pkg pkg">postgrey</span> がインストールされると、<code
                class="command">postgrey</code> はデーモンとして実行され、ポート 10023 番をリッスンします。この後 Postfix の設定に <code
                class="literal">check_policy_service</code> ルールを追加することで、Postfix は <code
                class="command">postgrey</code> デーモンを使うようになります。
			</div><pre
              class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks,
    [...]
    check_policy_service inet:127.0.0.1:10023</pre><div
              class="para">
				Postfix はルールセットの中にあるこのルールに到達したら、<code
                class="command">postgrey</code> デーモンに接続し、対応するメッセージに関する情報をデーモンに送信します。Postgrey は IP アドレス/送信者/受信者の三つぞろいを考慮し、同じ三つぞろいが最近データベースに登録されたか否かをデータベースで確認します。最近登録されていた場合、Postgrey はメッセージを受け入れるべきであると応答します。さらに、最近登録されていなかった場合、Postgrey はメッセージを一時的に拒否するべきであると応答し、三つぞろいをデータベースに登録します。
			</div><div
              class="para">
				greylisting の主な不都合は正当なメッセージの配送が遅れる点です。この欠点が許容できない場合もあります。さらに、送信するメールのほとんどが正当な場合、greylisting はサーバの負荷を増加させます。
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>IN PRACTICE</em></span> greylisting の欠点</strong></p></div></div></div><div
                class="para">
				理論上 greylisting はある送信者からある受信者に送信される最初のメールだけを対象にしており、greylisting による典型的な遅延時間はほぼ数分程度です。しかしながら、実際は少し違います。一部の大きな ISP は複数の SMTP サーバを運用します。このようなサーバ群からメッセージを送信することを考えます。1 回目の送信要求を出すサーバはその送信要求を拒否されますが、2 回目の送信要求を出すサーバは 1 回目のサーバと違う可能性があります。これが起きた場合、2 回目の送信要求を出すサーバは greylisting のおかげでもう一度一時的なエラーメッセージを受け取ります。同様に、3 回目の送信要求を出すサーバが既に受信側の greylisting データベースに登録済みのサーバに一致するのには数時間かかる可能性があります。なぜなら、通常 SMTP サーバは再試行が失敗した場合に遅延時間を増やすからです。
			</div><div
                class="para">
				その結果、同じ送信者からであっても送信要求を行う IP アドレスは毎回変わるかもしれません。もっと言えば、送信者アドレスさえも変わる可能性があります。たとえば、多くのメーリングリストサーバはエラーメッセージ (<span
                  class="emphasis"><em>bounce</em></span> として知られます) を取り扱うために送信者アドレス内の追加的な情報を符号化します。メーリングリスト宛に送信される新しいメッセージは greylisting を通過することが必要かもしれません。これは新しいメッセージが送信者のサーバに (一時的に) 保存されることを意味します。とても巨大な (数万人が登録する) メーリングリストの場合、これは問題になることがあります。
			</div><div
                class="para">
				これらの欠点を軽減するために、Postgrey は複数の SMTP サーバを運用するサイトのホワイトリストを管理しています。ホワイトリストに登録されている送信者から送信要求のあったメッセージは greylisting を通過することなしにすぐに受け入れられます。このリストを自分の要求に適用することは簡単です。なぜなら、ホワイトリストは <code
                  class="filename">/etc/postgrey/whitelist_clients</code> ファイルに保存されているからです。
			</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>GOING FURTHER</em></span> <span
                          class="pkg pkg">milter-greylist</span> を使った選択的 greylisting</strong></p></div></div></div><div
                class="para">
				メール配送の遅延時間が長くなるという greylisting の欠点を低減するには、既にスパムの発生源と考えられている (DNS ブラックリストに載せられている) サブネットのクライアントだけを対象に greylisting を使います。<span
                  class="pkg pkg">postgrey</span> ではこの機能を使うことができませんが、<span
                  class="pkg pkg">milter-greylist</span> でこの機能を使います。
			</div><div
                class="para">
				この機能を利用する場合、DNS ブラックリストに載っていたからと言って必ず拒否されるわけではなくなるので、より広範囲におよぶブラックリスト (たとえば <code
                  class="literal">pbl.spamhaus.org</code> や <code
                  class="literal">dul.dnsbl.sorbs.net</code> など) を使うことが妥当です。そのようなブラックリストには、ISP クライアントからのすべての動的 IP アドレスも含まれます。
			</div><div
                class="para">
				milter-greylist は Sendmail の milter インターフェースを使うため、postfix 側からは「<code
                  class="literal">smtpd_milters = unix:/var/run/milter-greylist/milter-greylist.sock</code>」と設定する以上のことができません。<span
                  class="citerefentry"><span
                    class="refentrytitle">greylist.conf</span>(5)</span> マニュアルページには、<code
                  class="filename">/etc/milter-greylist/greylist.conf</code> と milter-greylist を設定するさまざまな方法が書かれています。実際にサービスを有効化するにはさらに <code
                  class="filename">/etc/default/milter-greylist</code> を編集する必要があるでしょう。
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.14.4.11"></a>11.1.5. 受信者アドレスに基づくフィルタのカスタマイズ</h3></div></div></div><div
              class="para">
				<a
                class="xref"
                href="network-services.html#sect.restrictions-for-receiving-and-sending">第 11.1.3 節「受信と送信の制限」</a>と<a
                class="xref"
                href="network-services.html#sect.setting-up-greylisting">第 11.1.4 節「<span
                  class="foreignphrase"><em
                    class="foreignphrase">greylisting</em></span> の設定」</a>では、さまざまな制限方法を見直しました。これらの制限方法はスパムの受信量を減らすためのものですが、欠点もあります。このため、受信者ごとにフィルタのセットをカスタマイズすることが普通のやり方になりつつあります。Falcot Corp では、greylisting は多くのユーザからすると興味深いものですが、電子メールを素早く受け取りたい一部のユーザ (たとえば技術サポートサービスを担当しているユーザ) からすると仕事の妨げになります。同様に、商業サービス担当からするとブラックリストに載っているかもしれない一部のアジアプロバイダから送信された電子メールを受信できない点は問題となります。従って、商業サービス用のアドレスに対してはフィルタリングを行わず、この種の送信者と連絡が取れるようにするほうが好都合でしょう。
			</div><div
              class="para">
				Postfix は「制限クラス」の概念を使ってフィルタをカスタマイズします。制限クラスは <code
                class="literal">smtpd_restriction_classes</code> パラメータの中で宣言され、<code
                class="literal">smtpd_recipient_restrictions</code> と同じやり方で使用されます。<code
                class="literal">check_recipient_access</code> 指示文は与えられた受信者と制限の適切なセットを対応付けるテーブルを定義します。
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.11.4"></a><p
                class="title"><strong>例 11.13 <code
                    class="filename">main.cf</code> における制限クラスの定義</strong></p><div
                class="example-contents"><pre
                  class="programlisting">smtpd_restriction_classes = greylisting, aggressive, permissive

greylisting = check_policy_service inet:127.0.0.1:10023
aggressive = reject_rbl_client sbl-xbl.spamhaus.org,
        check_policy_service inet:127.0.0.1:10023
permissive = permit

smtpd_recipient_restrictions = permit_mynetworks,
        reject_unauth_destination,
        check_recipient_access hash:/etc/postfix/recipient_access</pre></div></div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.11.5"></a><p
                class="title"><strong>例 11.14 <code
                    class="filename">/etc/postfix/recipient_access</code> ファイル</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# 無制限に受信するアドレス
postmaster@falcot.com  permissive
support@falcot.com     permissive
sales-asia@falcot.com  permissive

# 特権ユーザに対する積極的なフィルタリング
joe@falcot.com         aggressive

# メーリングリスト管理者用の特別なルール
sympa@falcot.com       reject_unverified_sender

# デフォルトの greylisting 設定
falcot.com             greylisting</pre></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.postfix-antivirus"></a>11.1.6. アンチウイルスの統合</h3></div></div></div><a
              id="id-1.14.4.12.2"
              class="indexterm"></a><div
              class="para">
				数多くのウイルスが電子メールの添付ファイルとして配布されているため、会社のネットワークの入口にアンチウイルスをセットアップすることは重要です。なぜなら、啓発活動にも関わらず、明らかに疑わしいメッセージの添付ファイルを開けてしまうユーザがいるからです。
			</div><div
              class="para">
				Falcot の管理者は自由なアンチウイルスとして <code
                class="command">clamav</code> を選びました。<code
                class="command">clamav</code> の主パッケージは <span
                class="pkg pkg">clamav</span> ですが、<span
                class="pkg pkg">arj</span>、<span
                class="pkg pkg">unzoo</span>、<span
                class="pkg pkg">unrar</span>、<span
                class="pkg pkg">lha</span> などのいくつかのパッケージを追加でインストールしました。なぜなら、これらのパッケージはアンチウイルスがそれらのフォーマットで圧縮された添付ファイルを解析する際に必要だからです。
			</div><a
              id="id-1.14.4.12.5"
              class="indexterm"></a><a
              id="id-1.14.4.12.6"
              class="indexterm"></a><div
              class="para">
				<code
                class="command">clamav-milter</code> はアンチウイルスと電子メールサーバのやり取りを仲介する作業を担当します。<span
                class="emphasis"><em>milter</em></span> (<span
                class="emphasis"><em>mail filter</em></span> の略) は電子メールサーバに対するインターフェースとして特別に設計されたフィルタプログラムです。milter は標準的なアプリケーションプログラミングインターフェース (API) を使います。API を使うことで電子メールサーバの外にあるフィルタを使うよりも性能が向上します。milter は 最初 <span
                class="emphasis"><em>Sendmail</em></span> に導入されましたが、すぐ後に <span
                class="emphasis"><em>Postfix</em></span> にも導入されました。
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>QUICK LOOK</em></span> SpamAssassin 用の milter</strong></p></div></div></div><a
                id="id-1.14.4.12.8.2"
                class="indexterm"></a><div
                class="para">
				<span
                  class="pkg pkg">spamass-milter</span> パッケージは有名な迷惑メール検出ソフトウェアである <span
                  class="emphasis"><em>SpamAssassin</em></span> に基づく milter を提供します。これは、(ヘッダを追加することで) スパムと思われるメッセージを注意するために使うことが可能です。さらにスパム度のスコアが指定されたしきい値を超えたらメッセージを拒否することも可能です。
			</div></div><div
              class="para">
				<span
                class="pkg pkg">clamav-milter</span> パッケージをインストールしたら、milter をデフォルトのポートではない適当な TCP ポートで実行するように再設定するべきです。これを行うには、<code
                class="command">dpkg-reconfigure clamav-milter</code> を実行します。そして「Sendmail とのコミュニケーションインターフェイス」が表示されたら「<code
                class="literal">inet:10002@127.0.0.1</code>」と答えます。
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>NOTE</em></span> 真の TCP ポート vs 名前付きソケット</strong></p></div></div></div><div
                class="para">
				名前付きソケットではなく実在する TCP ポートを使う理由は、postfix デーモンは chroot された状態で実行されることが多く、その場合名前付きソケットの存在するディレクトリにアクセスできないからです。名前付きソケットを使い、これを chroot 中 (<code
                  class="filename">/var/spool/postfix/</code>) に入れておくことも可能です。
			</div></div><div
              class="para">
				ClamAV の標準的な設定は多くの状況に適合しますが、<code
                class="command">dpkg-reconfigure clamav-base</code> を使えばいくつかの重要なパラメータをカスタマイズすることも可能です。
			</div><div
              class="para">
				最後の段階で、最近設定したフィルタを使うように Postfix を設定します。これは <code
                class="filename">/etc/postfix/main.cf</code> に以下の指示文を追加するだけで簡単に設定できます。
			</div><pre
              class="programlisting">
# clamav-milter を使ったウイルスチェック
smtpd_milters = inet:[127.0.0.1]:10002</pre><div
              class="para">
				アンチウイルスによって問題が起こる場合、この行をコメントアウトして <code
                class="command">service postfix reload</code> を実行します。こうすることでアンチウイルスが無効化されます。
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>IN PRACTICE</em></span> アンチウイルスのテスト</strong></p></div></div></div><div
                class="para">
				アンチウイルスをセットアップしたら、正常な挙動をテストするべきです。最も簡単にテストするには、<code
                  class="filename">eicar.com</code> (または <code
                  class="filename">eicar.com.zip</code>) を添付したテストメールを送信します。このファイルはオンラインからダウンロードできます。<div
                  xmlns=""
                  class="url">→ <a
                    xmlns="http://www.w3.org/1999/xhtml"
                    href="http://www.eicar.org/86-0-Intended-use.html">http://www.eicar.org/86-0-Intended-use.html</a></div>
			</div><div
                class="para">
				このファイルは、本物のウイルスではなくテストファイルです。市場に出ているすべてのアンチウイルスソフトウェアはこのファイルをウイルスと判定しますから、これを使うことでインストールの正しさを確認できます。
			</div></div><div
              class="para">
				これで Postfix を介して送信されるすべてのメッセージはアンチウイルスフィルタを通過するようになります。
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.authenticated-smtp"></a>11.1.7. SMTP 認証</h3></div></div></div><div
              class="para">
				電子メールを送信するには SMTP サーバにアクセスできなければいけません。さらに、電子メールを送信するには上で設定した SMTP サーバが必要です。ローミングユーザの場合、SMTP クライアントの設定を定期的に変更する必要があるかもしれません。なぜなら、Falcot の SMTP サーバは明らかに会社に所属しない IP アドレスから受け取ったメッセージを拒否するからです。これに対して 2 つの解決策が存在します。すなわち、ローミングユーザが自分のコンピュータに SMTP サーバをインストールするか、雇用者としての認証を済ませた後に会社のサーバを使うかのどちらか一方です。自分の SMTP サーバをインストールするという解決策は推奨されません。なぜなら、ローミングユーザのコンピュータは永久的にネットワークに接続されているわけではありませんし、問題の起きた際にメッセージを再送信することができないからです。ここでは認証を行うという解決策に注目します。
			</div><div
              class="para">
				Postfix の SMTP 認証は SASL (<span
                class="emphasis"><em>Simple Authentication and Security Layer</em></span>) を使っています。SASL を使うには、<span
                class="pkg pkg">libsasl2-modules</span> と <span
                class="pkg pkg">sasl2-bin</span> パッケージをインストールして、SASL データベースに SMTP サーバの認証に必要なパスワードをユーザごとに登録する必要があります。パスワードを登録するには、<code
                class="command">saslpasswd2</code> コマンドを使います。<code
                class="command">saslpasswd2</code> コマンドはいくつかのパラメータを取ります。<code
                class="literal">-u</code> オプションは認証するドメインを定義します。これは Postfix 設定の <code
                class="literal">smtpd_sasl_local_domain</code> パラメータと一致しなければいけません。<code
                class="literal">-c</code> オプションはユーザを作成します。<code
                class="literal">-f</code> オプションは SASL データベースをデフォルト (<code
                class="filename">/etc/sasldb2</code>) とは異なる場所に保存することが必要な場合にデータベースファイルの位置を指定します。
			</div><pre
              class="screen scale">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>saslpasswd2 -u `postconf -h myhostname` -f /var/spool/postfix/etc/sasldb2 -c jean</code></strong>
<code
                class="computeroutput">[... jean のパスワードを 2 回入力します ...]</code></pre><div
              class="para">
				SASL データベースは Postfix のディレクトリの中に作成されなければいけない点に注意してください。整合性を確保するために、<code
                class="command">ln -sf /var/spool/postfix/etc/sasldb2 /etc/sasldb2</code> コマンドを使って <code
                class="filename">/etc/sasldb2</code> を Postfix の使うデータベースを指すシンボリックリンクにします。
			</div><div
              class="para">
				この後に Postfix が SASL を使うように設定します。<code
                class="literal">postfix</code> ユーザを <code
                class="literal">sasl</code> グループに追加して、SASL アカウントデータベースにアクセスできるようにします。Postfix で SASL を有効化するには、いくつかの新しいパラメータが必要です。また、SASL 認証されたクライアントが自由に電子メールを送信することを許可するには、<code
                class="literal">smtpd_recipient_restrictions</code> パラメータを設定します。
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.13.7"></a><p
                class="title"><strong>例 11.15 <code
                    class="filename">/etc/postfix/main.cf</code> の中で SASL を有効化</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# SASL 認証を有効化します
smtpd_sasl_auth_enable = yes
# SASL 認証を適用するドメインを定義します
smtpd_sasl_local_domain = $myhostname
[...]
# reject_unauth_destination の前に permit_sasl_authenticated を
# 追加すれば、SASL 認証済みユーザが送信したメールの中継が許可されます
smtpd_recipient_restrictions = permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination,
[...]</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>EXTRA</em></span> 認証済み SMTP クライアント</strong></p></div></div></div><div
                class="para">
				多くの電子メールクライアントはメッセージを送信する前に SMTP サーバに対して認証依頼する機能を持っており、適切なパラメータを設定するだけで簡単に SASL 認証機能を使うことが可能です。クライアントが SASL 認証機能を持たない場合、ローカル Postfix サーバを使い、リモート SMTP サーバに電子メールを中継するようにローカル Postfix サーバを設定することが次善策です。この場合、ローカル Postfix が SASL を使って認証するクライアントになります。以下に必要なパラメータを示します。
			</div><pre
                class="programlisting">
smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
relay_host = [mail.falcot.com]</pre><div
                class="para">
				<code
                  class="filename">/etc/postfix/sasl_passwd</code> ファイルには、<code
                  class="literal">mail.falcot.com</code> サーバに認証を依頼する際に使うユーザ名とパスワードを含めます。以下に例を示します。
			</div><pre
                class="programlisting">
[mail.falcot.com]   joe:LyinIsji</pre><div
                class="para">
				すべての Postfix のマッピングファイルについて言えることですが、<code
                  class="command">postmap</code> コマンドを使ってこのファイルを <code
                  class="filename">/etc/postfix/sasl_passwd.db</code> に変換しなければいけません。
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>戻る</strong>10.8. ネットワーク診断ツール</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>次へ</strong>11.2. ウェブサーバ (HTTP)</a></li></ul></body></html>
