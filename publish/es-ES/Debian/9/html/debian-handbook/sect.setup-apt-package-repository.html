<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">15.3. Creación de un repositorio de paquetes para APT</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-es-ES-1.0-1" /><meta
        name="keywords"
        content="Retroadaptación, Recompilación, Paquete fuente, Repositorio, Metapaquete, Desarrollador Debian, Responsable" /><link
        rel="home"
        href="index.html"
        title="El manual del Administrador de Debian" /><link
        rel="up"
        href="debian-packaging.html"
        title="Capítulo 15. Creación de un paquete Debian" /><link
        rel="prev"
        href="sect.building-first-package.html"
        title="15.2. Creación de su primer paquete" /><link
        rel="next"
        href="sect.becoming-package-maintainer.html"
        title="15.4. Cómo convertirse en un encargado de paquetes" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/es-ES/stable/sect.setup-apt-package-repository.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.building-first-package.html"><strong>Anterior</strong></a></li><li
          class="home">El manual del Administrador de Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.becoming-package-maintainer.html"><strong>Siguiente</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.setup-apt-package-repository"></a>15.3. Creación de un repositorio de paquetes para APT</h2></div></div></div><a
          id="id-1.18.6.2"
          class="indexterm"></a><a
          id="id-1.18.6.3"
          class="indexterm"></a><div
          class="para">
			Falcot Corp gradualmente comenzó a mantener una cantidad de paquetes Debian con modificaciones locales de paquetes existentes o creados desde cero para distribuir datos y programas internos.
		</div><div
          class="para">
			Para facilitar su despliegue, desean integrarlos en un repositorio de paquetes que APT pueda utilizar directamente. Por razones de mantenimiento obvias, desean separar los paquetes internos de aquellos recompilados localmente. El objetivo es que los elementos correspondientes del archivo <code
            class="filename">/etc/apt/sources.list.d/falcot.list</code> sean los siguientes:
		</div><pre
          class="programlisting">
deb http://packages.falcot.com/ updates/
deb http://packages.falcot.com/ internal/</pre><a
          id="id-1.18.6.7"
          class="indexterm"></a><div
          class="para">
			Por lo tanto, los administradores configuraron un servidor virtual en su servidor HTTP interno, con <code
            class="filename">/srv/vhosts/packages/</code> como raíz del espacio web asociado. Delegaron la gestión del repositorio en sí al programa <code
            class="command">mini-dinstall</code> (en el paquete del mismo nombre). Esta herramienta revisa el directorio <code
            class="filename">incoming/</code> (en nuestro caso: <code
            class="filename">/srv/vhosts/packages/mini-dinstall/incoming</code>) y espera allí a los nuevos paquetes; cuando se sube un paquete, lo instala en un repositorio en <code
            class="filename">/srv/hosts/packages/</code>. El programa <code
            class="command">mini-dinstall</code> lee el archivo <code
            class="filename">*.changes</code> creado cuando se genera el paquete Debian. Estos archivos contienen una lista de todos los otros archivos asociados con la versión del paquete (<code
            class="filename">*.deb</code>, <code
            class="filename">*.dsc</code>, <code
            class="filename">*.diff.gz</code>/<code
            class="filename">*.debian.tar.gz</code>, <code
            class="filename">*.orig.tar.gz</code> o sus equivalentes con otras herramientas de compresión) que le permiten a <code
            class="command">mini-dinstall</code> saber qué archivos instalar. Los archivos <code
            class="filename">*.changes</code> también contienen el nombre de la distribución objetivo (generalmente <code
            class="literal">unstable</code>) mencionada en el último campo de la entrada en <code
            class="filename">debian/changelog</code> y <code
            class="command">mini-dinstall</code> utiliza esta información para decidir dónde instalar el paquete. Es por esto que los administradores siempre deben cambiar este campo antes de compilar un paquete y definirlo como <code
            class="literal">internal</code> o <code
            class="literal">updates</code>, dependiendo de la ubicación objetivo. <code
            class="command">mini-dinstall</code> generará luego los archivos necesarios para APT, como <code
            class="filename">Packages.gz</code>.
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>ALTERNATIVA</em></span> <code
                      class="command">apt-ftparchive</code></strong></p></div></div></div><a
            id="id-1.18.6.9.2"
            class="indexterm"></a><div
            class="para">
			Si <code
              class="command">mini-dinstall</code> le parece demasiado complejo para sus necesidades de repositorios Debian, también puede utilizar el programa <code
              class="command">apt-ftparchive</code>. Esta herramienta explora el contenido de un directorio y muestra (por su salida estándar) el archivo <code
              class="filename">Packages</code> correspondiente. En el caso de Falcot Corp, los administradores pueden subir sus paquetes directamente a <code
              class="filename">/srv/vhosts/packages/updates/</code> o <code
              class="filename">/srv/vhosts/packages/internal/</code> y luego ejecutar lo siguiente para crear los archivos <code
              class="filename">Pacakges.gz</code>:
		</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>cd /srv/vhosts/packages</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>apt-ftparchive packages updates &gt;updates/Packages</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>gzip updates/Packages</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>apt-ftparchive packages internal &gt;internal/Packages</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>gzip internal/Packages</code></strong></pre><div
            class="para">
			Ejecutar <code
              class="command">apt-ftparchive sources</code> permite crear archivos <code
              class="filename">Sources.gz</code> de forma similar.
		</div></div><div
          class="para">
			La configuración de <code
            class="command">mini-dinstall</code> necesita definir un archivo <code
            class="filename">~/.mini-dinstall.conf</code>; en el caso de Falcot Corp, su contenido es el siguiente:
		</div><pre
          class="programlisting">
[DEFAULT]
archive_style = flat
archivedir = /srv/vhosts/packages

verify_sigs = 0
mail_to = admin@falcot.com

generate_release = 1
release_origin = Falcot Corp
release_codename = stable

[updates]
release_label = Paquetes Debian Recompilados

[internal]
release_label = Paquetes Internos</pre><div
          class="para">
			Una decisión importante es la generación de archivos <code
            class="filename">Release</code> para cada repositorio. Esto puede ayudar a gestionar las prioridades de instalación utilizando el archivo de configuración <code
            class="filename">/etc/apt/preferences</code> (revise el <a
            class="xref"
            href="sect.apt-get.html#sect.apt.priorities">Sección 6.2.5, “Gestión de prioridades de los paquetes”</a> para más detalles).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>SEGURIDAD</em></span> <code
                      class="command">mini-dinstall</code> y permisos</strong></p></div></div></div><div
            class="para">
			Debido a que se diseñó a <code
              class="command">mini-dinstall</code> para ejecutar como un usuario normal, no es necesario ejecutarlo como root. La forma más sencilla es configurar todo en la cuenta de usuario que pertenezca al administrador encargado de crear los paquetes Debian. Debido a que sólo este administrador tiene los permisos necesarios para guardar archivos en el directorio <code
              class="filename">incoming/</code> podemos deducir que éste autenticó el origen de cada paquetes antes de desplegarlo y <code
              class="command">mini-dinstall</code> no necesita hacerlo nuevamente. Esto explica el parámetros <code
              class="literal">verify_sigs = 0</code> (que significa que no se necesita verificar firmas). Sin embargo, si el contenido del paquete es sensible, podemos revertir esta configuración y seleccionar autenticar con un conjunto de llaves que contenga aquellas de las personas que tienen permitido crear paquetes (configurado con el parámetro <code
              class="literal">extra_keyrings</code>); <code
              class="command">mini-dinstall</code> luego verificará el origen de cada paquete entrante analizando la firma integrada en el archivo <code
              class="filename">*.changes</code>.
		</div></div><div
          class="para">
			Ejecutar <code
            class="command">mini-dinstall</code> en realidad inicia un demonio en segundo plano. Mientras ejecute el demonio, revisará el directorio <code
            class="filename">incoming/</code> por nuevos paquetes cada media hora; cuando detecte un nuevo paquete lo moverá al repositorio y generará los archivos <code
            class="filename">Packages.gz</code> y <code
            class="filename">Sources.gz</code>. Si ejecutar un demonio es un problema, también puede invocar manualmente <code
            class="command">mini-dinstall</code> en modo de lote (con la opción <code
            class="literal">-b</code>) cada vez que suba un paquete al directorio <code
            class="filename">incoming/</code>. <code
            class="command">mini-dinstall</code> permite otras posibilidades documentadas en su página de manual <span
            class="citerefentry"><span
              class="refentrytitle">mini-dinstall</span>(1)</span>.
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>EXTRA</em></span> Generación de un repositorio firmado</strong></p></div></div></div><div
            class="para">
			La suite APT verifica una cadena de firmas criptográficas en los paquetes que gestiona antes de instalarlos para asegurar su autenticidad (ver <a
              class="xref"
              href="sect.package-authentication.html">Sección 6.5, “Comprobación de la autenticidad de un paquete”</a>). Por lo tanto, los repositorios APT privados pueden ser un problema, ya que los equipos que los utilicen mostrarán advertencias sobre paquetes sin firmar. Por lo tanto, un administrador diligente integrará los archivos privados con el mecanismo de seguridad de APT.
		</div><div
            class="para">
			Para ayudar con este proceso, <code
              class="command">mini-dinstall</code> incluye la opción de configuración <code
              class="literal">release_signscript</code> que permite especificar un script a utilizar para generar la firma. Un buen punto de partida es el script <code
              class="filename">sign-release.sh</code>, provisto por el paquete <span
              class="pkg pkg">mini-dinstall</span>, en el directorio <code
              class="filename">/usr/share/doc/mini-dinstall/examples/</code>; puede necesitar cambios locales.
		</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.building-first-package.html"><strong>Anterior</strong>15.2. Creación de su primer paquete</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Subir</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Inicio</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.becoming-package-maintainer.html"><strong>Siguiente</strong>15.4. Cómo convertirse en un encargado de paquetes</a></li></ul></body></html>
