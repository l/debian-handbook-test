<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">14.2. Firewall o el filtrado de paquetes</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-es-ES-1.0-1" /><meta
        name="keywords"
        content="Firewall, Netfilter, IDS/NIDS" /><link
        rel="home"
        href="index.html"
        title="El manual del Administrador de Debian" /><link
        rel="up"
        href="security.html"
        title="Capítulo 14. Seguridad" /><link
        rel="prev"
        href="security.html"
        title="Capítulo 14. Seguridad" /><link
        rel="next"
        href="sect.supervision.html"
        title="14.3. Supervisión: prevención, detección, disuasión" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/es-ES/stable/sect.firewall-packet-filtering.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>Anterior</strong></a></li><li
          class="home">El manual del Administrador de Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>Siguiente</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.firewall-packet-filtering"></a>14.2. Firewall o el filtrado de paquetes</h2></div></div></div><a
          id="id-1.17.5.2"
          class="indexterm"></a><a
          id="id-1.17.5.3"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>VOLVER A LOS CIMIENTOS</em></span> Firewall</strong></p></div></div></div><a
            id="id-1.17.5.4.2"
            class="indexterm"></a><div
            class="para">
			Un <span
              class="emphasis"><em>firewall</em></span> es una pieza de equipo de cómputo con hardware y/o software que ordena los paquetes entrantes o salientes de la red (que vienen hacia o desde una red local) y sólo permite el paso de aquellos que coinciden con ciertas condiciones predefinidas.
		</div></div><div
          class="para">
			Un firewall es una puerta de enlace de la red con filtro y sólo es eficaz en aquellos paquetes que deben pasar a través de ella. Por lo tanto, sólo puede ser eficaz cuando la única ruta para estos paquetes es a través del firewall.
		</div><div
          class="para">
			La falta de una configuración estándar (y el lema «proceso, no producto») explica la falta de una solución preconfigurada. Hay, sin embargo, herramientas que facilitan la configuración del firewall <span
            class="emphasis"><em>netfilter</em></span>, con una representación gráfica de las reglas de filtrado. <code
            class="command">fwbuilder</code> es sin duda uno de los mejores de ellos.
		</div><a
          id="id-1.17.5.7"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>CASO ESPECÍFICO</em></span> Firewall local</strong></p></div></div></div><div
            class="para">
			Puede restringir un firewall a una máquina en particular (a diferencia de una red completa), en cuyo caso su función es filtrar o limitar el acceso a algunos servicios, o posiblemente evitar las conexiones de salida de software ilegítimo que un usuario podría, voluntariamente o no, haber instalado.
		</div></div><div
          class="para">
			El núcleo Linux incorpora el firewall <span
            class="emphasis"><em>netfilter</em></span>. Puede controlarlo desde el espacio de usuario con los programas <code
            class="command">iptables</code> e <code
            class="command">ip6tables</code>. La diferencia entre estos dos programas es que el primero actúa sobre la red IPv4, mientras que el segundo actúa sobre IPv6. Debido a que ambas pilas de protocolos de red probablemente continuarán con nosotors durante muchos años, ambas herramientas son necesarias y deberán ser utilizadas en paralelo.
		</div><a
          id="id-1.17.5.10"
          class="indexterm"></a><a
          id="id-1.17.5.11"
          class="indexterm"></a><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.netfilter"></a>14.2.1. Comportamiento de netfilter</h3></div></div></div><div
            class="para">
				<span
              class="emphasis"><em>netfilter</em></span> utiliza cuatro tablas distintas que almacenan las reglas que regulan tres tipos de operaciones sobre los paquetes:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">filter</code> se refiere a las reglas de filtrado (aceptar, rechazar o ignorar un paquete);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">nat</code> se refiere a la traducción de las direcciones de origen o destino y puertos de los paquetes;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">mangle</code> se refiere a otros cambios en los paquetes IP (incluyendo el campo ToS — <span
                    class="emphasis"><em>tipo de servicio</em></span>: «Type of Service» — y opciones);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">raw</code> permite otras modificaciones manuales en los paquetes antes de que lleguen al sistema de seguimiento de conexiones.
					</div></li></ul></div><div
            class="para">
				Cada tabla contiene listas de reglas llamadas <span
              class="emphasis"><em>cadenas</em></span>. El firewall utiliza cadenas estándar para manejar paquetes en función de circunstancias predefinidas. El administrador puede crear otras cadenas, que sólo se utilizarán cuando una cadena estándar haga referencia a ellas (ya sea directa o indirectamente).
			</div><a
            id="id-1.17.5.12.5"
            class="indexterm"></a><a
            id="id-1.17.5.12.6"
            class="indexterm"></a><div
            class="para">
				La tabla <code
              class="literal">filter</code> tiene tres cadenas estándar:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">INPUT</code>: se refiere a paquetes cuyo destino es el propio firewall;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">OUTPUT</code>: se refiere a los paquetes que emite el firewall;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">FORWARD</code>: se refiere a los paquetes que transitan a través del firewall (que no es ni su origen ni su destino).
					</div></li></ul></div><div
            class="para">
				La tabla <code
              class="literal">nat</code> también tiene tres cadenas estándar:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">PREROUTING</code>: para modificar los paquetes tan pronto como llegan;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">POSTROUTING</code>: para modificar los paquetes cuando están listos para seguir su camino;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">OUTPUT</code>: para modificar los paquetes generados por el propio firewall.
					</div></li></ul></div><div
            class="figure"><a
              xmlns=""
              id="figure.chaines-netfilter"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/netfilter.png"
                  alt="Cómo llamar a las cadenas de netfilter" /></div></div><p
              class="title"><strong>Figura 14.1. Cómo llamar a las cadenas de <span
                  class="emphasis"><em>netfilter</em></span></strong></p></div><div
            class="para">
				Cada cadena es una lista de reglas, cada regla es un conjunto de condiciones y una acción que se ejecutará cuando se cumplan las condiciones. Cuando se procesa un paquete, el firewall examina la cadena apropiada, una regla tras otra; cuando se cumplen las condiciones de una regla «salta» (de ahí la opción <code
              class="literal">-j</code> en las órdenes) a la acción especificada para continuar el procesamiento. Los comportamientos más comunes están estandarizados y existen acciones dedicadas para ellos. Tomar una de estas acciones estándar interrumpe el procesamiento de la cadena ya que el destino del paquete ya está sellado (salvo una excepción que se menciona a continuación):
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>VOLVER A LOS CIMIENTOS</em></span> ICMP</strong></p></div></div></div><div
              class="para">
				ICMP (<span
                class="emphasis"><em>protocolo de mensajes de control de internet</em></span>: «Internet Control Message Protocol») es el protocolo utilizado para transmitir información complementaria en las comunicaciones. Permite probar la conectividad de red con el programa <code
                class="command">ping</code> (el cual envía un mensaje ICMP de <span
                class="emphasis"><em>petición de eco</em></span> — «echo request» — al que el destinatario debería responder con un mensaje ICMP de <span
                class="emphasis"><em>respuesta de eco</em></span> — «echo reply»). Señala a un firewall rechazando un paquete, indica un desbordamiento en un búfer de recepción, propone una mejor ruta para los paquetes siguientes de la conexión y así sucesivamente. Se definió este protocolo en varios documentos RFC: inicialmente RFC777 y RFC792 que fueron completados y extendidos a la brevedad. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc777.html">http://www.faqs.org/rfcs/rfc777.html</a></div> <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc792.html">http://www.faqs.org/rfcs/rfc792.html</a></div>
			</div><div
              class="para">
				A modo de referencia, un búfer de recepción es una pequeña zona de memoria que almacena datos entre el momento que llegan desde la red y el momento en que éstos son gestionados por el núcleo. Si esta zona está llena, no se pueden recibir nuevos datos e ICMP señalará el problema para que el emisor puede ralentizar su velocidad de transferencia (que idealmente debería alcanzar un equilibrio después de algún tiempo).
			</div><a
              id="id-1.17.5.12.13.4"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.5"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.6"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.7"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.8"
              class="indexterm"></a><div
              class="para">
				Tenga en cuenta que aunque una red IPv4 puede trabajar sin ICMP, ICMPv6 es estrictamente necesario para una red IPv6 ya que combina varias funciones que, en el mundo IPv4, se encontraban distribuidas entre ICMPv4, IGMP (<span
                class="emphasis"><em>protocolo de membresía de grupo de internet</em></span>: «Internet Group Membership Protocol») y ARP (<span
                class="emphasis"><em>protocolo de resolución de direcciones</em></span>: «Address Resolution Protocol»). ICMPv6 está definido en RFC4443. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc4443.html">http://www.faqs.org/rfcs/rfc4443.html</a></div>
			</div></div><div
            class="para">
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ACCEPT</code>: permitir al paquete seguir su camino;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">REJECT</code>: rechazar el paquete con un paquete de error ICMP (la opcion <code
                    class="literal">--reject-with <em
                      class="replaceable">tipo</em></code> de <code
                    class="command">iptables</code> permite seleccionar el tipo de error);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DROP</code>: borrar (ignorar) el paquete;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">LOG</code>: registrar (a través de <code
                    class="command">syslogd</code>) un mensaje con una descripción del paquete; tenga en cuenta que esta acción no interrumpe el procesamiento y la ejecución de la cadena continúa con la regla siguiente, razón por la que registrar los paquetes rechazados necesita una regla LOG y una regla REJECT/DROP;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ULOG</code>: registrar un mensaje a través de <code
                    class="command">ulogd</code>, que puede adaptarse mejor y más eficientemente que <code
                    class="command">syslogd</code> para manejar de grandes cantidades de mensajes; tenga en cuenta que esta acción, al igual que LOG, también continúa el procesamiento de la siguiente regla en la cadena que la llamó;
					</div></li><li
                class="listitem"><div
                  class="para">
						<em
                    class="replaceable">nombre_de_cadena</em>: saltar a la cadena dada y evaluar sus reglas;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">RETURN</code>: interrumpir el procesamiento de la cadena actual y regresar a la cadena que la llamó; en el caso de que la cadena actual sea una estándar no hay cadena que la haya llamado, por lo que en su lugar se ejecutará la acción predeterminada (definida con la opción <code
                    class="literal">-P</code> de <code
                    class="command">iptables</code>);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SNAT</code> (unicamente en la tabla <code
                    class="literal">nat</code>: aplicar <span
                    class="emphasis"><em>NAT de origen</em></span> (las opciones adicionales describen los cambios exactos que se aplicarán);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DNAT</code> (unicamente en la tabla <code
                    class="literal">nat</code>): aplicar <span
                    class="emphasis"><em>NAT de destino</em></span> (las opciones adicionales describen los cambios exactos que se aplicarán);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">MASQUERADE</code> (unicamente en la tabla <code
                    class="literal">nat</code>: aplicar <span
                    class="emphasis"><em>enmascaramiento</em></span> (un caso especial de <span
                    class="emphasis"><em>NAT de origen</em></span>);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">REDIRECT</code> (unicamente en la tabla <code
                    class="literal">nat</code>: redirigir un paquete a un puerto determinado del mismo firewall, puede utilizar esto para configurar un proxy web transparente que funciona sin ninguna configuración en el lado del cliente, dado que el cliente piensa que se conecta con el destinatario mientras que las comunicaciones realmente pasan por el proxy.
					</div></li></ul></div><div
            class="para">
				Otras acciones, en particular las relativas a la tabla <code
              class="literal">mangle</code>, están fuera del alcance de este texto. Podrá encontrar una lista completa en <span
              class="citerefentry"><span
                class="refentrytitle">iptables</span>(8)</span> y <span
              class="citerefentry"><span
                class="refentrytitle">ip6tables</span>(8)</span>.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.iptables"></a>14.2.2. Sintaxis de <code
                    class="command">iptables</code> e <code
                    class="command">ip6tables</code></h3></div></div></div><div
            class="para">
				Los programas <code
              class="command">iptables</code> e <code
              class="command">ip6tables</code> permiten manipular las tablas, cadenas y reglas. Su opción <code
              class="literal">-t <em
                class="replaceable">tabla</em></code> indica en qué tabla operar (la tabla <code
              class="literal">filter</code> de forma predeterminada).
			</div><a
            id="id-1.17.5.13.3"
            class="indexterm"></a><a
            id="id-1.17.5.13.4"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.iptables-command"></a>14.2.2.1. Órdenes</h4></div></div></div><div
              class="para">
					La opción <code
                class="literal">-N <em
                  class="replaceable">cadena</em></code> crea una nueva cadena. La opción <code
                class="literal">-X <em
                  class="replaceable">cadena</em></code> elimina una cadena vacía y sin uso. La opción <code
                class="literal">-A <em
                  class="replaceable">cadena</em> <em
                  class="replaceable">regla</em></code> añade una regla al final de la cadena dada. La opción <code
                class="literal">-I <em
                  class="replaceable">cadena</em> <em
                  class="replaceable">número_regla</em> <em
                  class="replaceable">regla</em></code> inserta una regla antes de la regla con número <em
                class="replaceable">número_regla</em>. La opción <code
                class="literal">-D <em
                  class="replaceable">cadena</em> <em
                  class="replaceable">número_regla</em></code> (o <code
                class="literal">-D <em
                  class="replaceable">cadena</em> <em
                  class="replaceable">regla</em></code>) elimina una regla en una cadena, la primera sintaxis identifica la regla que se desea eliminar por su número, mientras que la segunda la identifica por su contenido. La opción <code
                class="literal">-F <em
                  class="replaceable">cadena</em></code> vacía una cadena (borra todas sus reglas), si no menciona ninguna cadena, eliminará todas las reglas de la tabla. La opción <code
                class="literal">-L <em
                  class="replaceable">cadena</em></code> muestra las reglas de la cadena. Por último, la opción <code
                class="literal">-P <em
                  class="replaceable">cadena</em> <em
                  class="replaceable">acción</em></code> define la acción predeterminada o «política» para una cadena dada; tenga en cuenta que sólo las cadenas estándar puede tener dicha política.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.iptables-rules"></a>14.2.2.2. Reglas</h4></div></div></div><a
              id="id-1.17.5.13.6.2"
              class="indexterm"></a><div
              class="para">
					Cada regla es expresada como <code
                class="literal"><em
                  class="replaceable">condiciones</em> -j <em
                  class="replaceable">acción</em> <em
                  class="replaceable">opciones_acción</em></code>. Si describe varias condiciones en la misma regla, entonces el criterio es la conjunción (<span
                class="emphasis"><em>y</em></span> lógico) de las condiciones, que son al menos tan restrictivas como cada condición individual.
				</div><div
              class="para">
					La condición <code
                class="literal">-p <em
                  class="replaceable">protocolo</em></code> coincide con el campo de protocolo del paquete IP. Los valores más comunes son <code
                class="literal">tcp</code>, <code
                class="literal">udp</code>, <code
                class="literal">icmp</code> e <code
                class="literal">icmpv6</code>. Anteponer la condición con un signo de exclamación niega la condición, la cual se coincidirá con «todos los paquetes con un protocolo distinto al especificado». Este mecanismo de negación no es específico de la opción <code
                class="literal">-p</code> y se puede aplicar a todas las otras condiciones también.
				</div><div
              class="para">
					La condición <code
                class="literal">-s <em
                  class="replaceable">dirección</em></code> o <code
                class="literal">-s <em
                  class="replaceable">red/máscara</em></code> coincide con la dirección de origen del paquete. Correspondientemente, <code
                class="literal">-d <em
                  class="replaceable">dirección</em></code> o <code
                class="literal">-d<em
                  class="replaceable">red/máscara</em></code> coincide con la dirección de destino.
				</div><div
              class="para">
					La condición <code
                class="literal">-i <em
                  class="replaceable">interfaz</em></code> selecciona los paquetes procedentes de la interfaz de red dada. <code
                class="literal">-o <em
                  class="replaceable">interfaz</em></code> selecciona los paquetes que salen a través de una interfaz específica.
				</div><div
              class="para">
					Hay condiciones más específicas, dependiendo de las condiciones genéricas descriptas anteriormente. Por ejemplo, puede completementar la condición <code
                class="literal">-p tcp</code> con condiciones sobre los puertos TCP, cláusulas como <code
                class="literal">--source-port <em
                  class="replaceable">puerto</em></code> y <code
                class="literal">--destination-port <em
                  class="replaceable">puerto</em></code>.
				</div><div
              class="para">
					La condición <code
                class="literal">--state <em
                  class="replaceable">estado</em></code> coincide con el estado de un paquete en una conexión (necesitará el modulo de núcleo <code
                class="command">ipt_conntrack</code> para el seguimiento de conexiones). El estado <code
                class="literal">NEW</code> describe un paquete que inicia una nueva conexión; <code
                class="literal">ESTABLISHED</code> coincide con paquetes pertenecientes a una conexión ya existente y <code
                class="literal">RELATED</code> coincide con paquetes iniciando una nueva conexión relacionada con una ya existente (lo cual es útil para las conexiones <code
                class="literal">ftp-data</code> en el modo «activo» del protocolo FTP).
				</div><div
              class="para">
					En la sección anterior se enumeran las acciones disponibles, pero no sus opciones respectivas. Por ejemplo, la acción <code
                class="literal">LOG</code> tiene las siguientes opciones:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-priority</code>, con un valor predeterminado de <code
                      class="literal">warning</code>, indica la severidad de los mensajes <code
                      class="command">syslog</code>;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-prefix</code> permite especificar un prefijo de texto para diferenciar los mensajes registrados;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-tcp-sequence</code>, <code
                      class="literal">--log-tcp-options</code> y <code
                      class="literal">--log-ip-options</code> indican datos adicionales que se integrarán en el mensaje: el número de secuencia TCP, opciones TCP y las opciones IP, respectivamente.
						</div></li></ul></div><div
              class="para">
					La acción <code
                class="literal">DNAT</code> ofrece la opción <code
                class="literal">--to-destination <em
                  class="replaceable"> dirección</em>:<em
                  class="replaceable">puerto</em></code> para indicar la nueva dirección IP y/o puerto de destino. De manera similar, <code
                class="literal">SNAT</code> proporciona <code
                class="literal">--to-source <em
                  class="replaceable">dirección</em>:<em
                  class="replaceable">puerto</em></code> para indicar la nueva dirección IP y/o puerto de origen.
				</div><div
              class="para">
					La acción <code
                class="literal">REDIRECT</code> (sólo disponible is NAT está dispnible) ofrece la opción <code
                class="literal">--to-ports <em
                  class="replaceable">puerto(s)</em></code> para indicar el puerto o rango de puertos al que debe redirigir los paquetes.
				</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.creating-rules"></a>14.2.3. Creación de reglas</h3></div></div></div><div
            class="para">
				Cada creación de una regla requiere una invocación de <code
              class="command">iptables</code>/<code
              class="command">ip6tables</code>. Escribir estas órdenes de forma manual puede ser tedioso, por lo que las llamadas se suelen almacenar en un script para definir la misma configuración automáticamente cada vez que arranque la máquina. Puede escribir este script a mano, pero también puede ser interesante prepararlo con una herramienta de alto nivel como <code
              class="command">fwbuilder</code>.
			</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>apt install fwbuilder</code></strong></pre><div
            class="para">
				El principio es simple. En el primer paso, es necesario describir todos los elementos que intervendrán en las reglas:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						el propio firewall, con sus interfaces de red;
					</div></li><li
                class="listitem"><div
                  class="para">
						las redes, con sus rangos de direcciones IP correspondientes;
					</div></li><li
                class="listitem"><div
                  class="para">
						los servidores;
					</div></li><li
                class="listitem"><div
                  class="para">
						los puertos pertenecientes a los servicios alojados en los servidores.
					</div></li></ul></div><div
            class="para">
				Luego puede crear las reglas simplemente arrastrando y soltando acciones en los objetos. Unos cuantos menús contextuales pueden cambiar la condición (negarla, por ejemplo). A continuación, deberá elegir la acción y configurarla.
			</div><div
            class="para">
				En cuanto a IPv6, puede crear dos conjuntos de reglas diferentes para IPv4 e IPv6, o crear sólo una y dejar que <code
              class="command">fwbuilder</code> traduzca las reglas según las direcciones asignadas a los objetos.
			</div><div
            class="figure"><a
              xmlns=""
              id="figure.fwbuilder"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/fwbuilder.png"
                  alt="Ventana principal de fwbuilder" /></div></div><p
              class="title"><strong>Figura 14.2. Ventana principal de fwbuilder</strong></p></div><a
            id="id-1.17.5.14.9"
            class="indexterm"></a><div
            class="para">
				Luego <code
              class="command">fwbuilder</code> puede generar un script de configuración del firewall según las reglas que definió. Su arquitectura modular le da la capacidad para generar scripts dirigidos a diferentes sistemas (<code
              class="command">iptables</code> para Linux, <code
              class="command">ipf</code> para FreeBSD y <code
              class="command">pf</code> para OpenBSD).
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.install-rules-at-boot"></a>14.2.4. Instalación de las reglas en cada arranque</h3></div></div></div><div
            class="para">
				En otros casos, la forma recomendada es registrar el script de configuración en una directiva <code
              class="literal">up</code> del archivo <code
              class="filename">/etc/network/interfaces</code>. En el siguiente ejemplo, el script está guardado como <code
              class="filename">/usr/local/etc/arrakis.fw</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="example.network-interfaces-firewall"></a><p
              class="title"><strong>Ejemplo 14.1. archivo <code
                  class="filename">interfaces</code> llamando al script del firewall</strong></p><div
              class="example-contents"><pre
                class="programlisting">auto eth0
iface eth0 inet static
    address 192.168.0.1
    network 192.168.0.0
    netmask 255.255.255.0
    broadcast 192.168.0.255
    up /usr/local/etc/arrakis.fw</pre></div></div><div
            class="para">
				Esto obviamente asume que se está utilizando <span
              class="pkg pkg">ifupdown</span> para configurar las interfaces de red. Si se está utilizando alguna otra cosa (como <span
              class="emphasis"><em>NetworkManager</em></span> o <span
              class="emphasis"><em>systemd-networkd</em></span>), entonces se debe consultar la documentación respectiva para averiguar cómo ejecutar un script después de que se levante la interfaz de red.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>Anterior</strong>Capítulo 14. Seguridad</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Subir</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Inicio</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>Siguiente</strong>14.3. Supervisión: prevención, detección, disuasi...</a></li></ul></body></html>
