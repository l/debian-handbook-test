<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">9.11. اتصال سریع: hotplug</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-fa-IR-1.0-1" /><meta
        name="keywords"
        content="راه‌اندازی سیستم, اسکریپت‌های init, SSH, Telnet, حقوق, مجوزها, نظارت, Inetd, Cron, پشتیبان‌گیری, Hotplug, PCMCIA, APM, ACPI" /><link
        rel="home"
        href="index.html"
        title="راهنمای دبیان برای مدیر سیستم‌ها" /><link
        rel="up"
        href="unix-services.html"
        title="فصل 9. سرویس‌های یونیکس" /><link
        rel="prev"
        href="sect.backup.html"
        title="9.10. پشتیبان‌گیری" /><link
        rel="next"
        href="sect.power-management.html"
        title="9.12. مدیریت نیرو؛ پیکربندی پیشرفته و رابط کار با نیرو (ACPI)" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/fa-IR/stable/sect.hotplug.html" /></head><body
      dir="rtl"><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.backup.html"><strong>قبلی</strong></a></li><li
          class="home">راهنمای دبیان برای مدیر سیستم‌ها</li><li
          class="next"><a
            accesskey="n"
            href="sect.power-management.html"><strong>بعدی</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.hotplug"></a>9.11. اتصال سریع: <span
                  class="emphasis"><em>hotplug</em></span></h2></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.12.14.2"></a>9.11.1. مقدمه</h3></div></div></div><div
            class="para">
				زیرسیستم <span
              class="emphasis"><em>hotplug</em></span> از کرنل به صورت پویا اضافه و حذف شدن دستگاه‌ها را مدیریت می‌کند، با بارگیری درایورهای مناسب و ایجاد فایل‌های مخصوص به هر دستگاه (با کمک دستور <code
              class="command">udevd</code>). با وجود سخت‌افزار جدید و عملیات مجازی‌سازی، تقریبا هر چیزی قابلیت اتصال سریع را دارد: از دستگاه‌های متداول USB/PCMCIA/IEEE 1394 گرفته تا هارد درایوهای SATA، همچنین پردازنده و حافظه اصلی.
			</div><div
            class="para">
				کرنل شامل پایگاه‌داده‌ای است که هر شناسه دستگاه را به درایور مخصوص به آن ثبت می‌کند. این پایگاه‌داده در زمان راه‌اندازی اولیه به منظور بارگیری تمام درایورهای مورد نیاز برای دستگاه‌های شناخته شده در خطوط ارتباطی مختلف استفاده می‌شود، همچنین در زمانی که یک دستگاه جانبی به سیستم متصل می‌گردد. زمانی که دستگاه آماده استفاده باشد یک پیام به <code
              class="command">udevd</code> ارسال می‌شود تا فایل مورد نظر دستگاه در <code
              class="filename">/dev/</code> را ایجاد کند.
			</div><a
            id="id-1.12.14.2.4"
            class="indexterm"></a><a
            id="id-1.12.14.2.5"
            class="indexterm"></a><a
            id="id-1.12.14.2.6"
            class="indexterm"></a><a
            id="id-1.12.14.2.7"
            class="indexterm"></a><a
            id="id-1.12.14.2.8"
            class="indexterm"></a><a
            id="id-1.12.14.2.9"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.12.14.3"></a>9.11.2. مشکل نامگذاری</h3></div></div></div><div
            class="para">
				قبل از ظهور قابلیت اتصال، انتساب یک نام ثابت به یک دستگاه کار ساده‌ای بود. اینکار بر اساس موقعیت دستگاه‌ها روی گذرگاه سیستم انجام می‌شد. اما این امکان برای دستگاه‌هایی که روی این گذرگاه وارد و خارج می‌شوند وجود ندارد. مورد متداول هم کاربرد دوربین دیجیتال و حافظه جانبی USB است، که هر دو در رایانه به عنوان هارد درایو ظاهر می‌شوند. اولی به نام <code
              class="filename">/dev/sdb</code> و دومی به نام <code
              class="filename">/dev/sdc</code> (به همراه <code
              class="filename">/dev/sda</code> که نام هارد درایو اصلی رایانه است). نام دستگاه ثابت نیست؛ در حقیقت به ترتیبی که دستگاه‌ها متصل می‌شوند ارتباط دارد.
			</div><div
            class="para">
				علاوه بر این، درایورهای بیشتری از شماره‌گذاری ماژور/مینور دستگاه‌ها استفاده می‌کنند که امکان نامگذاری ثابت دستگاه‌ها را از بین می‌برد چرا که این خصوصیات ضروری در هر مرتبه راه‌اندازی سیستم از بین می‌روند.
			</div><div
            class="para">
				<span
              class="emphasis"><em>udev</em></span> دقیقا به منظور حل این مشکل ایجاد شد.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.12.14.4"></a>9.11.3. چگونگی کارکرد <span
                    class="emphasis"><em>udev</em></span></h3></div></div></div><div
            class="para">
				زمانی که کرنل <span
              class="emphasis"><em>udev</em></span> را از وجود یک دستگاه جدید آگاه می‌کند، این برنامه به جمع‌آوری اطلاعات مختلف در رابطه با دستگاه از طریق <code
              class="filename">/sys/</code> می‌پردازد، به خصوص اطلاعاتی که منجر به شناسایی دستگاه می‌شوند (نشانی MAC برای یک کارت شبکه، شماره سریال برخی دستگاه‌های USB و از این قبیل).
			</div><div
            class="para">
				هنگامی که این اطلاعت بدست آمد، <span
              class="emphasis"><em>udev</em></span> به مجموعه قواعد موجود در <code
              class="filename">/etc/udev/rules.d/</code> و <code
              class="filename">/lib/udev/rules.d/</code> مراجعه می‌کند. در این فرآیند تصمیم می‌گیرد که چه نامی به دستگاه اختصاص دهد، از چه پیوندهای نمادین برای ایجاد کردنش استفاده کند (برای اختصاص نام مستعار) و چه دستوراتی را اجرا کند. تمام این فایل‌ها مورد بررسی قرار می‌گیرند و قواعد موجود در آن‌ها به ترتیب ارزیابی می‌گردند (بجز حالتی که یک فایل از عبارت “GOTO” استفاده کند). پس، ممکن است چندین قاعده درباره یک رخداد بررسی شوند.
			</div><div
            class="para">
				شیوه نگارش این قواعد تقریبا ساده است: هر سطر شامل شرایط انتخاب و انتساب متغیرها است. اولی برای انتخاب رویدادها جهت پاسخ دادن و دومی اقدام مورد نظر در پاسخ به آن رویداد است. تمام این قواعد با کاما از یکدیگر جدا شده‌اند و عملگر بین شرایط انتخاب (با عملگرهای مقایسه‌ای، مانند <code
              class="literal">==</code> یا <code
              class="literal">!=</code>) یا شرایط انتساب (با عملگرهایی نظیر <code
              class="literal">=</code>، <code
              class="literal">+=</code> یا <code
              class="literal">:=</code>) تفاوت قائل می‌شود.
			</div><div
            class="para">
				عملگرهای مقایسه‌ای روی متغیرهای زیر اعمال می‌شوند:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">KERNEL</code>: نامی که کرنل به دستگاه اختصاص داده است؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ACTION</code>: پاسخ متناظر به رویداد (“add” زمانی که دستگاه اضافه شده یا “remove” زمانی که دستگاه حذف شده باشد)؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DEVPATH</code>: مسیر دستگاه در ساختار <code
                    class="filename">/sys/</code>؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SUBSYSTEM</code>: زیرسیستم کرنل که درخواست را ایجاد کرده است (گزینه‌های زیادی وجود دارند اما برخی عبارتند از “usb”، “ide”، “net”، “firmware”، و از این قبیل);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ATTR{<em
                      class="replaceable">attribute</em>}</code>: محتوای فایل <em
                    class="replaceable">attribute</em> در دایرکتوری <code
                    class="filename">/sys/<em
                      class="replaceable">$devpath</em>/</code> دستگاه. اینجاست که می‌توانید نشانی MAC و سایر شناسه‌های مخصوص گذرگاه را پیدا کنید.
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">KERNELS</code>، <code
                    class="literal">SUBSYSTEMS</code> و <code
                    class="literal">ATTRS{<em
                      class="replaceable">attributes</em>}</code> انواع گوناگونی هستند که تلاش دارند گزینه‌های مختلف در رابطه با دستگاه‌های والد با دستگاه فعلی را سازگار سازند.
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">PROGRAM</code>: نماینده آزمون برای برنامه مشخص شده است (در صورت بازگرداندن ۰ برابر با true، در غیر اینصورت false). محتوای خروحی استاندارد برنامه ذخیره می‌شود تا توسط آزمون <code
                    class="literal">RESULT</code> قابل استفاده باشد.
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">RESULT</code>: آزمون‌های مورد نظر را روی خروجی استاندارد ذخیره شده از آخرین فراخوانی <code
                    class="literal">PROGRAM</code> اجرا می‌کند.
					</div></li></ul></div><div
            class="para">
				عملگر سمت راست می‌تواند به شیوه‌ای استفاده شود که امکان انتخاب چند مقدار در یک لحظه را داشته باشد. برای نمونه، <code
              class="literal">*</code> هر رشته‌ای را شامل می‌شود (حتی رشته خالی)؛ <code
              class="literal">?</code> هر کاراکتری را شامل می‌شود و <code
              class="literal">[]</code> مجموعه از کاراکترهای محدود را شامل می‌شود (یا خلاف آن، در صورتی که اولین کاراکتر برابر با ! باشد و بازه پیوسته کاراکترها به صورت <code
              class="literal">a-z</code> بیان شود).
			</div><div
            class="para">
				با توجه به عملگرهای انتسابی، <code
              class="literal">=</code> یک مقدار را نسبت می‌دهد (که جایگزین مقدار فعلی می‌شود)؛ در مورد یک فهرست، خالی می‌شود و تنها مقدار انتسابی را شامل می‌گردد. <code
              class="literal">:=</code> نیز همین کار را کرده، اما از تغییرات بعدی آن متغیر جلوگیری می‌کند. همینطور <code
              class="literal">+=</code> که یک گزینه به فهرست اضافه می‌کند. متغیرهای زیر می‌توانند تغییر کنند:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">NAME</code>: نام دستگاه که در مسیر <code
                    class="filename">/dev/</code> ایجاد می‌شود. تنها اولین انتساب به حساب می‌آید؛ باقی انتساب‌ها نادیده گرفته می‌شوند؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SYMLINK</code>: فهرستی از پیوندهای نمادین که به یک دستگاه اشاره می‌کنند؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">Owner</code>، <code
                    class="literal">Group</code> و <code
                    class="literal">MODE</code> کاربر و گروه و مجوزهای مورد نیاز دستگاه را تعریف می‌کنند؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">RUN</code>: فهرست برنامه‌هایی که در پاسخ به این رویداد باید اجرا شوند.
					</div></li></ul></div><div
            class="para">
				مقدارهای انتسابی به این متغیرها می‌توانند از جایگزین‌های زیر استفاده کنند:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">$kernel</code> یا <code
                    class="literal">%k</code>: معادل با <code
                    class="literal">KERNEL</code>؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">$number</code> یا <code
                    class="literal">%n</code>: شماره ترتیبی برای دستگاه، برای نمونه در <code
                    class="literal">sda3</code> برابر با “3”؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">$devpath</code> یا <code
                    class="literal">%p</code>: معادل با <code
                    class="literal">DEVPATH</code>؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">$attr{<em
                      class="replaceable">attribute</em>}</code> یا <code
                    class="literal">%s{<em
                      class="replaceable">attribute</em>}</code>: معادل با <code
                    class="literal">ATTRS{<em
                      class="replaceable">attribute</em>}</code>؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">$major</code> یا <code
                    class="literal">%M</code>: شماره ماژور کرنل برای دستگاه؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">$minor</code> یا <code
                    class="literal">%m</code>: شماره مینور کرنل برای دستگاه؛
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">$result</code> یا <code
                    class="literal">%c</code>: رشته خروجی آخرین برنامه‌ای که توسط <code
                    class="literal">PROGRAM</code> فراخوانی شده است؛
					</div></li><li
                class="listitem"><div
                  class="para">
						و در نهایت، <code
                    class="literal">%%</code> و <code
                    class="literal">$$</code> برای علامت‌های درصد و دلار.
					</div></li></ul></div><div
            class="para">
				فهرست بالا کامل نیست (تنها شامل مهم‌ترین پارامترها است)، اما صفحه راهنمای <span
              class="citerefentry"><span
                class="refentrytitle">udev</span>(7)</span> تمام پارامترها را شامل می‌شود.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.12.14.5"></a>9.11.4. یک مثال کامل</h3></div></div></div><div
            class="para">
				بیایید یک حافظه جانبی USB را در نظر بگیریم که می‌خواهیم نامی ثابت برایش ایجاد کنیم. ابتدا، باید شیوه‌ای برای شناسایی منحصربفرد آن بیابید. به این منظور، دستگاه را متصل کرده و دستور <code
              class="command">udevadm info -a -n /dev/sdc</code> را اجرا کنید (<em
              class="replaceable">/dev/sdc</em> را با نام انتسابی به دستگاه جایگزین کنید).
			</div><pre
            class="screen"><code
              class="computeroutput"># </code><strong
              class="userinput"><code>udevadm info -a -n /dev/sdc</code></strong>
<code
              class="computeroutput">[...]
  looking at device '/devices/pci0000:00/0000:00:10.3/usb1/1-2/1-2.2/1-2.2:1.0/host9/target9:0:0/9:0:0:0/block/sdc':
    KERNEL=="sdc"
    SUBSYSTEM=="block"
    DRIVER==""
    ATTR{range}=="16"
    ATTR{ext_range}=="256"
    ATTR{removable}=="1"
    ATTR{ro}=="0"
    ATTR{size}=="126976"
    ATTR{alignment_offset}=="0"
    ATTR{capability}=="53"
    ATTR{stat}=="      51      100     1208      256        0        0        0        0        0      192      25        6"
    ATTR{inflight}=="       0        0"
[...]
  looking at parent device '/devices/pci0000:00/0000:00:10.3/usb1/1-2/1-2.2/1-2.2:1.0/host9/target9:0:0/9:0:0:0':
    KERNELS=="9:0:0:0"
    SUBSYSTEMS=="scsi"
    DRIVERS=="sd"
    ATTRS{device_blocked}=="0"
    ATTRS{type}=="0"
    ATTRS{scsi_level}=="3"
    ATTRS{vendor}=="I0MEGA  "
    ATTRS{model}=="UMni64MB*IOM2C4 "
    ATTRS{rev}=="    "
    ATTRS{state}=="running"
[...]
    ATTRS{max_sectors}=="240"
[...]
  looking at parent device '/devices/pci0000:00/0000:00:10.3/usb1/1-2/1-2.2':
    KERNELS=="9:0:0:0"
    SUBSYSTEMS=="usb"
    DRIVERS=="usb"
    ATTRS{configuration}=="iCfg"
    ATTRS{bNumInterfaces}==" 1"
    ATTRS{bConfigurationValue}=="1"
    ATTRS{bmAttributes}=="80"
    ATTRS{bMaxPower}=="100mA"
    ATTRS{urbnum}=="398"
    ATTRS{idVendor}=="4146"
    ATTRS{idProduct}=="4146"
    ATTRS{bcdDevice}=="0100"
[...]
    ATTRS{manufacturer}=="USB Disk"
    ATTRS{product}=="USB Mass Storage Device"
    ATTRS{serial}=="M004021000001"
[...]
</code></pre><div
            class="para">
				برای ایجاد یک قانون جدید، می‌توانید از آزمون‌های روی متغیرهای دستگاه استفاده کنید، یا هر یک از دستگاه‌های والد آن. مورد بالا به ما اجازه ایجاد دو قانون به صورت زیر را می‌دهد:
			</div><pre
            class="programlisting">KERNEL=="sd?", SUBSYSTEM=="block", ATTRS{serial}=="M004021000001", SYMLINK+="usb_key/disk"
KERNEL=="sd?[0-9]", SUBSYSTEM=="block", ATTRS{serial}=="M004021000001", SYMLINK+="usb_key/part%n"</pre><div
            class="para">
				زمانی که این قوانین در یک فایل تنظیم شوند، برای نمونه <code
              class="filename">/etc/udev/rules.d/010_local.rules</code>، به سادگی می‌توانید حافظه را جدا کرده و از نو نصب کنید. مشاهده خواهید کرد که <code
              class="filename">/dev/usb_key/disk</code> نشان‌دهنده حافظه USB و <code
              class="filename">/dev/usb_key/part1</code> نشان‌دهنده اولین پارتیشن آن است.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>مطالعه بیشتر</em></span> اشکال‌زدایی پیکربندی <span
                        class="emphasis"><em>udev</em></span></strong></p></div></div></div><div
              class="para">
				مانند بسیاری فرآیندهای پس‌زمینه، <code
                class="command">udevd</code> نیز گزارش‌های خود را در <code
                class="filename">/var/log/daemon.log</code> ذخیره می‌کند. اما به صورت پیش‌فرض خیلی خوانا نیستند و برای درک شرایط موجود به کار نمی‌آیند. دستور <code
                class="command">udevadm control --log-priority=info</code> سطح جزئیات را بالا برده و این مشکل را حل می‌کند. <code
                class="command">udevadm control --log-priority=err</code> نیز به حالت پیش‌فرض باز می‌گردد.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.backup.html"><strong>قبلی</strong>9.10. پشتیبان‌گیری</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>بالا</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>خانه</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.power-management.html"><strong>بعدی</strong>9.12. مدیریت نیرو؛ پیکربندی پیشرفته و رابط کار با...</a></li></ul></body></html>
