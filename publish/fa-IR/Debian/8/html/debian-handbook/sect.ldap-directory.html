<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.7. دایرکتوی LDAP</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-fa-IR-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="راهنمای جامع دبیان" /><link
        rel="up"
        href="network-services.html"
        title="فصل 11. سرویس‌های شبکه: Postfix، Apache، NFS، Samba، Squid، LDAP، SIP، XMPP، Turn" /><link
        rel="prev"
        href="sect.http-ftp-proxy.html"
        title="11.6. پروکسی HTTP/FTP" /><link
        rel="next"
        href="sect.rtc-services.html"
        title="11.8. سرویس‌های ارتباطی بلادرنگ" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/fa-IR/stable/sect.ldap-directory.html" /></head><body
      dir="rtl"><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.http-ftp-proxy.html"><strong>قبلی</strong></a></li><li
          class="home">راهنمای جامع دبیان</li><li
          class="next"><a
            accesskey="n"
            href="sect.rtc-services.html"><strong>بعدی</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.ldap-directory"></a>11.7. دایرکتوی LDAP</h2></div></div></div><a
          id="id-1.14.10.2"
          class="indexterm"></a><a
          id="id-1.14.10.3"
          class="indexterm"></a><a
          id="id-1.14.10.4"
          class="indexterm"></a><div
          class="para">
			OpenLDAP یکی از پیاده‌سازی‌های پروتکل LDAP است؛ به عبارت دیگر، یک پایگاه‌داده به خصوص برای ذخیره‌سازی دایرکتوری‌ها. در متداول‌ترین کاربرد آن، استفاده از یک سرور LDAP اجازه متمرکزسازی مدیریت حساب‌های کاربری و مجوزهای مربوط به آن‌ها را می‌دهد. علاوه بر این، یک پایگاه‌داده LDAP به سادگی قابل تکثیر است، که امکان برپایی چندین سرور LDAP به صورت متقارن را فراهم می‌آورد. زمانی که شبکه و کاربران آن به سرعت رشد می‌کنند، عملکرد می‌تواند بین چندین سرور مختلف تقسیم شود.
		</div><div
          class="para">
			داده LDAP ساخت‌یافته و سلسله‌مراتبی است. ساختار آن با توجه به “schema” تعریف می‌شود که انواع گوناگون اشیا قابل ذخیره‌سازی توسط پایگاه‌داده را مشخص می‌کند، به همراه فهرستی از تمام ویژگی‌های آن‌ها. شیوه نگارش یک شی خاص در این پایگاه‌داده مبتنی بر ساختار آن است، که همین امر باعث پیچیدگی آن می‌شود.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.10.7"></a>11.7.1. نصب</h3></div></div></div><div
            class="para">
				بسته <span
              class="pkg pkg">slapd</span> شامل سرور OpenLDAP است. بسته <span
              class="pkg pkg">ldap-utils</span> نیز ابزار خط-فرمان مورد نیاز برای تعامل با سرورهای LDAP را شامل می‌شود.
			</div><a
            id="id-1.14.10.7.3"
            class="indexterm"></a><div
            class="para">
				هنگام نصب <span
              class="pkg pkg">slapd</span> معمولا پرسش‌های کمی مطرح می‌شود که این امر باعث می‌شود پایگاه‌داده نهایی برای نیاز شما مناسب نباشد. خوشبختانه با استفاده از <code
              class="command">dpkg-reconfigure slapd</code> می‌توانید پایگاه‌داده LDAP را با جزئیات بیشتری تنظیم کنید.
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						پیکربندی سرور OpenLDAP را نادیده گرفته‌اید؟ البته که نه، ما قصد پیکربندی آن را داریم.
					</div></li><li
                class="listitem"><div
                  class="para">
						نام دامنه DNS: “<code
                    class="literal">falcot.com</code>”.
					</div></li><li
                class="listitem"><div
                  class="para">
						نام سازمانی: “Falcot Corp”.
					</div></li><li
                class="listitem"><div
                  class="para">
						یک گذرواژه مدیریتی باید وارد شود.
					</div></li><li
                class="listitem"><div
                  class="para">
						پایگاه‌داده‌ای که از آن استفاده می‌شود: “MDB”.
					</div></li><li
                class="listitem"><div
                  class="para">
						می‌خواهید در زمان حذف کامل <span
                    class="pkg pkg">slapd</span> پایگاه‌داده آن نیز حذف گردد؟ نه، دلیلی برای به خطر انداختن داده‌ها در صورت بروز اشتباه وجود ندارد.
					</div></li><li
                class="listitem"><div
                  class="para">
						پایگاه‌داده قدیمی جابجا شود؟ این پرسش زمانی مطرح می‌شود که یک پایگاه‌داده دیگر موجود باشد. فقط زمانی که می‌خواهید از دوباره شروع کنید به آن پاسخ مثبت بدهید. برای نمونه، اگر پس از نصب اولیه دستور <code
                    class="command">dpkg-reconfigure slapd</code> را اجرا کنید.
					</div></li><li
                class="listitem"><div
                  class="para">
						اجازه استفاده از پروتکل LDAPv2؟ نه، دلیلی برای اینکار وجود ندارد. تمام ابزاری که قصد استفاده آن‌ها را داریم با پروتکل LDAPv3 سازگار هستند.
					</div></li></ul></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>بازگشت به مقدمات</em></span> قالب LDIF</strong></p></div></div></div><div
              class="para">
				یک فایل LDIF یا <span
                class="emphasis"><em>LDAP Data Interchange Format</em></span> یک فایل متنی پرتابل است که محتوای پایگاه‌داده LDAP را توضیح می‌دهد (یا قسمتی از آن را)؛ از این فایل می‌توان برای ورود داده به هر سرور LDAP دیگر استفاده کرد.
			</div><a
              id="id-1.14.10.7.6.3"
              class="indexterm"></a></div><div
            class="para">
				یک پایگاه‌داده حداقلی با استفاده از پرس و جوهای زیر تعریف شده است:
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>ldapsearch -x -b dc=falcot,dc=com</code></strong>
<code
              class="computeroutput"># extended LDIF
#
# LDAPv3
# base &lt;dc=falcot,dc=com&gt; with scope sub
# filter: (objectclass=*)
# requesting: ALL
#

# falcot.com
dn: dc=falcot,dc=com
objectClass: top
objectClass: dcObject
objectClass: organization
o: Falcot Corp
dc: falcot

# admin, falcot.com
dn: cn=admin,dc=falcot,dc=com
objectClass: simpleSecurityObject
objectClass: organizationalRole
cn: admin
description: LDAP administrator

# search result
search: 2
result: 0 Success

# numResponses: 3
# numEntries: 2
</code></pre><div
            class="para">
				پرس و جو دو شی را باز می‌گرداند: خود سازمان و کاربر مدیریتی آن.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.10.8"></a>11.7.2. پرکردن دایرکتوری</h3></div></div></div><div
            class="para">
				از آنجا که یک پایگاه‌داده خالی به هیچ دردی نمی‌خورد، قصد داریم کاربران، گروه‌ها، سرویس‌ها و پایگاه‌داده‌های میزبان را در آن وارد کنیم.
			</div><div
            class="para">
				بسته <span
              class="pkg pkg">migrationtools</span> شامل چندین اسکریپت برای استخراج داده از دایکتوری‌های استاندارد یونیکس (<code
              class="filename">/etc/passwd</code>، <code
              class="filename">/etc/group</code>، <code
              class="filename">/etc/services</code> و <code
              class="filename">/etc/hosts</code>) می‌شود که با تبدیل آن‌ها، قابلیت ذخیره‌سازی در پایگاه‌داده LDAP را فراهم می‌کند.
			</div><a
            id="id-1.14.10.8.4"
            class="indexterm"></a><div
            class="para">
				زمانی که بسته نصب شد، فایل <code
              class="filename">/etc/migrationtools/migrate_common.ph</code> باید ویرایش شود؛ گزینه‌های <code
              class="varname">IGNORE_UID_BELOW</code> و <code
              class="varname">IGNORE_GID_BELOW</code> باید فعال (با حذف توضیحات قبل از خود) و گزینه <code
              class="varname">DEFAULT_MAIL_DOMAIN</code>/<code
              class="varname">DEFAULT_BASE</code> باید بروزرسانی گردد.
			</div><div
            class="para">
				عملیات واقعی مهاجرت توسط دستور <code
              class="command">migrate_all_online.sh</code> به صورت زیر اجرا می‌شود:
			</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>cd /usr/share/migrationtools</code></strong>
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>LDAPADD="/usr/bin/ldapadd -c" ETC_ALIASES=/dev/null ./migrate_all_online.sh</code></strong></pre><div
            class="para">
				دستور <code
              class="command">migrate_all_online.sh</code> درباره پایگاه‌داده LDAP که قرار است داده به داخل آن وارد شود چندین پرسش مطرح می‌کند. قسمت <a
              class="xref"
              href="sect.ldap-directory.html#tab-migrate-all">
      جدول 11.1</a> به بررسی پاسخ‌های مطرح شده در مورد شرکت فالکوت می‌پردازد.
			</div><div
            class="table"><a
              xmlns=""
              id="tab-migrate-all"></a><p
              class="title"><strong>
      جدول 11.1. پاسخ به پرسش‌های مطرح شده توسط اسکریپت <code
                  class="command">migrate_all_online.sh</code></strong></p><div
              class="table-contents"><table
                xmlns:d="http://docbook.org/ns/docbook"
                class="lt-4-cols lt-7-rows"
                summary="پاسخ به پرسش‌های مطرح شده توسط اسکریپت migrate_all_online.sh"><colgroup><col
                    align="justify" /><col
                    align="justify" /></colgroup><thead><tr><th
                      align="justify">پرسش</th><th
                      align="justify">پاسخ</th></tr></thead><tbody><tr><td
                      align="justify">شرایط نامگذاری X.500</td><td
                      align="justify"><code
                        class="literal">dc=falcot,dc=com</code></td></tr><tr><td
                      align="justify">نام سرور LDAP</td><td
                      align="justify"><code
                        class="literal">localhost</code></td></tr><tr><td
                      align="justify">مدیر دامنه</td><td
                      align="justify"><code
                        class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                      align="justify">مدرک اعتبارسنجی</td><td
                      align="justify">گذرواژه مدیریتی</td></tr><tr><td
                      align="justify">ایجاد DUAConfigProfile</td><td
                      align="justify">no</td></tr></tbody></table></div></div><div
            class="para">
				ما به صورت عمدی از مهاجرت فایل <code
              class="filename">/etc/aliases</code> امتناع کردیم، چرا که شِمای استاندارد فراهم شده توسط دبیان ساختار مورد نظر این اسکریپت برای توضیح نام‌های مستعار ایمیل را شامل نمی‌شود. به منظور درج این داده در ساختار دایرکتوری، فایل <code
              class="filename">/etc/ldap/schema/misc.schema</code> باید به شِمای استاندارد اضافه گردد.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ابزار</em></span> مرور یک دایرکتوری LDAP</strong></p></div></div></div><div
              class="para">
				دستور <code
                class="command">jxplorer</code> (در بسته‌ای با همین نام) یک ابزار گرافیکی است که اجازه مرور و ویرایش پایگاه‌داده LDAP را فراهم می‌کند. این ابزار جالبی برای مدیرسیستم است، چرا که ساختار سلسله‌مراتبی داده‌های LDAP را به شیوه‌ای خوب در اختیار وی قرار می‌دهد.
			</div><a
              id="id-1.14.10.8.11.3"
              class="indexterm"></a></div><div
            class="para">
				به استفاده از گزینه <code
              class="literal">-c</code> در دستور <code
              class="command">ldapadd</code> دقت کنید؛ این گزینه درخواست می‌کند که در صورت بروز خطا، پردازش متوقف نشود. استفاده از این گزینه مورد نیاز است چرا که هنگام تبدیل فایل <code
              class="filename">/etc/services</code> اغلب چند خطای کوچک رخ می‌دهد که می‌توان از آن‌ها چشم‌پوشی کرد.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.10.9"></a>11.7.3. مدیریت حساب‌ها با LDAP</h3></div></div></div><div
            class="para">
				اکنون که پایگاه‌داده LDAP شامل اطلاعاتی خوبی است، زمان آن فرا رسیده که از آن‌ها استفاده کنیم. این قسمت به چگونگی پیکربندی یک سیستم لینوکس به شیوه‌ای که دایکتوری‌های سیستمی آن بتوانند از پایگاه‌داده LDAP استفاده کنند، می‌پردازد.
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.config-nss"></a>11.7.3.1. پیکربندی NSS</h4></div></div></div><div
              class="para">
					سیستم NSS (یا Name Service Switch،‌قسمت <a
                class="xref"
                href="sect.user-group-databases.html#sidebar.intro-nss"><span
                  class="emphasis"><em>مطالعه بیشتر</em></span> NSS و پایگاه‌داده‌های سیستم</a> را مشاهده کنید) یک سیستم ماژولار به منظور تعریف یا دریافت اطلاعات برای دایرکتوری‌های سیستمی است. استفاده از LDAP به عنوان منبع داده برای NSS نیازمند نصب بسته <span
                class="pkg pkg">libnss-ldap</span> است. در زمان نصب چندین پرسش مطرح می‌شود؛ پاسخ‌ها در قسمت <a
                class="xref"
                href="sect.ldap-directory.html#tab-libnss-ldap">
      جدول 11.2</a> بیان شده‌اند.
				</div><a
              id="id-1.14.10.9.3.3"
              class="indexterm"></a><div
              class="table"><a
                xmlns=""
                id="tab-libnss-ldap"></a><p
                class="title"><strong>
      جدول 11.2. پیکربندی بسته <span
                    class="pkg pkg">libnss-ldap</span></strong></p><div
                class="table-contents"><table
                  xmlns:d="http://docbook.org/ns/docbook"
                  class="lt-4-cols gt-7-rows"
                  summary="پیکربندی بسته libnss-ldap"><colgroup><col
                      align="justify" /><col
                      align="justify" /></colgroup><thead><tr><th
                        align="justify">پرسش</th><th
                        align="justify">پاسخ</th></tr></thead><tbody><tr><td
                        align="justify">شناسه منحصربفرد سرور LDAP</td><td
                        align="justify"><code
                          class="literal">ldap://ldap.falcot.com</code></td></tr><tr><td
                        align="justify">نام متمایز پایگاه جستجو</td><td
                        align="justify"><code
                          class="literal">dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">نسخه LDAP مورد استفاده</td><td
                        align="justify"><code
                          class="literal">3</code></td></tr><tr><td
                        align="justify">آیا پایگاه‌داده LDAP نیازمند نام کاربری است؟</td><td
                        align="justify">no</td></tr><tr><td
                        align="justify">ویژگی‌های خاص LDAP برای root</td><td
                        align="justify">بله</td></tr><tr><td
                        align="justify">فایل پیکربندی تنها توسط خود مالک خواندنی/نوشتنی باشد</td><td
                        align="justify">no</td></tr><tr><td
                        align="justify">حساب‌کاربری LDAP برای root</td><td
                        align="justify"><code
                          class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">گذرواژه حساب‌کاربری root در LDAP</td><td
                        align="justify">گذرواژه مدیریتی</td></tr></tbody></table></div></div><div
              class="para">
					به منظور پیکربندی NSS برای استفاده از افزونه تازه-نصب‌شده <code
                class="command">ldap</code>، فایل <code
                class="filename">/etc/nsswitch.conf</code> نیاز به تغییرات دارد.
				</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.10.9.3.6"></a><p
                class="title"><strong>
      مثال 11.26. فایل <code
                    class="filename">/etc/nsswitch.conf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# /etc/nsswitch.conf
#
# Example configuration of GNU Name Service Switch functionality.
# If you have the `glibc-doc' and `info' packages installed, try:
# `info libc "Name Service Switch"' for information about this file.

passwd: ldap compat
group: ldap compat
shadow: ldap compat

hosts: files dns ldap
networks: ldap files

protocols: ldap db files
services: ldap db files
ethers: ldap db files
rpc: ldap db files

netgroup: ldap files</pre></div></div><div
              class="para">
					افزونه <code
                class="command">ldap</code> معمولا قبل از دیگران قرار می‌گیرد، پس ابتدا از همه مورد پرس و جو می‌باشد. استثنا این مورد سرویس <code
                class="literal">hosts</code> است چرا که قبل از برقراری ارتباط با سرور LDAP، ابتدا به DNS نیاز است (برای شناسایی <code
                class="literal">ldap.falcot.com</code>). بدون این استثنا، یک پرس و جو مبتنی بر نام، از سرور LDAP اطلاعات خود را می‌پرسد؛ اینکار منجر به بروز خطا در سرور LDAP شده که آن را در یک حلقه بینهایت قرار می‌دهد.
				</div><div
              class="para">
					اگر نیاز به پرس و جو از سرور LDAP برای اینکار باشد (و فایل‌های محلی مورد استفاده افزونه <code
                class="command">files</code> نادیده گرفته شوند)، سرویس‌ها می‌توانند با شیوه نگارش زیر پیکربندی گردند:
				</div><div
              class="para">
					<code
                class="literal"><em
                  class="replaceable">service</em>: ldap [NOTFOUND=return] files</code>.
				</div><div
              class="para">
					اگر گزینه درخواست‌شده در پایگاه‌داده LDAP موجود نباشد، یک پاسخ “not existing” باز گردانده می‌شود حتی اگر گزینه مورد نظر در یکی از فایل‌های محلی موجود باشد؛ تنها زمانی از این فایل‌ها استفاده می‌شود که سرویس LDAP متوقف شده باشد.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.config-pam"></a>11.7.3.2. پیکربندی PAM</h4></div></div></div><div
              class="para">
					این قسمت به بررسی پیکربندی از PAM (<a
                class="xref"
                href="basic-configuration.html#sidebar.intro-pam"><span
                  class="emphasis"><em>پشت صحنه</em></span> <code
                  class="filename">/etc/environment</code> و <code
                  class="filename">/etc/default/locale</code></a> را مشاهده کنید) می‌پردازد که به برنامه‌ها اجازه احرازهویت توسط پایگاه‌داده LDAP را می‌دهد.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>احتیاط</em></span> احرازهویت شکسته‌شده</strong></p></div></div></div><div
                class="para">
					تغییر پیکربندی استاندارد PAM که توسط بسیاری برنامه‌ها استفاده می‌شود کاری خطرناک است. یک اشتباه کافی است تا فرآیند احرازهویت شکست بخورد، که از ثبت گزارش‌های آن از جلوگیری می‌کند. بازنگه‌داشتن یک پوسته root عمل احتیاطی خوبی است. در صورت بروز خطا در پیکربندی، به راحتی می‌توانند برطرف شوند و سرویس مورد نظر نیز با حداقل تلاش لازم راه‌اندازی مجدد شود.
				</div></div><div
              class="para">
					افزونه LDAP برای PAM توسط بسته <span
                class="pkg pkg">libpam-ldap</span> فراهم می‌شود. در زمان نصب این بسته پرسش‌های بسیار مشابهی به آنچه در <span
                class="pkg pkg">libpam-ldap</span> مطرح شد پرسیده می‌شود؛ حتی برخی پارامترهای پیکربندی نیز (از جمله نشانی سرور LDAP) با بسته <span
                class="pkg pkg">libpam-ldap</span> مشترک هستند. پاسخ‌ها در قسمت <a
                class="xref"
                href="sect.ldap-directory.html#tab-libpam-ldap">
      جدول 11.3</a> توضیح داده شده‌اند.
				</div><a
              id="id-1.14.10.9.4.5"
              class="indexterm"></a><div
              class="table"><a
                xmlns=""
                id="tab-libpam-ldap"></a><p
                class="title"><strong>
      جدول 11.3. پیکربندی <span
                    class="emphasis"><em>libpam-ldap</em></span></strong></p><div
                class="table-contents"><table
                  xmlns:d="http://docbook.org/ns/docbook"
                  class="lt-4-cols lt-7-rows"
                  summary="پیکربندی libpam-ldap"><colgroup><col
                      align="justify" /><col
                      align="justify" /></colgroup><thead><tr><th
                        align="justify">پرسش</th><th
                        align="justify">پاسخ</th></tr></thead><tbody><tr><td
                        align="justify">حساب مدیر LDAP مجاز است که مانند root رفتار کند؟</td><td
                        align="justify">بله. اینکار باعث می‌شود بتواند از دستور <code
                          class="command">passwd</code> برای تغییر گذرواژه‌های ذخیره‌شده در پایگاه‌داده LDAP استفاده شود.</td></tr><tr><td
                        align="justify">پایگاه‌داده LDAP نیازمند اطلاعات ورود باشد؟</td><td
                        align="justify">no</td></tr><tr><td
                        align="justify">حساب‌کاربری LDAP برای root</td><td
                        align="justify"><code
                          class="literal">cn=admin,dc=falcot,dc=com</code></td></tr><tr><td
                        align="justify">گذرواژه حساب‌کاربری root در LDAP</td><td
                        align="justify">گذرواژه مدیریتی پایگاه‌داده LDAP</td></tr><tr><td
                        align="justify">الگوریتم رمزنگاری محلی برای استفاده گذرواژه‌ها</td><td
                        align="justify">crypt</td></tr></tbody></table></div></div><div
              class="para">
					نصب <span
                class="pkg pkg">libpam-ldap</span> به صورت خودکار با پیکربندی پیشفرض PAM که در فایل‌های <code
                class="filename">/etc/pam.d/common-auth</code>، <code
                class="filename">/etc/pam.d/common-password</code> و <code
                class="filename">/etc/pam.d/common-account</code> تعریف شده است، منطبق می‌شود. این مکانیزم از ابزار انحصاری <code
                class="command">pam-auth-update</code> استفاده می‌کند (که توسط بسته <span
                class="pkg pkg">libpam-runtime</span> فراهم می‌شود). مدیرسیستم همچنین می‌تواند از این ابزار برای فعال‌سازی یا غیرفعال‌سازی افزونه‌های PAM استفاده کند.
				</div><a
              id="id-1.14.10.9.4.8"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.9"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.10"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.11"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.12"
              class="indexterm"></a><a
              id="id-1.14.10.9.4.13"
              class="indexterm"></a></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.10.9.5"></a>11.7.3.3. ایمن‌سازی تبادل داده LDAP</h4></div></div></div><a
              id="id-1.14.10.9.5.2"
              class="indexterm"></a><div
              class="para">
					پروتکل LDAP، به صورت پیشفرض، داده‌ها را در شبکه در حالت متنی جابجا می‌کند؛ این امر شامل گذرواژه‌ها (رمزنگاری‌شده) می‌شود. از آنجا که این گذرواژه‌ها می‌توانند از طریق شبکه استخراج شوند، نسبت به حملات dictionary-type آسیب‌پذیر هستند. این مشکل با فعال‌سازی یک لایه رمزنگاری اضافی برطرف می‌شود؛ فعال‌سازی این لایه موضوع بحث این قسمت است.
				</div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.14.10.9.5.4"></a>11.7.3.3.1. پیکربندی سرور</h5></div></div></div><a
                id="id-1.14.10.9.5.4.2"
                class="indexterm"></a><a
                id="id-1.14.10.9.5.4.3"
                class="indexterm"></a><div
                class="para">
						اولین گام ایجاد یک جفت کلید (کلیدهای عمومی و خصوصی) برای سرور LDAP است. مدیرسیستم‌های فالکوت از <span
                  class="emphasis"><em>easy-rsa</em></span> برای تولید آن استفاده می‌کنند (<a
                  class="xref"
                  href="sect.virtual-private-network.html#sect.easy-rsa">
      قسمت 10.2.1.1, “زیرساخت کلید عمومی: <span
                    class="emphasis"><em>easy-rsa</em></span>”
    </a> را مشاهده کنید). با اجرای <code
                  class="command">./build-key-server ldap.falcot.com</code> چند پرسش درباره محل، نام سازمان و از این قبیل پرسیده می‌شود. پاسخ به پرسش “نام متداول” باید مطابق با نام تمام-عیار سرور LDAP باشد؛ در این مورد، <code
                  class="literal">ldap.falcot.com</code>.
					</div><div
                class="para">
						این دستور یک گواهینامه در فایل <code
                  class="filename">keys/ldap.falcot.com.crt</code> ایجاد می‌کند؛ کلید خصوصی متناظر آن در <code
                  class="filename">keys/ldap.falcot.com.key</code> ذخیره می‌شود.
					</div><div
                class="para">
						اکنون این کلیدها باید در مکان استاندارد خود نصب شوند و باید اطمینان یابیم که کلید خصوصی توسط سرور LDAP که تحت هویت کاربر <code
                  class="literal">openldap</code> اجرا می‌شود، قابل خواندن باشد.
					</div><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>adduser openldap ssl-cert
</code></strong><code
                  class="computeroutput">Adding user `openldap' to group `ssl-cert' ...
Adding user openldap to group ssl-cert
Done.
# </code><strong
                  class="userinput"><code>mv keys/ldap.falcot.com.key /etc/ssl/private/ldap.falcot.com.key
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>chown root:ssl-cert /etc/ssl/private/ldap.falcot.com.key
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>chmod 0640 /etc/ssl/private/ldap.falcot.com.key
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>mv newcert.pem /etc/ssl/certs/ldap.falcot.com.pem
</code></strong></pre><div
                class="para">
						همچنین نیاز است که فرآیند پس‌زمینه <code
                  class="command">slapd</code> نیز از این کلیدها برای رمزنگاری استفاده کند. پیکربندی سرور LDAP به صورت خودکار مدیریت می‌شود: پیکربندی می‌تواند با عملیات ساده LDAP روی سلسله‌مراتب شی <code
                  class="literal">cn=config</code> بروزرسانی شود تا سرور در زمان واقعی و به صورت پایدار، اقدام به بروزرسانی <code
                  class="filename">/etc/ldap/slapd.d</code> کند. از این رو، <code
                  class="command">ldapmodify</code> ابزار مناسب بروزرسانی پیکربندی به حساب می‌آید:
					</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.10.9.5.4.9"></a><p
                  class="title"><strong>
      مثال 11.27. پیکربندی <code
                      class="command">slapd</code> برای رمزنگاری</strong></p><div
                  class="example-contents"><pre
                    class="screen"><code
                      class="computeroutput"># </code><strong
                      class="userinput"><code>cat &gt;ssl.ldif &lt;&lt;END
dn: cn=config
changetype: modify
add: olcTLSCertificateFile
olcTLSCertificateFile: /etc/ssl/certs/ldap.falcot.com.pem
-
add: olcTLSCertificateKeyFile
olcTLSCertificateKeyFile: /etc/ssl/private/ldap.falcot.com.key
-
END
</code></strong><code
                      class="computeroutput"># </code><strong
                      class="userinput"><code>ldapmodify -Y EXTERNAL -H ldapi:/// -f ssl.ldif
</code></strong><code
                      class="computeroutput">SASL/EXTERNAL authentication started
SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
SASL SSF: 0
modifying entry "cn=config"
</code></pre></div></div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>ابزار</em></span> استفاده از <code
                            class="command">ldapvi</code> برای ویرایش یک دایرکتوری LDAP</strong></p></div></div></div><a
                  id="id-1.14.10.9.5.4.10.2"
                  class="indexterm"></a><div
                  class="para">
						با استفاده از <code
                    class="command">ldapvi</code> می‌توانید خروجی LDIF یک دایرکتوری LDAP را مشاهده کرده، برخی تغییرات را در ویرایشگر متن ایجاد کنید و به ابزار اجازه دهید که عملیات متناظر LDAP را اجرا کند.
					</div><div
                  class="para">
						بنابراین ابزار مناسبی به منظور بروزرسانی پیکربندی سرور LDAP با استفاده از سلسله‌مراتب <code
                    class="literal">cn=config</code> و ویرایش آن به حساب می‌آید.
					</div><pre
                  class="screen"><code
                    class="computeroutput"># </code><strong
                    class="userinput"><code>ldapvi -Y EXTERNAL -h ldapi:/// -b cn=config
</code></strong></pre></div><div
                class="para">
						آخرین گام برای فعال‌سازی رمزنگاری تغییر متغیر <code
                  class="varname">SLAPD_SERVICES</code> در فایل <code
                  class="filename">/etc/default/slapd</code> است. ما به صورت امنی از آن استفاده کرده و تمام تبادل داده‌های ناامن LDAP را غیرفعال کرده‌ایم.
					</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.10.9.5.4.12"></a><p
                  class="title"><strong>
      مثال 11.28. فایل <code
                      class="filename">/etc/default/slapd</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
# Default location of the slapd.conf file or slapd.d cn=config directory. If
# empty, use the compiled-in default (/etc/ldap/slapd.d with a fallback to
# /etc/ldap/slapd.conf).
SLAPD_CONF=

# System account to run the slapd server under. If empty the server
# will run as root.
SLAPD_USER="openldap"

# System group to run the slapd server under. If empty the server will
# run in the primary group of its user.
SLAPD_GROUP="openldap"

# Path to the pid file of the slapd server. If not set the init.d script
# will try to figure it out from $SLAPD_CONF (/etc/ldap/slapd.conf by
# default)
SLAPD_PIDFILE=

# slapd normally serves ldap only on all TCP-ports 389. slapd can also
# service requests on TCP-port 636 (ldaps) and requests via unix
# sockets.
# Example usage:
# SLAPD_SERVICES="ldap://127.0.0.1:389/ ldaps:/// ldapi:///"
SLAPD_SERVICES="ldaps:/// ldapi:///"

# If SLAPD_NO_START is set, the init script will not start or restart
# slapd (but stop will still work).  Uncomment this if you are
# starting slapd via some other means or if you don't want slapd normally
# started at boot.
#SLAPD_NO_START=1

# If SLAPD_SENTINEL_FILE is set to path to a file and that file exists,
# the init script will not start or restart slapd (but stop will still
# work).  Use this for temporarily disabling startup of slapd (when doing
# maintenance, for example, or through a configuration management system)
# when you don't want to edit a configuration file.
SLAPD_SENTINEL_FILE=/etc/ldap/noslapd

# For Kerberos authentication (via SASL), slapd by default uses the system
# keytab file (/etc/krb5.keytab).  To use a different keytab file,
# uncomment this line and change the path.
#export KRB5_KTNAME=/etc/krb5.keytab

# Additional options to pass to slapd
SLAPD_OPTIONS=""</pre></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.14.10.9.5.5"></a>11.7.3.3.2. پیکربندی برنامه</h5></div></div></div><div
                class="para">
						در سمت برنامه، پیکربندی افزونه‌های <span
                  class="emphasis"><em>libpam-ldap</em></span> و <span
                  class="emphasis"><em>libnss-ldap</em></span> نیاز به تغییر دارند تا از نشانی <code
                  class="literal">ldaps://</code> استفاده کنند.
					</div><div
                class="para">
						برنامه‌های LDAP همچنین باید بتوانند سرور را احرازهویت کنند. در یک زیرساخت کلید X.509، گواهینامه‌های عمومی توسط کلید یکی از صادرکنندگان گواهینامه (CA) با <span
                  class="emphasis"><em>easy-rsa</em></span> امضا می‌شوند. مدیرسیستم‌های فالکوت CA خود را ایجاد کرده‌اند و نیاز دارند که سیستم را مبتنی بر آن پیکربندی کنند. اینکار با قرار دادن گواهینامه CA در <code
                  class="filename">/usr/local/share/ca-certificates</code> و اجرای <code
                  class="command">update-ca-certificates</code> انجام می‌شود.
					</div><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>cp keys/ca.crt /usr/local/share/ca-certificates/falcot.crt
</code></strong><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>update-ca-certificates
</code></strong><code
                  class="computeroutput">Updating certificates in /etc/ssl/certs... 1 added, 0 removed; done.
Running hooks in /etc/ca-certificates/update.d....
Adding debian:falcot.pem
done.
done.
</code></pre><div
                class="para">
						در آخر نیز، URI و DN پیشفرض LDAP که توسط بسیاری ابزارهای خط-فرمان استفاده می‌شوند می‌توانند در <code
                  class="filename">/etc/ldap/ldap.conf</code> تغییر کنند. اینکار از نوشتن‌های اضافی جلوگیری بعمل می‌آورد.
					</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.10.9.5.5.6"></a><p
                  class="title"><strong>
      مثال 11.29. فایل <code
                      class="filename">/etc/ldap/ldap.conf</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">#
# LDAP Defaults
#

# See ldap.conf(5) for details
# This file should be world readable but not world writable.

BASE   dc=falcot,dc=com
URI    ldaps://ldap.falcot.com

#SIZELIMIT      12
#TIMELIMIT      15
#DEREF          never

# TLS certificates (needed for GnuTLS)
TLS_CACERT      /etc/ssl/certs/ca-certificates.crt</pre></div></div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.http-ftp-proxy.html"><strong>قبلی</strong>11.6. پروکسی HTTP/FTP</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>بالا</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>خانه</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.rtc-services.html"><strong>بعدی</strong>11.8. سرویس‌های ارتباطی بلادرنگ</a></li></ul></body></html>
