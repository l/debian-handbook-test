<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">9.10. Säkerhetskopia</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-sv-SE-1.0-1" /><meta
        name="keywords"
        content="Systemstart, Initskript, SSH, Telnet, Rättigheter, Behörigheter, Övervakning, Inetd, Cron, Säkerhetskopia, Inpluggninsbara, PCMCIA, APM, ACPI" /><link
        rel="home"
        href="index.html"
        title="Handbok för Debianadministratören" /><link
        rel="up"
        href="unix-services.html"
        title="Kapitel 9. Unixtjänster" /><link
        rel="prev"
        href="sect.quotas.html"
        title="9.9. Kvoter" /><link
        rel="next"
        href="sect.hotplug.html"
        title="9.11. Hetpluggning: hetpluggning" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/sv-SE/stable/sect.backup.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.quotas.html"><strong>Föregående</strong></a></li><li
          class="home">Handbok för Debianadministratören</li><li
          class="next"><a
            accesskey="n"
            href="sect.hotplug.html"><strong>Nästa</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.backup"></a>9.10. Säkerhetskopia</h2></div></div></div><div
          class="para">
			Att ta säkerhetskopior är en av huvuduppgifterna för en administratör, men det är ett komplex område och involverar kraftfulla verktyg som ofta är svårhanterliga.
		</div><a
          id="id-1.12.13.3"
          class="indexterm"></a><a
          id="id-1.12.13.4"
          class="indexterm"></a><div
          class="para">
			Det finns många program, som <code
            class="command">amanda</code>, <code
            class="command">bacula</code>, <code
            class="command">BackupPC</code>. De är klient/serversystem som innehåller många alternativ vars konfiguration är ganska svår. En del av dem tillhandahåller användarvänliga webbgränssnitt för att sköta dem. Men Debian innehåller dussintals andra säkerhetskopior som täcker alla möjliga fall, som du enkelt kan bekräfta med <code
            class="command">apt-cache search backup</code>.
		</div><a
          id="id-1.12.13.6"
          class="indexterm"></a><a
          id="id-1.12.13.7"
          class="indexterm"></a><a
          id="id-1.12.13.8"
          class="indexterm"></a><div
          class="para">
			Istället för att i detalj beskriva dem kommer detta avsnitt att presentera tankegången hos Falcot Corp-administratörerna när de definiera sin säkerhetsstrategi.
		</div><div
          class="para">
			På Falcot Corp har säkerhetskopior två mål: att återskapa felaktigt borttagna filer och att snabbt återställa datorer (server eller skrivbord) där hårddisken har fallerat.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.12.13.11"></a>9.10.1. Säkerhetskopiera med <code
                    class="command">rsync</code></h3></div></div></div><div
            class="para">
				Säkerhetskopior på band har bedömts vara för långsamma och kostsamma, data kommer att säkerhetskopieras på hårdiskar på en dedikerade server, för vilken användningen av mjukvaru-RAID (se <a
              class="xref"
              href="advanced-administration.html#sect.raid-soft">Avsnitt 12.1.1, ”Software RAID”</a> kommer att skydda data från hårddiskfel. Normalt tas inte säkerhetskopior för skrivbordsdatorer , men det rekommenderas att användarnas personliga konton på deras avdelnings filserver säkerhetkopieras. Kommandot <code
              class="command">rsync</code> från paketet med samma namn) används dagligen för att ta säkerhetskopior av de olika servrarna.
			</div><a
            id="id-1.12.13.11.3"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>GRUNDLÄGGANDE</em></span> Hårdlänken, ett till namn för filen</strong></p></div></div></div><a
              id="id-1.12.13.11.4.2"
              class="indexterm"></a><a
              id="id-1.12.13.11.4.3"
              class="indexterm"></a><div
              class="para">
				En hårdlink kan i motsats till en mjuklänk inte skiljas från den länkade filen. Att skapa en hårdlänk är i praktiken detsamma som att ge en befintlig fil ett till namn. Det är därför borttagningen av en hårdlänk endast tar bort en av namnen associerat med filen.Så länge som ett annat namn fortfarande är kopplat till filen kommer data därinne att kvarstå på filsystemet. Det är intressant att observera att, istället för en kopia så tar inte hårdlänken upp ytterligare utrymme på hårddisken.
			</div><div
              class="para">
				En hårdlänk skapas med kommandot <code
                class="command">ln <em
                  class="replaceable">mål</em> <em
                  class="replaceable">länk</em></code>. Filen <em
                class="replaceable">länk</em> är sedan det nya namnet för <em
                class="replaceable">mål</em>. Hårdlänken kan endast skapas på samma filsystem, med symboliska länkar inte har denna begränsning.
			</div></div><div
            class="para">
				Det tillgängliga hårddiskutrymmet förhindrar implementationen av en komplett daglig säkerhetskopia. Som sådant är kommandot <code
              class="command">rsync</code> föregås av en duplicering av innehållet av föregående säkerhetskopia med hårdlänkar, vilka förhindrar användning av för mycket hårddiskutrymme. Processen <code
              class="command">rsync</code> ersätter då endast filer som har modifierats sedan senaste säkerhetskopian. Med denna mekanism kommer ett stort antal säkerhetskopior att kunna lagras med ett litet utrymme. Eftersom alla säkerhetskopior är tillgängliga och direkt åtkomliga (till exempel, i olika kataloger för en given utdelning av nätverket) kan du snabbt utföra jämförelser mellan två givna datum.
			</div><a
            id="id-1.12.13.11.6"
            class="indexterm"></a><a
            id="id-1.12.13.11.7"
            class="indexterm"></a><a
            id="id-1.12.13.11.8"
            class="indexterm"></a><div
            class="para">
				Mekanismen för säkerhetskopia är enkelt implementerat med programmet <code
              class="command">dirvish</code>. Det använder ett säkerhetslagringsutrymme (”bank” i vokabulären) i vilken den placerar kopior av säkerhetskopierade filer som kallas ”valv” i dirvish-dokumentationen.
			</div><div
            class="para">
				Huvudkonfigurationen finns i filen <code
              class="filename">/etc/dirvish/master.conf</code>. Den definierar säkerhetskopiornas lagringsutrymme, listan av ”valv“ att hantera och standardvärden för utgången av säkerhetskopior. Resten av konfigurationen finns i filerna <code
              class="filename"><em
                class="replaceable">bank</em>/<em
                class="replaceable">valv</em>/dirvish/default.conf</code> och innehåller specifik konfiguration för den motsvarande filmängden.
			</div><div
            class="example"><a
              xmlns=""
              id="example.dirvish-master"></a><p
              class="title"><strong>Exempel 9.3. Filen <code
                  class="filename">/etc/dirvish/master.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">bank:
    /backup
exclude:
    lost+found/
    core
    *~
Runall:
    root    22:00
expire-default: +15 days
expire-rule:
#   MIN HR    DOM MON       DOW  STRFTIME_FMT
    *   *     *   *         1    +3 months
    *   *     1-7 *         1    +1 year
    *   *     1-7 1,4,7,10  1</pre></div></div><div
            class="para">
				Inställningen <code
              class="literal">bank</code> indikerar katalogen i vilken säkerhetskopian är lagrad. Inställningen <code
              class="literal">exclude</code> låter dig utesluta filer (eller filtyper) att utesluta från säkerhetskopian. <code
              class="literal">Runall</code> är en lista över filmängden att säkerhetskopiera med en tidsstämpel för varje mängd som låter dig tilldela korrekt datum till kopian, i det fall säkerhetskopian inte löses ut precis vid tilldelad tid. Du måste ange en tid för precis innan själva körtiden (vilken, som standardvärde, är 10.04 pm i Debian enligt <code
              class="filename">/etc/cron.d/dirvish</code>). Slutligen, definierar inställningarna <code
              class="literal">expire-default</code> och <code
              class="literal">expire-rule</code> reglerna för då tidsgränsen passeras för säkerhetskopian. Exemplet ovan behåller för evigt de som generas den första söndagen i varje kvartal, och tar efter ett år bort dem från de från den första söndagen i varje månad, och efter 3 månader de från andra söndagar. Andra dagliga säkerhetskopior behålls i 15 dagar. Reglernas ordning har betydelse. Dirvish använder den senast matchande regeln eller <code
              class="literal">expire-default</code> om ingen annan <code
              class="literal">expire-rule</code> matchar.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>I PRAKTIKEN</em></span> Schemalagd tidsgräns</strong></p></div></div></div><div
              class="para">
				Reglerna för tidsgränser används inte av <code
                class="command">dirvish-expire</code> för att utföra dess jobb. De tillämpas vid skapandet av en ny säkerhetskopia för att definiera utgångsdatum associerad med kopian. <code
                class="command">dirvish-expire</code> använder de lagrade kopiorna och tar bort de för vilka sista datum har passerat.
			</div></div><div
            class="example"><a
              xmlns=""
              id="example.dirvish-vault"></a><p
              class="title"><strong>Exempel 9.4. Filen <code
                  class="filename">/backup/root/dirvish/default.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">client: rivendell.falcot.com
tree: /
xdev: 1
index: gzip
image-default: %Y%m%d
exclude:
    /var/cache/apt/archives/*.deb
    /var/cache/man/**
    /tmp/**
    /var/tmp/**
    *.bak</pre></div></div><div
            class="para">
				Exemplet ovan visar filerna som ska säkerhetskopieras: det är filer på maskinen <span
              class="emphasis"><em>rivendell.falcot.com</em></span> (för lokal säkerhetskopiering av data, ange namnet för den lokala maskinen som visas genom <code
              class="command">hostname</code>, speciellt för de i rotträdet (<code
              class="literal">tree: /</code>), förutom de som listas i <code
              class="literal">uteslut</code>. Säkerhetskopian kommer att begränsas till innehållen i en av filsystemen (<code
              class="literal">xdev: 1</code>). Det kommer inte att omfatta filer från andra monteringspunkter. Ett index över sparade filer kommer att genereras (<code
              class="literal">index: gzip</code>). och bilden kommer att namnges efter aktuellt daturm (<code
              class="literal">image-default: %Y%m%d</code>).
			</div><div
            class="para">
				Det finns många tillgängliga flaggor som alla dokumenteras i handbokens sida <span
              class="citerefentry"><span
                class="refentrytitle">dirvish.conf</span>(5)</span>. När väl dessa konfigurationsfiler är angivna måste du initialisera varje fil med kommandot <code
              class="command">dirvish --vault <em
                class="replaceable">vault</em> --init</code>. Därifrån kommer en daglig körning av <code
              class="command">dirvish-runall</code> automatiskt att skapa en ny säkerhetskopia efter att ha tagit bort de utgånga.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>I PRAKTIKEN</em></span> Fjärrsäkerhetskopia med SSH</strong></p></div></div></div><div
              class="para">
				När dirvish behöver spara data till en fjärrmaskin kommer det att använda <code
                class="command">ssh</code> för att ansluta till den samt starta <code
                class="command">rsync</code> som server. Det kräver att root-användaren kan ansluta automatiskt till den. Användningen av SSH-autentisteringsnyckeln tillåter precis det (se <a
                class="xref"
                href="sect.remote-login.html#sect.ssh-key-based-auth">Avsnitt 9.2.1.1, ”Nyckelbasera autentisering”</a>).
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.12.13.12"></a>9.10.2. Återställa maskiner utan säkerhetskopior</h3></div></div></div><div
            class="para">
				Skrivbordsdatorer som inte är säkerhetskopierade kan enkelt ominstalleras från anpassade DVD-ROM-skivor förberedda med <span
              class="emphasis"><em>Simple-CDD</em></span> (se <a
              class="xref"
              href="sect.automated-installation.html#sect.simple-cdd">Avsnitt 12.3.3, ”Simple-CDD: The All-In-One Solution”</a>). Eftersom detta gör en hel ominstallation försvinner all anpassning som skett efter den ursprungliga installationen. Det gör inget eftersom systemen är uppkopplade till ett centralt LDAP-katalog för konton, och att de flesta skrivbordsprogram är förkonfigurerade tack vare dconf (se <a
              class="xref"
              href="sect.graphical-desktops.html#sect.gnome-desktop">Avsnitt 13.3.1, ”GNOME”</a> för mer information).
			</div><div
            class="para">
				Adminstratörerna av Falcot Corp är medvetna om begränsningarna i deras policy för säkerhetskopiering. Eftersom de nte kan skydda en extra server såväl som ett band i ett eldsäkert skåp har de installerat den i ett separat rum så att en katastrof, exempelvis en eldsvåda, inte förstör säkerhetskopior. Vidare så utför de en inkrementell säkerhetskopiering på en dvd-skiva en gång i veckan - endast filer som ändrats sedan förra säkerhetskopieringen omfatts.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>YTTERLIGARE INFORMATION</em></span> Säkerhetskopiera SQL- och LDAP-tjänster</strong></p></div></div></div><div
              class="para">
				Många tjänster (som till exempel SQL- och LDAP-databaser) kan inte säkerhetskopieras genom att kopiera dess filer(om de inte avbryts under säkerhetskopiering, vilket oftast är problematiskt då de ofta är avsedda att alltid vara tillgängliga). Därför är det nödvändigt att använda en ”export”-mekanism för att skapa en ”data-dump” som kan säjerhetskopieras säkert. De blir ofta ganska stora, men komprimeras bra. För att minska på använt lagringsutrymme kommer du endast att spara en komplett textfil en gång i veckan och en <code
                class="command">diff</code> varje dag, vilket skapas med ett kommando av typen <code
                class="command">diff <em
                  class="replaceable">gardagens_fil</em> <em
                  class="replaceable">dagens_fil</em></code>. Programmet <code
                class="command">xdelta</code> producerar inkrementella skillnader från binära dumpar.
			</div><a
              id="id-1.12.13.12.4.3"
              class="indexterm"></a><a
              id="id-1.12.13.12.4.4"
              class="indexterm"></a><a
              id="id-1.12.13.12.4.5"
              class="indexterm"></a></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>KULTUR</em></span> <span
                        class="emphasis"><em>TAR</em></span>, standarden för säkerhetskopior av band</strong></p></div></div></div><a
              id="id-1.12.13.12.5.2"
              class="indexterm"></a><a
              id="id-1.12.13.12.5.3"
              class="indexterm"></a><a
              id="id-1.12.13.12.5.4"
              class="indexterm"></a><div
              class="para">
				Historiskt sett har det de enklaste sättet att göra en säkerhetskopia i Unix varit att lagra ett <span
                class="emphasis"><em>TAR</em></span>-arkiv på band. Kommandot <code
                class="command">tar</code> fick sitt namn från “Tape ARchive”.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.quotas.html"><strong>Föregående</strong>9.9. Kvoter</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Upp</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Hem</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.hotplug.html"><strong>Nästa</strong>9.11. Hetpluggning: hetpluggning</a></li></ul></body></html>
