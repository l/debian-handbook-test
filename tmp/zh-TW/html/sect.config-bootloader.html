<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">8.8. 組態 Bootloader</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-zh-TW-1.0-1" /><meta
        name="keywords"
        content="組態, 在地化, 地區設定, 網路, 名稱解析, 使用者, 群組, 帳號, 命令列解析器, Shell, 列印, 啟動程式, 編譯核心" /><link
        rel="home"
        href="index.html"
        title="Debian管理者手冊" /><link
        rel="up"
        href="basic-configuration.html"
        title="章 8. 基本組態：網路、帳號、列印..." /><link
        rel="prev"
        href="sect.config-printing.html"
        title="8.7. 列表機組態" /><link
        rel="next"
        href="sect.config-misc.html"
        title="8.9. 其他組態：時間同步、記錄、共享近用…" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/zh-TW/stable/sect.config-bootloader.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.config-printing.html"><strong>前一頁</strong></a></li><li
          class="home">Debian管理者手冊</li><li
          class="next"><a
            accesskey="n"
            href="sect.config-misc.html"><strong>下一頁</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.config-bootloader"></a>8.8. 組態 Bootloader</h2></div></div></div><a
          id="id-1.11.12.2"
          class="indexterm"></a><a
          id="id-1.11.12.3"
          class="indexterm"></a><div
          class="para">
			或許已經運作了，但最好知道如何組態與安裝載入啟動器，萬一它不在 Master Boot Record 中。安裝 Windows 等其他作業系統後，很可能出現這種情況。以下的資訊在必要時可協助修改載入啟動器組態。
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>基本</em></span> Master boot record</strong></p></div></div></div><a
            id="id-1.11.12.5.2"
            class="indexterm"></a><a
            id="id-1.11.12.5.3"
            class="indexterm"></a><div
            class="para">
			主開機記錄 (Master Boot Record, MBR) 位於第一顆磁碟的最前方 512 位元組，首先被 BIOS 載入，再啟動作業系統。一般來說，由主開機記錄安裝啟動程式，移除稍早的內容。
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.identify-disks"></a>8.8.1. 辨識磁碟</h3></div></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>文化</em></span> <span
                        class="emphasis"><em>udev</em></span> 與 <code
                        class="filename">/dev/</code></strong></p></div></div></div><div
              class="para">
				<code
                class="filename">/dev/</code> 資料夾習慣儲存被稱為 “特殊的” 檔案，用於代表系統的週邊裝置 (見專欄 <a
                class="xref"
                href="sect.creating-accounts.html#sidebar.special-files"><span
                  class="emphasis"><em>基本</em></span> 近用設備的權限</a>)。曾經納入所有可能用到的特殊檔案。這種處理方式有若干缺點，限制設備數量是其中之一，每種設備祗能有一個 (因為清單名稱被限制)，且不可能知道實際上該用那個特殊檔案。
			</div><div
              class="para">
				如今，以動態方式管理特殊的檔案，並且更適合熱切換的電腦設備。核心與 <span
                class="emphasis"><em>udev</em></span> 合作在需要的時候新增與刪除檔案以對映出現或消失的設備。所以，<code
                class="filename">/dev/</code> 不需要維持不變，反而採用 RAM 儲存的檔案系統清除或納入相關的款目。
			</div><div
              class="para">
				核心與新增的設備溝通，並發給主要/次要號碼以供辨識。以 <code
                class="command">udevd</code> 命令可以新增特殊的檔案並授權使用它。也可新增別名執行其他的工作 (諸如初始化或登錄工作)。<code
                class="command">udevd</code> 命令的行為由一組 (可客製化) 的規則驅動。
			</div><div
              class="para">
				動態給予名稱，就能夠讓同名稱永遠指向特定設備，不必在意連結的設備或順序，尤其在使用 USB 週邊時更為便利。第一個磁碟的第一個區塊稱為 <code
                class="filename">/dev/sda1</code> 可供向後相容，喜歡的話也可稱為 <code
                class="filename">/dev/root-partition</code>，或兩者共用，因為 <code
                class="command">udevd</code> 可以組態成自動新增符號連結。
			</div><div
              class="para">
				過去在需要進入特定設備檔案時，部份的核心模組無法自動載入。現在情況已變了，週邊設備的特殊檔案於載入模組時才會存在；所以問題不大，受惠於自動偵測硬體，大部份模組都可於啟動時載入。但對於偵測不到的週邊 (諸如極舊的磁碟機或 PS/2 滑鼠)，則無效。在此情況下，就需新增 <code
                class="literal">floppy</code>、<code
                class="literal">psmouse</code> 與 <code
                class="literal">mousedev</code> 等模組至 <code
                class="filename">/etc/modules</code> 才能於啟動時強迫載入。
			</div></div><a
            id="id-1.11.12.6.3"
            class="indexterm"></a><a
            id="id-1.11.12.6.4"
            class="indexterm"></a><div
            class="para">
				組態啟動程式必須辨認硬碟及其分區。Linux 使用 “block” 特殊檔案儲存在 <code
              class="filename">/dev/</code> 資料夾內。因為 Debian <span
              class="distribution distribution">Squeeze</span> 版本使用源自 Linux 核心的硬碟命名架構，所有的硬碟 (IDE/PATA、SATA、SCSI、USB、IEEE 1394) 都以 <code
              class="filename">/dev/sd*</code> 表示。
			</div><div
            class="para">
				每個分區由其磁碟代號表示：如，<code
              class="filename">/dev/sda1</code> 是第一個磁碟的第一個分區，而 <code
              class="filename">/dev/sdb3</code> 是第二個磁碟的第三個分區。
			</div><a
            id="id-1.11.12.6.7"
            class="indexterm"></a><a
            id="id-1.11.12.6.8"
            class="indexterm"></a><a
            id="id-1.11.12.6.9"
            class="indexterm"></a><a
            id="id-1.11.12.6.10"
            class="indexterm"></a><div
            class="para">
				PC 架構 (或 “i386”，包括新出現的 “amd64”) 不再受限於使用 “MS-DOS” 分區表格式，每個磁碟可以擁有超過 4 個 “主要” 分區。在此架構下要超過此限制，必須新增 “延伸” 分區，然後就能使用新增的 “次要” 分區。這些次要分區由 5 開始編號。所以，第一個磁碟的次要分區可以是 <code
              class="filename">/dev/sda5</code>，然後是 <code
              class="filename">/dev/sda6</code>，餘此類推。
			</div><div
            class="para">
				MS-DOS 分區表格式的另個限制是磁碟的容量不能超過 2 TiB，成為當代磁碟的真正問題。
			</div><a
            id="id-1.11.12.6.13"
            class="indexterm"></a><a
            id="id-1.11.12.6.14"
            class="indexterm"></a><div
            class="para">
				GPT 是新的分區表格式，解放對區分數的限制 (標準方式最多可以設定 128 個區分) 以及磁碟容量的限制 (最多達 8 ZiB，超過 8 百萬兆位元組)。若想在一個磁碟切出多個實體區分，必須以 GPT 格式新增分區表。
			</div><div
            class="para">
				不容易記得磁碟掛在 SATA 控制卡的位置，或在 SCSI 鏈的第三個位置，尤其是熱插拔硬式磁碟機 (包括 SATA 磁碟與外掛磁碟) 可改變開機的位置。還好，<code
              class="command">udev</code> 以固定的名稱，新增 <code
              class="filename">/dev/sd*</code> 以外的符號連結，就能夠輕易的辨識硬式磁碟機。這種符號連結儲存在 <code
              class="filename">/dev/disk/by-id</code> 之內。例如，在兩個實體磁碟的機器，可以找到如下的訊息：
			</div><pre
            class="screen"><code
              class="computeroutput">mirexpress:/dev/disk/by-id# </code><strong
              class="userinput"><code>ls -l
</code></strong><code
              class="computeroutput">total 0
lrwxrwxrwx 1 root root  9 23 jul. 08:58 ata-STM3500418AS_9VM3L3KP -&gt; ../../sda
lrwxrwxrwx 1 root root 10 23 jul. 08:58 ata-STM3500418AS_9VM3L3KP-part1 -&gt; ../../sda1
lrwxrwxrwx 1 root root 10 23 jul. 08:58 ata-STM3500418AS_9VM3L3KP-part2 -&gt; ../../sda2
[...]
lrwxrwxrwx 1 root root  9 23 jul. 08:58 ata-WDC_WD5001AALS-00L3B2_WD-WCAT00241697 -&gt; ../../sdb
lrwxrwxrwx 1 root root 10 23 jul. 08:58 ata-WDC_WD5001AALS-00L3B2_WD-WCAT00241697-part1 -&gt; ../../sdb1
lrwxrwxrwx 1 root root 10 23 jul. 08:58 ata-WDC_WD5001AALS-00L3B2_WD-WCAT00241697-part2 -&gt; ../../sdb2
[...]
lrwxrwxrwx 1 root root  9 23 jul. 08:58 scsi-SATA_STM3500418AS_9VM3L3KP -&gt; ../../sda
lrwxrwxrwx 1 root root 10 23 jul. 08:58 scsi-SATA_STM3500418AS_9VM3L3KP-part1 -&gt; ../../sda1
lrwxrwxrwx 1 root root 10 23 jul. 08:58 scsi-SATA_STM3500418AS_9VM3L3KP-part2 -&gt; ../../sda2
[...]
lrwxrwxrwx 1 root root  9 23 jul. 08:58 scsi-SATA_WDC_WD5001AALS-_WD-WCAT00241697 -&gt; ../../sdb
lrwxrwxrwx 1 root root 10 23 jul. 08:58 scsi-SATA_WDC_WD5001AALS-_WD-WCAT00241697-part1 -&gt; ../../sdb1
lrwxrwxrwx 1 root root 10 23 jul. 08:58 scsi-SATA_WDC_WD5001AALS-_WD-WCAT00241697-part2 -&gt; ../../sdb2
[...]
lrwxrwxrwx 1 root root  9 23 jul. 16:48 usb-LaCie_iamaKey_3ed00e26ccc11a-0:0 -&gt; ../../sdc
lrwxrwxrwx 1 root root 10 23 jul. 16:48 usb-LaCie_iamaKey_3ed00e26ccc11a-0:0-part1 -&gt; ../../sdc1
lrwxrwxrwx 1 root root 10 23 jul. 16:48 usb-LaCie_iamaKey_3ed00e26ccc11a-0:0-part2 -&gt; ../../sdc2
[...]
lrwxrwxrwx 1 root root  9 23 jul. 08:58 wwn-0x5000c50015c4842f -&gt; ../../sda
lrwxrwxrwx 1 root root 10 23 jul. 08:58 wwn-0x5000c50015c4842f-part1 -&gt; ../../sda1
[...]
mirexpress:/dev/disk/by-id# </code></pre><div
            class="para">
				同顆磁碟出現多次 (因為它們同時做為 ATA 磁碟與 SCSI 磁碟)，但是根據磁碟的型號與序號等相關資訊，就可找到對應的週邊裝置檔案。
			</div><div
            class="para">
				下節的組態檔根據同樣的設定而來：一個 SATA 磁碟，第一個區分是安裝舊型的視窗、第二個分區安裝 Debian GNU/Linux。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.config-lilo"></a>8.8.2. 組態 LILO</h3></div></div></div><a
            id="id-1.11.12.7.2"
            class="indexterm"></a><a
            id="id-1.11.12.7.3"
            class="indexterm"></a><div
            class="para">
				<span
              class="emphasis"><em>LILO</em></span> (Linux 啟動程式, LInux LOader) 是最舊的啟動程式 — 穩定但粗糙。把核心的實體位址寫入 MBR 的啟動，所以每次更新至 LILO (或其組態檔案) 都必須再執行命令 <code
              class="command">lilo</code>。忘記的話，移除或更新核心後，新的核心就不會在磁碟的原來位置，以致系統無法啟動。
			</div><div
            class="para">
				LILO 的組態檔是 <code
              class="filename">/etc/lilo.conf</code>；一個簡單的檔案供標準組態之用，如下例。
			</div><div
            class="example"><a
              xmlns=""
              id="example.lilo.conf"></a><p
              class="title"><strong>範例 8.4. LILO 組態檔案</strong></p><div
              class="example-contents"><pre
                class="programlisting">
# The disk on which LILO should be installed.
# By indicating the disk and not a partition.
# you order LILO to be installed on the MBR.
boot=/dev/sda
# the partition that contains Debian
root=/dev/sda2
# the item to be loaded by default
default=Linux

# the most recent kernel image
image=/vmlinuz
  label=Linux
  initrd=/initrd.img
  read-only

# Old kernel (if the newly installed kernel doesn't boot)
image=/vmlinuz.old
  label=LinuxOLD
  initrd=/initrd.img.old
  read-only
  optional

# only for Linux/Windows dual boot
other=/dev/sda1
  label=Windows</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.config-grub"></a>8.8.3. GRUB 2 組態</h3></div></div></div><a
            id="id-1.11.12.8.2"
            class="indexterm"></a><a
            id="id-1.11.12.8.3"
            class="indexterm"></a><div
            class="para">
				<span
              class="emphasis"><em>GRUB</em></span> (GRand Unified Bootloader) 是最近的事。更新核心後不必再啟動它；<span
              class="emphasis"><em>GRUB</em></span> 知道如何讀取檔案系統並找到核心在磁碟的位置。鍵入 <code
              class="command">grub-install /dev/sda</code> 命令就能夠把它安裝在第一個磁碟的 MBR。<a
              id="id-1.11.12.8.4.4"
              class="indexterm"></a>
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>說明</em></span> GRUB 的磁碟名稱</strong></p></div></div></div><div
              class="para">
				GRUB 祗能根據 BIOS 提供的資訊辨識硬式磁碟機。<code
                class="literal">(hd0)</code> 對應偵測到的第一個磁碟、<code
                class="literal">(hd1)</code> 第二個磁碟等。大部份的情況下，此順序剛好是 Linux 的磁碟順序，同時使用 SCSI 與 IDE 磁碟時就出問題。GRUB 把偵測到的資訊儲存在 <code
                class="filename">/boot/grub/device.map</code> 檔案內。若在此發現錯誤 (因為已知 BIOS 以不同的順序偵測到磁碟)，再次執行 <code
                class="command">grub-install</code> 命令。<code
                class="command">grub-mkdevicemap</code> 命令可新增 <code
                class="filename">device.map</code> 檔案。
			</div><div
              class="para">
				區分表在 GRUB 內也有特定的名稱。通常使用 MS-DOS 格式的 “經典” 區分，第一個磁碟的第一個分區標記為 <code
                class="literal">(hd0,msdos1)</code>、第二個分區標記為 <code
                class="literal">(hd0,msdos2)</code>，餘此類推。
			</div></div><div
            class="para">
				GRUB 2 configuration is stored in <code
              class="filename">/boot/grub/grub.cfg</code>, but this file (in Debian) is generated from others. Be careful not to modify it by hand, since such local modifications will be lost the next time <code
              class="command">update-grub</code> is run (which may occur upon update of various packages). The most common modifications of the <code
              class="filename">/boot/grub/grub.cfg</code> file (to add command line parameters to the kernel or change the duration that the menu is displayed, for example) are made through the variables in <code
              class="filename">/etc/default/grub</code>. To add entries to the menu, you can either create a <code
              class="filename">/boot/grub/custom.cfg</code> file or modify the <code
              class="filename">/etc/grub.d/40_custom</code> file. For more complex configurations, you can modify other files in <code
              class="filename">/etc/grub.d</code>, or add to them; these scripts should return configuration snippets, possibly by making use of external programs. These scripts are the ones that will update the list of kernels to boot: <code
              class="filename">10_linux</code> takes into consideration the installed Linux kernels; <code
              class="filename">20_linux_xen</code> takes into account Xen virtual systems, and <code
              class="filename">30_os-prober</code> lists other operating systems (Windows, OS X, Hurd).
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.config-yaboot"></a>8.8.4. Macintosh 電腦 (PowerPC)：組態 Yaboot</h3></div></div></div><a
            id="id-1.11.12.9.2"
            class="indexterm"></a><div
            class="para">
				Yaboot 是使用 PowerPC 晶片的舊型 Macintosh 電腦用到的啟動程式。它的啟動方式不同於 PC，採用 “引導” 分區法，從 BIOS (或 OpenFirmware) 執行啟動程式，然後由 <code
              class="command">ybin</code> 程式安裝 <code
              class="command">yaboot</code> 及其組態檔。修改 <code
              class="filename">/etc/yaboot.conf</code> 檔案後 (在啟動程式分區複製，且 <code
              class="command">yaboot</code> 知道如何到磁碟找尋核心的位置)，需再次執行此命令。
			</div><div
            class="para">
				執行 <code
              class="command">ybin</code> 之前，應有合法的 <code
              class="filename">/etc/yaboot.conf</code> 程式。以下的最小組態的範例。<a
              id="id-1.11.12.9.4.3"
              class="indexterm"></a>
			</div><div
            class="example"><a
              xmlns=""
              id="example.yaboot.conf"></a><p
              class="title"><strong>範例 8.5. Yaboot 組態檔案</strong></p><div
              class="example-contents"><pre
                class="programlisting">
# bootstrap partition
boot=/dev/sda2
# the disk
device=hd:
# the Linux partition
partition=3
root=/dev/sda3
# boot after 3 seconds of inactivity
# (timeout is in tenths of seconds)
timeout=30

install=/usr/lib/yaboot/yaboot
magicboot=/usr/lib/yaboot/ofboot
enablecdboot

# last kernel installed
image=/vmlinux
        label=linux
        initrd=/initrd.img
        read-only

# old kernel
image=/vmlinux.old
        label=old
        initrd=/initrd.img.old
        read-only

# only for Linux/Mac OSX dual-boot
macosx=/dev/sda5

# bsd=/dev/sdaX and macos=/dev/sdaX
# are also possible</pre></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.config-printing.html"><strong>前一頁</strong>8.7. 列表機組態</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一層</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始頁</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.config-misc.html"><strong>下一頁</strong>8.9. 其他組態：時間同步、記錄、共享近用…</a></li></ul></body></html>
