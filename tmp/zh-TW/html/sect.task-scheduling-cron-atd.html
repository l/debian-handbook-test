<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">9.7. 以 cron 和 atd 使用排定的工作</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-zh-TW-1.0-1" /><meta
        name="keywords"
        content="系統啟動, 初始化腳本, SSH, Telnet, 權力, 權限, 監督, Inetd, Cron, 備份, 熱插拔, PCMCIA, APM, ACPI" /><link
        rel="home"
        href="index.html"
        title="The Debian Administrator's Handbook" /><link
        rel="up"
        href="unix-services.html"
        title="章 9. Unix 服務" /><link
        rel="prev"
        href="sect.inetd.html"
        title="9.6. The inetd 超級伺服器" /><link
        rel="next"
        href="sect.asynchronous-task-scheduling-anacron.html"
        title="9.8. Scheduling Asynchronous Tasks: anacron" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/zh-TW/stable/sect.task-scheduling-cron-atd.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.inetd.html"><strong>前一頁</strong></a></li><li
          class="home">The Debian Administrator's Handbook</li><li
          class="next"><a
            accesskey="n"
            href="sect.asynchronous-task-scheduling-anacron.html"><strong>下一頁</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.task-scheduling-cron-atd"></a>9.7. 以 <code
                  class="command">cron</code> 和 <code
                  class="command">atd</code> 使用排定的工作</h2></div></div></div><a
          id="id-1.12.10.2"
          class="indexterm"></a><a
          id="id-1.12.10.3"
          class="indexterm"></a><a
          id="id-1.12.10.4"
          class="indexterm"></a><a
          id="id-1.12.10.5"
          class="indexterm"></a><div
          class="para">
			<code
            class="command">cron</code> 是後台進程，負責執行排定且重複的命令 (每天、每週等)；<code
            class="command">atd</code> 則執行單一的命令，但在未來的某個特定時間點。
		</div><div
          class="para">
			在 Unix 系統裡，很多工作都需定期規律地執行：
		</div><div
          xmlns:d="http://docbook.org/ns/docbook"
          class="itemizedlist"><ul><li
              class="listitem"><div
                class="para">
					迴轉日誌檔；
				</div></li><li
              class="listitem"><div
                class="para">
					更新資料庫供 <code
                  class="command">locate</code> 程式使用；
				</div></li><li
              class="listitem"><div
                class="para">
					備份；
				</div></li><li
              class="listitem"><div
                class="para">
					維護腳本 (諸如清除暫存檔)。
				</div></li></ul></div><div
          class="para">
			預設所有的使用者都可定期執行工作。每個使用者有自己的 <span
            class="emphasis"><em>crontab</em></span> 記錄定期執行的命令。可以使用 <code
            class="command">crontab -e</code> (其內容儲存在 <code
            class="filename">/var/spool/cron/crontabs/<em
              class="replaceable">user</em></code> 檔案內) 命令編輯它。
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>安全</em></span> 限制 <code
                      class="command">cron</code> 或 <code
                      class="command">atd</code></strong></p></div></div></div><div
            class="para">
			限制近用 <code
              class="command">cron</code> 的方法是，新增正面檔案 (白名單) 於 <code
              class="filename">/etc/cron.allow</code> 內，祗有經過授權的使用者才能夠定期執行命令。其他的使用者則無此授權。同樣的，可以把使用者的帳號寫入禁止檔案 (黑名單) <code
              class="filename">/etc/cron.deny</code>，禁止該等搗蛋鬼來亂。<code
              class="command">atd</code> 也有此等功能，列在 <code
              class="filename">/etc/at.allow</code> 和 <code
              class="filename">/etc/at.deny</code> 檔案內。
		</div></div><div
          class="para">
			根使用者有自己的 <span
            class="emphasis"><em>crontab</em></span>，不過也使用 <code
            class="filename">/etc/crontab</code> 檔案，或寫入額外的 <span
            class="emphasis"><em>crontab</em></span> 檔案於 <code
            class="filename">/etc/cron.d</code> 資料夾內。最後兩個解決方案有其優勢，在執行命令時辦識使用者。
		</div><div
          class="para">
			<span
            class="emphasis"><em>cron</em></span> 套件包括預設定期執行的命令：
		</div><div
          xmlns:d="http://docbook.org/ns/docbook"
          class="itemizedlist"><ul><li
              class="listitem"><div
                class="para">
					每小時執行在 <code
                  class="filename">/etc/cron.hourly/</code> 資料夾內的程式；
				</div></li><li
              class="listitem"><div
                class="para">
					每天執行在 <code
                  class="filename">/etc/cron.daily/</code> 資料夾內的程式；
				</div></li><li
              class="listitem"><div
                class="para">
					每週執行在 <code
                  class="filename">/etc/cron.weekly/</code> 資料夾內的程式；
				</div></li><li
              class="listitem"><div
                class="para">
					每月執行在 <code
                  class="filename">/etc/cron.monthly/</code> 資料夾內的程式；
				</div></li></ul></div><div
          class="para">
			很多 Debian 套件依賴此服務：把維護腳本置於此資料夾，確保其服務的最佳運作。
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.format-crontab"></a>9.7.1. <code
                    class="filename">crontab</code> 檔案的格式</h3></div></div></div><a
            id="id-1.12.10.15.2"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>秘訣</em></span> <code
                        class="command">cron</code> 的捷徑</strong></p></div></div></div><div
              class="para">
				<code
                class="command">cron</code> 辨認若干縮寫用以取代 <code
                class="filename">crontab</code> 款目內的前五個欄位。它們對應最經典的排程選項：
			</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
						<code
                      class="literal">@yearly</code>：每年一次 (1月1日的 00:00)；
					</div></li><li
                  class="listitem"><div
                    class="para">
						<code
                      class="literal">@monthly</code>：每月一次 (每月第一天的 00:00)；
					</div></li><li
                  class="listitem"><div
                    class="para">
						<code
                      class="literal">@weekly</code>：每週一次 (星期日的 00:00)；
					</div></li><li
                  class="listitem"><div
                    class="para">
						<code
                      class="literal">@daily</code>：每天一次 (在 00:00)；
					</div></li><li
                  class="listitem"><div
                    class="para">
						<code
                      class="literal">@hourly</code>：每小時一次 (在每小時的開始)。
					</div></li></ul></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>特例</em></span> <code
                        class="command">cron</code> 和日光節約時間</strong></p></div></div></div><div
              class="para">
				在 Debian 裡，<code
                class="command">cron</code> 以最大的能力管理時間 (日光節約時間、或其他在地時間的要求)。因此，需要按小時執行不曾發生的命令 (如，在 2:30 執行指令，配合法國春季時間，2:00 am 向前撥一小時成為 3:00)，在事情發生後立刻執行 (因此在 3:00 am DST)。到了秋季，該命令執行多次 (2:30 am DST 向後撥一小時， 3:00 am DST 成為 2:00 am)。
			</div><div
              class="para">
				然而，還是要小心，外在環境可能突然改變，就該以 <code
                class="command">cron</code> 命令的行為手動檢查其相容性；必要時，準備特別的時程供每年的這兩個麻煩夜晚。
			</div></div><div
            class="para">
				<span
              class="emphasis"><em>crontab</em></span> 每列以六個 (或七個) 欄位描述排定的命令：
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						分鐘的值 (從 0 到 59)；
					</div></li><li
                class="listitem"><div
                  class="para">
						小時值 (從 0 到 23)；
					</div></li><li
                class="listitem"><div
                  class="para">
						每月的日數值 (從 1 到 31)；
					</div></li><li
                class="listitem"><div
                  class="para">
						月的值 (從 1 到 12)；
					</div></li><li
                class="listitem"><div
                  class="para">
						每週的日數值 (從 0 到 7，1 表示星期一，星期天可以是 0 或 7；也可用星期的前三個英文字母表示，如 <code
                    class="literal">Sun</code>、<code
                    class="literal">Mon</code>等)；
					</div></li><li
                class="listitem"><div
                  class="para">
						必須以使用者名稱執行 (在 <code
                    class="filename">/etc/crontab</code> 檔案與其位在 <code
                    class="filename">/etc/cron.d/</code> 內，但不在使用者自己的 crontab 檔案內)；
					</div></li><li
                class="listitem"><div
                  class="para">
						執行的命令 (滿足前五個欄位的條件時)。
					</div></li></ul></div><div
            class="para">
				這些內容的詳情記錄在 <span
              class="citerefentry"><span
                class="refentrytitle">crontab</span>(5)</span> 手冊內。
			</div><div
            class="para">
				每個值都可以表格的清單方式顯示 (以逗點區隔)。<code
              class="literal">a-b</code> 表示在 <code
              class="literal">a</code> 和 <code
              class="literal">b</code> 之間的值。<code
              class="literal">a-b/c</code> 表示以固定增量 <code
              class="literal">c</code> 的間隔 (如：<code
              class="literal">0-10/2</code> 表示實際狀況是 <code
              class="literal">0,2,4,6,8,10</code>)。星號 <code
              class="literal">*</code> 為萬用字元，表示所有的可能值。
			</div><div
            class="example"><a
              xmlns=""
              id="example.crontab"></a><p
              class="title"><strong>範例 9.2. <code
                  class="filename">crontab</code> 檔案的範例</strong></p><div
              class="example-contents"><pre
                class="programlisting">#Format
#min hour day mon dow  command

# Download data every night at 7:25 pm
 25  19   *   *   *    $HOME/bin/get.pl

# 8:00 am, on weekdays (Monday through Friday)
 00  08   *   *   1-5  $HOME/bin/dosomething

# Restart the IRC proxy after each reboot
@reboot /usr/bin/dircproxy</pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>秘訣</em></span> 在根執行命令</strong></p></div></div></div><div
              class="para">
				啟動電腦後，固定執行一次的命令，可以使用 <code
                class="literal">@reboot</code> 巨集 (重新啟動 <code
                class="command">cron</code> 而不必以 <code
                class="literal">@reboot</code> 觸動命令排程)。此巨集取代在 <span
                class="emphasis"><em>crontab</em></span> 款目的前五個欄位。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>其他</em></span> 模擬 <code
                        class="command">cron</code> 用 <code
                        class="command">systemd</code></strong></p></div></div></div><div
              class="para">
				部份 <code
                class="command">cron</code> 的行為，可以用 <code
                class="command">systemd</code> 的時間機制模擬 (見 <a
                class="xref"
                href="unix-services.html#sect.systemd">節 9.1.1, “systemd 啟動系統”</a>)。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.at-command"></a>9.7.2. 使用 <code
                    class="command">at</code> 命令</h3></div></div></div><a
            id="id-1.12.10.16.2"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">at</code> 在未來的特定時間執行某個命令。以命令列參數的模式在指定的時間與日期執行，並把結果以標準方式鍵入。鍵入當前的 shell 就可以執行該命令。<code
              class="command">at</code> 甚至保留當前的環境，以便重現執行該命令的情境。以慣例顯示時間：<code
              class="literal">16:12</code> 或 <code
              class="literal">4:12pm</code> 代表下午 4 點 12 分。日期可以使用歐洲或西方的格式，包括 <code
              class="literal">DD.MM.YY</code> (<code
              class="literal">27.07.15</code> 表示27日7月2015年)，<code
              class="literal">YYYY-MM-DD</code> (等同於 <code
              class="literal">2015-07-27</code>)，<code
              class="literal">MM/DD/[CC]YY</code> (就是，<code
              class="literal">12/25/15</code> 或 <code
              class="literal">12/25/2015</code> 指的是12月25日，2015)，或 <code
              class="literal">MMDD[CC]YY</code> (即 <code
              class="literal">122515</code> 或 <code
              class="literal">12252015</code> 代表12月25日，2015)。少了它，則在時間到就執行 (同一天、或若時間已過則是隔天)。也可寫成 “today” 或 “tomorrow”，就是今天或明天。
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>at 09:00 27.07.15 &lt;&lt;END</code></strong>
<code
              class="computeroutput">&gt; </code><strong
              class="userinput"><code>echo "Don't forget to wish a Happy Birthday to Raphaël!" \</code></strong>
<code
              class="computeroutput">&gt; </code><strong
              class="userinput"><code>  | mail lolando@debian.org</code></strong>
<code
              class="computeroutput">&gt; </code><strong
              class="userinput"><code>END</code></strong>
<code
              class="computeroutput">warning: commands will be executed using /bin/sh
job 31 at Mon Jul 27 09:00:00 2015</code></pre><div
            class="para">
				An alternative syntax postpones the execution for a given duration: <code
              class="command">at now + <em
                class="replaceable">number</em> <em
                class="replaceable">period</em></code>. The <em
              class="replaceable">period</em> can be <code
              class="literal">minutes</code>, <code
              class="literal">hours</code>, <code
              class="literal">days</code>, or <code
              class="literal">weeks</code>. The <em
              class="replaceable">number</em> simply indicates the number of said units that must elapse before execution of the command.
			</div><div
            class="para">
				To cancel a task scheduled by <code
              class="command">cron</code>, simply run <code
              class="command">crontab -e</code> and delete the corresponding line in the <span
              class="emphasis"><em>crontab</em></span> file. For <code
              class="command">at</code> tasks, it is almost as easy: run <code
              class="command">atrm <em
                class="replaceable">task-number</em></code>. The task number is indicated by the <code
              class="command">at</code> command when you scheduled it, but you can find it again with the <code
              class="command">atq</code> command, which gives the current list of scheduled tasks.
			</div><a
            id="id-1.12.10.16.7"
            class="indexterm"></a><a
            id="id-1.12.10.16.8"
            class="indexterm"></a></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.inetd.html"><strong>前一頁</strong>9.6. The inetd 超級伺服器</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一層</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始頁</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.asynchronous-task-scheduling-anacron.html"><strong>下一頁</strong>9.8. Scheduling Asynchronous Tasks: anacron</a></li></ul></body></html>
