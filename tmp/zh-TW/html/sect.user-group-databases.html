<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">8.4. 使用者與群組資料庫</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-zh-TW-1.0-1" /><meta
        name="keywords"
        content="組態, 在地化, 地區設定, 網路, 名稱解析, 使用者, 群組, 帳號, 命令列解析器, Shell, 列印, 啟動程式, 編譯核心" /><link
        rel="home"
        href="index.html"
        title="The Debian Administrator's Handbook" /><link
        rel="up"
        href="basic-configuration.html"
        title="章 8. 基本組態：網路、帳號、列印..." /><link
        rel="prev"
        href="sect.hostname-name-service.html"
        title="8.3. 設定主機名稱與組態名稱服務" /><link
        rel="next"
        href="sect.creating-accounts.html"
        title="8.5. 新增帳號" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/zh-TW/stable/sect.user-group-databases.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.hostname-name-service.html"><strong>前一頁</strong></a></li><li
          class="home">The Debian Administrator's Handbook</li><li
          class="next"><a
            accesskey="n"
            href="sect.creating-accounts.html"><strong>下一頁</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.user-group-databases"></a>8.4. 使用者與群組資料庫</h2></div></div></div><a
          id="id-1.11.8.2"
          class="indexterm"></a><a
          id="id-1.11.8.3"
          class="indexterm"></a><a
          id="id-1.11.8.4"
          class="indexterm"></a><a
          id="id-1.11.8.5"
          class="indexterm"></a><div
          class="para">
			使用者清單通常儲存在 <code
            class="filename">/etc/passwd</code> 檔案內，把編碼後的密碼儲存在 <code
            class="filename">/etc/shadow</code> 檔案內。這兩個檔案都是純文字檔，以簡單的格式儲存，可以用文字編輯器讀取與修改。每個使用者佔一列，其欄位以冒號區隔 (“<code
            class="literal">:</code>”)。
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>說明</em></span> 編輯系統檔案</strong></p></div></div></div><div
            class="para">
			本章討論的系統檔案都是純文字檔，可以用文字編輯器處理。這些檔案對核心系統的運作極為重要，編輯該等檔案時多加慎重不會錯的。首先，先複製或備份原檔案。第二，在伺服器或多人可同時近用該等檔案的機器上，多費心以防止檔案損壞。
		</div><div
            class="para">
			為了達成此目標，最好使用 <code
              class="command">vipw</code> 命令編輯 <code
              class="filename">/etc/passwd</code> 檔案，或使用 <code
              class="command">vigr</code> 命令編輯 <code
              class="filename">/etc/group</code> 檔案。這些命令會先鎖住該等檔案再執行文字編輯器， (預設使用 <code
              class="command">vi</code> 命令，除非 <code
              class="varname">EDITOR</code> 環境變數有其他的設定)。加上 <code
              class="literal">-s</code> 選項可同時編輯對應的 <span
              class="foreignphrase"><em
                class="foreignphrase">shadow</em></span> 檔案。
		</div></div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>基本</em></span> Crypt，單向的函數</strong></p></div></div></div><a
            id="id-1.11.8.8.2"
            class="indexterm"></a><div
            class="para">
			<code
              class="command">crypt</code> 是單向函數以特別的方法把字串 (<code
              class="varname">A</code>) 轉換成另個字串 (<code
              class="varname">B</code>)，轉換後無法回覆成 <code
              class="varname">A</code> 經由 <code
              class="varname">B</code>。辨識 <code
              class="varname">A</code> 的唯一方法是逐一測試所有可能的值，查驗等同於 <code
              class="varname">B</code> 的結果。最多可輸入 8 個字元 (字串 <code
              class="varname">A</code>) 然後產生 13 個字元的可列印 ASCII 字元 (字串 <code
              class="varname">B</code>)。
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.etc-passwd"></a>8.4.1. 使用者清單：<code
                    class="filename">/etc/passwd</code></h3></div></div></div><div
            class="para">
				在 <code
              class="filename">/etc/passwd</code> 檔案內的欄位清單：
			</div><a
            id="id-1.11.8.9.3"
            class="indexterm"></a><a
            id="id-1.11.8.9.4"
            class="indexterm"></a><a
            id="id-1.11.8.9.5"
            class="indexterm"></a><a
            id="id-1.11.8.9.6"
            class="indexterm"></a><a
            id="id-1.11.8.9.7"
            class="indexterm"></a><a
            id="id-1.11.8.9.8"
            class="indexterm"></a><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						登入，例如 <code
                    class="literal">rhertzog</code>；
					</div></li><li
                class="listitem"><div
                  class="para">
						password：就是密碼加密的單向函數 (<code
                    class="command">crypt</code>)，使用 <code
                    class="literal">DES</code>、<code
                    class="literal">MD5</code>、<code
                    class="literal">SHA-256</code> 或 <code
                    class="literal">SHA-512</code>。以特別符號 “<code
                    class="literal">x</code>” 表示加密後的密碼儲存在<code
                    class="filename">/etc/shadow</code>；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">uid</code>：用於辨識個別使用者的不重複數字；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">gid</code>：使用者主要群組 (Debian 的預設值係為每個使用者建立一個群組) 的不重複號碼；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">GECOS</code>：通常儲存使用者全名的資料欄；
					</div></li><li
                class="listitem"><div
                  class="para">
						登入資料夾，用於儲存使用者的個人檔案 (環境變數 <code
                    class="varname">$HOME</code> 通常指向此處)；
					</div></li><li
                class="listitem"><div
                  class="para">
						登入時執行的程式。通常是命令解譯器 (shell)，若指定為 <code
                    class="command">/bin/false</code> (不做任何事並立即回到控制)，則使用者無法登入。
					</div></li></ul></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>基本</em></span> Unix 群組</strong></p></div></div></div><a
              id="id-1.11.8.9.10.2"
              class="indexterm"></a><div
              class="para">
				Unix 群組是包括多個使用者的實體，以整合授權系統可以共享檔案 (具有同樣的權限)。可以限定程式供指定的群組使用。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.etc-shadow"></a>8.4.2. 隱藏與加密的密碼檔：<code
                    class="filename">/etc/shadow</code></h3></div></div></div><a
            id="id-1.11.8.10.2"
            class="indexterm"></a><a
            id="id-1.11.8.10.3"
            class="indexterm"></a><div
            class="para">
				The <code
              class="filename">/etc/shadow</code> 檔案含以下的欄位：
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						登入；
					</div></li><li
                class="listitem"><div
                  class="para">
						加密的密碼；
					</div></li><li
                class="listitem"><div
                  class="para">
						管理密碼期限的欄位。
					</div></li></ul></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>文件</em></span> <code
                        class="filename">/etc/passwd</code>、<code
                        class="filename">/etc/shadow</code> 與 <code
                        class="filename">/etc/group</code> 檔案格式</strong></p></div></div></div><div
              class="para">
				這些格式記錄在下列的手冊頁面：<span
                class="citerefentry"><span
                  class="refentrytitle">passwd</span>(5)</span>、<span
                class="citerefentry"><span
                  class="refentrytitle">shadow</span>(5)</span>、與 <span
                class="citerefentry"><span
                  class="refentrytitle">group</span>(5)</span>。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>安全</em></span> <code
                        class="filename">/etc/shadow</code> 檔案安全</strong></p></div></div></div><div
              class="para">
				<code
                class="filename">/etc/shadow</code>，不同於它的分身，<code
                class="filename">/etc/passwd</code>，不能被一般使用者讀取。儲存在 <code
                class="filename">/etc/passwd</code> 內的加密後密碼可被任何人讀取；破壞者可以用 “暴力” 法破壞它們，以常見的編碼字元破解。這種攻擊方式 — 稱為 "字典攻擊" — 對於使用 <code
                class="filename">/etc/shadow</code> 的系統是無效的。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.account-modification"></a>8.4.3. 修改既有的帳號或密碼</h3></div></div></div><a
            id="id-1.11.8.11.2"
            class="indexterm"></a><a
            id="id-1.11.8.11.3"
            class="indexterm"></a><a
            id="id-1.11.8.11.4"
            class="indexterm"></a><a
            id="id-1.11.8.11.5"
            class="indexterm"></a><a
            id="id-1.11.8.11.6"
            class="indexterm"></a><div
            class="para">
				以下的命令允許修改使用者資料庫內的特定欄位資料：<code
              class="command">passwd</code> 允許使用者更改自己的密碼，並更新 <code
              class="filename">/etc/shadow</code> 檔案；<code
              class="command">chfn</code> (CHange Full Name)，保留給超級使用者 (root) 專用，修改 <code
              class="literal">GECOS</code> 欄位。<code
              class="command">chsh</code> (CHange SHell) 允許使用者變更自己的登入 shell，但祗限列名在 <code
              class="filename">/etc/shells</code> 之內；另一方面，管理者不受此限，且可設定任何 shell。
			</div><div
            class="para">
				最後，<code
              class="command">chage</code> (CHange AGE) 命令允許管理者變更密碼的有效期 (<code
              class="literal">-l <em
                class="replaceable">使用者</em></code> 選項列出現在的設定)。以 <code
              class="command">passwd -e <em
                class="replaceable">使用者</em></code> 命令強迫密碼失效，要求使用者登錄時變更密碼才能繼續使用。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.disabling-account"></a>8.4.4. 帳號禁用</h3></div></div></div><a
            id="id-1.11.8.12.2"
            class="indexterm"></a><a
            id="id-1.11.8.12.3"
            class="indexterm"></a><div
            class="para">
				有時需要 “禁用一個帳號” (關閉某使用者)，基於紀律考量、調查、或使用者太久未登入。被禁用的帳號表示該使用者不能登入或近用該機器。帳號還在機器內且檔案與資料都未被刪除木；祗是不能使用。以 <code
              class="command">passwd -l <em
                class="replaceable">使用者</em></code> (鎖定) 命令就能夠達成。以同樣的方式另個選項 <code
              class="literal">-u</code> (解鎖) 就可恢復該帳號。
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.intro-nss"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>下一步</em></span> NSS 與系統資料庫</strong></p></div></div></div><a
              id="id-1.11.8.12.5.2"
              class="indexterm"></a><a
              id="id-1.11.8.12.5.3"
              class="indexterm"></a><div
              class="para">
				與其使用檔案管理使用者與群組清單，還可使用其他資料庫類型，諸如 LDAP 或 <code
                class="command">db</code>，藉由適當的 NSS (Name Service Switch 姓名服務切換) 模組。可用的模組列在 <code
                class="filename">/etc/nsswitch.conf</code> 檔案內，在 <code
                class="literal">passwd</code>、<code
                class="literal">shadow</code> 與 <code
                class="literal">group</code> 款目下。LDAP 下的 NSS 模組使用法，見 <a
                class="xref"
                href="sect.ldap-directory.html#sect.config-nss">節 11.7.3.1, “Configuring NSS”</a>。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.etc-group"></a>8.4.5. 群組清單：<code
                    class="filename">/etc/group</code></h3></div></div></div><div
            class="para">
				群組列在 <code
              class="filename">/etc/group</code> 檔案內，單純的文字資料庫類似 <code
              class="filename">/etc/passwd</code> 檔案，包括以下的欄位：
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						群組名稱；
					</div></li><li
                class="listitem"><div
                  class="para">
						密碼 (選項)：加入群組會用到 (以 <code
                    class="command">newgrp</code> 或 <code
                    class="command">sg</code> 命令，見專欄 <a
                    class="xref"
                    href="sect.user-group-databases.html#sidebar.working-with-several-groups"><span
                      class="emphasis"><em>基本</em></span> 在多個群組工作</a>)；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">gid</code>：不重複的群組辨識碼；
					</div></li><li
                class="listitem"><div
                  class="para">
						成員清單：屬於此群組的使用者名稱清單，以逗點區隔。
					</div></li></ul></div><div
            class="para">
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.working-with-several-groups"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>基本</em></span> 在多個群組工作</strong></p></div></div></div><a
              id="id-1.11.8.13.5.2"
              class="indexterm"></a><a
              id="id-1.11.8.13.5.3"
              class="indexterm"></a><a
              id="id-1.11.8.13.5.4"
              class="indexterm"></a><a
              id="id-1.11.8.13.5.5"
              class="indexterm"></a><div
              class="para">
				終端使用者可能參加多個群組；其中一個是自己的 “主要群組”。使用者自己的主要群組，使用者初始組態時自動產生的預設值。使用者新增的檔案自動屬於該讀者，以及其主要群組。這種方式並不完全合意；例如，使用者需要在自己主要群組之外的資料夾工作，與其他群組共享其檔案。在這種情況下，使用者需以命令：<code
                class="command">newgrp</code> 變更其主要群組，產生新的 shell，或以 <code
                class="command">sg</code> 命令，使用其他群組。這些命令也允許使用者加入其他群組。若該等群組受密碼保護，則需先取得密碼才能執行該等命令。
			</div><div
              class="para">
				使用者還可以設定資料夾的 <code
                class="literal">setgid</code> 位元，讓該資料夾內的檔案自動屬於特定群組。詳情見專欄 <a
                class="xref"
                href="sect.rights-management.html#sidebar.setgid-dir"><span
                  class="emphasis"><em>安全</em></span> <code
                  class="literal">setgid</code> 資料夾和 <span
                  class="emphasis"><em>sticky bit</em></span></a>。
			</div><div
              class="para">
				<code
                class="command">id</code> 命令顯示使用者現在的狀態，包括個人辨識碼 (<code
                class="varname">uid</code> 變數)、現在的主要群組 (<code
                class="varname">gid</code> variable)、以及其所屬群組的清單 (<code
                class="varname">groups</code> 變數)。
			</div></div><a
            id="id-1.11.8.13.6"
            class="indexterm"></a><a
            id="id-1.11.8.13.7"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">addgroup</code> 與 <code
              class="command">delgroup</code> 命令可以新增或刪除群組。<code
              class="command">groupmod</code> 命令修改群組的資訊 (其 <code
              class="literal">gid</code> 或辨識碼)。命令 <code
              class="command">passwd -g <em
                class="replaceable">group</em></code> 可變更群組的密碼，<code
              class="command">passwd -r -g <em
                class="replaceable">group</em></code> 命令可刪除群組的密碼。
			</div><a
            id="id-1.11.8.13.9"
            class="indexterm"></a><a
            id="id-1.11.8.13.10"
            class="indexterm"></a><a
            id="id-1.11.8.13.11"
            class="indexterm"></a><a
            id="id-1.11.8.13.12"
            class="indexterm"></a><a
            id="id-1.11.8.13.13"
            class="indexterm"></a><a
            id="id-1.11.8.13.14"
            class="indexterm"></a><a
            id="id-1.11.8.13.15"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>秘訣</em></span> <code
                        class="command">getent</code></strong></p></div></div></div><a
              id="id-1.11.8.13.16.2"
              class="indexterm"></a><div
              class="para">
				<code
                class="command">getent</code> (取得款目的意思 get entries) 命令使用適當的程式庫函數，呼叫組態於 <code
                class="filename">/etc/nsswitch.conf</code> 檔案的 NSS 模組，以標準方式檢查系統資料庫。此命令需要一個或兩個參數：被檢查的資料庫名稱、以及可能的搜尋鍵詞。因此，<code
                class="command">getent passwd rhertzog</code> 命令將從使用者 <code
                class="literal">rhertzog</code> 中給予使用者資料庫。
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.hostname-name-service.html"><strong>前一頁</strong>8.3. 設定主機名稱與組態名稱服務</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一層</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始頁</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.creating-accounts.html"><strong>下一頁</strong>8.5. 新增帳號</a></li></ul></body></html>
