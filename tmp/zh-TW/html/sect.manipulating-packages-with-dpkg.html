<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">5.4. 以 dpkg 管理套件</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-zh-TW-1.0-1" /><meta
        name="keywords"
        content="執行檔套件, 原始檔套件, dpkg, 相依性, 衝突" /><link
        rel="home"
        href="index.html"
        title="Debian管理者手冊" /><link
        rel="up"
        href="packaging-system.html"
        title="章 5. 套件系統：工具與基本原則" /><link
        rel="prev"
        href="sect.source-package-structure.html"
        title="5.3. 原始套件的結構" /><link
        rel="next"
        href="sect.coexistence-with-other-packaging-systems.html"
        title="5.5. 與其他打包系統共存" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/zh-TW/stable/sect.manipulating-packages-with-dpkg.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.source-package-structure.html"><strong>前一頁</strong></a></li><li
          class="home">Debian管理者手冊</li><li
          class="next"><a
            accesskey="n"
            href="sect.coexistence-with-other-packaging-systems.html"><strong>下一頁</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.manipulating-packages-with-dpkg"></a>5.4. 以 <code
                  class="command">dpkg</code> 管理套件</h2></div></div></div><a
          id="id-1.8.8.2"
          class="indexterm"></a><div
          class="para">
			<code
            class="command">dpkg</code> 是系統層面處理 Debian 套件的基礎指令。若您有 <code
            class="filename">.deb</code> 套件，可以用 <code
            class="command">dpkg</code> 安裝及分析其內容。但此指令祗能看到 Debian 世界的部份內容：它知道系統安裝那些套件、指令列給了那些參數，但不知道還有那些可用的套件。因此，沒有相依性就完了。<code
            class="command">apt</code> 之類的工具，則可產生相依性清單，儘量自動安裝套件。
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>說明</em></span> <code
                      class="command">dpkg</code> 或 <code
                      class="command">apt</code>?</strong></p></div></div></div><div
            class="para">
			<code
              class="command">dpkg</code> 應視為系統工具 (背景) 之一，而 <code
              class="command">apt</code> 則是較傾向使用者的工具，可克服前者的限制。這些工具各有其限制，共同解決特定的作業。
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.8.8.5"></a>5.4.1. 安裝套件</h3></div></div></div><a
            id="id-1.8.8.5.2"
            class="indexterm"></a><a
            id="id-1.8.8.5.3"
            class="indexterm"></a><div
            class="para">
				首先，<code
              class="command">dpkg</code> 是安裝 Debian 已經可用套件的工具 (因為不需下載任何東西)。我們使用它的 <code
              class="literal">-i</code> 或 <code
              class="literal">--install</code> 選項。
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.8.8.5.5"></a><p
              class="title"><strong>範例 5.2. 以 <code
                  class="command">dpkg</code> 安裝套件</strong></p><div
              class="example-contents"><pre
                class="screen scale">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg -i man-db_2.7.6.1-2_amd64.deb</code></strong>
<code
                  class="computeroutput">(Reading database ... 110431 files and directories currently installed.)
Preparing to unpack man-db_2.7.6.1-2_amd64.deb ...
Unpacking man-db (2.7.6.1-2) over (2.7.6.1-1) ...
Setting up man-db (2.7.6.1-2) ...
Updating database of manual pages ...
Processing triggers for mime-support (3.60) ...</code></pre></div></div><div
            class="para">
				我們可看到 <code
              class="command">dpkg</code> 執行的不同階段；因此，我們知道可能發生錯誤的時刻。安裝可能分為兩個階段；解壓縮、組態。<code
              class="command">apt-get</code> 用到此等階段，限制被 <code
              class="command">dpkg</code> 調用的內容 (因為調用的過程極為費力，必須載入記憶體的資料庫，尤其是已經被安裝清單內的)。
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.8.8.5.7"></a><p
              class="title"><strong>範例 5.3. 分開解壓與組態</strong></p><div
              class="example-contents"><pre
                class="screen scale">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg --unpack man-db_2.7.6.1-2_amd64.deb</code></strong>
<code
                  class="computeroutput">(Reading database ... 110431 files and directories currently installed.)
Preparing to unpack man-db_2.7.6.1-2_amd64.deb ...
Unpacking man-db (2.7.6.1-2) over (2.7.6.1-2) ...
Processing triggers for mime-support (3.60) ...
# </code><strong
                  class="userinput"><code>dpkg --configure man-db</code></strong>
<code
                  class="computeroutput">Setting up man-db (2.7.6.1-2) ...
Updating database of manual pages ...
</code></pre></div></div><a
            id="id-1.8.8.5.8"
            class="indexterm"></a><a
            id="id-1.8.8.5.9"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">dpkg</code> 安裝套件時偶而失敗並送回錯誤的訊息；若使用者要求忽略該等訊息，就能送出警示；這就是 <code
              class="literal">--force-*</code> 選項的用途。<code
              class="command">dpkg --force-help</code> 命令，或此命令的文件，將提供完整的選項。最常發生的錯誤，遲早每個人都會碰到，就是檔案衝突。已被其他套件安裝使用的檔案，另個套件同時需要用到它時，<code
              class="command">dpkg</code> 會於安裝時再次使手它。此時出現以下的訊息：
			</div><pre
            class="screen">
<code
              class="computeroutput">Unpacking libgdm (from .../libgdm_3.8.3-2_amd64.deb) ...
dpkg: 處理 /var/cache/apt/archives/libgdm_3.8.3-2_amd64.deb (--unpack) 時發生錯誤:
 試圖覆寫 '/usr/bin/gdmflexiserver'，也同時在套件 gdm3 3.4.1-9 內</code></pre><div
            class="para">
				碰到此情況，若您認為取代此檔案不會對系統的穩定產生重大的風險 (通常如此)，您可使用選項 <code
              class="literal">--force-overwrite</code>，告訴 <code
              class="command">dpkg</code> 忽略此錯誤並覆寫該檔案。
			</div><div
            class="para">
				<code
              class="literal">--force-*</code> 有很多選項，祗有 <code
              class="literal">--force-overwrite</code> 是固定使用的。這些選項祗存在於極為特殊的情況，最好是儘量不要碰它以尊重套件本身的機制。別忘了，這些機制確保系統的一致性與穩定性。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>注意</em></span> 有效使用 <code
                        class="literal">--force-*</code></strong></p></div></div></div><a
              id="id-1.8.8.5.14.2"
              class="indexterm"></a><div
              class="para">
				若不小心使用 <code
                class="literal">--force-*</code> 的選項，可能造成 APT 命令家族拒絕運作的困境。在相依性不足或衝突的情況下，使用部份選項後，仍可安裝該等套件。結果就是相依性不足的不一致系統，APT 命令將拒絕執行任何工作，直到系統恢復一致 (通常包括安裝遺失的相依套件或移除問題套件)。通常出現以下的訊息，安裝新版 <span
                class="pkg pkg">rdesktop</span> 時忽略其對新版 <span
                class="pkg pkg">libc6</span> 的相依性：
			</div><pre
              class="screen"><code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt full-upgrade
</code></strong><code
                class="computeroutput">[...]
You might want to run 'apt-get -f install' to correct these.
The following packages have unmet dependencies:
  rdesktop: Depends: libc6 (&gt;= 2.5) but 2.3.6.ds1-13etch7 is installed
E: Unmet dependencies. Try using -f.</code></pre><div
              class="para">
				確信其分析結果的勇敢管理者，可能選擇忽略使用 <code
                class="literal">--force-*</code> 選項時發生的相依性問題與衝突。結果是，想要繼續使用 <code
                class="command">apt</code> 或 <code
                class="command">aptitude</code> 的話，他們必須先編輯 <code
                class="filename">/var/lib/dpkg/status</code> 以刪除/修改相依性問題或衝突。
			</div><div
              class="para">
				這是一種醜陋的黑客行為，除了極為必要的情況，否則不該發生。比較常見的手法是，重新編譯有問題的套件 (見 <a
                class="xref"
                href="debian-packaging.html#sect.rebuilding-package">節 15.1, “Rebuilding a Package from its Sources”</a>) 或從 <code
                class="literal">stable-backports</code> 裡 (see <a
                class="xref"
                href="apt.html#sect.backports">節 6.1.2.4, “穩定回移”</a>)，使用新版本 (可能已修復該問題) 的套件。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.8.8.6"></a>5.4.2. 移除套件</h3></div></div></div><a
            id="id-1.8.8.6.2"
            class="indexterm"></a><a
            id="id-1.8.8.6.3"
            class="indexterm"></a><a
            id="id-1.8.8.6.4"
            class="indexterm"></a><a
            id="id-1.8.8.6.5"
            class="indexterm"></a><div
            class="para">
				使用 <code
              class="command">dpkg</code> 加上 <code
              class="literal">-r</code> 或 <code
              class="literal">--remove</code> 選項，再加上套件名稱，就可移除該套件。然而，這種方式的移除並不完整：仍保留所有的組態檔、維護腳本、記錄檔案 (系統記錄檔) 及該套件的其他使用者資料。這種方式是停用程式，仍可以相同的組態快速地再安裝回來。完全移除該套件的所有相關檔案，應使用 <code
              class="literal">-P</code> 或 <code
              class="literal">--purge</code> 選項，再加上套件名稱。
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.8.8.6.7"></a><p
              class="title"><strong>範例 5.4. 移除與清除 <span
                  class="pkg pkg">debian-cd</span> 套件</strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg -r debian-cd</code></strong>
<code
                  class="computeroutput">(Reading database ... 112188 files and directories currently installed.)
Removing debian-cd (3.1.20) ...
# </code><strong
                  class="userinput"><code>dpkg -P debian-cd</code></strong>
<code
                  class="computeroutput">(Reading database ... 111613 files and directories currently installed.)
Purging configuration files for debian-cd (3.1.20) ...
</code></pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.8.8.7"></a>5.4.3. 查詢 <code
                    class="command">dpkg</code> 的資料庫與檢查 <code
                    class="filename">.deb</code> 檔案</h3></div></div></div><a
            id="id-1.8.8.7.2"
            class="indexterm"></a><a
            id="id-1.8.8.7.3"
            class="indexterm"></a><a
            id="id-1.8.8.7.4"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>回到</em></span> 選項語法</strong></p></div></div></div><div
              class="para">
				“長” 版 (一個或多個字，前置兩個連結號) 與 “短” 版 (一個字母，通常是長版字的第一個字母，前置一個連結號) 套件都有該等選項。這是 POSIX 標準常見的用法。
			</div></div><div
            class="para">
				做結論前，我們將學習查詢內部資料庫以獲取資訊的 <code
              class="command">dpkg</code> 選項。先給長版的選項再給對應的短版選項 (其參數是一樣的) 以 <code
              class="literal">--listfiles <em
                class="replaceable">套件</em></code> (或 <code
              class="literal">-L</code>) 為例，列出該套件安裝的檔案清單；<code
              class="literal">--search <em
                class="replaceable">檔案</em></code> (或 <code
              class="literal">-S</code>)，尋找包括該檔案的套性；<code
              class="literal">--status <em
                class="replaceable">套件</em></code> (或 <code
              class="literal">-s</code>)，顯示該套件的標頭；<code
              class="literal">--list</code> (或 <code
              class="literal">-l</code>)，顯示該系統內套件清單與安裝狀態；<code
              class="literal">--contents <em
                class="replaceable">file.deb</em></code> (或 <code
              class="literal">-c</code>)，列出 Debian 指定套件清單；<code
              class="literal">--info<em
                class="replaceable"> file.deb </em></code> (或 <code
              class="literal">-I</code>)，列出該套件的標頭。
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.8.8.7.7"></a><p
              class="title"><strong>範例 5.5. <code
                  class="command">dpkg</code> 的各種查詢</strong></p><div
              class="example-contents"><pre
                class="screen scale"
                width="80">
<code
                  class="computeroutput">$ </code><strong
                  class="userinput"><code>dpkg -L base-passwd</code></strong>
<code
                  class="computeroutput">/.
/usr
/usr/sbin
/usr/sbin/update-passwd
/usr/share
/usr/share/base-passwd
/usr/share/base-passwd/group.master
/usr/share/base-passwd/passwd.master
/usr/share/doc
/usr/share/doc/base-passwd
/usr/share/doc/base-passwd/README
/usr/share/doc/base-passwd/changelog.gz
/usr/share/doc/base-passwd/copyright
/usr/share/doc/base-passwd/users-and-groups.html
/usr/share/doc/base-passwd/users-and-groups.txt.gz
/usr/share/doc-base
/usr/share/doc-base/users-and-groups
/usr/share/lintian
/usr/share/lintian/overrides
/usr/share/lintian/overrides/base-passwd
/usr/share/man
/usr/share/man/de
/usr/share/man/de/man8
/usr/share/man/de/man8/update-passwd.8.gz
/usr/share/man/es
/usr/share/man/es/man8
/usr/share/man/es/man8/update-passwd.8.gz
/usr/share/man/fr
/usr/share/man/fr/man8
/usr/share/man/fr/man8/update-passwd.8.gz
/usr/share/man/ja
/usr/share/man/ja/man8
/usr/share/man/ja/man8/update-passwd.8.gz
/usr/share/man/man8
/usr/share/man/man8/update-passwd.8.gz
/usr/share/man/pl
/usr/share/man/pl/man8
/usr/share/man/pl/man8/update-passwd.8.gz
/usr/share/man/ru
/usr/share/man/ru/man8
/usr/share/man/ru/man8/update-passwd.8.gz
$ </code><strong
                  class="userinput"><code>dpkg -S /bin/date</code></strong>
<code
                  class="computeroutput">coreutils: /bin/date
$ </code><strong
                  class="userinput"><code>dpkg -s coreutils</code></strong>
<code
                  class="computeroutput">Package: coreutils
Essential: yes
Status: install ok installed
Priority: required
Section: utils
Installed-Size: 15103
Maintainer: Michael Stone &lt;mstone@debian.org&gt;
Architecture: amd64
Multi-Arch: foreign
Version: 8.26-3
Replaces: mktemp, realpath, timeout
Pre-Depends: libacl1 (&gt;= 2.2.51-8), libattr1 (&gt;= 1:2.4.46-8), libc6 (&gt;= 2.17), libselinux1 (&gt;= 2.1.13)
Conflicts: timeout
Description: GNU core utilities
 This package contains the basic file, shell and text manipulation
 utilities which are expected to exist on every operating system.
 .
 Specifically, this package includes:
 arch base64 basename cat chcon chgrp chmod chown chroot cksum comm cp
 csplit cut date dd df dir dircolors dirname du echo env expand expr
 factor false flock fmt fold groups head hostid id install join link ln
 logname ls md5sum mkdir mkfifo mknod mktemp mv nice nl nohup nproc numfmt
 od paste pathchk pinky pr printenv printf ptx pwd readlink realpath rm
 rmdir runcon sha*sum seq shred sleep sort split stat stty sum sync tac
 tail tee test timeout touch tr true truncate tsort tty uname unexpand
 uniq unlink users vdir wc who whoami yes
Homepage: http://gnu.org/software/coreutils
$ </code><strong
                  class="userinput"><code>dpkg -l 'b*'</code></strong>
<code
                  class="computeroutput">Desired=Unknown/Install/Remove/Purge/Hold
| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend
|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)
||/ Name                 Version         Architecture    Description
+++-====================-===============-===============-=============================================
un  backupninja          &lt;none&gt;          &lt;none&gt;          (no description available)
un  backuppc             &lt;none&gt;          &lt;none&gt;          (no description available)
un  baekmuk-ttf          &lt;none&gt;          &lt;none&gt;          (no description available)
un  base                 &lt;none&gt;          &lt;none&gt;          (no description available)
un  base-config          &lt;none&gt;          &lt;none&gt;          (no description available)
ii  base-files           9.9+deb9u1      amd64           Debian base system miscellaneous files
ii  base-passwd          3.5.43          amd64           Debian base system master password and group 
ii  bash                 4.4-5           amd64           GNU Bourne Again SHell
[...]
$ </code><strong
                  class="userinput"><code>dpkg -c /var/cache/apt/archives/gnupg_2.1.18-8~deb9u1_amd64.deb</code></strong>
<code
                  class="computeroutput">drwxr-xr-x root/root         0 2017-09-18 20:41 ./
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/bin/
-rwxr-xr-x root/root    996648 2017-09-18 20:41 ./usr/bin/gpg
-rwxr-xr-x root/root      3444 2017-09-18 20:41 ./usr/bin/gpg-zip
-rwxr-xr-x root/root    161192 2017-09-18 20:41 ./usr/bin/gpgconf
-rwxr-xr-x root/root     26696 2017-09-18 20:41 ./usr/bin/gpgparsemail
-rwxr-xr-x root/root     76112 2017-09-18 20:41 ./usr/bin/gpgsplit
-rwxr-xr-x root/root    158344 2017-09-18 20:41 ./usr/bin/kbxutil
-rwxr-xr-x root/root      1081 2014-06-25 16:17 ./usr/bin/lspgpot
-rwxr-xr-x root/root      2194 2017-09-18 20:41 ./usr/bin/migrate-pubring-from-classic-gpg
-rwxr-xr-x root/root     14328 2017-09-18 20:41 ./usr/bin/watchgnupg
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/sbin/
-rwxr-xr-x root/root      3078 2017-09-18 20:41 ./usr/sbin/addgnupghome
-rwxr-xr-x root/root      2219 2017-09-18 20:41 ./usr/sbin/applygnupgdefaults
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/share/
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/share/doc/
drwxr-xr-x root/root         0 2017-09-18 20:41 ./usr/share/doc/gnupg/
-rw-r--r-- root/root     18964 2017-01-23 18:39 ./usr/share/doc/gnupg/DETAILS.gz
[...]
$ </code><strong
                  class="userinput"><code>dpkg -I /var/cache/apt/archives/gnupg_2.1.18-8~deb9u1_amd64.deb</code></strong>
<code
                  class="computeroutput"> new debian package, version 2.0.
 size 1124042 bytes: control archive=2221 bytes.
    1388 bytes,    24 lines      control              
    2764 bytes,    43 lines      md5sums              
 Package: gnupg
 Source: gnupg2
 Version: 2.1.18-8~deb9u1
 Architecture: amd64
 Maintainer: Debian GnuPG Maintainers &lt;pkg-gnupg-maint@lists.alioth.debian.org&gt;
 Installed-Size: 2088
 Depends: gnupg-agent (= 2.1.18-8~deb9u1), libassuan0 (&gt;= 2.0.1), libbz2-1.0, libc6 (&gt;= 2.15), libgcrypt20 (&gt;= 1.7.0), libgpg-error0 (&gt;= 1.14), libksba8 (&gt;= 1.3.4), libreadline7 (&gt;= 6.0), libsqlite3-0 (&gt;= 3.7.15), zlib1g (&gt;= 1:1.1.4)
 Recommends: dirmngr (= 2.1.18-8~deb9u1), gnupg-l10n (= 2.1.18-8~deb9u1)
 Suggests: parcimonie, xloadimage
 Breaks: debsig-verify (&lt;&lt; 0.15), dirmngr (&lt;&lt; 2.1.18-8~deb9u1), gnupg2 (&lt;&lt; 2.1.11-7+exp1), libgnupg-interface-perl (&lt;&lt; 0.52-3), libgnupg-perl (&lt;= 0.19-1), libmail-gnupg-perl (&lt;= 0.22-1), monkeysphere (&lt;&lt; 0.38~), php-crypt-gpg (&lt;= 1.4.1-1), python-apt (&lt;= 1.1.0~beta4), python-gnupg (&lt;&lt; 0.3.8-3), python3-apt (&lt;= 1.1.0~beta4)
 Replaces: gnupg2 (&lt;&lt; 2.1.11-7+exp1)
 Provides: gpg
 Section: utils
 Priority: optional
 Multi-Arch: foreign
 Homepage: https://www.gnupg.org/
 Description: GNU privacy guard - a free PGP replacement
  GnuPG is GNU's tool for secure communication and data storage.
  It can be used to encrypt data and to create digital signatures.
  It includes an advanced key management facility and is compliant
  with the proposed OpenPGP Internet standard as described in RFC4880.
[...]</code></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>進一步</em></span> 版本的比較</strong></p></div></div></div><a
              id="id-1.8.8.7.8.2"
              class="indexterm"></a><a
              id="id-1.8.8.7.8.3"
              class="indexterm"></a><div
              class="para">
				因為 <code
                class="command">dpkg</code> 是處理 Debian 套件的程式，它也能夠邏輯地比較版本編號。所以有 <code
                class="literal">--compare-versions</code> 選項，以外部程式使用它 (尤其是被 <code
                class="command">dpkg</code> 本身執行的組態腳本)。這個選項需要三個參數：版本編號、比較運算元、以及第二個版本編號。可能的運算元為 <code
                class="literal">lt</code> (小於)、<code
                class="literal">le</code> (大於或等於)、<code
                class="literal">eq</code> (等於)、<code
                class="literal">ne</code> (不等於)、<code
                class="literal">ge</code> (大於或等於)、以及 <code
                class="literal">gt</code> (大於)。若比較結果正確，<code
                class="command">dpkg</code> 送回 0 (成功)；若不正確，則送回 0 以外的數值 (表示失敗)。
			</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --compare-versions 1.2-3 gt 1.1-4</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">0
$ </code><strong
                class="userinput"><code>dpkg --compare-versions 1.2-3 lt 1.1-4</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">1
$ </code><strong
                class="userinput"><code>dpkg --compare-versions 2.6.0pre3-1 lt 2.6.0-1</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">1</code></pre><div
              class="para">
				注意前例最後一個比較的失敗：<code
                class="command">dpkg</code>、<code
                class="literal">pre</code>，表示為預釋出版，沒有特別的意義，此程式以比較數字版本 (a &lt; b &lt; c ...) 相同的方式比較字順版本。所以，“<code
                class="literal">0pre3</code>” 大於 “<code
                class="literal">0</code>”。我們以毛毛蟲 “<code
                class="literal">~</code>” 表示該套件的預釋出版：
			</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --compare-versions 2.6.0~pre3-1 lt 2.6.0-1</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">0</code></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.8.8.8"></a>5.4.4. <code
                    class="command">dpkg</code> 的日誌檔</h3></div></div></div><div
            class="para">
				<code
              class="command">dpkg</code> 把所有的交易記錄存在名為 <code
              class="filename">/var/log/dpkg.log</code> 的日誌檔。這個日誌檔的內容頗為詳盡且囉唆，記錄套件被 <code
              class="command">dpkg</code> 處理的每個程序。追蹤 dpkg 的每個作為之外，日誌檔還保留系統發展的記錄：可以覆查每個套件的安裝與移除步驟，對於瞭解最近的變動極有幫助。此外，還記錄所有的版本，可以交互檢查 <code
              class="filename">changelog.Debian.gz</code> 的內容，查看有問題的套件或線上的錯誤報告。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.multi-arch"></a>5.4.5. 多架構支援</h3></div></div></div><a
            id="id-1.8.8.9.2"
            class="indexterm"></a><a
            id="id-1.8.8.9.3"
            class="indexterm"></a><div
            class="para">
				Debian 套件在其控制資訊內有個 <code
              class="literal">Architecture</code> 欄位。其內容為 “<code
              class="literal">all</code>” (表示該套件不受架構限制) 或指出其適用的架構 (如 “amd64”、“armhf”、…)。以後例而言，主機的架構符合後，<code
              class="command">dpkg</code> 才開始安裝該套件，並送回 <code
              class="command">dpkg --print-architecture</code>。
			</div><div
            class="para">
				此限制確保使用者不會用到不合其架構的執行檔。除了可以執行多個架構的電腦之外，不論在地的 ( “amd64“ 系統可執行 “i386” 執行檔) 或虛擬的電腦都可找到適用的套件。
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.8.9.6"></a>5.4.5.1. 啟用多架構</h4></div></div></div><div
              class="para">
					<code
                class="command">dpkg</code> 的多架構支授允許使用者限制 “怪異的架構” 安裝在現行的系統上。以下例的 <code
                class="command">dpkg --add-architecture</code> 就能做到。有個對應的 <code
                class="command">dpkg --remove-architecture</code> 指令可以除去怪異的架構，不過祗發生於無套件可用時。
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-architecture</code></strong>
<code
                class="computeroutput">amd64
# </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg -i gcc-6-base_6.3.0-18_armhf.deb</code></strong>
<code
                class="computeroutput">dpkg: error processing archive gcc-6-base_6.3.0-18_armhf.deb (--install):
 package architecture (armhf) does not match system (amd64)
Errors were encountered while processing:
 gcc-6-base_6.3.0-18_armhf.deb
# </code><strong
                class="userinput"><code>dpkg --add-architecture armhf</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --add-architecture armel</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput">armhf
armel
# </code><strong
                class="userinput"><code>dpkg -i gcc-6-base_6.3.0-18_armhf.deb</code></strong>
<code
                class="computeroutput">Selecting previously unselected package gcc-6-base:armhf.
(Reading database ... 112000 files and directories currently installed.)
Preparing to unpack gcc-6-base_6.3.0-18_armhf.deb ...
Unpacking gcc-6-base:armhf (6.3.0-18) ...
Setting up gcc-6-base:armhf (6.3.0-18) ...
# </code><strong
                class="userinput"><code>dpkg --remove-architecture armhf</code></strong>
<code
                class="computeroutput">dpkg: error: cannot remove architecture 'armhf' currently in use by the database
# </code><strong
                class="userinput"><code>dpkg --remove-architecture armel</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput">armhf</code></pre><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>說明</em></span> APT 的多架構支援</strong></p></div></div></div><div
                class="para">
					dpkg 完成組態支援怪異架構後，APT 自動偵測且在升級過程中下載對應的 <code
                  class="filename">套件</code> 檔案。
				</div><div
                class="para">
					可以使用 <code
                  class="command">apt install <em
                    class="replaceable">套件</em>:<em
                    class="replaceable">架構</em></code> 指令安裝怪異套件。
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>實務</em></span> 在 amd64 使用專屬的 i386 執行檔</strong></p></div></div></div><div
                class="para">
					There are multiple use cases for multi-arch, but the most popular one is the possibility to execute 32 bit binaries (i386) on 64 bit systems (amd64).
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.8.9.7"></a>5.4.5.2. 多架構相關的改變</h4></div></div></div><div
              class="para">
					To make multi-arch actually useful and usable, libraries had to be repackaged and moved to an architecture-specific directory so that multiple copies (targeting different architectures) can be installed alongside. Such updated packages contain the “<code
                class="literal">Multi-Arch: same</code>” header field to tell the packaging system that the various architectures of the package can be safely co-installed (and that those packages can only satisfy dependencies of packages of the same architecture). The most important libraries have been converted since the introduction of multi-arch in Debian <span
                class="distribution distribution">Wheezy</span>, but there are many libraries that will likely never be converted unless someone specifically requests it (through a bug report for example).
				</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg -s gcc-6-base
</code></strong><code
                class="computeroutput">dpkg-query: error: --status needs a valid package name but 'gcc-6-base' is not: ambiguous package name 'gcc-6-base' with more than one installed instance

Use --help for help about querying packages.
$ </code><strong
                class="userinput"><code>dpkg -s gcc-6-base:amd64 gcc-6-base:armhf | grep ^Multi
</code></strong><code
                class="computeroutput">Multi-Arch: same
Multi-Arch: same
$ </code><strong
                class="userinput"><code>dpkg -L libgcc1:amd64 |grep .so
</code></strong><code
                class="computeroutput">/lib/x86_64-linux-gnu/libgcc_s.so.1
$ </code><strong
                class="userinput"><code>dpkg -S /usr/share/doc/gcc-6-base/copyright
</code></strong><code
                class="computeroutput">gcc-6-base:amd64, gcc-6-base:armhf: /usr/share/doc/gcc-6-base/copyright
</code></pre><div
              class="para">
					<code
                class="literal">Multi-Arch: same</code> 套件的名稱必須符合其架構才能被明確的指認出來。也可能以相同的套件在其他情況下共享檔案；共享時，<code
                class="command">dpkg</code> 確認所有套件的每個位元都相同。最後但不是最不重要，套件的所有實例必須使用相同的版本。也必須一起更新。
				</div><div
              class="para">
					多架構支援帶來處理相依性的有趣挑戰。滿足相依性的套件標示為 “<code
                class="literal">Multi-Arch: foreign</code>” 或宣告其匹配架構的相依性 (在這種相依性解決過程中，假設架構獨立的套件與主機不同)。相依性可能被弱化以允許納入其他架構，以 <code
                class="literal"><em
                  class="replaceable">套件</em>:any</code> 語法，但怪異套件祗需滿足一個相依性，如果標示為 “<code
                class="literal">Multi-Arch: allowed</code>”。
				</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.source-package-structure.html"><strong>前一頁</strong>5.3. 原始套件的結構</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一層</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始頁</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.coexistence-with-other-packaging-systems.html"><strong>下一頁</strong>5.5. 與其他打包系統共存</a></li></ul></body></html>
