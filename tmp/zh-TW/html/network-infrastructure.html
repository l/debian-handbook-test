<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">章 10. 網路架構</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-zh-TW-1.0-1" /><meta
        name="keywords"
        content="網路, 閘道器, TCP/IP, IPv6, DNS, Bind, DHCP, QoS" /><link
        rel="home"
        href="index.html"
        title="The Debian Administrator's Handbook" /><link
        rel="up"
        href="index.html"
        title="The Debian Administrator's Handbook" /><link
        rel="prev"
        href="sect.power-management.html"
        title="9.12. 電源管理：進階組態與電源介面 (ACPI)" /><link
        rel="next"
        href="sect.virtual-private-network.html"
        title="10.2. Virtual Private Network" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/zh-TW/stable/network-infrastructure.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.power-management.html"><strong>前一頁</strong></a></li><li
          class="home">The Debian Administrator's Handbook</li><li
          class="next"><a
            accesskey="n"
            href="sect.virtual-private-network.html"><strong>下一頁</strong></a></li></ul><div
        xml:lang="zh-TW"
        class="chapter"
        lang="zh-TW"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  xmlns=""
                  id="network-infrastructure"></a>章 10. 網路架構</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="network-infrastructure.html#sect.gateway">10.1. 閘道器</a></span></dt><dt><span
                class="section"><a
                  href="sect.virtual-private-network.html">10.2. Virtual Private Network</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.openvpn">10.2.1. OpenVPN</a></span></dt><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.ssh-vpn">10.2.2. Virtual Private Network with SSH</a></span></dt><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.ipsec">10.2.3. IPsec</a></span></dt><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.pptp">10.2.4. PPTP</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.quality-of-service.html">10.3. Quality of Service</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.quality-of-service.html#sect.qos-principe">10.3.1. 原則與機制</a></span></dt><dt><span
                    class="section"><a
                      href="sect.quality-of-service.html#sect.qos-config">10.3.2. Configuring and Implementing</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.dynamic-routing.html">10.4. Dynamic Routing</a></span></dt><dt><span
                class="section"><a
                  href="sect.ipv6.html">10.5. IPv6</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.ipv6.html#sect.ipv6-tunneling">10.5.1. Tunneling</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.domain-name-servers.html">10.6. Domain Name Servers (DNS)</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.domain-name-servers.html#sect.dns-principe">10.6.1. 原則與機制</a></span></dt><dt><span
                    class="section"><a
                      href="sect.domain-name-servers.html#sect.dns-config">10.6.2. 配置</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.dhcp.html">10.7. DHCP</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.dhcp.html#sect.dhcp-config">10.7.1. 配置</a></span></dt><dt><span
                    class="section"><a
                      href="sect.dhcp.html#sect.dhcp-dns">10.7.2. DHCP and DNS</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.network-diagnosis-tools.html">10.8. Network Diagnosis Tools</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.network-diagnosis-tools.html#sect.netstat">10.8.1. Local Diagnosis: <code
                        class="command">netstat</code></a></span></dt><dt><span
                    class="section"><a
                      href="sect.network-diagnosis-tools.html#sect.nmap">10.8.2. Remote Diagnosis: <code
                        class="command">nmap</code></a></span></dt><dt><span
                    class="section"><a
                      href="sect.network-diagnosis-tools.html#sect.sniffers">10.8.3. Sniffers: <code
                        class="command">tcpdump</code> and <code
                        class="command">wireshark</code></a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		Linux 繼承整個 Unix 的網路功能，Debian 提供整套建立與管理網路的工具。本章介紹這些工具。
	</div></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    xmlns=""
                    id="sect.gateway"></a>10.1. 閘道器</h2></div></div></div><div
            class="para">
			閘道器是連結多個網路的系統。此名詞通常用於本地網路通往外部 IP 位址的 “出口”。閘道器把每個網路連結在一起，且做為路由器在不同介面間傳送 IP 封包。
		</div><a
            id="id-1.13.4.3"
            class="indexterm"></a><a
            id="id-1.13.4.4"
            class="indexterm"></a><a
            id="id-1.13.4.5"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>基本</em></span> IP 封包</strong></p></div></div></div><a
              id="id-1.13.4.6.2"
              class="indexterm"></a><div
              class="para">
			今天，大部份的網路使用 IP 通信協定 (<span
                class="emphasis"><em>Internet Protocol</em></span>)。這種協定把傳輸資料切割成小小的封包。除了實際傳輸的資料外，每個封包還包括必備的路由資訊。
		</div></div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.tcp-udp"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>基本</em></span> TCP/UDP</strong></p></div></div></div><a
              id="id-1.13.4.7.2"
              class="indexterm"></a><a
              id="id-1.13.4.7.3"
              class="indexterm"></a><a
              id="id-1.13.4.7.4"
              class="indexterm"></a><a
              id="id-1.13.4.7.5"
              class="indexterm"></a><div
              class="para">
			即使在 IP 上傳輸資料，大部份程式都不處理個別的封包問題；他們通常使用 TCP (<span
                class="emphasis"><em>Transmission Control Protocol</em></span>)。TCP 是 IP 的上層，為專屬的資料流建立兩點間的連結。程式祗看到資料進來的款目，並保證同樣的資料無誤 (且以同樣順序) 流到另端連結的出口。在較低層可能發生多種錯誤，都可以被 TCP 補償：重送失去的封包、重組到達的封包 (例如，經由不同路徑送到) 的順序。
		</div><div
              class="para">
			另個在 IP 上的協定是 UDP (<span
                class="emphasis"><em>User Datagram Protocol</em></span>)。與 TCP 不同，它是封包導向的。它的目標不同：UDP 的目的是在應用程式間傳輸封包。此協定不補償封包的遺漏，也不在意封包依序到達。此協定的主要優點是，大幅改善延遲的問題，遺漏的封包不影響接收後續封包，並且持續重送該遺漏的封包。
		</div><div
              class="para">
			TCP 和 UDP 都涉及封包，也就是以 "分機號碼" 模式在機器內的程式建立連結。此做法允許在同個通訊中建立多個平行的管道，因為它們以不同的埠號區分之。
		</div><div
              class="para">
			部份埠號 — 由 IANA (<span
                class="emphasis"><em>Internet Assigned Numbers Authority</em></span>) 規範 — 以與網路服務相關而 “知名”。例如，TCP 埠號 25 係供電子郵件伺服器使用。<div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.iana.org/assignments/port-numbers">http://www.iana.org/assignments/port-numbers</a></div>
		</div></div><div
            class="para">
			區域網路接在私人網址範圍內 (不在網路網路的路由上)，閘道器就需要 <span
              class="emphasis"><em>位址掩蔽</em></span> 讓其經由網路與外界溝通。掩蔽作業是網路層次的代理工作：內部機器，都被閘道器取代 (因為閘道器有外部的路由位址)，藉由掩蔽連結，資料送出出去，進來的資料經由掩蔽連結至內部機器。閘道器以指定的 TCP 埠執行此工作，通常是較高的號碼 (超過 60000)。對外部而言，經由內部機器的連結，就是來自此等保留埠號。
		</div><a
            id="id-1.13.4.9"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>文化</em></span> 私有位址範圍</strong></p></div></div></div><a
              id="id-1.13.4.10.2"
              class="indexterm"></a><a
              id="id-1.13.4.10.3"
              class="indexterm"></a><div
              class="para">
			RFC 1918 把三組 IPv4 位址設為區域網路專用，不能路由至網際網路。第一組是，<code
                class="literal">10.0.0.0/8</code> (見專欄 <a
                class="xref"
                href="sect.network-config.html#sidebar.networking-basics"><span
                  class="emphasis"><em>基本</em></span> 必要的網路概念 (Ethernet、IP 位址、次網路、廣播)</a>)，是一個A級範圍 (是 2<sup>24</sup> IP 位址)。第二組是，<code
                class="literal">172.16.0.0/12</code>，16個B級範圍 (<code
                class="literal">172.16.0.0/16</code> 至 <code
                class="literal">172.31.0.0/16</code>)，每個有 2<sup>16</sup> IP 位址。最後，<code
                class="literal">192.168.0.0/16</code> 是一個B級範圍 (包括 256 個C級範圍，<code
                class="literal">192.168.0.0/24</code> 至 <code
                class="literal">192.168.255.0/24</code>，各有 256 個 IP 位址)。<div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc1918.html">http://www.faqs.org/rfcs/rfc1918.html</a></div>
		</div></div><div
            class="para">
			The gateway can also perform two kinds of <span
              class="emphasis"><em>network address translation</em></span> (or NAT for short). The first kind, <span
              class="emphasis"><em>Destination NAT</em></span> (DNAT) is a technique to alter the destination IP address (and/or the TCP or UDP port) for a (generally) incoming connection. The connection tracking mechanism also alters the following packets in the same connection to ensure continuity in the communication. The second kind of NAT is <span
              class="emphasis"><em>Source NAT</em></span> (SNAT), of which <span
              class="emphasis"><em>masquerading</em></span> is a particular case; SNAT alters the source IP address (and/or the TCP or UDP port) of a (generally) outgoing connection. As for DNAT, all the packets in the connection are appropriately handled by the connection tracking mechanism. Note that NAT is only relevant for IPv4 and its limited address space; in IPv6, the wide availability of addresses greatly reduces the usefulness of NAT by allowing all “internal” addresses to be directly routable on the Internet (this does not imply that internal machines are accessible, since intermediary firewalls can filter traffic).
		</div><a
            id="id-1.13.4.12"
            class="indexterm"></a><a
            id="id-1.13.4.13"
            class="indexterm"></a><a
            id="id-1.13.4.14"
            class="indexterm"></a><a
            id="id-1.13.4.15"
            class="indexterm"></a><a
            id="id-1.13.4.16"
            class="indexterm"></a><a
            id="id-1.13.4.17"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> Port forwarding</strong></p></div></div></div><a
              id="id-1.13.4.18.2"
              class="indexterm"></a><div
              class="para">
			A concrete application of DNAT is <span
                class="emphasis"><em>port forwarding</em></span>. Incoming connections to a given port of a machine are forwarded to a port on another machine. Other solutions may exist for achieving a similar effect, though, especially at the application level with <code
                class="command">ssh</code> (see <a
                class="xref"
                href="sect.remote-login.html#sect.ssh-port-forwarding">節 9.2.1.3, “新增埠映射的加密通道”</a>) or <code
                class="command">redir</code>.
		</div></div><div
            class="para">
			Enough theory, let's get practical. Turning a Debian system into a gateway is a simple matter of enabling the appropriate option in the Linux kernel, by way of the <code
              class="filename">/proc/</code> virtual filesystem:
		</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>echo 1 &gt; /proc/sys/net/ipv4/conf/default/forwarding</code></strong></pre><div
            class="para">
			This option can also be automatically enabled on boot if <code
              class="filename">/etc/sysctl.conf</code> sets the <code
              class="literal">net.ipv4.conf.default.forwarding</code> option to <code
              class="literal">1</code>.
		</div><div
            class="example"><a
              xmlns=""
              id="example.sysctl.conf"></a><p
              class="title"><strong>範例 10.1. The <code
                  class="filename">/etc/sysctl.conf</code> file</strong></p><div
              class="example-contents"><pre
                class="programlisting">
net.ipv4.conf.default.forwarding = 1
net.ipv4.conf.default.rp_filter = 1
net.ipv4.tcp_syncookies = 1
</pre></div></div><div
            class="para">
			The same effect can be obtained for IPv6 by simply replacing <code
              class="literal">ipv4</code> with <code
              class="literal">ipv6</code> in the manual command and using the <code
              class="literal">net.ipv6.conf.all.forwarding</code> line in <code
              class="filename">/etc/sysctl.conf</code>.
		</div><div
            class="para">
			Enabling IPv4 masquerading is a slightly more complex operation that involves configuring the <span
              class="emphasis"><em>netfilter</em></span> firewall.
		</div><div
            class="para">
			Similarly, using NAT (for IPv4) requires configuring <span
              class="emphasis"><em>netfilter</em></span>. Since the primary purpose of this component is packet filtering, the details are listed in <a
              class="xref"
              href="security.html">章 14: “<em>Security</em>”</a> (see <a
              class="xref"
              href="sect.firewall-packet-filtering.html">節 14.2, “Firewall or Packet Filtering”</a>).
		</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.power-management.html"><strong>前一頁</strong>9.12. 電源管理：進階組態與電源介面 (ACPI)</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一層</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始頁</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.virtual-private-network.html"><strong>下一頁</strong>10.2. Virtual Private Network</a></li></ul></body></html>
