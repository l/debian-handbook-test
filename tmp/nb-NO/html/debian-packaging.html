<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">Kapittel 15. Å lage en Debian-pakke</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-nb-NO-1.0-1" /><meta
        name="keywords"
        content="Bakdør, Gjenoppbygge, Kildepakke, Arkiv, Meta-pakke, Debian-utvikler, Vedlikeholder" /><link
        rel="home"
        href="index.html"
        title="Håndbok for Debian-administratoren" /><link
        rel="up"
        href="index.html"
        title="Håndbok for Debian-administratoren" /><link
        rel="prev"
        href="sect.dealing-with-compromised-machine.html"
        title="14.7. Å håndtere en kompromittert maskin" /><link
        rel="next"
        href="sect.building-first-package.html"
        title="15.2. Å bygge din første pakke" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/nb-NO/stable/debian-packaging.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>Forrige</strong></a></li><li
          class="home">Håndbok for Debian-administratoren</li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>Neste</strong></a></li></ul><div
        xml:lang="nb-NO"
        class="chapter"
        lang="nb-NO"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  xmlns=""
                  id="debian-packaging"></a>Kapittel 15. Å lage en Debian-pakke</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="debian-packaging.html#sect.rebuilding-package">15.1. Å bygge om en pakke fra sine kilder</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.3">15.1.1. Å skaffe kildene</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.4">15.1.2. Å lage forandringer</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.5">15.1.3. Å starte gjenoppbyggingen</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.building-first-package.html">15.2. Å bygge din første pakke</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#id-1.18.5.2">15.2.1. Meta-pakker eller falsk pakker</a></span></dt><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#id-1.18.5.3">15.2.2. Et enkelt filarkiv</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.setup-apt-package-repository.html">15.3. Å lage en pakkebrønn for APT</a></span></dt><dt><span
                class="section"><a
                  href="sect.becoming-package-maintainer.html">15.4. Å bli en pakkevedlikeholder</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#id-1.18.7.2">15.4.1. Å lære å lage pakker</a></span></dt><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#id-1.18.7.3">15.4.2. Aksepteringsprosess</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		Det er nokså vanlig for en administrator som har håndtert Debian-pakker jevnlig å etter hvert ønske å lage egne pakker, eller modifisere en eksisterende pakke. Dette kapittelet tar sikte på å svare på de vanligste spørsmålene på dette området, og gi nødvendige instrukser for å utnytte Debians infrastruktur på beste måte. Med litt flaks, etter å ha prøvd deg fram med lokale pakker, kan du kanskje til og med tenke deg å gå lengre, og bli med i Debian-prosjektet selv!
	</div></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    xmlns=""
                    id="sect.rebuilding-package"></a>15.1. Å bygge om en pakke fra sine kilder</h2></div></div></div><div
            class="para">
			Å bygge om en binær pakke er nødvendig under flere omstendigheter. I noen tilfeller trenger administratoren en programvarefunksjon som krever at programvaren som skal kompileres fra kilder med et spesielt kompileringsalternativ; i andre er programvaren som er pakket i den installerte versjonen av Debian ikke ny nok. I det sistnevnte tilfellet vil administratoren vanligvis bygge en nyere pakke tatt fra en nyere versjon av Debian - så som <span
              class="distribution distribution">Testing</span>, eller til og med <span
              class="distribution distribution">Unstable</span> - slik at denne nye pakken virker i deres <span
              class="distribution distribution">Stable</span>-distribusjon: Denne operasjonen kalles «backporting». Som vanlig bør man være forsiktig før en tar på seg en slik oppgave, men sjekke om den har blitt gjort allerede: Ta en rask titt på Debian Package Tracker for å se om pakken kan vise informasjon om det. <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="https://tracker.debian.org/">https://tracker.debian.org/</a></div> <a
              id="id-1.18.4.2.5"
              class="indexterm"></a>
		</div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.18.4.3"></a>15.1.1. Å skaffe kildene</h3></div></div></div><div
              class="para">
				Å bygge om en Debian-pakke starter med å skaffe seg kildekoden. Den enkleste måten er å bruke <code
                class="command">apt-get source <em
                  class="replaceable">kildepakkenavn</em></code>-kommandoen. Denne kommanoen krever en <code
                class="literal">deb-src</code>-linje i <code
                class="filename">/etc/apt/sources.list</code>-filen, og oppdaterte indeksfiler (det er <code
                class="command">apt-get update</code>). Disse betingelsene skulle allerede være imøtekommet hvis du fulgte instruksjonene fra kapittelet om APT-konfigurasjon (se <a
                class="xref"
                href="apt.html#sect.apt-sources.list">Seksjon 6.1, «Å fylle inn <code
                  class="filename">sources.list</code>-filen»</a>). Merk imidlertid at du vil laste ned kildekodepakkene fra den Debian-versjonen som er nevnt i <code
                class="literal">deb-src</code>-linjen. Hvis du trenger en annen versjon, må du kanskje laste den ned manuelt fra et Debian-speil, eller fra nettstedet. Dette innebærer henting av to eller tre filer (med utvidelser <code
                class="filename">*.dsc</code> - for <span
                class="emphasis"><em>Debian Source Control</em></span> - <code
                class="filename">*.tar.<em
                  class="replaceable">comp</em></code>, og noen ganger <code
                class="filename">*.diff.gz</code> eller <code
                class="filename">*.debian.tar.<em
                  class="replaceable">comp</em></code> - <em
                class="replaceable">comp</em> som tar en verdi blant <code
                class="literal">gz</code>, <code
                class="literal">bz2</code> eller <code
                class="literal">xz</code>, avhengig av det kompresjonsverktøyet som er i bruk), så kjør <code
                class="command">dpkg-source -x <em
                  class="replaceable">file.dsc</em></code>-kommandoen. Hvis <code
                class="filename">*.dsc</code>-filen er tilgjengelig direkte fra en gitt URL, er det til og med enklere vei å få tak i alt sammen, med <code
                class="command">dget <em
                  class="replaceable">URL</em></code>-kommandoen. Denne kommandoen (som kan bli funnet i <span
                class="pkg pkg">devscripts</span>-pakken) fanger opp <code
                class="filename">*.dsc</code>-filen på den gitte adressen, så analyserer den innholdet, og filen eller filene det refereres til hentes automatisk. Når alt er lastet ned, pakkes kildepakken ut (såfremt <code
                class="literal">-d</code> eller <code
                class="literal">--download-only</code>-valget er benyttet).
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.18.4.4"></a>15.1.2. Å lage forandringer</h3></div></div></div><div
              class="para">
				Pakkekilden er tilgjengelig i en katalog oppkalt etter kildepakkens versjon (for eksempel <span
                class="emphasis"><em>samba-4.1.17+dfsg</em></span>): Dette er der vi skal jobbe med våre lokale endringer.
			</div><div
              class="para">
				Det første du må gjøre er å endre pakkens versjonsnummer, slik at de gjenoppbygde pakkene kan skilles fra de opprinnelige pakkene som følger med Debian. Forutsatt at gjeldende versjon er <code
                class="literal">2:4.1.17+dfsg-2</code>, kan vi lage versjon <code
                class="literal">2:4.1.17+dfsg-2falcot1</code>, som tydelig viser opprinnelsen av pakken. Dette gjør pakkens versjonsnummer høyere enn den som tilbys av Debian, slik at pakken lett vil installeres som en oppdatering til den opprinnelige pakken. En slik endring er best utført med <code
                class="command">dch</code>-kommandoen (<span
                class="emphasis"><em>Debian CHangelog</em></span>) fra <span
                class="pkg pkg">devscripts</span>-pakken med en kommando slik som <code
                class="command">dch --local falcot</code>. Dette tar i bruk en tekstrediger (<code
                class="command">sensible-editor</code> - dette burde være din favorittredigerer hvis den er nevnt i <code
                class="varname">VISUAL</code>, eller <code
                class="varname">EDITOR</code>-miljøvariablene, og ellers standardredigereren) for å tillate å dokumentere forskjellene som følger av denne ombyggingen. Denne redigereren viser oss at <code
                class="command">dch</code> virkelig forandret <code
                class="filename">debian/changelog</code>-filen.
			</div><div
              class="para">
				Når det kreves en endring i oppbyggingen, må det lages endringer i <code
                class="filename">debian/rules</code>, som skritt for skritt driver pakkens byggeprosess. I de enkleste tilfellene er linjene om den opprinnelige konfigurasjonen (<code
                class="literal">./configure …</code>), eller i den aktuelle utgaven (<code
                class="literal">$(MAKE) …</code>, eller <code
                class="literal">make …</code>) enkle å finne. Hvis disse kommandoene ikke påkalles eksplisitt, er de sannsynligvis en bivirkning av en annen eksplisitt kommando, i så fall kan du se i dokumentasjonen for å lære mer om hvordan du endrer standard virkemåten. Med pakker som bruker <code
                class="command">dh</code>, kan du trenge å legge til en overstyring for <code
                class="command">dh_auto_configure</code>, eller <code
                class="command">dh_auto_build</code>-kommandoene (se de respektive manualsidene deres for forklaringer om hvordan du oppnår dette).
			</div><div
              class="para">
				Avhengig av de lokale endringene i pakkene, kan en oppdatering også være nødvendig i <code
                class="filename">debian/control</code>-filen, som inneholder en beskrivelse av de genererte pakker. Spesielt inneholder denne filen <code
                class="literal">Build-Depends</code>-linjer som kontrollerer listen over avhengigheter som må være oppfylt når pakken bygges. Disse refererer ofte til versjonene til pakkene i distribusjonen som kildepakken kommer fra, men som kanskje ikke er tilgjengelig i distribusjonen som brukes til ombygging. Det er ingen automatisk måte å avgjøre om en avhengighet er ekte, eller bare spesifisert til å garantere at bygget kun skal bli forsøkt med den nyeste versjonen av et bibliotek - dette er den eneste tilgjengelige måten å tvinge en <span
                class="emphasis"><em>autobuilder</em></span> til å bruke en gitt pakkeversjon under oppbyggingen, og det er derfor Debians vedlikeholdere ofte bruker strenge versjonsbestemte byggeavhengigheter.
			</div><div
              class="para">
				Hvis du vet sikkert at disse byggeavhengigheter er for strenge, bør du føle deg fri til å løsne på dem lokalt. Å lese filene som dokumenterer den vanlige måten å bygge programvare på - disse filene blir ofte kalt <code
                class="filename">INSTALL</code> - vil hjelpe deg å finne de riktige avhengighetene. Ideelt sett bør alle avhengigheter være imøtekommet fra distribusjonen som brukes til ombygging. Hvis de ikke er det, starter en gjentakingsprosess, der pakkene nevnt i <code
                class="literal">Build-Depends</code>-feltet må «backportes» («tilbakeporting») før målet pakken kan bli det. Noen pakker trenger kanskje ikke tilbakeporting, og kan installeres som de er i løpet av byggeprosessen (et kjent eksempel er <span
                class="pkg pkg">debhelper</span>). Merk at tilbakeportingsprosessen raskt kan bli komplisert hvis du ikke er forsiktig. Derfor bør tilbakeporting holdes på et absolutt minimum der det er mulig.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>TIPS</em></span> innstallere <code
                          class="literal">Build-Depends</code></strong></p></div></div></div><a
                id="id-1.18.4.4.7.2"
                class="indexterm"></a><div
                class="para">
				<code
                  class="command">apt-get</code> tillater installasjon av alle pakker nevnt i <code
                  class="literal">Build-Depends</code>-feltene til en kildepakke som er tilgjengelig i en distribusjon nevnt i en <code
                  class="literal">deb-src</code>-linje i <code
                  class="filename">/etc/apt/sources.list</code>-filen. Dette er så enkelt som å kjøre <code
                  class="command">apt-get build-dep <em
                    class="replaceable">kildepakken</em></code>-kommandoen.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.18.4.5"></a>15.1.3. Å starte gjenoppbyggingen</h3></div></div></div><div
              class="para">
				Når alle de nødvendige endringene har blitt brukt på kildene, kan vi starte å generere den aktuelle binære pakkefilen (<code
                class="filename">.deb</code>). Hele prosessen er håndtert av <code
                class="command">dpkg-buildpackage</code>-kommandoen.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.18.4.5.3"></a><p
                class="title"><strong>Eksempel 15.1. Å bygge om en pakke</strong></p><div
                class="example-contents"><pre
                  class="screen"><code
                    class="computeroutput">$ </code><strong
                    class="userinput"><code>dpkg-buildpackage -us -uc
</code></strong><code
                    class="computeroutput">[...]
</code></pre></div></div><div
              class="sidebar"><a
                xmlns=""
                id="sidebar.fakeroot"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>VERKTØY</em></span> <code
                          class="command">fakeroot</code></strong></p></div></div></div><div
                class="para">
				I hovedsak er prosessen med å bygge pakker en så enkel sak som, i et arkiv, å samle et sett av eksisterende (eller bygde) filer. De fleste filene vil så bli eid av <span
                  class="emphasis"><em>rot</em></span> i arkivet. Men å bygge hele pakken under denne brukeren skulle tilsi økt risiko. Heldigvis kan dette unngås med <code
                  class="command">fakeroot</code>-kommandoen. Dette verktøyet kan brukes til å kjøre et program, og gi inntrykk av at det kjører som <span
                  class="emphasis"><em>root</em></span>, og skaper filer med vilkårlig eierskap og rettigheter. Når programmet skaper arkivet som vil bli Debian-pakken, er det lurt å skape et arkiv som inneholder filer merket som tilhørende vilkårlige eiere, inkludert <span
                  class="emphasis"><em>rot</em></span>. Dette oppsettet er så praktisk at <code
                  class="command">dpkg-buildpackage</code> bruker <code
                  class="command">fakeroot</code> som standard ved pakkebygging.
			</div><div
                class="para">
				Merk at programmet bare er lurt til å «tro» at det fungerer som en priviligert konto, og prosessen faktisk kjører som om brukeren kjører <code
                  class="command">fakeroot <em
                    class="replaceable">program</em></code> (og filene faktisk er opprettet med den brukerens tillatelser). Ikke på noe tidspunkt får det faktisk rotprivilegier som det kunne misbruke.
			</div></div><div
              class="para">
				Den tidligere kommandoen kan mislykkes hvis <code
                class="literal">Build-Depends</code>-feltene ikke her blitt oppdatert, eller hvis de relaterte pakker ikke er installert. I dette tilfelle er det mulig å overprøve denne sjekken ved å sende <code
                class="literal">-d</code>-valget til <code
                class="command">dpkg-buildpackage</code>. Men å eksplisitt ignorere disse avhengigheter gir risiko for at byggeprosessen mislykkes på et senere tidspunkt. Verre, kan pakken synes å bli bygget riktig, men klarer ikke å kjøre skikkelig: Noen programmer deaktiverer automatisk noen av sine oppgaver når et nødvendig bibliotek er ikke tilgjengelig på byggetidspunktet.
			</div><div
              class="para">
				Oftere enn ikke bruker Debian-utviklere et høynivå-program som <code
                class="command">debuild</code>; Dette kjører <code
                class="command">dpkg-buildpackage</code> til vanlig, men legger også til en påkalling til et program som kjører mange kontroller for å validere den genererte pakken opp mot Debians retningslinjer. Dette skriptet renser også opp i miljøet, slik at lokale miljøvariabler ikke "forurenser" pakkebyggingen. <code
                class="command">debuild</code>-kommandoen er et av verktøyene i <span
                class="emphasis"><em>devscripts</em></span>-pakken, som deler noe konsistens og oppsett for å gjøre vedlikeholderens oppgave enklere.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>QUICK LOOK</em></span> <code
                          class="command">pbuilder</code></strong></p></div></div></div><a
                id="id-1.18.4.5.7.2"
                class="indexterm"></a><div
                class="para">
				<code
                  class="command">pbuilder</code>-programmet (i pakken med det tilsvarende navnet) tillater bygging av en Debian-pakke i en <span
                  class="emphasis"><em>chrooted</em></span>-omgivelse. Den lager først en midlertidig katalog med det minimale systemet som kreves for å bygge pakken (inkludert pakkene nevnt i <span
                  class="emphasis"><em>Build-Depends</em></span>-feltet). Denne katalogen blir så brukt som rotkatalog (<code
                  class="filename">/</code>), og bruker <code
                  class="command">chroot</code>-kommandoen under byggeprosessen.
			</div><div
                class="para">
				Dette verktøyet gjør at byggeprosessen skjer i et miljø som ikke endres av brukernes virksomhet. Dette gir også mulighet for rask påvisning av manglende bygge-avhengigheter (siden byggingen vil mislykkes uten dokumentasjon av de riktige avhengighetene). Til slutt, tillater det å bygge en pakke for en Debian-versjon som ikke er den som brukes av systemet som helhet: Maskinen kan bruke <span
                  class="distribution distribution">Stable</span> i sitt normale arbeid, og en <code
                  class="command">pbuilder</code> som kjører på den samme maskinen, kan bruke <span
                  class="distribution distribution">Unstable</span> til pakkebygging.
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>Forrige</strong>14.7. Å håndtere en kompromittert maskin</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Opp</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Hjem</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>Neste</strong>15.2. Å bygge din første pakke</a></li></ul></body></html>
