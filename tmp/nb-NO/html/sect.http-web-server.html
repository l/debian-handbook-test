<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.2. Nett-tjener (HTTP)</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-nb-NO-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Debian-administratorens håndbok" /><link
        rel="up"
        href="network-services.html"
        title="Kapittel 11. Nettverkstjenester: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="network-services.html"
        title="Kapittel 11. Nettverkstjenester: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="next"
        href="sect.ftp-file-server.html"
        title="11.3. FTP File Server" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/nb-NO/stable/sect.http-web-server.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="network-services.html"><strong>Forrige</strong></a></li><li
          class="home">Debian-administratorens håndbok</li><li
          class="next"><a
            accesskey="n"
            href="sect.ftp-file-server.html"><strong>Neste</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.http-web-server"></a>11.2. Nett-tjener (HTTP)</h2></div></div></div><div
          class="para">
			Falcot Corp-administrtatorene besluttet å bruke Apache HTTP-tjeneren, inkludert i Debian <span
            class="distribution distribution">Jessie</span> med versjon 2.4.10.
		</div><a
          id="id-1.14.5.3"
          class="indexterm"></a><a
          id="id-1.14.5.4"
          class="indexterm"></a><a
          id="id-1.14.5.5"
          class="indexterm"></a><a
          id="id-1.14.5.6"
          class="indexterm"></a><a
          id="id-1.14.5.7"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>ALTERNATIVE</em></span> Andre nett-tjenere</strong></p></div></div></div><div
            class="para">
			Apache er rett og slett den mest kjente (og mye brukt) nett-tjeneren, men det finnes andre. De kan tilby bedre ytelse under visse arbeidsbelastninger, men dette har sitt motstykke i færre, tilgjengelige funksjoner og moduler. Men når den potensielle nett-tjeneren bygges for å betjene statiske filer eller å fungere som mellomtjener, er alternativene, for eksempel <span
              class="pkg pkg">nginx</span> og <span
              class="pkg pkg">lighttpd</span>, verdt å se nærmere på.
		</div><a
            id="id-1.14.5.8.3"
            class="indexterm"></a><a
            id="id-1.14.5.8.4"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.9"></a>11.2.1. Å installere Apache</h3></div></div></div><div
            class="para">
				Å installere <span
              class="pkg pkg">apache2</span>-pakken er alt som trenges. Den inneholder alle modulene, inkludert <span
              class="emphasis"><em>Multi-Processing Modules</em></span> (MPM-er) som påvirker hvordan Apache håndterer parallell behandling av mange forespørsler (de som bruker å bli levert i separate <span
              class="pkg pkg">apache2-mpm-*</span>-pakker). Den vil også trekke på <span
              class="pkg pkg">apache2-utils</span> som inneholder kommandolinje-verktøy som vi vil oppdage senere.
			</div><div
            class="para">
				Når MPM brukes påvirkes måten Apache vil håndtere samtidige forespørsler på betydelig. Med <span
              class="emphasis"><em>worker</em></span>-MPM, bruker den <span
              class="emphasis"><em>threads</em></span> (lettvektprosesser), mens med <span
              class="emphasis"><em>prefork</em></span>-MPM bruker den en samling prosesser som er laget på forhånd. Med <span
              class="emphasis"><em>event</em></span>-MPM vil den også bruke tråder, men de inaktive tilkoblingene (spesielt de som holdes åpne av HTTP <span
              class="emphasis"><em>keep-alive</em></span>-funksjonen) blir levert tilbake til en øremerket management-tråd.
			</div><div
            class="para">
				Falcot administratorene installerer også <span
              class="pkg pkg">libapache2-mod-php5</span> for å inkludere PHP-støtte i Apache. Dette fører til at standard <span
              class="emphasis"><em>event</em></span>-MPM-en blir deaktivert, og at <span
              class="emphasis"><em>prefork</em></span> blir brukt istedet, ettersom PHP bare virker under denne bestemte MPM-en.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SECURITY</em></span> Kjøring under <code
                        class="literal">www-data</code>-brukeren</strong></p></div></div></div><a
              id="id-1.14.5.9.5.2"
              class="indexterm"></a><a
              id="id-1.14.5.9.5.3"
              class="indexterm"></a><div
              class="para">
				Som standard håndterer Apache innkommende forespørsler under identiteten til <code
                class="literal">www-data</code>-brukeren. Dette betyr at en sikkerhetssårbarhet i et CGI-skript, utført av Apache (for en dynamisk side), ikke vil kompromittere hele systemet, men bare de filer som eies av denne bestemte brukeren.
			</div><div
              class="para">
				Ved å bruke <span
                class="emphasis"><em>suexec</em></span>-moduler kan en omgå denne regelen slik at noen CGI-skript kjøres med identiteten til en annen bruker. Dette konfigureres med et <code
                class="literal">SuexecUserGroup <em
                  class="replaceable">user</em><em
                  class="replaceable">group</em></code>-direktiv i Apache-oppsettet.
			</div><a
              id="id-1.14.5.9.5.6"
              class="indexterm"></a><div
              class="para">
				En annen mulighet er å bruke en dedikert MPM, slik som den som tilbys i <span
                class="pkg pkg">libapache2-mpm-itk</span>. Akkurat denne har en litt annen oppførsel: Den tillater å "isolere" virtuelle verter (faktisk, sett med sider), slik at de hver av dem kjører som en ulik bruker. En sårbarhet i en nettside kan derfor ikke kompromittere filer som tilhører eieren av et annet nettsted.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>QUICK LOOK</em></span> List of modules</strong></p></div></div></div><div
              class="para">
				Den fullstendige listen med Apache standardmoduler finnes på nettet. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://httpd.apache.org/docs/2.4/mod/index.html">http://httpd.apache.org/docs/2.4/mod/index.html</a></div>
			</div></div><div
            class="para">
				Apache er en modulbasert tjener, og mange funksjoner legges inn av eksterne moduler som hovedprogrammet laster inn under under sin initialisering. Standard konfigurasjonen kan bare aktivere de mest vanlige moduler, men å tillate nye moduler skjer ved ganske enkelt å kjøre <code
              class="command">a2enmod <em
                class="replaceable">module</em></code>; For å koble fra en modul, er kommandoen <code
              class="command">a2dismod <em
                class="replaceable">module</em></code>. Disse programmene oppretter (eller sletter) bare symbolske lenker i <code
              class="filename">/etc/apache2/mods-enabled/</code>, som peker på de aktuelle filene (lagret i <code
              class="filename">/etc/apache2/mods-available/</code>).
			</div><div
            class="para">
				Med sin standardkonfigurasjon, lytter nettjeneren på port 80 (som konfigurert i <code
              class="filename">/etc/apache2/ports.conf</code>), og betjener sider fra <code
              class="filename">/var/www/html/</code>-mappen (som konfigurert i <code
              class="filename">/etc/apache2/sites-enabled/000-default.conf</code>).
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>GOING FURTHER</em></span> Å legge til støtte for SSL</strong></p></div></div></div><a
              id="id-1.14.5.9.9.2"
              class="indexterm"></a><a
              id="id-1.14.5.9.9.3"
              class="indexterm"></a><div
              class="para">
				Apache 2.4 inkluderer SSL-modulen som kreves for sikker HTTP (HTTPS) ut av boksen. Den må bare være aktivert med <code
                class="command">a2enmod ssl</code>, deretter må de nødvendige direktiver legges til konfigurasjonsfilene. En konfigurasjonseksempel er gitt i <code
                class="filename">/etc/apache2/sites-available/default-ssl.conf</code>. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://httpd.apache.org/docs/2.4/mod/mod_ssl.html">http://httpd.apache.org/docs/2.4/mod/mod_ssl.html</a></div>
			</div><div
              class="para">
				Det kreves noe ekstra forsiktighet hvis du ønsker å favorisere SSL-tilkoblinger med <span
                class="emphasis"><em>Perfect Forward Secrecy</em></span> (disse tilkoblingene bruker flyktige øktnøkler som sikrer at kompromittering av tjenerens hemmelige nøkkelen ikke resulterer i kompromittering av gammel kryptert trafikk som kan ha blitt lagret under sniffing på nettverket). Se på Mozillas anbefalinger, spesielt: <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="https://wiki.mozilla.org/Security/Server_Side_TLS#Apache">https://wiki.mozilla.org/Security/Server_Side_TLS#Apache</a></div>
			</div><a
              id="id-1.14.5.9.9.6"
              class="indexterm"></a></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.10"></a>11.2.2. Å konfigurere virtuelle verter</h3></div></div></div><div
            class="para">
				En virtuell vert er en ekstra identitet for nettjeneren.
			</div><a
            id="id-1.14.5.10.3"
            class="indexterm"></a><div
            class="para">
				Apache vurderer to forskjellige typer virtuelle verter: De som er basert på IP-adressen (eller porten), og de som er avhengige av domenenavnet til nettjeneren. Den første metoden krever tildeling av en annen IP-adresse (eller port) for hvert område, mens den andre kan arbeide på en enkelt IP-adresse (og port), og nettstedene er differensiert etter vertsnavnet sendt av HTTP-klienten (som bare fungerer i versjon 1.1 av HTTP-protokollen - heldigvis at versjonen er gammel nok til at alle kunder bruker den allerede).
			</div><div
            class="para">
				Den (økende) knapphet på IPv4-adresser favoriserer vanligvis den andre metoden; Imidlertid er det gjort mer komplisert om de virtuelle verter må levere HTTPS også, ettersom SSL-protokollen ikke alltid har levert navn-basert virtuell hosting; Ikke alle nettlesere håndterer SNI-forlengelsen (<span
              class="emphasis"><em>Server Name Indication</em></span>). Når flere HTTPS-nettsteder må kjøre på samme tjener, vil de vanligvis bli differensiert enten ved å kjøre på en annen port eller på en annen IP-adresse (IPv6 kan hjelpe til der).
			</div><div
            class="para">
				Standardkonfigurasjonen for Apache 2 gir navn-baserte virtuelle verter. I tillegg er en standard virtuell vert definert i <code
              class="literal">/etc/apache2/sites-enabled/000-default.conf</code>-filen; Denne virtuelle verten vil bli brukt hvis det ikke finnes en vert som matcher anmodningen fra klienten.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CAUTION</em></span> Første virtuelle vert</strong></p></div></div></div><div
              class="para">
				Forespørsler om ukjente virtuelle verter vil alltid bli betjent med den først definerte virtuelle verten. Det er derfor vi her har definert <code
                class="literal">www.falcot.com</code> først.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>QUICK LOOK</em></span> Apache støtter SNI</strong></p></div></div></div><a
              id="id-1.14.5.10.8.2"
              class="indexterm"></a><div
              class="para">
				Apache-tjeneren støtter en SSL-protokoll-forlengelse kalt <span
                class="emphasis"><em>Server Name Indication</em></span> (SNI). Denne utvidelsen lar nettleseren sende vertsnavnet til nettjeneren, ved etableringen av SSL-tilkoblingen, mye tidligere enn HTTP-forespørselen selv, som tidligere ble brukt til å identifisere den forespurte virtuelle verten blant dem som ligger på samme tjener (med samme IP-adresse og port). Dette gjør Apache ved å velge det mest passende SSL-sertifikatet slik at transaksjonen kan fortsette.
			</div><div
              class="para">
				Før SNI, ville Apache alltid bruke sertifikatet i den virtuelle standard-verten. Klienter som prøver å få tilgang til en annen virtuell vert vil da vise advarsler, siden sertifikatet de mottok ikke samsvarte med nettstedet de prøvde å få tilgang til. Heldigvis jobber de fleste nettlesere sammen med SNI. Dette inkluderer Microsoft Internet Explorer fra og med versjon 7.0 (som starter med Vista), Mozilla Firefox fra og med versjon 2.0, Apple Safari fra versjon 3.2.1, og alle versjoner av Google Chrome.
			</div><div
              class="para">
				Apache pakken, levert med Debian, er bygget med støtte for SNI. Ingen spesiell konfigurasjon er derfor nødvendig.
			</div><div
              class="para">
				En bør også utvise forsiktighet for å sikre at konfigurasjonen for den første virtuelle verten (den som brukes som standard) aktiverer TLSv1, ettersom Apache bruker parametrene fra denne første virtuelle verten til å etablere sikre forbindelser, og de hadde bare å tillate dem!
			</div></div><div
            class="para">
				Hver ekstra virtuelle vert er deretter beskrevet av en fil lagret i <code
              class="filename">/etc/apache2/sites-available/</code>. Å sette opp et nettsted for <code
              class="literal">falcot.org</code>-domenet blir derfor en enkel sak ved å lage den følgende filen, og så aktivere den virtuelle verten med <code
              class="command">a2ensite www.falcot.org</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.10.10"></a><p
              class="title"><strong>Eksempel 11.16. <code
                  class="filename">/etc/apache2/sites-available/www.falcot.org.conf</code>-filen</strong></p><div
              class="example-contents"><pre
                class="programlisting">
&lt;VirtualHost *:80&gt;
ServerName www.falcot.org
ServerAlias falcot.org
DocumentRoot /srv/www/www.falcot.org
&lt;/VirtualHost&gt;
</pre></div></div><div
            class="para">
				Apache-tjeneren, konfigurert så langt, bruker de samme loggfiler for alle virtuelle verter (selv om dette kan endres ved å legge til <code
              class="literal">CustomLog</code>-direktiver i definisjonene til de virtuelle vertene). Det er derfor klokt å tilpasse formatet på denne loggfilen slik at den inneholder navnet på den virtuelle verten. Dette kan gjøres ved å opprette en <code
              class="filename">/etc/apache2/conf-available/customlog.conf</code>-fil som fastsetter et nytt format for alle loggfiler (med <code
              class="literal">LogFormat</code>-direktivet) og ved å aktivere den med <code
              class="command">a2enconf customlog</code>. <code
              class="literal">CustomLog</code>-linjen må også fjernes (eller kommenteres ut) fra <code
              class="filename">/etc/apache2/sites-available/000-default.conf</code>-filen.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.10.12"></a><p
              class="title"><strong>Eksempel 11.17. <code
                  class="filename">/etc/apache2/conf.d/customlog.conf</code>-filen</strong></p><div
              class="example-contents"><pre
                class="programlisting scale">
# New log format including (virtual) host name
LogFormat "%v %h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\"" vhost

# Now let's use this "vhost" format by default
CustomLog /var/log/apache2/access.log vhost
</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.11"></a>11.2.3. Vanlige direktiver</h3></div></div></div><div
            class="para">
				Dette avsnittet gir en kort gjennomgang av noen av de oftest brukte Apache-konfigurasjonsdirektivene.
			</div><a
            id="id-1.14.5.11.3"
            class="indexterm"></a><a
            id="id-1.14.5.11.4"
            class="indexterm"></a><div
            class="para">
				The main configuration file usually includes several <code
              class="literal">Directory</code> blocks; they allow specifying different behaviors for the server depending on the location of the file being served. Such a block commonly includes <code
              class="literal">Options</code> and <code
              class="literal">AllowOverride</code> directives.
			</div><a
            id="id-1.14.5.11.6"
            class="indexterm"></a><a
            id="id-1.14.5.11.7"
            class="indexterm"></a><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.11.8"></a><p
              class="title"><strong>Eksempel 11.18. Directory block</strong></p><div
              class="example-contents"><pre
                class="programlisting">
&lt;Directory /var/www&gt;
Options Includes FollowSymlinks
AllowOverride All
DirectoryIndex index.php index.html index.htm
&lt;/Directory&gt;
</pre></div></div><div
            class="para">
				The <code
              class="literal">DirectoryIndex</code> directive contains a list of files to try when the client request matches a directory. The first existing file in the list is used and sent as a response.
			</div><a
            id="id-1.14.5.11.10"
            class="indexterm"></a><div
            class="para">
				The <code
              class="literal">Options</code> directive is followed by a list of options to enable. The <code
              class="literal">None</code> value disables all options; correspondingly, <code
              class="literal">All</code> enables them all except <code
              class="literal">MultiViews</code>. Available options include:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ExecCGI</code> indicates that CGI scripts can be executed. <a
                    id="id-1.14.5.11.12.1.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">FollowSymlinks</code> tells the server that symbolic links can be followed, and that the response should contain the contents of the target of such links. <a
                    id="id-1.14.5.11.12.2.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SymlinksIfOwnerMatch</code> also tells the server to follow symbolic links, but only when the link and the its target have the same owner. <a
                    id="id-1.14.5.11.12.3.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">Includes</code> enables <span
                    class="emphasis"><em>Server Side Includes</em></span> (<span
                    class="emphasis"><em>SSI</em></span> for short). These are directives embedded in HTML pages and executed on the fly for each request. <a
                    id="id-1.14.5.11.12.4.1.4"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">Indexes</code> tells the server to list the contents of a directory if the HTTP request sent by the client points at a directory without an index file (ie, when no files mentioned by the <code
                    class="literal">DirectoryIndex</code> directive exists in this directory). <a
                    id="id-1.14.5.11.12.5.1.3"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">MultiViews</code> enables content negotiation; this can be used by the server to return a web page matching the preferred language as configured in the browser. <a
                    id="id-1.14.5.11.12.6.1.2"
                    class="indexterm"></a>
					</div></li></ul></div><div
            class="para">
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> <code
                        class="filename">.htaccess</code> file</strong></p></div></div></div><div
              class="para">
				The <code
                class="filename">.htaccess</code> file contains Apache configuration directives enforced each time a request concerns an element of the directory where it is stored. The scope of these directives also recurses to all the subdirectories within.
			</div><a
              id="id-1.14.5.11.14.3"
              class="indexterm"></a><div
              class="para">
				Most of the directives that can occur in a <code
                class="literal">Directory</code> block are also legal in a <code
                class="filename">.htaccess</code> file.
			</div></div><div
            class="para">
				The <code
              class="literal">AllowOverride</code> directive lists all the options that can be enabled or disabled by way of a <code
              class="filename">.htaccess</code> file. A common use of this option is to restrict <code
              class="literal">ExecCGI</code>, so that the administrator chooses which users are allowed to run programs under the web server's identity (the <code
              class="literal">www-data</code> user).
			</div><a
            id="id-1.14.5.11.16"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.5.11.17"></a>11.2.3.1. Requiring Authentication</h4></div></div></div><a
              id="id-1.14.5.11.17.2"
              class="indexterm"></a><div
              class="para">
					In some circumstances, access to part of a website needs to be restricted, so only legitimate users who provide a username and a password are granted access to the contents.
				</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.5.11.17.4"></a><p
                class="title"><strong>Eksempel 11.19. <code
                    class="filename">.htaccess</code> file requiring authentication</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
Require valid-user
AuthName "Private directory"
AuthType Basic
AuthUserFile /etc/apache2/authfiles/htpasswd-private
</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>SECURITY</em></span> No security</strong></p></div></div></div><div
                class="para">
					The authentication system used in the above example (<code
                  class="literal">Basic</code>) has minimal security as the password is sent in clear text (it is only encoded as <span
                  class="emphasis"><em>base64</em></span>, which is a simple encoding rather than an encryption method). It should also be noted that the documents “protected” by this mechanism also go over the network in the clear. If security is important, the whole HTTP connection should be encrypted with SSL.
				</div></div><div
              class="para">
					The <code
                class="filename">/etc/apache2/authfiles/htpasswd-private</code> file contains a list of users and passwords; it is commonly manipulated with the <code
                class="command">htpasswd</code> command. For example, the following command is used to add a user or change their password: <a
                id="id-1.14.5.11.17.6.3"
                class="indexterm"></a>
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>htpasswd /etc/apache2/authfiles/htpasswd-private <em
                    class="replaceable">user</em>
</code></strong><code
                class="computeroutput">New password:
Re-type new password:
Adding password for user <em
                  class="replaceable">user</em>
</code></pre></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.5.11.18"></a>11.2.3.2. Restricting Access</h4></div></div></div><a
              id="id-1.14.5.11.18.2"
              class="indexterm"></a><div
              class="para">
					The <code
                class="literal">Require</code> directive controls access restrictions for a directory (and its subdirectories, recursively).
				</div><a
              id="id-1.14.5.11.18.4"
              class="indexterm"></a><a
              id="id-1.14.5.11.18.5"
              class="indexterm"></a><a
              id="id-1.14.5.11.18.6"
              class="indexterm"></a><div
              class="para">
					It can be used to restrict access based on many criteria; we will stop at describing access restriction based on the IP address of the client, but it can be made much more powerful than that, especially when several <code
                class="literal">Require</code> directives are combined within a <code
                class="literal">RequireAll</code> block.
				</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.5.11.18.8"></a><p
                class="title"><strong>Eksempel 11.20. Only allow from the local network</strong></p><div
                class="example-contents"><pre
                  class="programlisting">Require ip 192.168.0.0/16
</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ALTERNATIVE</em></span> Old syntax</strong></p></div></div></div><div
                class="para">
					The <code
                  class="literal">Require</code> syntax is only available in Apache 2.4 (the version in <span
                  class="distribution distribution">Jessie</span>). For users of <span
                  class="distribution distribution">Wheezy</span>, the Apache 2.2 syntax is different, and we describe it here mainly for reference, although it can also be made available in Apache 2.4 using the <code
                  class="literal">mod_access_compat</code> module.
				</div><div
                class="para">
					The <code
                  class="literal">Allow from</code> and <code
                  class="literal">Deny from</code> directives control access restrictions for a directory (and its subdirectories, recursively).
				</div><a
                id="id-1.14.5.11.18.9.4"
                class="indexterm"></a><a
                id="id-1.14.5.11.18.9.5"
                class="indexterm"></a><a
                id="id-1.14.5.11.18.9.6"
                class="indexterm"></a><div
                class="para">
					The <code
                  class="literal">Order</code> directive tells the server of the order in which the <code
                  class="literal">Allow from</code> and <code
                  class="literal">Deny from</code> directives are applied; the last one that matches takes precedence. In concrete terms, <code
                  class="literal">Order deny,allow</code> allows access if no <code
                  class="literal">Deny from</code> applies, or if an <code
                  class="literal">Allow from</code> directive does. Conversely, <code
                  class="literal">Order allow,deny</code> rejects access if no <code
                  class="literal">Allow from</code> directive matches (or if a <code
                  class="literal">Deny from</code> directive applies).
				</div><div
                class="para">
					The <code
                  class="literal">Allow from</code> and <code
                  class="literal">Deny from</code> directives can be followed by an IP address, a network (such as <code
                  class="literal">192.168.0.0/255.255.255.0</code>, <code
                  class="literal">192.168.0.0/24</code> or even <code
                  class="literal">192.168.0</code>), a hostname or a domain name, or the <code
                  class="literal">all</code> keyword, designating everyone.
				</div><div
                class="para">
					For instance, to reject connections by default but allow them from the local network, you could use this:
				</div><pre
                class="programlisting">
Order deny,allow
Allow from 192.168.0.0/16
Deny from all
</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.12"></a>11.2.4. Log Analyzers</h3></div></div></div><div
            class="para">
				A log analyzer is frequently installed on a web server; since the former provides the administrators with a precise idea of the usage patterns of the latter.
			</div><div
            class="para">
				The Falcot Corp administrators selected <span
              class="emphasis"><em>AWStats</em></span> (<span
              class="emphasis"><em>Advanced Web Statistics</em></span>) to analyze their Apache log files.
			</div><a
            id="id-1.14.5.12.4"
            class="indexterm"></a><a
            id="id-1.14.5.12.5"
            class="indexterm"></a><a
            id="id-1.14.5.12.6"
            class="indexterm"></a><a
            id="id-1.14.5.12.7"
            class="indexterm"></a><div
            class="para">
				The first configuration step is the customization of the <code
              class="filename">/etc/awstats/awstats.conf</code> file. The Falcot administrators keep it unchanged apart from the following parameters:
			</div><pre
            class="programlisting">
LogFile="/var/log/apache2/access.log"
LogFormat = "%virtualname %host %other %logname %time1 %methodurl %code %bytesd %refererquot %uaquot"
SiteDomain="www.falcot.com"
HostAliases="falcot.com REGEX[^.*\.falcot\.com$]"
DNSLookup=1
LoadPlugin="tooltips"
</pre><div
            class="para">
				All these parameters are documented by comments in the template file. In particular, the <code
              class="varname">LogFile</code> and <code
              class="varname">LogFormat</code> parameters describe the location and format of the log file and the information it contains; <code
              class="varname">SiteDomain</code> and <code
              class="varname">HostAliases</code> list the various names under which the main web site is known.
			</div><div
            class="para">
				For high traffic sites, <code
              class="varname">DNSLookup</code> should usually not be set to <code
              class="literal">1</code>; for smaller sites, such as the Falcot one described above, this setting allows getting more readable reports that include full machine names instead of raw IP addresses.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SECURITY</em></span> Access to statistics</strong></p></div></div></div><div
              class="para">
				AWStats makes its statistics available on the website with no restrictions by default, but restrictions can be set up so that only a few (probably internal) IP addresses can access them; the list of allowed IP addresses needs to be defined in the <code
                class="varname">AllowAccessFromWebToFollowingIPAddresses</code> parameter
			</div></div><div
            class="para">
				AWStats will also be enabled for other virtual hosts; each virtual host needs its own configuration file, such as <code
              class="filename">/etc/awstats/awstats.www.falcot.org.conf</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.12.14"></a><p
              class="title"><strong>Eksempel 11.21. AWStats configuration file for a virtual host</strong></p><div
              class="example-contents"><pre
                class="programlisting">
Include "/etc/awstats/awstats.conf"
SiteDomain="www.falcot.org"
HostAliases="falcot.org"
</pre></div></div><div
            class="para">
				AWStats uses many icons stored in the <code
              class="filename">/usr/share/awstats/icon/</code> directory. In order for these icons to be available on the web site, the Apache configuration needs to be adapted to include the following directive:
			</div><pre
            class="programlisting">
Alias /awstats-icon/ /usr/share/awstats/icon/
</pre><div
            class="para">
				After a few minutes (and once the script has been run a few times), the results are available online: <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://www.falcot.com/cgi-bin/awstats.pl">http://www.falcot.com/cgi-bin/awstats.pl</a></div><div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://www.falcot.org/cgi-bin/awstats.pl">http://www.falcot.org/cgi-bin/awstats.pl</a></div>
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CAUTION</em></span> Log file rotation</strong></p></div></div></div><div
              class="para">
				In order for the statistics to take all the logs into account, <span
                class="emphasis"><em>AWStats</em></span> needs to be run right before the Apache log files are rotated. Looking at the <code
                class="literal">prerotate</code> directive of <code
                class="filename">/etc/logrotate.d/apache2</code> file, this can be solved by putting a symlink to <code
                class="filename">/usr/share/awstats/tools/update.sh</code> in <code
                class="filename">/etc/logrotate.d/httpd-prerotate</code>:
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>cat /etc/logrotate.d/apache2
</code></strong><code
                class="computeroutput">/var/log/apache2/*.log {
  daily
  missingok
  rotate 14
  compress
  delaycompress
  notifempty
  create 644 root adm
  sharedscripts
  postrotate
    if /etc/init.d/apache2 status &gt; /dev/null ; then \
      /etc/init.d/apache2 reload &gt; /dev/null; \
    fi;
  endscript
  prerotate
    if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
      run-parts /etc/logrotate.d/httpd-prerotate; \
    fi; \
  endscript
}
$ </code><strong
                class="userinput"><code>sudo mkdir -p /etc/logrotate.d/httpd-prerotate
</code></strong><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>sudo ln -sf /usr/share/awstats/tools/update.sh \
  /etc/logrotate.d/httpd-prerotate/awstats
</code></strong></pre><div
              class="para">
				Note also that the log files created by <code
                class="command">logrotate</code> need to be readable by everyone, especially AWStats. In the above example, this is ensured by the <code
                class="literal">create 644 root adm</code> line (instead of the default <code
                class="literal">640</code> permissions).
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="network-services.html"><strong>Forrige</strong>Kapittel 11. Nettverkstjenester: Postfix, Apache,...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Opp</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Hjem</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.ftp-file-server.html"><strong>Neste</strong>11.3. FTP File Server</a></li></ul></body></html>
