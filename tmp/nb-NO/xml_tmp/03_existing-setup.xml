<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
]>
<chapter id="existing-setup">
  <chapterinfo>
    <mediaobject condition="pdf">
      <imageobject>
        <imagedata fileref="images/chap-existing-setup.png" scalefit="1" />
      </imageobject>
    </mediaobject>
    <keywordset>
      <keyword>Gjeldende oppsett</keyword>
      <keyword>Gjenbruk</keyword>
      <keyword>Migrering</keyword>
    </keywordset>
  </chapterinfo>
  <title>Analysering av gjeldende oppsett og migrering</title>
  <highlights>
    <para>Enhver utbedring av datasystemer bør ta det eksisterende systemet i betraktning. Dette gjør det mulig å gjenbruke tilgjengelige ressurser så langt som mulig, og garanterer samvirke mellom de ulike elementene som inngår i systemet. Denne studien vil introdusere et generisk rammeverk som kan følges ved alle migreringer av datainfrastruktur til Linux.</para>
  </highlights>
  <section id="sect.heterogeneous-environments">
    <title>Sameksistens i ikke-ensartede omgivelser</title>
    <indexterm><primary>omgivelser</primary><secondary>ikke-ensartede omgivelser</secondary></indexterm>

    <para>Debian integreres godt i alle typer eksisterende miljøer, og samspiller godt med andre operativsystemer. Denne nesten perfekte harmoni kommer fra markedpress som krever at programvareutgivere utvikler programmer som følger standarder. Å følge standarder tillater administratorer å bytte ut programmer: Klienter eller tjenere, unsett om de er frie eller ikke.</para>
    <section>
      <title>Integrasjon med Windows-maskiner</title>

      <para>Sambas SMB/CIFS-støtte sikrer god kommunikasjon innenfor en Windowskontekst. Den deler ut filer og utskriftskøer til Windows-klienter, og inkluderer programvare som lar en Linux-maskin bruke ressurser tilgjengelig på Windows-tjenere.</para>

      <sidebar>
        <title><emphasis>VERKTØY</emphasis> Samba</title>
        <indexterm><primary>Samba</primary></indexterm>

        <para>Den nyeste versjonen av Samba kan erstatte det meste av egenskapene i Windows: Fra dem i en enkel Windows NT-tjenermaskin (autentisering, filer, utskriftskøer, nedlasting av skriverdrivere, DFS, etc.) til den mest avanserte (en domenekontroller som er kompatibel med Active Directory).</para>
      </sidebar>
    </section>
    <section>
      <title>Integrasjon med OS X-maskiner</title>

      <indexterm><primary>Zeroconf</primary></indexterm>
      <indexterm><primary>Bonjour</primary></indexterm>
      <indexterm><primary>Avahi</primary></indexterm>
      <para>OS X-maskiner tilbyr, og er i stand til å bruke, nettverkstjenester som filtjenere og skriverdeling. Disse tjenestene er publisert på det lokale nettverket, noe som tillater andre maskiner å oppdage, og gjøre bruk av dem, uten manuelt oppsett, ved hjelp av Bonjour-implementasjonen av Zeroconf-protokollsuiten. Debian inkluderer en annen implementasjon, kalt Avahi, som gir samme funksjonalitet.</para>

      <indexterm><primary>AFP</primary></indexterm>
      <indexterm><primary>AppleShare</primary></indexterm>
      <para>I den andre retningen kan Netatalk-bakgrunnsprosessn brukes til å tilby filtjenere til OS X-maskiner i nettverket. Den implementerer AFP-(AppleShare-)protokollen samt de nødvendige meldinger, slik at tjenermaskiner automatisk kan oppdages av OS X-klienter.</para>

      <indexterm><primary>AppleTalk</primary></indexterm>
      <para>Eldre Mac OS-nettverk (før OS X) brukte en annen protokoll kalt AppleTalk. For miljøer som involverer maskiner som bruker denne protokollen, tilbyr Netatalk også AppleTalk-protokollen (faktisk startet det som en reimplementering av den protokollen). Det sikrer driften av filtjeneren og utskriftskøer, samt tidsserver (klokkesynkronisering ). Ruterfunksjonen dens tillater samtrafikk med AppleTalk-nettverk.</para>
    </section>
    <section>
      <title>Integrasjon med andre Linux/Unix-maskiner</title>

      <para>Til slutt: Både NFS og NIS garanterer samspill med Unix-systemer. NFS sikrer filtjenerfunksjonalitet, mens NIS står for brukerkataloger. BSD-utskriftslaget, som brukes av de fleste Unix-systemer, gjør det også mulig å dele utskriftskøer.</para>

      <figure>
        <title>Sameksistens mellom Debian, OS X, Windows og Unix-systemer</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/existing-setup-1.png" width="25%" />
          </imageobject>
        </mediaobject>
      </figure>
    </section>
  </section>
  <section id="sect.how-to-migrate">
    <title>Hvordan migrere</title>
    <indexterm><primary>migrering</primary></indexterm>

    <para>For å sikre kontinuitet i tjenestene må hver datamaskin-migrering planlegges og gjennomføres etter planen. Dette prinsippet gjelder uansett hvilket operativsystem som brukes.</para>
    <section>
      <title>Kartlegge og identifisere tjenester</title>

      <para>Selv om det ser enkelt ut, er dette trinnet helt nødvendig. En seriøs administrator kjenner virkelig de viktigste oppgavene til hver tjenermaskin, men slike roller kan endre seg, og noen ganger kan erfarne brukere ha installert «ville» tjenester. Å vite at de eksisterer vil i det minste tillate deg å bestemme hva du skal gjøre med dem, heller enn å slette dem på måfå.</para>

      <para>For dette formålet er det fornuftig å informere brukerne om prosjektet før tjenermaskinen migreres. For å involvere dem i prosjektet kan det være nyttig å installere de vanligste fritt tilgjengelige programmene på datamaskinen deres før migreringen, de samme programmene som de vil møte igjen etter overgangen til Debian; LibreOffice og Firefox er de beste eksemplene her.</para>
      <section>
        <title>Nettverk og prosesser</title>
        <indexterm><primary><command>nmap</command></primary></indexterm>
       
	<para>Verktøyet <command>nmap</command> (i pakken med samme navn) vil raskt identifisere internettjenester som kjører på en nettverkstilkoblet maskin uten engang å kreve innlogging. Bare kjør følgende kommando på en annen maskin koblet til samme nettverk:</para>

        <screen>
<computeroutput>$ </computeroutput><userinput>nmap mirwiz</userinput>
<computeroutput>Starting Nmap 6.47 ( http://nmap.org ) at 2015-03-24 11:34 CET
Nmap scan report for mirwiz (192.168.1.104)
Host is up (0.0037s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 0.13 seconds</computeroutput></screen>

        <sidebar>
          <title><emphasis>ALTERNATIV</emphasis> Bruk <command>netstat</command> for å finne listen med tilgjengelige tjenester</title>

	  <para>På en Linux-maskin vil kommandoen <command>netstat -tupan</command> vise listen over aktive eller ventende TCP-økter, samt UDP-porter som kjørende programmer lytter til. Dette gjør det mulig å identifisere tjenestene som tilbys på nettet.</para>
        </sidebar>

        <sidebar>
          <title><emphasis>FOR VIDEREKOMMENDE</emphasis> IPv6</title>

	  <para>Noen nettverkskommandoer vil virke enten med IPv4 (vanligvis forvalgt), eller med IPv6. Disse innkluderer <command>nmap</command>, og <command>netstat</command>-kommandoer, men også andre, som <command>route</command> eller <command>ip</command>. Det normale er at dette gjøres mulig ved å velge kommandolinjen <parameter>-6</parameter>.</para>
        </sidebar>

	<para>Hvis tjenermaskinen er en Unix-maskin med skallkontoer til brukere, er det interessant å finne ut om prosesser kjører i bakgrunnen i eierens fravær. Kommandoen <command>ps auxw</command> viser en liste med alle prosesser med tilhørende brukeridentitet. Ved å sjekke denne informasjonen opp mot resultatet av <command>who</command>-kommandoen, som gir en liste over innloggede brukere, er det mulig å identifisere problematiske eller ikke synlige tjenere eller programmer som kjører i bakgrunnen. Å se på <filename>crontabs</filename> (tabeller som automatisk lister handlinger satt opp av brukere) vil ofte gi interessant informasjon om oppgaver tjeneren har utført (en full forklaring av <command>cron</command> er tilgjengelig på <xref linkend="sect.task-scheduling-cron-atd" />).</para>

	<para>Uansett er det viktig å ta sikkerhetskopi av dine tjenermaskiner: Det tillater gjenoppretting av informasjon i ettertid, når brukere rapporterer spesifikke problemer som følge av migreringen.</para>
      </section>
    </section>
    <section>
      <title>Sikkerhetskopi av oppsettet</title>

      <para>Det er lurt å beholde oppsettet til hver identifiserte tjeneste for å kunne installere den tilsvarende på den oppdaterte tjenermaskinen. Minstekravet er å lage en sikkerhetskopi av oppsettsfilene.</para>

      <para>For Unix-maskiner finnes oppsettsfilene vanligvis i <filename>/etc/</filename>, men de kan befinne seg i en underkatalog av <filename>/usr/local/</filename>. Dette er tilfellet dersom et program har blitt installert fra kildekoden, i stedet for som en pakke. I noen tilfeller kan man også finne dem under <filename>/opt/</filename>.</para>

      <para>For administrative datatjenester (for eksempel databaser) er det sterkt anbefalt å eksportere dataene til et standard format som vil være lett for den nye programvaren å importere. Et slikt format er vanligvis i tekstmodus og dokumentert; det kan for eksempel være en SQL-utskift av en database, eller en LDIF-fil for en LDAP-tjener.</para>

      <figure>
        <title>Sikkerhetskopi av databaser</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/existing-setup-2.png" width="50%" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>Hver tjenerprogramvare er forskjellig, og det er umulig å beskrive alle eksisterende tilfeller i detalj. Sammenlign dokumentasjon for den eksisterende og den nye programvaren for å identifisere hvilke deler som kan eksporteres (og dermed lastes inn igjen), og de som vil kreve manuell håndtering. Å lese denne boken vil avklare oppsettet av de viktigste Linux-tjenerprogrammene.</para>
    </section>
    <section>
      <title>Å overta en eksisterende Debian-tjenermaskin</title>
      <indexterm><primary>gjenopprette en Debian-maskin</primary></indexterm>
      <indexterm><primary>utforske en Debian-maskin</primary></indexterm>
      <indexterm><primary>ta over en Debian-tjenermaskin</primary></indexterm>

      <para>For effektivt å ta over vedlikeholdet av maskinen kan man analysere en maskin som allerede kjører med Debian.</para>

      <para>Den første filen som bør sjekkes er <filename>/etc/debian_version</filename>, som vanligvis inneholder versjonsnummeret for det installerte Debian-systemet (det er en del av pakken <emphasis>base-files</emphasis>). Hvis den indikerer <literal><replaceable>codename</replaceable>/sid</literal>, betyr det at systemet ble oppdatert med pakker som kommer fra en av utviklingsdistribusjonene (enten testing eller unstable).</para>

      <para>Programmet <command>apt-show-versions</command> (fra Debian-pakken med samme navn) sjekker listen over installerte pakker, og identifiserer de tilgjengelige versjonene. <command>aptitude</command> kan også brukes til disse oppgavene, om enn på en mindre systematisk måte.</para>

      <para>Et blikk på <filename>/etc/apt/sources.list</filename>-filen (og <filename>/etc/apt/sources.list.d/</filename>-katalogen) viser hvor de installerte Debian-pakker sannsynligvis kommer fra. Hvis mange ukjente kilder vises, kan administratoren velge å fullstendig installere maskinens system på nytt for å sikre optimal samvirke med programvaren levert av Debian.</para>

      <para>Filen <filename>sources.list</filename> er ofte en god indikator: flertallet av administratorene beholder, i alle fall utkommentert, listen over APT-kilder som tidligere ble brukt. Men du bør ikke glemme at tidligere brukte kilder kan ha blitt slettet, og at noen tilfeldige pakker tatt fra Internettet kan ha blitt installert manuelt (med <command>dpkg</command>-kommandoen). I slike tilfeller fremstår maskinen misvisende som en «standard» Debian. Dette er grunnen til at du bør være oppmerksom på enhver indikasjon som vil avdekke tilstedeværelsen av eksterne pakker (forekomsten av <filename>deb</filename>-filer i uvanlige kataloger, pakkeversjonsnumre med en spesiell endelse som indikerer at de stammer fra kilder utenfor Debian-prosjektet, som for eksempel <literal>ubuntu</literal> eller <literal>lmde</literal>, etc.)</para>

      <para>På samme måte er det interessant å analysere innholdet av <filename>/usr/local/</filename>-katalogen, hvis formål er å inneholde programmer kompilert og installert manuelt. Opplisting av programvare installert på denne måten er instruktivt, siden dette reiser spørsmålet om hvorfor den tilsvarende Debian-pakken ikke brukes, hvis en slik pakke eksisterer.</para>

      <sidebar>
        <title><emphasis>RASK TITT</emphasis> <emphasis role="pkg">cruft</emphasis></title>

	<para>Pakke <emphasis role="pkg">cruft</emphasis> tilbyr å liste opp tilgjengelige filer som ikke eies av en pakke. Den har noen filtre (mer eller mindre effektive, og mer eller mindre oppdatert) for å unngå rapportering av noen legitime filer (filer generert av Debian-pakker, eller genererte oppsettsfiler ikke styrt av <command>dpkg</command>, etc.).</para>

	<para>Vær forsiktig: Ikke slett blindt alt som <command>cruft</command> måtte liste!</para>
      </sidebar>
    </section>
    <section>
      <title>Installasjon av Debian</title>

      <para>Når all nødvendig informasjon om den aktuelle tjenermaskinen er kjent, kan vi slå maskinen av og starte installasjonen av Debian på den.</para>
      <indexterm><primary>arkitektur</primary></indexterm>

      <para>For å velge den riktige versjonen må vi kjenne datamaskinens arkitektur. Hvis den er en rimelig fersk PC, er den mest sannsynlig en amd64 (eldre PC-er er vanligvis i386). I andre tilfeller kan vi avgrense mulighetene ut fra det systemet som ble brukt tidligere.</para>

      <para><xref linkend="tab-corresp" xrefstyle="select: label nopage" /> er ikke ment å være uttømmende, men kan være nyttig. Uansett er den opprinnelige dokumentasjonen for datamaskinen den mest pålitelige kilden for å finne denne informasjonen.</para>

      <table colsep="1" id="tab-corresp">
        <title>Samsvarende operativsystem og arkitektur</title>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Operativsystem</entry>
              <entry>Arkitektur(er)</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>DEC Unix (OSF/1)</entry>
              <entry>alpha, mipsel</entry>
            </row>
            <row>
              <entry>HP Unix</entry>
              <entry>ia64, hppa</entry>
            </row>
            <row>
              <entry>IBM AIX</entry>
              <entry>powerpc</entry>
            </row>
            <row>
              <entry>Irix</entry>
              <entry>mips</entry>
            </row>
            <row>
              <entry>OS X</entry>
              <entry>amd64, powerpc, i386</entry>
            </row>
            <row>
              <entry>z/OS, MVS</entry>
              <entry>s390x, s390</entry>
            </row>
            <row>
              <entry>Solaris, SunOS</entry>
              <entry>sparc, i386, m68k</entry>
            </row>
            <row>
              <entry>Ultrix</entry>
              <entry>mips</entry>
            </row>
            <row>
              <entry>VMS</entry>
              <entry>alpha</entry>
            </row>
            <row>
              <entry>Windows 95/98/ME</entry>
              <entry>i386</entry>
            </row>
            <row>
              <entry>Windows NT/2000</entry>
              <entry>i386, alpha, ia64, mipsel</entry>
            </row>
            <row>
              <entry>Windows XP / Windows Server 2008</entry>
              <entry>i386, amd64, ia64</entry>
            </row>
            <row>
              <entry>Windows Vista / Windows 7 / Windows 8</entry>
              <entry>i386, amd64</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <sidebar>
        <title><emphasis>MASKINVARE</emphasis> 64-bit PC vs 32-bit PC</title>
        <indexterm><primary>amd64</primary></indexterm>
        <indexterm><primary>i386</primary></indexterm>

	<para>De fleste nye datamaskiner har 64-bit Intel- eller AMD-prosessorer, som er kompatible med eldre 32-bit prosessorer; derfor fungerer programvare kompilert for «i386»-arkitekturen. På den annen side, denne kompatibilitetsmodus utnytter ikke fullt ut egenskapene til disse nye prosessorene. Dette er grunnen til Debian leverer «amd64»-arkitekturen, som kjører på AMD-brikker så vel som Intel «em64t»-prosessorer (inkludert de fleste i Core-serien), som er svært lik AMD64.</para>
      </sidebar>
    </section>
    <section>
      <title>Installasjon og oppsett av de valgte tjenestene</title>

      <para>Når Debian er installert, må vi installere og sette opp en etter en alle de tjenestene som denne datamaskinen må ha. Det nye oppsettet må ta hensyn til den foregående for å sikre en myk overgang. All informasjon som samles inn i de to første trinnene vil være nyttig for å fullføre denne delen.</para>

      <figure>
        <title>Installasjon av de valgte tjenestene</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/existing-setup-4.png" width="66%" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>Før du hopper inn i denne øvelsen med begge føttene, er det sterkt anbefalt at du leser resten av denne boken. Etter det du vil ha en mer presis forståelse av hvordan du setter opp de forventede tjenestene.</para>

      <para></para>
    </section>
  </section>
</chapter>
