<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">15.3. Criando um Repositório de Pacotes para o APT</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-pt-BR-1.0-1" /><meta
        name="keywords"
        content="Backport, Reconstruir, Pacote fonte, Arquivo, Meta-pacote, Desenvolvedor Debian, Mantenedor" /><link
        rel="home"
        href="index.html"
        title="O Manual do Administrador Debian" /><link
        rel="up"
        href="debian-packaging.html"
        title="Capítulo 15. Criando um Pacote Debian" /><link
        rel="prev"
        href="sect.building-first-package.html"
        title="15.2. Construindo seu Primeiro Pacote" /><link
        rel="next"
        href="sect.becoming-package-maintainer.html"
        title="15.4. Tornando-se um Mantenedor de Pacotes" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/pt-BR/stable/sect.setup-apt-package-repository.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.building-first-package.html"><strong>Anterior</strong></a></li><li
          class="home">O Manual do Administrador Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.becoming-package-maintainer.html"><strong>Próxima</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.setup-apt-package-repository"></a>15.3. Criando um Repositório de Pacotes para o APT</h2></div></div></div><a
          id="id-1.18.6.2"
          class="indexterm"></a><a
          id="id-1.18.6.3"
          class="indexterm"></a><div
          class="para">
			A Falcot Corp gradualmente começou a manter alguns pacotes Debian modificados localmente a partir de pacotes existentes ou criados do zero para distribuir dados e programas internos.
		</div><div
          class="para">
			Para facilitar a instalação, eles querem integrar estes pacotes em um repositório que possa ser acessado diretamente usando a ferramenta APT. Por motivos de manutenção óbvios, eles querem separar os pacotes internos dos pacotes reconstruídos localmente. O objetivo é ter as entradas correspondentes no arquivo <code
            class="filename">/etc/apt/sources.list.d/falcot.list</code> como segue:
		</div><pre
          class="programlisting">
deb http://packages.falcot.com/ updates/
deb http://packages.falcot.com/ internal/</pre><a
          id="id-1.18.6.7"
          class="indexterm"></a><div
          class="para">
			Os administradores, portanto, configuram uma máquina virtual em seu servidor HTTP interno, com <code
            class="filename">/srv/vhosts/packages/</code> como a raiz do espaço web associado. A gestão do repositório é delegada ao comando <code
            class="command">mini-dinstall</code> (no pacote de mesmo nome). Esta ferramenta mantém um olho em um diretório <code
            class="filename">incoming/</code> (no nosso caso, <code
            class="filename">/srv/vhosts/packages/mini-dinstall/incoming/</code>) e espera por novos pacotes lá; quando um pacote for carregado, ele é instalado em um repositório Debian em <code
            class="filename">/srv/vhosts/packages/</code>. O comando <code
            class="command">mini-dinstall</code> lê o arquivo <code
            class="filename">*.changes</code> criado quando o pacote Debian é gerado. Esses arquivos contêm uma lista de todos os outros arquivos associados com a versão do pacote (<code
            class="filename">*.deb</code>, <code
            class="filename">*.dsc</code>, <code
            class="filename">*.diff.gz</code>/<code
            class="filename">*.debian.tar.gz</code>, <code
            class="filename">*.orig.tar.gz</code>, ou seus equivalentes com outras ferramentas de compressão), e que permitem <code
            class="command">mini-dinstall</code> saber quais arquivos instalar. Arquivos <code
            class="filename">*.changes</code> também contêm o nome da distribuição alvo (muitas vezes <code
            class="literal">unstable</code>) mencionado na última entrada <code
            class="filename">debian/changelog</code>, e <code
            class="command">mini-dinstall</code> usa essas informações para decidir onde o pacote deve ser instalado. É por isso que os administradores devem sempre alterar este campo antes de construir um pacote, e configurá-lo para <code
            class="literal">internal</code> ou <code
            class="literal">updates</code>, dependendo da localização do alvo. O <code
            class="command">mini-dinstall</code> gera, então, os arquivos necessários para o APT, como o <code
            class="filename">Packages.gz</code>.
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>ALTERNATIVA</em></span> <code
                      class="command">apt-ftparchive</code></strong></p></div></div></div><a
            id="id-1.18.6.9.2"
            class="indexterm"></a><div
            class="para">
			Se <code
              class="command">mini-dinstall</code> parece demasiado complexo para as suas necessidades de empacotamento Debian, você também pode usar o comando <code
              class="command">apt-ftparchive</code>. Esta ferramenta verifica o conteúdo de um diretório e exibe (em sua saída padrão) um arquivo <code
              class="filename">Packages</code> correspondente. No caso da Falcot Corp, os administradores podem carregar os pacotes diretamente em <code
              class="filename">/srv/vhosts/packages/updates/</code> ou <code
              class="filename">/srv/vhosts/packages/internal/</code>, em seguida, executar os seguintes comandos para criar os arquivos <code
              class="filename">Packages.gz</code>:
		</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>cd /srv/vhosts/packages</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>apt-ftparchive packages updates &gt;updates/Packages</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>gzip updates/Packages</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>apt-ftparchive packages internal &gt;internal/Packages</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>gzip internal/Packages</code></strong></pre><div
            class="para">
			O comando <code
              class="command">apt-ftparchive sources</code> permite criar arquivos <code
              class="filename">Sources.gz</code> de maneira similar.
		</div></div><div
          class="para">
			Para configurar o <code
            class="command">mini-dinstall</code> é necessário a configuração do arquivo <code
            class="filename">~/.mini-dinstall.conf</code>; no caso da Falcot Corp, o conteúdo é o seguinte:
		</div><pre
          class="programlisting">
[DEFAULT]
archive_style = flat
archivedir = /srv/vhosts/packages

verify_sigs = 0
mail_to = admin@falcot.com

generate_release = 1
release_origin = Falcot Corp
release_codename = stable

[updates]
release_label = Recompiled Debian Packages

[internal]
release_label = Internal Packages</pre><div
          class="para">
			Uma decisão que merece atenção é a geração de arquivos <code
            class="filename">Release</code> para cada pacote. Isso pode ajudar a gerenciar as prioridades de instalação de pacotes usando o arquivo de configuração <code
            class="filename">/etc/apt/preferences</code> (veja em <a
            class="xref"
            href="sect.apt-get.html#sect.apt.priorities">Seção 6.2.5, “Gerenciar prioridades de pacote”</a> para detalhes).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>SEGURANÇA</em></span> <code
                      class="command">mini-dinstall</code> e permissões</strong></p></div></div></div><div
            class="para">
			Como o <code
              class="command">mini-dinstall</code> foi concebido para ser executado como um usuário normal, não há necessidade de executá-lo como root. A maneira mais fácil é configurar tudo dentro da conta de usuário que pertence ao administrador encarregado de criar os pacotes Debian. Uma vez que apenas este administrador tem as permissões necessárias para colocar os arquivos no directório <code
              class="filename">incoming/</code>, podemos deduzir que o administrador autenticou a origem de cada pacote antes da publicação e o <code
              class="command">mini-dinstall</code> não precisam fazê-lo novamente. Isto explica o parâmetro <code
              class="literal">verify_sigs = 0</code> (o que significa que as assinaturas não precisam ser verificadas). No entanto, se o conteúdo dos pacotes é secreto, podemos inverter o cenário e eleger para autenticar com um chaveiro contendo as chaves públicas de pessoas com autorização para criar pacotes (configurados com o parâmetro <code
              class="literal">extra_keyrings</code>); <code
              class="command">mini-dinstall</code> irá então verificar a origem de cada pacote de entrada através da análise da assinatura integrado para o arquivo <code
              class="filename">*.changes</code>.
		</div></div><div
          class="para">
			Executar <code
            class="command">mini-dinstall</code> começa, na verdade, um daemon em segundo plano. Enquanto este daemon é executado, ele irá verificar se há novos pacotes no diretório <code
            class="filename">incoming/</code> a cada meia hora; quando um novo pacote chegar, ele será movido para o repositório e os arquivos <code
            class="filename">Packages.gz</code> e <code
            class="filename">Sources.gz</code> serão restaurados. Se executar um daemon é um problema, <code
            class="command">mini-dinstall</code> também pode ser chamado manualmente no modo batch (com a opção <code
            class="literal">-b</code>) cada vez que um pacote for enviado para o diretório <code
            class="filename">incoming/</code>. Outras possibilidades oferecidas pelo <code
            class="command">mini-dinstall</code> estão documentadas na sua página de manual <span
            class="citerefentry"><span
              class="refentrytitle">mini-dinstall</span>(1)</span>.
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>EXTRA</em></span> Gerando um arquivo assinado</strong></p></div></div></div><div
            class="para">
			A suíte APT verifica uma cadeia de assinaturas criptográficas nos pacotes que ela trata, antes de instalá-los, para que se garantam suas autenticidades (veja <a
              class="xref"
              href="sect.package-authentication.html">Seção 6.5, “Verificando Autenticidade do Pacote”</a>). Repositórios APT privados podem ser um problema, uma vez que as máquinas que os usam irão ficar exibindo alertas de pacotes não assinados. Um administrador zeloso, portanto, integrará arquivos privados com o mecanismo de APT seguro.
		</div><div
            class="para">
			Para ajudar nesse processo, o <code
              class="command">mini-dinstall</code> inclui uma opção de configuração <code
              class="literal">release_signscript</code> que permite especificar um script que será usado para gerar a assinatura. Um bom ponto de partida é o script <code
              class="filename">sign-release.sh</code> fornecido pelo pacote <span
              class="pkg pkg">mini-dinstall</span> em <code
              class="filename">/usr/share/doc/mini-dinstall/examples/</code>; pode ser relevante fazer mudanças específicas.
		</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.building-first-package.html"><strong>Anterior</strong>15.2. Construindo seu Primeiro Pacote</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Acima</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Principal</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.becoming-package-maintainer.html"><strong>Próxima</strong>15.4. Tornando-se um Mantenedor de Pacotes</a></li></ul></body></html>
