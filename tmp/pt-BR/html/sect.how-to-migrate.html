<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">3.2. Como Migrar</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-pt-BR-1.0-1" /><meta
        name="keywords"
        content="Configuração Existente, Reutilização, Migração" /><link
        rel="home"
        href="index.html"
        title="O Manual do Administrador Debian" /><link
        rel="up"
        href="existing-setup.html"
        title="Capítulo 3. Analisando a Configuração Existente e Migrando" /><link
        rel="prev"
        href="existing-setup.html"
        title="Capítulo 3. Analisando a Configuração Existente e Migrando" /><link
        rel="next"
        href="installation.html"
        title="Capítulo 4. Instalação" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/pt-BR/stable/sect.how-to-migrate.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="existing-setup.html"><strong>Anterior</strong></a></li><li
          class="home">O Manual do Administrador Debian</li><li
          class="next"><a
            accesskey="n"
            href="installation.html"><strong>Próxima</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.how-to-migrate"></a>3.2. Como Migrar</h2></div></div></div><a
          id="id-1.6.5.2"
          class="indexterm"></a><div
          class="para">
			Para garantir a continuidade dos serviços, cada migração de computador deve ser planejada e executada de acordo com o plano. Este princípio se aplica independente do sistema operacional utilizado.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.6.5.4"></a>3.2.1. Pesquisar e Identificar Serviços</h3></div></div></div><div
            class="para">
				Tão simples quanto parece, este passo é essencial. Um administrador sério sabe realmente quais são os principais papéis de cada servidor, mas estes papéis podem mudar, e as vezes usuários experientes podem ter instalado serviços "selvagens". Sabendo que eles existem irá pelo menos permitir que você decida o que fazer com eles, em vez de excluí-los ao acaso.
			</div><div
            class="para">
				Para este propósito, é sábio informar aos seus usuários do projeto antes de migar os servidores. Para envolvê-los no projeto, pode ser útil instalar os programas de software livre mais comuns em suas máquinas antes da migração, com os quais eles irão se deparar novamente após a migração para o Debian; LibreOffice e a suíte de aplicativos Mozilla são os melhores exemplos aqui.
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.6.5.4.4"></a>3.2.1.1. Rede e Processos</h4></div></div></div><a
              id="id-1.6.5.4.4.2"
              class="indexterm"></a><div
              class="para">
					A ferramenta <code
                class="command">nmap</code> (contida no pacote de mesmo nome) irá rapidamente identificar Serviços de Internet hospedados por uma máquina conectada na rede sem a necessidade de se logar. Simplesmente chame o seguinte comando em outra máquina conectada na mesma rede:
				</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>nmap mirwiz</code></strong>
<code
                class="computeroutput">Starting Nmap 6.47 ( http://nmap.org ) at 2015-03-24 11:34 CET
Nmap scan report for mirwiz (192.168.1.104)
Host is up (0.0037s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 0.13 seconds</code></pre><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ALTERNATIVA</em></span> Use o <code
                          class="command">netstat</code> para encontrar a lista de serviços disponíveis</strong></p></div></div></div><div
                class="para">
					Em uma máquina Linux, o comando <code
                  class="command">netstat -tupan</code> irá exibir a lista de sessões TCP ativas ou pendentes, bem como portas UDP em que processos em execução estão ouvindo. Isto facilita a identificação de serviços oferecidos na rede.
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>INDO ALÉM</em></span> IPv6</strong></p></div></div></div><div
                class="para">
					Alguns comandos de rede podem funcionar com IPv4 (o padrão geralmente) ou com IPv6. Entre eles estão o <code
                  class="command">nmap</code> e o <code
                  class="command">netstat</code>, mas também outros, como o <code
                  class="command">route</code> ou o <code
                  class="command">ip</code>. A convenção é que este comportamento seja habilitado pela opção de comandos de linha <em
                  class="parameter"><code>-6</code></em>.
				</div></div><div
              class="para">
					Se o servidor é uma máquina Unix oferecendo contas shell a usuários, é interessante determinar se processos são executados em segundo plano na ausência de seus donos. O comando <code
                class="command">ps auxw</code> exibe uma lista de todos os processos com suas identidades de usuários. Checando esta informação contra a saída do comando <code
                class="command">who</code>, que mostra uma lista de usuários logados, é possível identificar servidores ladões ou não-declarados ou programas rodando em segundo plano. Olhando para <code
                class="filename">crontabs</code> (tabelas listando ações automáticas agendadas por usuários) irá, muitas vezes, fornecer informações interessantes sobre funções cumpridas pelo servidor (uma explicação completa do <code
                class="command">cron</code> está disponível em <a
                class="xref"
                href="sect.task-scheduling-cron-atd.html">Seção 9.7, “Agendando Tarefas com <code
                  class="command">cron</code> e <code
                  class="command">atd</code>”</a>).
				</div><div
              class="para">
					Em qualquer caso, é essencial fazer backup de seus servidores: isto permite a recuperação de informações após o fato, quando usuários irão reportar problemas específicos devido a migração.
				</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.6.5.5"></a>3.2.2. Fazendo Backup da Configuração</h3></div></div></div><div
            class="para">
				É sábio manter a configuração de cada serviço identificado para poder instalar o equivalente no servidor atualizado. O mínimo é fazer uma cópia de segurança dos arquivos de configuração.
			</div><div
            class="para">
				Para máquinas Unix, os arquivos de configuração são normalmente encontrados em <code
              class="filename">/etc/</code>, mas eles podem estar localizados em um sub-diretório de <code
              class="filename">/usr/local/</code>. Este é o caso se um programa foi instalado a partir dos fontes, ao invés de um pacote. Em alguns casos, também podem ser encontrados em <code
              class="filename">/opt/</code>.
			</div><div
            class="para">
				Para serviços de gestão de dados (como em bancos de dados), é fortemente recomendado exportar os dados para um formato padrão que seja facilmente importado pelo novo software. Tal formato é usualmente em modo texto e documentado; ele pode ser, por exemplo, um dump SQL para um banco de dados, ou um arquivo LDIF para um servidor LDAP.
			</div><div
            class="figure"><a
              xmlns=""
              id="id-1.6.5.5.5"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/existing-setup-2.png"
                  alt="Backups de bases de dados" /></div></div><p
              class="title"><strong>Figura 3.2. Backups de bases de dados</strong></p></div><div
            class="para">
				Cada software de servidor é diferente, e é impossível descrever todos os casos existentes em detalhes. Compare a documentação do software existente com a do novo para identificar as porções exportáveis (portanto, re-importáveis) e as que requerem manipulação manual. A leitura deste livro vai clarear a configuração dos principais programas de servidor Linux.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.6.5.6"></a>3.2.3. Assumindo um servidor Debian existente</h3></div></div></div><a
            id="id-1.6.5.6.2"
            class="indexterm"></a><a
            id="id-1.6.5.6.3"
            class="indexterm"></a><a
            id="id-1.6.5.6.4"
            class="indexterm"></a><div
            class="para">
				Para assumir efetivamente sua manutenção, deve se analisar uma máquina que já esteja rodando o Debian.
			</div><div
            class="para">
				O primeiro arquivo a verificar é o <code
              class="filename">/etc/debian_version</code>, que usualmente contém o número de versão para o sistema Debian instalado (ele é parte do pacote <span
              class="emphasis"><em>base-files</em></span>). Se ele indica <code
              class="literal"><em
                class="replaceable">codenome</em>/sid</code>, significa que o sistema foi atualizado com pacotes vindos de uma das distribuições de desenvolvimento (tanto testing quanto unstable).
			</div><div
            class="para">
				O programa <code
              class="command">apt-show-versions</code> (do pacote Debian de mesmo nome) verifica a lista de pacotes instalados e identifica as versões disponíveis. O <code
              class="command">aptitude</code> pode também ser usado para estas tarefas, embora de uma maneira menos sistemática.
			</div><div
            class="para">
				Uma olhada no arquivo <code
              class="filename">/etc/apt/sources.list</code> (e no diretório <code
              class="filename">/etc/apt/sources.list.d/</code>) mostrará de onde os pacotes debian instalados costumam vir. Se muitas fontes desconhecidas aparecem, o administrador pode escolher reinstalar o sistema do computador para garantir compatibilidade ótima com o software fornecido com o Debian.
			</div><div
            class="para">
				O arquivo <code
              class="filename">sources.list</code> geralmente é um bom indicador: a maioria dos administradores mantem, pelo menos comentada, a lista de fontes APT anteriormente usadas. Mas você não deve esquecer que fontes usadas no passado podem ter sido apagadas, e que alguns pacotes podem ter sido baixados da internet e instalados manualmente (com o comando <code
              class="command">dpkg</code>). Neste caso, a máquina não é tão "Debian padrão" quanto parece. É por isso que você deve prestar atenção em indicações de presença de pacotes externos (surgimento de arquivos <code
              class="filename">deb</code> em diretórios estranhos, números de versão com um sufixo especial in:dicando que é originado de fora do projeto Debian, como um <code
              class="literal">ubuntu</code> ou <code
              class="literal">Imde</code>, etc.)
			</div><div
            class="para">
				Da mesma forma, é interessante analizar o conteúdo da diretório <code
              class="filename">/usr/local/</code>, que deve conter os programas compilados e instalados manualmente. Listar os programas instalados desta maneira é instrutivo, já que se questiona o porque de não se ter usado o pacote Debian correspondente, se este existir.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>OLHADA RÁPIDA</em></span> <span
                        class="pkg pkg">cruft</span></strong></p></div></div></div><div
              class="para">
				O pacote <span
                class="pkg pkg">cruft</span> se propõe a lista os arquivos disponíveis que não são de propriedade de nenhum pacote. Ele tem alguns filtros (mais ou menos efetivos, e mais ou menos atualizados) para evitar botar no relatório alguns arquivos legítimos (arquivos gerados por pacotes Debian, ou arquivos de configuração gerados não-controlados pelo <code
                class="command">dpkg</code>, etc.).
			</div><div
              class="para">
				Cuidado para não apagar arbitrariamente tudo que o <code
                class="command">cruft</code> venha a listar!
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.6.5.7"></a>3.2.4. Instalando o Debian</h3></div></div></div><div
            class="para">
				Com toda a informação no servidor atual agora conhecida, podemos desligá-lo e começar a instalar o Debian nele.
			</div><a
            id="id-1.6.5.7.3"
            class="indexterm"></a><div
            class="para">
				Para escolher a versão apropriada, devemos conhecer a arquitetura do computador. Se for um PC relativamente novo, é provável que seja um amd64 (PCs mais antigos normalmente são i386). Caso contrário, podemos restringir as possibilidades de acordo com o sistema usado anteriormente.
			</div><div
            class="para">
				<a
              class="xref"
              href="sect.how-to-migrate.html#tab-corresp">Tabela 3.1</a> não pretende ser exaustiva, mas útil. de qualquer forma, a documentação original do computador é a fonte mais confiável para encontrar esta informação.
			</div><div
            class="table"><a
              xmlns=""
              id="tab-corresp"></a><p
              class="title"><strong>Tabela 3.1. Arquitetura e respectivo sistema operacional</strong></p><div
              class="table-contents"><table
                xmlns:d="http://docbook.org/ns/docbook"
                class="lt-4-cols gt-7-rows"
                summary="Arquitetura e respectivo sistema operacional"><colgroup><col /><col /></colgroup><thead><tr><th>Sistema Operacional</th><th>Arquitetura(s)</th></tr></thead><tbody><tr><td>DEC Unix (OSF/1)</td><td>alpha, mipsel</td></tr><tr><td>HP Unix</td><td>ia64, hppa</td></tr><tr><td>IBM AIX</td><td>powerpc</td></tr><tr><td>Irix</td><td>mips</td></tr><tr><td>OS X</td><td>amd64, powerpc, i386</td></tr><tr><td>z/OS, MVS</td><td>s390x, s390</td></tr><tr><td>Solaris, SunOS</td><td>sparc, i386, m68k</td></tr><tr><td>Ultrix</td><td>mips</td></tr><tr><td>VMS</td><td>alpha</td></tr><tr><td>Windows 95/98/ME</td><td>i386</td></tr><tr><td>Windows NT/2000</td><td>i386, alpha, ia64, mipsel</td></tr><tr><td>Windows XP / Windows Server 2008</td><td>i386, amd64, ia64</td></tr><tr><td>Windows Vista / Windows 7 / Windows 8</td><td>i386, amd64</td></tr></tbody></table></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong>o <span
                        class="emphasis"><em>HARDWARE</em></span> dos PCs de 64 bit vs 32 bit</strong></p></div></div></div><a
              id="id-1.6.5.7.7.2"
              class="indexterm"></a><a
              id="id-1.6.5.7.7.3"
              class="indexterm"></a><div
              class="para">
				Computadores mais novos tem processadores Intel ou AMD de 64 bits, compatíveis com os antigos processadores de 32 bits; o software compilado para arquitetura “i386” então funciona. Por outro lado, este modo de compatibilidade não explora completamente as capacidades destes novos processadores. É por isto que o Debian fornece a arquitetura amd64, que funciona com chips AMD recentes. Assim como processadores “em64t” da Intel (incluindo a maioria da série Core), que são muito similares aos processadores AMD64.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.6.5.8"></a>3.2.5. Instalando e Configurando os Serviços Selecionados</h3></div></div></div><div
            class="para">
				Depois do Debian instalado, devemos instalar e configurar um a um os serviços que o computador vai hospedar. A nova configuração deve levar em consideração a anterior para garantir uma transição suave. Toda a informação coletada nos primeiros dois passos será útil para completar com sucesso esta parte.
			</div><div
            class="figure"><a
              xmlns=""
              id="id-1.6.5.8.3"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/existing-setup-4.png"
                  alt="Instalar os serviços selecionados" /></div></div><p
              class="title"><strong>Figura 3.3. Instalar os serviços selecionados</strong></p></div><div
            class="para">
				Antes de pular de cabeça neste exercício, é fortemente recomendado que você leia o restante deste livro. Depois disto, você terá um conhecimento mais preciso de como configurar os serviços esperados.
			</div><div
            class="para">
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="existing-setup.html"><strong>Anterior</strong>Capítulo 3. Analisando a Configuração Existente e...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Acima</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Principal</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="installation.html"><strong>Próxima</strong>Capítulo 4. Instalação</a></li></ul></body></html>
