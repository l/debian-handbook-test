<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.4. Servidor de Arquivos NFS</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-pt-BR-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="O Manual do Administrador Debian" /><link
        rel="up"
        href="network-services.html"
        title="Capítulo 11. Serviços de Rede: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="sect.ftp-file-server.html"
        title="11.3. Servidor de Arquivos FTP" /><link
        rel="next"
        href="sect.windows-file-server-with-samba.html"
        title="11.5. Configurando um Compartilhamento Windows com o Samba" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/pt-BR/stable/sect.nfs-file-server.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>Anterior</strong></a></li><li
          class="home">O Manual do Administrador Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>Próxima</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.nfs-file-server"></a>11.4. Servidor de Arquivos NFS</h2></div></div></div><div
          class="para">
			O NFS (<span
            class="emphasis"><em>Network File System</em></span>) é um protocolo que permite acesso remoto a um sistema de arquivos através da rede. Todos os sistemas Unix podem trabalhar com esse protocolo; mas quando sistemas Windows estão envolvidos, o Samba tem que ser usado.
		</div><a
          id="id-1.14.7.3"
          class="indexterm"></a><a
          id="id-1.14.7.4"
          class="indexterm"></a><a
          id="id-1.14.7.5"
          class="indexterm"></a><a
          id="id-1.14.7.6"
          class="indexterm"></a><a
          id="id-1.14.7.7"
          class="indexterm"></a><div
          class="para">
			O NFS é uma ferramenta muito útil, mas historicamente, ela tem sofrido com muitas limitações, a maioria delas tendo sido atribuídas a versão 4 do protocolo. A contrapartida é que a última versão do NFS é mais difícil de configurar quando você quer usar recursos básicos de segurança tais como autenticação e criptografia já que ele faz uso do Kerberos para esses assuntos. E sem isso, o protocolo NFS tem que ficar restrito a uma rede local confiável já que os dados viajam pela rede sem criptografia (um <span
            class="emphasis"><em>sniffer</em></span> pode interceptá-los) e os direitos de acesso são optidos com base no endereço IP do cliente (que pode ser falsificado ("spoofed")).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>DOCUMENTAÇÃO</em></span> NFS HOWTO</strong></p></div></div></div><div
            class="para">
			Boa documentação para implementar o NFSv4 é bastante escassa. Aqui estão algumas indicações de conteúdo com qualidade variável, mas que devem ao menos dar algumas pistas sobre o que deve ser feito. <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="https://help.ubuntu.com/community/NFSv4Howto">https://help.ubuntu.com/community/NFSv4Howto</a></div> <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration">http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration</a></div>
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.10"></a>11.4.1. Proteção do NFS</h3></div></div></div><a
            id="id-1.14.7.10.2"
            class="indexterm"></a><div
            class="para">
				Se você não usa recursos de segurança baseados no Kerberos, é vital garantir que apenas máquinas com permissão de usar o NFS possam se conectar nos vários servidores RPC requeridos, porque o protocolo básico confia nos dados recebidos a partir da rede. O firewall tem também que bloquear <span
              class="emphasis"><em>IP spoofing</em></span> para prevenir que uma máquina de fora atue como uma de dentro, e acesso às portas apropriadas tem que ser restrito às máquinas destinadas a acessar os compartilhamentos NFS.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DE VOLTA AO BÁSICO</em></span> RPC</strong></p></div></div></div><div
              class="para">
				RPC (<span
                class="emphasis"><em>Remote Procedure Call</em></span>) é um padrão Unix para serviços remotos. O NFS é um desses serviços.
			</div><a
              id="id-1.14.7.10.4.3"
              class="indexterm"></a><a
              id="id-1.14.7.10.4.4"
              class="indexterm"></a><div
              class="para">
				Os serviços RPC se registram em um diretório conhecido como <span
                class="emphasis"><em>portmapper</em></span>. Um cliente querendo realizar uma consulta NFS primeiro consulta o <span
                class="emphasis"><em>portmapper</em></span> (na porta 111, seja TCP ou UDP), e pergunta pelo servidor NFS; a resposta gralmente vem pela porta 2049 (a padrão para o NFS). Nem todos os serviços RPC necessariamente usam uma porta fixa.
			</div></div><div
            class="para">
				Versões mais antigas do protocolo necessitavam de outros serviços RPC que usavam portas dinamicamente atribuídas. Felizmente, com a versão 4 do NFS, apenas a porta 2049 (para NFS) e 111 (para o portmapper) são necessárias, e assim, fácil de configurar no firewall.
			</div><a
            id="id-1.14.7.10.6"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.11"></a>11.4.2. Servidor NFS</h3></div></div></div><div
            class="para">
				O servidor NFS é parte do núcleo Linux; nos núcleos fornecidos peloDebian ele é construído como um módulo do núcleo. Se o servidor NFS tem que ser rodado automaticamente na inicialização, o pacote <span
              class="pkg pkg">nfs-kernel-server</span> deve ser instalado; ele contém os scripts de inicialização relevantes.
			</div><div
            class="para">
				O arquivo de configuração do servidor NFS, <code
              class="filename">/etc/exports</code>, lista os diretórios que estão disponíveis através da rede (<span
              class="emphasis"><em>exported</em></span>). Para cada compartilhamento NFS, apenas uma determinada lista de máquinas tem acesso permitido. Um controle mais refinado de acesso pode ser obtido com algumas opções. A sintaxe para esse arquivo é bem simples:
			</div><a
            id="id-1.14.7.11.4"
            class="indexterm"></a><a
            id="id-1.14.7.11.5"
            class="indexterm"></a><pre
            class="programlisting">
/diretório/para/compartilhar máquina1(opção1,opção2,...) máquina2(...) ...</pre><div
            class="para">
				Note que com o NFSv4, todos os diretórios exportados tem que ser parte de uma única hierarquia e que o diretório raiz dessa hierarquia tem que ser exportado e identificado com a opção <code
              class="literal">fsid=0</code> ou <code
              class="literal">fsid=root</code>.
			</div><div
            class="para">
				Cada máquina pode ser identificada tanto pelo seu nome no DNS quanto seu endereço IP. Todo um conjunto de máquinas pode também ser especificado usando tanto uma sintaxe como <code
              class="literal">*.falcot.com</code> ou um intervalo de endereços IP como <code
              class="literal">192.168.0.0/255.255.255.0</code> ou <code
              class="literal">192.168.0.0/24</code>.
			</div><div
            class="para">
				Os diretórios ficam disponíveis apenas para leitura por padrão (ou com a opção <code
              class="literal">ro</code>). A opção <code
              class="literal">rw</code> permite o acesso a leitura-escrita. Os clientes NFS tipicamente fazem a conexão a partir de uma porta restrita ao root (em outras palavras, abaixo da 1024); essa restrição pode ser elevada pela opção <code
              class="literal">insecure</code> (a opção <code
              class="literal">secure</code> é implícita, mas pode ser explícita para mais clareza).
			</div><a
            id="id-1.14.7.11.10"
            class="indexterm"></a><div
            class="para">
				Por padrão, o servidor apenas responde a uma consulta NFS quando a operação de disco corrente é concluída (opção <code
              class="literal">sync</code>); isso pode ser desabilitado com a opção <code
              class="literal">async</code>. A escrita assíncrona aumenta um pouco a performance, mas ela diminui a confiança já que existe o risco de perda de dados no caso do servidor falhar entre comunicar a escrita e realmente escrever no disco. Como o valor padrão foi alterado recentemente (comparado ao valor histórico do NFS), uma configuração explícita é recomendada.
			</div><div
            class="para">
				Para que não seja dado acesso de root no sistema de arquivos a nenhum cliente NFS, todas as consultas que parecem vir do usuário root são consideradas pelo servidor como vindo do usuário <code
              class="literal">nobody</code>. Esse comportamento corresponde à opção <code
              class="literal">root_squash</code>, e é habilitado por padrão. A opção <code
              class="literal">no_root_squash</code>, que desabilita esse comportamento, é arriscada e só deveria ser usada em ambientes controlados. As opções <code
              class="literal">anonuid=<em
                class="replaceable">uid</em></code> e <code
              class="literal">anongid=<em
                class="replaceable">gid</em></code> permitem especificar outro usuário falso a ser usado ao invés de UID/GID 65534 (que corresponde ao usuário <code
              class="literal">nobody</code> e ao grupo <code
              class="literal">nogroup</code>).
			</div><div
            class="para">
				Com o NFSv4, você pode adicionar uma opção <code
              class="literal">sec</code> para indicar o nível de segurançaque você quer: <code
              class="literal">sec=sys</code> é o padrão, sem recursos especiais de segurança, <code
              class="literal">sec=krb5</code> habilita apenas a autenticação, <code
              class="literal">sec=krb5i</code> adiciona proteção de integridade, e <code
              class="literal">sec=krb5p</code> é o mais completo nível, que inclui proteção de privacidade (com criptografia de dados). Para isso funcionar você precisa do Kerberos configurado e funcionando (esse serviço não é coberto por esse livro).
			</div><div
            class="para">
				Outras opções estão disponíveis; elas estão documentadas na página de manual <span
              class="citerefentry"><span
                class="refentrytitle">exports</span>(5)</span>.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ATENÇÃO</em></span> Primeira instalação</strong></p></div></div></div><div
              class="para">
				O script de inicialização <code
                class="filename">/etc/init.d/nfs-kernel-server</code> apenas inicia o servidor se o <code
                class="filename">/etc/exports</code> lista um ou mais compartilhamentos NFS válidos. Na configuração inicial, uma vez que esse arquivo tenha sido editado para conter entradas válidas, o servidor NFS já pode ser iniciado com o seguinte comando:
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>service nfs-kernel-server start</code></strong></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.12"></a>11.4.3. Cliente NFS</h3></div></div></div><a
            id="id-1.14.7.12.2"
            class="indexterm"></a><a
            id="id-1.14.7.12.3"
            class="indexterm"></a><div
            class="para">
				Como acontece com outros sistemas de arquivos, a integração do compartilhamento NFS na hierarquia do sistema requer montagem. Já que esse sistema de arquivos tem suas peculiaridades, alguns ajustes foram necessários na sintaxe do comando <code
              class="command">mount</code> e do arquivo <code
              class="filename">/etc/fstab</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.5"></a><p
              class="title"><strong>Exemplo 11.22. Montando manualmente com o comando <code
                  class="command">mount</code></strong></p><div
              class="example-contents"><pre
                class="screen">
          <code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>mount -t nfs4 -o rw,nosuid arrakis.internal.falcot.com:/shared /srv/shared</code></strong></pre></div></div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.6"></a><p
              class="title"><strong>Exemplo 11.23. Entrada NFS no arquivo <code
                  class="filename">/etc/fstab</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">
arrakis.internal.falcot.com:/shared /srv/shared nfs4 rw,nosuid 0 0</pre></div></div><div
            class="para">
				A entrada descrita acima monta, ao levantar o sistema, o diretório NFS <code
              class="filename">/shared/</code> no servidor <code
              class="literal">arrakis</code> dentro do diretório local <code
              class="filename">/srv/shared/</code>. O acesso de leitura-escrita é requisitado (visto o parâmetro <code
              class="literal">rw</code>). A opção <code
              class="literal">nosuid</code> é uma medida de proteção que apaga qualquer bit <code
              class="literal">setuid</code> ou <code
              class="literal">setgid</code> de programas armazenados no compartilhamento. Se o compartilhamento NFS é apenas para armazenar documentos, outra opção recomendada é a <code
              class="literal">noexec</code>, a qual previne a execução de programas armazenados no compartilhamento. Note que no servidor, o diretório <code
              class="filename">shared</code> está abaixo da raiz NFSv4 exportada ( por exemplo, <code
              class="filename">/export/shared</code>), não é um diretório de nível mais alto.
			</div><div
            class="para">
				A página de manual <span
              class="citerefentry"><span
                class="refentrytitle">nfs</span>(5)</span> descreve todas as opções com alguns detalhes.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>Anterior</strong>11.3. Servidor de Arquivos FTP</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Acima</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Principal</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>Próxima</strong>11.5. Configurando um Compartilhamento Windows co...</a></li></ul></body></html>
