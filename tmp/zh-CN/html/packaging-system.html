<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">第 5 章 包管理系统：工具和基本原则</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-zh-CN-1.0-1" /><meta
        name="keywords"
        content="二进制包, 源码包, dpkg, 依赖, 冲突" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="prev"
        href="sect.after-first-boot.html"
        title="4.3. 在首次启动之后" /><link
        rel="next"
        href="sect.package-meta-information.html"
        title="5.2. 软件包元信息" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/zh-CN/stable/packaging-system.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.after-first-boot.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="sect.package-meta-information.html"><strong>下一页</strong></a></li></ul><div
        xml:lang="zh-CN"
        class="chapter"
        lang="zh-CN"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  xmlns=""
                  id="packaging-system"></a>第 5 章 包管理系统：工具和基本原则</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="packaging-system.html#sect.binary-package-structure">5.1. 二进制包的结构</a></span></dt><dt><span
                class="section"><a
                  href="sect.package-meta-information.html">5.2. 软件包元信息</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.package-meta-information.html#sect.control">5.2.1. 描述：<code
                        class="filename">control</code> 文件</a></span></dt><dt><span
                    class="section"><a
                      href="sect.package-meta-information.html#sect.configuration-scripts">5.2.2. 配置脚本</a></span></dt><dt><span
                    class="section"><a
                      href="sect.package-meta-information.html#sect.conffiles">5.2.3. 校验，配置文件列表</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.source-package-structure.html">5.3. 源软件包的结构</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.source-package-structure.html#id-1.8.7.4">5.3.1. 格式</a></span></dt><dt><span
                    class="section"><a
                      href="sect.source-package-structure.html#id-1.8.7.5">5.3.2. Debian 中的使用</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.manipulating-packages-with-dpkg.html">5.4. 通过<code
                    class="command">dpkg</code>来操作软件包</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.manipulating-packages-with-dpkg.html#id-1.8.8.5">5.4.1. 安装软件包</a></span></dt><dt><span
                    class="section"><a
                      href="sect.manipulating-packages-with-dpkg.html#id-1.8.8.6">5.4.2. 软件包移除</a></span></dt><dt><span
                    class="section"><a
                      href="sect.manipulating-packages-with-dpkg.html#id-1.8.8.7">5.4.3. 查询 <code
                        class="command">dpkg</code> 的数据库，并检查 <code
                        class="filename">.deb</code> 文件</a></span></dt><dt><span
                    class="section"><a
                      href="sect.manipulating-packages-with-dpkg.html#id-1.8.8.8">5.4.4. <code
                        class="command">dpkg</code>的日志文件</a></span></dt><dt><span
                    class="section"><a
                      href="sect.manipulating-packages-with-dpkg.html#sect.multi-arch">5.4.5. 多架构支持</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.coexistence-with-other-packaging-systems.html">5.5. 与其它软件包共存</a></span></dt></dl></div><div
          class="highlights"><div
            class="para">
		作为 Debian 系统管理员，你经常地要处理 <code
              class="filename">.deb</code> 包，因为它们包含一致的功能单元（应用程序、文档等），使得安装和维护更容易。所以了解它们是什么及如何使用它们是个好主意。
	</div></div><div
          class="para">
		本章介绍了“二进制”和“源码”包的结构和内容。前者是 <code
            class="filename">.deb</code> 文件，可以用 <code
            class="command">dpkg</code> 命令直接处理；而后者则包含程序的源代码，以及创建二进制包的说明。
	</div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    xmlns=""
                    id="sect.binary-package-structure"></a>5.1. 二进制包的结构</h2></div></div></div><a
            id="id-1.8.5.2"
            class="indexterm"></a><a
            id="id-1.8.5.3"
            class="indexterm"></a><div
            class="para">
			The Debian package format is designed so that its content may be extracted on any Unix system that has the classic commands <code
              class="command">ar</code>, <code
              class="command">tar</code>, and <code
              class="command">xz</code> (sometimes <code
              class="command">gzip</code> or <code
              class="command">bzip2</code>). This seemingly trivial property is important for portability and disaster recovery.
		</div><div
            class="para">
			Imagine, for example, that you mistakenly deleted the <code
              class="command">dpkg</code> program, and that you could thus no longer install Debian packages. <code
              class="command">dpkg</code> being a Debian package itself, it would seem your system would be done for... Fortunately, you know the format of a package and can therefore download the <code
              class="filename">.deb</code> file of the <span
              class="pkg pkg">dpkg</span> package and install it manually (see sidebar <a
              class="xref"
              href="packaging-system.html#sidebar.dpkg-apt-ar"><span
                class="emphasis"><em>工具</em></span> <code
                class="command">dpkg</code>、<code
                class="command">APT</code> 和 <code
                class="command">ar</code></a>). If by some misfortune one or more of the programs <code
              class="command">ar</code>, <code
              class="command">tar</code> or <code
              class="command">gzip</code>/<code
              class="command">xz</code>/<code
              class="command">bzip2</code> have disappeared, you will only need to copy the missing program from another system (since each of these operates in a completely autonomous manner, without dependencies, a simple copy will suffice). If your system suffered some even more outrageous fortune, and even these don't work (maybe the deepest system libraries are missing?), you should try the static version of <code
              class="command">busybox</code> (provided in the <span
              class="pkg pkg">busybox-static</span> package), which is even more self-contained, and provides subcommands such as <code
              class="command">busybox ar</code>, <code
              class="command">busybox tar</code> and <code
              class="command">busybox xz</code>.
		</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.dpkg-apt-ar"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>工具</em></span> <code
                        class="command">dpkg</code>、<code
                        class="command">APT</code> 和 <code
                        class="command">ar</code></strong></p></div></div></div><a
              id="id-1.8.5.6.2"
              class="indexterm"></a><a
              id="id-1.8.5.6.3"
              class="indexterm"></a><a
              id="id-1.8.5.6.4"
              class="indexterm"></a><div
              class="para">
			<code
                class="command">dpkg</code> 是处理 <code
                class="filename">.deb</code> 文件的命令，尤其是解压、分析和解包它们。
		</div><div
              class="para">
			<code
                class="command">APT</code> 是一组允许对系统进行高级的修改的程序：安装或者删除一个软件包（并且保持依赖关系满足），更新系统，列出可用的软件包等。
		</div><a
              id="id-1.8.5.6.7"
              class="indexterm"></a><div
              class="para">
			As for the <code
                class="command">ar</code> program, it allows handling files of the same name: <code
                class="command">ar t <em
                  class="replaceable">archive</em></code> displays the list of files contained in such an archive, <code
                class="command">ar x <em
                  class="replaceable">archive</em></code> extracts the files from the archive into the current working directory, <code
                class="command">ar d <em
                  class="replaceable">archive</em> <em
                  class="replaceable">file</em></code> deletes a file from the archive, etc. Its man page (<span
                class="citerefentry"><span
                  class="refentrytitle">ar</span>(1)</span>) documents all its other features. <code
                class="command">ar</code> is a very rudimentary tool that a Unix administrator would only use on rare occasions, but admins routinely use <code
                class="command">tar</code>, a more evolved archive and file management program. This is why it is easy to restore <code
                class="command">dpkg</code> in the event of an erroneous deletion. You would only have to download the Debian package and extract the content from the <code
                class="filename">data.tar.xz</code> archive in the system's root (<code
                class="filename">/</code>):
		</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>ar x dpkg_1.18.24_amd64.deb</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>tar -C / -p -xJf data.tar.xz</code></strong></pre></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>基础知识</em></span> Man 手册注记</strong></p></div></div></div><div
              class="para">
			初学者可能会在看到“<span
                class="citerefentry"><span
                  class="refentrytitle">ar</span>(1)</span>”这样的文字注记时感到疑惑。这通常是个简写，它表示指向 man 手册第一类中标题是 <code
                class="literal">ar</code> 的页面。
		</div><div
              class="para">
			有时这种注记也用来避免歧义，比如要区分清楚是 <code
                class="command">printf</code> 命令，可以用 <span
                class="citerefentry"><span
                  class="refentrytitle">printf</span>(1)</span> 来指明，如果是 C 语言里的 <code
                class="function">printf</code> 函数，就可以用 <span
                class="citerefentry"><span
                  class="refentrytitle">printf</span>(3)</span> 来引用。
		</div><div
              class="para">
			<a
                class="xref"
                href="solving-problems.html">第 7 章 <em>问题的解决与相关信息的检索</em></a> 更详细地讨论手册页 (参见 <a
                class="xref"
                href="solving-problems.html#sect.manual-pages">第 7.1.1 节 “手册页面”</a>)。
		</div></div><div
            class="para">
			来看看 <code
              class="filename">.deb</code> 文件的内容：
		</div><pre
            class="screen"><code
              class="computeroutput">$ </code><strong
              class="userinput"><code>ar t dpkg_1.18.24_amd64.deb</code></strong>
<code
              class="computeroutput">debian-binary
control.tar.gz
data.tar.xz
$ </code><strong
              class="userinput"><code>ar x dpkg_1.18.24_amd64.deb</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>ls</code></strong>
<code
              class="computeroutput">control.tar.gz  data.tar.xz  debian-binary  dpkg_1.18.24_amd64.deb
$ </code><strong
              class="userinput"><code>tar tJf data.tar.xz | head -n 15</code></strong>
<code
              class="computeroutput">./
./etc/
./etc/alternatives/
./etc/alternatives/README
./etc/cron.daily/
./etc/cron.daily/dpkg
./etc/dpkg/
./etc/dpkg/dpkg.cfg
./etc/dpkg/dpkg.cfg.d/
./etc/logrotate.d/
./etc/logrotate.d/dpkg
./sbin/
./sbin/start-stop-daemon
./usr/
./usr/bin/
$ </code><strong
              class="userinput"><code>tar tzf control.tar.gz</code></strong>
<code
              class="computeroutput">./
./conffiles
./postinst
./md5sums
./prerm
./control
./postrm
$ </code><strong
              class="userinput"><code>cat debian-binary</code></strong>
<code
              class="computeroutput">2.0</code></pre><div
            class="para">
			如你所见， Debian 包的 <code
              class="command">ar</code> 存档格式由三个文件组成：
		</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
					<code
                    class="filename">debian-binary</code>. This is a text file which simply indicates the version of the <code
                    class="filename">.deb</code> file used (in 2017: version 2.0).
				</div></li><li
                class="listitem"><div
                  class="para">
					<code
                    class="filename">control.tar.gz</code>。这个归档文件包含所有可用的元信息，如软件包的名称和版本。有些包的元信息允许软件包管理工具来决定能否安装或卸载它。例如，软件包管理工具会根据机器上已有的软件包列表和软件包元信息来进行相关安装或卸载的操作。
				</div></li><li
                class="listitem"><div
                  class="para">
					<code
                    class="filename">data.tar.xz</code>. This archive contains all of the files to be extracted from the package; this is where the executable files, documentation, etc., are all stored. Some packages may use other compression formats, in which case the file will be named differently (<code
                    class="filename">data.tar.bz2</code> for bzip2, <code
                    class="filename">data.tar.gz</code> for gzip).
				</div></li></ul></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.after-first-boot.html"><strong>上一页</strong>4.3. 在首次启动之后</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.package-meta-information.html"><strong>下一页</strong>5.2. 软件包元信息</a></li></ul></body></html>
