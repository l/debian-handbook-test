<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">8.4. 用户与群组数据库</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-zh-CN-1.0-1" /><meta
        name="keywords"
        content="配置, 本地化, 地区设置, 网络, 名称解析, 用户, 用户组, 账户, 命令行解释器, Shell, 打印, Bootloader, 内核编译" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="basic-configuration.html"
        title="第 8 章 基础配置：网络，账户，打印……" /><link
        rel="prev"
        href="sect.hostname-name-service.html"
        title="8.3. Setting the Hostname and Configuring the Name Service" /><link
        rel="next"
        href="sect.creating-accounts.html"
        title="8.5. 添加帐号" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/zh-CN/stable/sect.user-group-databases.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.hostname-name-service.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="sect.creating-accounts.html"><strong>下一页</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.user-group-databases"></a>8.4. 用户与群组数据库</h2></div></div></div><a
          id="id-1.11.8.2"
          class="indexterm"></a><a
          id="id-1.11.8.3"
          class="indexterm"></a><a
          id="id-1.11.8.4"
          class="indexterm"></a><a
          id="id-1.11.8.5"
          class="indexterm"></a><div
          class="para">
			用户清单通常保存在 <code
            class="filename">/etc/passwd</code> 文件内，把编码后的密码保存在 <code
            class="filename">/etc/shadow</code> 文件内。这两个文件都是纯文本档，以简单的格式保存，可以用文本编辑器读取与修改。每个用户占一列，其字段以冒号区隔 (“<code
            class="literal">:</code>”)。
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>说明</em></span> 编辑系统文件</strong></p></div></div></div><div
            class="para">
			本章讨论的系统文件都是纯文本档，可以用文本编辑器处理。这些文件对核心系统的运作极为重要，编辑该等文件时多加慎重不会错的。首先，先复制或备份原文件。第二，在服务器或多人可同时近用该等文件的机器上，多费心以防止文件损坏。
		</div><div
            class="para">
			为了达成此目标，最好使用 <code
              class="command">vipw</code> 命令编辑 <code
              class="filename">/etc/passwd</code> 文件，或使用 <code
              class="command">vigr</code> 命令编辑 <code
              class="filename">/etc/group</code> 文件。这些命令会先锁住该等文件再运行文本编辑器， (缺省使用 <code
              class="command">vi</code> 命令，除非 <code
              class="varname">EDITOR</code> 环境变量有其他的设置)。加上 <code
              class="literal">-s</code> 选项可同时编辑对应的 <span
              class="foreignphrase"><em
                class="foreignphrase">shadow</em></span> 文件。
		</div></div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>基本</em></span> Crypt，单向的函数</strong></p></div></div></div><a
            id="id-1.11.8.8.2"
            class="indexterm"></a><div
            class="para">
			<code
              class="command">crypt</code> 是单向函数以特别的方法把字符串 (<code
              class="varname">A</code>) 转换成另个字符串 (<code
              class="varname">B</code>)，转换后无法回复成 <code
              class="varname">A</code> 经由 <code
              class="varname">B</code>。辨识 <code
              class="varname">A</code> 的唯一方法是逐一测试所有可能的值，查验等同于 <code
              class="varname">B</code> 的结果。最多可输入 8 个字符 (字符串 <code
              class="varname">A</code>) 然后产生 13 个字符的可打印 ASCII 字符 (字符串 <code
              class="varname">B</code>)。
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.etc-passwd"></a>8.4.1. 用户清单：<code
                    class="filename">/etc/passwd</code></h3></div></div></div><div
            class="para">
				在 <code
              class="filename">/etc/passwd</code> 文件内的字段清单：
			</div><a
            id="id-1.11.8.9.3"
            class="indexterm"></a><a
            id="id-1.11.8.9.4"
            class="indexterm"></a><a
            id="id-1.11.8.9.5"
            class="indexterm"></a><a
            id="id-1.11.8.9.6"
            class="indexterm"></a><a
            id="id-1.11.8.9.7"
            class="indexterm"></a><a
            id="id-1.11.8.9.8"
            class="indexterm"></a><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						登录，例如 <code
                    class="literal">rhertzog</code>；
					</div></li><li
                class="listitem"><div
                  class="para">
						password：就是密码加密的单向函数 (<code
                    class="command">crypt</code>)，使用 <code
                    class="literal">DES</code>、<code
                    class="literal">MD5</code>、<code
                    class="literal">SHA-256</code> 或 <code
                    class="literal">SHA-512</code>。以特别符号 “<code
                    class="literal">x</code>” 表示加密后的密码保存在<code
                    class="filename">/etc/shadow</code>；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">uid</code>：用于辨识个别用户的不重复数字；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">gid</code>：用户主要群组 (Debian 的默认值系为每个用户创建一个群组) 的不重复号码；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">GECOS</code>：通常保存用户全名的数据栏；
					</div></li><li
                class="listitem"><div
                  class="para">
						登录文件夹，用于保存用户的个人文件 (环境变量 <code
                    class="varname">$HOME</code> 通常指向此处)；
					</div></li><li
                class="listitem"><div
                  class="para">
						登录时运行的程序。通常是命令解译器 (shell)，若指定为 <code
                    class="command">/bin/false</code> (不做任何事并立即回到控制)，则用户无法登录。
					</div></li></ul></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>基本</em></span> Unix 群组</strong></p></div></div></div><a
              id="id-1.11.8.9.10.2"
              class="indexterm"></a><div
              class="para">
				Unix 群组是包括多个用户的实体，以集成授权系统可以共享文件 (具有同样的权限)。可以限定程序供指定的群组使用。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.etc-shadow"></a>8.4.2. 隐藏与加密的密码档：<code
                    class="filename">/etc/shadow</code></h3></div></div></div><a
            id="id-1.11.8.10.2"
            class="indexterm"></a><a
            id="id-1.11.8.10.3"
            class="indexterm"></a><div
            class="para">
				The <code
              class="filename">/etc/shadow</code> 文件含以下的字段：
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						登录；
					</div></li><li
                class="listitem"><div
                  class="para">
						加密的密码；
					</div></li><li
                class="listitem"><div
                  class="para">
						管理密码期限的字段。
					</div></li></ul></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>文档</em></span> <code
                        class="filename">/etc/passwd</code>、<code
                        class="filename">/etc/shadow</code> 与 <code
                        class="filename">/etc/group</code> 文件格式</strong></p></div></div></div><div
              class="para">
				这些格式记录在下列的手册页面：<span
                class="citerefentry"><span
                  class="refentrytitle">passwd</span>(5)</span>、<span
                class="citerefentry"><span
                  class="refentrytitle">shadow</span>(5)</span>、与 <span
                class="citerefentry"><span
                  class="refentrytitle">group</span>(5)</span>。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>安全</em></span> <code
                        class="filename">/etc/shadow</code> 文件安全</strong></p></div></div></div><div
              class="para">
				<code
                class="filename">/etc/shadow</code>，不同于它的分身，<code
                class="filename">/etc/passwd</code>，不能被一般用户读取。保存在 <code
                class="filename">/etc/passwd</code> 内的加密后密码可被任何人读取；破坏者可以用 “暴力” 法破坏它们，以常见的编码字符破解。这种攻击方式 — 称为 "字典攻击" — 对于使用 <code
                class="filename">/etc/shadow</code> 的系统是无效的。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.account-modification"></a>8.4.3. 修改既有的帐号或密码</h3></div></div></div><a
            id="id-1.11.8.11.2"
            class="indexterm"></a><a
            id="id-1.11.8.11.3"
            class="indexterm"></a><a
            id="id-1.11.8.11.4"
            class="indexterm"></a><a
            id="id-1.11.8.11.5"
            class="indexterm"></a><a
            id="id-1.11.8.11.6"
            class="indexterm"></a><div
            class="para">
				以下的命令允许修改用户数据库内的特定字段数据：<code
              class="command">passwd</code> 允许用户更改自己的密码，并更新 <code
              class="filename">/etc/shadow</code> 文件；<code
              class="command">chfn</code> (CHange Full Name)，保留给超级用户 (root) 专用，修改 <code
              class="literal">GECOS</code> 字段。<code
              class="command">chsh</code> (CHange SHell) 允许用户变更自己的登录 shell，但祗限列名在 <code
              class="filename">/etc/shells</code> 之内；另一方面，管理者不受此限，且可设置任何 shell。
			</div><div
            class="para">
				最后，<code
              class="command">chage</code> (CHange AGE) 命令允许管理者变更密码的有效期 (<code
              class="literal">-l <em
                class="replaceable">用户</em></code> 选项列出现在的设置)。以 <code
              class="command">passwd -e <em
                class="replaceable">用户</em></code> 命令强迫密码失效，要求用户登录时变更密码才能继续使用。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.disabling-account"></a>8.4.4. 帐号禁用</h3></div></div></div><a
            id="id-1.11.8.12.2"
            class="indexterm"></a><a
            id="id-1.11.8.12.3"
            class="indexterm"></a><div
            class="para">
				有时需要 “禁用一个帐号” (关闭某用户)，基于纪律考量、调查、或用户太久未登录。被禁用的帐号表示该用户不能登录或近用该机器。帐号还在机器内且文件与数据都未被删除木；祗是不能使用。以 <code
              class="command">passwd -l <em
                class="replaceable">用户</em></code> (锁定) 命令就能够达成。以同样的方式另个选项 <code
              class="literal">-u</code> (解锁) 就可恢复该帐号。
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.intro-nss"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>下一步</em></span> NSS 与系统数据库</strong></p></div></div></div><a
              id="id-1.11.8.12.5.2"
              class="indexterm"></a><a
              id="id-1.11.8.12.5.3"
              class="indexterm"></a><div
              class="para">
				与其使用文件管理用户与群组清单，还可使用其他数据库类型，诸如 LDAP 或 <code
                class="command">db</code>，借由适当的 NSS (Name Service Switch 姓名服务切换) 模块。可用的模块列在 <code
                class="filename">/etc/nsswitch.conf</code> 文件内，在 <code
                class="literal">passwd</code>、<code
                class="literal">shadow</code> 与 <code
                class="literal">group</code> 款目下。LDAP 下的 NSS 模块使用法，见 <a
                class="xref"
                href="sect.ldap-directory.html#sect.config-nss">第 11.7.3.1 节 “Configuring NSS”</a>。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.etc-group"></a>8.4.5. 群组清单：<code
                    class="filename">/etc/group</code></h3></div></div></div><div
            class="para">
				群组列在 <code
              class="filename">/etc/group</code> 文件内，单纯的文本数据库类似 <code
              class="filename">/etc/passwd</code> 文件，包括以下的字段：
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						群组名称；
					</div></li><li
                class="listitem"><div
                  class="para">
						密码 (选项)：加入群组会用到 (以 <code
                    class="command">newgrp</code> 或 <code
                    class="command">sg</code> 命令，见专栏 <a
                    class="xref"
                    href="sect.user-group-databases.html#sidebar.working-with-several-groups"><span
                      class="emphasis"><em>基本</em></span> 在多个群组工作</a>)；
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">gid</code>：不重复的群组辨识码；
					</div></li><li
                class="listitem"><div
                  class="para">
						成员清单：属于此群组的用户名清单，以逗点区隔。
					</div></li></ul></div><div
            class="para">
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.working-with-several-groups"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>基本</em></span> 在多个群组工作</strong></p></div></div></div><a
              id="id-1.11.8.13.5.2"
              class="indexterm"></a><a
              id="id-1.11.8.13.5.3"
              class="indexterm"></a><a
              id="id-1.11.8.13.5.4"
              class="indexterm"></a><a
              id="id-1.11.8.13.5.5"
              class="indexterm"></a><div
              class="para">
				最终用户可能参加多个群组；其中一个是自己的 “主要群组”。用户自己的主要群组，用户初始配置时自动产生的默认值。用户添加的文件自动属于该读者，以及其主要群组。这种方式并不完全合意；例如，用户需要在自己主要群组之外的文件夹工作，与其他群组共享其文件。在这种情况下，用户需以命令：<code
                class="command">newgrp</code> 变更其主要群组，产生新的 shell，或以 <code
                class="command">sg</code> 命令，使用其他群组。这些命令也允许用户加入其他群组。若该等群组受密码保护，则需先取得密码才能运行该等命令。
			</div><div
              class="para">
				用户还可以设置文件夹的 <code
                class="literal">setgid</code> 位，让该文件夹内的文件自动属于特定群组。详情见专栏 <a
                class="xref"
                href="sect.rights-management.html#sidebar.setgid-dir"><span
                  class="emphasis"><em>安全</em></span> <code
                  class="literal">setgid</code> 目录和 <span
                  class="emphasis"><em>粘着位</em></span></a>。
			</div><div
              class="para">
				<code
                class="command">id</code> 命令显示用户现在的状态，包括个人辨识码 (<code
                class="varname">uid</code> 变量)、现在的主要群组 (<code
                class="varname">gid</code> variable)、以及其所属群组的清单 (<code
                class="varname">groups</code> 变量)。
			</div></div><a
            id="id-1.11.8.13.6"
            class="indexterm"></a><a
            id="id-1.11.8.13.7"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">addgroup</code> 与 <code
              class="command">delgroup</code> 命令可以添加或删除群组。<code
              class="command">groupmod</code> 命令修改群组的信息 (其 <code
              class="literal">gid</code> 或辨识码)。命令 <code
              class="command">passwd -g <em
                class="replaceable">group</em></code> 可变更群组的密码，<code
              class="command">passwd -r -g <em
                class="replaceable">group</em></code> 命令可删除群组的密码。
			</div><a
            id="id-1.11.8.13.9"
            class="indexterm"></a><a
            id="id-1.11.8.13.10"
            class="indexterm"></a><a
            id="id-1.11.8.13.11"
            class="indexterm"></a><a
            id="id-1.11.8.13.12"
            class="indexterm"></a><a
            id="id-1.11.8.13.13"
            class="indexterm"></a><a
            id="id-1.11.8.13.14"
            class="indexterm"></a><a
            id="id-1.11.8.13.15"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>秘诀</em></span> <code
                        class="command">getent</code></strong></p></div></div></div><a
              id="id-1.11.8.13.16.2"
              class="indexterm"></a><div
              class="para">
				<code
                class="command">getent</code> (取得款目的意思 get entries) 命令使用适当的程序库函数，调用配置于 <code
                class="filename">/etc/nsswitch.conf</code> 文件的 NSS 模块，以标准方式检查系统数据库。此命令需要一个或两个参数：被检查的数据库名称、以及可能的搜索键词。因此，<code
                class="command">getent passwd rhertzog</code> 命令将从用户 <code
                class="literal">rhertzog</code> 中给予用户数据库。
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.hostname-name-service.html"><strong>上一页</strong>8.3. Setting the Hostname and Configuring the Nam...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.creating-accounts.html"><strong>下一页</strong>8.5. 添加帐号</a></li></ul></body></html>
