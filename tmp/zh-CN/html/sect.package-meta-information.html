<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">5.2. 软件包元信息</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-zh-CN-1.0-1" /><meta
        name="keywords"
        content="二进制包, 源码包, dpkg, 依赖, 冲突" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="packaging-system.html"
        title="第 5 章 包管理系统：工具和基本原则" /><link
        rel="prev"
        href="packaging-system.html"
        title="第 5 章 包管理系统：工具和基本原则" /><link
        rel="next"
        href="sect.source-package-structure.html"
        title="5.3. 源软件包的结构" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/zh-CN/stable/sect.package-meta-information.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="packaging-system.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="sect.source-package-structure.html"><strong>下一页</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.package-meta-information"></a>5.2. 软件包元信息</h2></div></div></div><a
          id="id-1.8.6.2"
          class="indexterm"></a><a
          id="id-1.8.6.3"
          class="indexterm"></a><div
          class="para">
			Debian 软件包不仅是一个待安装文件的归档。它是一个更大结构的一部分，它描述与其它 Debian 软件包的关系（依赖、冲突、建议）。在软件包生命周期的不同阶段（安装、删除、升级），它还提供执行命令的脚本。软件包中的这些数据供包管理工具使用，但不是打包软件的一部分，称为“元信息”（关于其它信息的信息）。
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.control"></a>5.2.1. 描述：<code
                    class="filename">control</code> 文件</h3></div></div></div><a
            id="id-1.8.6.5.2"
            class="indexterm"></a><a
            id="id-1.8.6.5.3"
            class="indexterm"></a><a
            id="id-1.8.6.5.4"
            class="indexterm"></a><div
            class="para">
				该文件使用一个类似电子邮件头（由 RFC_2822 定义）的结构。例如，<span
              class="pkg pkg">apt</span> 包的 <code
              class="filename">control</code> 文件看起来是这样的：
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>apt-cache show apt</code></strong>
<code
              class="computeroutput">Package: apt
Version: 1.0.9.6
Installed-Size: 3788
Maintainer: APT Development Team &lt;deity@lists.debian.org&gt;
Architecture: amd64
Replaces: manpages-it (&lt;&lt; 2.80-4~), manpages-pl (&lt;&lt; 20060617-3~), openjdk-6-jdk (&lt;&lt; 6b24-1.11-0ubuntu1~), sun-java5-jdk (&gt;&gt; 0), sun-java6-jdk (&gt;&gt; 0)
Depends: libapt-pkg4.12 (&gt;= 1.0.9.6), libc6 (&gt;= 2.15), libgcc1 (&gt;= 1:4.1.1), libstdc++6 (&gt;= 4.9), debian-archive-keyring, gnupg
Suggests: aptitude | synaptic | wajig, dpkg-dev (&gt;= 1.17.2), apt-doc, python-apt
Conflicts: python-apt (&lt;&lt; 0.7.93.2~)
Breaks: manpages-it (&lt;&lt; 2.80-4~), manpages-pl (&lt;&lt; 20060617-3~), openjdk-6-jdk (&lt;&lt; 6b24-1.11-0ubuntu1~), sun-java5-jdk (&gt;&gt; 0), sun-java6-jdk (&gt;&gt; 0)
Description-en: commandline package manager
 该软件包提供了用于
 搜索、管理以及以低层次访问
 libapt-pkg 库的全部功能来查询
 软件包信息的命令行工具。
 .
 它包括：
  * apt-get，用于从已验证的源获取软件包
 和相关信息并对软件包及其依赖进行安
 装、升级和删除
  * apt-cache，用于查询已安装和可安
 装软件包的可用信息
  * apt-cdrom，用于将可移除式介质作为软件包的源
  * apt-config，作为设置配置的一个界面
  * apt-key，作为管理验证密钥的一个界面
Description-md5: 9fb97a88cb7383934ef963352b53b4a7
Tag: admin::package-management, devel::lang:ruby, hardware::storage,
 hardware::storage:cd, implemented-in::c++, implemented-in::perl,
 implemented-in::ruby, interface::commandline, network::client,
 protocol::ftp, protocol::http, protocol::ipv6, role::program,
 role::shared-lib, scope::application, scope::utility, sound::player,
 suite::debian, use::downloading, use::organizing, use::searching,
 works-with::audio, works-with::software:package, works-with::text
Section: admin
Priority: important
Filename: pool/main/a/apt/apt_1.0.9.6_amd64.deb
Size: 1107560
MD5sum: a325ccb14e69fef2c50da54e035a4df4
SHA1: 635d09fcb600ec12810e3136d51e696bcfa636a6
SHA256: 371a559ce741394b59dbc6460470a9399be5245356a9183bbeea0f89ecaabb03</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>基础知识</em></span> RFC －－ 互联网标准</strong></p></div></div></div><a
              id="id-1.8.6.5.7.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.7.3"
              class="indexterm"></a><div
              class="para">
				RFC 是 “征求建议”的缩写。RFC通常是一份描述将要成为互联网的标准的技术文档。在成为标准并被冻结之前，这些标准被提交给大众评估（这就是名字的由来）。 IETF（互联网工程专家组）决定这些文档的演进更新（建议标准、草案或标准）。
			</div><div
              class="para">
				RFC 2026 定义了互联网协议标准化的程序。<div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc2026.html">http://www.faqs.org/rfcs/rfc2026.html</a></div>
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.5.8"></a>5.2.1.1. 依赖：<code
                      class="literal">Depends</code> 域</h4></div></div></div><a
              id="id-1.8.6.5.8.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.8.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.8.4"
              class="indexterm"></a><div
              class="para">
					The dependencies are defined in the <code
                class="literal">Depends</code> field in the package header. This is a list of conditions to be met for the package to work correctly — this information is used by tools such as <code
                class="command">apt</code> in order to install the required libraries, in appropriate versions fulfilling the dependencies of the package to be installed. For each dependency, it is possible to restrict the range of versions that meet that condition. In other words, it is possible to express the fact that we need the package <span
                class="pkg pkg">libc6</span> in a version equal to or greater than “2.15” (written “<code
                class="command">libc6 (&gt;= 2.15)</code>”). Version comparison operators are as follows:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&lt;&lt;</code>：小于；
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&lt;=</code>：小于或等于；
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">=</code>: equal to (note that “<code
                      class="literal">2.6.1</code>” is not equal to “<code
                      class="literal">2.6.1-1</code>”);
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&gt;=</code>：大于或等于；
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&gt;&gt;</code>：大于。
						</div></li></ul></div><div
              class="para">
					In a list of conditions to be met, the comma serves as a separator. It must be interpreted as a logical “and”. In conditions, the vertical bar (“|”) expresses a logical “or” (it is an inclusive “or”, not an exclusive “either/or”). Carrying greater priority than “and”, it can be used as many times as necessary. Thus, the dependency “(A or B) and C” is written <code
                class="command">A | B, C</code>. In contrast, the expression “A or (B and C)” should be written as “(A or B) and (A or C)”, since the <code
                class="literal">Depends</code> field does not tolerate parentheses that change the order of priorities between the logical operators “or” and “and”. It would thus be written <code
                class="command">A | B, A | C</code>. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.debian.org/doc/debian-policy/ch-relationships.html">http://www.debian.org/doc/debian-policy/ch-relationships.html</a></div>
				</div><a
              id="id-1.8.6.5.8.8"
              class="indexterm"></a><div
              class="para">
					The dependencies system is a good mechanism for guaranteeing the operation of a program, but it has another use with “meta-packages”. These are empty packages that only describe dependencies. They facilitate the installation of a consistent group of programs preselected by the meta-package maintainer; as such, <code
                class="command">apt install <em
                  class="replaceable">meta-package</em></code> will automatically install all of these programs using the meta-package's dependencies. The <span
                class="pkg pkg">gnome</span>, <span
                class="pkg pkg">kde-full</span> and <span
                class="pkg pkg">linux-image-amd64</span> packages are examples of meta-packages.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>DEBIAN 政策</em></span> <code
                          class="literal">预依赖</code>, 一个更苛刻的 <code
                          class="literal">取决于</code></strong></p></div></div></div><a
                id="id-1.8.6.5.8.10.2"
                class="indexterm"></a><a
                id="id-1.8.6.5.8.10.3"
                class="indexterm"></a><div
                class="para">
					“Pre-dependencies”, which are listed in the “<code
                  class="literal">Pre-Depends</code>” field in the package headers, complete the normal dependencies; their syntax is identical. A normal dependency indicates that the package in question must be unpacked and configured before configuration of the package declaring the dependency. A pre-dependency stipulates that the package in question must be unpacked and configured before execution of the pre-installation script of the package declaring the pre-dependency, that is before its installation.
				</div><div
                class="para">
					<code
                  class="command">apt</code>对预依赖的要求非常严格，因为它在安装软件包的时候增加了严格约束。因此，预依赖关系的安装软件的时候不鼓励,除非绝对需要。它甚至建议在加入预依赖前直接咨询开发人员<code
                  class="email"><a
                    class="email"
                    href="mailto:debian-devel@lists.dibian.org">debian-devel@lists.dibian.org</a></code>。这也是一个通用的解决办法。
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>DEBIAN 政策</em></span> <code
                          class="literal">推荐</code>，<code
                          class="literal">建议</code>，<code
                          class="literal">提高</code>水平</strong></p></div></div></div><a
                id="id-1.8.6.5.8.11.2"
                class="indexterm"></a><a
                id="id-1.8.6.5.8.11.3"
                class="indexterm"></a><div
                class="para">
					<code
                  class="literal">推荐</code>和<code
                  class="literal">建议</code>字段描述的依赖关系不是强制性的。“推荐”的依赖,是最重要的，能显著改善由软件包提供的功能，但这并非是必不可少的操作。“建议”的依赖，是次要的，表明某些软件包可以补充或者增加其各自的效果，有充分的理由去单独安装它而不是其它的软件包。
				</div><div
                class="para">
					你应该总是安装“推荐”的软件包，除非你知道究竟为什么你不需要它们。相反，“建议”的软件包是不必要安装的，除非你知道为什么你需要它们。
				</div><a
                id="id-1.8.6.5.8.11.6"
                class="indexterm"></a><div
                class="para">
					The <code
                  class="literal">Enhances</code> field also describes a suggestion, but in a different context. It is indeed located in the suggested package, and not in the package that benefits from the suggestion. Its interest lies in that it is possible to add a suggestion without having to modify the package that is concerned. Thus, all add-ons, plug-ins, and other extensions of a program can then appear in the list of suggestions related to the software. Although it has existed for several years, this last field is still largely ignored by programs such as <code
                  class="command">apt</code> or <code
                  class="command">synaptic</code>. Its purpose is for a suggestion made by the <code
                  class="literal">Enhances</code> field to appear to the user in addition to the traditional suggestions — found in the <code
                  class="literal">Suggests</code> field.
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.5.9"></a>5.2.1.2. 冲突：<code
                      class="literal">冲突</code>字段</h4></div></div></div><a
              id="id-1.8.6.5.9.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.9.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.9.4"
              class="indexterm"></a><div
              class="para">
					The <code
                class="literal">Conflicts</code> field indicates when a package cannot be installed simultaneously with another. The most common reasons for this are that both packages include a file of the same name, or provide the same service on the same TCP port, or would hinder each other's operation.
				</div><div
              class="para">
					<code
                class="command">dpkg</code> will refuse to install a package if it triggers a conflict with an already installed package, except if the new package specifies that it will “replace” the installed package, in which case <code
                class="command">dpkg</code> will choose to replace the old package with the new one. <code
                class="command">apt</code> always follows your instructions: if you choose to install a new package, it will automatically offer to uninstall the package that poses a problem.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.5.10"></a>5.2.1.3. 不相容性:<code
                      class="literal">中断</code>字段</h4></div></div></div><a
              id="id-1.8.6.5.10.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.10.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.10.4"
              class="indexterm"></a><div
              class="para">
					<code
                class="literal">中断</code>字段有一个影响和<code
                class="literal">冲突</code>字段类似，但它具有特殊的意义。它标志着一个包的安装会将另外一个包（或者是特定版本）中断掉。通常而言，两个包之间的不兼容是短暂的，<code
                class="literal">中断</code>关系会特别指出那些不兼容的版本。
				</div><div
              class="para">
					<code
                class="command">dpkg</code> will refuse to install a package that breaks an already installed package, and <code
                class="command">apt</code> will try to resolve the problem by updating the package that would be broken to a newer version (which is assumed to be fixed and, thus, compatible again).
				</div><div
              class="para">
					不向后兼容的更新可能会发生这种情况：如果新版本与旧版本的功能不在另一个程序中做特别规定，这将导致故障。<code
                class="literal">中断</code>字段会防止用户继续运行从而遇到这些问题。
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.5.11"></a>5.2.1.4. 预备好的条目：<code
                      class="literal">预备</code>字段</h4></div></div></div><a
              id="id-1.8.6.5.11.2"
              class="indexterm"></a><div
              class="para">
					这个字段引入了一个很有意思的“虚拟包”的概念。它有很多的角色，但有两个特别重要。第一个是由使用虚拟包关联到的一个通用的服务（包“预备”了这些服务）。第二个表示一个包完全取代了另外一个，所以它也能满足依赖性要求。因此，可以创建一个替换而不必使用相同的包名称的包。
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>VOCABULARY</em></span>元软件包和虚拟包</strong></p></div></div></div><a
                id="id-1.8.6.5.11.4.2"
                class="indexterm"></a><a
                id="id-1.8.6.5.11.4.3"
                class="indexterm"></a><a
                id="id-1.8.6.5.11.4.4"
                class="indexterm"></a><div
                class="para">
					这里必须明确的从虚拟软件包里面区分出元软件包。元软件包是真实的元件包（包含真实的<code
                  class="filename">.deb</code>文件），其唯一目的是用来表示依赖性关系。
				</div><div
                class="para">
					Virtual packages, however, do not exist physically; they are only a means of identifying real packages based on common, logical criteria (service provided, compatibility with a standard program or a pre-existing package, etc.).
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.8.6.5.11.5"></a>5.2.1.4.1. 提供一个“服务”</h5></div></div></div><div
                class="para">
						Let us discuss the first case in greater detail with an example: all mail servers, such as <span
                  class="pkg pkg">postfix</span> or <span
                  class="pkg pkg">sendmail</span> are said to “provide” the <span
                  class="pkg pkg">mail-transport-agent</span> virtual package. Thus, any package that needs this service to be functional (e.g. a mailing list manager, such as <span
                  class="pkg pkg">smartlist</span> or <span
                  class="pkg pkg">sympa</span>) simply states in its dependencies that it requires a <span
                  class="pkg pkg">mail-transport-agent</span> instead of specifying a large yet incomplete list of possible solutions (e.g. <code
                  class="command">postfix | sendmail | exim4 | …</code>). Furthermore, it is useless to install two mail servers on the same machine, which is why each of these packages declares a conflict with the <span
                  class="pkg pkg">mail-transport-agent</span> virtual package. A conflict between a package and itself is ignored by the system, but this technique will prohibit the installation of two mail servers side by side.
					</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>DEBIAN 政策</em></span> 虚拟软件包列表</strong></p></div></div></div><a
                  id="id-1.8.6.5.11.5.3.2"
                  class="indexterm"></a><div
                  class="para">
						For virtual packages to be useful, everyone must agree on their name. This is why they are standardized in the Debian Policy. The list includes among others <span
                    class="pkg pkg">mail-transport-agent</span> for mail servers, <span
                    class="pkg pkg">c-compiler</span> for C programming language compilers, <span
                    class="pkg pkg">www-browser</span> for web browsers, <span
                    class="pkg pkg">httpd</span> for web servers, <span
                    class="pkg pkg">ftp-server</span> for FTP servers, <span
                    class="pkg pkg">x-terminal-emulator</span> for terminal emulators in graphical mode (<code
                    class="command">xterm</code>), and <span
                    class="pkg pkg">x-window-manager</span> for window managers.
					</div><div
                  class="para">
						The full list can be found on the Web. <div
                    xmlns=""
                    class="url">→ <a
                      xmlns="http://www.w3.org/1999/xhtml"
                      href="http://www.debian.org/doc/packaging-manuals/virtual-package-names-list.txt">http://www.debian.org/doc/packaging-manuals/virtual-package-names-list.txt</a></div>
					</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.8.6.5.11.6"></a>5.2.1.4.2. 和另一个软件包的可交互性</h5></div></div></div><div
                class="para">
						The <code
                  class="literal">Provides</code> field is also interesting when the content of a package is included in a larger package. For example, the <span
                  class="pkg pkg">libdigest-md5-perl</span> Perl module was an optional module in Perl 5.6, and has been integrated as standard in Perl 5.8 (and later versions, such as 5.20 present in <span
                  class="distribution distribution">Jessie</span>). As such, the package <span
                  class="pkg pkg">perl</span> has since version 5.8 declared <code
                  class="literal">Provides: libdigest-md5-perl</code> so that the dependencies on this package are met if the user has Perl 5.8 (or newer). The <span
                  class="pkg pkg">libdigest-md5-perl</span> package itself has eventually been deleted, since it no longer had any purpose when old Perl versions were removed.
					</div><div
                class="figure"><a
                  xmlns=""
                  id="id-1.8.6.5.11.6.3"></a><div
                  class="figure-contents"><div
                    class="mediaobject"><img
                      src="images/virtual-package.png"
                      alt="使用了预备字段来避免中断依赖性关系" /></div></div><p
                  class="title"><strong>图 5.1. 使用了<code
                      class="literal">预备</code>字段来避免中断依赖性关系</strong></p></div><div
                class="para">
						这个功能非常有用，因为它是永远不可能预料到变化莫测的发展，它不能够调整重命名，或者其他自动替换过的软件，所以它是必要的。
					</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>回到基本</em></span>Perl，一种编程语言</strong></p></div></div></div><a
                  id="id-1.8.6.5.11.6.5.2"
                  class="indexterm"></a><a
                  id="id-1.8.6.5.11.6.5.3"
                  class="indexterm"></a><div
                  class="para">
						Perl（实用报表提取语言）是非常受欢迎的编程语言。它有许多现成的模块，涵盖了广阔的应用，这些都是由CPAN（Perl综合架构网络）提供服务的，cpan是一个详尽的网络Perl软件包。<div
                    xmlns=""
                    class="url">→ <a
                      xmlns="http://www.w3.org/1999/xhtml"
                      href="http://www.perl.org/">http://www.perl.org/</a></div> <div
                    xmlns=""
                    class="url">→ <a
                      xmlns="http://www.w3.org/1999/xhtml"
                      href="http://www.cpan.org/">http://www.cpan.org/</a></div>
					</div><div
                  class="para">
						由于它是一种解释型语言，Perl 语言编写的程序并不需要在执行之前进行编译。这就是大家称其为“Perl 脚本”的原因。
					</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.8.6.5.11.7"></a>5.2.1.4.3. Past Limitations</h5></div></div></div><div
                class="para">
						Virtual packages used to suffer from some limitations, the most significant of which was the absence of a version number. To return to the previous example, a dependency such as <code
                  class="literal">Depends: libdigest-md5-perl (&gt;= 1.6)</code>, despite the presence of Perl 5.10, would never be considered as satisfied by the packaging system — while in fact it most likely is satisfied. Unaware of this, the package system chose the least risky option, assuming that the versions do not match.
					</div><div
                class="para">
						该限制已经在 <span
                  class="pkg pkg">dpkg</span> 1.17.11 中解除，在 Jessie 中不再相关。软件包可以给提供依赖的虚拟包指定一个版本，如 <code
                  class="literal">Provides: libdigest-md5-perl (= 1.8)</code>。
					</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.5.12"></a>5.2.1.5. 替换文件：<code
                      class="literal">替换</code>字段</h4></div></div></div><a
              id="id-1.8.6.5.12.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.12.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.12.4"
              class="indexterm"></a><div
              class="para">
					The <code
                class="literal">Replaces</code> field indicates that the package contains files that are also present in another package, but that the package is legitimately entitled to replace them. Without this specification, <code
                class="command">dpkg</code> fails, stating that it can not overwrite the files of another package (technically, it is possible to force it to do so with the <code
                class="literal">--force-overwrite</code> option, but that is not considered standard operation). This allows identification of potential problems and requires the maintainer to study the matter prior to choosing whether to add such a field.
				</div><div
              class="para">
					当软件包名称变更时，或者当一个软件包包含在另外一个的时候，此字段的使用是合理的。这也发生在维护者决定从来自相同的源码包的大量二进制包里分发出文件：一个替换的文件不再属于旧的软件包，只有新的才属于。
				</div><div
              class="para">
					如果已安装软件包的所有文件都被替换了，那么该软件包将认为将被删除掉。最后，这个字段会鼓励<code
                class="command">dpkg</code>命令去删除替换掉有冲突的包。
				</div><div
              class="sidebar"><a
                xmlns=""
                id="sidebar.debtags"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>更进一步</em></span><code
                          class="literal">标签</code>字段</strong></p></div></div></div><div
                class="para">
					In the <span
                  class="pkg pkg">apt</span> example above, we can see the presence of a field that we have not yet described, the <code
                  class="literal">Tag</code> field. This field does not describe a relationship between packages, but is simply a way of categorizing a package in a thematic taxonomy. This classification of packages according to several criteria (type of interface, programming language, domain of application, etc.) has been available for a long time. Despite this, not all packages have accurate tags and it is not yet integrated in all Debian tools; <code
                  class="command">aptitude</code> displays these tags, and allows them to be used as search criteria. For those who are repelled by <code
                  class="command">aptitude</code>'s search criteria, the following website allows navigation of the tag database: <div
                  xmlns=""
                  class="url">→ <a
                    xmlns="http://www.w3.org/1999/xhtml"
                    href="http://debtags.alioth.debian.org/">http://debtags.alioth.debian.org/</a></div>
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.configuration-scripts"></a>5.2.2. 配置脚本</h3></div></div></div><a
            id="id-1.8.6.6.2"
            class="indexterm"></a><a
            id="id-1.8.6.6.3"
            class="indexterm"></a><a
            id="id-1.8.6.6.4"
            class="indexterm"></a><a
            id="id-1.8.6.6.5"
            class="indexterm"></a><a
            id="id-1.8.6.6.6"
            class="indexterm"></a><div
            class="para">
				除了<code
              class="filename">控制</code>文件之外，每个Debian软件包可能在<code
              class="filename">control.tar.gz</code>的存档中包含了一些脚本，这些脚本在软件包处理的不同的阶段被<code
              class="command">dpkg</code>调用。Debian政策描述了一些可能的细节，在可能的情况下，指定脚本调用它们所收到的参数。这些顺序可能比较复杂，因为如果脚本中任何一步出现问题的时候，<code
              class="command">dpkg</code>进程会通过取消安装或者卸载来尝试恢复到一个令人满意的状态（只要是可能的）。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>GOING FURTHER</em></span> <code
                        class="command">dpkg</code>'s database</strong></p></div></div></div><a
              id="id-1.8.6.6.8.2"
              class="indexterm"></a><a
              id="id-1.8.6.6.8.3"
              class="indexterm"></a><div
              class="para">
				所有已安装的软件包的配置脚本都存在<code
                class="filename">/var/lib/dpkg/info/</code>目录，在软件包的名字前会有一个文件名的前缀。此目录的每个软件包还包括一个叫<code
                class="filename">.list</code>的文件扩展，包括列表的文件字段属于哪些包。
			</div><div
              class="para">
				<code
                class="filename">/var/lib/dpkg/status</code>文件包含了一些数据块（著名的邮件标题的格式，RFC2822）描述了每个软件包的状态。从<code
                class="filename">control</code>文件中已经安装的软件包的信息也会被复制。
			</div></div><div
            class="para">
				在一般情况下，<code
              class="filename">preinst</code>脚本会在安装软件包前执行，而<code
              class="filename">postinst</code>会稍候执行。同样，<code
              class="filename">prerm</code>会在移除一个软件包的前和<code
              class="filename">postrm</code>之后。更新软件包相当于是清除掉以前的旧版本并且安装新的软件包。所以在这里我们不可能来详细描述所有的可能的方案，但我们将讨论最常见的两种：安装/更新和移除。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>小心</em></span> 脚本的符号名称</strong></p></div></div></div><div
              class="para">
				本节中使用特定的名称序列命名配置脚本，例如 <code
                class="command">old-prerm</code> 或 <code
                class="command">new-postinst</code>。它们分别是旧版本软件包（ 在更新前已安装）中包含的 <code
                class="command">prerm</code>脚本和新版本软件包（由本次更新所安装）中包含的 <code
                class="command">postinst</code> 脚本。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>提示</em></span>状态图</strong></p></div></div></div><div
              class="para">
				Manoj Srivastava made these diagrams explaining how the configuration scripts are called by <code
                class="command">dpkg</code>. Similar diagrams have also been developed by the Debian Women project; they are a bit simpler to understand, but less complete. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="https://people.debian.org/~srivasta/MaintainerScripts.html">https://people.debian.org/~srivasta/MaintainerScripts.html</a></div> <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="https://wiki.debian.org/MaintainerScripts">https://wiki.debian.org/MaintainerScripts</a></div>
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.6.12"></a>5.2.2.1. 安装和升级</h4></div></div></div><a
              id="id-1.8.6.6.12.2"
              class="indexterm"></a><div
              class="para">
					这里告诉你，安装的时候发生了什么（或者是更新）
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="orderedlist"><ol><li
                  class="listitem"><div
                    class="para">
							对于升级，<code
                      class="command">dpkg</code>会调用<code
                      class="command">old-prerm 升级新版本 <em
                        class="replaceable"></em></code>。
						</div></li><li
                  class="listitem"><div
                    class="para">
							还是对于升级，<code
                      class="command">dpkg</code>执行<code
                      class="command">new-preinst 升级<em
                        class="replaceable">旧版本</em></code>；对于第一个安装，它会执行<code
                      class="command">new-preinst 安装</code>。它可能会增加旧版本的最后一个参数，如果软件包已经被安装或者是删除了（但没有清除合并掉旧版本，那么这个配置文件会被保留）。
						</div></li><li
                  class="listitem"><div
                    class="para">
							新的软件包文件被解压。如果文件已经存在，就被会替换，同时会产生一个临时的备份副本。
						</div></li><li
                  class="listitem"><div
                    class="para">
							对于更新，<code
                      class="command">dpkg</code>执行<code
                      class="command">old-postrm 升级<em
                        class="replaceable">新版本</em></code>。
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code>更新所有的内部数据（文件爱女列表，配置脚本等），并删除被替换文件的备份。这是一条不归路： ） <code
                      class="command">dpkg</code>将不再具有访问所有元素的需要以此来返回以前的状态。
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> will update the configuration files, asking the user to decide if it is unable to automatically manage this task. The details of this procedure are discussed in <a
                      class="xref"
                      href="sect.package-meta-information.html#sect.conffiles">第 5.2.3 节 “校验，配置文件列表”</a>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							最后，<code
                      class="command">dpkg</code> 通过执行 <code
                      class="command">new-postinst configure <em
                        class="replaceable">最近一次配置的版本号</em></code> 对软件包进行配置。
						</div></li></ol></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.6.13"></a>5.2.2.2. 软件包移除</h4></div></div></div><div
              class="para">
					这里是当移除一个软件包的时候发生了什么：
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="orderedlist"><ol><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> 回调<code
                      class="command">prerm 移除</code>。
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> 移除了所有的软件包文件，只剩下了配置文件和配置的脚本。
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> executes <code
                      class="command">postrm remove</code>. All of the configuration scripts, except <code
                      class="filename">postrm</code>, are removed. If the user has not used the “purge” option, the process stops here.
						</div></li><li
                  class="listitem"><div
                    class="para">
							对于一个完整的清除包（由<code
                      class="command">dpkg --purge</code>或<code
                      class="command">dpkg -P</code>发出的），配置文件也将会被删除，同时一些副本（<code
                      class="filename">*.dpkg-tmp</code>,<code
                      class="filename">*.dpkg-old</code>,<code
                      class="filename">*.dpkg-new</code>）和缓存文件也会被删除掉；<code
                      class="command">dpkg</code>这时会执行<code
                      class="command">postrm purge</code>。
						</div></li></ol></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>VOCABULARY</em></span> Purge, a complete removal</strong></p></div></div></div><a
                id="id-1.8.6.6.13.4.2"
                class="indexterm"></a><div
                class="para">
					当Debian的软件包被移除掉的时候，该软件包的配置文件会被保留下来以便重新安装。同样，守护程序产生的数据（比如LDAP的服务器目录内容，或者是SQL服务器的数据库内容）也常常会被保留。
				</div><div
                class="para">
					移除掉软件包所关联的所有数据，必须使用“purge”命令，<code
                  class="command">dpkg -P<em
                    class="replaceable">软件包</em></code>，<code
                  class="command">apt-get remove --purge <em
                    class="replaceable">软件包</em></code> 或者是<code
                  class="command">aptitude purge <em
                    class="replaceable">软件包</em></code>。
				</div><div
                class="para">
					Given the definitive nature of such data removals, a purge should not be taken lightly.
				</div></div><a
              id="id-1.8.6.6.13.5"
              class="indexterm"></a><div
              class="para">
					The four scripts detailed above are complemented by a <code
                class="filename">config</code> script, provided by packages using <code
                class="command">debconf</code> to acquire information from the user for configuration. During installation, this script defines in detail the questions asked by <code
                class="command">debconf</code>. The responses are recorded in the <code
                class="command">debconf</code> database for future reference. The script is generally executed by <code
                class="command">apt</code> prior to installing packages one by one in order to group all the questions and ask them all to the user at the beginning of the process. The pre- and post-installation scripts can then use this information to operate according to the user's wishes.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>工具</em></span> <code
                          class="command">debconf</code></strong></p></div></div></div><a
                id="id-1.8.6.6.13.7.2"
                class="indexterm"></a><div
                class="para">
					<code
                  class="command">debconf</code> was created to resolve a recurring problem in Debian. All Debian packages unable to function without a minimum of configuration used to ask questions with calls to the <code
                  class="command">echo</code> and <code
                  class="command">read</code> commands in <code
                  class="filename">postinst</code> shell scripts (and other similar scripts). But this also means that during a large installation or update the user must stay with their computer to respond to various questions that may arise at any time. These manual interactions have now been almost entirely dispensed with, thanks to the <code
                  class="command">debconf</code> tool.
				</div><div
                class="para">
					<code
                  class="command">debconf</code> has many interesting features: it requires the developer to specify user interaction; it allows localization of all the strings displayed to users (all translations are stored in the <code
                  class="filename">templates</code> file describing the interactions); it has different frontends to display the questions to the user (text mode, graphical mode, non-interactive); and it allows creation of a central database of responses to share the same configuration with several computers... but the most important is that it is now possible to present all of the questions in a row to the user, prior to starting a long installation or update process. The user can go about their business while the system handles the installation on its own, without having to stay there staring at the screen waiting for questions.
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.conffiles"></a>5.2.3. 校验，配置文件列表</h3></div></div></div><a
            id="id-1.8.6.7.2"
            class="indexterm"></a><a
            id="id-1.8.6.7.3"
            class="indexterm"></a><a
            id="id-1.8.6.7.4"
            class="indexterm"></a><a
            id="id-1.8.6.7.5"
            class="indexterm"></a><a
            id="id-1.8.6.7.6"
            class="indexterm"></a><div
            class="para">
				In addition to the maintainer scripts and control data already mentioned in the previous sections, the <code
              class="filename">control.tar.gz</code> archive of a Debian package may contain other interesting files. The first, <code
              class="filename">md5sums</code>, contains the MD5 checksums for all of the package's files. Its main advantage is that it allows <code
              class="command">dpkg --verify</code> (which we will study in <a
              class="xref"
              href="sect.supervision.html#sect.dpkg-verify">第 14.3.3.1 节 “Auditing Packages with <code
                class="command">dpkg --verify</code>”</a>) to check if these files have been modified since their installation. Note that when this file doesn't exist, <code
              class="command">dpkg</code> will generate it dynamically at installation time (and store it in the dpkg database just like other control files).
			</div><div
            class="para">
				<code
              class="filename">conffiles</code> lists package files that must be handled as configuration files. Configuration files can be modified by the administrator, and <code
              class="command">dpkg</code> will try to preserve those changes during a package update.
			</div><div
            class="para">
				实际上，在这种情况下，<code
              class="command">dpkg</code>的行为会尽可能地智能：如果两个版本之间并没有改变标准的配置文件，那么<code
              class="command">dpkg</code>就什么也不会作。但是，如果文件已经被修改，它会尝试更新此文件。这会产生两种可能的情况：一是管理员没有碰配置文件，在这种情况下<code
              class="command">dpkg</code>会自动安装新版本；二是文件已经被修改了，在这种情况下<code
              class="command">dpkg</code>会询问管理员希望使用哪个版本（旧版本或者新的）。为了帮助用户作出选择，<code
              class="command">dpkg</code>会提供“<code
              class="command">差异</code>”，这会显示两个版本之间的差异。如果用户选择保留旧的版本，新的将被存储在文件夹的同一个位置并以<code
              class="filename">.dpkg-dist</code>为后缀名的文件中。另外一个可能的操作是由暂时中断的<code
              class="command">dpkg</code>来编辑该文件，并试图重新恢复相关的修改（之前被验证的<code
              class="command">差异</code>）。
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.questions-conffiles"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>更进一步</em></span> 避免配置文件问题</strong></p></div></div></div><div
              class="para">
				<code
                class="command">dpkg</code> handles configuration file updates, but, while doing so, regularly interrupts its work to ask for input from the administrator. This makes it less than enjoyable for those who wish to run updates in a non-interactive manner. This is why this program offers options that allow the system to respond automatically according to the same logic: <code
                class="command">--force-confold</code> retains the old version of the file; <code
                class="command">--force-confnew</code> will use the new version of the file (these choices are respected, even if the file has not been changed by the administrator, which only rarely has the desired effect). Adding the <code
                class="command">--force-confdef</code> option tells <code
                class="command">dpkg</code> to decide by itself when possible (in other words, when the original configuration file has not been touched), and only uses <code
                class="command">--force-confnew</code> or <code
                class="command">--force-confold</code> for other cases.
			</div><div
              class="para">
				这些选项使用<code
                class="command">dpkg</code>，但是大多数时间管理员会直接用<code
                class="command">aptitude</code> 或<code
                class="command">apt-get</code>。实际上，有必要知道dpkg的语法参数来使用<code
                class="command">dpkg</code>命令（命令行的界面是非常相似的）。
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt -o DPkg::options::="--force-confdef" -o DPkg::options::="--force-confold" full-upgrade</code></strong></pre><div
              class="para">
				These options can be stored directly in <code
                class="command">apt</code>'s configuration. To do so, simply write the following line in the <code
                class="filename">/etc/apt/apt.conf.d/local</code> file:
			</div><div
              class="informalexample"><pre
                class="programlisting">
DPkg::options { "--force-confdef"; "--force-confold"; }
</pre></div><div
              class="para">
				Including this option in the configuration file means that it will also be used in a graphical interface such as <code
                class="command">aptitude</code>.
			</div></div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.questions-conffiles-bis"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>更进一步</em></span> 强制dpkg询问配置文件问题</strong></p></div></div></div><div
              class="para">
				The <code
                class="command">--force-confask</code> option requires <code
                class="command">dpkg</code> to display the questions about the configuration files, even in cases where they would not normally be necessary. Thus, when reinstalling a package with this option, <code
                class="command">dpkg</code> will ask the questions again for all of the configuration files modified by the administrator. This is very convenient, especially for reinstalling the original configuration file if it has been deleted and no other copy is available: a normal re-installation won't work, because <code
                class="command">dpkg</code> considers removal as a form of legitimate modification, and, thus, doesn't install the desired configuration file.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="packaging-system.html"><strong>上一页</strong>第 5 章 包管理系统：工具和基本原则</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.source-package-structure.html"><strong>下一页</strong>5.3. 源软件包的结构</a></li></ul></body></html>
