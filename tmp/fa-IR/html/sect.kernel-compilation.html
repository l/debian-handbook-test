<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">8.10. کامپایل یک کرنل</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-fa-IR-1.0-1" /><meta
        name="keywords"
        content="پیکربندی, بومی‌سازی, مناطق, شبکه, شفافیت نامگذاری, کاربران, گروه‌ها, حساب‌های کاربری, مفسر خط‌-فرمان, پوسته, چاپ, راه‌انداز اولیه, کامپایل کرنل" /><link
        rel="home"
        href="index.html"
        title="راهنمای جامع دبیان" /><link
        rel="up"
        href="basic-configuration.html"
        title="فصل 8. پیکربندی اولیه: شبکه، حساب‌های کاربری، چاپ و ..." /><link
        rel="prev"
        href="sect.config-misc.html"
        title="8.9. سایر پیکربندی‌ها: همگام‌سازی زمان، گزارش‌ها، دسترسی اشتراکی..." /><link
        rel="next"
        href="sect.kernel-installation.html"
        title="8.11. نصب یک کرنل" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/fa-IR/stable/sect.kernel-compilation.html" /></head><body
      dir="rtl"><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.config-misc.html"><strong>قبلی</strong></a></li><li
          class="home">راهنمای جامع دبیان</li><li
          class="next"><a
            accesskey="n"
            href="sect.kernel-installation.html"><strong>بعدی</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.kernel-compilation"></a>8.10. کامپایل یک کرنل</h2></div></div></div><a
          id="id-1.11.14.2"
          class="indexterm"></a><a
          id="id-1.11.14.3"
          class="indexterm"></a><div
          class="para">
			کرنل‌هایی که توسط دبیان ارائه می‌شوند بیشترین تعداد از ویژگی‌های ممکن را دارا هستند، به همراه بیشترین درایورهای پشتیبانی شده به منظور اینکه پاسحگوی طیف گسترده‌ای از پیکربندی‌های سخت‌افزاری باشند. این همان دلیلی است که برخی کاربران ترجیح می‌دهند تنها نیازهای مربوط به خود در نسخه کامپایل شده از کرنل داشته باشند. برای این انتخاب دو دلیل وجود دارد. نخست اینکه برای بهبود بخشیدن عملکرد سیستم، تنها بخشی از کد کرنل که مورد نیاز است کامپایل می‌شود و این کد حتی اگر استفاده نگردد باز حافظه مربوط به خود را اشغال می‌کند (که این حافظه هیچگاه به swap منتقل نمی‌شود چرا که دقیقا حافظه اصلی یا RAM سیستم است) که این کار می‌تواند به کند شدن عملکرد کلی سیستم منجر گردد. دوم اینکه یک کرنل کامپایل شده با نیازهای خاص احتمال بروز مشکلات امنیتی را کاهش داده چرا که تنها بخش مشخصی از کدهای کرنل کامپایل شده‌اند.
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>نکته</em></span> بروزرسانی‌های امنیتی</strong></p></div></div></div><div
            class="para">
			اگر تصمیم به کامپایل‌کردن کرنل خود دارید، باید عواقب آن را نیز بپذیرید: دبیان نمی‌تواند بروزرسانی‌های امنیتی برای کرنل سفارشی شما ارائه دهد. با حفظ و استفاده از کرنلی که دبیان ارائه می‌کند، از بروزرسانی‌هایی که توسط تیم امنیتی دبیان انجام می‌شود بهره‌مند می‌گردید.
		</div></div><div
          class="para">
			کامپایل‌مجدد کرنل تنها زمانی لازم است که بخواهید از قابلیت‌های جدید ارائه شده در patchها استفاده کنید (که در نسخه استاندارد کرنل قرار ندارند).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>مطالعه بیشتر</em></span> کتابچه کرنل در دبیان</strong></p></div></div></div><a
            id="id-1.11.14.7.2"
            class="indexterm"></a><div
            class="para">
			تیم‌های کرنل در دبیان “کتابچه کرنل دببان” را مدیریت می‌کنند (که در بسته <span
              class="pkg pkg">debian-kernel-handbook</span> نیز موجود است) به همراه مستندات کامل درباره اکثر عملکردهای کرنل و اینکه چطور بسته‌های رسمی از کرنل دبیان تهیه می‌شوند. این اولین جایی است که باید به دنبال اطلاعات تکمیلی درباره کرنل و فرآیند کامپایل آن در این قسمت بگردید. <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://kernel-handbook.alioth.debian.org">http://kernel-handbook.alioth.debian.org</a></div>
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.kernel-compilation-prerequisites"></a>8.10.1. مقدمه و پیش‌نیاز</h3></div></div></div><div
            class="para">
				تعجبی ندارد که دبیان کرنل را به مانند سایر بسته‌های نرم‌افزاری مدیریت می‌کند، که با شیوه قدیمی کامپایل و نصب کرنل‌ها تفاوت دارد. از آنجا که کرنل در کنترل سیستم بسته‌بندی قرار دارد، به راحتی می‌تواند حذف یا روی دستگاه‌های دیگری نصب گردد. علاوه بر این، اسکریپت‌های موجود در این بسته‌ها عملیات مربوط به راه‌اندازی اولیه سیستم و تولید initrd را انجام می‌دهند.
			</div><div
            class="para">
				سورس کد اصلی لینوکس شامل هر آنچه که برای ساخت یک بسته دبیان لازم است، می‌باشد. اما هنوز نیاز به نصب بسته <span
              class="pkg pkg">build-essential</span> را دارید تا اطمینان یابید جعبه‌ابزار شما برای ساخت بسته‌های دبیان کامل شده است. علاوه بر این، گام پیکربندی برای کرنل نیازمند بسته <span
              class="pkg pkg">libncurses5-dev</span> است. در نهایت، بسته <span
              class="pkg pkg">fakeroot</span> امکان ایجاد بسته دبیان بدون استفاده از مجوزهای سطح بالا را فراهم می‌کند.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>فرهنگ</em></span> روزهای خوب <span
                        class="pkg pkg">kernel-package</span></strong></p></div></div></div><a
              id="id-1.11.14.8.4.2"
              class="indexterm"></a><div
              class="para">
				قبل از اینکه سیستم build در لینوکس قادر به ایجاد بسته‌های دبیان باشد، روش توصیه شده برای ایجاد چنین بسته‌هایی استفاده از ابزار <code
                class="command">make-kpkg</code> موجود در بسته <span
                class="pkg pkg">kernel-package</span> بود.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.kernel-sources"></a>8.10.2. دریافت منابع</h3></div></div></div><a
            id="id-1.11.14.9.2"
            class="indexterm"></a><a
            id="id-1.11.14.9.3"
            class="indexterm"></a><a
            id="id-1.11.14.9.4"
            class="indexterm"></a><div
            class="para">
				مانند تمام چیزهای کاربردی در سیستم دبیان، منابع کرنل لینوکس نیز در یک بسته جداگانه قرار دارند. برای دستیابی به آن‌ها تنها کافی است بسته <span
              class="pkg pkg">linux-source-<em
                class="replaceable">version</em></span> را نصب کنید. دستور <code
              class="command">apt-cache search ^linux-source</code> نسخه‌های مختلفی از کرنل لینوکس را که توسط دبیان ارائه شده‌اند نمایش می‌دهد. آخرین نسخه همیشه در توزیع <span
              class="distribution distribution">Unstable</span> قرار دارد: بدون کوچکترین خطری می‌توانید آن‌ها را دریافت کنید (به خصوص زمانی که APT مطابق با دستورالعمل‌های موجود در <a
              class="xref"
              href="sect.apt-get.html#sect.apt-mix-distros">
      قسمت 6.2.6, “کار با چندین توزیع مختلف”
    </a> پیکربندی شده باشد). نکته اینکه سورس کد موجود در این بسته‌ها مطابق با نسخه لینوس توروالذز و سایر توسعه‌دهندگان لینوکس نیستند؛ مانند تمام توزیع‌ها، دبیان شماری از patchها را اعمال می‌کند، که ممکن است به نسخه اصلی لینوکس راه پیدا بکنند یا نه. این تغییرات شامل سازگارکردن بهبودها/ویژگی‌ها/درایورها از نسخه‌های جدید کرنل، قابلیت‌های جدید که هنوز در ساختار اصلی کرنل قرار نگرفته و گاهی اوقات تغییرات خاص دبیان هستند.
			</div><div
            class="para">
				باقی این قسمت روی نسخه ۳.۱۶ از کرنل لینوکس تمرکز می‌کند اما مثال‌ها می‌توانند در مورد هر نسحه از کرنل مورد نظر شما اعمال شوند.
			</div><div
            class="para">
				فرض می‌کنیم که بسته <span
              class="pkg pkg">linux-source-3.16</span> نصب شده باشد. این بسته شامل فایل <code
              class="filename">/usr/src/linux-source-3.16.tar.xz</code> است که نسخه فشرده شده از کد کرنل می‌باشد. باید این فایل را در یک دایرکتوری جدید تخلیه کنید (نه به طور مستقیم زیرمجموعه <code
              class="filename">/usr/src/</code>، چرا که دلیلی برای مجوزهای سطح بالا کامپایل کرنل وجود ندارد): <code
              class="filename">~/kernel/</code> مسیر مناسبی است.
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>mkdir ~/kernel; cd ~/kernel</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>tar -xaf /usr/src/linux-source-3.16.tar.xz</code></strong></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>فرهنگ</em></span> محل منابع کرنل</strong></p></div></div></div><div
              class="para">
				سابق بر این، منابع کرنل لینوکس در مسیر <code
                class="filename">/usr/src/linux/</code> ذخیره می‌شدند که به مجوزهای سطح بالا جهت کامپایل‌شدن نیاز داشت. اگرچه، کار با این مجوزها تا آنجا که ممکن است باید محدود گردد. یک گروه <code
                class="literal">src</code> وجود دارد که به اعضا اجازه کار در این دایرکتوری را می‌دهد، اما کار در آن تا آنجا که ممکن است نباید انجام شود. با نگهداری منابع لینوکس در یک دایرکتوری شخصی، از هر جهت امنیت را رعایت کرده‌اید: هیچ فایل ناشناسی در <code
                class="filename">/usr/src/</code> برای سیستم بسته‌بندی وجود نخواهد داشت و هیچ روش گمراه‌کننده‌ای برای برنامه‌هایی که می‌خواهند از محتویات <code
                class="filename">/usr/src/linux</code> استفاده کنند بوجود نمی‌آید.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.config-kernel"></a>8.10.3. پیکربندی کرنل</h3></div></div></div><a
            id="id-1.11.14.10.2"
            class="indexterm"></a><a
            id="id-1.11.14.10.3"
            class="indexterm"></a><a
            id="id-1.11.14.10.4"
            class="indexterm"></a><div
            class="para">
				گام بعدی پیکربندی کرنل با توجه به نیاز خودتان است که عملیات دقیق آن به اهداف شما بستگی دارد.
			</div><div
            class="para">
				زمانی که نسخه‌ای جدیدتر از کرنل را مجدد کامپایل می‌کنید (احتمالا به همراه یک patch اضافه)، پیکربندی تا آنجا که ممکن است به شیوه دبیان نزدیک خواهد بود. در این مورد، و بجای آنکه همه چیز را از ابتدا پیکربندی کنید، تنها کافی است از فایل <code
              class="filename">/boot/config-<em
                class="replaceable">version</em></code> (نسخه‌ای که کرنل کنونی از آن استفاده می‌کند که با استفاده از دستور <code
              class="command">uname -r</code> قابل خواندن است) در <code
              class="filename">.config</code> که در دایرکتوری شامل سورس کد کرنل می‌باشد، رونوشت بگیرید.
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>cp /boot/config-3.16.0-4-amd64 ~/kernel/linux-source-3.16/.config</code></strong></pre><div
            class="para">
				اگر قصد تغییر در پیکربندی موجود را ندارید، می‌توانید در این مرحله توقف کرده و به قسمت <a
              class="xref"
              href="sect.kernel-compilation.html#sect.kernel-build">
      قسمت 8.10.4, “کامپایل‌کردن و ساختن بسته”
    </a> بروید. اگر می‌خواهید تغییرات را انجام دهید، از طرف دیگر، یا اینکه همه چیز را از اول پیکربندی کنید، باید زمان برای این ییکربندی سفارشی را مد نظر قرار دهید. رابط‌های انحصاری مختلفی در دایرکتوری سورس کد کرنل وجود دارند که می‌توان با استفاده از دستور <code
              class="command">make <em
                class="replaceable">target</em></code> فراخوانی کرد، که <em
              class="replaceable">target</em> یکی از مقادیر موجود در زیر است.
			</div><div
            class="para">
				<code
              class="command">make menuconfig</code> یک رابط متنی (که از بسته <span
              class="pkg pkg">libncurses5-dev</span> می‌آید) را کامپایل و اجرا می‌کند که اجازه پیمایش گزینه‌های پیکربندی مختلف را به صورت ساختار درختی می‌دهد. فشردن کلید <span
              class="keycap"><strong>Space</strong></span> مقدار گزینه انتخابی را تغییر می‌دهد و کلید <span
              class="keycap"><strong>Enter</strong></span> دکمه انتهای صفحه را فرا می‌خواهند؛ <span
              class="guibutton"><strong>Select</strong></span> به زیر منو انتخابی باز می‌گردد؛ <span
              class="guibutton"><strong>Exit</strong></span> صفحه جاری را بسته و به ساختار قبلی باز می‌گردد؛ <span
              class="guibutton"><strong>Help</strong></span> نیز راهنمایی بیشتر درباره گزینه‌های موجود را نمایش می‌دهد. کلیدهای جهت‌نما نیز برای پیمایش در صفحه استفاده می‌شوند. برای خروج از برنامه پیکربندی، <span
              class="guibutton"><strong>Select</strong></span> را از منوی اصلی انتخاب کنید. برنامه درخواست ذخیره‌سازی تغییرات شما را می‌دهد؛ در صورت راضی بودن از تغییرات آن‌ها را تایید کنید.
			</div><div
            class="para">
				سایر رابط‌ها نیز عملکرد مشترکی دارند، اما به شیوه برنامه‌های گرافیکی مدرن کار می‌کنند؛ مانند <code
              class="command">make xconfig</code> که از رابط گرافیکی Qt و <code
              class="command">make gconfig</code> که از رابط گرافیکی +GTK بهره می‌برند. اولی به کتابخانه <span
              class="pkg pkg">libqt4-dev</span> و دومی به کتابخانه‌های <span
              class="pkg pkg">libglade2-dev</span> و <span
              class="pkg pkg">libgtk2.0-dev</span> نیاز دارند.
			</div><div
            class="para">
				هنگام استفاده از این رابط‌ها برای پیکربندی، ایده خوبی است که از یک پیکربندی پیش‌فرض آغاز کنید. کرنل چنین پیکربندی‌هایی را در فایل <code
              class="filename">arch/<em
                class="replaceable">arch</em>/configs/*_defconfig</code> ارائه داده که می‌توانید آن‌ها را با استفاده از دستور <code
              class="command">make x86_64_defconfig</code> (در مورد یک رایانه ۶۴ بیتی) یا <code
              class="command">make i386_defconfig</code> (در مورد یک رایانه ۳۲ بیتی) انتخاب کنید.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>نکته</em></span> مواجهه با فایل‌های قدیمی <code
                        class="filename">.config</code></strong></p></div></div></div><div
              class="para">
				زمانی که با یک فایل <code
                class="filename">.config</code> تولید شده توسط نسحه قدیمی‌تر کرنل مواجه می‌شوید، باید آن را بروزرسانی کنید. اینکار را می‌توانید با استفاده از <code
                class="command">make oldconfig</code> که به صورت تعاملی پرسش‌هایی را درباره پیکربندی جدید از شما می‌پرسد انجام دهید. اگر قصد استفاده از پاسخ پیش‌فرض برای پرسش‌ها را دارید می‌توانید از <code
                class="command">make olddefconfig</code> استفاده کنید. با استفاده از <code
                class="command">make olddefconfig</code>، فرض بر این است که پاسخ شما به تمام پرسش‌ها منفی است.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.kernel-build"></a>8.10.4. کامپایل‌کردن و ساختن بسته</h3></div></div></div><a
            id="id-1.11.14.11.2"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>یادداشت</em></span> تمیزکاری قبل از فرآیند ساخت</strong></p></div></div></div><div
              class="para">
				اگر پیش از این در دایرکتوری موجود اقدام به کامپایل کرنل کرده باشید و اکنون می‌خواهید همه چیز را از ابتدا آغاز کنید (برای نمونه به دلیل تغییر در پیکربندی کرنل) باید از دستور <code
                class="command">make clean</code> استفاده کنید تا فایل‌های کامپایل شده قبلی را پاک کند. دستور <code
                class="command">make distclean</code> حتی فایل‌های تولید شده بیشتری را نیز پاک می‌کند، از جمله فایل <code
                class="filename">.config</code> شما، پس بهتر است که از آن یک پشتیبان تهیه کنید.
			</div></div><div
            class="para">
				زمانی که پیکربندی کرنل آماده باشد، یک دستور ساده <code
              class="command">make deb-pkg</code> تا ۵ بسته دبیان را تولید می‌کند: <span
              class="pkg pkg">linux-image-<em
                class="replaceable">version</em></span> که شامل کرنل و ماژول‌های مربوطه است، <span
              class="pkg pkg">linux-headers-<em
                class="replaceable">version</em></span> که شامل فایل‌های سرآیند برای ساخت ماژول‌های اضافی است، <span
              class="pkg pkg">linux-firmware-image-<em
                class="replaceable">version</em></span> که شامل فایل‌های مورد نیاز برخی درایورها است (این بسته هنگامی که از منابع کرنل دبیان استفاده می‌کنید ممکن است وجود نداشته باشد)، <span
              class="pkg pkg">linux-image-<em
                class="replaceable">version</em>-dbg</span> که شامل گزینه‌های عیب‌یابی برای کرنل و ماژول‌های آن است و در نهایت <span
              class="pkg pkg">linux-libc-dev</span> که شامل فایل‌های سرآیند برخی برنامه‌های سمت کاربر مانند کتابخانه GNU glibc می‌باشد.
			</div><div
            class="para">
				<em
              class="replaceable">version</em> توسط الحاق نسخه توسعه‌دهنده اصلی (که توسط متغیرهای <code
              class="literal">VERSION</code>، <code
              class="literal">PATCHLEVEL</code>، <code
              class="literal">SUBLEVEL</code> و <code
              class="literal">EXTRAVERSION</code> در فایل <code
              class="filename">Makefile</code> مشخص می‌شود) از <code
              class="literal">LOCALVERSION</code> پارامتر پیکربندی و <code
              class="literal">LOCALVERSION</code> متغیر محلی است. نسخه بسته از همان رشته تولید شده به همراه یک عدد که به صورت ترتیبی افزایش می‌یابد بهره می‌گیرد (که در فایل <code
              class="filename">.version</code> ذخیره می‌شود) مگر آنکه را با استفاده از متغیر محلی <code
              class="literal">KDEB_PKGVERSION</code> بی‌تاثیر سازید.
			</div><pre
            class="screen"><code
              class="computeroutput">$ </code><strong
              class="userinput"><code>make deb-pkg LOCALVERSION=-falcot KDEB_PKGVERSION=$(make kernelversion)-1
</code></strong><code
              class="computeroutput">[...]
$ </code><strong
              class="userinput"><code>ls ../*.deb
</code></strong><code
              class="computeroutput">../linux-headers-3.16.7-ckt4-falcot_3.16.7-1_amd64.deb
../linux-image-3.16.7-ckt4-falcot_3.16.7-1_amd64.deb
../linux-image-3.16.7-ckt4-falcot-dbg_3.16.7-1_amd64.deb
../linux-libc-dev_3.16.7-1_amd64.deb
</code></pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.modules-build"></a>8.10.5. کامپایل‌کردن ماژول‌های خارجی</h3></div></div></div><a
            id="id-1.11.14.12.2"
            class="indexterm"></a><a
            id="id-1.11.14.12.3"
            class="indexterm"></a><a
            id="id-1.11.14.12.4"
            class="indexterm"></a><div
            class="para">
				برخی ماژول‌ها خارج از کرنل رسمی لینوکس مدیریت می‌شوند. برای استفاده از آن‌ها، باید همراه با نسخه مربوطه کرنل کامپایل گردند. تعدادی از ماژول‌ها به صورت جداگانه توسط دبیان و در بسته‌های مختص به خود مانند <span
              class="pkg pkg">xtables-addons-source</span> (ماژول‌های اضافی برای iptables) یا <span
              class="pkg pkg">oss4-source</span> (سیستم آزاد صوتی، برخی درایورهای مبتنی بر صدا) فراهم آمده‌اند.
			</div><div
            class="para">
				تعداد این بسته‌های خارجی بسیار زیاد است و فرصت مطرح کردن آن‌ها را در این قسمت نداریم؛ دستور <code
              class="command">apt-cache search source$</code> می‌تواند فهرست مختصری از آن‌ها را به شما نمایش دهد. اگرچه، دارا بودن فهرست کاملی از این ماژول‌ها مادامی که ندانید به کدام یک نیاز دارید و کدام یک اضافی است، کاربرد خاصی ندارد. در این موارد، مستندات مربوط به دستگاه یا سخت‌افزاری که می‌خواهید از آن در لینوکس استفاده کنید به این نکات اشاره می‌کنند.
			</div><div
            class="para">
				برای نمونه، بیایید نگاهی به بسته <span
              class="pkg pkg">xtables-addons-source</span> بیندازیم: پس از نصب، فایل <code
              class="filename">.tar.bz2</code> از منابع ماژول در مسیر <code
              class="filename">/usr/src/</code> قرار می‌گیرد. با اینکه می‌توانیم این فایل را از حالت فشرده خارج ساخته و ماژول مورد نظر را تولید کنیم، در عمل از ابزار DKMS به منظور خودکارسازی این فرآیند استفاده می‌کنیم. اکثر ماژول‌ها انطباق با مکانیزم DMKS را در نام بسته‌هایی که به <code
              class="literal">-dkms</code> ختم می‌شوند ارائه می‌دهند. در این مورد، نصب بسته <span
              class="pkg pkg">xtables-addons-dkms</span> تنها کار مورد نیاز به منظور کامپایل این ماژول برای کرنل فعلی نصب شده است که بسته <span
              class="pkg pkg">linux-headers-*</span> مختص به آن می‌باشد. برای نمونه، اگر از <span
              class="pkg pkg">linux-image-amd64</span> استفاده می‌کنید، باید بسته <span
              class="pkg pkg">linux-headers-amd64</span> را نصب داشته باشید.
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>sudo apt install xtables-addons-dkms</code></strong>
<code
              class="computeroutput">
[...]
Setting up xtables-addons-dkms (2.6-1) ...
Loading new xtables-addons-2.6 DKMS files...
First Installation: checking all kernels...
Building only for 3.16.0-4-amd64
Building initial module for 3.16.0-4-amd64
Done.

xt_ACCOUNT:
Running module version sanity check.
 - Original module
   - No original module exists within this kernel
 - Installation
   - Installing to /lib/modules/3.16.0-4-amd64/updates/dkms/
[...]
DKMS: install completed.
$ </code><strong
              class="userinput"><code>sudo dkms status</code></strong>
<code
              class="computeroutput">xtables-addons, 2.6, 3.16.0-4-amd64, x86_64: installed
$ </code><strong
              class="userinput"><code>sudo modinfo xt_ACCOUNT</code></strong>
<code
              class="computeroutput">filename:       /lib/modules/3.16.0-4-amd64/updates/dkms/xt_ACCOUNT.ko
license:        GPL
alias:          ipt_ACCOUNT
author:         Intra2net AG &lt;opensource@intra2net.com&gt;
description:    Xtables: per-IP accounting for large prefixes
[...]
</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>جایگزین</em></span> module-assistant</strong></p></div></div></div><a
              id="id-1.11.14.12.9.2"
              class="indexterm"></a><div
              class="para">
				قبل از DKMS، استفاده از <span
                class="pkg pkg">module-assistant</span> ساده‌ترین روش برای ساخت و توسعه ماژول‌های کرنل بود. اکنون نیز قابلیت استفاده دارد، به خصوص برای بسته‌هایی که سازگار با DKMS نباشند: با دستور ساده‌ای مانند <code
                class="command">module-assistant auto-install xtables-addons</code> (یا <code
                class="command">m-a a-i xtables-addons</code> به طور خلاصه) ماژول‌ها برای کرنل فعلی ساخته شده، در بسته جدید دبیان قرار گرفته و آن بسته‌ها به صورت خودکار نصب می‌گردند.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.kernel-patch"></a>8.10.6. اعمال یک وصله در کرنل</h3></div></div></div><a
            id="id-1.11.14.13.2"
            class="indexterm"></a><a
            id="id-1.11.14.13.3"
            class="indexterm"></a><div
            class="para">
				برخی ویژگی‌ها به دلیل مناسب نبودن با استانداردهای کرنل یا عدم تفاهم بین توسعه‌دهندگان آن، در نسخه استاندارد کرنل قرار ندارند. چنین ویژگی‌هایی در قالب وصله یا patch وجود دارند که به صورت آزادانه توسط کاربران می‌توانند به یک نسخه از کرنل اضافه گردند.
			</div><div
            class="para">
				دبیان برخی از این وصله‌ها را در بسته‌های <span
              class="pkg pkg">linux-patch-*</span> یا <span
              class="pkg pkg">kernel-patch-*</span> توزیع می‌کند (برای نمونه، <span
              class="pkg pkg">linux-patch-grsecurity2</span> که برخی سیاست‌های امنیتی کرنل را تقویت می‌کند). این بسته‌ها، فایل‌های مورد نیاز را در دایرکتوری <code
              class="filename">/usr/src/kernel-patches/</code> ذخیره می‌سازند.
			</div><div
            class="para">
				برای اعمال یک یا چندی از این وصله‌ها، از دستور <code
              class="command">patch</code> در دایرکتوری اشاره شده استفاده کنید سپس به کامپایل‌ مجدد کرنل طبق روش‌های بالا بپردازید.
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>cd ~/kernel/linux-source-3.16</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>make clean</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>zcat /usr/src/kernel-patches/diffs/grsecurity2/grsecurity-3.0-3.17.1-201410250027.patch.gz | patch -p1</code></strong></pre><div
            class="para">
				نکته اینکه یک وصله مشخص به طور خاص با تمام نسخه‌های کرنل کار نمی‌کند؛ از این رو امکان ناموفق بودن عملیات همراه با دستور <code
              class="command">patch</code> وجود دارد. یک پیام خطا هنگام بروز چنین مشکلی همراه با جزئیات آن نمایش داده می‌شود؛ در این مورد، به مستندات موجود در بسته دبیان مربوط به فایل وصله (در دایرکتوری <code
              class="filename">/usr/share/doc/linux-patch-*/</code>) مراجعه کنید. در اکثر موارد، نگهدارنده بسته اشاره می‌کند که وصله برای کدام یک از نسخه‌های کرنل کار می‌کند.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.config-misc.html"><strong>قبلی</strong>8.9. سایر پیکربندی‌ها: همگام‌سازی زمان، گزارش‌ها،...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>بالا</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>خانه</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.kernel-installation.html"><strong>بعدی</strong>8.11. نصب یک کرنل</a></li></ul></body></html>
