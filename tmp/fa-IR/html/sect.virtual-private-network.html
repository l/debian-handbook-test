<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">10.2. شبکه خصوصی مجازی</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-fa-IR-1.0-1" /><meta
        name="keywords"
        content="شبکه, Gateway, TCP/IP, IPv6, DNS, Bind, DHCP, QoS" /><link
        rel="home"
        href="index.html"
        title="راهنمای جامع دبیان" /><link
        rel="up"
        href="network-infrastructure.html"
        title="فصل 10. زیرساخت شبکه" /><link
        rel="prev"
        href="network-infrastructure.html"
        title="فصل 10. زیرساخت شبکه" /><link
        rel="next"
        href="sect.quality-of-service.html"
        title="10.3. کیفیت سرویس" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/fa-IR/stable/sect.virtual-private-network.html" /></head><body
      dir="rtl"><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="network-infrastructure.html"><strong>قبلی</strong></a></li><li
          class="home">راهنمای جامع دبیان</li><li
          class="next"><a
            accesskey="n"
            href="sect.quality-of-service.html"><strong>بعدی</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.virtual-private-network"></a>10.2. شبکه خصوصی مجازی</h2></div></div></div><div
          class="para">
			یک <span
            class="emphasis"><em>Virtual Private Network</em></span> یا به اختصار VPN روشی برای پیوند زدن دو شبکه محلی از طریق ایجاد تونل در اینترنت است؛ تونل معمولا برای محرمانگی اطلاعات رمزنگاری می‌شود. از VPN معمولا برای برقراری ارتباط با یک رایانه در شبکه داخلی یک شرکت استفاده می‌شود.
		</div><a
          id="id-1.13.5.3"
          class="indexterm"></a><a
          id="id-1.13.5.4"
          class="indexterm"></a><a
          id="id-1.13.5.5"
          class="indexterm"></a><div
          class="para">
			ابزارهای بسیاری این قابلیت را فراهم می‌کنند. OpenVPN یک راهکار موثر، ساده برای راه‌اندازی و نگهداری و امن بر اساس SSL/TLS است. امکان دیگر استفاده از IPsec برای رمزگذاری ترافیک بین دو رایانه است؛ این رمزنگاری به صورت شفاف است، یعنی برنامه‌هایی که روی این رایانه‌ها اجرا می‌شوند برای استفاده از VPN نیاز به تغییر ندارند. SSH نیز علاوه بر کاربرد اصلی خود، برای فراهم‌کردن VPN مورد استفاده قرار می‌گیرد. در نهایت، یک VPN می‌تواند توسط پروتکل PPTP از مایکروسافت برقرار شود. گزینه‌های دیگری نیز وجود دارند اما خارج از تمرکز این کتاب هستند.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.openvpn"></a>10.2.1. OpenVPN</h3></div></div></div><a
            id="id-1.13.5.7.2"
            class="indexterm"></a><div
            class="para">
				OpenVPN نرم‌افزاری است که برای ایجاد شبکه‌های خصوصی مجازی استفاده می‌شود. راه‌اندازی آن شامل ایجاد رابط‌های شبکه خصوصی روی سرور VPN و کلاینت‌های آن است؛ هر دو رابط <code
              class="literal">tun</code> (برای تونل‌های سطح IP) و <code
              class="literal">tap</code> (برای تونل‌های سطح Ethernet) پشتیبانی می‌شوند. در عمل، رابط‌های <code
              class="literal">tun</code> اغلب مورد استفاده قرار می‌گیرند زمانی که کلاینت‌های VPN قرار باشد درون شبکه محلی سرور با استفاده از پل Ethernet تنظیم گردند.
			</div><div
            class="para">
				OpenVPN برای عملیات رمزنگاری SSL/TLS و سایر قابلیت‌ها (محرمانگی، احرازهویت، جامعیت، انکارناپذیری) به OpenSSL وابسته است. امکان پیکربندی آن با استفاده از یک کلید خصوصی اشتراکی یا گواهینامه‌های X.509 مبتنی بر زیرساخت کلید عمومی وجود دارد. شیوه دوم پیکربندی به شدت ارجحیت دارد، چرا که در زمان درخواست سایر کاربران برای دسترسی به VPN، انعطاف‌پذیری بیشتری دارد.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>فرهنگ</em></span> SSL و TLS</strong></p></div></div></div><a
              id="id-1.13.5.7.5.2"
              class="indexterm"></a><a
              id="id-1.13.5.7.5.3"
              class="indexterm"></a><div
              class="para">
				پروتکل SSL یا <span
                class="emphasis"><em>Secure Socket Layer</em></span> توسط Netscape برای برقراری ارتباطات امن با وب سرورها اختراع شد. اندکی بعد توسط کارگروه مهندسی اینترنت یا IETF تحت عنوان TLS یا <span
                class="emphasis"><em>Transport Layer Security</em></span> استانداردسازی شد. از آن زمان به بعد TLS به پیشرفت خود ادامه داد و SSL بر اساس چندین آسیب‌پذیری در طراحی اولیه متوقف شد.
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.easy-rsa"></a>10.2.1.1. زیرساخت کلید عمومی: <span
                      class="emphasis"><em>easy-rsa</em></span></h4></div></div></div><a
              id="id-1.13.5.7.6.2"
              class="indexterm"></a><a
              id="id-1.13.5.7.6.3"
              class="indexterm"></a><a
              id="id-1.13.5.7.6.4"
              class="indexterm"></a><a
              id="id-1.13.5.7.6.5"
              class="indexterm"></a><a
              id="id-1.13.5.7.6.6"
              class="indexterm"></a><a
              id="id-1.13.5.7.6.7"
              class="indexterm"></a><a
              id="id-1.13.5.7.6.8"
              class="indexterm"></a><div
              class="para">
					الگوریتم RSA در رمزنگاری کلید-عمومی کاربرد بسیاری دارد. این الگوریتم شامل یک “زوج کلید” است که از یک کلید عمومی و خصوصی تشکیل شده است. این دو کلید بسیار عملکرد نزدیکی دارند و خصوصیات ریاضی آن‌ها به گونه‌ای است که پیام رمزگذاری شده با کلید عمومی تنها می‌تواند با کلید خصوصی مرتبط با آن رمزگشایی شود، که این امر به محرمانگی اطلاعات کمک می‌کند. از طرف دیگر، پیامی که با کلید خصوصی رمزگذاری شده باشد توسط هر کسی که کلید عمومی را بداند قابل رمزگشایی است، که این امر به احرازهویت فرستنده کمک می‌کند چرا که تنها یک نفر به کلید خصوصی دسترسی دارد. زمانی که با یک تابع مخلوط‌سازی دیجیتال (MD5، SHA1 یا یک گزینه مشابه) این امر به یک مکانیزم امضا منجر می‌شود که می‌تواند برای هر پیام بکار رود.
				</div><div
              class="para">
					با این وجود، هر فردی می‌تواند زوج کلید خود را به نام فرد دیگری بوجود آورد. یک راه شامل مفهوم CA یا <span
                class="emphasis"><em>Certification Authority</em></span> است که توسط X.509 استانداردسازی شده است. این عبارت شامل یک موجودیت دارای زوج کلید به نام <span
                class="emphasis"><em>root certificate</em></span> است. از این گواهینامه تنها برای امضای سایر گواهینامه‌ها (زوج کلیدها) استفاده می‌شود، پس از اینکه گام‌های مورد نیاز برای شناسایی هویت را انجام دهد. برنامه‌هایی که از X.509 استفاده می‌کنند می‌توانند در صورت دانستن گواهینامه‌های ریشه، به بررسی گواهینامه‌های خود بپردازند.
				</div><div
              class="para">
					OpenVPN از این قانون استفاده می‌کند. از آنجا که CAهای عمومی در ازای مبلغ (سنگینی) حاضر به تبادل گواهینامه‌ها هستند، امکان ایجاد یک CA خصوصی در شرکت وجود دارد. بسته <span
                class="pkg pkg">easy-rsa</span> شامل ابزاری است که امکان ایجاد زیرساخت گواهینامه X.509 را فراهم می‌کند، که به صورت چند اسکریپت با استفاده از دستور <code
                class="command">openssl</code> پیاده‌سازی شده است.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>یادداشت</em></span> <span
                          class="emphasis"><em>easy-rsa</em></span> قبل از <span
                          class="distribution distribution">Jessie</span></strong></p></div></div></div><div
                class="para">
					در نسخه‌های دبیان تا <span
                  class="distribution distribution">Wheezy</span>، بسته <span
                  class="emphasis"><em>easy-rsa</em></span> به عنوان قسمتی از <span
                  class="emphasis"><em>openvpn</em></span> توزیع می‌شد و اسکریپت‌های آن در مسیر <code
                  class="filename">/usr/share/doc/openvpn/examples/easy-rsa/2.0/</code> قرار داشتند. راه‌اندازی یک CA شامل رونوشت گرفتن از آن دایرکتوری، بجای استفاده از دستور <code
                  class="command">make-cadir</code> بود که در اینجا به آن می‌پردازیم.
				</div></div><div
              class="para">
					مدیرسیستم‌های شرکت فالکوت از این ابزار برای ایجاد گواهینامه‌های مورد نظر در هر دو سمت کلاینت و سرور استفاده می‌کنند. این کار امکان پیکربندی تمام کلاینت‌ها را به صورت مشابهی فراهم می‌آورد چرا که آن‌ها تنها باید به گواهینامه‌های خصوصی در محل شرکت فالکوت اعتماد کنند. این CA اولین گواهینامه موجود است؛ به این منظور، مدیرسیستم‌ها اقدام به ایجاد یک دایرکتوری با فایل‌های مورد نیاز CA می‌کنند، احتمالا روی رایانه‌ای که به شبکه متصل نباشد تا با اینکار امکان لو رفتن کلید خصوصی CA را کاهش دهند.
				</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>make-cadir pki-falcot
</code></strong><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>cd pki-falcot</code></strong></pre><div
              class="para">
					آنگاه اقدام به ذخیره‌سازی پارامترهای مورد نیاز در فایل <code
                class="filename">vars</code> می‌کنند، به خصوص آن‌هایی که پیشوند <code
                class="literal">KEY_</code> دارند؛ این متغیرها در ادامه به محیط اجرایی اضافه خواهند شد:
				</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>vim vars
</code></strong><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>grep KEY_ vars
</code></strong><code
                class="computeroutput">export KEY_CONFIG=`$EASY_RSA/whichopensslcnf $EASY_RSA`
export KEY_DIR="$EASY_RSA/keys"
echo NOTE: If you run ./clean-all, I will be doing a rm -rf on $KEY_DIR
export KEY_SIZE=2048
export KEY_EXPIRE=3650
export KEY_COUNTRY="FR"
export KEY_PROVINCE="Loire"
export KEY_CITY="Saint-Étienne"
export KEY_ORG="Falcot Corp"
export KEY_EMAIL="admin@falcot.com"
export KEY_OU="Certificate authority"
export KEY_NAME="Certificate authority for Falcot Corp"
# If you'd like to sign all keys with the same Common Name, uncomment the KEY_CN export below
# export KEY_CN="CommonName"
$ </code><strong
                class="userinput"><code>. ./vars
</code></strong><code
                class="computeroutput">NOTE: If you run ./clean-all, I will be doing a rm -rf on /home/roland/pki-falcot/keys
$ </code><strong
                class="userinput"><code>./clean-all
</code></strong></pre><div
              class="para">
					گام بعد ایجاد زوج کلید خود CA است (این دو قسمت از زوج کلید در فایل‌های <code
                class="filename">keys/ca.crt</code> و <code
                class="filename">keys/ca.key</code> ذخیره می‌شوند):
				</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>./build-ca</code></strong>
<code
                class="computeroutput">Generating a 2048 bit RSA private key
...................................................................+++
...+++
writing new private key to 'ca.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [FR]:
State or Province Name (full name) [Loire]:
Locality Name (eg, city) [Saint-Étienne]:
Organization Name (eg, company) [Falcot Corp]:
Organizational Unit Name (eg, section) [Certificate authority]:
Common Name (eg, your name or your server's hostname) [Falcot Corp CA]:
Name [Certificate authority for Falcot Corp]:
Email Address [admin@falcot.com]:
</code></pre><div
              class="para">
					اکنون گواهینامه مربوط به سرور VPN می‌تواند ایجاد گردد، همین طور پارامترهای Diffie-Hellman مورد نیاز برای بخش سمت-سرور یک ارتباط SSL/TLS. سرور VPN توسط نام دامنه <code
                class="literal">vpn.falcot.com</code> شناخته می‌شود؛ این نام برای فایل‌های دیگری نیز استفاده شده است (<code
                class="filename">keys/vpn.falcot.com.crt</code> برای گواهینامه عمومی و <code
                class="filename">keys/vpn.falcot.com.key</code> برای کلید خصوصی آن):
				</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>./build-key-server vpn.falcot.com
</code></strong><code
                class="computeroutput">Generating a 2048 bit RSA private key
.....................................................................................................................+++
...........+++
writing new private key to 'vpn.falcot.com.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [FR]:
State or Province Name (full name) [Loire]:
Locality Name (eg, city) [Saint-Étienne]:
Organization Name (eg, company) [Falcot Corp]:
Organizational Unit Name (eg, section) [Certificate authority]:
Common Name (eg, your name or your server's hostname) [vpn.falcot.com]:
Name [Certificate authority for Falcot Corp]:
Email Address [admin@falcot.com]:

Please enter the following 'extra' attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
Using configuration from /home/roland/pki-falcot/openssl-1.0.0.cnf
Check that the request matches the signature
Signature ok
The Subject's Distinguished Name is as follows
countryName           :PRINTABLE:'FR'
stateOrProvinceName   :PRINTABLE:'Loire'
localityName          :T61STRING:'Saint-\0xFFFFFFC3\0xFFFFFF89tienne'
organizationName      :PRINTABLE:'Falcot Corp'
organizationalUnitName:PRINTABLE:'Certificate authority'
commonName            :PRINTABLE:'vpn.falcot.com'
name                  :PRINTABLE:'Certificate authority for Falcot Corp'
emailAddress          :IA5STRING:'admin@falcot.com'
Certificate is to be certified until Mar  6 14:54:56 2025 GMT (3650 days)
Sign the certificate? [y/n]:</code><strong
                class="userinput"><code>y
</code></strong><code
                class="computeroutput">

1 out of 1 certificate requests certified, commit? [y/n]</code><strong
                class="userinput"><code>y
</code></strong><code
                class="computeroutput">Write out database with 1 new entries
Data Base Updated
$ </code><strong
                class="userinput"><code>./build-dh
</code></strong><code
                class="computeroutput">Generating DH parameters, 2048 bit long safe prime, generator 2
This is going to take a long time
[…]
</code></pre><div
              class="para">
					گام بعدی گواهینامه‌های مورد نیاز کلاینت‌های VPN را ایجاد می‌کند؛ برای هر رایانه یا فردی که قصد استفاده از VPN را دارد، یک گواهینامه مورد نیاز است:
				</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>./build-key JoeSmith
</code></strong><code
                class="computeroutput">Generating a 2048 bit RSA private key
................................+++
..............................................+++
writing new private key to 'JoeSmith.key'
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter '.', the field will be left blank.
-----
Country Name (2 letter code) [FR]:
State or Province Name (full name) [Loire]:
Locality Name (eg, city) [Saint-Étienne]:
Organization Name (eg, company) [Falcot Corp]:
Organizational Unit Name (eg, section) [Certificate authority]:</code><strong
                class="userinput"><code>Development unit
</code></strong><code
                class="computeroutput">Common Name (eg, your name or your server's hostname) [JoeSmith]:</code><strong
                class="userinput"><code>Joe Smith
</code></strong><code
                class="computeroutput">[…]</code></pre><div
              class="para">
					اکنون تمام گواهینامه‌ها ایجاد شده‌اند و باید به مکان مناسبی منتقل شوند: کلید عمومی گواهینامه ریشه (<code
                class="filename">keys/ca.crt</code>) در تمام رایانه‌ها (کلاینت و سرور) به نام <code
                class="filename">/etc/ssl/certs/Falcot_CA.crt</code> ذخیره می‌شود. گواهینامه سرور تنها در سرور ذخیره می‌شود (<code
                class="filename">keys/vpn.falcot.com.crt</code> به <code
                class="filename">/etc/ssl/vpn.falcot.com.crt</code> و <code
                class="filename">keys/vpn.falcot.com.key</code> به <code
                class="filename">/etc/ssl/vpn.falcot.com.key</code> تغییر نام می‌یابند همراه با مجوزهای محدودشده به طوری که تنها مدیرسیستم قابلیت خواندن داشته باشد) و پارامترهای Diffie-Hellman نیز (<code
                class="filename">keys/dh2048.pem</code>) در فایل <code
                class="filename">/etc/openvpn/dh2048.pem</code> نصب می‌گردند. گواهینامه‌های کلاینت هم به شیوه‌ای مشابه روی هر کلاینت VPN ذخیره می‌شوند.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.13.5.7.7"></a>10.2.1.2. پیکربندی سرور OpenVPN</h4></div></div></div><div
              class="para">
					به صورت پیش‌فرض، اسکریپت راه‌انداز OpenVPN اقدام به راه‌اندازی تمام شبکه‌های خصوصی مجازی تعریف شده در فایل <code
                class="filename">/etc/openvpn/*.conf</code> می‌کند. تنظیم یک سرور VPN به سادگی ذخیره‌سازی یک فایل پیکربندی در این دایرکتوری است. یک نقطه شروع مناسب عبارت است از <code
                class="filename">/usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz</code>، که یک سرور استاندارد را تنظیم می‌کند. البته، برخی پارامترها باید تغییر کنند: <code
                class="literal">ca</code>، <code
                class="literal">cert</code>، <code
                class="literal">key</code> و <code
                class="literal">dh</code> نیاز به تعریف مکان‌های انتخابی دارند (به ترتیب، <code
                class="literal">/etc/ssl/certs/Falcot_CA.crt</code>، <code
                class="literal">/etc/ssl/vpn.falcot.com.crt</code>، <code
                class="literal">/etc/ssl/private/vpn.falcot.com.key</code> و <code
                class="literal">/etc/openvpn/dh2048.pem</code>). عبارت <code
                class="literal">server 10.8.0.0 255.255.255.0</code> subnet مورد استفاده VPN را تعریف می‌کند؛ سرور از اولین نشانی IP در محدوده <code
                class="literal">10.8.0.1</code> استفاده می‌کند و سایر نشانی‌ها به کلاینت‌ها تخصیص داده می‌شوند.
				</div><div
              class="para">
					با این پیکربندی، اجرای OpenVPN رابط شبکه مجازی را ایجاد می‌کند، معمولا تحت عنوان <code
                class="literal">tun0</code>. اگرچه، فایروال‌ها اغلب به شیوه مشابه رابط‌های واقعی شبکه پیکربندی می‌شوند، که درست قبل از آغاز OpenVPN اتفاق می‌افتند. البته توصیه می‌شود که ابتدا یک رابط شبکه مجازی پایدار ایجاد گردد، سپس OpenVPN را مبتنی با آن تنظیم کرد. این کار امکان نامگذاری برای رابط را فراهم می‌آورد. برای اینکار، دستور <code
                class="command">openvpn --mktun --dev vpn --dev-type tun</code> یک رابط شبکه مجازی به نام <code
                class="literal">vpn</code> از نوع <code
                class="literal">tun</code> ایجاد می‌کند؛ این دستور به سادگی می‌تواند در یک اسکریپت پیکربندی فایروال یا یک دستور <code
                class="literal">up</code> در فایل <code
                class="filename">/etc/network/interfaces</code> قرار گیرد. فایل پیکربندی OpenVPN نیز مطابق آن باید بروزرسانی گردد، با استفاده از عبارت‌های <code
                class="literal">dev vpn</code> و <code
                class="literal">dev-type tun</code>.
				</div><div
              class="para">
					بدون اقدام دیگری، کلاینت‌های VPN تنها از طریق نشانی <code
                class="literal">10.8.0.1</code> می‌توانند به سرور متصل گردند. برای صادر کردن مجوز دسترسی کلاینت‌ها به شبکه محلی (192.168.0.0/24)، نیاز است که عبارت <code
                class="literal">push route 192.168.0.0 255.255.255.0</code> به فایل پیکربندی OpenVPN اضافه گردد تا کلاینت‌ها به صورت خودکار به شبکه VPN موجود متصل گردند. علاوه بر این، رایانه‌های شبکه محلی نیاز دارند در رابطه با مسیریابی از طریق سرور VPN به آن‌ها اطلاع‌رسانی گردد (زمانی که سرور VPN به gateway متصل باشد این اتفاق می‌افتد). همین طور، سرور VPN می‌تواند به منظور ماسک‌گذاری IP پیکربندی گردد (<a
                class="xref"
                href="network-infrastructure.html#sect.gateway">
      قسمت 10.1, “Gateway”
    </a> را مشاهده کنید).
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.13.5.7.8"></a>10.2.1.3. پیکربندی کلاینت OpenVPN</h4></div></div></div><div
              class="para">
					تنظیم یک کلاینت OpenVPN نیز نیازمند ایجاد یک فایل پیکربندی در <code
                class="filename">/etc/openvpn/</code> است. یک پیکربندی ساده می‌تواند مانند <code
                class="filename">/usr/share/doc/openvpn/examples/sample-config-files/client.conf</code> باشد. عبارت <code
                class="literal">remote vpn.falcot.com 1194</code> نشانی و درگاه سرور OpenVPN را مشخص می‌کند؛ <code
                class="literal">ca</code>، <code
                class="literal">cert</code> و <code
                class="literal">key</code> برای مشخص‌کردن محل فایل‌های کلید باید تعریف شوند.
				</div><div
              class="para">
					اگر نیاز به آغاز VPN هنگام راه‌اندازی اولیه نباشد، عبارت <code
                class="literal">AUTOSTART</code> را به <code
                class="literal">none</code> در فایل <code
                class="filename">/etc/default/openvpn</code> تنظیم کنید. شروع و پایان یک ارتباط VPN همیشه با استفاده از دستورات <code
                class="command">service openvpn@<em
                  class="replaceable">name</em> start</code> و <code
                class="command">service openvpn@<em
                  class="replaceable">name</em> stop</code> ممکن است (به صورتی که <em
                class="replaceable">name</em> ارتباط با نام موجود در فایل <code
                class="filename">/etc/openvpn/<em
                  class="replaceable">name</em>.conf</code> منطبق است).
				</div><div
              class="para">
					بسته <span
                class="pkg pkg">network-manager-openvpn-gnome</span> شامل یک افزونه برای مدیر شبکه است (<a
                class="xref"
                href="sect.network-config.html#sect.roaming-network-config">
      قسمت 8.2.4, “پیکربندی خودکار شبکه برای کاربران”
    </a> را مشاهده کنید) که امکان مدیریت شبکه‌های خصوصی مجازی را فراهم می‌کند. این ابزار به هر کاربر امکان پیکربندی OpenVPN را از یک رابط گرافیکی می‌دهد. <a
                id="id-1.13.5.7.8.4.3"
                class="indexterm"></a>
				</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.ssh-vpn"></a>10.2.2. VPN به همراه SSH</h3></div></div></div><a
            id="id-1.13.5.8.2"
            class="indexterm"></a><a
            id="id-1.13.5.8.3"
            class="indexterm"></a><div
            class="para">
				دو راه برای ایجاد شبکه خصوصی مجازی با استفاده از SSH وجود دارد. شیوه قدیمی‌تر شامل برقراری یک لایه PPP برفزار پیوند SSH است. این روش در یک سند جداگانه بررسی شده است: <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://www.tldp.org/HOWTO/ppp-ssh/">http://www.tldp.org/HOWTO/ppp-ssh/</a></div>
			</div><div
            class="para">
				روش دوم جدیدتر است و با انتشار نسخه ۴.۳ از OpenSSH معرفی شد؛ اکنون برای OpenSSH امکان ایجاد رابط‌های مجازی شبکه (<code
              class="literal">tun*</code>) در هر دو سمت ارتباط SSH وجود دارد و این رابط‌های مجازی می‌توانند همانند رابط‌های فیزیکی پیکربندی گردند. سیستم تونل‌‌کشی ابتدا باید با تنظیم <code
              class="literal">PermitTunnel</code> به “yes” در فایل پیکربندی سرور SSH (<code
              class="filename">/etc/ssh/sshd_config</code>) فعال گردد. هنگام برقراری ارتباط SSH، ایجاد یک تونل باید به صورت اختصاصی و با گزینه <code
              class="literal">-w any:any</code> بیان شود (<code
              class="literal">any</code> می‌تواند با شماره دستگاه <code
              class="literal">tun</code> مورد نظر جایگزین گردد). این امر نیازمند داشتن دسترسی مدیریتی برای کاربر در هر دو سمت است، همان‌طور که برای ایجاد دستگاه شبکه مورد نیاز است (به عبارت دیگر، ارتباط باید از طریق root برقرار شود).
			</div><div
            class="para">
				هر دو روش ایجاد یک شبکه خصوصی مجازی از طریق SSH بسیار سرراست هستند. اگرچه، VPN که فراهم می‌کنند عملکرد بهینه‌ای نخواهد داشت؛ به طور مشخص، به خوبی نمی‌تواند ترافیک بالا را مدیریت کند.
			</div><div
            class="para">
				توضیح اینکه هنگام قراردادن یک پشته TCP/IP در یک ارتباط TCP/IP (برای SSH)، پروتکل TCP دو بار استفاده می‌شود، یکبار برای ارتباط SSH و بار دیگر برای تونل. این کار به مشکل بر می‌خورد، به خصوص از آنجا که TCP با تغییر در زمان تاخیر بسته‌ها، خود را با شبکه منطبق می‌سازد. سایت <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://sites.inka.de/sites/bigred/devel/tcp-tcp.html">http://sites.inka.de/sites/bigred/devel/tcp-tcp.html</a></div> به جزئیات بیشتری از این مشکل می‌پردازد. VPN از طریق SSH تنها باید برای تونل‌های یک-طرفه بدون محدودیت عملکرد در نظر گرفته شود.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.ipsec"></a>10.2.3. IPsec</h3></div></div></div><a
            id="id-1.13.5.9.2"
            class="indexterm"></a><a
            id="id-1.13.5.9.3"
            class="indexterm"></a><a
            id="id-1.13.5.9.4"
            class="indexterm"></a><div
            class="para">
				IPsec، بر خلاف استاندارد بودن در IP ٰVPN، بیشتر در پیاده‌سازی آن نقش دارد. موتور IPsec در کرنل لینوکس قرار دارد؛ قسمت‌های مورد نظر فضای-کاربر، ابزارهای پیکربندی و کنترل توسط بسته <span
              class="pkg pkg">ipsec-tools</span> فراهم شده‌اند. در حقیقت، هر فایل <code
              class="filename">/etc/ipsec-tools.conf</code> شامل پارامترهای <span
              class="emphasis"><em>IPsec tunnels</em></span> (یا <span
              class="emphasis"><em>Security Associations</em></span> در واژگان IPsec) است که میزبان با آن ارتباط دارد؛ اسکریپت <code
              class="command">/etc/init.d/setkey</code> روشی برای آغاز و پایان یک تونل فراهم می‌کند (هر تونل یک پیوند امن به میزبان دیگری است که به شبکه خصوصی مجازی متصل است). این فایل می‌تواند به صورت دستی از مستندات موجود در صفحه راهنمای <span
              class="citerefentry"><span
                class="refentrytitle">setkey</span>(8)</span> ساخته شود. البته، نوشتن پارامترهای تمام میزبان‌ها در یک مجموعه بزرگ از رایانه‌ها به آرامی به فرآیندی دشوار تبدیل می‌شود، چرا که تعداد تونل‌ها به سرعت افزایش می‌یابند. نصب یک فرآیند پس‌زمینه IKE (که مخفف <span
              class="emphasis"><em>IPsec Key Exchange</em></span> است) مانند <span
              class="pkg pkg">racoon</span> یا <span
              class="pkg pkg">strongswan</span> به ساده‌تر شدن کار مدیریت آن‌ها به صورت مرکزی و امن‌تر شدن آن‌ها با بایگانی‌های متعدد منجز می‌شود.
			</div><a
            id="id-1.13.5.9.6"
            class="indexterm"></a><a
            id="id-1.13.5.9.7"
            class="indexterm"></a><a
            id="id-1.13.5.9.8"
            class="indexterm"></a><a
            id="id-1.13.5.9.9"
            class="indexterm"></a><div
            class="para">
				علی رغم وضعیت IPsec به عنوان یک راه حل جامع، پیچیدگی تنظیم آن در واقع منجر به کاهش استفاده‌اش می‌گردد. راه‌حل‌های مبتنی بر OpenVPN زمانی که تعداد تونل‌ها زیاد یا پویا نباشند ترجیخ داده می‌شوند.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>احتیاط</em></span> IPsec و NAT</strong></p></div></div></div><div
              class="para">
				NATکردن فایروال و IPsec به خوبی با یکدیگر کار نمی‌کنند: از آنجا که IPsec بسته‌ها را امضا کرده، هر تغییری احتمالی روی این بسته‌ها توسط فایروال منجر به باطل‌شدن امضا می‌گردد و بسته‌ها در مقصد تحویل داده نمی‌شوند. بسیاری از پیاده‌سازی‌های IPsec اکنون با شامل شدن تکنیک <span
                class="emphasis"><em>NAT-T</em></span> (به معنی <span
                class="emphasis"><em>NAT Traversal</em></span>) با قراردادن بسته IPsec در یک بسته استاندارد UDP به این مشکل رسیدگی می‌کنند.
			</div><a
              id="id-1.13.5.9.11.3"
              class="indexterm"></a><a
              id="id-1.13.5.9.11.4"
              class="indexterm"></a></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>امنیت</em></span> IPsec و فایروال‌ها</strong></p></div></div></div><div
              class="para">
				حالت استاندارد عملیات IPsec شامل تبادل داده روی درگاه ۵۰۰ UDP برای تبادل کلید (یا درگاه ۴۵۰۰ UDP در صورت استفاده از NAT-T) است. علاوه بر این، بسته‌های IPsec از دو پروتکل اختصاصی IP استفاده می‌کنند که فایروال باید اجازه عبور آن‌ها را صادر کند؛ دریافت این بسته‌ها بر اساس شماره پروتکل آن‌ها است یعنی ۵۰ برای ESP و ۵۱ برای AH.
			</div><a
              id="id-1.13.5.9.12.3"
              class="indexterm"></a><a
              id="id-1.13.5.9.12.4"
              class="indexterm"></a><a
              id="id-1.13.5.9.12.5"
              class="indexterm"></a><a
              id="id-1.13.5.9.12.6"
              class="indexterm"></a></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.pptp"></a>10.2.4. PPTP</h3></div></div></div><div
            class="para">
				PPTP که مخفف <span
              class="emphasis"><em>Point-to-Point Tunneling Protocol</em></span> است از دو کانال ارتباطی استفاده می‌کند، یکی برای کنترل داده و دیگری برای تبادل آن؛ کانال دوم از پروتکل GRE یا <span
              class="emphasis"><em>Generic Routing Encapsulation</em></span> استفاده می‌کند. سپس یک پیوند استاندارد PPP از طریق کانال اول صورت می‌گیرد.
			</div><a
            id="id-1.13.5.10.3"
            class="indexterm"></a><a
            id="id-1.13.5.10.4"
            class="indexterm"></a><a
            id="id-1.13.5.10.5"
            class="indexterm"></a><a
            id="id-1.13.5.10.6"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.pptp-config-client"></a>10.2.4.1. پیکربندی کلاینت</h4></div></div></div><div
              class="para">
					بسته <span
                class="pkg pkg">pptp-linux</span> شامل یک کلاینت PPTP است که به راحتی برای کلاینت تنظیم می‌گردد. دستورالعمل پیش رو بر اساس مستندات رسمی آن الهام گرفته شده است: <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://pptpclient.sourceforge.net/howto-debian.phtml">http://pptpclient.sourceforge.net/howto-debian.phtml</a></div>
				</div><a
              id="id-1.13.5.10.7.3"
              class="indexterm"></a><div
              class="para">
					مدیرسیستم‌های فالکوت فایل‌های متعددی ایجاد کرده‌اند: <code
                class="filename">/etc/ppp/options.pptp</code>، <code
                class="filename">/etc/ppp/peers/falcot</code>، <code
                class="filename">/etc/ppp/ip-up.d/falcot</code> و <code
                class="filename">/etc/ppp/ip-down.d/falcot</code>.
				</div><div
              class="example"><a
                xmlns=""
                id="example.ppp-options.pptp"></a><p
                class="title"><strong>
      مثال 10.2. فایل <code
                    class="filename">/etc/ppp/options.pptp</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# PPP options used for a PPTP connection
lock
noauth
nobsdcomp
nodeflate</pre></div></div><div
              class="example"><a
                xmlns=""
                id="example.ppp-peers-falcot"></a><p
                class="title"><strong>
      مثال 10.3. فایل <code
                    class="filename">/etc/ppp/peers/falcot</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# vpn.falcot.com is the PPTP server
pty "pptp vpn.falcot.com --nolaunchpppd"
# the connection will identify as the "vpn" user
user vpn
remotename pptp
# encryption is needed
require-mppe-128
file /etc/ppp/options.pptp
ipparam falcot</pre></div></div><div
              class="example"><a
                xmlns=""
                id="example.ppp-ip-up.d-falcot"></a><p
                class="title"><strong>
      مثال 10.4. فایل <code
                    class="filename">/etc/ppp/ip-up.d/falcot</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Create the route to the Falcot network
if [ "$6" = "falcot" ]; then
  # 192.168.0.0/24 is the (remote) Falcot network
  route add -net 192.168.0.0 netmask 255.255.255.0 dev $1
fi</pre></div></div><div
              class="example"><a
                xmlns=""
                id="example.ppp-ip-down.d-falcot"></a><p
                class="title"><strong>
      مثال 10.5. فایل <code
                    class="filename">/etc/ppp/ip-down.d/falcot</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Delete the route to the Falcot network
if [ "$6" = "falcot" ]; then
  # 192.168.0.0/24 is the (remote) Falcot network
  route del -net 192.168.0.0 netmask 255.255.255.0 dev $1
fi</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>امنیت</em></span> MPPE</strong></p></div></div></div><div
                class="para">
					امن‌کردن PPTP مستلزم استفاده از ویژگی MPPE یا <span
                  class="emphasis"><em>Microsoft Point-to-Point Encryption</em></span> است، که در کرنل‌های رسمی دبیان به عنوان یک ماژول موجود است.
				</div><a
                id="id-1.13.5.10.7.9.3"
                class="indexterm"></a><a
                id="id-1.13.5.10.7.9.4"
                class="indexterm"></a></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.pptp-config-serveur"></a>10.2.4.2. پیکربندی سرور</h4></div></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>احتیاط</em></span> PPTP و فایروال‌ها</strong></p></div></div></div><div
                class="para">
					فایروال‌های میانی باید طوری پیکربندی شوند که اجازه عبور بسته‌های IP با استفاده از پروتکل ۴۷ GRE را داشته باشند. علاوه بر این، درگاه ۱۷۲۳ از سرور PPTP به منظور برقراری کانال ارتباطی باید باز باشند.
				</div></div><div
              class="para">
					<code
                class="command">pptpd</code> سرور PPTP برای لینوکس است. فایل اصلی پیکربندی آن، <code
                class="filename">/etc/pptpd.conf</code>، نیاز به تغییرات اندکی دارد: <span
                class="emphasis"><em>localip</em></span> (نشانی محلی) و <span
                class="emphasis"><em>remoteip</em></span> (نشانی راه‌دور). در نمونه زیر، سرور PPTP همیشه از نشانی <code
                class="literal">192.168.0.199</code> استفاده می‌کند و کلاینت‌ها نیز نشانی خود را بین بازه <code
                class="literal">192.168.0.200</code> تا <code
                class="literal">192.168.0.250</code> دریافت می‌کنند.
				</div><div
              class="example"><a
                xmlns=""
                id="example.pptpd.conf"></a><p
                class="title"><strong>
      مثال 10.6. فایل <code
                    class="filename">/etc/pptpd.conf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# TAG: speed
#
#       Specifies the speed for the PPP daemon to talk at.
#
speed 115200

# TAG: option
#
#       Specifies the location of the PPP options file.
#       By default PPP looks in '/etc/ppp/options'
#
option /etc/ppp/pptpd-options

# TAG: debug
#
#       Turns on (more) debugging to syslog
#
# debug

# TAG: localip
# TAG: remoteip
#
#       Specifies the local and remote IP address ranges.
#
#       You can specify single IP addresses separated by commas or you can
#       specify ranges, or both. For example:
#
#               192.168.0.234,192.168.0.245-249,192.168.0.254
#
#       IMPORTANT RESTRICTIONS:
#
#       1. No spaces are permitted between commas or within addresses.
#
#       2. If you give more IP addresses than MAX_CONNECTIONS, it will
#          start at the beginning of the list and go until it gets
#          MAX_CONNECTIONS IPs. Others will be ignored.
#
#       3. No shortcuts in ranges! ie. 234-8 does not mean 234 to 238,
#          you must type 234-238 if you mean this.
#
#       4. If you give a single localIP, that's ok - all local IPs will
#          be set to the given one. You MUST still give at least one remote
#          IP for each simultaneous client.
#
#localip 192.168.0.234-238,192.168.0.245
#remoteip 192.168.1.234-238,192.168.1.245
#localip 10.0.1.1
#remoteip 10.0.1.2-100
localip 192.168.0.199
remoteip 192.168.0.200-250</pre></div></div><div
              class="para">
					پیکربندی PPP مورد استفاده سرور PPTP نیازمند برخی تغییرات در <code
                class="filename">/etc/ppp/pptpd-options</code> است. پارامترهای مهم عبارتند از نام سرور (<code
                class="literal">pptp</code>)، نام دامنه (<code
                class="literal">بشمزخف.زخپ</code>) و نشانی‌های IP برای سرورهای DNS و WINS.
				</div><div
              class="example"><a
                xmlns=""
                id="example.ppp-pptpd-options"></a><p
                class="title"><strong>
      مثال 10.7. فایل <code
                    class="filename">/etc/ppp/pptpd-options</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
## turn pppd syslog debugging on
#debug

## change 'servername' to whatever you specify as your server name in chap-secrets
name pptp
## change the domainname to your local domain
domain falcot.com

## these are reasonable defaults for WinXXXX clients
## for the security related settings
# The Debian pppd package now supports both MSCHAP and MPPE, so enable them
# here. Please note that the kernel support for MPPE must also be present!
auth
require-chap
require-mschap
require-mschap-v2
require-mppe-128

## Fill in your addresses
ms-dns 192.168.0.1
ms-wins 192.168.0.1

## Fill in your netmask
netmask 255.255.255.0

## some defaults
nodefaultroute
proxyarp
lock</pre></div></div><div
              class="para">
					آخرین گام ثبت کاربر <code
                class="literal">vpn</code> و گذرواژه مربوط به آن در فایل <code
                class="filename">/etc/ppp/chap-secrets</code> است. بر خلاف مواقعی که کاراکتر ستاره (<code
                class="literal">*</code>) کار می‌کرد، نام سرور مشخصا باید در این قسمت درج شود. علاوه بر این، کلاینت‌های PPTP در ویندوز خود را به صورت <code
                class="literal"><em
                  class="replaceable">DOMAIN</em>\\<em
                  class="replaceable">USER</em></code> معرفی می‌کنند به جای اینکه تنها نام کاربری را نشان دهند. به همین دلیل است که فایل به کاربر <code
                class="literal">FALCOT\\vpn</code> اشاره کرده است. همچنین امکان اختصاص نشانی‌های IP انفرادی برای هر کاربر وجود دارد؛ یک کاراکتر ستاره در این قسمت به معنای استفاده از نشانی‌های پویا است.
				</div><div
              class="example"><a
                xmlns=""
                id="example.ppp-chap-secrets"></a><p
                class="title"><strong>
      مثال 10.8. فایل <code
                    class="filename">/etc/ppp/chap-secrets</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Secrets for authentication using CHAP
# client        server  secret      IP addresses
vpn             pptp    f@Lc3au     *
FALCOT\\vpn     pptp    f@Lc3au     *</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>امنیت</em></span> آسیب‌پذیری‌های PPTP</strong></p></div></div></div><div
                class="para">
					اولین پیاده‌سازی PPTP از مایکروسافت باعث انتقادات بسیاری شد چرا که آسیب‌پذیری‌های امنیتی زیادی را شامل می‌شد؛ اکثر آن‌ها با انتشارهای بعدی برطرف شدند. پیکربندی که در این قسمت توضیح داده شد از آخرین نسخه این پروتکل استفاده می‌کند. آگاه باشید که حذف کردن برخی گزینه‌ها (مانند <code
                  class="literal">require-mppe-128</code> و <code
                  class="literal">require-mschap-v2</code>) به آسیب‌پذیری مجدد سروس منجر می‌شوند.
				</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="network-infrastructure.html"><strong>قبلی</strong>
      فصل 10. زیرساخت شبکه</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>بالا</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>خانه</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.quality-of-service.html"><strong>بعدی</strong>10.3. کیفیت سرویس</a></li></ul></body></html>
