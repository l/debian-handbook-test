<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">5.2. Метаинформация пакета</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ru-RU-1.0-1" /><meta
        name="keywords"
        content="Двоичный пакет, Пакет исходных кодов, dpkg, зависимости, конфликт" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="packaging-system.html"
        title="Глава 5. Пакетная система: Инструменты и основные принципы" /><link
        rel="prev"
        href="packaging-system.html"
        title="Глава 5. Пакетная система: Инструменты и основные принципы" /><link
        rel="next"
        href="sect.source-package-structure.html"
        title="5.3. Структура исходного пакета" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ru-RU/stable/sect.package-meta-information.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="packaging-system.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.source-package-structure.html"><strong>След.</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.package-meta-information"></a>5.2. Метаинформация пакета</h2></div></div></div><a
          id="id-1.8.6.2"
          class="indexterm"></a><a
          id="id-1.8.6.3"
          class="indexterm"></a><div
          class="para">
			Пакет Debian является не только архивом файлов, предназначенных для установки. Он является частью системы, и в нём описаны взаимоотношения с другими пакетами Debian (зависимости, конфликты, предложения). Он также содержит сценарии, которые выполняются на различных этапах жизненного цикла пакета (при установке, удалении, обновлении). Эти данные, используемые инструментами управления пакетами, не являются частью упакованного программного обеспечения, но содержатся внутри пакета и называются «метаинформацией» (информацией о другой информации).
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.control"></a>5.2.1. Описание: файл <code
                    class="filename">control</code></h3></div></div></div><a
            id="id-1.8.6.5.2"
            class="indexterm"></a><a
            id="id-1.8.6.5.3"
            class="indexterm"></a><a
            id="id-1.8.6.5.4"
            class="indexterm"></a><div
            class="para">
				Структура этого файла похожа на заголовки e-mail (как они определены в RFC 2822). Например, для <span
              class="pkg pkg">apt</span> файл <code
              class="filename">control</code> выглядит следующим образом:
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>apt-cache show apt</code></strong>
<code
              class="computeroutput">Package: apt
Version: 0.9.7.9+deb7u1
Installed-Size: 3271
Maintainer: APT Development Team &lt;deity@lists.debian.org&gt;
Architecture: amd64
Replaces: manpages-pl (&lt;&lt; 20060617-3~)
Depends: libapt-pkg4.12 (&gt;= 0.9.7.9), libc6 (&gt;= 2.4), libgcc1 (&gt;= 1:4.1.1), libstdc++6 (&gt;= 4.6), debian-archive-keyring, gnupg
Suggests: aptitude | synaptic | wajig, dpkg-dev, apt-doc, xz-utils, python-apt
Conflicts: python-apt (&lt;&lt; 0.7.93.2~)
Description-ru: менеджер пакетов с интерфейсом командной строки
 Этот пакет содержит инструменты командной строки для поиска и
 управления пакетами, а также запроса информации о пакетах путём
 низкоуровневого доступа ко всем возможностям библиотеки
 libapt-pkg.
 .
 Включены следующие инструменты:
  * apt-get для получения пакетов и информации о них из
    достоверных источников и для установки, обновления и удаления
    пакетов вместе с их зависимостями
  * apt-cache для запроса доступной информации об установленных и
    доступных для установки пакетов
  * apt-cdrom для использования внешних носителей информации в
    качестве источников пакетов
  * apt-config в качестве интерфейса для настройки параметров
  * apt-key в качестве интерфейса для управления ключами для
    проверки ключей аутентификации
Description-md5: 9fb97a88cb7383934ef963352b53b4a7
Tag: admin::package-management, hardware::storage, hardware::storage:cd,
 implemented-in::c++, interface::commandline, network::client,
 protocol::ftp, protocol::http, protocol::ipv6, role::program,
 suite::debian, use::downloading, use::searching,
 works-with::software:package
Section: admin
Priority: important
Filename: pool/main/a/apt/apt_0.9.7.9+deb7u1_amd64.deb
Size: 1258056
MD5sum: f403a84515c37e3232b7fcf9664c3e30
SHA1: abe3610c4c619eccacc8bc985369c780189e9958
SHA256: 8f2ada8ed29831ae97264d5ce51410755b25f940c277eacacfe6803cc3ae7540</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>К ОСНОВАМ</em></span> RFC — стандарты Интернета</strong></p></div></div></div><a
              id="id-1.8.6.5.7.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.7.3"
              class="indexterm"></a><div
              class="para">
				RFC — это аббревиатура, означающая «Request For Comments» или, по-русски, «Рабочее предложение». RFC представляет собой технический документ, в котором описано, чему предстоит стать стандартом Интернета. Перед окончательным утверждением и прекращением внесения изменений стандарты публикуются для общественного рассмотрения (отсюда их название). IETF (Internet Engineering Task Force) принимает решение о статусе этих документов (предлагаемый стандарт, проект стандарта или стандарт).
			</div><div
              class="para">
				RFC 2026 определяет процесс стандартизации интернет-протоколов. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc2026.html">http://www.faqs.org/rfcs/rfc2026.html</a></div>
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.5.8"></a>5.2.1.1. Зависимости: поле <code
                      class="literal">Depends</code></h4></div></div></div><a
              id="id-1.8.6.5.8.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.8.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.8.4"
              class="indexterm"></a><div
              class="para">
					Зависимости определяются в поле <code
                class="literal">Depends</code> в заголовке пакета. Это список условий, выполнение которых необходимо для корректной работы пакета. Данная информация используется такими инструментами, как <code
                class="command">apt</code>, чтобы установить правильные версии необходимых библиотек, которые удовлетворяют зависимости устанавливаемого пакета. Для каждой зависимости диапазон версий, соответствующих этому условию, может быть ограничен. Другими словами, можно сказать, что нам требуется пакет <span
                class="pkg pkg">libc6</span> версии не ниже чем «2.15» (пишется «<code
                class="command">libc6 (&gt;= 2.15)</code>»). Операторы сравнения версий следующие:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&lt;&lt;</code>: меньше;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&lt;=</code>: меньше или равна;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">=</code>: равна (однако «<code
                      class="literal">2.6.1</code>» — не то же самое, что и «<code
                      class="literal">2.6.1-1</code>»);
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&gt;=</code>: больше или равна;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&gt;&gt;</code>: больше.
						</div></li></ul></div><div
              class="para">
					В списке условий запятая играет роль разделителя. Её следует интерпретировать как логическое «и». Внутри условий вертикальная черта («|») означает логическое «или» (включающее «или», а не исключающее «строго одно из»). Поскольку оно имеет более высокий приоритет, чем «и», его можно использовать столько раз, сколько потребуется. Так, зависимость «(A или B) и C» записывается в виде <code
                class="command">A | B, C</code>. Напротив, выражение «A или (B и C)» следует записывать как «(A или B) и (A или C)», поскольку поле <code
                class="literal">Depends</code> не допускает использования скобок, меняющих порядок приоритетов между логическими операторами «или» и «и». То есть должно писаться <code
                class="command">A | B, A | C</code>. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.debian.org/doc/debian-policy/ch-relationships.html">http://www.debian.org/doc/debian-policy/ch-relationships.html</a></div>
				</div><a
              id="id-1.8.6.5.8.8"
              class="indexterm"></a><div
              class="para">
					Система зависимостей — хороший механизм для обеспечения работоспособности программ, но у него есть и другое применение — «метапакеты». Это пустые пакеты, в которых описаны только зависимости. Они обеспечивают установку группы взаимосвязанных программ, выбранных сопровождающим метапакета; соответственно, <code
                class="command">apt install <em
                  class="replaceable">метапакет</em></code> автоматически установит все эти программы, используя зависимости метапакета. Пакеты <span
                class="pkg pkg">gnome</span>, <span
                class="pkg pkg">kde-full</span> и <span
                class="pkg pkg">linux-image-amd64</span> являются примерами метапакетов.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ПОЛИТИКА DEBIAN</em></span> <code
                          class="literal">Pre-Depends</code>,более требовательное <code
                          class="literal">Depends</code></strong></p></div></div></div><a
                id="id-1.8.6.5.8.10.2"
                class="indexterm"></a><a
                id="id-1.8.6.5.8.10.3"
                class="indexterm"></a><div
                class="para">
					«Предварительные зависимости», перечисленные в поле «<code
                  class="literal">Pre-Depends</code>» заголовков пакетов, дополняют обычные зависимости; их синтаксис аналогичен. Обычная зависимость показывает, что пакет должен быть распакован и настроен до настройки зависимого пакета. Предварительная зависимость оговаривает, что пакет должен быть распакован и настроен до запуска предустановочного сценария пакета, для которого указана предварительная зависимость, то есть до его установки.
				</div><div
                class="para">
					Предварительная зависимость очень требовательна к <code
                  class="command">apt</code>, поскольку добавляет строгие ограничения на порядок установки пакетов. Поэтому использование предварительных зависимостей без крайней необходимости не поощряется. Более того, перед добавлением предварительной зависимости рекомендовано проконсультироваться с другими разработчиками в <code
                  class="email"><a
                    class="email"
                    href="mailto:debian-devel@lists.debian.org">debian-devel@lists.debian.org</a></code>. Как правило удаётся найти другое решение или обходной путь.
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ПОЛИТИКА DEBIAN</em></span> Поля <code
                          class="literal">Recommends</code>, <code
                          class="literal">Suggests</code> и <code
                          class="literal">Enhances</code></strong></p></div></div></div><a
                id="id-1.8.6.5.8.11.2"
                class="indexterm"></a><a
                id="id-1.8.6.5.8.11.3"
                class="indexterm"></a><div
                class="para">
					В полях <code
                  class="literal">Recommends</code> и <code
                  class="literal">Suggests</code> указываются зависимости, не являющиеся обязательными. «Рекомендуемые» зависимости, более важные, значительно улучшают функциональность, предоставляемую пакетом, но не являются совершенно необходимыми для его работы. «Предлагаемые» зависимости, следующие по значимости, означают, что некоторые пакеты могут дополнить устанавливаемый или быть полезными в связке с ним, но вполне целесообразной будет и установка одного без других.
				</div><div
                class="para">
					Следует всегда устанавливать «рекомендуемые» пакеты, если вы только не знаете абсолютно точно, почему они вам не нужны. И наоборот, нет смысла устанавливать «предлагаемые» пакеты, если вы не знаете, зачем они вам нужны.
				</div><a
                id="id-1.8.6.5.8.11.6"
                class="indexterm"></a><div
                class="para">
					В поле <code
                  class="literal">Enhances</code> также указывается предложение, но другого рода. Оно на самом деле находится в предлагаемом пакете, а не в пакете, который выиграет от такого предложения. Смысл этого в том, что становится возможным добавить предложение, не меняя затрагиваемый пакет. Так, все дополнения, плагины и прочие расширения программы смогут появиться в списке предложений, относящихся к программе. Хотя оно существует уже несколько лет, это поле до сих пор по большей части игнорируется такими программами, как <code
                  class="command">apt</code> и <code
                  class="command">synaptic</code>. Смысл этого в том, чтобы предложения, вносимые через поле <code
                  class="literal">Enhances</code>, отображались пользователю в дополнение к обычным предложениям — тем, которые находятся в поле <code
                  class="literal">Suggests</code>.
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.5.9"></a>5.2.1.2. Конфликты: поле <code
                      class="literal">Conflicts</code></h4></div></div></div><a
              id="id-1.8.6.5.9.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.9.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.9.4"
              class="indexterm"></a><div
              class="para">
					Поле <code
                class="literal">Conflicts</code> указывает на то, что пакет не может быть установлен, если уже установлен другой пакет. Наиболее распространенными причинами для этого является включение обоими пакетами файлов с одинаковыми именами, или предоставление сервисов на одном и том же порту TCP, или мешающих работе друг друга.
				</div><div
              class="para">
					<code
                class="command">dpkg</code> откажется установить пакет, если он вызовет конфликт с уже установленным пакетом, за исключением тех случаев, когда новый пакет указывает, что он будет «заменять» установленный пакет, — тогда <code
                class="command">dpkg</code> заменит старый пакет на новый. <code
                class="command">apt</code> всегда следует вашим указаниям: если вы выберете установку нового пакета, он автоматически предложит удалить проблемный пакет.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.5.10"></a>5.2.1.3. Несовместимость: поле <code
                      class="literal">Breaks</code></h4></div></div></div><a
              id="id-1.8.6.5.10.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.10.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.10.4"
              class="indexterm"></a><div
              class="para">
					По своему действию поля <code
                class="literal">Breaks</code> похоже на поле <code
                class="literal">Conflicts</code>, но оно несёт особый смысл. Оно сообщает, что установка пакета «поломает» другой пакет (или конкретные его версии). Как правило, такая несовместимость между пакетами имеет временный характер, и <code
                class="literal">Breaks</code> указывает на конкретные несовместимые версии.
				</div><div
              class="para">
					<code
                class="command">dpkg</code> откажется установить пакет, который поломает уже установленный пакет, и <code
                class="command">apt</code> попытается решить проблему путём обновления пакета, который оказался бы сломанным, до более новой версии (которая, как предполагается, будет исправленной и, таким образом, снова совместимой).
				</div><div
              class="para">
					Подобные ситуации могут возникнуть в случае обновления без обратной совместимости: это происходит, если новая версия работает не так, как старая, что приводит к сбою в другой программе, если не принять должных мер. Поле <code
                class="literal">Breaks</code> помогает пользователю не сталкиваться с такими проблемами.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.5.11"></a>5.2.1.4. Предоставляемое пакетом: поле <code
                      class="literal">Provides</code></h4></div></div></div><a
              id="id-1.8.6.5.11.2"
              class="indexterm"></a><div
              class="para">
					Это поле вводит очень интересную концепцию «виртуального пакета». Она имеет много применений, два из которых особенно важны. Первое состоит в использовании виртуального пакета, чтобы привязать к нему общее название сервиса (пакет «предоставляет» сервис). Вторая показывает, что пакет полностью заменяет другой, и что при этом он может удовлетворять зависимости, которые удовлетворил бы другой. Таким образом, можно создать замену пакета без необходимости использовать то же самое имя пакета.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>СЛОВАРЬ</em></span> Метапакет и виртуальный пакет</strong></p></div></div></div><a
                id="id-1.8.6.5.11.4.2"
                class="indexterm"></a><a
                id="id-1.8.6.5.11.4.3"
                class="indexterm"></a><a
                id="id-1.8.6.5.11.4.4"
                class="indexterm"></a><div
                class="para">
					Очень важно четко понимать различие между метапакетами и виртуальными пакетами. Первые являются настоящими пакетами (то есть файлами <code
                  class="filename">.deb</code>), единственное назначение которых состоит в том, чтобы сообщить о зависимостях.
				</div><div
                class="para">
					Виртуальные пакеты, напротив, не существует физически; они являются только средством идентификации реальных пакетов на основании общих, логических критериев (предоставляемого сервиса, совместимости со стандартной программой или ранее созданным пакетом и т. д.).
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.8.6.5.11.5"></a>5.2.1.4.1. Предоставление «сервиса»</h5></div></div></div><div
                class="para">
						Давайте рассмотрим первый случай более подробно на примере: все почтовые серверы, такие как <span
                  class="pkg pkg">postfix</span> или <span
                  class="pkg pkg">sendmail</span>, «предоставляют» виртуальный пакет <span
                  class="pkg pkg">mail-transport-agent</span>. Поэтому в любом пакете, для работы которого нужен этот сервис (например менеджере списков рассылки вроде <span
                  class="pkg pkg">smartlist</span> или <span
                  class="pkg pkg">sympa</span>), просто указывается зависимость от <span
                  class="pkg pkg">mail-transport-agent</span> вместо того, чтобы указывать большой, и при этом всё равно неполный список возможных решений (то есть <code
                  class="command">postfix | sendmail | exim4 | …</code>). Кроме того, бесполезно устанавливать два почтовых сервера на одной машине, поэтому каждый из этих пакетов сообщит о конфликте с виртуальным пакетом <span
                  class="pkg pkg">mail-transport-agent</span>. Конфликт пакета с самим собой игнорируется системой, но данная технология не допустит установки двух почтовых серверов одновременно.
					</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>ПОЛИТИКА DEBIAN</em></span> Список виртуальных пакетов</strong></p></div></div></div><a
                  id="id-1.8.6.5.11.5.3.2"
                  class="indexterm"></a><div
                  class="para">
						Чтобы от виртуального пакета была польза, все должны прийти к соглашению о его имени. Именно поэтому имена стандартизированы в политике Debian. Список, помимо всего прочего, включает в себя <span
                    class="pkg pkg">mail-transport-agent</span> для почтовых серверов, <span
                    class="pkg pkg">c-compiler</span> для компиляторов языка программирования C, <span
                    class="pkg pkg">www-browser</span> для веб-браузеров, <span
                    class="pkg pkg">httpd</span> для веб-серверов, <span
                    class="pkg pkg">ftp-server</span> для FTP-серверов, <span
                    class="pkg pkg">x-terminal-emulator</span> для эмуляторов терминала в графическом режиме (<code
                    class="command">xterm</code>) и <span
                    class="pkg pkg">x-window-manager</span> для оконных менеджеров.
					</div><div
                  class="para">
						Полный список можно найти в Сети: <div
                    xmlns=""
                    class="url">→ <a
                      xmlns="http://www.w3.org/1999/xhtml"
                      href="http://www.debian.org/doc/packaging-manuals/virtual-package-names-list.txt">http://www.debian.org/doc/packaging-manuals/virtual-package-names-list.txt</a></div>
					</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.8.6.5.11.6"></a>5.2.1.4.2. Взаимозаменяемость другим пакетом</h5></div></div></div><div
                class="para">
						Поле <code
                  class="literal">Provides</code> также полезно в случаях, когда содержание пакета включается в состав другого, более крупного пакета. Например модуль Perl <span
                  class="pkg pkg">libdigest-md5-perl</span> был необязательным в Perl 5.6, но стал стандартным в Perl 5.8 (и более поздних версиях, в частности 5.20, входящей в <span
                  class="distribution distribution">Jessie</span>). Поэтому в пакете <span
                  class="pkg pkg">perl</span>, начиная с версии 5.8, указывается <code
                  class="literal">Provides: libdigest-md5-perl</code>, чтобы зависимости от этого пакета были удовлетворены при установке Perl версии 5.8 (или новее). Сам пакет <span
                  class="pkg pkg">libdigest-md5-perl</span> в конечном итоге был удален, поскольку после удаления старых версий Perl в нём не стало смысла.
					</div><div
                class="figure"><a
                  xmlns=""
                  id="id-1.8.6.5.11.6.3"></a><div
                  class="figure-contents"><div
                    class="mediaobject"><img
                      src="images/virtual-package.png"
                      alt="Использование поля Provides для того, чтобы не нарушать зависимости" /></div></div><p
                  class="title"><strong>Рисунок 5.1. Использование поля <code
                      class="literal">Provides</code> для того, чтобы не нарушать зависимости</strong></p></div><div
                class="para">
						Эта функция очень полезна, поскольку никогда нельзя предвидеть превратности процесса разработки, и важно иметь возможность подстроиться к переименованию устаревшего ПО или другим автоматическим заменам.
					</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>К ОСНОВАМ</em></span> Perl, язык программирования</strong></p></div></div></div><a
                  id="id-1.8.6.5.11.6.5.2"
                  class="indexterm"></a><a
                  id="id-1.8.6.5.11.6.5.3"
                  class="indexterm"></a><div
                  class="para">
						Perl (<span
                    class="foreignphrase"><em
                      class="foreignphrase">Practical Extraction and Report Language</em></span> — практический язык для извлечения данных и составления отчётов) — очень популярный язык программирования. Для него существует много готовых к использованию модулей для широкого спектра задач, которые распространяются с помощью серверов CPAN (<span
                    class="foreignphrase"><em
                      class="foreignphrase">Comprehensive Perl Archive Network</em></span> — всеобъемлющая сеть архивов Perl), исчерпывающей сети пакетов Perl. <div
                    xmlns=""
                    class="url">→ <a
                      xmlns="http://www.w3.org/1999/xhtml"
                      href="http://www.perl.org/">http://www.perl.org/</a></div> <div
                    xmlns=""
                    class="url">→ <a
                      xmlns="http://www.w3.org/1999/xhtml"
                      href="http://www.cpan.org/">http://www.cpan.org/</a></div>
					</div><div
                  class="para">
						Так как это интерпретируемый язык, программа, написанная на Perl, не требуют компиляции перед выполнением. Поэтому они называются «сценариями Perl».
					</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.8.6.5.11.7"></a>5.2.1.4.3. Прошлые ограничения</h5></div></div></div><div
                class="para">
						Виртуальные пакеты имеют некоторые ограничения, cамым значительным из которых является отсутствие номера версии. Вернемся к предыдущему примеру: зависимость, такая как <code
                  class="literal">Depends: libdigest-md5-perl (&gt;= 1.6)</code>, несмотря на наличие Perl 5.10, никогда не будет считаться удовлетворённой системой управления пакетами — в то время как на самом деле она скорее всего удовлетворена. Не зная этого, пакетная система выбирает наименее опасный путь, предполагая, что версии не соответствуют.
					</div><div
                class="para">
						Это ограничение было снято в <span
                  class="pkg pkg">dpkg</span> версии 1.17.11 и более не актуально для Jessie. Пакеты могут назначать версию предоставляемым ими виртуальным пакетам при помощи зависимости, например: <code
                  class="literal">Provides: libdigest-md5-perl (= 1.8)</code>.
					</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.5.12"></a>5.2.1.5. Замена файлов: поле <code
                      class="literal">Replaces</code></h4></div></div></div><a
              id="id-1.8.6.5.12.2"
              class="indexterm"></a><a
              id="id-1.8.6.5.12.3"
              class="indexterm"></a><a
              id="id-1.8.6.5.12.4"
              class="indexterm"></a><div
              class="para">
					Поле <code
                class="literal">Replaces</code> указывает, что пакет содержит файлы, которые также присутствуют в другом пакете, но при этом пакет имеет право заменить их. Без этого поля <code
                class="command">dpkg</code> завершится с ошибкой, сообщив, что не может перезаписать файлы другого пакета (формально, можно заставить его сделать это с помощью опции <code
                class="literal">--force-overwrite</code>, но это не является обоснованной стандартной операцией). Это позволяет выявить потенциальные проблемы и вынуждает сопровождающего изучить вопрос прежде чем добавлять такое поле.
				</div><div
              class="para">
					Это поле используется при изменении имени пакета, или когда один пакет включается в состав другого. Это также происходит в случае, если сопровождающий решает распределить файлы по-другому между двоичными пакетами, полученными из одного и того же исходного: заменённый файл больше не принадлежит старому пакету, а только новому.
				</div><div
              class="para">
					Если все файлы в установленном пакете были заменены, принимается решение об удалении пакета. Наконец, это поле также указывает <code
                class="command">dpkg</code> удалить заменённый пакет в случае конфликта.
				</div><div
              class="sidebar"><a
                xmlns=""
                id="sidebar.debtags"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Поле <code
                          class="literal">Tag</code></strong></p></div></div></div><div
                class="para">
					В приведенном выше примере <span
                  class="pkg pkg">apt</span> можно заметить еще не рассмотренное нами поле <code
                  class="literal">Tag</code>. Это поле не описывает какую-либо связь между пакетами. Это просто способ отнести пакет к той или иной тематической категории. Такая классификация пакетов по нескольким критериям (тип интерфейса, язык программирования, область применения и т. д.) существует уже давно. Несмотря на это, не все пакеты имеют точные теги, и она интегрирована еще не во все инструменты Debian; <code
                  class="command">aptitude</code> отображает эти теги и позволяет использовать их в качестве критериев поиска. Тем, кому не импонируют критерии поиска <code
                  class="command">aptitude</code>, следующий веб-сайт позволяет использовать навигацию по базе тегов: <div
                  xmlns=""
                  class="url">→ <a
                    xmlns="http://www.w3.org/1999/xhtml"
                    href="http://debtags.alioth.debian.org/">http://debtags.alioth.debian.org/</a></div>
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.configuration-scripts"></a>5.2.2. Сценарии настройки</h3></div></div></div><a
            id="id-1.8.6.6.2"
            class="indexterm"></a><a
            id="id-1.8.6.6.3"
            class="indexterm"></a><a
            id="id-1.8.6.6.4"
            class="indexterm"></a><a
            id="id-1.8.6.6.5"
            class="indexterm"></a><a
            id="id-1.8.6.6.6"
            class="indexterm"></a><div
            class="para">
				Кроме файла <code
              class="filename">control</code> архив <code
              class="filename">control.tar.gz</code> в каждом пакете Debian может содержать несколько сценариев, вызываемых <code
              class="command">dpkg</code> на разных этапах обработки пакета. В Политике Debian подробно описаны все возможные случаи, в которых вызываются сценарии, и какие аргументы они при этом получают. Эти последовательности могут быть довольно сложными, поскольку если один из сценариев завершается с ошибкой, <code
              class="command">dpkg</code> будет пытаться вернуться к нормальному состоянию (насколько это возможно) путём отмены текущей установки или удаления.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> База данных <code
                        class="command">dpkg</code></strong></p></div></div></div><a
              id="id-1.8.6.6.8.2"
              class="indexterm"></a><a
              id="id-1.8.6.6.8.3"
              class="indexterm"></a><div
              class="para">
				Все сценарии настройки для установленных пакетов храняться в каталоге <code
                class="filename">/var/lib/dpkg/info/</code> в виде файла, префикс имени которого совпадает с именем пакета. В этом каталоге также содержатся файлы с расширением <code
                class="filename">.list</code> для каждого пакета, содержащие список файлов, принадлежащих каждому пакету.
			</div><div
              class="para">
				Файл <code
                class="filename">/var/lib/dpkg/status</code> содержит последовательности блоков данных (в формате небезызветстных почтовых заголовков, RFC 2822) с описанием статуса каждого пакета. Информация из файла <code
                class="filename">control</code> установленного пакета также дублируется сюда.
			</div></div><div
            class="para">
				Если вкратце, сценарий <code
              class="filename">preinst</code> вызывается перед установкой пакета, а <code
              class="filename">postinst</code> после неё. Аналогично, <code
              class="filename">prerm</code> запускается перед удалением пакета, а <code
              class="filename">postrm</code> — после. Обновление пакета эквивалентно удалению предыдущей версии и установке более новой. Все возможные ситуации описать здесь не получится, но мы рассмотрим две, встречающиеся чаще всего: установку/обновление и удаление.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ВНИМАНИЕ</em></span> Символические имена сценариев</strong></p></div></div></div><div
              class="para">
				В последовательностях, описанных в этом разделе, сценарии вызываются по особым именам, таким как <code
                class="command">old-prerm</code> или <code
                class="command">new-postinst</code>. Это, соответственно, сценарий <code
                class="command">prerm</code>, содержавшийся в старой версии пакета (установленной до обновления), и сценарий <code
                class="command">postinst</code>, содержащийся в новой версии (установленной при обновлении).
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> Диаграммы состояний</strong></p></div></div></div><div
              class="para">
				Манож Сривастава нарисовал диаграммы, иллюстрирующие вызов конфигурационных сценариев <code
                class="command">dpkg</code>. Похожие диаграммы также были разработаны проектом Debian Women; они несколько проще для понимания, но менее полные. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="https://people.debian.org/~srivasta/MaintainerScripts.html">https://people.debian.org/~srivasta/MaintainerScripts.html</a></div> <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://wiki.debian.org/MaintainerScripts">http://wiki.debian.org/MaintainerScripts</a></div>
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.6.12"></a>5.2.2.1. Установка и обновление</h4></div></div></div><a
              id="id-1.8.6.6.12.2"
              class="indexterm"></a><div
              class="para">
					Вот что происходит во время установки пакета (или его обновления):
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="orderedlist"><ol><li
                  class="listitem"><div
                    class="para">
							Для обновления <code
                      class="command">dpkg</code> запускает <code
                      class="command">old-prerm upgrade <em
                        class="replaceable">новая-версия</em></code>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							Также для обновления <code
                      class="command">dpkg</code> запускает <code
                      class="command">new-preinst upgrade <em
                        class="replaceable">старая-версия</em></code>; при установке запускается <code
                      class="command">new-preinst install</code>. Последним параметром может быть добавлена старая версия, если пакет уже устанавливался раньше, но был удалён (но не вычищен, то есть конфигурационные файлы сохранились).
						</div></li><li
                  class="listitem"><div
                    class="para">
							После этого распаковываются файлы нового пакета. Если файл уже существует, он заменяется, но создаётся временная резервная копия.
						</div></li><li
                  class="listitem"><div
                    class="para">
							При обновлении <code
                      class="command">dpkg</code> вызывает <code
                      class="command">old-postrm upgrade <em
                        class="replaceable">новая-версия</em></code>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> обновляет все внутренние данные (список файлов, сценарии настройки и т. п.) и удаляет резервные копии заменённых файлов. Теперь обратного пути нет: <code
                      class="command">dpkg</code> более недоступны все элементы, необходимые для отката к предыдущему состоянию.
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> обновит все конфигурационные файлы, выводя запрос пользователю, если это невозможно сделать автоматически. Подробности этой процедуры рассмотрены в <a
                      class="xref"
                      href="sect.package-meta-information.html#sect.conffiles">Раздел 5.2.3, «Контрольные суммы, список конфигурационных файлов»</a>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							Наконец, <code
                      class="command">dpkg</code> настраивает пакет, запуская <code
                      class="command">new-postinst configure <em
                        class="replaceable">последняя-настроенная-версия</em></code>.
						</div></li></ol></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.8.6.6.13"></a>5.2.2.2. Удаление пакета</h4></div></div></div><div
              class="para">
					Вот что происходит во время удаления пакета:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="orderedlist"><ol><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> запускает <code
                      class="command">prerm remove</code>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> удаляет все файлы пакета за исключением конфигурационных файлов и сценариев настройки.
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> запускает <code
                      class="command">postrm remove</code>. Все сценарии настройки, за исключением <code
                      class="filename">postrm</code>, удаляются. Если пользователь не использует опцию «purge», процесс удаления заканчивается на этом шаге.
						</div></li><li
                  class="listitem"><div
                    class="para">
							Для полного удаления пакета (в случае использования команды <code
                      class="command">dpkg --purge</code> или <code
                      class="command">dpkg -P</code>) также удаляются конфигурационные файлы и их копии (<code
                      class="filename">*.dpkg-tmp</code>, <code
                      class="filename">*.dpkg-old</code>, <code
                      class="filename">*.dpkg-new</code>) и временные файлы; после этого <code
                      class="command">dpkg</code> запускает <code
                      class="command">postrm purge</code>.
						</div></li></ol></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>СЛОВАРЬ</em></span> Purge, полное удаление</strong></p></div></div></div><a
                id="id-1.8.6.6.13.4.2"
                class="indexterm"></a><div
                class="para">
					При удалении пакета Debian конфигурационные файлы сохраняются в целях облегчения возможной повторной установки. Кроме того, сохраняется данные, созданные демонами (например содержимое каталога сервера LDAP или содержимое базы данных SQL-сервера).
				</div><div
                class="para">
					Для полного удаления всех данных, относящихся к пакету, необходимо «вычистить» (<span
                  class="foreignphrase"><em
                    class="foreignphrase">purge</em></span>) пакет с помощью команды <code
                  class="command">dpkg -P <em
                    class="replaceable">пакет</em></code>, <code
                  class="command">apt-get remove --purge <em
                    class="replaceable">пакет</em></code> или <code
                  class="command">aptitude purge <em
                    class="replaceable">пакет</em></code>.
				</div><div
                class="para">
					Учитывая необратимую природу такого удаления, не следует относиться к нему легкомысленно.
				</div></div><a
              id="id-1.8.6.6.13.5"
              class="indexterm"></a><div
              class="para">
					Четыре сценария, описанные выше, дополняются сценарием <code
                class="filename">config</code>, предоставляемым пакетами, которые используют <code
                class="command">debconf</code> для запроса у пользователя информации для настройки. Этот сценарий определяет вопросы, которые будут заданы <code
                class="command">debconf</code> во время установки. Ответы заносятся в базу данных <code
                class="command">debconf</code> для дальнейшего использования. Эти сценарии обычно выполняются <code
                class="command">apt</code> до установки пакетов, последовательно, чтобы сгруппировать вопросы и задать их пользователю в начале процесса. Пред- и послеустановочные сценарии могут впоследствии использовать эту информацию, чтобы действовать в соответствии с пожеланиями пользователей.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ИНСТРУМЕНТ</em></span> <code
                          class="command">debconf</code></strong></p></div></div></div><a
                id="id-1.8.6.6.13.7.2"
                class="indexterm"></a><div
                class="para">
					<code
                  class="command">debconf</code> создали для решения постоянно повторявшейся в Debian проблемы. Все пакеты Debian, которые не могли работать без минимальной настройки, задавали вопросы, вызывая команды <code
                  class="command">echo</code> и <code
                  class="command">read</code> в послеустановочных сценариях <code
                  class="filename">postinst</code> (и других похожих сценариях). Но это означало, что во время большой установки или обновления пользователь должен был находиться у компьютера, чтобы отвечать на различные вопросы, которые могли возникнуть в любое время. Необходимость в таких ручных вмешательствах теперь почти полностью отпала благодаря инструменту <code
                  class="command">debconf</code>.
				</div><div
                class="para">
					У <code
                  class="command">debconf</code> множество интересных возможностей: взаимодействие с пользователем задаётся разработчиком; возможна локализация всех строк, отображаемых пользователю (все переводы хранятся в файле <code
                  class="filename">templates</code>, описывающем взаимодействия); у него есть несколько интерфейсов (для текстового, графического и неинтерактивного режимов); а также возможно создание центральной базы данных ответов для распространения одной конфигурации по нескольким компьютерам... но наиболее важным является то, что теперь возможно задать все вопросы пользователю подряд, до начала длительного процесса установки или обновления. Пользователь может отойти по своим делам, пока система санимается собственно установкой, а не глядеть неотрывно на экран в ожидании вопросов.
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.conffiles"></a>5.2.3. Контрольные суммы, список конфигурационных файлов</h3></div></div></div><a
            id="id-1.8.6.7.2"
            class="indexterm"></a><a
            id="id-1.8.6.7.3"
            class="indexterm"></a><a
            id="id-1.8.6.7.4"
            class="indexterm"></a><a
            id="id-1.8.6.7.5"
            class="indexterm"></a><a
            id="id-1.8.6.7.6"
            class="indexterm"></a><div
            class="para">
				В дополнение к сценариям сопровождающего и контрольным данным, уже рассмотренным в предыдущих разделах, архив <code
              class="filename">control.tar.gz</code> пакета Debian может содержать другие интересные файлы. Первый, <code
              class="filename">md5sums</code>, содержит контрольные суммы MD5 для всех файлов пакета. Благодаря ему можно с помощью команды <code
              class="command">dpkg --verify</code> (которая будет изучаться в <a
              class="xref"
              href="sect.supervision.html#sect.dpkg-verify">Раздел 14.3.3.1, «Auditing Packages with <code
                class="command">dpkg --verify</code>»</a>) проверить, изменялись ли эти файлы с момента установки. Обратите внимание, что при отсутствии этого файла <code
              class="command">dpkg</code> создаст его динамически во время установки (и сохранит его в базе данных dpkg, как и другие контрольные файлы).
			</div><div
            class="para">
				В <code
              class="filename">conffiles</code> содержится список файлов, которые должны быть обработаны как конфигурационные файлы. Конфигурационные файлы могут быть изменены администратором, и <code
              class="command">dpkg</code> постарается сохранить эти изменения во время обновления пакета.
			</div><div
            class="para">
				Действительно, в этой ситуации <code
              class="command">dpkg</code> ведёт себя настолько интеллектуально, насколько это возможно: если стандартный конфигурационный файл не изменился между двумя версиями, она ничего не делает. Если, однако, файл был изменен, она будет пытаться обновить его. Возможны два варианта развития событий: если администратор не трогал конфигурационный файл, <code
              class="command">dpkg</code> автоматически установит новую версию; если же файл был изменен, <code
              class="command">dpkg</code> спросит администратора, какую версию он хочет использовать (старую с изменениями или новую из пакета). Для помощи в принятии решения <code
              class="command">dpkg</code> показывает «<code
              class="command">diff</code>», то есть различия между двумя версиями. Если пользователь предпочтёт оставить старую версию, новая будет храниться в том же месте, в файле с суффиксом <code
              class="filename">.dpkg-dist</code>. Если же пользователь выбирает новую версию, старая сохраняется в файле с суффиксом <code
              class="filename">.dpkg-old</code>. Другой вариант заключается в том, чтобы немедленно прервать <code
              class="command">dpkg</code> и отредактировать файл, попытавшись внести нужные изменения (ранее обнаруженные с помощью <code
              class="command">diff</code>).
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.questions-conffiles"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Как избежать вопросов по поводу конфигурационных файлов</strong></p></div></div></div><div
              class="para">
				Хотя <code
                class="command">dpkg</code> сама заботится об обновлении конфигурационных файлов, она всё же регулярно прерывает свою работу, запрашивая ввод у администратора. Это весьма малоприятно для тех, кто хочет, чтобы обновление выполнялось неинтерактивно. Поэтому у программы имеются опции, позволяющие системе выбирать ответы автоматически, руководствуясь одной и той же логикой: <code
                class="command">--force-confold</code> оставляет старую версию файла; <code
                class="command">--force-confnew</code> использует более новую версию файла (этот выбор применяется, даже если файл не изменялся администратором, что крайне редко является желаемым эффектом). Добавление опции <code
                class="command">--force-confdef</code> указывает <code
                class="command">dpkg</code>, что решения должны по возможности приниматься автоматически (в тех случаях, когда конфигурационный файл не менялся), а <code
                class="command">--force-confnew</code> или <code
                class="command">--force-confold</code> надо применять в остальных случаях.
			</div><div
              class="para">
				Эти опции применимы для <code
                class="command">dpkg</code>, но администратор чаще имеет дело с программами <code
                class="command">aptitude</code> или <code
                class="command">apt-get</code>. Поэтому важно знать синтаксис, используемый для передачи опций команде <code
                class="command">dpkg</code> (их интерфейсы командной строки очень похожи).
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt -o DPkg::options::="--force-confdef" -o DPkg::options::="--force-confold" full-upgrade</code></strong></pre><div
              class="para">
				Эти опции можно записать непосредственно в конфигурации <code
                class="command">apt</code>. Для этого нужно добавить следующую строку в файл <code
                class="filename">/etc/apt/apt.conf.d/local</code>:
			</div><div
              class="informalexample"><pre
                class="programlisting">
DPkg::options { "--force-confdef"; "--force-confold"; }</pre></div><div
              class="para">
				Включение этой опции в конфигурационный файл означает, что она будет распространяться и на графический интерфейс, в частности <code
                class="command">aptitude</code>.
			</div></div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.questions-conffiles-bis"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Как заставить dpkg всегда задавать вопросы по поводу конфигурационных файлов</strong></p></div></div></div><div
              class="para">
				Опция <code
                class="command">--force-confask</code> вынуждает <code
                class="command">dpkg</code> отображать вопросы о конфигурационных файлах даже в тех случаях, когда в этом обычно нет необходимости. Таким образом, при переустановке пакета с этой опцией <code
                class="command">dpkg</code> будет задавать вопросы снова и снова для всех конфигурационных файлов, измененных администратором. Это очень удобно, особенно для переустановки оригинального конфигурационного файла, если он был удалён, и никакой другой экземпляр не доступен: обычная переустановка тут не сработает, так как <code
                class="command">dpkg</code> считает удаление формой нормального изменения, и поэтому не устанавливает желанный конфигурационный файл.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="packaging-system.html"><strong>Пред.</strong>Глава 5. Пакетная система: Инструменты и основные...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.source-package-structure.html"><strong>След.</strong>5.3. Структура исходного пакета</a></li></ul></body></html>
