<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">9.5. Системные события syslog</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-ru-RU-1.0-1" /><meta
        name="keywords"
        content="Загрузка системы, Сценарии инициализации, SSH, Telnet, Права, Привилегии, Инспектирование, Inetd, Cron, Резервное копирование, Горячее подключение, PCMCIA, APM, ACPI" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="unix-services.html"
        title="Глава 9. Сервисы Unix" /><link
        rel="prev"
        href="sect.administration-interfaces.html"
        title="9.4. Интерфейсы для администрирования" /><link
        rel="next"
        href="sect.inetd.html"
        title="9.6. Суперсервер inetd" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ru-RU/stable/sect.syslog.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.administration-interfaces.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.inetd.html"><strong>След.</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.syslog"></a>9.5. Системные события <code
                  class="command">syslog</code></h2></div></div></div><a
          id="id-1.12.8.2"
          class="indexterm"></a><a
          id="id-1.12.8.3"
          class="indexterm"></a><a
          id="id-1.12.8.4"
          class="indexterm"></a><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.syslog-principe"></a>9.5.1. Принципы и механизм</h3></div></div></div><div
            class="para">
				Демон <code
              class="command">rsyslogd</code> отвечает за сбор служебных сообщений от приложений и ядра и дальнейшее распределение их по файлам журналов (обычно хранящимся в каталоге <code
              class="filename">/var/log/</code>). Он управляется конфигурационным файлом <code
              class="filename">/etc/rsyslog.conf</code>.
			</div><div
            class="para">
				Каждое сообщение в журнале соответствует подсистеме приложений (в документации называемой «facility»):
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">auth</code> и <code
                    class="literal">authpriv</code>: для аутентификации;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">cron</code>: от сервисов планировки заданий, <code
                    class="command">cron</code> и <code
                    class="command">atd</code>;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">daemon</code>: относится к демонам, не выделенным в особую группу (DNS, NTP и т. д.);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ftp</code>: относится к FTP-серверу;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">kern</code>: сообщение от ядра;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">lpr</code>: от подсистемы печати;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">mail</code>: от подсистемы электронной почты;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">news</code>: сообщение подсистемы Usenet (в частности от сервера NNTP — Network News Transfer Protocol — управляющего новостными группами);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">syslog</code>: сообщения от самого сервера <code
                    class="command">syslogd</code>;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">user</code>: пользовательские сообщения (основные);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">uucp</code>: сообщения от сервера UUCP (Unix to Unix Copy Program, старый протокол, широко использовавшийся для распространения сообщений электронной почты);
					</div></li><li
                class="listitem"><div
                  class="para">
						с <code
                    class="literal">local0</code> по <code
                    class="literal">local7</code>: зарезервированы для локального использования.
					</div></li></ul></div><div
            class="para">
				Каждому сообщению также присваивается уровень приоритета. Вот их список в порядке убывания:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">emerg</code>: “Помогите” Возникла аварийная ситуация, система возможно непригодна для использования.
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">alert</code>: поспешите, промедление небезопасно, нужно срочно принимать меры;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">crit</code>: условия критические;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">err</code>: ошибка;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">warn</code>: предупреждение (возможная ошибка);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">notice</code>: условия нормальные, но сообщение важное;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">info</code>: информационное сообщение;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">debug</code>: сообщение для отладки.
					</div></li></ul></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.syslog-config"></a>9.5.2. Конфигурационный файл</h3></div></div></div><div
            class="para">
				Синтаксис файла <code
              class="filename">/etc/rsyslog.conf</code> описан на странице руководства <span
              class="citerefentry"><span
                class="refentrytitle">rsyslog.conf</span>(5)</span>, но также есть и документация в формате HTML, доступная в пакете <span
              class="pkg pkg">rsyslog-doc</span> (<code
              class="filename">/usr/share/doc/rsyslog-doc/html/index.html</code>). Общий принцип состоит в написании пар «селектор» и «действие». Селектор определяет подмножество сообщений, а действия описывают, что с ними делать.
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.syslog-selector-syntax"></a>9.5.2.1. Синтаксис селектора</h4></div></div></div><div
              class="para">
					Селектор представляет собой Разделённый точками с запятой список пар <code
                class="literal"><em
                  class="replaceable">подсистема</em>.<em
                  class="replaceable">приоритет</em></code> (пример: <code
                class="literal">auth.notice;mail.info</code>). Звёздочка может означать все подсистемы или все приоритеты (примеры: <code
                class="literal">*.alert</code> или <code
                class="literal">mail.*</code>). Несколько подсистем можно сгруппировать, разделяя их запятой (пример: <code
                class="literal">auth,mail.info</code>). Указанный приоритет подразумевает сообщения того же или более высокого уровня; так, <code
                class="literal">auth.alert</code> соответствует сообщениям подсистемы <code
                class="literal">auth</code> с приоритетом <code
                class="literal">alert</code> или <code
                class="literal">emerg</code>. Если в начале стоит восклицательный знак, такая запись означает прямо противоположное, то есть строго более низкие приоритеты; <code
                class="literal">auth.!notice</code>, таким образом, означает сообщения от <code
                class="literal">auth</code> с приоритетом <code
                class="literal">info</code> или <code
                class="literal">debug</code>. Если в начале стоит знак равенства, такая запись означает точное соответствие указанному приоритету и только ему (<code
                class="literal">auth.=notice</code> соответствует сообщениям от <code
                class="literal">auth</code> с приоритетом <code
                class="literal">notice</code>).
				</div><div
              class="para">
					Каждый элемент в списке селектора переписывает предыдущие элементы. Благодаря этому возможно ограничить выборку или исключить из неё некоторые элементы. Например, <code
                class="literal">kern.info;kern.!err</code> означает сообщения от ядра с приоритетом между <code
                class="literal">info</code> и <code
                class="literal">warn</code>. Приоритет <code
                class="literal">none</code> указывает на пустую выборку (нет приоритетов) и может использоваться для исключения подсистемы из выборки сообщений. Так, <code
                class="literal">*.crit;kern.none</code> означает все сообщения с приоритетом, равным или более высоким, чем <code
                class="literal">crit</code>, исходящим не от ядра.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.syslog-action-syntax"></a>9.5.2.2. Синтаксис действий</h4></div></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>К ОСНОВАМ</em></span> Именованный канал — постоянный канал</strong></p></div></div></div><a
                id="id-1.12.8.6.4.2.2"
                class="indexterm"></a><a
                id="id-1.12.8.6.4.2.3"
                class="indexterm"></a><div
                class="para">
					Именованный канал — это специальный тип файла, работающий как обычный канал (канал, который создаётся с помощью символа «|» в командной строке), но через файл. Преимущество этого механизма заключается в возможности связи между двумя не взаимосвязанными процессами. Запись чего бы то ни было в именованный канал блокирует записывающий процесс до тех пор, пока другой процесс не попытается прочитать записанные данные. Этот второй процесс читает данные, записанные первым, которые после этого может продолжить работу.
				</div><div
                class="para">
					Такой файл создаётся с помощью команды <code
                  class="command">mkfifo</code>.
				</div></div><div
              class="para">
					В число возможных действий входят:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							добавление сообщения в файл (пример: <code
                      class="filename">/var/log/messages</code>);
						</div></li><li
                  class="listitem"><div
                    class="para">
							отправка сообщения удалённому серверу <code
                      class="command">syslog</code> (пример: <code
                      class="literal">@log.falcot.com</code>);
						</div></li><li
                  class="listitem"><div
                    class="para">
							отправка сообщения в существующий именованный канал (пример: <code
                      class="literal">|/dev/xconsole</code>);
						</div></li><li
                  class="listitem"><div
                    class="para">
							отправка сообщения одному или нескольким пользователям, если они вошли в систему (пример: <code
                      class="literal">root,rhertzog</code>);
						</div></li><li
                  class="listitem"><div
                    class="para">
							отправка сообщения всем пользователям в системе (пример: <code
                      class="literal">*</code>);
						</div></li><li
                  class="listitem"><div
                    class="para">
							вывод сообщения в текстовую консоль (пример: <code
                      class="literal">/dev/tty8</code>).
						</div></li></ul></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>БЕЗОПАСНОСТЬ</em></span> Пересылка журналов</strong></p></div></div></div><a
                id="id-1.12.8.6.4.5.2"
                class="indexterm"></a><div
                class="para">
					Хорошей идеей будет записывать наиболее важные журналы на отдельной машине (возможно, специально выделенной для этой цели), поскольку это не позволит возможному взломщику удалить следы своего проникновения (если, конечно, он также не скомпроментировал и этот другой сервер). Кроме того, в случае большой проблемы (такой как сбой ядра) журналы будут доступны на другой машине, что повышает шансы на выявление последовательности событий, приведших к сбою.
				</div><div
                class="para">
					Чтобы принимать сообщения журнала, посылаемые другими машинами, нужно перенастроить <span
                  class="emphasis"><em>rsyslog</em></span>: нужно только активировать готовые записи в <code
                  class="filename">/etc/rsyslog.conf</code> (<code
                  class="literal">$ModLoad imudp</code> и <code
                  class="literal">$UDPServerRun 514</code>).
				</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.administration-interfaces.html"><strong>Пред.</strong>9.4. Интерфейсы для администрирования</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.inetd.html"><strong>След.</strong>9.6. Суперсервер inetd</a></li></ul></body></html>
