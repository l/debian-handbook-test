<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">9.3. Управление правами</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ru-RU-1.0-1" /><meta
        name="keywords"
        content="Загрузка системы, Сценарии инициализации, SSH, Telnet, Права, Привилегии, Инспектирование, Inetd, Cron, Резервное копирование, Горячее подключение, PCMCIA, APM, ACPI" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="unix-services.html"
        title="Глава 9. Сервисы Unix" /><link
        rel="prev"
        href="sect.remote-login.html"
        title="9.2. Удалённый вход" /><link
        rel="next"
        href="sect.administration-interfaces.html"
        title="9.4. Интерфейсы для администрирования" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ru-RU/stable/sect.rights-management.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.remote-login.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.administration-interfaces.html"><strong>След.</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.rights-management"></a>9.3. Управление правами</h2></div></div></div><div
          class="para">
			Linux — многопользовательская система, поэтому она должна предоставлять систему разрешений, чтобы контролировать авторизованные операции с файлами и каталогами, к которым относятся все системные ресурсы и устройства (в Unix-системах любое устройство представляется в виде файла или каталога). Этот принцип является общим для всех Unix-систем, но напомнить об этом ещё раз будет не лишним, тем более что существуют некоторые интересные и сравнительно малоизвестные способы применения.
		</div><a
          id="id-1.12.6.3"
          class="indexterm"></a><a
          id="id-1.12.6.4"
          class="indexterm"></a><a
          id="id-1.12.6.5"
          class="indexterm"></a><a
          id="id-1.12.6.6"
          class="indexterm"></a><a
          id="id-1.12.6.7"
          class="indexterm"></a><a
          id="id-1.12.6.8"
          class="indexterm"></a><div
          class="para">
			У каждого файла и каталога имеются специальные разрешения для трёх категорий пользователей:
		</div><div
          xmlns:d="http://docbook.org/ns/docbook"
          class="itemizedlist"><ul><li
              class="listitem"><div
                class="para">
					его владельца (обозначается <code
                  class="literal">u</code>, от «user»);
				</div></li><li
              class="listitem"><div
                class="para">
					его группы-владельца (обозначается <code
                  class="literal">g</code>, от «group»), представленная всеми членами группы;
				</div></li><li
              class="listitem"><div
                class="para">
					остальных (обозначается <code
                  class="literal">o</code>, от «other»).
				</div></li></ul></div><div
          class="para">
			Три типа прав могут использоваться совместно:
		</div><div
          xmlns:d="http://docbook.org/ns/docbook"
          class="itemizedlist"><ul><li
              class="listitem"><div
                class="para">
					чтение (обозначается <code
                  class="literal">r</code>, от «read»);
				</div></li><li
              class="listitem"><div
                class="para">
					запись (или изменение, обозначается <code
                  class="literal">w</code>, от «write»);
				</div></li><li
              class="listitem"><div
                class="para">
					исполнение (обозначается <code
                  class="literal">x</code>, от «eXecute»).
				</div></li></ul></div><a
          id="id-1.12.6.13"
          class="indexterm"></a><a
          id="id-1.12.6.14"
          class="indexterm"></a><a
          id="id-1.12.6.15"
          class="indexterm"></a><a
          id="id-1.12.6.16"
          class="indexterm"></a><div
          class="para">
			По отношению к файлу, такие права хорошо понятны: доступ для чтения позволяет читать содержимое (включая копирование), доступ для записи позволяет менять содержимое, доступ для исполнения позволяет запускать (работает для программ).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>БЕЗОПАСНОСТЬ</em></span> исполняемые файлы с <code
                      class="literal">setuid</code> и <code
                      class="literal">setgid</code></strong></p></div></div></div><div
            class="para">
			Два своеобразных права имеют смысл для исполняемых файлов: <code
              class="literal">setuid</code> и <code
              class="literal">setgid</code> (обозначаются буквой «s»). Обратите внимание, что они часто называются «битами», поскольку каждое из этих логических значений может быть представлено как 0 или 1. Эти два права позволяют любому пользователю выполнять программу на правах её владельца или группы соответственно. Данный механизм предоставляет доступ к функциям, требующим разрешений более высокого уровня, чем обычно есть у пользователя.
		</div><a
            id="id-1.12.6.18.3"
            class="indexterm"></a><a
            id="id-1.12.6.18.4"
            class="indexterm"></a><div
            class="para">
			Поскольку <code
              class="literal">setuid</code>-программа, принадлежащая root, систематически запускается с правами суперпользователя, крайне важно убедиться в её безопасности и надёжности. Действительно, пользователь, которому удастся заставить её вызвать другую произвольную программу, сможет представиться как root и получить все права в системе.
		</div></div><div
          class="para">
			Каталоги обрабатываются иначе. Доступ на чтение даёт право получить список его содержимого (файлов и каталогов), доступ на запись позволяет создавать и удалять файлы, а доступ на исполнение позволяет проходить через него (в частности переходить в него с помощью команды <code
            class="command">cd</code>). Возможность проходить через каталог, не имея возможности прочесть его, позволяет получить доступ к файлам внутри него, если они известны по имени, но не находить их, если о их существовании или их точных именах не известно.
		</div><div
          class="sidebar"><a
            xmlns=""
            id="sidebar.setgid-dir"></a><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>БЕЗОПАСНОСТЬ</em></span> Каталог с <code
                      class="literal">setgid</code> и <span
                      class="emphasis"><em>sticky bit</em></span></strong></p></div></div></div><a
            id="id-1.12.6.20.2"
            class="indexterm"></a><div
            class="para">
			Бит <code
              class="literal">setgid</code> применим и к каталогам. Любой вновь созданный файл внутри таких каталогов автоматически присваивается группе-владельцу родительского каталога вместо того, чтобы унаследовать основную группу создателя, как происходит обычно. Эта настройка позволяет пользователю не изменять свою основную группу (с помощью команды <code
              class="command">newgrp</code>) при работе в дереве файлов, общих для нескольких пользователей из одной конкретной группы.
		</div><a
            id="id-1.12.6.20.4"
            class="indexterm"></a><div
            class="para">
			Так называемый «sticky bit» (обозначаемый буквой «t») является разрешением, имеющим смысл только для каталогов. Он, в частности, используется для временных каталогов, куда у всех есть доступ на запись (например <code
              class="filename">/tmp/</code>): он ограничивает возможность удаления файлов, так что только их владелец (или владелец родительского каталога) может это сделать. Если бы данной функции не было, любой мог бы удалить файлы других пользователей в <code
              class="filename">/tmp/</code>.
		</div></div><div
          class="para">
			Три команды для управления разрешениями, связанными с файлом:
		</div><div
          xmlns:d="http://docbook.org/ns/docbook"
          class="itemizedlist"><ul><li
              class="listitem"><div
                class="para">
					<code
                  class="command">chown <em
                    class="replaceable">пользователь</em> <em
                    class="replaceable">файл</em></code> изменяет владельца файла;
				</div></li><li
              class="listitem"><div
                class="para">
					<code
                  class="command">chgrp <em
                    class="replaceable">группа</em> <em
                    class="replaceable">файл</em></code> меняет группу-владельца;
				</div></li><li
              class="listitem"><div
                class="para">
					<code
                  class="command">chmod <em
                    class="replaceable">права</em> <em
                    class="replaceable">файл</em></code> изменяет разрешения на файл.
				</div></li></ul></div><div
          class="para">
			Есть два способа представления прав. Из них символьное, пожалуй, более легко для понимания и запоминания. В нём используются указанные выше символы. Можно определить права для каждой категории пользователей (<code
            class="literal">u</code>/<code
            class="literal">g</code>/<code
            class="literal">o</code>), присвоив их явно (с помощью <code
            class="literal">=</code>), добавив (<code
            class="literal">+</code>) или отняв (<code
            class="literal">-</code>). Так, выражение <code
            class="literal">u=rwx,g+rw,o-r</code> даёт владельцу права на чтение, запись и исполнение, добавляет права на чтение и запись для группы-владельца и отнимает право на чтение у остальных пользователей. Права, не затрагиваемые добавлением или отъёмом, остаются без изменений. Буква <code
            class="literal">a</code> (от «all») обозначает все три категории пользователей, так что <code
            class="literal">a=rx</code> даёт всем трём категориям одинаковые права (читать и исполнять, но не записывать).
		</div><a
          id="id-1.12.6.24"
          class="indexterm"></a><a
          id="id-1.12.6.25"
          class="indexterm"></a><a
          id="id-1.12.6.26"
          class="indexterm"></a><a
          id="id-1.12.6.27"
          class="indexterm"></a><a
          id="id-1.12.6.28"
          class="indexterm"></a><div
          class="para">
			В цифровом (восьмеричном) представлении каждому праву соответствует конкретное значение: 4 — чтению, 2 — записи, 1 — исполнению. Каждая комбинация прав соответствует сумме этих чисел. Каждое значение затем присваивается своей категории пользователей, будучи записанным подряд с остальными в обычном порядке (владелец, группа, остальные).
		</div><div
          class="para">
			Например, команда <code
            class="command">chmod 754 <em
              class="replaceable">файл</em></code> установит следующие права: на чтение, запись и исполнение для владельца (поскольку 7 = 4 + 2 + 1); на чтение и исполнение для группы (поскольку 5 = 4 + 1); только на чтение для остальных. <code
            class="literal">0</code> означает отсутствие прав, так что <code
            class="command">chmod 600 <em
              class="replaceable">файл</em></code> разрешает чтение и запись владельцу и не даёт никаких прав всем остальным. Наиболее распространённые комбинации прав — <code
            class="literal">755</code> для исполняемых файлов и каталогов и <code
            class="literal">644</code> для файлов с данными.
		</div><div
          class="para">
			Для представления в таком виде специальных прав можно указать в начале четвёртую цифру в соответствии с тем же принципом, где битам <code
            class="literal">setuid</code>, <code
            class="literal">setgid</code> <code
            class="literal">sticky</code> соответствуют 4, 2 и 1. <code
            class="command">chmod 4754</code> установит бит <code
            class="literal">setuid</code> наравне с вышеописанными правами.
		</div><div
          class="para">
			Заметьте, что для восьмеричного представления возможна только установка всех прав сразу, нельзя добавить новое правило, как например, доступ для чтения для владельца группы — пользователь должен, учитывая существующие права, вычислить новое соответствующее значение.
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>СОВЕТ</em></span> Рекурсивная работа</strong></p></div></div></div><div
            class="para">
			Иногда требуется изменить права для целого дерева файлов. У всех вышеуказанных команд есть опция <code
              class="literal">-R</code>, при использовании которой программа рекурсивно обходит подкаталоги.
		</div><div
            class="para">
			Из-за различия между каталогами и файлами иногда случаются проблемы с рекурсивными операциями. Поэтому была дополнительно введена ещё одна опция прав доступа - буква “X”, которая правильно работает с символическими ссылками, имеющимися в каталоге. Она добавляет права доступа некоторым файлам в заданном каталоге (и не затрагивает другие файлы, которые имеют недостаточно прав). Таким образом, <code
              class="command">chmod -R a+X <em
                class="replaceable">directory</em></code> добавит для всех подкаталогов и файлов, для которых ужѐ были ранее установлены права доступа на выполнение хотя бы для одной из категории пользователей (u - владелец, g - группа, o - другие), права выполнения для всех категорий пользователей (<code
              class="literal">a</code>).
		</div></div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>СОВЕТ</em></span> Смена пользователя и группы</strong></p></div></div></div><div
            class="para">
			Часто приходится одновременно выполнять две операции: изменить принадлежность файла к какой-то группе и сменить его владельца. Команда <code
              class="command">chown</code> имеет специальный синтаксис для таких случаев: <code
              class="command">chown <em
                class="replaceable">user</em>:<em
                class="replaceable">group</em> <em
                class="replaceable">file</em></code>
		</div></div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> <code
                      class="command">umask</code></strong></p></div></div></div><div
            class="para">
			Когда приложение создаёт файл, оно присваивает ему ориентировочные разрешения, зная, что система автоматически удаляет некоторые права, заданные командой <code
              class="command">umask</code>. Введите <code
              class="command">umask</code> в командной оболочке; вы увидите маску наподобие <code
              class="computeroutput">0022</code>. Это всего лишь восьмеричное представление прав, которые методично удаляются (в данном случае — право записи для группы и для остальных пользователей).
		</div><a
            id="id-1.12.6.35.3"
            class="indexterm"></a><a
            id="id-1.12.6.35.4"
            class="indexterm"></a><a
            id="id-1.12.6.35.5"
            class="indexterm"></a><div
            class="para">
			Если передать ей новое восьмеричное значение, команда <code
              class="command">umask</code> изменяет маску. При использовании в файле инициализации оболочки (например <code
              class="filename">~/.bash_profile</code>) она изменит маску во всех пользовательских сессиях.
		</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.remote-login.html"><strong>Пред.</strong>9.2. Удалённый вход</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.administration-interfaces.html"><strong>След.</strong>9.4. Интерфейсы для администрирования</a></li></ul></body></html>
