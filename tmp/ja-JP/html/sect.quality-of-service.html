<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">10.3. Quality of Service</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-ja-JP-1.0-1" /><meta
        name="keywords"
        content="ネットワーク, ゲートウェイ, TCP/IP, IPv6, DNS, Bind, DHCP, QoS" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="network-infrastructure.html"
        title="第 10 章 ネットワークインフラ" /><link
        rel="prev"
        href="sect.virtual-private-network.html"
        title="10.2. 仮想プライベートネットワーク" /><link
        rel="next"
        href="sect.dynamic-routing.html"
        title="10.4. 動的ルーティング" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ja-JP/stable/sect.quality-of-service.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.virtual-private-network.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="sect.dynamic-routing.html"><strong>次へ</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.quality-of-service"></a>10.3. Quality of Service</h2></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.qos-principe"></a>10.3.1. 原理とメカニズム</h3></div></div></div><div
            class="para">
				<span
              class="emphasis"><em>Quality of Service (サービスの品質)</em></span> (略して <span
              class="emphasis"><em>QoS</em></span>) はアプリケーションに提供されるサービスの品質を向上させる技術群を指します。最もよく使われる技術はネットワークトラフィックをカテゴリ分けして、トラフィックの所属するカテゴリごとにその取り扱いに違いを付ける技術です。サービスを差別化するという概念の主な用途が<span
              class="emphasis"><em>トラフィックシェーピング</em></span>です。これは一部のサービスおよびホストに関連する接続のデータの転送率を制限します。これを使うことで、利用できる帯域幅が飽和することを避け、重要な他のサービスに支障が出ないようにします。トラフィックシェーピングは TCP トラフィックに対して特に有効です。なぜなら、TCP は利用できる帯域幅に自動的に適応するからです。
			</div><a
            id="id-1.13.6.2.3"
            class="indexterm"></a><a
            id="id-1.13.6.2.4"
            class="indexterm"></a><a
            id="id-1.13.6.2.5"
            class="indexterm"></a><a
            id="id-1.13.6.2.6"
            class="indexterm"></a><div
            class="para">
				トラフィックの優先度を変更し、対話型サービス (<code
              class="command">ssh</code> や <code
              class="command">telnet</code> など) や小さなブロックのデータだけを取り扱うサービスに関連するパケットに高い優先度を付けることも可能です。
			</div><div
            class="para">
				Debian カーネルには、QoS 関連モジュールと一緒に QoS に必要な機能が含まれています。多くのモジュールが存在し、各モジュールが異なるサービスを提供します。中でも注目すべきは IP パケットの待ち行列用の特別なスケジューラです。このスケジューラはさまざまな用途に利用できるため、考え得るさまざまな要求に対応できます。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CULTURE</em></span> LARTC (<span
                        class="emphasis"><em>Linux Advanced Routing &amp; Traffic Control</em></span>)</strong></p></div></div></div><div
              class="para">
				<span
                class="emphasis"><em>Linux Advanced Routing &amp; Traffic Control</em></span> HOWTO はネットワークのサービス品質に関して知っておくべきすべての内容をカバーする基礎的な文書です。<div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.lartc.org/howto/">http://www.lartc.org/howto/</a></div>
			</div><a
              id="id-1.13.6.2.9.3"
              class="indexterm"></a><a
              id="id-1.13.6.2.9.4"
              class="indexterm"></a><a
              id="id-1.13.6.2.9.5"
              class="indexterm"></a></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.qos-config"></a>10.3.2. 設定と実践</h3></div></div></div><div
            class="para">
				QoS パラメータは <code
              class="command">tc</code> コマンド (<span
              class="pkg pkg">iproute</span> パッケージに含まれます) を使って設定します。<code
              class="command">tc</code> コマンドはインターフェースがかなり複雑なので、高レベルツールを使うことを推奨します。
			</div><a
            id="id-1.13.6.3.3"
            class="indexterm"></a><a
            id="id-1.13.6.3.4"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.qos-wondershaper"></a>10.3.2.1. 待ち時間の低減、<code
                      class="command">wondershaper</code></h4></div></div></div><div
              class="para">
					<code
                class="command">wondershaper</code> (同名のパッケージに含まれます) の主目的はネットワーク負荷とは無関係に待ち時間を最小化することです。全トラフィックをある値に制限することにより、これは実現されます。この値には帯域を飽和させるよりほんの少しだけ小さな値を設定します。
				</div><a
              id="id-1.13.6.3.5.3"
              class="indexterm"></a><a
              id="id-1.13.6.3.5.4"
              class="indexterm"></a><a
              id="id-1.13.6.3.5.5"
              class="indexterm"></a><div
              class="para">
					ネットワークインターフェースを設定した後、<code
                class="command">wondershaper <em
                  class="replaceable">interface</em> <em
                  class="replaceable">download_rate</em> <em
                  class="replaceable">upload_rate</em></code> を実行することでトラフィックが制限されます。ここで <em
                class="replaceable">interface</em> はたとえば <code
                class="literal">eth0</code> または <code
                class="literal">ppp0</code> などのインターフェース名で、<em
                class="replaceable">download_rate</em> および <em
                class="replaceable">upload_rate</em> はキロビット毎秒単位の値です。特定のインターフェースで実施されているトラフィック制限を無効化するには <code
                class="command">wondershaper remove <em
                  class="replaceable">interface</em></code> コマンドを使います。
				</div><div
              class="para">
					イーサネット接続の場合、<code
                class="command">wondershaper</code> をインターフェースが設定された直後に呼び出すのが最良です。これを行うには、<code
                class="filename">/etc/network/interfaces</code> ファイルに <code
                class="literal">up</code> と <code
                class="literal">down</code> 指示文を追加して、それぞれインターフェースが開始された後と停止される前に実行するコマンドを宣言します。以下にその例を示します。
				</div><div
              class="example"><a
                xmlns=""
                id="example.network-interfaces"></a><p
                class="title"><strong>例 10.9 <code
                    class="filename">/etc/network/interfaces</code> ファイルの修正</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
iface eth0 inet dhcp
    up /sbin/wondershaper eth0 500 100
    down /sbin/wondershaper remove eth0</pre></div></div><div
              class="para">
					PPP の場合、<code
                class="filename">/etc/ppp/ip-up.d/</code> 内に <code
                class="command">wondershaper</code> を呼び出すスクリプトを作成することで、接続が開始された後の可能な限り早い時期にトラフィック制御を行うように設定できます。
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>GOING FURTHER</em></span> 最適な設定</strong></p></div></div></div><div
                class="para">
					<code
                  class="filename">/usr/share/doc/wondershaper/README.Debian.gz</code> ファイルでは、パッケージメンテナの推奨する設定方法が少し詳しく説明されています。特に、ダウンロードとアップロード速度を計測することを勧めています。実際の速度を計測することで、制限を適切に見積もることが可能です。
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.qos-config-standard"></a>10.3.2.2. 標準的な設定</h4></div></div></div><div
              class="para">
					明示的に QoS 設定を行わない場合、Linux カーネルは <code
                class="literal">pfifo_fast</code> キュースケジューラを使います。これは興味深い機能を提供します。各 IP パケットの優先度はパケットの ToS フィールド (<span
                class="emphasis"><em>Type of Service</em></span>) によって決まります。スケジューリング機能を活用するには、このフィールドを修正するだけで十分です。ToS フィールドの取り得る値は以下の 5 種類です。
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							通常のサービス (0)。
						</div></li><li
                  class="listitem"><div
                    class="para">
							コストの最小化 (2)。
						</div></li><li
                  class="listitem"><div
                    class="para">
							信頼度の最大化 (4)。
						</div></li><li
                  class="listitem"><div
                    class="para">
							速度の最大化 (8)。
						</div></li><li
                  class="listitem"><div
                    class="para">
							遅延の最小化 (16)。
						</div></li></ul></div><a
              id="id-1.13.6.3.6.4"
              class="indexterm"></a><a
              id="id-1.13.6.3.6.5"
              class="indexterm"></a><div
              class="para">
					ToS フィールドは IP パケットを生成するアプリケーションによって設定されるか、<span
                class="emphasis"><em>netfilter</em></span> によってその場で修正されます。以下のルールを使うだけで、サーバの SSH サービスに対する応答性を増加させることが可能です。
				</div><pre
              class="programlisting scale">
iptables -t mangle -A PREROUTING -p tcp --sport ssh -j TOS --set-tos Minimize-Delay
iptables -t mangle -A PREROUTING -p tcp --dport ssh -j TOS --set-tos Minimize-Delay</pre></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.virtual-private-network.html"><strong>戻る</strong>10.2. 仮想プライベートネットワーク</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.dynamic-routing.html"><strong>次へ</strong>10.4. 動的ルーティング</a></li></ul></body></html>
