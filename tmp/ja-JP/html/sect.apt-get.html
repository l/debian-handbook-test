<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">6.2. aptitude、apt-get、apt コマンド</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-ja-JP-1.0-1" /><meta
        name="keywords"
        content="apt, apt-get, apt-cache, aptitude, synaptic, sources.list, apt-cdrom" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="apt.html"
        title="第 6 章 メンテナンスと更新、APT ツール" /><link
        rel="prev"
        href="apt.html"
        title="第 6 章 メンテナンスと更新、APT ツール" /><link
        rel="next"
        href="sect.apt-cache.html"
        title="6.3. apt-cache コマンド" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ja-JP/stable/sect.apt-get.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>次へ</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.apt-get"></a>6.2. <code
                  class="command">aptitude</code>、<code
                  class="command">apt-get</code>、<code
                  class="command">apt</code> コマンド</h2></div></div></div><a
          id="id-1.9.11.2"
          class="indexterm"></a><a
          id="id-1.9.11.3"
          class="indexterm"></a><a
          id="id-1.9.11.4"
          class="indexterm"></a><div
          class="para">
			APT は巨大なプロジェクトで、当初の予定ではグラフィカルインターフェースを含んでいました。APT はライブラリに基づいており、そのライブラリにはコアアプリケーションが含まれています。<code
            class="command">apt-get</code> は最初のコマンドラインベースフロントエンドで、APT プロジェクト内で開発されました。<code
            class="command">apt</code> は APT から提供されているもう一つのコマンドラインベースフロントエンドで、<code
            class="command">apt-get</code> の持っていた設計上のミスを克服しています。
		</div><div
          class="para">
			Both tools are built on top of the same library and are thus very close but the default behaviour of <code
            class="command">apt</code> has been improved for interactive use and to actually do what most users expect. APT's developers reserve the right to change the public interface of this tool to further improve it. On the opposite, the public interface of <code
            class="command">apt-get</code> is well defined and will not change in any backwards incompatible way. It is thus the tool that you want to use when you need to script package installation requests.
		</div><div
          class="para">
			APT の数多くのグラフィカルインターフェースは外部プロジェクトとして生まれました。たとえば <code
            class="command">synaptic</code>、<code
            class="command">aptitude</code> (テキストとグラフィカルモードインターフェースの両方があり、グラフィカルモードインターフェースはまだ完成していません)、<code
            class="command">wajig</code> などが生まれました。最も推奨されるインターフェースは <code
            class="command">apt</code> で、この節では <code
            class="command">apt</code> を例に使います。<code
            class="command">apt</code> のコマンドライン構文と <code
            class="command">apt-get</code> や <code
            class="command">aptitude</code> のコマンドライン構文はよく似ていることに注意してください。<code
            class="command">apt</code>、<code
            class="command">apt-get</code>、<code
            class="command">aptitude</code> の間に大きな違いがある場合は、その違いを詳しく述べます。
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.11.8"></a>6.2.1. 初期設定</h3></div></div></div><div
            class="para">
				APT を使う作業では、事前に利用できるパッケージのリストを更新しなければいけません。パッケージリストを更新するには <code
              class="command">apt update</code> を使ってください。ネットワークのスピードに依存しますが、パッケージリストの更新操作には少し時間がかかります。なぜなら、<code
              class="filename">Packages</code>/<code
              class="filename">Sources</code>/<code
              class="filename">Translation-<em
                class="replaceable">language-code</em></code> などのファイルをダウンロードするからです。ここでダウンロードされるファイルは Debian の開発が進むにつれて徐々に大きくなります (<code
              class="literal">main</code> セクションの場合、データのサイズは少なく見積もっても 10 MB です)。もちろん CD-ROM セットからインストールする場合はダウンロードに時間は必要ありません。この場合、パッケージリストの更新操作はとても速くなります。
			</div><a
            id="id-1.9.11.8.3"
            class="indexterm"></a><a
            id="id-1.9.11.8.4"
            class="indexterm"></a><a
            id="id-1.9.11.8.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.11.9"></a>6.2.2. インストールと削除</h3></div></div></div><a
            id="id-1.9.11.9.2"
            class="indexterm"></a><a
            id="id-1.9.11.9.3"
            class="indexterm"></a><a
            id="id-1.9.11.9.4"
            class="indexterm"></a><a
            id="id-1.9.11.9.5"
            class="indexterm"></a><div
            class="para">
				APT を使うと、システムからパッケージを追加したり削除したりできます。追加は <code
              class="command">apt install <em
                class="replaceable">package</em></code>、削除は <code
              class="command">apt remove <em
                class="replaceable">package</em></code> のようにして行います。どちらの場合も APT は自動的に、追加するパッケージの動作に必要なパッケージをインストールし、削除対象のパッケージの削除後に不要になるパッケージを削除します。<code
              class="command">apt purge <em
                class="replaceable">package</em></code> コマンドを実行すれば完全にアンインストール、つまり設定ファイルも削除します。
			</div><a
            id="id-1.9.11.9.7"
            class="indexterm"></a><a
            id="id-1.9.11.9.8"
            class="indexterm"></a><a
            id="id-1.9.11.9.9"
            class="indexterm"></a><a
            id="id-1.9.11.9.10"
            class="indexterm"></a><a
            id="id-1.9.11.9.11"
            class="indexterm"></a><a
            id="id-1.9.11.9.12"
            class="indexterm"></a><a
            id="id-1.9.11.9.13"
            class="indexterm"></a><a
            id="id-1.9.11.9.14"
            class="indexterm"></a><a
            id="id-1.9.11.9.15"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> 複数のマシンに同じ構成でパッケージをインストール</strong></p></div></div></div><div
              class="para">
				複数のコンピュータに同じパッケージ群を体系的にインストールすると役に立つ場合があります。これは簡単にできます。
			</div><div
              class="para">
				最初に、以下の操作でコンピュータにインストールされたパッケージのリストを取得し、これをパッケージ構成の「ひな形」とします。
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --get-selections &gt;pkg-list</code></strong></pre><div
              class="para">
				<code
                class="filename">pkg-list</code> ファイルはインストールされたパッケージのリストです。次に、パッケージ群をインストールしたいコンピュータに <code
                class="filename">pkg-list</code> ファイルを移動し、以下のコマンドを実行します。
			</div><pre
              class="screen">## dpkg が把握しているパッケージのデータベースを更新
# <strong
                class="userinput"><code>avail=`mktemp`</code></strong>
# <strong
                class="userinput"><code>apt-cache dumpavail &gt; "$avail"</code></strong>
# <strong
                class="userinput"><code>dpkg --merge-avail "$avail"</code></strong>
# <strong
                class="userinput"><code>rm -f "$avail"</code></strong>
## dpkg のパッケージ選択リストを更新する
# <strong
                class="userinput"><code>dpkg --set-selections &lt; pkg-list</code></strong>
## apt-get を使ってパッケージ選択リストに基づいてインストールを行う
# <strong
                class="userinput"><code>apt-get dselect-upgrade</code></strong></pre><div
              class="para">
				最初のコマンド群で dpkg データベースで利用できるパッケージのリストを記録し、<code
                class="command">dpkg --set-selections</code> でインストールしたいパッケージ群を選択し、<code
                class="command">apt-get</code> でインストール作業を実行します。<code
                class="command">aptitude</code> には dselect-upgrade が用意されていないので、最後のインストール作業を行うことは不可能です。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> 同時に削除とインストールを行う</strong></p></div></div></div><div
              class="para">
				<code
                class="command">apt</code> (および <code
                class="command">apt-get</code> や <code
                class="command">aptitude</code>) を使ってパッケージのインストールと削除を同時に命令するには、パッケージ名の末尾にサフィックスを付け加えます。<code
                class="command">apt install</code> コマンドでパッケージ名の末尾に「<code
                class="literal">-</code>」を付けると削除になります。<code
                class="command">apt remove</code> コマンドでパッケージ名の末尾に「<code
                class="literal">+</code>」を付けるとインストールになります。
			</div><div
              class="para">
				次の例は <em
                class="replaceable">package1</em> をインストール、<em
                class="replaceable">package2</em> を削除する 2 種類の方法です。
			</div><pre
              class="screen"># <strong
                class="userinput"><code>apt install <em
                    class="replaceable">package1</em> <em
                    class="replaceable">package2-</em></code></strong>
[...]
# <strong
                class="userinput"><code>apt remove <em
                    class="replaceable">package1+</em> <em
                    class="replaceable">package2</em></code></strong>
[...]</pre><div
              class="para">
				これはたとえば <code
                class="literal">Recommends</code> に指定されているなどの原因でインストールされてしまうパッケージをインストールさせないようにするために使うことも可能です。一般に、依存関係解決ソフトウェアは代替解決策を探すための手掛かりとしてこの情報を使います。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> <code
                        class="command">apt --reinstall</code> と <code
                        class="command">aptitude reinstall</code></strong></p></div></div></div><a
              id="id-1.9.11.9.18.2"
              class="indexterm"></a><div
              class="para">
				パッケージから提供されたファイルを削除したり変更したりした場合、システムが被害を受けることがあります。パッケージから提供されたファイルを再取得する最も簡単な方法は、対象のファイルが含まれるパッケージを再インストールすることです。残念なことに、パッケージングシステムはパッケージが既にインストール済みで、再インストールできないことを丁寧に教えてくれます。インストール済みパッケージを再インストールするには、<code
                class="command">apt</code> および <code
                class="command">apt-get</code> コマンドの <code
                class="literal">--reinstall</code> オプションを使います。以下は、既にインストール済みの <span
                class="pkg pkg">postfix</span> を再インストールするコマンドです。
			</div><pre
              class="screen"><code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt --reinstall install postfix</code></strong></pre><div
              class="para">
				<code
                class="command">aptitude</code> のコマンドラインは少し違いますが、<code
                class="command">aptitude reinstall postfix</code> でインストール済みパッケージを再インストールできます。
			</div><div
              class="para">
				<code
                class="command">dpkg</code> を使えばインストール済みパッケージの再インストールを拒否されることはありませんが、管理者が直接 <code
                class="command">dpkg</code> を使うことはまれです。
			</div><div
              class="para">
				注意してください! 攻撃を受けている最中に、変更されたパッケージを修復する目的で <code
                class="command">apt --reinstall</code> を使っても、システムを以前の状態に回復することは絶対に不可能でしょう。不正侵入を受けたシステムでパッケージを修復するために必要な手順の詳細は<a
                class="xref"
                href="sect.dealing-with-compromised-machine.html">第 14.7 節「不正侵入されたマシンの取り扱い」</a>を参照してください。
			</div></div><div
            class="para">
				<code
              class="filename">sources.list</code> に複数のディストリビューション用リポジトリが含まれる場合、パッケージのバージョンを指定してインストールすることも可能です。特定のバージョンを指定するには、<code
              class="command">apt install <em
                class="replaceable">package</em>=<em
                class="replaceable">version</em></code> を使いますが、<code
              class="command">apt install <em
                class="replaceable">package</em>/<em
                class="replaceable">distribution</em></code> のようにして、ディストリビューション (<span
              class="distribution distribution">安定版</span>、<span
              class="distribution distribution">テスト版</span>、<span
              class="distribution distribution">不安定版</span>) を指定するやり方のほうが通常好まれます。<code
              class="filename">sources.list</code> ファイルに書かれたどこかのソースから古いバージョンをまだ入手できるなら、このコマンドを使ってパッケージを古いバージョンに戻すことも可能です (これはたとえば古いバージョンがうまく動作すると知っている場合などに有効です)。古いバージョンを入手する別の方法として <code
              class="literal">snapshot.debian.org</code> アーカイブを使うことも可能です (補注<a
              class="xref"
              href="apt.html#sidebar.snapshot.debian.org">「<span
                class="emphasis"><em>GOING FURTHER</em></span> パッケージの古いバージョン、<code
                class="literal">snapshot.debian.org</code>」</a>を参照してください)。
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.9.11.9.20"></a><p
              class="title"><strong>例 6.3 <span
                  class="pkg pkg">spamassassin</span> の<span
                  class="distribution distribution">不安定版</span>バージョンをインストール</strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>apt install spamassassin/unstable</code></strong></pre></div></div><div
            class="para">
				If the package to install has been made available to you under the form of a simple <code
              class="filename">.deb</code> file without any associated package repository, it is still possible to use APT to install it together with its dependencies (provided that the dependencies are available in the configured repositories) with a simple command: <code
              class="command">apt install ./<em
                class="replaceable">path-to-the-package.deb</em></code>. The leading <code
              class="literal">./</code> is important to make it clear that we are referring to a filename and not to the name of a package available in one of the repositories.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>GOING FURTHER</em></span> <code
                        class="filename">.deb</code> ファイルのキャッシュ</strong></p></div></div></div><div
              class="para">
				APT keeps a copy of each downloaded <code
                class="filename">.deb</code> file in the directory <code
                class="filename">/var/cache/apt/archives/</code>. In case of frequent updates, this directory can quickly take a lot of disk space with several versions of each package; you should regularly sort through them. Two commands can be used: <code
                class="command">apt-get clean</code> entirely empties the directory; <code
                class="command">apt-get autoclean</code> only removes packages which can no longer be downloaded (because they have disappeared from the Debian mirror) and are therefore clearly useless (the configuration parameter <code
                class="literal">APT::Clean-Installed</code> can prevent the removal of <code
                class="filename">.deb</code> files that are currently installed).
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-upgrade"></a>6.2.3. システムのアップグレード</h3></div></div></div><a
            id="id-1.9.11.10.2"
            class="indexterm"></a><a
            id="id-1.9.11.10.3"
            class="indexterm"></a><a
            id="id-1.9.11.10.4"
            class="indexterm"></a><a
            id="id-1.9.11.10.5"
            class="indexterm"></a><div
            class="para">
				最新のセキュリティ更新を入手するために、定期的にアップグレードを行うことをお勧めします。アップグレードを行うには (もちろん <code
              class="command">apt update</code> を実行した後に) <code
              class="command">apt upgrade</code>、<code
              class="command">apt-get upgrade</code>、<code
              class="command">aptitude safe-upgrade</code> を実行してください。これらのコマンドは他のパッケージを削除せずにアップグレードできるインストール済みパッケージだけを探します。言い換えれば、最低限可能なアップグレードを行います。<code
              class="command">apt-get</code> のアップグレードパッケージの選択規則は <code
              class="command">aptitude</code> や <code
              class="command">apt</code> よりも少し条件が厳しいです。なぜなら <code
              class="command">apt-get upgrade</code> は現在のパッケージ構成を変えないからです。つまりパッケージの新パージョンで導入された新しい依存関係により現在インストールされていないパッケージをインストールする必要が生じた場合はパッケージの新パージョンをインストールしないからです。
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.apt-pdiff"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> 増分アップグレード</strong></p></div></div></div><div
              class="para">
				As we explained earlier, the aim of the <code
                class="command">apt update</code> command is to download for each package source the corresponding <code
                class="filename">Packages</code> (or <code
                class="filename">Sources</code>) file. However, even after a <code
                class="command">xz</code> compression, these files can remain rather large (the <code
                class="filename">Packages.xz</code> for the <span
                class="foreignphrase"><em
                  class="foreignphrase">main</em></span> section of <span
                class="distribution distribution">Stretch</span> takes more than 6 MB). If you wish to upgrade regularly, these downloads can take up a lot of time.
			</div><div
              class="para">
				APT は作業を高速に進めるために、ファイル全体をダウンロードするのではなく、前回の更新以降の変更を含む「差分」をダウンロードすることも可能です。これを実現するために、公式の Debian アーカイブミラーはある時点の <code
                class="filename">Packages</code> ファイルと各回の更新に対応する「差分」を配布しています。「差分」はアーカイブが更新されるたびに生成され、1 週間分の「差分」が保存されています。1 個の「差分」ファイルのサイズは<span
                class="distribution distribution">不安定版</span>の場合でもたった数十キロバイトです。そのため、毎週 1 回 <code
                class="command">apt update</code> を実行する場合にダウンロードされるデータ量は 10 分の 1 程度になります。より更新頻度の低い<span
                class="distribution distribution">安定版</span>や<span
                class="distribution distribution">テスト版</span>などのディストリビューションをアップグレードする場合、差分ファイルを使うことによるダウンロードデータ量の削減効果はより顕著なものになります。
			</div><div
              class="para">
				しかしながら、特に長期間アップグレード作業を行っていなかった場合や増分アップグレードの効果が薄い場合、<code
                class="filename">Packages</code> ファイルの全体を強制的にダウンロードしたいと思うかもしれません。これはまた、ネットワークがとても高速でマシンの処理がとても遅い場合に興味深いです。なぜなら、全体をダウンロードすることで節約される時間よりも、コンピュータがファイルの新しいバージョンを計算する時間 (ローカルにある <code
                class="filename">Packages</code> ファイルにダウンロードされた差分を適用していく時間) の方が長いからです。強制的に <code
                class="filename">Packages</code> ファイル全体をダウンロードさせるには、設定パラメータ <code
                class="literal">Acquire::Pdiffs</code> を <code
                class="literal">false</code> に設定してください。
			</div></div><div
            class="para">
				通常 <code
              class="command">apt</code> は最新のバージョンをインストールします (ただし<span
              class="distribution distribution">実験版</span>と<span
              class="distribution distribution">安定版バックポート</span>のパッケージはバージョン番号に関わらず明示的に指定しない限りインストールされません)。<code
              class="filename">sources.list</code> の中で<span
              class="distribution distribution">テスト版</span>や<span
              class="distribution distribution">不安定版</span>を指定した場合、<code
              class="command">apt upgrade</code> は<span
              class="distribution distribution">安定版</span>システムのほとんどを<span
              class="distribution distribution">テスト版</span>や<span
              class="distribution distribution">不安定版</span>に変更します。これはあなたが望んでいないことかもしれません。
			</div><div
            class="para">
				<code
              class="command">apt</code> がアップグレードされたパッケージを検索する際に、特定のディストリビューションからパッケージを検索させるには、<code
              class="literal">-t</code> または <code
              class="literal">--target-release</code> オプションにディストリビューションの名前を付けてください (たとえば <code
              class="command">apt -t stable upgrade</code> のようにしてください)。<code
              class="command">apt</code> を使う時に毎回このオプションを指定するのを避けるには、<code
              class="filename">/etc/apt/apt.conf.d/local</code> ファイルに <code
              class="literal">APT::Default-Release "stable";</code> を追加してください。
			</div><a
            id="id-1.9.11.10.10"
            class="indexterm"></a><a
            id="id-1.9.11.10.11"
            class="indexterm"></a><a
            id="id-1.9.11.10.12"
            class="indexterm"></a><a
            id="id-1.9.11.10.13"
            class="indexterm"></a><a
            id="id-1.9.11.10.14"
            class="indexterm"></a><div
            class="para">
				より重要なアップグレード、たとえば Debian のメジャーバージョンをアップグレードするなどの場合、<code
              class="command">apt full-upgrade</code> を使ってください。<code
              class="command">apt full-upgrade</code> を実行した場合、<code
              class="command">apt</code> はアップグレードに伴う新しい依存関係により不要となったパッケージを削除します。また、<code
              class="command">apt full-upgrade</code> は Debian <span
              class="distribution distribution">不安定版</span> リリースを日常的に使い、毎日開発進化を追いかけているユーザが使うコマンドです。これは説明がほとんど必要ないくらいとても単純です。そして APT の評判はこの偉大なる機能性が担っています。
			</div><div
            class="para">
				<code
              class="command">apt</code> と異なり、<code
              class="command">aptitude</code> および <code
              class="command">apt-get</code> では <code
              class="command">full-upgrade</code> コマンドを使うことができません。その代わり、<code
              class="command">apt-get dist-upgrade</code> (「ディストリビューションアップグレード」) を使ってください。dist-upgrade コマンドは歴史的かつよく知られており、<code
              class="command">apt</code> と <code
              class="command">aptitude</code> はユーザの利便性を考慮して dist-upgrade を受け付けます。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-config"></a>6.2.4. 設定オプション</h3></div></div></div><a
            id="id-1.9.11.11.2"
            class="indexterm"></a><a
            id="id-1.9.11.11.3"
            class="indexterm"></a><a
            id="id-1.9.11.11.4"
            class="indexterm"></a><div
            class="para">
				既に説明した設定項目に加えて、<code
              class="filename">/etc/apt/apt.conf.d/</code> ディレクトリに指示文を書いたファイルを追加して APT の特定の機能を設定できます。たとえば、APT に <code
              class="command">dpkg</code> がファイルの衝突によるエラーを無視するよう設定するには、<code
              class="literal">DPkg::options { "--force-overwrite"; }</code> のように書いたファイルを <code
              class="filename">/etc/apt/apt.conf.d/</code> ディレクトリに追加します。
			</div><div
            class="para">
				ウェブにアクセスするには必ずプロキシを介す必要がある場合、<code
              class="literal">Acquire::http::proxy "http://<em
                class="replaceable">yourproxy</em>:3128"</code> の行を追加してください。FTP プロキシは <code
              class="literal">Acquire::ftp::proxy "ftp://<em
                class="replaceable">yourproxy</em>"</code> のように追加してください。より多くの設定オプションを確認するには、<code
              class="command">man apt.conf</code> コマンドで <span
              class="citerefentry"><span
                class="refentrytitle">apt.conf</span>(5)</span> マニュアルページをご覧ください (マニュアルページの詳細は<a
              class="xref"
              href="solving-problems.html#sect.manual-pages">第 7.1.1 節「マニュアルページ」</a>をご覧ください)。
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.directory.d"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> <code
                        class="filename">.d</code> で終わるディレクトリ</strong></p></div></div></div><a
              id="id-1.9.11.11.7.2"
              class="indexterm"></a><div
              class="para">
				名前に <code
                class="filename">.d</code> サフィックスが付けられたディレクトリは頻繁に使われます。それぞれのディレクトリは複数ファイルにわたって分割された設定ファイルを表しています。この意味において、<code
                class="filename">/etc/apt/apt.conf.d/</code> 内のすべてのファイルには APT に対する設定が含まれています。APT はこれらをアルファベット順に読み込みます。つまり、読み込まれる順番が遅いファイルの設定が早いファイルの設定を上書きするということです。
			</div><div
              class="para">
				この体制により、マシンの管理者とパッケージメンテナは設定にいくつかの自由度を持つことが可能です。実際、管理者は出来合いのファイルをこのディレクトリに追加することによって、既存のファイルを編集せずにソフトウェアの設定を簡単に修正できます。パッケージメンテナはこれと同じやり方で、自分のパッケージとうまく共存させながら、他のソフトウェアの設定を変更します。あるパッケージが自分以外のパッケージから提供された設定ファイルを変更することは Debian ポリシーによって禁止されています。すなわち設定ファイルを変更できるのはユーザだけです。パッケージのアップグレード中に設定ファイルの変更が検出されたら、ユーザは設定ファイルのどのバージョンを保存するか聞かれることを忘れないでください。外部から設定ファイルが変更されれば必ず聞かれます。これは何も変えたくない管理者にとって煩わしいかもしれません。
			</div><div
              class="para">
				<code
                class="filename">.d</code> ディレクトリがない場合、設定ファイルを提供するパッケージ以外が、その設定ファイルを書き換えずにプログラムの設定を変更するのは不可能です。その代わり、ユーザに自分で設定ファイルを書き換えるよう案内し、そのやり方を <code
                class="filename">/usr/share/doc/<em
                  class="replaceable">package</em>/README.Debian</code> ファイルに記載しなければいけません。
			</div><div
              class="para">
				アプリケーションに依存しますが、<code
                class="filename">.d</code> ディレクトリは直接またはすべてのファイルを連結して設定ファイルを作成する外部スクリプトを介して使われます。最新の変更を反映させるため、ディレクトリ内のファイルを変更した後にスクリプトを実行することが重要です。同様に、自動的に生成された設定ファイルを直接編集しないことが重要です。なぜなら、スクリプトを実行すれば生成された設定ファイルに行ったすべての変更が失われるからです。どちらの方法をとるか (<code
                class="filename">.d</code> ディレクトリを直接使うかディレクトリからファイルを生成するか) は通常実装に依存します。しかし、どちらの場合でも設定の柔軟性が増えるのに対して、設定の複雑さは少ししか増加しません。Exim 4 メールサーバはファイルを生成する方針をとるアプリケーションの例です。具体的に言えば、ファイル (<code
                class="filename">/etc/exim4/conf.d/*</code>) に設定を書き込み、<code
                class="command">update-exim4.conf</code> コマンドがこれらを連結して <code
                class="filename">/var/lib/exim4/config.autogenerated</code> を生成します。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt.priorities"></a>6.2.5. パッケージ優先度の管理</h3></div></div></div><div
            class="para">
				APT の設定で最も重要な側面の 1 つに各パッケージソースに対する優先度の管理があります。たとえば、<span
              class="distribution distribution">テスト版</span>、<span
              class="distribution distribution">不安定版</span>、<span
              class="distribution distribution">実験版</span>から入手できる新しいパッケージを 1 つか 2 つあるディストリビューションにインストールしたいと思うかもしれません。利用できるパッケージに対してそれぞれ別の優先度を割り当てることが可能です (同じパッケージに対してバージョンやそれを提供しているディストリビューションに依存する異なる優先度を設定することも可能です)。優先度の設定は APT の挙動に影響をおよぼします。すなわち、各パッケージについて、APT は常に最も優先度の高いバージョンをインストールします (例外は、最も優先度の高いバージョンがインストール済みのバージョンよりも古い場合か 1000 より低い優先度を持っている場合です)。
			</div><a
            id="id-1.9.11.12.3"
            class="indexterm"></a><a
            id="id-1.9.11.12.4"
            class="indexterm"></a><a
            id="id-1.9.11.12.5"
            class="indexterm"></a><a
            id="id-1.9.11.12.6"
            class="indexterm"></a><a
            id="id-1.9.11.12.7"
            class="indexterm"></a><a
            id="id-1.9.11.12.8"
            class="indexterm"></a><a
            id="id-1.9.11.12.9"
            class="indexterm"></a><div
            class="para">
				APT はいくつかのデフォルト優先度を定義しています。インストール済みパッケージのバージョンは優先度 100 です。インストールされていないパッケージのバージョンはデフォルトで優先度 500 ですが、ターゲットリリース (<code
              class="literal">-t</code> コマンドラインオプションか <code
              class="literal">APT::Default-Release</code> の設定指示文によって定義します) に含まれるバージョンの場合、優先度 990 になります。
			</div><div
            class="para">
				優先度を変更するには、<code
              class="filename">/etc/apt/preferences</code> ファイルに、影響を受けるパッケージの名前、バージョン、パッケージの提供者、新しい優先度を指定するエントリを追加してください。
			</div><div
            class="para">
				APT は優先度が 1000 より高い場合を除いて、パッケージの古いバージョン (言い換えれば、現在インストールされているバージョンよりバージョン番号が低いパッケージ) をインストールしません。APT は常にこの制限に基づいて最も高い優先度のパッケージをインストールします。2 つのバージョンが同じ優先度の場合、APT は最新の (バージョン番号が最も高い) バージョンをインストールします。バージョンと優先度が同じで、パッケージの内容が異なる場合、APT はインストールされていないバージョンをインストールします (このルールはあるパッケージがリビジョン番号を変化させずに更新された場合に対応させるために作られました。通常はリビジョン番号を増加させなければいけません)。
			</div><div
            class="para">
				より具体的に言えば、0 より低い優先度を持つパッケージは決してインストールされません。0 より大きく 100 より少ない優先度を持つパッケージは、他のバージョンがインストールされていない場合に限り、インストールされます。100 以上で 500 より少ない優先度を持つパッケージは、インストール済みバージョンまたはターゲットリリース以外のディストリビューションに含まれるバージョンが自分のバージョンよりも新しい場合に限り、インストールされます。500 以上で 990 より少ない優先度を持つパッケージは、インストール済みのバージョンまたはターゲットリリースに含まれるバージョンが自分のバージョンよりも新しい場合に限り、インストールされます。990 以上で 1000 より少ない優先度を持つパッケージは、インストール済みバージョンが自分のバージョンよりも新しい場合を除いて、インストールされます。1000 以上の優先度を持つパッケージは、自分をインストールすることでパッケージのバージョンが低くなる場合でも、常にインストールされます。
			</div><div
            class="para">
				When APT checks <code
              class="filename">/etc/apt/preferences</code>, it first takes into account the most specific entries (often those specifying the concerned package), then the more generic ones (including for example all the packages of a distribution). If several generic entries exist, the first match is used. The available selection criteria include the package's name and the source providing it. Every package source is identified by the information contained in a <code
              class="filename">Release</code> file that APT downloads together with the <code
              class="filename">Packages</code> files. It specifies the origin (usually “Debian” for the packages of official mirrors, but it can also be a person's or an organization's name for third-party repositories). It also gives the name of the distribution (usually <span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span>, <span
              class="distribution distribution">Unstable</span> or <span
              class="distribution distribution">Experimental</span> for the standard distributions provided by Debian) together with its version (for example 9 for Debian <span
              class="distribution distribution">Stretch</span>). Let's have a look at its syntax through some realistic case studies of this mechanism.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SPECIFIC CASE</em></span> <span
                        class="distribution distribution">実験版</span>の優先度</strong></p></div></div></div><a
              id="id-1.9.11.12.15.2"
              class="indexterm"></a><div
              class="para">
				<span
                class="distribution distribution">実験版</span>のリポジトリが <code
                class="filename">sources.list</code> ファイルに書かれていたとしても、<span
                class="distribution distribution">実験版</span>に含まれるパッケージは決してインストールされません。なぜなら<span
                class="distribution distribution">実験版</span>に含まれるパッケージの優先度は 1 だからです。これはもちろん特例措置で、誤って<span
                class="distribution distribution">実験版</span>に含まれるパッケージをインストールするのを避けるためにこうなっています。<span
                class="distribution distribution">実験版</span>に含まれるパッケージをインストールする唯一の方法は <code
                class="command">aptitude install <em
                  class="replaceable">package</em>/experimental</code> と実行することです。こうすることでこのコマンドを実行するユーザは嫌でもリスクをとることに気付かされるでしょう。<span
                class="distribution distribution">実験版</span>に含まれるパッケージの優先度を 500 にして他のディストリビューションのパッケージと同列に扱うことも不可能ではありません (ただしこれは<span
                class="emphasis"><em>お勧めできません</em></span>)。これを実現するには <code
                class="filename">/etc/apt/preferences</code> に以下のエントリを含めてください。
			</div><div
              class="informalexample"><pre
                class="programlisting">Package: *
Pin: release a=experimental
Pin-Priority: 500</pre></div></div><div
            class="para">
				Debian の安定版バージョンに含まれるパッケージだけを使いたいと仮定します。安定版以外のバージョンに含まれるパッケージは、明示的に要求されない限り、インストールされるべきではありません。この場合、<code
              class="filename">/etc/apt/preferences</code> ファイルに以下のエントリを書きます。
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: *
Pin: release a=stable
Pin-Priority: 900

Package: *
Pin: release o=Debian
Pin-Priority: -10</pre></div><div
            class="para">
				<code
              class="literal">a=stable</code> の含まれるエントリはディストリビューションの名前が stable のパッケージの優先度を 900 にしています。<code
              class="literal">o=Debian</code> の含まれるエントリは、自分よりも前に評価されたエントリにマッチしなかった、共有元が「Debian」のパッケージの優先度を -10 にしています。
			</div><div
            class="para">
				Let's now assume that you have a server with several local programs depending on the version 5.24 of Perl and that you want to ensure that upgrades will not install another version of it. You could use this entry:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: perl
Pin: version 5.24*
Pin-Priority: 1001
</pre></div><div
            class="para">
				マニュアルページ <span
              class="citerefentry"><span
                class="refentrytitle">apt_preferences</span>(5)</span> には <code
              class="filename">/etc/apt/preferences</code> の記載方法に対する関連文書があります。これを表示するには <code
              class="command">man apt_preferences</code> を使ってください。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> <code
                        class="filename">/etc/apt/preferences</code> 内のコメント</strong></p></div></div></div><a
              id="id-1.9.11.12.22.2"
              class="indexterm"></a><a
              id="id-1.9.11.12.22.3"
              class="indexterm"></a><a
              id="id-1.9.11.12.22.4"
              class="indexterm"></a><div
              class="para">
				<code
                class="filename">/etc/apt/preferences</code> ファイルにコメントを記入する公式のやり方はありませんが、それぞれのエントリの前の行に「<code
                class="literal">Explanation</code>」フィールドを付けるとテキスト説明を記入できます。
			</div><div
              class="informalexample"><pre
                class="programlisting">Explanation: 実験版に含まれる xserver-xorg-video-intel
Explanation: パッケージは安全にお使いいただけます
Package: xserver-xorg-video-intel
Pin: release a=experimental
Pin-Priority: 500</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.apt-mix-distros"></a>6.2.6. 複数ディストリビューションの利用</h3></div></div></div><div
            class="para">
				<code
              class="command">apt</code> は素晴らしいツールであり、他のディストリビューションに含まれるパッケージをインストールする際に力を発揮します。たとえば、<span
              class="distribution distribution">安定版</span>システムをインストールした後に<span
              class="distribution distribution">テスト版</span>や<span
              class="distribution distribution">不安定版</span>に含まれるソフトウェアのパッケージを試したいが、システムを最初の状態から大きく変更したくないという場合に力を発揮します。
			</div><div
            class="para">
				パッケージごとに取得元ディストリビューションを変えていると、時々システムに問題が起きるかもしれませんが、<code
              class="command">apt</code> はシステム内に複数のディストリビューションをうまく共存させ、危険のおよぶ範囲をうまく限定します。進むべき最善の道は、<code
              class="filename">/etc/apt/sources.list</code> に共存させるすべてのディストリビューションを書いて (常に 3 つのディストリビューションを書いている人もいますが、<span
              class="distribution distribution">不安定版</span>は経験豊富なユーザ向けであることを忘れないでください)、<code
              class="literal">APT::Default-Release</code> パラメータで基準ディストリビューションを定義することです (<a
              class="xref"
              href="sect.apt-get.html#sect.apt-upgrade">第 6.2.3 節「システムのアップグレード」</a>を参照してください)。
			</div><div
            class="para">
				<span
              class="distribution distribution">安定版</span>を基準ディストリビューションと仮定し、併せて<span
              class="distribution distribution">テスト版</span>と<span
              class="distribution distribution">不安定版</span>用のリポジトリも <code
              class="filename">sources.list</code> ファイルに書かれていると仮定します。この場合、<span
              class="distribution distribution">テスト版</span>に含まれるパッケージをインストールするには <code
              class="command">apt install <em
                class="replaceable">package</em>/testing</code> を使います。依存関係の解決に失敗してインストールできなかった場合、<code
              class="literal">-t testing</code> パラメータを付けて<span
              class="distribution distribution">テスト版</span>を使って依存関係を解決させることが可能です。<span
              class="distribution distribution">不安定版</span>でも同じことが言えます。
			</div><div
            class="para">
				この状況では、アップグレード (<code
              class="command">upgrade</code> と <code
              class="command">full-upgrade</code>) は、アップグレード対象のパッケージが既に他のディストリビューションからインストールされている場合を除き、<span
              class="distribution distribution">安定版</span>のパッケージを使います。他のディストリビューションからインストールされたパッケージは、自分が含まれていたディストリビューションに利用できる更新がある場合に限り、アップグレードされます。以下では、APT によって設定されたデフォルト優先度の助けを借りてこの挙動を説明します。パッケージの優先度を確認するには、遠慮なく <code
              class="command">apt-cache policy</code> を使ってください (補注<a
              class="xref"
              href="sect.apt-get.html#sidebar.apt-cache-policy">「<span
                class="emphasis"><em>TIP</em></span> <code
                class="command">apt-cache policy</code>」</a>を参照してください)。
			</div><div
            class="para">
				APT はインストール済みのパッケージに比べてバージョンが高いか同じのパッケージだけを考慮するという事実を知れば、すべてを理解できます (ここでは <code
              class="filename">/etc/apt/preferences</code> の中に一部のパッケージに対して 1000 より高い優先度を強制する設定がないと仮定します)。
			</div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.apt-cache-policy"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> <code
                        class="command">apt-cache policy</code></strong></p></div></div></div><div
              class="para">
				優先度のメカニズムをさらに良く理解するためには、<code
                class="command">apt-cache policy</code> を実行し、各パッケージソースに対して設定されているデフォルトの優先度を確認してください。また、あるパッケージの利用できるバージョンすべてに対する優先度を表示するために <code
                class="command">apt-cache policy <em
                  class="replaceable">package</em></code> を使うことも可能です。
			</div></div><div
            class="para">
				あるパッケージの、<span
              class="distribution distribution">安定版</span>に含まれるバージョン 1 がインストール済みで、<span
              class="distribution distribution">テスト版</span>と<span
              class="distribution distribution">不安定版</span>に含まれるバージョン 2 と 3 が利用できると仮定しましょう。インストール済みバージョンの優先度は 100 ですが、<span
              class="distribution distribution">安定版</span>に含まれるバージョン (インストール済みのバージョンと全く同じバージョン) の (ターゲットリリースに含まれるバージョンの) 優先度は 990 です。<span
              class="distribution distribution">テスト版</span>と<span
              class="distribution distribution">不安定版</span>に含まれるバージョンの優先度 (インストールされていないバージョンに対するデフォルト優先度) は 500 です。この場合、インストール済みのバージョン 1 が最も高い優先度 990 を持ちます。パッケージは「<span
              class="distribution distribution">安定版</span>のまま」です。
			</div><div
            class="para">
				<span
              class="distribution distribution">テスト版</span>に含まれるバージョン 2 がインストール済みの場合について見てみましょう。<span
              class="distribution distribution">安定版</span>に含まれるバージョン 1 と<span
              class="distribution distribution">不安定版</span>に含まれるバージョン 3 が利用できます。バージョン 1 (優先度は 990。つまり 1000 より低いです) は、インストール済みバージョンよりもバージョンが低いため、無視されます。残るのはバージョン 2 か 3 ですが、両者の優先度は 500 です。優先度が同じ場合、APT は最も新しいバージョン、つまり<span
              class="distribution distribution">不安定版</span>に含まれるバージョン、を選択します。<span
              class="distribution distribution">テスト版</span>に含まれていたインストール済みバージョンを<span
              class="distribution distribution">不安定版</span>に含まれるバージョンに移行したくない場合、<span
              class="distribution distribution">不安定版</span>に含まれるバージョンに 500 よりも低い優先度 (たとえば 490 など) を割り当てないといけません。これを行うには、<code
              class="filename">/etc/apt/preferences</code> を以下のように修正してください。
			</div><pre
            class="programlisting">Package: *
Pin: release a=unstable
Pin-Priority: 490</pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.automatic-tracking"></a>6.2.7. 自動的にインストールされたパッケージの追跡</h3></div></div></div><div
            class="para">
				<code
              class="command">apt</code> の本質的な機能の 1 つに、依存関係によってのみインストールされたパッケージの追跡があります。これらのパッケージは「自動」と呼ばれ、たとえばライブラリなどがその一例です。
			</div><div
            class="para">
				With this information, when packages are removed, the package managers can compute a list of automatic packages that are no longer needed (because there is no “manually installed” packages depending on them). <code
              class="command">apt-get autoremove</code> or <code
              class="command">apt autoremove</code> will get rid of those packages. <code
              class="command">aptitude</code> does not have this command because it removes them automatically as soon as they are identified. In all cases, the tools display a clear message listing the affected packages.
			</div><a
            id="id-1.9.11.14.4"
            class="indexterm"></a><a
            id="id-1.9.11.14.5"
            class="indexterm"></a><a
            id="id-1.9.11.14.6"
            class="indexterm"></a><a
            id="id-1.9.11.14.7"
            class="indexterm"></a><div
            class="para">
				直接的に使うわけではないパッケージを自動パッケージとしてマークするのは良い癖です。こうすれば、そのパッケージがいらなくなった時に自動的に削除されます。<code
              class="command">apt-mark auto <em
                class="replaceable">package</em></code> はパッケージを自動パッケージとしてマークし、逆に <code
              class="command">apt-mark manual <em
                class="replaceable">package</em></code> は手動パッケージとしてマークします。<code
              class="command">aptitude markauto</code> と <code
              class="command">aptitude unmarkauto</code> は同様に動きますが、多くのパッケージを同時にマークする機能を持っています (<a
              class="xref"
              href="sect.apt-frontends.html#sect.aptitude">第 6.4.1 節「<code
                class="command">aptitude</code>」</a>を参照してください)。<code
              class="command">aptitude</code> のコンソールベース対話型インターフェースを使うと、多くのパッケージの「自動パッケージフラグ」を容易に確認できます。
			</div><a
            id="id-1.9.11.14.9"
            class="indexterm"></a><div
            class="para">
				自動的にインストールされたパッケージがシステムに存在する理由を知りたい場合があるかもしれません。この情報をコマンドラインから得るには、<code
              class="command">aptitude why <em
                class="replaceable">package</em></code> を使ってください (<code
              class="command">apt</code> および <code
              class="command">apt-get</code> に同様の機能はありません)。
			</div><pre
            class="screen"><code
              class="computeroutput">$ </code><strong
              class="userinput"><code>aptitude why python-debian
</code></strong><code
              class="computeroutput">i   aptitude         推奨 apt-xapian-index         
i A apt-xapian-index 依存 python-debian (&gt;= 0.1.15)
</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIVE</em></span> <code
                        class="command">deborphan</code> と <code
                        class="command">debfoster</code></strong></p></div></div></div><a
              id="id-1.9.11.14.12.2"
              class="indexterm"></a><a
              id="id-1.9.11.14.12.3"
              class="indexterm"></a><div
              class="para">
				<code
                class="command">apt</code>、<code
                class="command">apt-get</code>、<code
                class="command">aptitude</code> にまだ自動パッケージを追跡する機能がなかった時代、不要なパッケージをリストアップするユーティリティが 2 つありました。具体的に言えば、<code
                class="command">deborphan</code> と <code
                class="command">debfoster</code> です。
			</div><div
              class="para">
				<code
                class="command">deborphan</code> は最も原始的なツールです。<code
                class="command">deborphan</code> は単純に (他に指示のない限り) <code
                class="literal">libs</code> と <code
                class="literal">oldlibs</code> セクションを調べ、現在インストール済みで他のどのパッケージからも必要とされていないパッケージを探します。この結果は必要ないパッケージを削除するためのたたき台になります。
			</div><div
              class="para">
				<code
                class="command">debfoster</code> は APT とよく似たより複雑なアプローチを取ります。具体的に言えば、<code
                class="command">debfoster</code> は明示的にインストールされたパッケージのリストを保存し、毎回起動される度に本当に必要なパッケージを記録します。<code
                class="command">debfoster</code> が新しいパッケージをシステムに検出し、そのパッケージが必要か分からなかった場合、そのパッケージを依存関係のリストと一緒に画面に表示します。そして、選択肢を表示します。この選択肢の中には、パッケージを削除する (そのパッケージが依存するパッケージも一緒に削除するかもしれません)、明示的に必要とマークする、一時的にこれを無視するなどがあります。
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>戻る</strong>第 6 章 メンテナンスと更新、APT ツール</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>次へ</strong>6.3. apt-cache コマンド</a></li></ul></body></html>
