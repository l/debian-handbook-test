<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">第 10 章 ネットワークインフラ</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ja-JP-1.0-1" /><meta
        name="keywords"
        content="ネットワーク, ゲートウェイ, TCP/IP, IPv6, DNS, Bind, DHCP, QoS" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="prev"
        href="sect.power-management.html"
        title="9.12. 電源管理、Advanced Configuration and Power Interface (ACPI)" /><link
        rel="next"
        href="sect.virtual-private-network.html"
        title="10.2. 仮想プライベートネットワーク" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ja-JP/stable/network-infrastructure.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.power-management.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="sect.virtual-private-network.html"><strong>次へ</strong></a></li></ul><div
        xml:lang="ja-JP"
        class="chapter"
        lang="ja-JP"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  xmlns=""
                  id="network-infrastructure"></a>第 10 章 ネットワークインフラ</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="network-infrastructure.html#sect.gateway">10.1. ゲートウェイ</a></span></dt><dt><span
                class="section"><a
                  href="sect.virtual-private-network.html">10.2. 仮想プライベートネットワーク</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.openvpn">10.2.1. OpenVPN</a></span></dt><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.ssh-vpn">10.2.2. SSH を使った仮想プライベートネットワーク</a></span></dt><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.ipsec">10.2.3. IPsec</a></span></dt><dt><span
                    class="section"><a
                      href="sect.virtual-private-network.html#sect.pptp">10.2.4. PPTP</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.quality-of-service.html">10.3. Quality of Service</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.quality-of-service.html#sect.qos-principe">10.3.1. 原理とメカニズム</a></span></dt><dt><span
                    class="section"><a
                      href="sect.quality-of-service.html#sect.qos-config">10.3.2. 設定と実践</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.dynamic-routing.html">10.4. 動的ルーティング</a></span></dt><dt><span
                class="section"><a
                  href="sect.ipv6.html">10.5. IPv6</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.ipv6.html#sect.ipv6-tunneling">10.5.1. トンネル</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.domain-name-servers.html">10.6. ドメインネームサーバ (DNS)</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.domain-name-servers.html#sect.dns-principe">10.6.1. 原理とメカニズム</a></span></dt><dt><span
                    class="section"><a
                      href="sect.domain-name-servers.html#sect.dns-config">10.6.2. 設定</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.dhcp.html">10.7. DHCP</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.dhcp.html#sect.dhcp-config">10.7.1. 設定</a></span></dt><dt><span
                    class="section"><a
                      href="sect.dhcp.html#sect.dhcp-dns">10.7.2. DHCP と DNS</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.network-diagnosis-tools.html">10.8. ネットワーク診断ツール</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.network-diagnosis-tools.html#sect.netstat">10.8.1. ローカルの診断、<code
                        class="command">netstat</code></a></span></dt><dt><span
                    class="section"><a
                      href="sect.network-diagnosis-tools.html#sect.nmap">10.8.2. リモートの診断、<code
                        class="command">nmap</code></a></span></dt><dt><span
                    class="section"><a
                      href="sect.network-diagnosis-tools.html#sect.sniffers">10.8.3. スニファ、<code
                        class="command">tcpdump</code> と <code
                        class="command">wireshark</code></a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		Linux はネットワークに関する Unix の財産すべてを受け継ぎ、Debian はネットワークを作成および管理する完全なツールセットを提供します。この章では、これらのツールを説明します。
	</div></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    xmlns=""
                    id="sect.gateway"></a>10.1. ゲートウェイ</h2></div></div></div><div
            class="para">
			ゲートウェイは複数のネットワークを連結するシステムです。ゲートウェイという用語は外部 IP アドレスに向かう経路に出るために必須のローカルネットワークの「出口」を意味する場合が多いです。ゲートウェイは相互に連結する各ネットワークに接続されており、複数のインターフェース間で IP パケットを相互に伝送するためのルータとして振る舞います。
		</div><a
            id="id-1.13.4.3"
            class="indexterm"></a><a
            id="id-1.13.4.4"
            class="indexterm"></a><a
            id="id-1.13.4.5"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> IP パケット</strong></p></div></div></div><a
              id="id-1.13.4.6.2"
              class="indexterm"></a><div
              class="para">
			今日、多くのネットワークは IP プロトコル (<span
                class="emphasis"><em>インターネットプロトコル</em></span>) を使います。IP プロトコルは転送するデータを適当なサイズのパケットに分割します。それぞれのパケットには、実データ本体に加えて、適切な経路選択に必要な数々のデータが含まれます。
		</div></div><div
            class="sidebar"><a
              xmlns=""
              id="sidebar.tcp-udp"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> TCP/UDP</strong></p></div></div></div><a
              id="id-1.13.4.7.2"
              class="indexterm"></a><a
              id="id-1.13.4.7.3"
              class="indexterm"></a><a
              id="id-1.13.4.7.4"
              class="indexterm"></a><a
              id="id-1.13.4.7.5"
              class="indexterm"></a><div
              class="para">
			IP を使ってデータを送信する場合であっても、プログラムが個々のパケットそれ自体を処理することはほとんどありません。多くのプログラムは TCP (<span
                class="emphasis"><em>Transmission Control Protocol</em></span>) を使います。TCP は IP 上のレイヤで、2 点間にデータストリーム専用の接続を確立することが可能です。TCP を使うプログラムはデータを送り込むための入口を考慮するだけです。この入口から送信されたデータは接続の別の側にある出口から損失なく同じデータが (同じ順番で) 出てくると保証されます。TCP よりも下層のレイヤで起きるさまざまなエラーは TCP によって補正されます。具体的に言えば、損失したパケットはもう一度転送され、順番が狂って到着したパケット (たとえば、異なる経路で到着したために) は適切な順番にそろえられます。
		</div><div
              class="para">
			IP に依存するもう 1 つのプロトコルが UDP (<span
                class="emphasis"><em>User Datagram Protocol</em></span>) です。TCP と対照的に、UDP はパケット重視です。UDP の目標は TCP と異なります。すなわち、UDP の目標は 1 個のパケットをあるアプリケーションから別のアプリケーションに転送するだけです。UDP を使った場合、転送中のパケット損失は補償されませんし、パケットが送信順と同じ順番で受信されることも保証されません。UDP の主な利点は遅延が大きく改善される点です。なぜなら、1 パケットを損失しても、損失したパケットの再転送要求を出さないかぎり、損失したパケット以降に続くパケットの受信は遅延しないからです。
		</div><div
              class="para">
			TCP と UDP はどちらもポート番号を使います。ポート番号とは、マシン上で動くあるアプリケーションと通信を確立するための「内線番号」と言えます。この概念を使うことで、同一のマシンに対して複数の異なる通信を並列して保つことが可能になります。なぜなら、通信はポート番号で区別されるからです。
		</div><div
              class="para">
			IANA (<span
                class="emphasis"><em>Internet Assigned Numbers Authority</em></span>) が標準化したいくつかのポート番号は「well-known」とされ、ネットワークサービスに関連付けられています。たとえば、TCP ポート 25 番は一般に電子メールサーバが使うポート番号として標準化されています。<div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.iana.org/assignments/port-numbers">http://www.iana.org/assignments/port-numbers</a></div>
		</div></div><div
            class="para">
			ローカルネットワークがプライベートアドレス (インターネットにルーティングされないアドレス) 範囲を使う場合、ゲートウェイは<span
              class="emphasis"><em>アドレスマスカレード</em></span>を実行する必要があります。<span
              class="emphasis"><em>アドレスマスカレード</em></span>を使うことで、ローカルネットワーク上のマシンが外部と通信することが可能になります。マスカレード動作とはネットワークレベルのプロキシ動作のようなものです。すなわち、内部のマシンからの外部宛接続はゲートウェイ自身からの接続に置き替えられます (なぜなら、ゲートウェイは外部にルーティングできるアドレスを持っているからです)。マスカレード接続を通過するデータは外部に送信され、応答として戻ってくるデータはマスカレード接続を通過して内部のマシンに送信されます。ゲートウェイはこの目的に専用の TCP ポート範囲を使います。この範囲は通常とても大きな番号 (60000 番より大きい番号) です。内部マシンからの接続はこれらの予約されたポート番号の 1 つから送信された接続として外部に送信されます。
		</div><a
            id="id-1.13.4.9"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CULTURE</em></span> プライベートアドレス範囲</strong></p></div></div></div><a
              id="id-1.13.4.10.2"
              class="indexterm"></a><a
              id="id-1.13.4.10.3"
              class="indexterm"></a><div
              class="para">
			RFC 1918 では、インターネットにルーティングされずローカルネットワークにのみ使うことができる、IPv4 アドレスの範囲が定義されています。1 番目の <code
                class="literal">10.0.0.0/8</code> (補注<a
                class="xref"
                href="sect.network-config.html#sidebar.networking-basics">「<span
                  class="emphasis"><em>BACK TO BASICS</em></span> ネットワークの本質的概念 (イーサネット、IP アドレス、サブネット、ブロードキャスト)」</a>を参照してください) は 1 個のクラス A 範囲です (クラス A には 2<sup>24</sup> 個の IP アドレスが含まれます)。2 番目の <code
                class="literal">172.16.0.0/12</code> は 16 個のクラス B 範囲です (<code
                class="literal">172.16.0.0/16</code> から <code
                class="literal">172.31.0.0/16</code> まで)。クラス B には 2<sup>16</sup> 個の IP アドレスが含まれます。3 番目の <code
                class="literal">192.168.0.0/16</code> は 1 個のクラス B 範囲です (<code
                class="literal">192.168.0.0/24</code> から <code
                class="literal">192.168.255.0/24</code> までの 256 個のクラス C 範囲とも考えられます)。クラス C には 256 個の IP アドレスが含まれます。<div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc1918.html">http://www.faqs.org/rfcs/rfc1918.html</a></div>
		</div></div><div
            class="para">
			ゲートウェイでは 2 種類の<span
              class="emphasis"><em>ネットワークアドレス変換</em></span> (略して NAT) が実行されます。1 種類目は <span
              class="emphasis"><em>Destination NAT</em></span> (DNAT) で、(通常は) 到着した接続の宛先 IP アドレス (および TCP や UDP ポート) を書き換える手法です。接続追跡メカニズムによって、通信の継続性を保証するために同じ接続でそれ以降に使われるパケットの宛先が書き換えられます。NAT の 2 種類目は <span
              class="emphasis"><em>Source NAT</em></span> (SNAT) で、<span
              class="emphasis"><em>マスカレード</em></span>は SNAT の特別な場合です。SNAT は (通常は) 出て行く接続のソース IP アドレス (および TCP や UDP ポート) を書き換えます。DNAT に関して言えば、出て行く接続の全パケットが接続追跡メカニズムによって適切に取り扱われます。NAT は IPv4 と IPv4 の制限されたアドレス空間だけに関連します。一方で IPv6 では、アドレス空間が広くなったことにより、すべての「内部」アドレスは直接インターネットにルーティングできるようになるため、NAT の有用性が減ります (これは内部マシンにアクセスできるようになることを意味しているのではありません。なぜなら、中間ファイアウォールがトラフィックをフィルタするからです)。
		</div><a
            id="id-1.13.4.12"
            class="indexterm"></a><a
            id="id-1.13.4.13"
            class="indexterm"></a><a
            id="id-1.13.4.14"
            class="indexterm"></a><a
            id="id-1.13.4.15"
            class="indexterm"></a><a
            id="id-1.13.4.16"
            class="indexterm"></a><a
            id="id-1.13.4.17"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> ポート転送</strong></p></div></div></div><a
              id="id-1.13.4.18.2"
              class="indexterm"></a><div
              class="para">
			DNAT の具体的な応用例が<span
                class="emphasis"><em>ポート転送</em></span>です。マシンのあるポートに到着する接続が他のマシンのあるポートに転送されます。特にアプリケーションレベルでは <code
                class="command">ssh</code> (<a
                class="xref"
                href="sect.remote-login.html#sect.ssh-port-forwarding">第 9.2.1.3 節「ポート転送を使った暗号化トンネルの作成」</a>を参照してください) や <code
                class="command">redir</code> などを使うことで、同じ効果を果たす別の解決策が存在するかもしれません。
		</div></div><div
            class="para">
			理論はここまでにして、具体的な例を説明します。Debian システムをゲートウェイとして機能させるには、以下に示す通り <code
              class="filename">/proc/</code> 仮想ファイルシステムを使って、Linux カーネルの適切なオプションを有効化するだけです。
		</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>echo 1 &gt; /proc/sys/net/ipv4/conf/default/forwarding</code></strong></pre><div
            class="para">
			このオプションを起動時に自動的に有効化するには、<code
              class="filename">/etc/sysctl.conf</code> の <code
              class="literal">net.ipv4.conf.default.forwarding</code> オプションを <code
              class="literal">1</code> に設定してください。
		</div><div
            class="example"><a
              xmlns=""
              id="example.sysctl.conf"></a><p
              class="title"><strong>例 10.1 <code
                  class="filename">/etc/sysctl.conf</code> ファイル</strong></p><div
              class="example-contents"><pre
                class="programlisting">
net.ipv4.conf.default.forwarding = 1
net.ipv4.conf.default.rp_filter = 1
net.ipv4.tcp_syncookies = 1</pre></div></div><div
            class="para">
			IPv6 に対して同様の効果を与えるには、IPv4 に対して手作業で行ったコマンドの <code
              class="literal">ipv4</code> を単純に <code
              class="literal">ipv6</code> へ置換して実行するか、<code
              class="filename">/etc/sysctl.conf</code> 中の <code
              class="literal">net.ipv6.conf.all.forwarding</code> オプションを <code
              class="literal">1</code> に設定してください。
		</div><div
            class="para">
			IPv4 マスカレードを設定するには少し複雑な作業が必要です。すなわち <span
              class="emphasis"><em>netfilter</em></span> ファイアウォールを設定する必要があります。
		</div><div
            class="para">
			同様に、(IPv4 で) NAT を使うには <span
              class="emphasis"><em>netfilter</em></span> の設定が必要です。<span
              class="emphasis"><em>netfilter</em></span> の基本目的はパケットフィルタリングですから、詳細は<a
              class="xref"
              href="security.html">第 14 章: 「<em>セキュリティ</em>」</a>に書かれています (<a
              class="xref"
              href="sect.firewall-packet-filtering.html">第 14.2 節「ファイアウォールとパケットフィルタリング」</a>を参照してください)。
		</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.power-management.html"><strong>戻る</strong>9.12. 電源管理、Advanced Configuration and Power Inter...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.virtual-private-network.html"><strong>次へ</strong>10.2. 仮想プライベートネットワーク</a></li></ul></body></html>
