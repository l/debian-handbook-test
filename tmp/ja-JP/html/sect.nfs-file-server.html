<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.4. NFS ファイルサーバ</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-ja-JP-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="network-services.html"
        title="第 11 章 ネットワークサービス、Postfix、Apache、NFS、Samba、Squid、LDAP、SIP、XMPP、TURN" /><link
        rel="prev"
        href="sect.ftp-file-server.html"
        title="11.3. FTP ファイルサーバ" /><link
        rel="next"
        href="sect.windows-file-server-with-samba.html"
        title="11.5. Samba を使った Windows 共有のセットアップ" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ja-JP/stable/sect.nfs-file-server.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>次へ</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.nfs-file-server"></a>11.4. NFS ファイルサーバ</h2></div></div></div><div
          class="para">
			NFS (<span
            class="emphasis"><em>Network File System</em></span>) はネットワークを介したファイルシステムへのリモートアクセスをつかさどるプロトコルです。すべての Unix システムは NFS プロトコルを取り扱うことが可能です。一方で Windows システムを参加させる場合、代わりに Samba を使わなければいけません。
		</div><a
          id="id-1.14.7.3"
          class="indexterm"></a><a
          id="id-1.14.7.4"
          class="indexterm"></a><a
          id="id-1.14.7.5"
          class="indexterm"></a><a
          id="id-1.14.7.6"
          class="indexterm"></a><a
          id="id-1.14.7.7"
          class="indexterm"></a><div
          class="para">
			NFS はとても役に立つツールです。しかし、歴史的に言えば NFS には数多くの制約があり、NFS プロトコルのバージョン 4 になってほとんどの制約がなくなりました。制約がなくなったことによる欠点として、NFS の最新版では認証や暗号化などの基本的なセキュリティ機能を有効化するよう設定するのがさらに難しくなったという点が挙げられます。なぜなら、NFS の最新版ではこれらの機能は Kerberos に依存しているからです。認証や暗号化機能を有効化しない場合、NFS プロトコルを使うのは信用できるローカルネットワークだけに留めるべきです。なぜなら、ネットワークを流れるデータは暗号化されませんし (<span
            class="emphasis"><em>スニファ</em></span>を使えば内容を傍受することが可能ですし)、アクセス権はクライアントの IP アドレスに基づいて決定されるからです (IP アドレスはなりすまし可能です)。
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>DOCUMENTATION</em></span> NFS の HOWTO 文書</strong></p></div></div></div><div
            class="para">
			NFSv4 を配備する際に参考になる文書はまだ多くありません。以下に挙げた文書の品質はさまざまですが、これらの文書では最低限やるべき内容に関するいくつかのヒントが載せられています。<div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="https://help.ubuntu.com/community/NFSv4Howto">https://help.ubuntu.com/community/NFSv4Howto</a></div><div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration">http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration</a></div>
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.10"></a>11.4.1. NFS の安全確保</h3></div></div></div><a
            id="id-1.14.7.10.2"
            class="indexterm"></a><div
            class="para">
				Kerberos に基づくセキュリティ機能を使わない場合、NFS の利用を許可されたマシンだけが種々の要求された RPC サーバに接続できるような制限を加えることが不可欠です。なぜなら、NFS の基本的なプロトコルはネットワークから受け取った情報を信頼するからです。ファイアウォールは外部のマシンが内部のマシンのように振る舞うことを避けるために <span
              class="emphasis"><em>IP なりすまし</em></span>をブロックし、NFS 共有にアクセスするように意図されたマシンだけが適切なポートにアクセスするように制限しなければいけません。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> RPC</strong></p></div></div></div><div
              class="para">
				RPC (<span
                class="emphasis"><em>Remote Procedure Call</em></span>) はリモートサービスに関する Unix 標準です。NFS は RPC サービスの 1 つです。
			</div><a
              id="id-1.14.7.10.4.3"
              class="indexterm"></a><a
              id="id-1.14.7.10.4.4"
              class="indexterm"></a><div
              class="para">
				ディレクトリに登録する RPC サービスは <span
                class="emphasis"><em>portmapper</em></span> としても知られています。NFS 問い合わせを実行することを望むクライアントは最初に <span
                class="emphasis"><em>portmapper</em></span> (ポート 111 番、TCP または UDP) を呼び出し、NFS サーバの情報を要求します。通常、応答には NFS サーバのポート 2049 番 (NFS のデフォルト) が含まれます。すべての RPC サービスが必ず固定されたポートで使われる必要があるわけではありません。
			</div></div><div
            class="para">
				NFS プロトコルの古いバージョンでは他の RPC サービスが必要で、この RPC サービスは動的に割り当てられたポートを使います。幸いなことに、NFS バージョン 4 ではポート 2049 番 (NFS 用) と 111 番 (portmapper 用) が固定されており、そのため簡単にポートにファイアウォールをかませることが可能です。
			</div><a
            id="id-1.14.7.10.6"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.11"></a>11.4.2. NFS サーバ</h3></div></div></div><div
            class="para">
				NFS サーバは Linux カーネルの一部です。そして Debian の提供するカーネルでは、NFS サーバをカーネルモジュールとしてビルドしています。NFS サーバを起動時に自動的に実行するには、<span
              class="pkg pkg">nfs-kernel-server</span> パッケージをインストールしてください。このパッケージには、対応する起動スクリプトが含まれます。
			</div><div
            class="para">
				NFS サーバの設定ファイル <code
              class="filename">/etc/exports</code> には、ネットワークを介して利用できるようにする (<span
              class="emphasis"><em>エクスポートされる</em></span>) ディレクトリをリストします。各 NFS 共有について、リストされたマシンだけがアクセスを許可されます。よりきめ細かなアクセス制御を行うには、いくつかのオプションを使います。<code
              class="filename">/etc/exports</code> ファイルの構文はとても単純です。
			</div><a
            id="id-1.14.7.11.4"
            class="indexterm"></a><a
            id="id-1.14.7.11.5"
            class="indexterm"></a><pre
            class="programlisting">
/directory/to/share machine1(option1,option2,...) machine2(...) ...</pre><div
            class="para">
				NFSv4 では、すべてのエクスポートされるディレクトリは一つの基準ディレクトリの下位に属さなければいけません。また、その基準ディレクトリは必ずエクスポートされ、オプション <code
              class="literal">fsid=0</code> または <code
              class="literal">fsid=root</code> で識別されなければいけません。これらの点に注意してください。
			</div><div
            class="para">
				各マシンは DNS 名か IP アドレスのどちらか一方を使って識別されます。マシン群全体を指定するには、<code
              class="literal">*.falcot.com</code> などの構文を使うか <code
              class="literal">192.168.0.0/255.255.255.0</code> や <code
              class="literal">192.168.0.0/24</code> などの IP アドレス範囲を使います。
			</div><div
            class="para">
				ディレクトリはデフォルトで (または <code
              class="literal">ro</code> オプションを使えば) 読み込み専用として利用できるようにされます。<code
              class="literal">rw</code> オプションを使えば読み書きアクセスが許可されます。典型的に NFS クライアントは root だけが使えるポート (言い換えれば、1024 番よりも低い番号のポート) から接続します。高いポート番号を使うクライアントからの接続を受け入れるには、<code
              class="literal">insecure</code> オプションを使います (<code
              class="literal">secure</code> オプションは暗黙的に有効化されていますが、明示する必要があればオプションを明示することも可能です)。
			</div><a
            id="id-1.14.7.11.10"
            class="indexterm"></a><div
            class="para">
				デフォルトの状態では、サーバが NFS 問い合わせに応答するのは、現在のディスク操作が完了した (<code
              class="literal">sync</code> オプション) 後です。これを無効化するには、<code
              class="literal">async</code> オプションを使います。非同期書き込みを使うことで、性能はほんの少し向上しますが、信頼性は低下します。なぜなら、書き込み確認とディスクへの実際の書き込みの間にサーバがクラッシュした場合に、データを損失する危険性があるからです。デフォルト値が <code
              class="literal">sync</code> に変更されたのは最近なので (NFS バージョンによってデフォルト値が違うので)、明確に <code
              class="literal">sync</code> オプションを設定することを推奨します。
			</div><div
            class="para">
				NFS クライアントがファイルシステムに root 権限でアクセスすることを許可しないために、サーバは root ユーザからのすべての問い合わせを <code
              class="literal">nobody</code> ユーザからの問い合わせとして処理します。この挙動は <code
              class="literal">root_squash</code> オプションを使った場合の挙動に対応し、<code
              class="literal">root_squash</code> オプションはデフォルトで有効化されています。<code
              class="literal">no_root_squash</code> オプションを使うことで、この挙動は無効化されますが、<code
              class="literal">no_root_squash</code> オプションは危険であり管理されない環境で使うべきではありません。<code
              class="literal">anonuid=<em
                class="replaceable">uid</em></code> と <code
              class="literal">anongid=<em
                class="replaceable">gid</em></code> オプションを使うことで、UID/GID 65534 (これは <code
              class="literal">nobody</code> ユーザと <code
              class="literal">nogroup</code> グループに対応します) の代わりに使う別の偽ユーザを指定することが可能です。
			</div><div
            class="para">
				NFSv4 では <code
              class="literal">sec</code> オプションを追加してセキュリティレベルを指定することが可能です。デフォルト設定の <code
              class="literal">sec=sys</code> は特別なセキュリティ機能を有効化しません。<code
              class="literal">sec=krb5</code> は認証機能だけを有効化します。<code
              class="literal">sec=krb5i</code> は認証と整合性保護機能を有効化します。<code
              class="literal">sec=krb5p</code> はすべての機能、すなわち認証、整合性保護、プライバシー保護機能 (データ暗号化機能を含みます) を有効化します。これらを使うには、Kerberos サービスを動作させる必要があります (Kerberos サービスについては本書で解説されていません)。
			</div><div
            class="para">
				他のオプションも利用できます。オプションは <span
              class="citerefentry"><span
                class="refentrytitle">exports</span>(5)</span> マニュアルページで説明されています。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CAUTION</em></span> 初回インストール</strong></p></div></div></div><div
              class="para">
				<code
                class="filename">/etc/init.d/nfs-kernel-server</code> 起動スクリプトは <code
                class="filename">/etc/exports</code> に 1 つ以上の NFS 共有が含まれる場合にサーバを起動しますが、初期状態の <code
                class="filename">/etc/exports</code> には NFS 共有エントリが含まれないので、初回インストール時に NFS サーバは起動されません。<code
                class="filename">/etc/exports</code> ファイルを編集して適切なエントリを含めたら、NFS サーバを以下のコマンドで起動するべきです。
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>service nfs-kernel-server start</code></strong></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.12"></a>11.4.3. NFS クライアント</h3></div></div></div><a
            id="id-1.14.7.12.2"
            class="indexterm"></a><a
            id="id-1.14.7.12.3"
            class="indexterm"></a><div
            class="para">
				他のファイルシステムと同様、NFS 共有をシステムの階層構造に統合するにはマウント作業が必要です。NFS 共有ファイルシステムは特殊なので、<code
              class="command">mount</code> コマンドと <code
              class="filename">/etc/fstab</code> ファイルにいくつかの調整を行うパラメータを含める必要があります。
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.5"></a><p
              class="title"><strong>例 11.22 <code
                  class="command">mount</code> コマンドを用いた手作業によるマウント</strong></p><div
              class="example-contents"><pre
                class="screen">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>mount -t nfs4 -o rw,nosuid arrakis.internal.falcot.com:/shared /srv/shared</code></strong></pre></div></div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.6"></a><p
              class="title"><strong>例 11.23 <code
                  class="filename">/etc/fstab</code> ファイルの NFS エントリ</strong></p><div
              class="example-contents"><pre
                class="programlisting">
arrakis.internal.falcot.com:/shared /srv/shared nfs4 rw,nosuid 0 0</pre></div></div><div
            class="para">
				上の例で示したエントリを使うことで、システム起動時に <code
              class="literal">arrakis</code> サーバの <code
              class="filename">/shared/</code> NFS ディレクトリがローカルの <code
              class="filename">/srv/shared/</code> ディレクトリにマウントされます。ここでは読み書きアクセスを要求しています (このため <code
              class="literal">rw</code> パラメータを追加しています)。<code
              class="literal">nosuid</code> オプションは一種の保護手段で、共有ディレクトリに保存されているプログラムに設定された <code
              class="literal">setuid</code> または <code
              class="literal">setgid</code> ビットを無効化します。文書を保存するだけの目的で NFS 共有を使っている場合、<code
              class="literal">noexec</code> オプションを追加することを推奨します。これは共有ディレクトリに含まれるプログラムの実行を避けるものです。NFS サーバ上では <code
              class="filename">shared</code> ディレクトリは NFSv4 ルートエクスポート (たとえば <code
              class="filename">/export/shared</code>) の下位に属すディレクトリであり、最上位ディレクトリではありません。この点に注意してください。
			</div><div
            class="para">
				<span
              class="citerefentry"><span
                class="refentrytitle">nfs</span>(5)</span> マニュアルページでは、すべてのオプションをについて詳しく説明されています。
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>戻る</strong>11.3. FTP ファイルサーバ</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>次へ</strong>11.5. Samba を使った Windows 共有のセットアップ</a></li></ul></body></html>
