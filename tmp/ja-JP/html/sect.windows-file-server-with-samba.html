<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.5. Samba を使った Windows 共有のセットアップ</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ja-JP-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="network-services.html"
        title="第 11 章 ネットワークサービス、Postfix、Apache、NFS、Samba、Squid、LDAP、SIP、XMPP、TURN" /><link
        rel="prev"
        href="sect.nfs-file-server.html"
        title="11.4. NFS ファイルサーバ" /><link
        rel="next"
        href="sect.http-ftp-proxy.html"
        title="11.6. HTTP/FTP プロキシ" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ja-JP/stable/sect.windows-file-server-with-samba.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.nfs-file-server.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="sect.http-ftp-proxy.html"><strong>次へ</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.windows-file-server-with-samba"></a>11.5. Samba を使った Windows 共有のセットアップ</h2></div></div></div><div
          class="para">
			Samba は Linux 上で SMB プロトコル (「CIFS」としても知られています) を取り扱う一連のツールを指します。Windows はネットワーク共有と共有プリンタを使うために SMB プロトコルを使います。
		</div><a
          id="id-1.14.8.3"
          class="indexterm"></a><a
          id="id-1.14.8.4"
          class="indexterm"></a><a
          id="id-1.14.8.5"
          class="indexterm"></a><a
          id="id-1.14.8.6"
          class="indexterm"></a><a
          id="id-1.14.8.7"
          class="indexterm"></a><div
          class="para">
			さらに Samba は Windows ドメインコントローラとして振る舞うことも可能です。Samba は Linux サーバと Windows が実行されているオフィスデスクトップマシンを完璧に統合する卓越したツールです。
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.8.9"></a>11.5.1. Samba サーバ</h3></div></div></div><div
            class="para">
				<span
              class="pkg pkg">samba</span> パッケージには、Samba 4 の主要な 2 種類のサーバ <code
              class="command">smbd</code> と <code
              class="command">nmbd</code> が含まれます。
			</div><a
            id="id-1.14.8.9.3"
            class="indexterm"></a><a
            id="id-1.14.8.9.4"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DOCUMENTATION</em></span> 詳細情報</strong></p></div></div></div><div
              class="para">
				Samba サーバは非常に細かく設定できますし、多目的に使えます。そして、Samba は全く異なる要求やネットワークアーキテクチャに応じてさまざまな用途に使われます。本書では、Samba を独立型サーバとして使う用途に注目します。しかし、Samba を NT4 ドメインコントローラとして使ったり、完全な Active Directory ドメインコントローラとして使ったり、既存のドメイン (Windows サーバによってこれを管理することも可能です) の単なるメンバとして使ったりすることも可能です。
			</div><a
              id="id-1.14.8.9.5.3"
              class="indexterm"></a><a
              id="id-1.14.8.9.5.4"
              class="indexterm"></a><div
              class="para">
				<span
                class="pkg pkg">samba-doc</span> パッケージには大量のコメント済み例ファイルが含まれ、これらは <code
                class="filename">/usr/share/doc/samba-doc/examples/</code> に保存されています。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TOOL</em></span> 認証に Windows サーバを使う</strong></p></div></div></div><div
              class="para">
				Winbind を使うことで、システム管理者は Windows サーバを認証サーバとして使う選択肢を与えられます。Winbind は PAM と NSS をうまく統合します。このことにより、Windows ドメインの全ユーザが自動的にアカウントを取得できる Linux マシン群をセットアップすることが可能です。
			</div><a
              id="id-1.14.8.9.6.3"
              class="indexterm"></a><div
              class="para">
				より詳しい情報は <code
                class="filename">/usr/share/doc/samba-doc/examples/pam_winbind/</code> ディレクトリに含まれるファイルで説明されています。
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.9.7"></a>11.5.1.1. <code
                      class="command">debconf</code> を使った設定</h4></div></div></div><div
              class="para">
					<span
                class="pkg pkg">samba</span> パッケージは初回インストール時に最低限の設定を行いますが、設定を適用するには実際に <code
                class="command">dpkg-reconfigure samba-common</code> を実行するべきです。
				</div><div
              class="para">
					最初の質問で、Samba サーバが所属するワークグループの名前を尋ねられます (Falcot Corp の場合、この質問に対する回答は <code
                class="literal">FALCOTNET</code> です)。
				</div><div
              class="para">
					次の質問で、DHCP デーモンによって提供される情報を使って WINS サーバを識別するか否かを尋ねられます。Falcot Corp の管理者はこのオプションを拒否しました。なぜなら、管理者は Samba サーバ自体を WINS サーバとして利用する予定だからです。
				</div><a
              id="id-1.14.8.9.7.5"
              class="indexterm"></a></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.9.8"></a>11.5.1.2. 手作業による設定</h4></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.14.8.9.8.2"></a>11.5.1.2.1. <code
                        class="filename">smb.conf</code> の変更</h5></div></div></div><div
                class="para">
						Falcot の用途に対応させるためには、<code
                  class="filename">/etc/samba/smb.conf</code> 設定ファイルに含まれる他のオプションを変更することが必要です。以下の抜粋は <code
                  class="literal">[global]</code> セクションに対する変更点を要約したものです。
					</div><pre
                class="programlisting">
[global]

## 閲覧および身元確認 ###

# Samba サーバが所属するワークグループおよび NT ドメイン名に変更してください。
   workgroup = FALCOTNET

# 以下は Windows Internet Name Serving サポートを設定します。WINS Support
# オプションを yes に設定すると Samba の NMBD が WINS サーバとして機能します。
   wins support = yes <span
                  id="smb.conf.wins"><img
                    class="callout"
                    src="Common_Content/images/1.png"
                    alt="1" /></span>

[...]

####### 認証 #######

# Server role オプションは Samba の動作モードを設定します。
# 設定できる値は "standalone server"、"member server"、"classic primary
# domain controller"、"classic backup domain controller"、"active
# directory domain controller" のうちどれか 1 つです。
#
# 多くの場合 "standalone sever" または "member server" を設定すると
# 良いでしょう。"active directory domain controller" を設定する場合、
# 事前に "samba-tool domain provision" を実行し、
# データベースを消去して新しいドメインを作成する必要があります。
   server role = standalone server

# security オプションの推奨設定は "security = user" です。この場合、Samba サーバ
# にアクセスするユーザはこのサーバの Unix アカウントを持っていなければいけません。
   security = user <span
                  id="smb.conf.security"><img
                    class="callout"
                    src="Common_Content/images/2.png"
                    alt="2" /></span>

[...]</pre><div
                class="calloutlist"><table
                  border="0"
                  summary="Callout list"><tr><td
                      width="5%"
                      valign="top"
                      align="left"><p><a
                          href="#smb.conf.wins"><img
                            class="callout"
                            src="Common_Content/images/1.png"
                            alt="1" /></a> </p></td><td
                      valign="top"
                      align="left"><div
                        class="para">
								Samba がローカルネットワークの Netbios ネームサーバ (WINS) として振る舞うことを意味します。
							</div></td></tr><tr><td
                      width="5%"
                      valign="top"
                      align="left"><p><a
                          href="#smb.conf.security"><img
                            class="callout"
                            src="Common_Content/images/2.png"
                            alt="2" /></a> </p></td><td
                      valign="top"
                      align="left"><div
                        class="para">
								これは security パラメータのデフォルト値です。しかしながら、security パラメータは Samba 設定の要ですから、明示的に指定することをお勧めします。各ユーザは、共有の種類に関わらず必ず共有にアクセスする前に認証を必要とします。
							</div></td></tr></table></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.14.8.9.8.3"></a>11.5.1.2.2. ユーザの追加</h5></div></div></div><div
                class="para">
						各 Samba ユーザはサーバにアカウントを持っていなければいけません。このため管理者は最初に Unix アカウントを作成し、そのアカウントを Samba のデータベースに登録する必要があります。Unix アカウントを作成する段階は通常通り行います (たとえば <code
                  class="command">adduser</code> を使います)。
					</div><div
                class="para">
						既存のユーザを Samba データベースに追加するには、<code
                  class="command">smbpasswd -a <em
                    class="replaceable">user</em></code> コマンドを実行します。コマンドは対話的にパスワードを尋ねます。
					</div><div
                class="para">
						ユーザを削除するには、<code
                  class="command">smbpasswd -x <em
                    class="replaceable">user</em></code> コマンドを実行します。Samba アカウントを一時的に利用できなくしたり (<code
                  class="command">smbpasswd -d <em
                    class="replaceable">user</em></code> を使います)、もう一度利用できるようにしたり (<code
                  class="command">smbpasswd -e <em
                    class="replaceable">user</em></code> を使います) することも可能です。
					</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.8.10"></a>11.5.2. Samba クライアント</h3></div></div></div><div
            class="para">
				Samba のクライアント機能を使うことで、Linux マシンは Windows 共有と共有プリンタへアクセスすることが可能になります。必要なプログラムは <span
              class="pkg pkg">cifs-utils</span> と <span
              class="pkg pkg">smbclient</span> パッケージに含まれます。
			</div><a
            id="id-1.14.8.10.3"
            class="indexterm"></a><a
            id="id-1.14.8.10.4"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.10.5"></a>11.5.2.1. <code
                      class="command">smbclient</code> プログラム</h4></div></div></div><div
              class="para">
					<code
                class="command">smbclient</code> プログラムは SMB サーバに問い合わせを行います。特定のユーザ名を使ってサーバに接続するには <code
                class="literal">-U <em
                  class="replaceable">user</em></code> オプションを使います。<code
                class="command">smbclient //<em
                  class="replaceable">server</em>/<em
                  class="replaceable">share</em></code> はコマンドライン FTP クライアントに類似した対話的方法を使って共有にアクセスします。<code
                class="command">smbclient -L <em
                  class="replaceable">server</em></code> は対象のサーバで利用できる (見える) 共有を全部リストします。
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.10.6"></a>11.5.2.2. Windows 共有のマウント</h4></div></div></div><div
              class="para">
					<code
                class="command">mount</code> コマンドを使うことで、Windows 共有を Linux ファイルシステム階層にマウントすることが可能になります (<span
                class="pkg pkg">cifs-utils</span> の提供する <code
                class="command">mount.cifs</code> の助けを借ります)。
				</div><a
              id="id-1.14.8.10.6.3"
              class="indexterm"></a><a
              id="id-1.14.8.10.6.4"
              class="indexterm"></a><div
              class="example"><a
                xmlns=""
                id="id-1.14.8.10.6.5"></a><p
                class="title"><strong>例 11.24 Windows 共有をマウントする</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
mount -t cifs //arrakis/shared /shared \
      -o credentials=/etc/smb-credentials</pre></div></div><div
              class="para">
					<code
                class="filename">/etc/smb-credentials</code> ファイル (ユーザはこのファイルを読み込むことはできません) は以下の書式で書かれています。
				</div><pre
              class="programlisting">
username = <em
                class="replaceable">user</em>
password = <em
                class="replaceable">password</em></pre><div
              class="para">
					コマンドラインで指定できるオプションは他にも存在します。オプションの完全なリストは <span
                class="citerefentry"><span
                  class="refentrytitle">mount.cifs</span>(8)</span> マニュアルページに書かれています。オプションの中でも特に次の 2 種類は興味深いです。<code
                class="literal">uid</code> と <code
                class="literal">gid</code> を使うことで、マウントされたことで利用できるようになったファイルの所有者とグループを指定したものに強制することが可能になります。これを指定することで、root 以外のユーザもマウント先にアクセスできるようになります。
				</div><div
              class="para">
					<code
                class="filename">/etc/fstab</code> の中に設定を書いて、Windows 共有をマウントすることも可能です。
				</div><pre
              class="programlisting">
//<em
                class="replaceable">server</em>/shared /shared cifs credentials=/etc/smb-credentials</pre><div
              class="para">
					SMB/CIFS 共有をアンマウントするには、標準的な <code
                class="command">umount</code> コマンドを使います。
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.10.7"></a>11.5.2.3. 共有プリンタを用いた印刷</h4></div></div></div><div
              class="para">
					CUPS は Linux ワークステーションから Windows マシンによって共有されているプリンタに印刷を行う洗練された解決策です。<span
                class="pkg pkg">smbclient</span> がインストールされている場合、CUPS を使うことで、Windows 共有プリンタを自動的にインストールすることが可能です。
				</div><a
              id="id-1.14.8.10.7.3"
              class="indexterm"></a><div
              class="para">
					以下に必要な各段階を示します。
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							CUPS 設定インターフェース <code
                      class="literal">http://localhost:631/admin</code> にアクセスします。
						</div></li><li
                  class="listitem"><div
                    class="para">
							「Add Printer」をクリックします。
						</div></li><li
                  class="listitem"><div
                    class="para">
							プリンタデバイスを選択し、「Windows Printer via SAMBA」を選んでください。
						</div></li><li
                  class="listitem"><div
                    class="para">
							ネットワークプリンタの接続 URI を入力します。URI は以下の書式を使うべきです。
						</div><div
                    class="para">
							<code
                      class="literal">smb://<em
                        class="replaceable">user</em>:<em
                        class="replaceable">password</em>@<em
                        class="replaceable">server</em>/<em
                        class="replaceable">printer</em></code>
						</div></li><li
                  class="listitem"><div
                    class="para">
							プリンタを一意に識別する名前を入力してください。その後、プリンタの説明と場所を入力してください。これらは、プリンタの利用者が印刷に使うプリンタを識別できるように、利用者に表示される文字列です。
						</div></li><li
                  class="listitem"><div
                    class="para">
							プリンタの製造者/モデルを指示するか、使用するプリンタの説明ファイル (PPD) を直接提供します。
						</div></li></ul></div><div
              class="para">
					これで、プリンタが利用できるようになりました!
				</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.nfs-file-server.html"><strong>戻る</strong>11.4. NFS ファイルサーバ</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.http-ftp-proxy.html"><strong>次へ</strong>11.6. HTTP/FTP プロキシ</a></li></ul></body></html>
