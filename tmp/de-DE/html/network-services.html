<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">Kapitel 11. Netzwerkdienste: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-de-DE-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Das Debian Administrationshandbuch" /><link
        rel="up"
        href="index.html"
        title="Das Debian Administrationshandbuch" /><link
        rel="prev"
        href="sect.network-diagnosis-tools.html"
        title="10.8. Werkzeuge für die Netzwerk-Diagnose" /><link
        rel="next"
        href="sect.http-web-server.html"
        title="11.2. Webserver (HTTP)" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/de-DE/stable/network-services.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>Zurück</strong></a></li><li
          class="home">Das Debian Administrationshandbuch</li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>Weiter</strong></a></li></ul><div
        xml:lang="de-DE"
        class="chapter"
        lang="de-DE"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  xmlns=""
                  id="network-services"></a>Kapitel 11. Netzwerkdienste: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="network-services.html#sect.smtp-mail-server">11.1. Mail-Server</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.7">11.1.1. Postfix installieren</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.configuring-virtual-domains">11.1.2. Virtuelle Domains konfigurieren</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.restrictions-for-receiving-and-sending">11.1.3. Einschränkungen beim Empfangen und Senden</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.setting-up-greylisting">11.1.4. <span
                        class="foreignphrase"><em
                          class="foreignphrase">Greylisting</em></span> einrichten</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.11">11.1.5. Filter anhand des Empfängers einstellen</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.postfix-antivirus">11.1.6. Einen Virenschutz integrieren</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.authenticated-smtp">11.1.7. Authentifiziertes SMTP</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-web-server.html">11.2. Webserver (HTTP)</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.9">11.2.1. Apache installieren</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.10">11.2.2. Virtuelle Hosts konfigurieren</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.11">11.2.3. Gebräuchliche Anweisungen</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.12">11.2.4. Protokoll-Analysatoren</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ftp-file-server.html">11.3. FTP-Dateiserver</a></span></dt><dt><span
                class="section"><a
                  href="sect.nfs-file-server.html">11.4. NFS-Dateiserver</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.10">11.4.1. NFS absichern</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.11">11.4.2. NFS-Server</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.12">11.4.3. NFS-Client</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.windows-file-server-with-samba.html">11.5. Einrichten von Windows-Freigaben mit Samba</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.9">11.5.1. Samba-Server</a></span></dt><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.10">11.5.2. Samba-Client</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-ftp-proxy.html">11.6. HTTP/FTP-Proxy</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.8">11.6.1. Installieren</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.9">11.6.2. Einen Cache konfigurieren</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.10">11.6.3. Einen Filter konfigurieren</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ldap-directory.html">11.7. LDAP-Verzeichnis</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.7">11.7.1. Installieren</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.8">11.7.2. Das Verzeichnis ausfüllen</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.9">11.7.3. Konten mit LDAP verwalten</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.rtc-services.html">11.8. Echtzeit-Kommunikationsdienste</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-dns-settings">11.8.1. DNS-Einstellungen für RTC-Dienste</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.turn-server">11.8.2. TURN Server</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.sip-server">11.8.3. SIP Proxy Server</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.xmpp-server">11.8.4. XMPP Server</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-port-443">11.8.5. Laufende Dienste auf Port 443</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-webrtc">11.8.6. Adding WebRTC</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		Netzwerkdienste sind die Programme, mit denen Benutzer in ihrer täglichen Arbeit direkt interagieren. Sie sind die Spitze des Eisbergs des Informationssystems, und dieses Kapitel richtet sein Hauptaugenmerk auf sie; die verborgenen Teile, auf denen sie aufbauen, sind die Infrastruktur, die wir bereits besprochen haben.
	</div><div
            class="para">
		Viele moderne Netzwerkdienste erfordern Verschlüsselung um zuverlässig und sicher zu funktionieren, besonders wenn diese im öffentlichen Internet verwendet werden. X.509 Zertifikate (die auch SSL Zertifikate oder TLS Zertifikate genannt werden) werden für diesen Zweck häufig eingesetzt. Ein Zertifikat für eine spezielle Domäne kann von mehr als einem in diesem Papier diskutierten Diensten verwendet werden.
	</div><a
            id="id-1.14.3.3"
            class="indexterm"></a><a
            id="id-1.14.3.4"
            class="indexterm"></a><a
            id="id-1.14.3.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    xmlns=""
                    id="sect.smtp-mail-server"></a>11.1. Mail-Server</h2></div></div></div><div
            class="para">
			Die Falcot Corp. Administratoren haben Postfix wegen seiner Zuverlässigkeit und seiner leichten Konfigurierbarkeit als elektronischen Mail-Server gewählt. Sein Design zwingt dazu, jede Aufgabe als Prozess mit dem geringstmöglichen Satz an Berechtigungen umzusetzen, eine gute Vorbeugungsmaßnahme gegen Sicherheitsprobleme.
		</div><a
            id="id-1.14.4.3"
            class="indexterm"></a><a
            id="id-1.14.4.4"
            class="indexterm"></a><a
            id="id-1.14.4.5"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIVE</em></span> Der Exim4-Server</strong></p></div></div></div><a
              id="id-1.14.4.6.2"
              class="indexterm"></a><div
              class="para">
			Debian verwendet Exim4 standardmäßig als E-Mail-Server (daher enthält die Erstinstallation auch Exim4). Die Konfiguration wird durch ein separates Paket, <span
                class="pkg pkg">exim4-config</span>, bereitgestellt und selbsttätig anhand der Antworten auf eine Anzahl von Debconf-Fragen eingerichtet, in ähnlicher Weise wie bei den vom Paket <span
                class="pkg pkg">postfix</span> gestellten Fragen.
		</div><div
              class="para">
			Die Konfiguration kann sich entweder in einer einzelnen Datei (<code
                class="filename">/etc/exim4/exim4.conf.template</code>) befinden oder über mehrere einzelne Konfigurationsdateien verteilt sein, die unter <code
                class="filename">/etc/exim4/conf.d/</code> gespeichert sind. In beiden Fällen werden die Dateien von <code
                class="command">update-exim4.conf</code> als Vorlage benutzt, um <code
                class="filename">/var/lib/exim4/config.autogenerated</code> zu erzeugen. Letztere Datei wird von Exim4 benutzt. Dank diesem Mechanismus können die durch die Debconf-Konfiguration von Exim zur Verfügung gestellten Werte — die in <code
                class="filename">/etc/exim4/update-exim4.conf.conf</code> gespeichert sind — in die Konfigurationsdatei von Exim eingefügt werden, auch dann, wenn ein Administrator oder ein anderes Paket die Standard-Einstellungen verändert hat.
		</div><div
              class="para">
			Die Syntax der Exim4-Konfigurationsdatei hat ihre Besonderheiten und erfordert eine Lernphase; sobald man jedoch diese Besonderheiten verstanden hat, ist Exim4 ein sehr umfassender und leistungsstarker E-Mail-Server, wie Dutzende von Dokumentationsseiten zeigen. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.exim.org/docs.html">http://www.exim.org/docs.html</a></div>
		</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.14.4.7"></a>11.1.1. Postfix installieren</h3></div></div></div><div
              class="para">
				Das Paket <span
                class="pkg pkg">postfix</span> enthält den Kern des SMTP-Daemons. Andere Pakete (wie <span
                class="pkg pkg">postfix-ldap</span> und <span
                class="pkg pkg">postfix-pgsql</span>) fügen weitere Funktionsmerkmale zu Postfix hinzu, einschließlich des Zugangs zu Zuordnungsdatenbanken. Sie sollten sie nur installieren, wenn Sie wissen, dass Sie sie benötigen.
			</div><div
              class="sidebar"><a
                xmlns=""
                id="sidebar.smtp"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ZURÜCK ZU DEN GRUNDLAGEN</em></span> SMTP</strong></p></div></div></div><a
                id="id-1.14.4.7.3.2"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.3"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.4"
                class="indexterm"></a><div
                class="para">
				SMTP (<span
                  class="emphasis"><em>Simple Mail Transfer Protocol</em></span>) ist das von Mail-Servern für den Austausch und die Zustellung von E-Mails verwendete Protokoll.
			</div></div><div
              class="para">
				Während der Installation des Pakets werden mehrere Debconf-Fragen gestellt. Die Antworten ermöglichen es, eine erste Version der Konfigurationsdatei <code
                class="filename">/etc/postfix/main.cf</code> zu erstellen.
			</div><div
              class="para">
				Die erste Frage bezieht sich auf die Art der Aufbaus. Nur zwei der vorgeschlagenen Antworten sind im Falle eines mit dem Internet verbundenen Servers relevant, „Internet site“ und „Internet with smarthost“. Die erste ist für einen Server richtig, der eingehende E-Mails empfängt und ausgehende E-Mails direkt an ihre Empfänger verschickt, und ist daher für die Situation der Falcot Corp. gut geeignet. Die zweite ist für einen Server angebracht, der eingehende E-Mails normal empfängt, aber ausgehende E-Mails über einen zwischengeschalteten SMTP-Server - den „smarthost“ - verschickt, statt direkt an den Server des Empfängers. Dies ist meistens für Personen mit einer dynamischen IP-Adresse sinnvoll, da viele E-Mail-Server Nachrichten, die direkt von einer derartigen IP-Adresse kommen, zurückweisen. In diesem Fall ist der Smarthost gewöhnlich der SMTP-Server des ISPs, der stets so konfiguriert ist, dass er E-Mails annimmt, die von den Kunden des ISP kommen, und sie in geeigneter Weise weiterleitet. Dieser Aufbau (mit einem Smarthost) ist auch für Server relevant, die nicht ständig mit dem Internet verbunden sind, da es so nicht erforderlich ist, eine Warteschlange nicht zustellbarer Nachrichten zu verwalten, für die später ein neuer Zustellversuch unternommen werden muss.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>WÖRTERVERZEICHNIS</em></span> ISP</strong></p></div></div></div><a
                id="id-1.14.4.7.6.2"
                class="indexterm"></a><div
                class="para">
				ISP ist die Abkürzung für „Internet Service Provider“. Hiermit ist eine Einrichtung gemeint, in vielen Fällen ein kommerzielles Unternehmen, die Internetverbindungen und damit zusammenhängende grundlegende Dienste (E-Mail, Nachrichten und so weiter) bereitstellt.
			</div><div
                class="para">
			</div></div><div
              class="para">
				Die zweite Frage bezieht sich auf die vollständige Bezeichnung des Rechners, die zur Erstellung von E-Mail-Adressen aus einem lokalen Benutzernamen verwendet wird; die vollständige Bezeichnung des Rechners wird zu dem Teil hinter dem at-Zeichen („@“). Im Falle von Falcot sollte die Antwort <code
                class="literal">mail.falcot.com</code> lauten. Dies ist die einzige standardmäßig gestellte Frage, aber die Konfigurierung, zu der sie führt, ist für die Bedürfnisse von Falcot nicht vollständig genug, weshalb die Administratoren <code
                class="command">dpkg-reconfigure postfix</code> aufrufen, um so weitere Parameter einstellen zu können.
			</div><div
              class="para">
				Eine der zusätzlichen Fragen erkundigt sich nach allen Domain-Namen, die mit diesem Rechner in Zusammenhang stehen. Die Standardliste umfasst seine vollständige Bezeichnung sowie einige Synonyme für <code
                class="literal">localhost</code>, jedoch muss die Hauptdomain <code
                class="literal">falcot.com</code> von Hand hinzugefügt werden. Allgemeiner gesagt sollte diese Frage normalerweise mit allen Domain-Namen beantwortet werden, für die dieser Rechner als MX-Server dienen soll; mit anderen Worten, allen Domain-Namen, für die der DNS angibt, dass dieser Rechner E-Mails annimmt. Diese Information geht in die Variable <code
                class="literal">mydestination</code> der Hauptkonfigurationsdatei von Postfix — <code
                class="filename">/etc/postfix/main.cf</code> — ein.
			</div><a
              id="id-1.14.4.7.9"
              class="indexterm"></a><a
              id="id-1.14.4.7.10"
              class="indexterm"></a><div
              class="figure"><a
                xmlns=""
                id="id-1.14.4.7.11"></a><div
                class="figure-contents"><div
                  class="mediaobject"><img
                    src="images/mail-server.png"
                    alt="Rolle des DNS-MX-Eintrags beim Versenden einer E-Mail" /></div></div><p
                class="title"><strong>Abbildung 11.1. Rolle des DNS-<span
                    class="emphasis"><em>MX</em></span>-Eintrags beim Versenden einer E-Mail</strong></p></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>EXTRA</em></span> Die MX-Einträge abfragen</strong></p></div></div></div><div
                class="para">
				Wenn im DNS kein MX-Eintrag für eine Domain vorliegt, versucht der E-Mail-Server, die Nachrichten unter Verwendung des passenden A-Eintrags (oder AAAA bei IPv6) an den Host selbst zu schicken.
			</div></div><div
              class="para">
				In manchen Fällen kann während der Installation auch gefragt werden, welchen Netzwerken es erlaubt sein soll, E-Mails über den Rechner zu verschicken. In seiner Standard-Konfiguration akzeptiert Postfix nur E-Mails, die von diesem Rechner selbst kommen; das lokale Netzwerk wird gewöhnlich hinzugefügt. Die Falcot Corp. Administratoren haben <code
                class="literal">192.168.0.0/16</code> zur Standardantwort hinzugefügt. Falls diese Frage nicht gestellt wird, ist <code
                class="literal">mynetworks</code> die relevante Variable in der Konfigurationsdatei, wie in unten stehendem Beispiel zu sehen ist.
			</div><div
              class="para">
				Lokale E-Mail kann auch durch <code
                class="command">procmail</code> zugestellt werden. Dieses Programm ermöglicht es Benutzern, ihre ankommende E-Mail nach Regeln, die in der Datei <code
                class="filename">~/.procmailrc</code> gespeichert sind, zu sortieren.
			</div><a
              id="id-1.14.4.7.15"
              class="indexterm"></a><a
              id="id-1.14.4.7.16"
              class="indexterm"></a><a
              id="id-1.14.4.7.17"
              class="indexterm"></a><div
              class="para">
				Nach diesem ersten Schritt verfügen die Administratoren über die folgende Konfigurationsdatei; sie wird als Ausgangspunkt verwendet, um in den nächsten Abschnitten einige weitere Funktionsmerkmale hinzuzufügen.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.7.19"></a><p
                class="title"><strong>Beispiel 11.1. Anfängliche <code
                    class="filename">/etc/postfix/main.cf</code>-Datei</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# See /usr/share/postfix/main.cf.dist for a commented, more complete version


# Debian specific:  Specifying a file name will cause the first
# line of that file to be used as the name.  The Debian default
# is /etc/mailname.
#myorigin = /etc/mailname

smtpd_banner = $myhostname ESMTP $mail_name (Debian/GNU)
biff = no

# appending .domain is the MUA's job.
append_dot_mydomain = no

# Uncomment the next line to generate "delayed mail" warnings
#delay_warning_time = 4h

readme_directory = no

# TLS parameters
smtpd_tls_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
smtpd_tls_key_file=/etc/ssl/private/ssl-cert-snakeoil.key
smtpd_use_tls=yes
smtpd_tls_session_cache_database = btree:${data_directory}/smtpd_scache
smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache

# See /usr/share/doc/postfix/TLS_README.gz in the postfix-doc package for
# information on enabling SSL in the smtp client.

smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination
myhostname = mail.falcot.com
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
myorigin = /etc/mailname
mydestination = mail.falcot.com, falcot.com, localhost.localdomain, localhost
relayhost = 
mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 192.168.0.0/16
mailbox_command = procmail -a "$EXTENSION"
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
inet_protocols = all</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>SICHERHEIT</em></span> <span
                          class="emphasis"><em>Schlangenöl</em></span> SSL-Zertifikate</strong></p></div></div></div><div
                class="para">
				Die <span
                  class="emphasis"><em>Schlangenöl</em></span>-Zertifikate sind, wie die <span
                  class="emphasis"><em>Schlangenöl</em></span>-„Medizin“, die früher von gewissenlosen Quacksalbern verkauft wurde, völlig wertlos: Man kann sich nicht darauf verlassen dass sie den Server authentifizieren da sie in automatisch erzeugte selbstsignierte Zertifikate sind. Sie können jedoch dazu dienen die Vertraulichkeit des Austausches zu verbessern.
			</div><div
                class="para">
				Sie sollten nur zu Testzwecken benutzt werden, während im Normalbetrieb echte Zertifikate verwendet werden müssen; diese können mit dem unter <a
                  class="xref"
                  href="sect.virtual-private-network.html#sect.easy-rsa">Abschnitt 10.2.1.1, „Public-Key-Infrastrultur: <span
                    class="emphasis"><em>easy-rsa</em></span>“</a> beschriebenen Verfahren erstellt werden.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.configuring-virtual-domains"></a>11.1.2. Virtuelle Domains konfigurieren</h3></div></div></div><a
              id="id-1.14.4.8.2"
              class="indexterm"></a><a
              id="id-1.14.4.8.3"
              class="indexterm"></a><div
              class="para">
				Der Mail-Server kann außer E-Mails, die an die Hauptdomain adressiert sind, auch solche entgegennehmen, die an andere Domains gerichtet sind. Diese werden dann virtuelle Domains genannt. In den meisten derartigen Fällen sind die E-Mails letztlich nicht für lokale Benutzer bestimmt. Postfix stellt für die Verwendung virtueller Domains zwei interessante Leistungsmerkmale bereit.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>VORSICHT</em></span> Virtuelle und autorisierte Domains</strong></p></div></div></div><div
                class="para">
				Auf keine der virtuellen Domains darf in der Variablen <code
                  class="literal">mydestination</code> verwiesen werden; diese Variable enthält nur die Namen der direkt dem Rechner und seinen lokalen Benutzern zugeordneten „autorisierten“ Domains.
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.8.6"></a>11.1.2.1. Virtuelle Alias-Domains</h4></div></div></div><a
                id="id-1.14.4.8.6.2"
                class="indexterm"></a><a
                id="id-1.14.4.8.6.3"
                class="indexterm"></a><div
                class="para">
					Eine virtuelle Alias-Domain enthält nur Aliasse, das heißt Adressen, die nur E-Mails an andere Adressen weiterleiten.
				</div><div
                class="para">
					Eine derartige Domain wird durch das Hinzufügen ihres Namens zur Variablen <code
                  class="literal">virtual_alias_domains</code> und das Eintragen eines Verweises auf eine Adressen-Bezugsdatei in die Variable <code
                  class="literal">virtual_alias_maps</code> aktiviert.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.6.6"></a><p
                  class="title"><strong>Beispiel 11.2. In die Datei <code
                      class="filename">/etc/postfix/main.cf</code> einzufügende Anweisungen</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_alias_domains = falcotsbrand.com
virtual_alias_maps = hash:/etc/postfix/virtual</pre></div></div><div
                class="para">
					Die Datei <code
                  class="filename">/etc/postfix/virtual</code> stellt eine Zuordnung in einer recht einfachen Syntax dar: jede Zeile enthält zwei durch Leerzeichen getrennte Felder; das erste Feld ist der Alias-Name, das zweite eine Liste der E-Mail-Adressen, an die er weiterleitet. Die spezielle Syntax <code
                  class="literal">@domain.com</code> deckt alle übrigen Aliasse in der Domain ab.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.6.8"></a><p
                  class="title"><strong>Beispiel 11.3. Beispiel der Datei <code
                      class="filename">/etc/postfix/virtual</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
webmaster@falcotsbrand.com  jean@falcot.com
contact@falcotsbrand.com    laure@falcot.com, sophie@falcot.com
# The alias below is generic and covers all addresses within 
# the falcotsbrand.com domain not otherwise covered by this file.
# These addresses forward email to the same user name in the
# falcot.com domain.
@falcotsbrand.com           @falcot.com</pre></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.8.7"></a>11.1.2.2. Virtuelle Postfach-Domains</h4></div></div></div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>VORSICHT</em></span> Kombinierte virtuelle Domain?</strong></p></div></div></div><div
                  class="para">
					Postfix erlaubt es nicht, dieselbe Domain sowohl in <code
                    class="literal">virtual_alias_domains</code> als auch in <code
                    class="literal">virtual_mailbox_domains</code> zu verwenden. Jedoch ist jede Domain in <code
                    class="literal">virtual_mailbox_domains</code> stillschweigend auch in <code
                    class="literal">virtual_alias_domains</code> erfasst, so dass es möglich ist, Aliasse und Postfächer in einer virtuellen Domain zu kombinieren.
				</div></div><a
                id="id-1.14.4.8.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.8.7.4"
                class="indexterm"></a><div
                class="para">
					An ein virtuelles Postfach adressierte Nachrichten werden in Postfächern gespeichert, die keinem lokalen Systembenutzer zugeordnet sind.
				</div><div
                class="para">
					Um eine virtuelle Postfach-Domain zu aktivieren, ist es erforderlich, diese Domain in der Variablen <code
                  class="literal">virtual_mailbox_domains</code> einzutragen und in <code
                  class="literal">virtual_mailbox_maps</code> einen Verweis auf eine Mailbox-Bezugsdatei anzugeben. Der Parameter <code
                  class="literal">virtual_mailbox_base</code> enthält das Verzeichnis, in dem die Postfächer gespeichert werden.
				</div><div
                class="para">
					Der Paramater <code
                  class="literal">virtual_uid_maps</code> (beziehungsweise <code
                  class="literal">virtual_gid_maps</code>) verweist auf die Datei, die den Bezug zwischen der E-Mail-Adresse und dem Systembenutzer (beziehungsweise der Gruppe) enthält, dem das entsprechende Postfach „gehört“. Um alle Postfächer zusammen fassen zu können, die dem selben Benutzer beziehungsweise der selben Gruppe gehören, weist man mittels der Syntax <code
                  class="literal">static:5000</code> eine feste UID/GID (hier mit dem Wert 5000) zu.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.7.8"></a><p
                  class="title"><strong>Beispiel 11.4. In die Datei <code
                      class="filename">/etc/postfix/main.cf</code> einzufügende Anweisungen</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_mailbox_domains = falcot.org
virtual_mailbox_maps = hash:/etc/postfix/vmailbox
virtual_mailbox_base = /var/mail/vhosts</pre></div></div><div
                class="para">
					Auch die Syntax der Datei <code
                  class="filename">/etc/postfix/vmailbox</code> ist recht einfach: zwei durch Leerzeichen getrennte Felder. Das erste Feld ist eine E-Mail-Adresse innerhalb einer der virtuellen Domains, und das zweite ist der Ort des dazugehörigen Postfachs (relativ zum Verzeichnis, das in <span
                  class="emphasis"><em>virtual_mailbox_base</em></span> angegeben ist). Falls die Bezeichnung des Postfachs mit einem Schrägstrich (<code
                  class="literal">/</code>) endet, werden die E-Mails im <span
                  class="emphasis"><em>maildir</em></span>-Format gespeichert; anderenfalls wird das traditionelle <span
                  class="emphasis"><em>mbox</em></span>-Format benutzt. Das <span
                  class="emphasis"><em>maildir</em></span>-Format verwendet ein ganzes Verzeichnis zur Speicherung eines Postfachs, wobei jede individuelle Nachricht in einer eigenen Datei gespeichert wird. Dagegen ist beim <span
                  class="emphasis"><em>mbox</em></span>-Format das gesamte Postfach in einer einzigen Datei gespeichert, wobei jede Zeile, die mit „<code
                  class="literal">From </code>“ beginnt (<code
                  class="literal">From</code> gefolgt von einem Leerzeichen), den Beginn einer neuen Nachricht anzeigt.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.7.10"></a><p
                  class="title"><strong>Beispiel 11.5. Die Datei <code
                      class="filename">/etc/postfix/vmailbox</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
# Jeans E-Mail ist als maildir gespeichert mit
# einer Datei je E-Mail in einem gesonderten Verzeichnis
jean@falcot.org falcot.org/jean/
# Sophies E-Mail ist in einer traditionellen „mbox“-Datei gespeichert
# mit allen Mails zu einer einzigen Datei verkettet
sophie@falcot.org falcot.org/sophie</pre></div></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.restrictions-for-receiving-and-sending"></a>11.1.3. Einschränkungen beim Empfangen und Senden</h3></div></div></div><div
              class="para">
				Die wachsende Zahl unerwünschter Massen-E-Mails (<span
                class="emphasis"><em>spam</em></span>) macht es erforderlich, bei der Entscheidung, welche E-Mails ein Server annehmen sollte, in zunehmendem Maße strikt zu sein. Dieser Abschnitt zeigt einige der in Postfix enthaltenen Strategien.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>KULTUR</em></span> Das Spam-Problem</strong></p></div></div></div><a
                id="id-1.14.4.9.3.2"
                class="indexterm"></a><div
                class="para">
				„Spam“ ist der allgemeine Begriff zur Bezeichnung all der unerwünschten kommerziellen E-Mails (auch bekannt als UCE = unsolicited commercial email), die unsere elektronischen Postfächer überfluten; die gewissenlosen Individuen, die sie verschicken, werden Spammer genannt. Sie kümmern sich wenig um die Belästigung, die sie verursachen, da das Verschicken einer E-Mail sehr wenig kostet, und es genügt, dass sich nur ein sehr geringer Prozentsatz der Empfänger von diesen Angeboten angezogen fühlt, damit die Spamming-Aktion mehr Geld einbringt als sie kostet. Der Vorgang ist weitgehend automatisiert, und jede E-Mail-Adresse, die öffentlich bekannt gemacht wird (zum Beispiel in einem Web-Forum, den Archiven einer Mailingliste oder einem Blog und so weiter) wird von den Robotern des Spammers entdeckt und einem niemals endenden Strom unerwünschter Nachrichten unterworfen.
			</div><div
                class="para">
				Alle System-Administratoren versuchen, dieser Belästigung mit Spamfiltern zu begegnen, aber natürlich passen sich die Spammer an und versuchen, diese Filter zu umgehen. Einige mieten sogar Rechnernetzwerke an, die von diversen kriminellen Banden mit einem Wurm infiziert worden sind. Jüngste Statistiken schätzen, dass bis zu 95% aller über das Internet laufenden E-Mails Spam sind!
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.4"></a>11.1.3.1. IP-basierte Zugangsbeschränkungen</h4></div></div></div><div
                class="para">
					Die Anweisung <code
                  class="literal">smtpd_client_restrictions</code> bestimmt, welchen Rechnern es erlaubt ist, mit dem E-Mail-Server zu kommunizieren.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.4.3"></a><p
                  class="title"><strong>Beispiel 11.6. Beschränkungen aufgrund von Client-Adressen</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_client_restrictions = permit_mynetworks,
    warn_if_reject reject_unknown_client,
    check_client_access hash:/etc/postfix/access_clientip,
    reject_rbl_client sbl-xbl.spamhaus.org,
    reject_rbl_client list.dsbl.org</pre></div></div><div
                class="para">
					Wenn eine Variable wie in oben stehendem Beispiel eine Liste von Regeln enthält, werden diese Regeln der Reihe nach von der ersten bis zur letzten ausgewertet. Jede Regel kann die Nachricht entweder annehmen, zurückweisen oder d. Daher ist die Reihenfolge wichtig, und das Vertauschen zweier Regeln kann zu einem völlig anderen Verhalten führen.
				</div><div
                class="para">
					Die Anweisung <code
                  class="literal">permit_mynetworks</code>, die als erste Regel verwendet wurde, akzeptiert alle E-Mails, die von einem Rechner im lokalen Netzwerk (wie in der Konfigurationsvariablen <span
                  class="emphasis"><em>mynetworks</em></span> festgelegt) kommen.
				</div><div
                class="para">
					Die zweite Direktive würde normalerweise alle E-Mails zurückweisen, die von Rechnern ohne vollständig gültige DNS-Konfiguration kommen. Solch eine gültige Konfiguration bedeutet, dass die IP-Adresse einem Namen zugeordnet werden kann, und dass dieser Name wiederum der IP-Adresse zugeordnet ist. Diese Beschränkung ist häufig zu strikt, da manche E-Mail-Server keinen umgekehrten DNS für ihre IP-Adresse haben. Dies erklärt, warum die Falcot Administratoren der Direktive <code
                  class="literal">reject_unknown_client</code> den Modifikator <code
                  class="literal">warn_if_reject</code> vorangestellt haben: dieser Modifikator wandelt die Zurückweisung in eine einfache Warnung um, die in den Protokollen aufgezeichnet wird. Die Administratoren können dann die Anzahl der Nachrichten im Blick behalten, die zurückgewiesen würden, wenn die Regel tatsächlich durchgesetzt würde und später aufgrund dieser Informationen eine Entscheidung treffen, ob sie die Durchsetzung aktivieren wollen.
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>TIPP</em></span> <span
                            class="emphasis"><em>access</em></span>-Tabellen</strong></p></div></div></div><div
                  class="para">
					Die Einschränkungskriterien bestehen unter anderem aus Tabellen, die vom Administrator geändert werden können und Kombinationen aus Absendern, IP-Adressen und erlaubten oder verbotenen Rechnernamen auflisten. Diese Tabellen können aus einer entpackten Kopie der Datei <code
                    class="filename">/usr/share/doc/postfix-doc/examples/access.gz</code> erstellt werden. Diese Musterdatei ist in ihren Kommentaren dokumentiert, das heißt, dass jede Tabelle ihre eigene Syntax erläutert.
				</div><div
                  class="para">
					Die Tabelle <code
                    class="filename">/etc/postfix/access_clientip</code> führt IP-Adressen und Netzwerke auf; <code
                    class="filename">/etc/postfix/access_helo</code> listet Domain-Namen; <code
                    class="filename">/etc/postfix/access_sender</code> enthält E-Mail-Adressen von Absendern. Alle diese Dateien müssen nach jeder Änderung mithilfe des Befehls <code
                    class="command">postmap /etc/postfix/<em
                      class="replaceable">datei</em></code> in Hash-Tabellen umgewandelt werden (ein Format, das für schnellen Zugriff optimiert ist).
				</div></div><div
                class="para">
					Die dritte Anweisung ermöglicht es dem Administrator, eine schwarze Liste und eine Positivliste von E-Mail-Servern aufzustellen, die in der Datei <code
                  class="filename">/etc/postfix/access_clientip</code> abgespeichert werden. Server in der Positivliste gelten als zuverlässig, und die von dort kommenden E-Mails durchlaufen daher nicht die anschließenden Filterregeln.
				</div><div
                class="para">
					Die beiden letzten Regeln weisen jede Nachricht zurück, die von einem Server kommt, der in einer der angezeigten schwarzen Listen aufgeführt ist. RBL ist die Abkürzung für <span
                  class="emphasis"><em>Remote Black List</em></span>; es gibt mehrere derartige Listen, aber alle führen sowohl schlecht konfigurierte Server auf, die von Spammern zur Übermittlung ihrer E-Mails benutzt werden, als auch unerwartete Mail-Übermittler, wie von Würmern oder Viren infizierte Rechner.
				</div><a
                id="id-1.14.4.9.4.10"
                class="indexterm"></a><a
                id="id-1.14.4.9.4.11"
                class="indexterm"></a><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>TIPP</em></span> Positivliste und RBLs</strong></p></div></div></div><div
                  class="para">
					Manchmal enthalten schwarze Listen auch seriöse Server, die einen Störfall erlitten haben. In diesem Fall würden alle E-Mails, die von einem dieser Server kommen, zurückgewiesen, es sei denn, der Server ist in einer von <code
                    class="filename">/etc/postfix/access_clientip</code> festgelegten Positivliste aufgeführt.
				</div><div
                  class="para">
					Es empfiehlt sich daher, vernünftigerweise alle seriösen Server, von denen man gewöhnlich zahlreiche E-Mails erhält, in die Positivliste aufzunehmen.
				</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.5"></a>11.1.3.2. Die Gültigkeit der Befehle <code
                        class="literal">EHLO</code> und <code
                        class="literal">HELO</code> überprüfen</h4></div></div></div><div
                class="para">
					Jeder SMTP-Austausch beginnt mit einem <code
                  class="literal">HELO</code>- oder <code
                  class="literal">EHLO</code>-Befehl, gefolgt vom Namen des sendenden E-Mail-Servers; es kann interessant sein, die Gültigkeit dieses Namens zu überprüfen.
				</div><a
                id="id-1.14.4.9.5.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.5.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.5.5"></a><p
                  class="title"><strong>Beispiel 11.7. Beschränkungen für den in <code
                      class="literal">EHLO</code> genannten Namen</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_helo_restrictions = permit_mynetworks,
    reject_invalid_hostname,
    check_helo_access hash:/etc/postfix/access_helo,
    reject_non_fqdn_hostname,
    warn_if_reject reject_unknown_hostname</pre></div></div><div
                class="para">
					Die erste Anweisung, <code
                  class="literal">permit_mynetworks</code>, erlaubt es allen Rechnern des lokalen Netzwerks, sich ungehindert einzuführen. Dies ist wichtig, da einige E-Mail-Programme diesen Teil des SMTP-Protokolls nicht in ausreichendem Maße beachten und sich mit unsinnigen Namen einführen können.
				</div><div
                class="para">
					Die Regel <code
                  class="literal">reject_invalid_hostname</code> weist E-Mails zurück, wenn die <code
                  class="literal">EHLO</code>-Angabe einen syntaktisch unkorrekten Rechnernamen enthält. Die Regel <code
                  class="literal">reject_non_fqdn_hostname</code> weist Nachrichten zurück, wenn der angegebene Rechnername kein vollständig ausgewiesener Domain-Name ist (dies schließt einen Domain-Namen wie auch einen Rechnernamen ein). Die Regel <code
                  class="literal">reject_unknown_hostname</code> weist Nachrichten zurück, falls es den angegebenen Namen im DNS nicht gibt. Da diese letzte Regel leider zu viele Zurückweisungen zur Folge hat, haben die Administratoren ihre Wirkung mit Hilfe des Modifikators <code
                  class="literal">warn_if_reject</code> bis auf Weiteres in eine einfache Warnung umgewandelt; sie können entscheiden, diesen Modifikator später zu entfernen, nachdem sie die Ergebnisse dieser Regel überprüft haben.
				</div><div
                class="para">
					Die Verwendung von <code
                  class="literal">permit_mynetworks</code> als erster Regel hat eine interessante Nebenwirkung: die folgenden Regeln gelten nur für Rechner außerhalb des lokalen Netzwerks. Hierdurch ist es möglich, alle Rechner, die sich als Teil von <code
                  class="literal">falcot.com</code> bezeichnen, auf die schwarze Liste zu setzen, indem zum Beispiel die Zeile <code
                  class="literal">falcot.com ABGELEHNT Sie sind nicht in unserem Netzwerk!</code> zur Datei <code
                  class="filename">/etc/postfix/access_helo</code> hinzugefügt wird.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.6"></a>11.1.3.3. Annahme oder Ablehnung aufgrund des angegebenen Absenders</h4></div></div></div><div
                class="para">
					Jede Nachricht hat einen Absender, der durch den Befehl <code
                  class="literal">MAIL FROM</code> des SMTP-Protokolls angegeben wird; auch diese Information kann auf verschiedene Weise überprüft werden.
				</div><a
                id="id-1.14.4.9.6.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.6.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.6.5"></a><p
                  class="title"><strong>Beispiel 11.8. Überprüfung des Absenders</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_sender_restrictions = 
    check_sender_access hash:/etc/postfix/access_sender,
    reject_unknown_sender_domain, reject_unlisted_sender,
    reject_non_fqdn_sender</pre></div></div><div
                class="para">
					Die Tabelle <code
                  class="filename">/etc/postfix/access_sender</code> ordnet einigen Absendern eine besondere Behandlung zu. Dies bedeutet für gewöhnlich, dass einige Absender in eine Positivliste oder eine schwarze Liste aufgenommen werden.
				</div><div
                class="para">
					Die Regel <code
                  class="literal">reject_unknown_sender_domain</code> verlangt eine gültige Absenderdomain, da sie für eine gültige Adresse benötigt wird. Die Regel <code
                  class="literal">reject_unlisted_sender</code> weist lokale Absender zurück, falls die Adresse nicht existiert; hierdurch wird vermieden, dass E-Mails von einer ungültigen Adresse in der <code
                  class="literal">falcot.com</code>-Domain verschickt werden, und Nachrichten, die von <code
                  class="literal">joe.bloggs@falcot.com</code> ausgehen, werden nur akzeptiert, wenn eine solche Adresse tatsächlich existiert.
				</div><div
                class="para">
					Schließlich weist die Regel <code
                  class="literal">reject_non_fqdn_sender</code> E-Mails zurück, die vorgeben, von Adressen ohne einen vollständig ausgewiesenen Domain-Namen zu kommen. In der Praxis bedeutet dies, dass E-Mails, die von <code
                  class="literal">benutzer@rechner</code> kommen, zurückgewiesen werden: die Adresse muss entweder als <code
                  class="literal">benutzer@rechner.beispiel.com</code> oder <code
                  class="literal">benutzer@beispiel.com</code> angegeben werden.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.7"></a>11.1.3.4. Annehmen oder zurückweisen aufgrund des Empfängers</h4></div></div></div><div
                class="para">
					Jede E-Mail hat wenigstens einen Empfänger, der im SMTP-Protokoll mit dem Befehl <code
                  class="literal">RCPT TO</code> angegeben wird. Diese Adressen erfordern ebenfalls eine Gültigkeitsprüfung, selbst wenn dies weniger wichtig sein sollte als die Überprüfung des Absenders.
				</div><a
                id="id-1.14.4.9.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.7.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.7.5"></a><p
                  class="title"><strong>Beispiel 11.9. Überprüfung des Empfängers</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks, 
    reject_unauth_destination, reject_unlisted_recipient, 
    reject_non_fqdn_recipient</pre></div></div><div
                class="para">
					Die grundlegende Regel lautet <code
                  class="literal">reject_unauth_destination</code>, und sie verlangt, dass externe Nachrichten an uns adressiert sein müssen; Nachrichten an eine Adresse, die von diesem Server nicht bedient wird, werden zurückgewiesen. Ohne diese Regel wird ein Server zu einem offenen Übermittler, der es Spammern erlaubt, unerwünschte E-Mails zu verschicken; diese Regel ist daher obligatorisch, und sie wird am besten ziemlich am Anfang der Liste platziert, damit nicht andere Regeln die Nachricht zulassen, bevor ihre Zieladresse überprüft worden ist.
				</div><div
                class="para">
					Die Regel <code
                  class="literal">reject_unlisted_recipient</code> weist Nachrichten zurück, die an nicht existierende lokale Benutzer geschickt werden, was natürlich Sinn macht. Schließlich weist die Regel <code
                  class="literal">reject_non_fqdn_recipient</code> nicht vollständig ausgewiesene Adressen zurück; dies macht es unmöglich, eine E-Mail an <code
                  class="literal">jean</code> oder <code
                  class="literal">jean@rechner</code> zu schicken, und erfordert stattdessen, die vollständige Adresse zu verwenden, wie <code
                  class="literal">jean@rechner.falcot.com</code> or <code
                  class="literal">jean@falcot.com</code>.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.8"></a>11.1.3.5. Beschränkungen in Verbindung mit dem Befehl <code
                        class="literal">DATA</code></h4></div></div></div><div
                class="para">
					SMTPs Befehl <code
                  class="literal">DATA</code> wird vor dem Inhalt der Nachricht verschickt. An sich stellt er keine Information bereit, außer anzukündigen, was als nächstes kommt.Dennoch kann er Überprüfungen unterworfen werden.
				</div><a
                id="id-1.14.4.9.8.3"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.8.4"></a><p
                  class="title"><strong>Beispiel 11.10. Überprüfungen von <code
                      class="literal">DATA</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_data_restrictions = reject_unauth_pipelining</pre></div></div><div
                class="para">
					Die Anweisung <code
                  class="literal">reject_unauth_pipelining</code> bewirkt, dass die Nachricht zurückgewiesen wird, falls die aussendende Partei einen Befehl verschickt, bevor die Antwort auf den vorhergehenden Befehl gesendet worden ist. Dies schützt vor einer häufig von Spam-Robotern benutzten Optimierung, da sie sich gewöhnlich keinen Deut um Antworten scheren und sich nur darauf konzentrieren, in möglichst kurzer Zeit möglichst viele E-Mails zu verschicken.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.9"></a>11.1.3.6. Beschränkungen anwenden</h4></div></div></div><div
                class="para">
					Obwohl die oben stehenden Befehle Informationen in verschiedenen Phasen des SMTP-Austauschs überprüfen, verschickt Postfix die eigentliche Zurückweisung nur als Antwort auf den Befehl <code
                  class="literal">RCPT TO</code>.
				</div><div
                class="para">
					Dies bedeutet, dass selbst wenn die Nachricht aufgrund eines ungültigen <code
                  class="literal">EHLO</code>-Befehls zurückgewiesen wird, Postfix den Absender und den Empfänger kennt, wenn es die Zurückweisung bekanntgibt. Es kann dann eine eindeutigere Nachricht protokollieren, als möglich gewesen wäre, falls die Übertragung gleich zu Anfang abgebrochen worden wäre. Außerdem erwarten manche SMTP-Clients keine Störungen bei den frühen SMTP-Befehlen, und diese Clients werden durch die späte Zurückweisung weniger gestört.
				</div><div
                class="para">
					Ein letzter Vorteil dieser Vorgehensweise ist, dass die Regeln im Verlauf der verschiedenen SMTP-Stadien Informationen sammeln können; dies ermöglicht es, feinkörnigere Berechtigungen zu formulieren, wie zum Beispiel eine nicht-lokale Verbindung zurückzuweisen, wenn sie sich als lokaler Absender ausgibt.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.10"></a>11.1.3.7. Filtern aufgrund des Nachrichteninhalts</h4></div></div></div><div
                class="para">
					Das Überprüfungs- und Beschränkungssystem wäre nicht vollständig ohne eine Möglichkeit, Überprüfungen des Nachrichteninhalts durchzuführen. Postfix unterscheidet die Überprüfungen, die es auf die E-Mail-Kopfzeilen anwendet, von denen, die es für den E-Mail-Inhalt benutzt.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.10.3"></a><p
                  class="title"><strong>Beispiel 11.11. Inhaltsbezogene Filter aktivieren</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
header_checks = regexp:/etc/postfix/header_checks
body_checks = regexp:/etc/postfix/body_checks</pre></div></div><a
                id="id-1.14.4.9.10.4"
                class="indexterm"></a><div
                class="para">
					Beide Dateien enthalten eine Liste regulärer Ausdrücke (gewöhnlich als <span
                  class="emphasis"><em>regexps</em></span> oder <span
                  class="emphasis"><em>regexes</em></span> bezeichnet) und damit zusammenhängender Aktionen, die ausgelöst werden, wenn die E-Mail-Kopfzeilen (oder der Inhalt) einem Ausdruck entsprechen.
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>KURZER BLICK</em></span> Regexp-Tabellen</strong></p></div></div></div><div
                  class="para">
					Die Datei <code
                    class="filename">/usr/share/doc/postfix-doc/examples/header_checks.gz</code> enthält zahlreiche erläuternde Kommentare und kann als Grundlage für die Erstellung der Dateien <code
                    class="filename">/etc/postfix/header_checks</code> und <code
                    class="filename">/etc/postfix/body_checks</code> verwendet werden.
				</div></div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.10.7"></a><p
                  class="title"><strong>Beispiel 11.12. Beispiel einer Datei <code
                      class="filename">/etc/postfix/header_checks</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
/^X-Mailer: GOTO Sarbacane/ REJECT I fight spam (GOTO Sarbacane)
/^Subject: *Your email contains VIRUSES/ DISCARD virus notification</pre></div></div><div
                class="sidebar"><a
                  xmlns=""
                  id="sidebar.regexp"></a><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>ZURÜCK ZU DEN GRUNDLAGEN</em></span> Regulärer Ausdruck</strong></p></div></div></div><div
                  class="para">
					Der Begriff <span
                    class="emphasis"><em>regulärer Ausdruck</em></span> (abgekürzt <span
                    class="emphasis"><em>regexp</em></span> oder <span
                    class="emphasis"><em>regex</em></span>) bezieht sich auf eine allgemeine Bezeichnung zur Beschreibung des Inhalts oder der Struktur einer Zeichenkette. Bestimmte Sonderzeichen ermöglichen die Festlegung von Alternativen (so trifft zum Beispiel <code
                    class="literal">foo|bar</code> entweder für „foo“ oder für „bar“ zu), von Reihen zugelassener Zeichen (zum Beispiel bedeutet <code
                    class="literal">[0-9]</code> eine beliebige Ziffer und <code
                    class="literal">.</code> - ein Punkt - ein beliebiger Buchstabe) und von Quantifizierungen (<code
                    class="literal">s?</code> trifft entweder auf <code
                    class="literal">s</code> oder die Nullkette zu, mit anderen Worten das Ereignis 0 oder 1 von <code
                    class="literal">s</code>; <code
                    class="literal">s+</code> trifft auf ein oder mehrere aufeinander folgende <code
                    class="literal">s</code>-Zeichen zu und so weiter). Klammern ermöglichen das Gruppieren von Suchergebnissen.
				</div><div
                  class="para">
					Die genaue Syntax dieser Ausdrücke unterscheidet sich zwischen den Programmen, die sie verwenden, aber die grundlegenden Merkmale sind ähnlich. <div
                    xmlns=""
                    class="url">→ <a
                      xmlns="http://www.w3.org/1999/xhtml"
                      href="https://de.wikipedia.org/wiki/Regulärer_Ausdruck">https://de.wikipedia.org/wiki/Regulärer_Ausdruck</a></div>
				</div></div><div
                class="para">
					Der erste überprüft die Kopfzeile, die die E-Mail-Software nennt; falls <code
                  class="literal">GOTO Sarbacane</code> gefunden wird (ein Programm zum Versenden von Massen-E-Mails), wird die Nachricht zurückgewiesen. Der zweite Ausdruck überprüft den Nachrichtenbetreff; falls er eine Virenmeldung nennt, können wir entscheiden, die Nachricht nicht zurückzuweisen, sondern stattdessen sofort zu löschen.
				</div><div
                class="para">
					Die Verwendung dieser Filter ist ein zweischneidiges Schwert, da die Regeln leicht zu allgemein formuliert werden können und als Folge seriöse E-Mails verloren gehen. In diesen Fällen sind nicht nur die Nachrichten verloren, sondern ihre Absender erhalten zudem unerwünschte (und störende) Fehlermeldungen.
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.setting-up-greylisting"></a>11.1.4. <span
                      class="foreignphrase"><em
                        class="foreignphrase">Greylisting</em></span> einrichten</h3></div></div></div><a
              id="id-1.14.4.10.2"
              class="indexterm"></a><div
              class="para">
				„Greylisting“ ist eine Filtertechnik, der zufolge eine Nachricht zunächst mit einem vorläufigen Fehlercode zurückgewiesen und erst bei einem weiteren Versuch nach einer gewissen Verzögerung angenommen wird. Dieses Filtern ist vor allem gegen Spam wirkungsvoll, der von den vielen mit Würmern und Viren infizierten Rechnern verschickt wird, da dieses Programm nur selten als vollständiger SMTP-Agent agiert (mit Überprüfung des Fehlercodes und einem späteren erneuten Zustellversuch für gescheiterte Nachrichten), vor allem weil viele der gesammelten Adressen in Wirklichkeit ungültig sind und ein erneuter Versuch nur Zeitverschwendung wäre.
			</div><div
              class="para">
				Postfix stellt Greylisting nicht von Haus aus zur Verfügung, jedoch gibt es eine Funktion, mit der die Entscheidung, eine bestimmte Nachricht anzunehmen oder zurückzuweisen, an ein externes Programme delegiert werden kann. Das Paket <span
                class="pkg pkg">postgrey</span> enthält genau solch ein Programm, das dafür ausgelegt ist, sich in diesen Dienst zur Delegierung der Zugangsrichtlinien einzubinden.
			</div><div
              class="para">
				Sobald <span
                class="pkg pkg">postgrey</span> installiert ist, läuft es als Daemon und nimmt an Port 10023 Verbindungen an. Postfix kann dann auf seine Verwendung eingestellt werden, indem der Parameter <code
                class="literal">check_policy_service</code> als zusätzliche Bedingung hinzugefügt wird:
			</div><pre
              class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks,
    [...]
    check_policy_service inet:127.0.0.1:10023</pre><div
              class="para">
				Jedes Mal, wenn Postfix diese Regel in seinem Regelsatz erreicht, verbindet es sich mit dem <code
                class="command">postgrey</code>-Daemon und schickt ihm Informationen über die entsprechende Nachricht. Wenn Postgrey überprüft seinerseits die Dreiergruppe aus IP-Adresse, Absender und Empfänger und sieht in seiner Datenbank nach, ob dieselbe Dreiergruppe vor kurzem bereits aufgetreten ist. n dies der Fall ist, antwortet Postgrey, dass die Nachricht angenommen werden sollte; anderenfalls zeigt die Antwort an, dass die Nachricht vorübergehend zurückgewiesen werden soll, und die Dreiergruppe wird in die Datenbank eingetragen.
			</div><div
              class="para">
				Der Hauptnachteil des Greylistings besteht darin, dass seriöse Nachrichten verzögert werden, was nicht immer akzeptabel ist. Es erhöht außerdem die Belastung von Servern, die zahlreiche seriöse E-Mails versenden.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>IN DER PRAXIS</em></span> Unzulänglichkeiten des Greylistings</strong></p></div></div></div><div
                class="para">
				Theoretisch sollte Greylisting nur die erste Nachricht eines bestimmten Absenders an einen bestimmten Empfänger verzögern, und die typische Verzögerungsdauer liegt dabei im Bereich von Minuten. Die Wirklichkeit kann jedoch etwas anders aussehen. Einige große Internetdienstanbieter verwenden Gruppen von SMTP-Servern, und wenn eine Nachricht zunächst zurückgewiesen wird, kann es sein, dass der Server, der die Übertragung erneut versucht, nicht derselbe wie der ursprüngliche ist. In diesem Fall erhält der zweite Server aufgrund des Greylistings ebenfalls eine vorläufige Fehlermeldung und so weiter; so kann es mehrere Stunden dauern, bevor die Übertragung wieder von einem Server versucht wird, der schon einmal beteiligt war, da SMTP-Server normalerweise nach jedem Fehlschlag die Verzögerungszeit bis zu einem erneuten Versuch erhöhen.
			</div><div
                class="para">
				Folglich kann sich die ankommende IP-Adresse selbst für denselben Absender im Zeitverlauf ändern. Das ist jedoch nicht alles: selbst die Absenderadresse kann wechseln. Zum Beispiel kodieren viele Mailinglisten-Server zusätzliche Informationen in die Absenderadresse, um bestimmte Fehlermeldungen (<span
                  class="emphasis"><em>bounces</em></span> genannt) verarbeiten zu können. Jede an eine Mailingliste verschickte Nachricht wird dann möglicherweise durch das Greylisting gehen müssen mit der Folge, dass sie (vorübergehend) auf dem Server des Absenders gespeichert werden muss. Bei sehr großen Mailinglisten (mit zehntausenden von Abonnenten) kann dies sehr schnell zu Problemen führen.
			</div><div
                class="para">
				Um diesen Nachteilen entgegen zu wirken, verwaltet Postgrey eine Positivliste solcher Stellen, und von ihnen ausgehende Nachrichten werden direkt ohne den Umweg über das Greylisting angenommen. Diese Liste kann leicht an die örtlichen Bedürfnisse angepasst werden, da sie in der Datei <code
                  class="filename">/etc/postgrey/whitelist_clients</code> gespeichert ist.
			</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>WEITERE SCHRITTE</em></span> Selektives Greylisting mit <span
                          class="pkg pkg">milter-greylist</span></strong></p></div></div></div><div
                class="para">
				Den Nachteilen des Greylistings kann dadurch begegnet werden, dass es nur auf die Untergruppe von Clients angewendet wird, die bereits als mögliche Spamquellen angesehen werden (da sie in einer schwarzen Liste des DNS aufgeführt sind). Dies ist mit <span
                  class="pkg pkg">postgrey</span> nicht möglich, wohl aber mit <span
                  class="pkg pkg">milter-greylist</span>.
			</div><div
                class="para">
				Da DNS-Blacklisten nicht zu einer endgültigen Ablehnung führen, ist es in diesem Szenario vernünftig, aggressive schwarze Listen einzusetzten, einschließlich derer, die alle dynamischen IP-Adressen von Internetdienstanbietern auflisten (wie zum Beispiel <code
                  class="literal">pbl.spamhaus.org</code> oder <code
                  class="literal">dul.dnsbl.sorbs.net</code>).
			</div><div
                class="para">
				Da die Milter-greylist die Milter-Schnittstelle von Sendmail benutzt, ist die Postfix-Seite der Konfiguration beschränkt auf “<code
                  class="literal">smtpd_milters = unix:/var/run/milter-greylist/milter-greylist.sock</code>”. Die Handbuchseite <span
                  class="citerefentry"><span
                    class="refentrytitle">greylist.conf</span>(5)</span> dokumentiert <code
                  class="filename">/etc/milter-greylist/greylist.conf</code> und die vielfältigen Möglichkeiten die Milter-greylist zu konfigurieren. Sie werden auch <code
                  class="filename">/etc/default/milter-greylist</code> bearbeiten müssen um den Dienst wirklich freizugeben.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.14.4.11"></a>11.1.5. Filter anhand des Empfängers einstellen</h3></div></div></div><div
              class="para">
				In den Abschnitten <a
                class="xref"
                href="network-services.html#sect.restrictions-for-receiving-and-sending">Abschnitt 11.1.3, „Einschränkungen beim Empfangen und Senden“</a> und <a
                class="xref"
                href="network-services.html#sect.setting-up-greylisting">Abschnitt 11.1.4, „<span
                  class="foreignphrase"><em
                    class="foreignphrase">Greylisting</em></span> einrichten“</a>sind zahlreiche Beschränkungsmöglichkeiten betrachtet worden. Sie alle haben ihren Nutzen bei der Begrenzung der eingehenden Spam-Menge, aber sie haben auch ihre Nachteile. Es wird daher immer üblicher, den Filtersatz anhand des Empfängers einzustellen. Bei Falcot Corp. ist das Greylisting für die meisten Benutzer interessant, es behindert jedoch die Arbeit einiger Benutzer, die bei ihren E-Mails kurze Wartezeiten benötigen (wie zum Beispiel der technische Betreuungsdienst). In ähnlicher Weise hat die Handelsabteilung manchmal Probleme beim Empfang von E-Mails einiger asiatischer Anbieter, die vielleicht in schwarzen Listen aufgeführt sind; diese Abteilung hat um eine ungefilterte Adresse gebeten, so dass sie mit ihnen korrespondieren kann.
			</div><div
              class="para">
				Postfix bietet eine derartige Filteranpassung mit dem Konzept einer „restriction class“ an. Diese Klassen werden in dem Parameter <code
                class="literal">smtpd_restriction_classes</code> angegeben und in der gleichen Weise wie <code
                class="literal">smtpd_recipient_restrictions</code> festgelegt. Die Anweisung <code
                class="literal">check_recipient_access</code> bezeichnet dann eine Tabelle, die einem bestimmten Empfänger den richtigen Satz von Beschränkungen zuordnet.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.11.4"></a><p
                class="title"><strong>Beispiel 11.13. Beschränkungsklassen in <code
                    class="filename">main.cf</code> festlegen</strong></p><div
                class="example-contents"><pre
                  class="programlisting">smtpd_restriction_classes = greylisting, aggressive, permissive

greylisting = check_policy_service inet:127.0.0.1:10023
aggressive = reject_rbl_client sbl-xbl.spamhaus.org,
        check_policy_service inet:127.0.0.1:10023
permissive = permit

smtpd_recipient_restrictions = permit_mynetworks,
        reject_unauth_destination,
        check_recipient_access hash:/etc/postfix/recipient_access</pre></div></div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.11.5"></a><p
                class="title"><strong>Beispiel 11.14. Die Datei <code
                    class="filename">/etc/postfix/recipient_access</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Unfiltered addresses
postmaster@falcot.com  permissive
support@falcot.com     permissive
sales-asia@falcot.com  permissive

# Aggressive filtering for some privileged users
joe@falcot.com         aggressive

# Special rule for the mailing-list manager
sympa@falcot.com       reject_unverified_sender

# Greylisting by default
falcot.com             greylisting</pre></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.postfix-antivirus"></a>11.1.6. Einen Virenschutz integrieren</h3></div></div></div><a
              id="id-1.14.4.12.2"
              class="indexterm"></a><div
              class="para">
				Die zahlreichen als E-Mail-Anhänge umlaufenden Viren erfordern das Einrichten eines Virenschutzes am Eingang des Firmennetzwerks, da einige Benutzer trotz einer Aufklärungskampagne weiterhin Anhänge von offensichtlich fragwürdigen Nachrichten öffnen.
			</div><div
              class="para">
				Die Falcot Administratoren haben <code
                class="command">clamav</code> als ihren kostenlosen Virenschutz ausgewählt. Das Hauptpaket ist <span
                class="pkg pkg">clamav</span>, aber sie haben auch einige Zusatzpakete wie <span
                class="pkg pkg">arj</span>, <span
                class="pkg pkg">unzoo</span>, <span
                class="pkg pkg">unrar</span> und <span
                class="pkg pkg">lha</span> installiert, da diese benötigt werden, damit der Virenschutz Anhänge analysieren kann, die in einem dieser Formate komprimiert sind.
			</div><a
              id="id-1.14.4.12.5"
              class="indexterm"></a><a
              id="id-1.14.4.12.6"
              class="indexterm"></a><div
              class="para">
				Die Aufgabe, die Verbindung zwischen dem Virenschutz und dem E-Mail-Server bereitzustellen, fällt dem Programm <code
                class="command">clamav-milter</code> zu. Ein <span
                class="emphasis"><em>Milter</em></span> (kurz für <span
                class="emphasis"><em>Mailfilter</em></span>) ist ein speziell für die Verbindung mit E-Mail-Servern ausgelegtes Programm. Ein Milter verwendet eine standardmäßige Programmierschnittstelle (API = application programming interface), die eine deutlich bessere Leistung aufweist als Filter außerhalb der E-Mail-Server. Milter wurden ursprünglich von <span
                class="emphasis"><em>Sendmail</em></span> eingeführt, aber <span
                class="emphasis"><em>Postfix</em></span> ist dem bald gefolgt.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>KURZER BLICK</em></span> Ein Milter für Spamassassin</strong></p></div></div></div><a
                id="id-1.14.4.12.8.2"
                class="indexterm"></a><div
                class="para">
				Das Paket <span
                  class="pkg pkg">spamass-milter</span> stellt einen Milter zur Verfügung, der auf <span
                  class="emphasis"><em>SpamAssassin</em></span> beruht, dem bekannten Suchprogramm für unerwünschte E-Mails. Er kann dazu benutzt werden, Nachrichten als möglichen Spam zu markieren (indem er eine zusätzliche Kopfzeile hinzufügt) oder die Nachrichten vollständig zurückzuweisen, falls ihr Spam-Grad einen bestimmten Schwellenwert übersteigt.
			</div></div><div
              class="para">
				Nachdem das Paket <span
                class="pkg pkg">clamav-milter</span> installiert ist, sollte milter umkonfiguriert werden um auf einen TCP-Port statt auf den Named Socket aufzusetzen. Das geht mit <code
                class="command">dpkg-reconfigure clamav-milter</code>. Wenn die Frage nach dem "Communication interface with Sendmail" gestellt wird geben Sie “<code
                class="literal">inet:10002@127.0.0.1</code>” ein.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ANMERKUNG</em></span> Wirklicher TCP Port vs Named Socket</strong></p></div></div></div><div
                class="para">
				Der Grund, warum wir einen wirklichen TCP Port verwenden statt eines Named Socket liegt darin, dass die Postfix-Hintergrundprozesse oft mit chroot gestartet werden und keinen Zugriff auf die Verzeichnisse mit den Named Sockets haben. Sie können ebenso entscheiden, einen Named Socket zu verwenden und dafür einen Ort unterhalb des mit chroot gesetzten Wurzelverzeichnisses wählen (<code
                  class="filename">/var/spool/postfix/</code>).
			</div></div><div
              class="para">
				Die standardmäßige ClamAV-Konfiguration eignet sich für die meisten Situationen, aber einige wichtige Parameter können noch mit <code
                class="command">dpkg-reconfigure clamav-base</code> angepasst werden.
			</div><div
              class="para">
				Im letzten Schritt wird Postfix angewiesen, den neu konfigurierten Filter zu verwenden. Dies geschieht einfach durch das Hinzufügen der folgenden Anweisung zu <code
                class="filename">/etc/postfix/main.cf</code>:
			</div><pre
              class="programlisting">
# Virus check with clamav-milter
smtpd_milters = inet:[127.0.0.1]:10002</pre><div
              class="para">
				Falls der Virenschutz Probleme verursacht, kann diese Zeile kommentiert und dann <code
                class="command">service postfix reload</code> aufgerufen werden, damit diese Veränderung berücksichtigt wird.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>IN DER PRAXIS</em></span> Den Virenschutz überprüfen</strong></p></div></div></div><div
                class="para">
				Sobald der Virenschutz eingerichtet ist, sollte er einem Test unterworfen werden. Dies geschieht am einfachsten dadurch, dass man eine Test-E-Mail mit einem Anhang verschickt, der die Datei <code
                  class="filename">eicar.com</code> (oder <code
                  class="filename">eicar.com.zip</code>) enthält, die aus dem Internet heruntergeladen werden kann: <div
                  xmlns=""
                  class="url">→ <a
                    xmlns="http://www.w3.org/1999/xhtml"
                    href="http://www.eicar.org/86-0-Intended-use.html">http://www.eicar.org/86-0-Intended-use.html</a></div>
			</div><div
                class="para">
				Diese Datei ist kein wirkliches Virus, sondern eine Testdatei, die alle auf dem Markt befindlichen Virenschutzprogramme als Virus diagnostizieren, um so die Überprüfung von Installationen zu ermöglichen.
			</div></div><div
              class="para">
				Alle Nachrichten, die von Postfix verarbeitet werden, laufen jetzt durch den Virenschutzfilter.
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.authenticated-smtp"></a>11.1.7. Authentifiziertes SMTP</h3></div></div></div><div
              class="para">
				Um E-Mails verschicken zu können, ist es erforderlich, dass ein SMTP-Server erreichbar ist; besagter SMTP-Server muss außerdem E-Mails durchleiten. Für Benutzer, die auf Reisen sind, würde dies bedeuten, dass die Konfiguration des SMTP-Clients regelmäßig geändert werden muss, da Falcots SMTP-Server Nachrichten abweist, die von IP-Adressen kommen, die offensichtlich nicht zum Unternehmen gehören. Es gibt zwei Lösungen: Entweder installiert ein Benutzer auf Reisen einen SMTP-Server auf seinem Rechner, oder er benutzt weiterhin den Unternehmensserver unter Verwendung einiger Hilfsmittel, mit denen er sich als Angestellter authentifiziert. Die erste Lösung wird nicht empfohlen, da der Rechner nicht ununterbrochen verbunden wäre und im Falle von Problemen nicht wiederholt versuchen könnte, Nachrichten zu senden; wir werden uns daher auf die zweite Lösung konzentrieren.
			</div><div
              class="para">
				SMTP-Authentifizierung in Postfix ist auf SASL angewiesen (<span
                class="emphasis"><em>Simple Authentication and Security Layer</em></span>). Hierzu ist es erforderlich, die Pakete <span
                class="pkg pkg">libsasl2-modules</span> und <span
                class="pkg pkg">sasl2-bin</span> zu installieren und dann für jeden Benutzer, der eine Authentifizierung beim SMTP-Server benötigt, ein Passwort in die SASL-Datenbank einzutragen. Dies geschieht mithilfe des Befehls <code
                class="command">saslpasswd2</code>, der verschiedene Parameter akzeptiert. Die Option <code
                class="literal">-u</code> legt die Authentifizierungs-Domain fest, die mit dem Parameter <code
                class="literal">smtpd_sasl_local_domain</code> in der Postfix-Konfiguration übereinstimmen muss. Die Option <code
                class="literal">-c</code> ermöglicht das Anlegen eines Benutzers und <code
                class="literal">-f</code> gestattet es, die Datei zu bestimmen, die benutzt werden soll, wenn die SASL-Datenbank an einem anderen als dem standardmäßig vorgegebenen Ort (<code
                class="filename">/etc/sasldb2</code>) gespeichert werden muss.
			</div><pre
              class="screen scale">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>saslpasswd2 -u `postconf -h myhostname` -f /var/spool/postfix/etc/sasldb2 -c jean</code></strong>
<code
                class="computeroutput">[... geben Sie Jeans Passwort zweimal ein ...]</code></pre><div
              class="para">
				Beachten Sie, dass die SASL-Datenbank im Verzeichnis von Postfix erstellt worden ist. Um Konsistenz sicherzustellen, wandeln wir außerdem <code
                class="filename">/etc/sasldb2</code> in einen symbolischen Verweis um, der auf die von Postfix verwendete Datenbank weist. Dies geschieht mit dem Befehl <code
                class="command">ln -sf /var/spool/postfix/etc/sasldb2 /etc/sasldb2</code>.
			</div><div
              class="para">
				Nun müssen wir Postfix so einstellen, dass es SASL benutzt. Zunächst muss der Benutzer <code
                class="literal">postfix</code> zur Gruppe <code
                class="literal">sasl</code> hinzugefügt werden, damit er auf die Datenbank des SASL-Kontos zugreifen kann. Einige zusätzliche Parameter sind erforderlich, um SASL zu aktivieren, und der Parameter <code
                class="literal">smtpd_recipient_restrictions</code> muss so eingestellt werden, dass Benutzer, die für SASL authentifiziert sind, ungehindert E-Mails versenden können.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.13.7"></a><p
                class="title"><strong>Beispiel 11.15. SASL in <code
                    class="filename">/etc/postfix/main.cf</code> aktivieren</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Enable SASL authentication
smtpd_sasl_auth_enable = yes
# Define the SASL authentication domain to use
smtpd_sasl_local_domain = $myhostname
[...]
# Adding permit_sasl_authenticated before reject_unauth_destination
# allows relaying mail sent by SASL-authenticated users
smtpd_recipient_restrictions = permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination,
[...]</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>EXTRA</em></span> Authentifizierter SMTP-Client</strong></p></div></div></div><div
                class="para">
				Die meisten E-Mail-Clients können sich bei einem SMTP-Server authentifizieren, bevor sie abgehende Nachrichten verschicken, und die Verwendung dieses Merkmals ist einfach eine Frage der passenden Parametereinstellung. Falls der verwendete Client diese Fähigkeit nicht besitzt, besteht eine Umgehungslösung darin, einen lokalen Postfix-Server zu verwenden und ihn für die Weiterleitung der E-Mails über den entfernten SMTP-Server einzustellen. In diesem Fall wird das lokale Postfix selbst der Client sein, der sich bei SASL authentifiziert. Hier sind die erforderlichen Parameter:
			</div><pre
                class="programlisting">
smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
relay_host = [mail.falcot.com]</pre><div
                class="para">
				Die Datei <code
                  class="filename">/etc/postfix/sasl_passwd</code> muss den Benutzernamen und das Passwort zur Authentifizierung beim Server <code
                  class="literal">mail.falcot.com</code> enthalten. Hier ist ein Beispiel:
			</div><pre
                class="programlisting">
[mail.falcot.com]   joe:LyinIsji</pre><div
                class="para">
				Wie bei allen Postfix-Zuordnungen muss diese Datei mit dem Befehl <code
                  class="command">postmap</code> in die Datei <code
                  class="filename">/etc/postfix/sasl_passwd.db</code> umgewandelt werden.
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>Zurück</strong>10.8. Werkzeuge für die Netzwerk-Diagnose</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Nach oben</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Zum Anfang</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>Weiter</strong>11.2. Webserver (HTTP)</a></li></ul></body></html>
