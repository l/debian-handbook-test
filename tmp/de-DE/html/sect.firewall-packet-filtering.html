<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">14.2. Firewall oder Paketfilter</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-de-DE-1.0-1" /><meta
        name="keywords"
        content="Firewall, Netzfilter, IDS/NIDS" /><link
        rel="home"
        href="index.html"
        title="Das Debian Administrationshandbuch" /><link
        rel="up"
        href="security.html"
        title="Kapitel 14. Sicherheit" /><link
        rel="prev"
        href="security.html"
        title="Kapitel 14. Sicherheit" /><link
        rel="next"
        href="sect.supervision.html"
        title="14.3. Überwachung: Vorbeugung, Entdeckung, Abschreckung" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/de-DE/stable/sect.firewall-packet-filtering.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>Zurück</strong></a></li><li
          class="home">Das Debian Administrationshandbuch</li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>Weiter</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.firewall-packet-filtering"></a>14.2. Firewall oder Paketfilter</h2></div></div></div><a
          id="id-1.17.5.2"
          class="indexterm"></a><a
          id="id-1.17.5.3"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>ZURÜCK ZU DEN GRUNDLAGEN</em></span> Firewall</strong></p></div></div></div><a
            id="id-1.17.5.4.2"
            class="indexterm"></a><div
            class="para">
			Eine <span
              class="emphasis"><em>Firewall</em></span> ist eine Computereinrichtung aus Hard- oder Software, die ein- und ausgehende Netzwerkpakete (zum lokalen Netzwerk kommend oder von ihm ausgehend) sortiert und nur diejenigen durchlässt, die bestimmte vorher festgelegte Bedingungen erfüllen.
		</div></div><div
          class="para">
			Eine Firewall ist ein filternder Netzübergang und nur bei Paketen wirksam, die durch sie hindurchgehen müssen. Deshalb kann sie nur dann wirksam sein, wenn der Weg durch die Firewall für diese Pakete die einzige Route ist.
		</div><div
          class="para">
			Da es keine Standardkonfiguration gibt (und das Motto „Prozess, nicht Produkt“ gilt), gibt es auch keine schlüsselfertige Lösung. Es gibt jedoch Hilfsprogramme, die die Konfigurierung der <span
            class="emphasis"><em>Netfilter</em></span>-Firewall mit einer grafischen Darstellung der Filterregeln vereinfachen. <code
            class="command">fwbuilder</code> ist zweifellos unter ihnen eines der besten.
		</div><a
          id="id-1.17.5.7"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>SONDERFALL</em></span> Lokale Firewall</strong></p></div></div></div><div
            class="para">
			Eine Firewall kann auf einen bestimmten Rechner beschränkt sein (im Gegensatz zu einem ganzen Netzwerk), wobei ihre Rolle dann darin besteht, den Zugang zu einigen Diensten zu filtern oder zu beschränken, oder möglicherweise ausgehende Verbindungen von Schadsoftware, die ein Anwender vorsätzlich oder unabsichtlich installiert hat, zu unterbinden.
		</div></div><div
          class="para">
			Der Linux Kernel schließt die <span
            class="emphasis"><em>Netfilter</em></span>-Firewall ein. Diese kann aus dem User Space mit den Befehlen <code
            class="command">iptables</code> und <code
            class="command">ip6tables</code> gesteuert werden. Der Unterschied zwischen diesen beiden Befehlen besteht darin, dass ersterer auf das IPv4-Netzwerk einwirkt, letzterer auf IPv6. Da beide Netzwerk-Protokoll-Stapel wahrscheinlich noch viele Jahre in Gebrauch sein werden, müssen beide Hilfsprogramme parallel verwendet werden.
		</div><a
          id="id-1.17.5.10"
          class="indexterm"></a><a
          id="id-1.17.5.11"
          class="indexterm"></a><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.netfilter"></a>14.2.1. Verhalten von Netfilter</h3></div></div></div><div
            class="para">
				<span
              class="emphasis"><em>Netfilter</em></span> verwendet vier verschiedene Tabellen, in denen Regeln gespeichert werden, die drei Arten von Vorgängen bei Paketen regeln:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">filter</code> betrifft Filterregeln (ein Paket annehmen, zurückweisen oder ignorieren);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">nat</code> betrifft die Übersetzung von Quell- oder Zieladressen und der Ports von Paketen;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">mangle</code> betrifft sonstige Änderungen an den IP-Paketen (einschließlich des ToS — <span
                    class="emphasis"><em>Type of Service</em></span> — Feldes und seiner Optionen);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">raw</code> ermöglicht andere manuelle Veränderungen an Paketen, bevor sie das Verbindungsverfolgungssystem erreichen.
					</div></li></ul></div><div
            class="para">
				Jede Tabelle enthält Regellisten, die <span
              class="emphasis"><em>Ketten</em></span> genannt werden. Die Firewall verwendet Standardketten, um Pakete in Abhängigkeit von vorher festgelegten Umständen zu bearbeiten. Der Administrator kann weitere Ketten erstellen, die aber nur benutzt werden, wenn von einer der Standardketten (entweder direkt oder indirekt) auf sie verwiesen wird.
			</div><a
            id="id-1.17.5.12.5"
            class="indexterm"></a><a
            id="id-1.17.5.12.6"
            class="indexterm"></a><div
            class="para">
				Die Tabelle <code
              class="literal">filter</code> enthält drei Standardketten:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">INPUT</code>: betrifft Pakete, deren Ziel die Firewall selbst ist;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">OUTPUT</code>: betrifft Pakete, die von der Firewall ausgesandt werden;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">FORWARD</code>: betrifft Pakete, die die Firewall durchqueren (die weder ihre Quelle noch ihr Ziel ist).
					</div></li></ul></div><div
            class="para">
				Die Tabelle <code
              class="literal">nat</code> enthält ebenfalls drei Standardketten:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">PREROUTING</code>: um Pakete zu verändern, sobald sie eintreffen;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">POSTROUTING</code>: um Pakete zu verändern, wenn sie für die Versendung bereit sind;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">OUTPUT</code>: um von der Firewall selbst erzeugte Pakete zu verändern.
					</div></li></ul></div><div
            class="figure"><a
              xmlns=""
              id="figure.chaines-netfilter"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/netfilter.png"
                  alt="Wie Netfilter-Ketten aufgerufen werden" /></div></div><p
              class="title"><strong>Abbildung 14.1. Wie <span
                  class="emphasis"><em>Netfilter</em></span>-Ketten aufgerufen werden</strong></p></div><div
            class="para">
				Jede Kette ist eine Liste von Regeln; jede Regel besteht aus einem Satz von Bedingungen und einer Aktion, die ausgeführt wird, wenn die Bedingungen erfüllt sind. Wenn ein Paket bearbeitet wird, fragt die Firewall die passende Kette Regel für Regel ab; wenn die Bedingungen einer Regel erfüllt sind, „springt“ (daher die Option <code
              class="literal">-j</code> für „jump“ in den Befehlen) sie zu der angegebenen Aktion, um die Bearbeitung dort fortzusetzen. Die gebräuchlichsten Verhaltensweisen sind standardisiert, und es gibt fest zugeordnete Aktionen für sie. Die Ausführung einer dieser Standardaktionen bricht die Bearbeitung der Kette ab, da das Schicksal des Pakets bereits besiegelt ist (abgesehen von einer weiter unten genannten Ausnahme):
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ZURÜCK ZU DEN GRUNDLAGEN</em></span> ICMP</strong></p></div></div></div><div
              class="para">
				ICMP (<span
                class="emphasis"><em>Internet Control Message </em></span>Protocol) ist das Protokoll, das zur Übertragung ergänzender Informationen bei der Datenübertragung verwendet wird. Mit ihm kann die Netzanbindung durch den Befehl <code
                class="command">ping</code> überprüft werden (der Befehl verschickt eine <span
                class="emphasis"><em>echo request</em></span> ICMP-Nachricht, die der Empfänger mit einer <span
                class="emphasis"><em>echo reply</em></span> ICMP-Nachricht beantworten soll). Es meldet, ob eine Firewall ein Paket zurückweist, zeigt einen Überlauf in einem Empfangspuffer an, schlägt einen besseren Pfad für die nächsten Pakete in einer Verbindung vor und so weiter. Dieses Protokoll ist durch mehrere RFC-Dokumente definiert; die ursprünglichen Dokumente RFC777 und RFC792 wurden schon bald vervollständigt und erweitert. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc777.html">http://www.faqs.org/rfcs/rfc777.html</a></div><div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc792.html">http://www.faqs.org/rfcs/rfc792.html</a></div>
			</div><div
              class="para">
				Hinweis: ein Empfangspuffer ist ein kleiner Speicherbereich, der Daten vom Zeitpunkt ihrer Ankunft aus dem Netzwerk bis zum Zeitpunkt ihrer Verarbeitung durch den Kernel speichert. Wenn dieser Bereich voll ist, können keine weiteren Daten empfangen werden, und ICMP meldet das Problem, so dass der Absender seine Übertragungsgeschwindigkeit reduzieren kann (die nach einiger Zeit möglichst ausgeglichen sein sollte).
			</div><a
              id="id-1.17.5.12.13.4"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.5"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.6"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.7"
              class="indexterm"></a><a
              id="id-1.17.5.12.13.8"
              class="indexterm"></a><div
              class="para">
				Man beachte, dass ein IPv4-Netzwerk zwar ohne ICMP funktionieren kann, dass aber ICMPv6 für ein IPv6-Netzwerk unbedingt erforderlich ist, da es mehrere Funktionen vereint, die in der IPv4-Welt auf ICMPv4, IGMP (<span
                class="emphasis"><em>Internet Group Membership Protocol</em></span>) und ARP (<span
                class="emphasis"><em>Address Resolution Protocol</em></span>) verteilt waren. ICMPv6 ist in der RFC4443 definiert. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.faqs.org/rfcs/rfc4443.html">http://www.faqs.org/rfcs/rfc4443.html</a></div>
			</div></div><div
            class="para">
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ACCEPT</code>: erlaube dem Paket, seinen Weg fortzusetzen;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">REJECT</code>: weise das Paket mit einem ICMP-Fehlerpaket zurück (die Option <code
                    class="literal">--reject-with <em
                      class="replaceable">Typ</em></code> in Verbindung mit dem Befehl <code
                    class="command">iptables</code> ermöglicht es, den Fehlertyp auszuwählen);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DROP</code>: lösche (ignoriere) das Paket;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">LOG</code>: protokolliere (mittels <code
                    class="command">syslogd</code>) eine Meldung mit einer Beschreibung des Pakets; man beachte, dass hierdurch die Verarbeitung nicht abgebrochen wird und die Ausführung der Kette mit der nächsten Regel weitergeht, weshalb das Protokollieren zurückgewiesener Pakete sowohl die LOG-Regel als auch die REJECT/DROP-Regel erfordert;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ULOG</code>: protokolliere eine Meldung mittels <code
                    class="command">ulogd</code>, das für die Verarbeitung einer hohen Anzahl von Meldungen anpassungsfähiger und effizienter ist als <code
                    class="command">syslogd</code>; man beachte, dass dieser Vorgang, wie bei LOG, die weitere Verarbeitung an die nächste Regel in der aufrufenden Kette zurückgibt;
					</div></li><li
                class="listitem"><div
                  class="para">
						<em
                    class="replaceable">ketten_name</em>: springe zu der angegebenen Kette und werte ihre Regeln aus;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">RETURN</code>: beende die Verarbeitung der aktuellen Kette und kehre zu der aufrufenden Kette zurück; falls die aktuelle Kette eine Standardkette ist, gibt es keine aufrufende Kette, und so wird stattdessen die voreingestellte Aktion (die durch die Option <code
                    class="literal">-P</code> des Befehls <code
                    class="command">iptables</code> festgelegt wird) ausgeführt;
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SNAT</code> (nur in der Tabelle <code
                    class="literal">nat</code>): wende <span
                    class="emphasis"><em>Source NAT</em></span> an (weitere Optionen beschreiben genau die anzuwendenden Änderungen);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">DNAT</code> (nur in der Tabelle <code
                    class="literal">nat</code>): wende <span
                    class="emphasis"><em>Destination NAT</em></span> an (weitere Optionen beschreiben genau die anzuwendenden Änderungen);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">MASQUERADE</code> (nur in der Tabelle <code
                    class="literal">nat</code>): wende <span
                    class="emphasis"><em>masquerading</em></span> an (ein Sonderfall von <span
                    class="emphasis"><em>Source NAT</em></span>);
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">REDIRECT</code> (nur in der Tabelle <code
                    class="literal">nat</code>): lenke das Paket an einen vorgegebenen Port der Firewall selbst um; dies kann dazu benutzt werden, einen transparenten Webproxy aufzusetzen, der auf der Clientseite ohne Konfiguration funktioniert, da der Client davon ausgeht, dass er direkt mit dem Empfänger verbunden ist, während der Nachrichtenaustausch in Wirklichkeit durch den Proxy läuft.
					</div></li></ul></div><div
            class="para">
				Andere Aktionen, insbesondere solche, die die <code
              class="literal">mangle</code>-Tabelle betreffen, liegen außerhalb des Rahmens dieses Textes. Die Handbuchseiten <span
              class="citerefentry"><span
                class="refentrytitle">iptables</span>(8)</span> und <span
              class="citerefentry"><span
                class="refentrytitle">ip6tables</span>(8)</span> enthalten umfangreiche Auflistungen.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.iptables"></a>14.2.2. Syntax von <code
                    class="command">iptables</code> und <code
                    class="command">ip6tables</code></h3></div></div></div><div
            class="para">
				Mit den Befehlen <code
              class="command">iptables</code> und <code
              class="command">ip6tables</code> können Tabellen, Ketten und Regeln gehandhabt werden. Ihre Option <code
              class="literal">-t <em
                class="replaceable">tabelle</em></code> zeigt an, welche Tabelle bearbeitet werden soll (die Voreinstellung ist <code
              class="literal">filter</code>).
			</div><a
            id="id-1.17.5.13.3"
            class="indexterm"></a><a
            id="id-1.17.5.13.4"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.iptables-command"></a>14.2.2.1. Befehle</h4></div></div></div><div
              class="para">
					Die Option <code
                class="literal">-N <em
                  class="replaceable">kette</em></code> erzeugt eine neue Kette. Die Option <code
                class="literal">-X <em
                  class="replaceable">kette</em></code> löscht eine leere und unbenutzte Kette. Die Option <code
                class="literal">-A <em
                  class="replaceable">kette</em>_<em
                  class="replaceable">regel</em></code> fügt am Ende der angegebenen Kette eine Regel an. Die Option <code
                class="literal">-I <em
                  class="replaceable">kette</em> <em
                  class="replaceable">regel_nummer</em><em
                  class="replaceable">regel</em></code> fügt eine Regel vor der Regel mit der Nummer <em
                class="replaceable">regel_nummer</em> ein. Die Option <code
                class="literal">-D <em
                  class="replaceable">kette</em><em
                  class="replaceable">regel_nummer</em></code> (oder <code
                class="literal">-D <em
                  class="replaceable">kette</em><em
                  class="replaceable">regel</em></code>) löscht eine Regel in der Kette; die erste Syntax identifiziert die zu löschende Regel durch ihre Nummer, während letztere sie durch ihren Inhalt identifiziert. Die Option <code
                class="literal">-F <em
                  class="replaceable">kette</em></code> leert eine Kette (löscht alle ihre Regeln); wenn keine Kette angegeben wird, werden alle Regeln der Tabelle gelöscht. Die Option <code
                class="literal">-L <em
                  class="replaceable">kette</em></code> listet alle Regeln der Kette auf. Schließlich legt die Option <code
                class="literal">-P <em
                  class="replaceable">kette</em>_<em
                  class="replaceable">aktion</em></code> die voreingestellte Aktion oder „Richtlinie“ einer gegebenen Kette fest; man beachte, dass nur Standardketten eine derartige Richtlinie haben können.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="sect.iptables-rules"></a>14.2.2.2. Regeln</h4></div></div></div><a
              id="id-1.17.5.13.6.2"
              class="indexterm"></a><div
              class="para">
					Jede Regel wird in der Form <code
                class="literal"><em
                  class="replaceable">bedingungen</em> -j <em
                  class="replaceable">aktion</em><em
                  class="replaceable">aktions_optionen</em></code> dargestellt. Werden mehrere Bedingungen in derselben Regel angegeben, dann ist das Kriterium die Verknüpfung (das logische <span
                class="emphasis"><em>und</em></span>) der Bedingungen, die wenigstens so restriktiv ist wie jede einzelne Bedingung.
				</div><div
              class="para">
					Die Bedingung <code
                class="literal">-p <em
                  class="replaceable">protokoll</em></code> vergleicht das Protokollfeld des IP-Pakets. Die häufigsten Werte sind <code
                class="literal">tcp</code>, <code
                class="literal">udp</code>, <code
                class="literal">icmp</code> und <code
                class="literal">icmpv6</code>. Ein vorangestelltes Ausrufezeichen kehrt die Bedingung um, die dann dem Ausdruck „alle Pakete mit einem anderen als dem angegebenen Protokoll“ entspricht. Dieser Umkehrungsmechanismus ist nicht auf die Option <code
                class="literal">-p</code> beschränkt, sondern kann auch auf alle anderen Bedingungen angewendet werden.
				</div><div
              class="para">
					Die Bedingung <code
                class="literal">-s <em
                  class="replaceable">adresse</em></code> oder <code
                class="literal">-s <em
                  class="replaceable">network/mask</em></code> vergleicht die Quelladresse des Pakets. Dementsprechend vergleicht die Bedingung <code
                class="literal">-d <em
                  class="replaceable">adresse</em></code> oder <code
                class="literal">-d <em
                  class="replaceable">network/mask</em></code> die Zieladresse.
				</div><div
              class="para">
					Die Bedingung <code
                class="literal">-i <em
                  class="replaceable">schnittstelle</em></code> wählt Pakete, die von der angegebenen Netzwerkschnittstelle kommen. <code
                class="literal">-o <em
                  class="replaceable">schnittstelle</em></code> wählt Pakete, die von einer bestimmten Schnittstelle abgehen.
				</div><div
              class="para">
					Es gibt genauere Bedingungen in Abhängigkeit von den oben beschriebenen allgemeinen Bedingungen. So kann zum Beispiel die Bedingung <code
                class="literal">-p tcp</code> um Bedingungen für die TCP-Ports ergänzt werden durch Ausdrücke wie <code
                class="literal">--source-port <em
                  class="replaceable">port</em></code> und <code
                class="literal">--destination-port <em
                  class="replaceable">port</em></code>.
				</div><div
              class="para">
					Die Bedingung <code
                class="literal">--state <em
                  class="replaceable">status</em></code> vergleicht den Status eines Pakets in einer Verbindung (hierbei ist das Kernelmodul <code
                class="command">ipt_conntrack</code> zur Verbindungsverfolgung erforderlich). Der Status <code
                class="literal">NEW</code> bezeichnet ein Paket, das eine neue Verbindung eröffnet; <code
                class="literal">ESTABLISHED</code> gilt für Pakete, die zu einer bereits bestehenden Verbindung gehören, und <code
                class="literal">RELATED</code> entspricht Paketen, die eine neue Verbindung im Zusammenhang mit einer bestehenden eröffnen (dies ist nützlich für die <code
                class="literal">ftp-data</code>-Verbindungen im „aktiven“ Modus des FTP-Protokolls).
				</div><div
              class="para">
					Der vorstehende Abschnitt führt verfügbare Aktionen auf, aber nicht ihre jeweiligen Optionen. Die Aktion <code
                class="literal">LOG</code> hat zum Beispiel folgende Optionen:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-level</code>, mit dem voreingestellten Wert <code
                      class="literal">warning</code>, gibt die Priorität des <code
                      class="command">syslog</code>-Schweregrads an;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-prefix</code> ermöglicht es, einen Text-Vorspann festzulegen, um protokollierte Meldungen unterscheiden zu können;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="literal">--log-tcp-sequence</code>, <code
                      class="literal">--log-tcp-options</code> und <code
                      class="literal">--log-ip-options</code> kennzeichnen zusätzliche Daten zur Einbindung in die Meldung, und zwar die TCP-Sequenznummer, die TCP-Optionen und die IP-Optionen.
						</div></li></ul></div><div
              class="para">
					Die Aktion <code
                class="literal">DNAT</code> bietet die Option <code
                class="literal">--to-destination <em
                  class="replaceable">addresse</em>:<em
                  class="replaceable">port</em></code> an, mit der die neue IP-Zieladresse und der neue Zielport gekennzeichnet werden. Genauso bietet <code
                class="literal">SNAT</code> die Option <code
                class="literal">--to-source <em
                  class="replaceable">addresse</em>:<em
                  class="replaceable">port</em></code> an, mit der die neue IP-Quelladresse und der neue Quellport gekennzeichnet werden.
				</div><div
              class="para">
					Die Aktion <code
                class="literal">REDIRECT</code> (nur wenn NAT verfügbar ist) bietet die Option <code
                class="literal">--to-ports <em
                  class="replaceable">port(s)</em></code> an, mit der der Port oder der Portbereich gekennzeichnet werden, an den die Pakete umgelenkt werden sollen.
				</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.creating-rules"></a>14.2.3. Regeln erstellen</h3></div></div></div><div
            class="para">
				Für jede erstellte Regel muss jedes Mal <code
              class="command">iptables</code>/<code
              class="command">ip6tables</code> aufgerufen werden. Da es mühsam ist, diese Befehle von Hand einzugeben, werden sie normalerweise in einem Skript gespeichert, so dass bei jedem Rechnerstart automatisch dieselbe Konfiguration eingerichtet wird. Dieses Skript kann von Hand geschrieben werden, aber es kann auch interessant sein, es mit einem hochentwickelten Hilfsprogramm wie <code
              class="command">fwbuilder</code> zu erstellen.
			</div><pre
            class="screen">
<code
              class="computeroutput"># </code><strong
              class="userinput"><code>apt install fwbuilder</code></strong></pre><div
            class="para">
				Das Prinzip ist einfach. Zunächst müssen alle Elemente beschrieben werden, die in den eigentlichen Regeln enthalten sein werden:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						die Firewall selbst mit ihren Netzwerkschnittstellen;
					</div></li><li
                class="listitem"><div
                  class="para">
						die Netzwerke mit ihren jeweiligen IP-Bereichen;
					</div></li><li
                class="listitem"><div
                  class="para">
						die Server;
					</div></li><li
                class="listitem"><div
                  class="para">
						die Ports, die zu den auf den Servern untergebrachten Diensten gehören.
					</div></li></ul></div><div
            class="para">
				Die Regeln werden dann durch einfaches Ziehen und Ablegen auf die Objekte erstellt. Über einige kontextbezogene Menüs kann die Bedingung geändert (zum Beispiel umgekehrt) werden. Anschließend muss die Aktion ausgewählt und konfiguriert werden.
			</div><div
            class="para">
				Was IPv6 betrifft, so kann man entweder zwei verschiedene Regelsätze für IPv4 und IPv6 erstellen, oder nur einen und <code
              class="command">fwbuilder</code> die Regeln je nach den Adressen, die den Objekten zugewiesen sind, übersetzen lassen.
			</div><div
            class="figure"><a
              xmlns=""
              id="figure.fwbuilder"></a><div
              class="figure-contents"><div
                class="mediaobject"><img
                  src="images/fwbuilder.png"
                  alt="Das Hauptfenster des Fwbuilder" /></div></div><p
              class="title"><strong>Abbildung 14.2. Das Hauptfenster des Fwbuilder</strong></p></div><a
            id="id-1.17.5.14.9"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">fwbuilder</code> kann dann ein Skript zur Konfigurierung der Firewall in Übereinstimmung mit den festgelegten Regeln erstellen. Seine modulare Architekt bietet die Möglichkeit, Skripte für unterschiedliche Systeme zu erstellen (<code
              class="command">iptables</code> für Linux, <code
              class="command">ipf</code> für FreeBSD und <code
              class="command">pf</code> für OpenBSD).
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="sect.install-rules-at-boot"></a>14.2.4. Die Regeln bei jedem Rechnerstart installieren</h3></div></div></div><div
            class="para">
				In anderen Fällen besteht der empfohlene Weg darin, das Konfigurationsskript in einer <code
              class="literal">up</code>-Anweisung der Datei <code
              class="filename">/etc/network/interfaces</code> einzutragen. Im folgenden Beispiel ist das Skript unter <code
              class="filename">/usr/local/etc/arrakis.fw</code> gespeichert.
			</div><div
            class="example"><a
              xmlns=""
              id="example.network-interfaces-firewall"></a><p
              class="title"><strong>Beispiel 14.1. Aufruf eines Firewallskripts durch eine <code
                  class="filename">interfaces</code>-Datei</strong></p><div
              class="example-contents"><pre
                class="programlisting">auto eth0
iface eth0 inet static
    address 192.168.0.1
    network 192.168.0.0
    netmask 255.255.255.0
    broadcast 192.168.0.255
    up /usr/local/etc/arrakis.fw</pre></div></div><div
            class="para">
				This obviously assumes that you are using <span
              class="pkg pkg">ifupdown</span> to configure the network interfaces. If you are using something else (like <span
              class="emphasis"><em>NetworkManager</em></span> or <span
              class="emphasis"><em>systemd-networkd</em></span>), then refer to their respective documentation to find out ways to execute a script after the interface has been brought up.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="security.html"><strong>Zurück</strong>Kapitel 14. Sicherheit</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Nach oben</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Zum Anfang</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.supervision.html"><strong>Weiter</strong>14.3. Überwachung: Vorbeugung, Entdeckung, Abschr...</a></li></ul></body></html>
