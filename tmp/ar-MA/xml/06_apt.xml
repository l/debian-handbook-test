<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
]>
<chapter id="apt" lang="ar-MA">
	<chapterinfo>
		 <keywordset>
			<keyword>apt</keyword>
			 <keyword>apt-get</keyword>
			 <keyword>apt-cache</keyword>
			 <keyword>aptitude</keyword>
			 <keyword>synaptic</keyword>
			 <keyword>sources.list</keyword>
			 <keyword>apt-cdrom</keyword>

		</keywordset>

	</chapterinfo>
	 <title>الصيانة والتحديث: أدوات APT</title>
	 <highlights> <para>
		ما يجعل دبيان شهيرة جداً بين مديري النظم هو سهولة تثبيت البرمجيات وسهولة تحديث النظام بالكامل. يعود الفضل الأكبر في هذه الميزة الفريدة للبرنامج <emphasis>APT</emphasis>، الذي بحث فيه مديرو النظم في شركة فلكوت بتمعن.
	</para>
	 </highlights> <para>
		<indexterm><primary>APT</primary></indexterm> <indexterm><primary>Advanced Package Tool</primary></indexterm> APT هو اختصار لأداة الحزم المتفوقة Advanced Package Tool. ما يجعل هذه الأداة ”متفوقة“ هو أسلوب تعاملها مع الحزم. فهي لا تعالجها معالجة فردية بسيطة، بل تعتبرها كياناً واحداً وتنتج أفضل تجميعة ممكنة من الحزم اعتماداً على ما هو متوفر ومتوافق (تبعاً للاعتماديات).
	</para>
	 <sidebar> <title><emphasis>مصطلحات</emphasis> مصدر الحزم والحزم المصدرية</title>
	 <para>
		يجب ألا تخلط بين الحزمة المصدرية —الحزمة التي تحوي مصدر البرنامج— وبين مصدر الحزم وهو المستودع (قد يكون موقع إنترنت، أو مخدم FTP، أو قرص ليزري، أو مجلد محلي، الخ) الذي يحوي الحزم.
	</para>
	 </sidebar> <para>
		تحتاج APT أن تعطيها ”لائحة بمصادر الحزم“: يحوي الملف <filename dir="ltr">/etc/apt/sources.list</filename> قائمة بالمستودعات المختلفة (أو ”المصادر“) التي توزع حزم دبيان. بعدها تستورد APT قائمة الحزم التي يوزعها كل من هذه المصادر. تتم هذه العملية من خلال تنزيل الملف <filename dir="ltr">Packages.xz</filename> (في حال كان المصدر يوفر حزماً ثنائية) أو أحد بدائله الناتجة عن استخدام طريقة ضغط مختلفة (مثل <filename>Packages.gz</filename> أو <filename>.bz2</filename>) والملف <filename dir="ltr">Sources.xz</filename> أو أحد بدائله (في حال كان مصدراً للحزم المصدرية) وتحليل محتوياتها. عند وجود نسخة قديمة سابقة من هذه الملفات، تستطيع APT تحديثها بتنزيل الاختلافات بين الملف القديم والجديد فقط (انظر الملاحظة الجانبية <xref linkend="sidebar.apt-pdiff" />).
	</para>
	 <indexterm>
		<primary><filename>Packages.xz</filename></primary>
	</indexterm>
	 <indexterm>
		<primary><filename>Sources.xz</filename></primary>
	</indexterm>
	 <sidebar> <title><emphasis>أساسيات</emphasis> الضغط باستخدام <command>gzip</command>، ‏<command> bzip2</command>، ‏<command>LZMA</command>‏ و<command>XZ</command></title>
	 <indexterm>
		<primary><command>gzip</command></primary>
	</indexterm>
	 <indexterm>
		<primary><command>bzip2</command></primary>
	</indexterm>
	 <indexterm>
		<primary><command>lzma</command></primary>
	</indexterm>
	 <indexterm>
		<primary><command>xz</command></primary>
	</indexterm>
	 <para>
		يشير الامتداد <filename dir="ltr">.gz</filename> إلى ملف مضغوط باستخدام الأداة <command>gzip</command>. الأداة <command>gzip</command> أداة تقليدية في يونكس سريعة وفعالة لضغط الملفات. توفر الأدوات الأحدث مستويات ضغط أعلى لكنها تتطلب موارد أكثر (زمن معالجة وذاكرة) لضغط أو فك ضغط الملفات. نذكر من بينها، وبحسب ترتيب ظهورها، <command>bzip2</command> (تولد ملفات بامتداد <filename dir="ltr">.bz2</filename>)، و<command>lzma</command> (تولد ملفات <filename dir="ltr">.lzma</filename>)، و<command>xz</command> (تولد ملفات <filename dir="ltr">.xz</filename>).
	</para>
	 </sidebar> <section id="sect.apt-sources.list">
		<title>تعبئة الملف <filename>sources.list</filename></title>
		 <indexterm>
			<primary><filename>sources.list</filename></primary>
		</indexterm>
		 <indexterm>
			<primary>مصدر</primary>
			<secondary>حزم</secondary>
		</indexterm>
		 <indexterm>
			<primary>حزمة</primary>
			<secondary>مصدر</secondary>
		</indexterm>
		 <indexterm>
			<primary><filename>/etc/apt/sources.list</filename></primary>
		</indexterm>
		 <section>
			<title>صيغة الملف</title>
			 <para>
				يحتوي كل سطر فعال من الملف <filename dir="ltr">/etc/apt/sources.list</filename> على وصف لمصدر حزم واحد، يتألف من 3 أجزاء تفصلها مسافات.
			</para>
			 <para>
				يبين الحقل الأول نوع المصدر:
			</para>
			 <itemizedlist>
				<listitem>
					<para>
						”<literal>deb</literal>“ للحزم الثنائية،
					</para>

				</listitem>
				 <listitem>
					<para>
						”<literal>deb-src</literal>“ للحزم المصدرية.
					</para>

				</listitem>

			</itemizedlist>
			 <para>
				يعطي الحقل الثاني عنوان URL الأساسي للمصدر (وإذا أضفناه إلى أسماء الملفات الموجودة في ملفات <filename>Packages.gz</filename>، يجب أن يعطي عناوين URL كاملة وصالحة لتنزيل هذه الملفات): يمكن أن يشير هذا العنوان إلى مرآة دبيان أو أي أرشيف حزم آخر تديره أطراف أخرى. يمكن أن يبدأ العنوان بـ <literal dir="ltr">file://</literal> ليشير إلى مصدر محلي مرتبط بشجرة ملفات النظام، أو <literal dir="ltr">http://</literal> ليشير إلى مصدر متاح عبر مخدم وب، أو <literal dir="ltr">ftp://</literal> لمصدر متوفر على مخدم FTP. كما يمكن أن يبدأ العنوان أيضاً بـ <literal dir="ltr">cdrom:</literal> بالنسبة للتثبيت عبر الأقراص الليزرية (DVD-ROM/CD-ROM/Blu-ray)، بَيْدَ أن هذا أقل شيوعاً، نظراً لزيادة انتشار طرق التثبيت عبر الشبكات.
			</para>
			 <para>
				تعتمد صيغة الحقل الأخير على بنية المستودع. في أبسط الحالات، يمكنك ببساطة تحديد مجلد فرعي (تتلوه شرطة مائلة ”/“ إلزامية) من مجلدات المصدر المرغوب (غالباً ما يستعمل الرمز ”<filename dir="ltr">./</filename>“ للدلالة على عدم وجود مجلد فرعي – أي أن الحزم متوفرة مباشرة على العنوان المحدد). لكن على الأرجح، ستكون بنية المستودع كبنية مرآة دبيان، حيث يحوي عدة توزيعات كل منها تحوي عدة مكونات. في هذه الحالات، عليك إضافة اسم التوزيعة المختارة (اسمها ”الرمزي“ —انظر القائمة في الملاحظة الجانبية <xref linkend="sidebar.bruce-perens" />— أو اسم ”الفرع suite“ الموافق: <literal>stable</literal>،‏ <literal>testing</literal>،‏ <literal>unstable</literal>)، بعدها ضع أسماء المكونات (أو الأقسام) التي تريد تفعيلها (إما <literal>main</literal> أو <literal>contrib</literal> أو <literal>non-free</literal> في مرايا دبيان النموذجية).
			</para>
			 <sidebar id="sidebar.sections"> <title><emphasis>مصطلحات</emphasis> الأقسام <literal>main</literal>، ‏<literal>contrib</literal> و<literal>non-free</literal></title>
			 <indexterm>
				<primary>قسم</primary>
				<secondary><literal>main</literal></secondary>
			</indexterm>
			 <indexterm>
				<primary><literal>main</literal>، قسم</primary>
			</indexterm>
			 <indexterm>
				<primary>قسم</primary>
				<secondary><literal>contrib</literal></secondary>
			</indexterm>
			 <indexterm>
				<primary><literal>contrib</literal>، قسم</primary>
			</indexterm>
			 <indexterm>
				<primary>قسم</primary>
				<secondary><literal>non-free</literal></secondary>
			</indexterm>
			 <indexterm>
				<primary><literal>non-free</literal>، قسم</primary>
			</indexterm>
			 <indexterm>
				<primary>جزء (من مستودع حزم)</primary>
			</indexterm>
			 <para>
				تستخدم دبيان ثلاثة أقسام للتفريق بين الحزم وفقاً للرخص التي اختارها مؤلفو كل عمل. يجمع <literal>main</literal> جميع الحزم التي تتوافق تماماً مع مبادئ دبيان للبرمجيات الحرة.
			</para>
			 <para>
				يختلف الأرشيف <literal>non-free</literal> بأنه يحوي برمجيات لا تتوافق (تماماً) مع هذه المبادئ لكن يمكن توزيعها دون قيود بالرغم من ذلك. هذا الأرشيف ليس جزءاً رسمياً من دبيان، بل هو خدمة للمستخدمين الذين قد يحتاجون بعضاً من هذه البرامج – مع ذلك تنصح دبيان دائماً بإعطاء الأولوية للبرمجيات الحرة. إن وجود هذا القسم يمثِّل مشكلة حقيقية من وجهة نظر ريتشارد ستولمن وهو سبب عدم تزكية مؤسسة البرمجيات الحرة لتوزيعة دبيان للمستخدمين.
			</para>
			 <para>
				أما <literal>contrib</literal> (المشتركات contributions) فهو مخزن للبرمجيات مفتوحة المصدر التي لا تعمل إلا بوجود بعض العناصر غير الحرة. يمكن أن تكون هذه العناصر برمجيات من القسم <literal>non-free</literal>، أو ملفات غير حرة مثل ذواكرROM لبعض الألعاب، أو BIOS إحدى الـمنصَّات، الخ. يحوي <literal>contrib</literal> أيضاً برمجيات حرة تتطلب ترجمتها عناصر احتكارية. كانت هذه حالة طقم البرامج المكتبية OpenOffice.org في البداية، حيث كان يتطلب بيئة جافا محتكرة.
			</para>
			 </sidebar> <sidebar> <title><emphasis>تلميح</emphasis> الملفات <filename dir="ltr">/etc/apt/*.list</filename></title>
			 <para>
				في حال الإشارة للكثير من مصادر الحزم، فقد يكون فصلها إلى عدة ملفات مفيداً. يُخزَّن كل جزء عندها في <filename dir="ltr">/etc/apt/sources.list.d/<replaceable>filename</replaceable>.list</filename> (انظر الملاحظة الجانبية <xref linkend="sidebar.directory.d" />).
			</para>
			 </sidebar> <indexterm>
				<primary><command>apt-cdrom</command></primary>
			</indexterm>
			 <para>
				تصف مدخلات <literal>cdrom</literal> أقراص CD أو DVD. أقراص CD-ROM غير متوفرة دوماً بخلاف المدخلات الأخرى، لأنه يجب وضعها في السواقة التي لا تستطيع سوى قراءة قرص واحد في كل مرة. لهذا السبب، تدار هذه المصادر بطريقة مختلفة قليلاً، ويجب إضافتها باستخدام البرنامج <command>apt-cdrom</command>، باستخدام البارامتر <literal>add</literal> عادة. عندها سيطلب البرنامج إدخال القرص في السواقة ويتصفح محتوياته بحثاً عن ملفات <filename>Packages</filename>. ثم يستخدم هذه الملفات لتحديث قاعدة بيانات الحزم المتوفرة التي يديرها (تنفذ هذه العملية عادة بالأمر <command>apt update</command>). بعد ذلك، تستطيع APT أن تطلب إدخال القرص إذا احتاجت إحدى الحزم المخزنة عليه.
			</para>

		</section>
		 <section>
			<title>مستودعات مستخدمي دبيان <emphasis role="distribution">المستقرة</emphasis></title>
			 <para>
				هذا ملف <filename>sources.list</filename> قياسي لنظام يعمل بالنسخة <emphasis role="distribution">المستقرة</emphasis> من دبيان:
			</para>
			 <example id="example.stable-sources-list">
				<title>ملف <filename dir="ltr">/etc/apt/sources.list</filename> لمستخدمي دبيان المستقرة</title>
				 
<programlisting># Security updates
deb http://security.debian.org/ jessie/updates main contrib non-free
deb-src http://security.debian.org/ jessie/updates main contrib non-free

## Debian mirror

# Base repository
deb http://ftp.debian.org/debian jessie main contrib non-free
deb-src http://ftp.debian.org/debian jessie main contrib non-free

# Stable updates
deb http://ftp.debian.org/debian jessie-updates main contrib non-free
deb-src http://ftp.debian.org/debian jessie-updates main contrib non-free

# Stable backports
deb http://ftp.debian.org/debian jessie-backports main contrib non-free
deb-src http://ftp.debian.org/debian jessie-backports main contrib non-free</programlisting>

			</example>
			 <para>
				هذا الملف يسرد جميع مصادر حزم النسخة <emphasis role="distribution">جيسي</emphasis> من دبيان (<emphasis role="distribution">المستقرة</emphasis> الحالية في زمن هذا الكتاب). لقد فضلنا تسمية ”جيسي“ صراحة بدلاً من استخدام ”stable“ ‏(<literal>stable</literal>، ‏<literal>stable-updates</literal>، ‏<literal>stable-backports</literal>) لأننا لا نريد أن تحدث تغييرات خارجة عن سيطرتنا في التوزيعة عندما تصدر النسخة المستقرة التالية.
			</para>
			 <para>
				تتوفر معظم الحزم عبر ”المستودع الأساسي“ الذي يحوي جميع الحزم لكنه نادراً ما يتم تحديثه (يُحَدَّث هذا المستودع مرة كل شهرين تقريباً عند كل ”إصدار ثانوي point release“). أما المستودعات الأخرى فهي جزئية (لا تحوي جميع الحزم) ويمكن أن تحوي تحديثات (حزم ذات إصدارات أحدث) يمكن أن تنزلها APT. تشرح الأقسام التالية الغرض من كل واحد من هذه المستودعات والقواعد التي تحكمه.
			</para>
			 <para>
				لاحظ أنه عند توفر الحزمة المرغوبة في عدة مستودعات، سيستخدم المستودع الأول حسب ترتيبها في ملف <filename>sources.list</filename>. لذلك تضاف المصادر غير الرسمية عادة إلى نهاية الملف.
			</para>
			 <para>
				كملاحظة جانبية، معظم ما يذكر في هذه الأقسام عن النسخة <emphasis role="distribution">المستقرة</emphasis> ينطبق أيضاً على <emphasis role="distribution">المستقرة القديمة</emphasis> بما أن الأخيرة ليست إلا نسخة <emphasis role="distribution">مستقرة</emphasis> سابقة لا تزال صيانتها جارية على التوازي مع الحالية.
			</para>
			 <section id="sect.security-updates">
				<title>التحديثات الأمنية</title>
				 <indexterm>
					<primary><literal>security.debian.org</literal></primary>
				</indexterm>
				 <indexterm>
					<primary>تحديثات أمنية</primary>
				</indexterm>
				 <indexterm>
					<primary>تحديثات</primary>
					<secondary>تحديثات أمنية</secondary>
				</indexterm>
				 <para>
					تستضاف التحديثات الأمنية على <literal>security.debian.org</literal> (على مجموعة صغيرة من الأجهزة يشرف عليها <link linkend="dsa-team">Debian System Administrators</link>) بدلاً من استضافتها على شبكة مرايا دبيان العادية. يحتوي هذا الأرشيف على التحديثات الأمنية (التي يجهزها Debian Security Team وربما مشرفو الحزم أيضاً) للتوزيعة <emphasis role="distribution">المستقرة</emphasis>.
				</para>
				 <para>
					يمكن أن يستضيف هذا المخدم أيضاً التحديثات الأمنية للتوزيعة <emphasis role="distribution">الاختبارية</emphasis> لكن هذا قليلاً ما يحدث لأن هذه التحديثات تصل إلى <emphasis role="distribution">الاختبارية</emphasis> غالباً عبر التحديثات المنتظمة التي ترد إليها من التوزيعة <emphasis role="distribution">غير المستقرة</emphasis>.
				</para>

			</section>
			 <section id="sect.stable-updates">
				<title>التحديثات المستقرة</title>
				 <indexterm>
					<primary>تحديثات دبيان المستقرة</primary>
				</indexterm>
				 <indexterm>
					<primary><literal>stable-updates</literal></primary>
				</indexterm>
				 <indexterm>
					<primary>تحديثات</primary>
					<secondary>تحديثات مستقرة</secondary>
				</indexterm>
				 <para>
					التحديثات المستقرة ليست حساسة من الناحية الأمنية لكنها تعتبر هامة بما يكفي لدفعها إلى المستخدمين قبل إطلاق الإصدار الثانوي التالي.
				</para>
				 <para>
					يحوي هذا المستودع نموذجياً إصلاحات العلل الحرجة التي لم يكن إصلاحها ممكناً قبل الإصدار أو التي نتجت عن التحديثات التالية له. قد يحتوي أيضاً –حسب الضرورة– على تحديثات للحزم التي لا بد لها أن تتطور مع الزمن… مثل قواعد اكتشاف الرسائل الإلكترونية الدعائية (spam) الخاصة ببرنامج <emphasis role="pkg">spamassassin</emphasis>، وقواعد بيانات الفيروسات الخاصة ببرنامج <emphasis role="pkg">clamav</emphasis>، أو قواعد ضبط التوقيت الصيفي للمناطق الزمنية كافة (<emphasis role="pkg">tzdata</emphasis>).
				</para>
				 <para>
					عملياً هذا المستودع هو جزء من المستودع <literal>proposed-updates</literal>، ينتقيه مديرو الإصدارة المستقرة بعناية.
				</para>

			</section>
			 <section id="sect.proposed-updates">
				<title>التحديثات المقترحة</title>
				 <indexterm>
					<primary><literal>proposed-updates</literal></primary>
				</indexterm>
				 <indexterm>
					<primary><literal>stable-proposed-updates</literal></primary>
				</indexterm>
				 <para>
					بعد إصدار التوزيعة <emphasis role="distribution">المستقرة</emphasis>، لا يتم تحديثها إلا مرة واحدة كل شهرين تقريباً. المستودع <literal>proposed-updates</literal> هو المكان الذي يتم فيه تحضير التحديثات المنتظرة (تحت إشراف مديري الإصدارة المستقرة).
				</para>
				 <para>
					التحديثات المستقرة والأمنية التي تحدثنا عنها في القسمين السابقين متوفرة دائماً في هذا المستودع، لكن هناك تحديثات إضافية أيضاً، لأنه يمكن لمشرفي الحزم أيضاً إصلاح العلل المهمة لكنها لا تستحق الإصدار فوراً.
				</para>
				 <para>
					يستطيع أي شخص استعمال هذا المستودع لاختبار هذه التحديثات قبل إصدارها الرسمي. السطر التالي يستعمل الاسم <literal>jessie-proposed-updates</literal> لأنه أكثر وضوحاً وتلاؤماً نظراً لأن المستودع <literal>wheezy-proposed-updates</literal> متوفر أيضاً (لتحديثات التوزيعة <emphasis role="distribution">المستقرة القديمة</emphasis>):
				</para>
				 
<programlisting>deb http://ftp.debian.org/debian jessie-proposed-updates main contrib non-free</programlisting>

			</section>
			 <section id="sect.backports">
				<title>المنقولات الخلفية للنسخة المستقرة</title>
				 <indexterm>
					<primary><literal>stable-backports</literal></primary>
				</indexterm>
				 <indexterm>
					<primary>منقول خلفي</primary>
				</indexterm>
				 <indexterm>
					<primary>تحديثات</primary>
					<secondary>منقولات خلفية</secondary>
				</indexterm>
				 <para>
					يستضيف المستودع <literal>stable-backports</literal> ”الحزم المنقولة خلفاً package backports“. يشير هذا المصطلح إلى حزم لبرمجيات حديثة أعيدت ترجمتها لتوزيعة قديمة (نقلت إلى الخلف)، وعادة ما يكون النقل إلى التوزيعة <emphasis role="distribution">المستقرة</emphasis>.
				</para>
				 <para>
					عندما تتقادم التوزيعة قليلاً، تُطلِق العديد من مشروعات البرمجيات إصدارات جديدة غير متوفرة في التوزيعة <emphasis role="distribution">المستقرة</emphasis> الحالية (التي لا تُعدَّل إلا لتصحيح المشاكل الحيوية فقط، مثل المشاكل الأمنية). وبما أن استخدام التوزيعتين <emphasis role="distribution">الاختبارية</emphasis> و<emphasis role="distribution">غير المستقرة</emphasis> فيه مخاطرة أكبر، يُقدِّم المشرفون على الحزم أحياناً نسخاً من البرمجيات الحديثة بعد إعادة ترجمتها للتوزيعة <emphasis role="distribution">المستقرة</emphasis>، وباستخدام هذه الحزم ينحصر خطر عدم الاستقرار في عدد من الحزم المحددة. <ulink type="block" url="http://backports.debian.org" />
				</para>
				 <para>
					أصبح المستودع <literal>stable-backports</literal> الآن متوفراً على المرايا العادية لدبيان. لكن المنقولات الخلفية لنسخة <emphasis role="distribution">سكويز</emphasis> لا تزال مستضافة على مخدم خاص (<literal>backports.debian.org</literal>)، وتحتاج المدخلة التالية في ملف <filename>sources.list</filename>:
				</para>
				 <indexterm>
					<primary><literal>backports.debian.org</literal></primary>
				</indexterm>
				 
<programlisting>deb http://backports.debian.org/debian-backports squeeze-backports main contrib non-free
</programlisting>
				 <para>
					تُنشَأ المنقولات في المستودع <literal>stable-backports</literal> دائماً من الحزم المتوفرة في <emphasis role="distribution">الاختبارية</emphasis>. يضمن هذا الإجراء قابلية تحديث جميع المنقولات الخلفية المُثبَّتَة إلى النسخ المستقرة الموافقة لها فور إطلاق الإصدارة المستقرة التالية من دبيان.
				</para>
				 <para>
					رغم أن هذا المستودع يقدم إصدارات أحدث من الحزم، إلا أن APT لن تثبتها ما لم تأمرها بذلك صراحة (أو إذا كانت هناك نسخة قديمة من المنقول الخلفي نفسه مثبتة مسبقاً):
				</para>
				 
<screen><computeroutput>$ </computeroutput><userinput>sudo apt-get install <replaceable>package</replaceable>/jessie-backports
</userinput><computeroutput>$ </computeroutput><userinput>sudo apt-get install -t jessie-backports <replaceable>package</replaceable>
</userinput></screen>

			</section>

		</section>
		 <section>
			<title>مستودعات مستخدمي <emphasis role="distribution">الاختبارية</emphasis> أو <emphasis role="distribution">غير المستقرة</emphasis></title>
			 <para>
				فيما يلي ملف <filename>sources.list</filename> قياسي لنظام يعمل بالنسخة <emphasis role="distribution">الاختبارية</emphasis> أو <emphasis role="distribution">غير المستقرة</emphasis> من دبيان:
			</para>
			 <example id="example.testing-sources-list">
				<title>ملف <filename dir="ltr">/etc/apt/sources.list</filename> لمستخدمي دبيان <emphasis role="distribution">الاختبارية</emphasis>/<emphasis role="distribution">غير المستقرة</emphasis></title>
				 
<programlisting>
# Unstable
deb http://ftp.debian.org/debian unstable main contrib non-free
deb-src http://ftp.debian.org/debian unstable main contrib non-free

# Testing
deb http://ftp.debian.org/debian testing main contrib non-free
deb-src http://ftp.debian.org/debian testing main contrib non-free

# Stable
deb http://ftp.debian.org/debian stable main contrib non-free
deb-src http://ftp.debian.org/debian stable main contrib non-free

# Security updates
deb http://security.debian.org/ stable/updates main contrib non-free
deb http://security.debian.org/ testing/updates main contrib non-free
deb-src http://security.debian.org/ stable/updates main contrib non-free
deb-src http://security.debian.org/ testing/updates main contrib non-free
</programlisting>

			</example>
			 <para>
				عند استخدام هذا الملف سوف تثبت APT الحزم من التوزيعة <emphasis role="distribution">غير المستقرة</emphasis>. إذا لم ترغب بذلك، استخدم الخيار <literal>APT::Default-Release</literal> (انظر <xref linkend="sect.apt-upgrade" />) لإرشاد APT إلى توزيعة أخرى لالتقاط الحزم منها (ستكون <emphasis role="distribution">الاختبارية</emphasis> على الأغلب في هذه الحالة).
			</para>
			 <para>
				هناك أسباب وجيهة لإضافة كل هذه المستودعات، رغم أن مستودعاً واحداً منها يكفي. سيستفيد مستخدمو <emphasis role="distribution">الاختبارية</emphasis> من إمكانية التقاط حزمة من <emphasis role="distribution">غير المستقرة</emphasis> بعد إصلاح علة مزعجة كانت تعاني منها النسخة المتوفرة في <emphasis role="distribution">الاختبارية</emphasis>. من جهة أخرى، يستطيع مستخدمو التوزيعة <emphasis role="distribution">غير المستقرة</emphasis> إذا واجهتهم تدهورات غير متوقعة تخفيض إصدارات حزمهم (downgrade) إلى نسخ التوزيعة <emphasis role="distribution">الاختبارية</emphasis> (التي يفترض أنها تعمل).
			</para>
			 <para>
				تضمين <emphasis role="distribution">المستقرة</emphasis> قابل للنقاش لكنه غالباً يسمح بالوصول إلى بعض الحزم التي تمت إزالتها من النسخ التطويرية. كما أنه يضمن لك الحصول على آخر التحديثات للحزم التي لم تُعدَّل منذ الإصدار المستقر الأخير.
			</para>
			 <section>
				<title>المستودع <emphasis role="distribution">Experimental</emphasis></title>
				 <indexterm>
					<primary><emphasis role="distribution">التجريبية</emphasis></primary>
				</indexterm>
				 <para>
					يتوفر أرشيف حزم التوزيعة <emphasis role="distribution">التجريبية Experimental</emphasis> على جميع مرايا دبيان، ويحوي حزماً غير موجودة في النسخة <emphasis role="distribution">غير المستقرة</emphasis> بعد بسبب نوعيتها دون المعيارية — فهي غالباً نسخ تطويرية من البرمجيات أو إصدارات أولية (ألفا، بيتا، مرشح للإصدار rc = release candidate…). يمكن إرسال الحزمة إلى هناك أيضاً بعد إجراء تغييرات عليها يمكن أن تؤدي إلى مشاكل. يحاول المشرف بعدها استرجاعها بمساعدة المستخدمين المتقدمين القادرين على معالجة المشاكل الخطيرة. بعد هذه المرحلة الأولى، تُنقَل الحزمة إلى النسخة <emphasis role="distribution">غير المستقرة</emphasis>، حيث تلقى جمهوراً أوسع بكثير ويتم فحصها بتدقيق أكبر بكثير.
				</para>
				 <para>
					يستخدم النسخة <emphasis role="distribution">التجريبية</emphasis> عادة المستخدمون الذي لا يهتمون إذا تعطل نظامهم واضطروا لإصلاحه ثانية. تعطي هذه التوزيعة إمكانية استيراد حزمة يريد المستخدم تجربتها أو استخدامها عند الحاجة. تستخدم دبيان هذا المستودع بهذه الطريقة بالضبط، إذ أن إضافته إلى ملف <filename>sources.list</filename> لا تؤدي إلى استخدام حزمها آلياً. السطر الذي تجب إضافته هو:
				</para>
				 <informalexample> 
<programlisting>deb http://ftp.debian.org/debian experimental main contrib non-free
</programlisting>
				 </informalexample>
			</section>

		</section>
		 <section>
			<title>مصادر غير رسمية: <literal>mentors.debian.net</literal></title>
			 <indexterm>
				<primary><literal>mentors.debian.net</literal></primary>
			</indexterm>
			 <para>
				هناك مصادر غير رسمية عديدة لحزم دبيان يعدها مستخدمون محترفون يعيدون تجميع بعض البرمجيات (ساهمت أوبنتو في نشر هذا الأمر من خلال خدمة أرشيف الحزم الشخصي Personal Package Service أو PPA)، أو مبرمجون يوفرون برامجهم للعموم، أو ربما مطورو دبيان يقدمون نسخاً أولية من حزمهم.
			</para>
			 <para>
				موقع <literal>mentors.debian.net</literal> مثير للاهتمام (ولو أنه لا يقدم إلا الحزم المصدرية)، حيث يجمع الحزم التي يصنعها المرشحون لمنصب مطور دبيان رسمي أو المتطوعون الراغبون بصناعة حزم دبيان دون الدخول في تفاصيل عملية دمجها في التوزيعة. هذه الحزم متوفرة دون أي ضمان لجودتها؛ فاحرص على التحقق من مصدرها وسلامتها ثم اختبرها قبل أن تقرر الاعتماد عليها في الإنتاج.
			</para>
			 <sidebar> <title><emphasis>مجتمع</emphasis> مواقع <literal>debian.net</literal></title>
			 <indexterm>
				<primary><emphasis>debian.net</emphasis></primary>
			</indexterm>
			 <para>
				إن النطاق <emphasis>debian.net</emphasis> ليس مصدراً رسمياً لمشروع دبيان. يمكن لأي مطور دبيان استخدام اسم النطاق ذاك لأغراضه الخاصة. قد تحوي هذه المواقع خدمات غير رسمية (وأحياناً مواقع شخصية) يستضيفها جهاز أعده مطورو دبيان لكنه لا ينتمي للمشروع، أو ربما نماذج أولية على وشك نقلها إلى <emphasis>debian.org</emphasis>. يوجد سببين لتفسير بقاء بعض النماذج الأولية على <emphasis>debian.net</emphasis>: إما إنّ أحدهم لم يبذل الجهد اللازم لتحويلها إلى خدمة رسمية (مستضافة على <emphasis>debian.org</emphasis>، ولها ضمانات معينة من ناحية الدعم)، أو أن الخدمة محل خلاف يحول دون أن تصبح رسمية.
			</para>
			 </sidebar> <para>
				إن تثبيت حزمة ما يعني منح صلاحيات الجذر لصانعها، لأنه من يقرر محتويات سكربتات التهيئة التي تعمل بتلك الصلاحيات. حزم دبيان الرسمية يصنعها متطوعون عملنا معهم واختبرناهم ولديهم إمكانية ختم حزمهم بحيث يمكن التحقق من مصدرها وسلامتها.
			</para>
			 <para>
				عموماً، كن حذراً من الحزم التي لا تعرف مصدرها والتي لا يستضيفها أحد مخدّمات دبيان الرسمية: قيّم مدى ثقتك بصانعها، وتحقق من سلامة الحزمة. <ulink type="block" url="http://mentors.debian.net/" />
			</para>
			 <sidebar id="sidebar.snapshot.debian.org"> <title><emphasis>التعمق أكثر</emphasis> إصدارات الحزم القديمة: <literal>snapshot.debian.org</literal></title>
			 <indexterm>
				<primary><literal>snapshot.debian.org</literal></primary>
			</indexterm>
			 <para>
				يمكن استخدام خدمة <literal>snapshot.debian.org</literal>، التي قُدِّمَت في أبريل 2010، ”للعودة عبر الزمن“ والعثور على نسخة قديمة من الحزمة. يمكن استخدامها مثلاً لمعرفة أي إصدار من الحزمة سبب انتكاساً، وبصورة أكثر دقة، للعودة إلى النسخة السابقة أثناء انتظار إصلاح الانتكاس.
			</para>
			 </sidebar>
		</section>
		 <section>
			<title>بروكسيات التخبئة لحزم دبيان</title>
			 <indexterm>
				<primary>مخبأ وسيط</primary>
			</indexterm>
			 <indexterm>
				<primary>بروكسي تخبئة</primary>
			</indexterm>
			 <para>
				عند إعداد شبكة كاملة من الأجهزة لاستخدام المخدم البعيد نفسه لتنزيل نفس الحزم المُحَدَّثة، يدرك أي مدير نظم أنه سيستفيد من استخدام بروكسي وسيط يعمل كمخبأ (كاش) للشبكة المحلية (انظر الملاحظة الجانبية <xref linkend="sidebar.cache" />).
			</para>
			 <para>
				يمكنك إعداد APT لاستخدام بروكسي ”معياري“ (انظر <xref linkend="sect.apt-config" /> لإعداد APT، و<xref linkend="sect.http-ftp-proxy" /> لإعداد البروكسي)، لكن بيئة دبيان تقدم خيارات أفضل لمعالجة هذه المشكلة. البرمجيات المتخصصة المذكورة في هذا القسم أذكى من بروكسيات التخبئة (Cache Proxies) العادية لأنها تستطيع الاعتماد على البنية الخاصة لمستودعات APT (مثلاً تعرف هذه البرمجيات إذا انتهت صلاحية الملف أم لا، وبالتالي تستطيع ضبط فترة الاحتفاظ به).
			</para>
			 <indexterm>
				<primary><emphasis role="pkg">apt-cacher</emphasis></primary>
			</indexterm>
			 <indexterm>
				<primary><emphasis role="pkg">apt-cacher-ng</emphasis></primary>
			</indexterm>
			 <para>
				يعمل <emphasis role="pkg">apt-cacher</emphasis> و<emphasis role="pkg">apt-cacher-ng</emphasis> مثل مخدمات التخبئة الوسيطة العادية. حيث يبقى الملف <filename>sources.list</filename> دون تعديل، لكن تُضبَطُ APT حتى تَستَخدِم أحد البرنامجين كبروكسي للطلبات الخارجية.
			</para>
			 <indexterm>
				<primary><emphasis role="pkg">approx</emphasis></primary>
			</indexterm>
			 <para>
				من ناحية أخرى، يعمل <emphasis role="pkg">approx</emphasis> كمخدم HTTP ينسخ (أو يعكس ”mirror“) أي عدد من المستودعات البعيدة إلى عناوين URL من المستوى الأول خاصة به. تخزن العلاقات بين هذه المجلدات ذات المستوى الأول والعناوين البعيدة للمستودعات في <filename dir="ltr">/etc/approx/approx.conf</filename>:
			</para>
			 
<programlisting>
# &lt;name&gt; &lt;repository-base-url&gt;
debian   http://ftp.debian.org/debian
security http://security.debian.org
</programlisting>
			 <para>
				يعمل <emphasis role="pkg">approx</emphasis> افتراضياً على المنفذ 9999 (انظر <xref linkend="sect.inetd" />) ويتطلب من المستخدم تعديل ملف <filename>sources.list</filename> ليشير إلى مخدم approx:
			</para>
			 
<programlisting># Sample sources.list pointing to a local approx server
deb http://apt.falcot.com:9999/security jessie/updates main contrib non-free
deb http://apt.falcot.com:9999/debian jessie main contrib non-free
</programlisting>

		</section>

	</section>
	 <section id="sect.apt-get">
		<title>‏<command>aptitude</command>، و<command>apt-get</command>، و<command>apt</command></title>
		 <indexterm>
			<primary><command>apt</command></primary>
		</indexterm>
		 <indexterm>
			<primary><command>apt-get</command></primary>
		</indexterm>
		 <indexterm>
			<primary><command>aptitude</command></primary>
		</indexterm>
		 <para>
			APT مشروع ضخم، تضمنت خططه الأصلية واجهة رسومية. يرتكز المشروع على مكتبة تحوي لب التطبيق، و كانت <command>apt-get</command> أول واجهة –نصية– طوِّرت ضمن المشروع. أما <command>apt</command> فهي واجهة نصية ثانية طورها مشروع APT للتغلب على بعض الأخطاء التصميمية في <command>apt-get</command>.
		</para>
		 <para>
			ظهرت بعدها العديد من الواجهات الرسومية كمشاريع خارجية: مثل <command>synaptic</command>، و <command>aptitude</command> (الذي يحتوي على واجهة نصيّة وأخرى رسومية — وإنْ لم تكتمل بعد)، و <command>wajig</command>، الخ. أكثر واجهة ننصح بها هي <command>apt</command>، وهي التي سنستخدمها في الأمثلة المعطاة في هذا القسم. لكن لاحظ على أي حال أن صيغة أوامر <command>apt-get</command> و<command>aptitude</command> متشابهة جداً. عند وجود اختلافات كبيرة بين <command>apt-get</command> و<command>aptitude</command> أو <command>apt-get</command>، سوف نفصّل هذه الاختلافات.
		</para>
		 <section>
			<title>التهيئة</title>
			 <para>
				قبل إجراء أي عمل باستخدام APT يجب تحديث قائمة الحزم المتوفرة؛ يمكن تنفيذ ذلك بسهولة من خلال <command>apt update</command>. قد تستغرق العملية وقتاً حسب سرعة الاتصال، نظراً لأنها تحتاج لتنزيل عدد من ملفات <filename>Packages</filename>/<filename>Sources</filename>/<filename>Translation-<replaceable>language-code</replaceable></filename>، والتي كبرت أكثر وأكثر تدريجياً مع تطور دبيان (على الأقل 10 م.ب. من البيانات للقسم <literal>main</literal>). طبعاً، لا يحتاج التثبيت من القرص الليزري أي تنزيل — لذلك تكون العملية سريعة جداً في هذه الحالة.
			</para>
			 <indexterm>
				<primary><command>apt update</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>apt-get update</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>aptitude update</command></primary>
			</indexterm>

		</section>
		 <section>
			<title>التثبيت والإزالة</title>
			 <indexterm>
				<primary>حزمة</primary>
				<secondary>تثبيت</secondary>
			</indexterm>
			 <indexterm>
				<primary>حزمة</primary>
				<secondary>إزالة</secondary>
			</indexterm>
			 <indexterm>
				<primary>تثبيت</primary>
				<secondary>تثبيت حزمة</secondary>
			</indexterm>
			 <indexterm>
				<primary>إزالة حزمة</primary>
			</indexterm>
			 <para>
				يمكن إضافة الحزم إلى النظام أو إزالتها منه باستخدام APT، باستخدام الأمر <command>apt install <replaceable>package</replaceable></command> والأمر <command>apt remove <replaceable>package</replaceable></command>. في كلا الحالتين، ستثبت APT الاعتماديات الضرورية أو تحذف الحزم التي تعتمد على الحزمة التي تتم إزالتها. يزيل الأمر <command>apt purge <replaceable>package</replaceable></command> الحزمة بالكامل — حيث تحذف ملفات الضبط أيضاً.
			</para>
			 <indexterm>
				<primary><command>apt install</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>apt remove</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>apt purge</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>apt-get install</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>apt-get remove</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>apt-get purge</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>aptitude install</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>aptitude remove</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>aptitude purge</command></primary>
			</indexterm>
			 <sidebar> <title><emphasis>تلميح</emphasis> تثبيت المجموعة نفسها من الحزم عدة مرات</title>
			 <para>
				قد يفيدك تثبيت قائمة الحزم نفسها عدة مرات آلياً على عدة حواسيب. يمكن عمل ذلك بسهولة كبيرة.
			</para>
			 <para>
				أولاً، احصل على قائمة الحزم المثبتة على الحاسوب الذي سيخدمنا ”كنموذج“ نريد نسخه.
			</para>
			 
<screen><computeroutput>$ </computeroutput><userinput>dpkg --get-selections &gt;pkg-list</userinput></screen>
			 <para>
				سيحتوي الملف <filename>pkg-list</filename> بعدها على لائحة بالحزم المثبتة. ثم انقل الملف <filename>pkg-list</filename> إلى الحواسيب التي تريد تحديثها واستخدم الأوامر التالية:
			</para>
			 
<screen>## Update dpkg's database of known packages
# <userinput>avail=`mktemp`</userinput>
# <userinput>apt-cache dumpavail &gt; "$avail"</userinput>
# <userinput>dpkg --merge-avail "$avail"</userinput>
# <userinput>rm -f "$avail"</userinput>
## Update dpkg's selections
# <userinput>dpkg --set-selections &lt; pkg-list</userinput>
## Ask apt-get to install the selected packages
# <userinput>apt-get dselect-upgrade</userinput></screen>
			 <para>
				يسجّل الأمر الأول قائمة الحزم المتوفرة في قاعدة بيانات dpkg، بعدها يستعيد الأمر <command>dpkg --set-selections</command> الحزم التي تريد تثبيتها، ثم نستدعي <command>apt-get</command> لتنفيذ العمليات المطلوبة! لا تملك <command>aptitude</command> هذا الأمر.
			</para>
			 </sidebar> <sidebar> <title><emphasis>تلميح</emphasis> الإزالة والتثبيت في الوقت نفسه</title>
			 <para>
				من الممكن الطلب من <command>apt</command> (أو <command>apt-get</command> (أو <command>aptitude</command>) تثبيت حزم معينة وإزالة أخرى بالأمر نفسه بإضافة لاحقة. أضف ”<literal>-</literal>“ إلى أسماء الحزم التي تريد إزالتها مع الأمر <command>apt install</command>. أما مع الأمر <command>apt remove</command>، فأضف ”<literal>+</literal>“ إلى أسماء الحزم التي تريد تثبيتها.
			</para>
			 <para>
				يبين المثال التالي طريقتين مختلفتين لتثبيت <replaceable>package1</replaceable> وإزالة <replaceable>package2</replaceable>.
			</para>
			 
<screen># <userinput>apt install <replaceable>package1</replaceable> <replaceable>package2-</replaceable></userinput>
[...]
# <userinput>apt remove <replaceable>package1+</replaceable> <replaceable>package2</replaceable></userinput>
[...]</screen>
			 <para>
				يمكن استخدام هذا الإجراء أيضاً لاستبعاد بعض الحزم التي كانت ستثبت، نتيجة <literal>Recommends</literal> مثلاً. عموماً، تستخدم خوارزمية تلبية الاعتماديات (dependency solver) هذه المعلومات كتلميح للبحث عن حلول بديلة.
			</para>
			 </sidebar> <sidebar> <title><emphasis>تلميح</emphasis> <command>apt --reinstall</command> و<command>aptitude reinstall</command> </title>
			 <indexterm>
				<primary>إعادة التثبيت</primary>
			</indexterm>
			 <para>
				أحياناً يتضرر النظام بعد إزالة أو تعديل الملفات في حزمة ما. أسهل طريقة لاستعادة هذه الملفات هي إعادة تثبيت الحزمة المتأثرة. لسوء الحظ، سيجد نظام التحزيم أن هذه الحزمة مثبتة فعلاً وسيرفض إعادة تثبيتها بأدب؛ ولتجاوز هذا الأمر، استخدم الخيار <literal dir="ltr">--reinstall</literal> مع الأمر <command>apt</command> أو الأمر <command>apt-get</command>. الأمر التالي يعيد تثبيت الحزمة <emphasis role="pkg">postfix</emphasis> حتى لو كانت مثبتة مسبقاً:
			</para>
			 
<screen><computeroutput># </computeroutput><userinput>apt --reinstall install postfix</userinput></screen>
			 <para>
				إن صيغة الأمر في <command>aptitude</command> مختلفة قليلاً، لكنها تؤدي الوظيفة ذاتها باستخدام <command>aptitude reinstall postfix</command>.
			</para>
			 <para>
				لا تظهر هذه المشكلة مع <command>dpkg</command>، لكن مدير النظام نادراً ما يستعمله مباشرة.
			</para>
			 <para>
				كن حذراً! إن استخدام <command>apt --reinstall</command> لاستعادة الحزم المُعدَّلة خلال هجوم أمني قطعاً لن يستعيد النظام كما كان. يفصّل <xref linkend="sect.dealing-with-compromised-machine" /> الخطوات الضرورية للتعامل مع نظام تم اختراقه.
			</para>
			 </sidebar> <para>
				إذا كان الملف <filename>sources.list</filename> يشير إلى عدة توزيعات، فمن الممكن تحديد النسخة التي تريد تثبيتها من الحزمة. يمكن أن تطلب رقم إصدار محدد من خلال الأمر <command>apt install <replaceable>package</replaceable>=<replaceable>version</replaceable></command>، لكن الأفضل عادة تحديد التوزيعة التي تريد تثبيت الحزمة منها (<emphasis role="distribution">المستقرة</emphasis>، أو <emphasis role="distribution">الاختبارية</emphasis>، أو <emphasis role="distribution">Stable</emphasis>) — باستخدام الأمر <command>apt install <replaceable>package</replaceable>/<replaceable>distribution</replaceable></command>. بهذه الطريقة يمكنك العودة إلى نسخة أقدم من الحزمة (مثلاً إذا كنت تعلم أنها تعمل بشكل جيد)، شريطة أن تبقى متوفرة في أحد المصادر المذكورة في ملف <filename>sources.list</filename>. وإلا فإن أرشيف <literal>snapshot.debian.org</literal> قد يساعد في إنقاذ الموقف (انظر الملاحظة الجانبية <xref linkend="sidebar.snapshot.debian.org" />).
			</para>
			 <example>
				<title>تثبيت النسخة <emphasis role="distribution">غير المستقرة</emphasis> من <emphasis role="pkg">spamassassin</emphasis></title>
				 
<screen><computeroutput># </computeroutput><userinput>apt install spamassassin/unstable</userinput></screen>

			</example>
			 <sidebar> <title><emphasis>التعمق أكثر</emphasis> مخبأ ملفات <filename dir="ltr">.deb</filename></title>
			 <para>
				تحتفظ APT بنسخة من كل ملف <filename dir="ltr">.deb</filename> تُنَزِّله في المجلد <filename dir="ltr">/var/cache/apt/archives/</filename>. يمكن أن يستهلك هذا المجلد مساحة كبيرة من القرص في حالة التحديث المتكرر بسبب تخزين عدة إصدارات من كل حزمة؛ عليك إذن ترتيبه بانتظام. يمكن استخدام أمرين: <command>apt-get clean</command> الذي يفرغ المجلد بالكامل؛ و <command>apt-get autoclean</command> الذي يحذف الحزم التي لا يمكن تنزيلها ثانية (لأنها اختفت من مرآة دبيان) وهي بالتالي عديمة النفع (يمكن لمتغير الإعداد <literal>APT::Clean-Installed</literal> أن يمنع إزالة ملفات <filename dir="ltr">.deb</filename> المثبتة حالياً).
			</para>
			 </sidebar>
		</section>
		 <section id="sect.apt-upgrade">
			<title>تحديث النظام</title>
			 <indexterm>
				<primary>تحديث</primary>
				<secondary>تحديث النظام</secondary>
			</indexterm>
			 <indexterm>
				<primary><command>apt upgrade</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>apt-get upgrade</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>aptitude safe-upgrade</command></primary>
			</indexterm>
			 <para>
				يُنصَح بتحديث النظام بشكل منتظم، وذلك للحصول على آخر التحديثات الأمنية. استخدم الأمر <command>apt upgrade</command> أو <command>apt-get upgrade</command> أو الأمر <command>aptitude safe-upgrade</command> لتحديث النظام (بعد تنفيذ <command>apt update</command> طبعاً). يبحث هذا الأمر عن الحزم المثبتة التي يمكن تحديثها دون إزالة أي حزم من النظام. أي أن الغرض هو تحديث النظام بأقل تأثير ممكن. إن <command>apt-get</command> متشددة أكثر من <command>aptitude</command> و<command>apt</command> لأنها ترفض تثبيت الحزم التي لم تكن مثبتة من قبل.
			</para>
			 <sidebar id="sidebar.apt-pdiff"> <title><emphasis>تلميح</emphasis> التحديث التصاعدي</title>
			 <para>
				كما شرحنا سابقاً، إن غرض الأمر <command>apt update</command> هو تنزيل ملف <filename>Packages</filename> (أو <filename>Sources</filename>) لكل مصدر من مصادر الحزم. ولكن يمكن أن تبقى هذه الملفات كبيرة حتى بعد ضغطها باستخدام <command>bzip2</command>، (يستهلك ملف <filename>Packages.xz</filename> الخاص بالقسم <foreignphrase>main</foreignphrase> لتوزيعة <emphasis role="distribution">جيسي</emphasis> أكثر من 6 م.ب.). إذا كنت تنوي التحديث بانتظام، فقد تستغرق هذه التنزيلات الكثير من الوقت.
			</para>
			 <para>
				لتسريع هذه العملية تستطيع APT تنزيل ملف ”diff“ يحوي الاختلافات عن التحديث السابق، بدلاً من تنزيل الملف كاملاً. لتحقيق ذلك، توزع مرايا دبيان الرسمية ملفات مختلفة تسرد الاختلافات بين كل نسخة من ملف <filename>Packages</filename> والنسخة التي تليها. تولّد هذه الملفات عند كل تحديث للأرشيفات ويتم إبقاء المحفوظات لأسبوع واحد. كل واحد من ملفات ”diff“ هذه يستهلك عدة عشرات من الكيلوبايتات فقط بالنسبة للتوزيعة <emphasis role="distribution">غير المستقرة</emphasis>، لذا فإن كمية البيانات المُنزَّلة عند استدعاء <command>apt update</command> أسبوعياً أصغر بعشر مرات غالباً. أما بالنسبة للتوزيعات الأخرى مثل <emphasis role="distribution">المستقرة</emphasis> و<emphasis role="distribution">الاختبارية</emphasis>، اللتان تتغيران بمعدل أقل، فإن التوفير ملحوظ أكثر.
			</para>
			 <para>
				على أي حال، قد ترغب أحياناً بتنزيل ملف <filename>Packages</filename> بالكامل قسراً، خصوصاً عندما يكون آخر تحديث قديماً جداً وعندما لا تفيد آلية الاختلافات التصاعدية كثيراً. قد يعجبك هذا أيضاً عندما يكون اتصالك بالشبكة سريعاً جداً لكن معالج الجهاز الذي تريد تحديثه بطيء، نظراً لأن الوقت الذي ستوفره من تنزيل الملفات أقل من الوقت الذي يضيعه الحاسوب في حساب الإصدارات الجديدة لهذه الملفات (يحسبها من الإصدارات القديمة بتطبيق الاختلافات المنزّلة عليها). لعمل ذلك، يمكنك استخدام متغير الإعداد <literal>Acquire::Pdiffs</literal> وضبطه على <literal>false</literal>.
			</para>
			 </sidebar> <para>
				ستختار <command>apt</command> الإصدار الأحدث عادة (فيما عدا حزم التوزيعة <emphasis role="distribution">التجريبية Experimental</emphasis> وحزم <emphasis role="distribution">stable-backports</emphasis>، التي يتم تجاهلها افتراضياً مهما كان رقم إصدارها). فإذا أضفتَ <emphasis role="distribution">Testing</emphasis> أو <emphasis role="distribution">Unstable</emphasis> إلى ملف <filename>sources.list</filename>، سوف يغير الأمر <command>apt upgrade</command> معظم توزيعتك <emphasis role="distribution">المستقرة</emphasis> إلى <emphasis role="distribution">اختبارية</emphasis> أو <emphasis role="distribution">غير مستقرة</emphasis>، وقد لا يكون هذا مقصدك.
			</para>
			 <para>
				حتى تطلب من <command>apt</command> أن تستخدم توزيعة محددة عند البحث عن تحديثات الحزم، عليك استخدام الخيار <literal dir="ltr">-t</literal> أو <literal dir="ltr">--target-release</literal>، متبوعاً باسم التوزيعة التي تريد (مثلاً: <command>apt -t stable upgrade</command>). لتفادي تحديد هذا الخيار في كل مرة تستخدم فيها <command>apt</command>، يمكنك إضافة <literal>APT::Default-Release "stable";</literal>‎ إلى الملف <filename dir="ltr">/etc/apt/apt.conf.d/local</filename>.
			</para>
			 <indexterm>
				<primary><command>apt full-upgrade</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>apt dist-upgrade</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>apt-get dist-upgrade</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>aptitude dist-upgrade</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>aptitude full-upgrade</command></primary>
			</indexterm>
			 <para>
				بالنسبة للتحديثات الأهم، مثل الانتقال من أحد إصدارات دبيان الرئيسية إلى التالي، عليك استخدام <command>apt full-upgrade</command>. عند تنفيذ هذه التعليمة، ستكمل <command>apt</command> التحديث حتى لو اضطرت لإزالة بعض الحزم الميتة أو تثبيت اعتماديات جديدة. هذا هو أيضاً الأمر الذي يستعمله مستخدمو إصدارة دبيان <emphasis role="distribution">غير المستقرة</emphasis>ويتابعون تطورها يوماً بيوم. هذه التعليمة أبسط من أن تحتاج لشرح: فهذه الوظيفة العظيمة هي أساس شهرة APT.
			</para>
			 <para>
				بعكس <command>apt</command> و<command>aptitude</command>، لا تملك <command>apt-get</command> الأمر <command>full-upgrade</command>. بل عليك استخدام الأمر التاريخي والشهير <command>apt-get dist-upgrade</command> (من العبارة ‏”distribution upgrade“ أي تحديث التوزيعة)، الذي تقبله <command>apt</command> و<command>aptitude</command> أيضاً لراحة المستخدمين الذي اعتادوا على استخدامه.
			</para>

		</section>
		 <section id="sect.apt-config">
			<title>خيارات الإعداد</title>
			 <indexterm>
				<primary>APT</primary>
				<secondary>ضبط</secondary>
			</indexterm>
			 <indexterm>
				<primary><filename>apt.conf.d/</filename></primary>
			</indexterm>
			 <indexterm>
				<primary><filename>/etc/apt/apt.conf.d/</filename></primary>
			</indexterm>
			 <para>
				بالإضافة إلى عناصر الضبط التي ذكرناها سابقاً، من الممكن ضبط بعض نواحي APT بإضافة تعليمات في ملف في مجلد <filename>/etc/apt/apt.conf.d/</filename>. تذكر مثلاً أن APT تستطيع الطلب من <command>dpkg</command> تجاهل أخطاء تعارض الملفات بتحديد <literal dir="ltr">DPkg::options { "--force-overwrite"; }</literal>.
			</para>
			 <para>
				إذا لم يكن الوصول للوب ممكناً إلا من خلال بروكسي، أضف سطراً مثل <literal>Acquire::http::proxy "http://<replaceable>yourproxy</replaceable>:3128"</literal>‎. أما بالنسبة لبروكسيات FTP فاكتب <literal>Acquire::ftp::proxy "ftp://<replaceable>yourproxy</replaceable>"</literal>‎. لاكتشاف المزيد من خيارات الضبط، اقرأ صفحة الدليل <citerefentry><refentrytitle>apt.conf</refentrytitle>
				<manvolnum>5</manvolnum></citerefentry>‎ باستخدام الأمر <command>man apt.conf</command> (لمزيد من التفاصيل عن صفحات الدليل، انظر <xref linkend="sect.manual-pages" />).
			</para>
			 <sidebar id="sidebar.directory.d"> <title><emphasis>أساسيات</emphasis> المجلدات التي تنتهي باللاحقة <filename dir="ltr">.d</filename></title>
			 <indexterm>
				<primary><filename>.d</filename></primary>
			</indexterm>
			 <para>
				أصبح استخدام المجلدات ذات اللاحقة <filename dir="ltr">.d</filename> ينتشر أكثر وأكثر. يعبّر كل مجلد عن ملف إعداد مقسّم إلى عدة ملفات. هذا يعني أن جميع الملفات في مجلد <filename dir="ltr">/etc/apt/apt.conf.d/</filename> هي تعليمات ضبط APT. تُضَمِّن APT هذه الملفات حسب الترتيب الأبجدي، بحيث أن الملفات الأخيرة تستطيع تعديل عناصر الضبط المعرّفة في الملفات الأولى.
			</para>
			 <para>
				تمنح هذه البنية بعض المرونة لمدير النظام ولمشرفي الحزم. حقاً، يمكن أن يعدل مدير النظام إعدادات البرنامج بإضافة ملف جاهز في المجلد المطلوب دون الاضطرار لتعديل ملف موجود مسبقاً. يستخدم مشرفو الحزم نفس الأسلوب عندما يحتاجون لمواءمة إعدادات برنامج آخر للتأكد من أنه ينسجم تماماً مع برامجهم. تحظر سياسة دبيان بشكل صريح تعديل ملفات ضبط الحزم الأخرى — ولا يُسمَح إلا للمستخدمين فقط بذلك. تذكر أنه خلال تحديث الحزمة، يجب على المستخدم أن يختار نسخة ملف الإعداد التي يجب الاحتفاظ بها عند اكتشاف حدوث تغيرات. أي تغيير خارجي على الملف سوف ينشط ذلك الطلب، وهو ما يزعج مدير النظام، خصوصاً أنه متأكد من أنه لم يغير شيئاً.
			</para>
			 <para>
				بدون مجلد <filename dir="ltr">.d</filename>، لا يمكن لحزمة خارجية تغيير إعدادات البرنامج إلا بتعديل ملف إعداداته. وبدلاً من تعديل الملف تلقائياً، عليها دعوة المستخدم لتعديله بنفسه وتسرد له العمليات التي يجب فعلها في الملف <filename dir="ltr">/usr/share/doc/<replaceable>package</replaceable>/README.Debian</filename>.
			</para>
			 <para>
				اعتماداً على البرنامج، إما أن يُستَخدم مجلد <filename dir="ltr">.d</filename> مباشرة أو يُدار بوساطة سكربت خارجي يدمج جميع الملفات لإنشاء ملف الإعداد نفسه. من المهم تشغيل السكربت بعد أي تغيير في ذلك المجلد حتى تُأخَذ التعديلات الأحدث بعين الاعتبار. من المهم أيضاً ألا تُجرى تعديلات على ملف الإعدادات الذي ينشئه السكربت تلقائياً، لأن كل شيء سيضيع عند التنفيذ التالي للسكربت. عادة ما يُفرَض استخدام إحدى الطريقتين (استخدام المجلد <filename dir="ltr">.d</filename> مباشرة أو استخدام ملف مولد من ذلك المجلد) نتيجة قيود ناجمة عن طريقة التطبيق (implementation)، لكن في كلا الحالتين يعوّض الكسب في مرونة الإعداد عن التعقيدات الصغيرة الناتجة. مخدّم البريد Exim 4 هو مثال عن طريقة الملف المولَّد: حيث يمكن إعداده من خلال عدة ملفات (<filename dir="ltr">/etc/exim4/conf.d/*</filename>) يجمعها الأمر <command>update-exim4.conf</command> في الملف <filename dir="ltr">/var/lib/exim4/config.autogenerated</filename>.
			</para>
			 </sidebar>
		</section>
		 <section id="sect.apt.priorities">
			<title>إدارة أولويات الحزم</title>
			 <para>
				إدارة الأولويات المرتبطة بكل مصدر للحزم هي إحدى أهم النواحي في إعدادات APT. مثلاً، قد ترغب بإضافة حزمة واحدة أو اثنتين من التوزيعة <emphasis role="distribution">الاختبارية</emphasis>، أو <emphasis role="distribution">غير المستقرة</emphasis> أو <emphasis role="distribution">التجريبية</emphasis> إلى إحدى التوزيعات الأخرى. من الممكن تعيين أولويات للحزم المتوفرة (يمكن أن تملك الحزمة الواحدة أكثر من أولوية واحدة اعتماداً على إصدارها أو التوزيعة التي توفرها). ستؤثر هذه الأولويات في سلوك APT: ستختار دائماً نسخة الحزمة ذات الأولوية الأعلى (إلا إذا كانت هذه النسخة أقدم من النسخة المثبتة وكانت أولويتها أقل من 1000).
			</para>
			 <indexterm>
				<primary>APT</primary>
				<secondary><foreignphrase>pinning</foreignphrase></secondary>
			</indexterm>
			 <indexterm>
				<primary>pinning, APT pinning</primary>
			</indexterm>
			 <indexterm>
				<primary>حزمة</primary>
				<secondary>أولوية</secondary>
			</indexterm>
			 <indexterm>
				<primary>حزمة</primary>
				<secondary>أولويات الحزم</secondary>
			</indexterm>
			 <indexterm>
				<primary>APT</primary>
				<secondary>إعدادات</secondary>
			</indexterm>
			 <indexterm>
				<primary><filename>preferences</filename></primary>
			</indexterm>
			 <indexterm>
				<primary><filename>/etc/apt/preferences</filename></primary>
			</indexterm>
			 <para>
				تُعرِّف APT عدة أولويات افتراضية. كل نسخة مثبتة من الحزمة لها أولوية تساوي 100. النسخة غير المثبتة لها أولوية تساوي 500 افتراضياً، لكن يمكنها أن تقفز إلى 990 إذا كانت تنتمي للتوزيعة المستهدفة (التي تُحدَّد بالخيار <literal dir="ltr">-t</literal> أو تعليمة الضبط <literal>APT::Default-Release</literal>).
			</para>
			 <para>
				يمكنك تغيير الأولويات بإضافة مدخلات بأسماء الحزم المتأثرة، وإصداراتها، ومصدرها وأولوياتها الجديدة إلى الملف <filename dir="ltr">/etc/apt/preferences</filename>.
			</para>
			 <para>
				لن تثبت APT أبداً نسخة أقدم من الحزمة (نسخة يكون رقم إصدارها أقل من الحزمة المثبتة حالياً) إلا إذا كانت أولويتها أعلى من 1000. ستُثَـبّت APT دائماً الحزمة ذات الأولوية العليا التي تحقق هذا الشرط. إذا كان لحزمتين الأولوية نفسها، تثبت APT النسخة الأحدث (ذات رقم الإصدار الأعلى). إذا كان لحزمتين الإصدار نفسه والأولوية نفسها لكنهما تختلفان في محتواهما، تثبّت APT النسخة غير المثبتة (تم وضع هذه القاعدة لتغطية الحالة التي تُحدَّث فيها الحزمة دون زيادة رقم مراجعتها، فالحاجة تدعو لهذا الأمر عادة).
			</para>
			 <para>
				بكلمات مترابطة أكثر، الحزمة ذات الأولوية الأدنى من 0 لن تثبت أبداً. أما الحزمة ذات الأولوية بين 0 و 100 فسوف تُثبَّت فقط إذا لم تكن هناك نسخة أخرى من الحزمة مثبتة مسبقاً. وتُثبَّت الحزمة ذات الأولوية بين 100 و 500 فقط إذا لم تكن هناك نسخ أحدث منها مثبتة أو متوفرة في توزيعة أخرى. أما الحزمة ذات الأولوية بين 501 و 990 فتُثَـبَّت فقط إذا لم تكن هناك نسخة أحدث مثبتة أو متوفرة في التوزيعة المستهدفة. الحزمة ذات الأولوية ما بين 990 و 1000 تثبت دائماً إلا إذا كانت النسخة المثبتة أحدث منها. الأولوية الأكبر من 1000 ستؤدي دائماً إلى تثبيت الحزمة حتى لو أجبرت APT على تخفيض الحزمة إلى نسخة أقدم.
			</para>
			 <para>
				عندما تتحقق APT من <filename dir="ltr">/etc/apt/preferences</filename>، تأخذ أولاً المدخلات الأكثر تخصيصاً بعين الاعتبار (المدخلات التي تحدد الحزم بعينها غالباً)، بعدها تنظر إلى القواعد الأعم (كالقواعد التي تشمل جميع الحزم من إحدى التوزيعات). إذا كان هناك عدة مدخلات عامة، فسوف يستخدم التطابق الأول. من معايير التحديد المتاحة اسم الحزمة والمصدر الذي يوفرها. يُعرَّف كل مصدر من مصادر الحزم بالمعلومات المحتواة في الملف <filename>Release</filename> الذي تحصل عليه APT مع ملف <filename>Packages</filename>. يحدد هذا الملف منشأ الحزم (عادة يكون منشأ الحزم على المرايا الرسمية هو ”Debian“، لكن قد يكون اسم أحد الأشخاص أو المنظمات بالنسبة للمستودعات الأخرى). كما أنه يحدد اسم التوزيعة (عادة <emphasis role="distribution">Stable</emphasis>،‏ <emphasis role="distribution">Testing</emphasis>، <emphasis role="distribution">Unstable</emphasis> أو <emphasis role="distribution">Experimental</emphasis> بالنسبة للتوزيعات القياسية التي يقدمها مشروع دبيان) وإصدارها (مثلاً 8 بالنسبة لدبيان <emphasis role="distribution">جيسي</emphasis>). دعنا نلقي نظرة على صيغة هذا الملف عبر دراسة بعض الحالات الواقعية لهذه الآلية.
			</para>
			 <sidebar> <title><emphasis>حالة خاصة</emphasis> أولوية الحزم <emphasis role="distribution">التجريبية</emphasis></title>
			 <indexterm>
				<primary><emphasis role="distribution">التجريبية</emphasis></primary>
			</indexterm>
			 <para>
				إذا أضفت التوزيعة <emphasis role="distribution">التجريبية</emphasis> إلى ملف <filename>sources.list</filename>، فإن حزمها لن تثبت أبداً تقريباً لأن أولويتها الافتراضية هي 1. هذه حالة خاصة بالطبع، مصممة لحماية المستخدمين من تثبيت الحزم <emphasis role="distribution">التجريبية</emphasis> بالخطأ. يمكن تثبيت هذه الحزم فقط بكتابة <command>aptitude install <replaceable>package</replaceable>/experimental</command> — لأن المستخدمين الذين سيكتبون هذا الأمر هم وحدهم الذين يدركون المخاطر التي يعرضون أنفسهم لها. من الممكن مع ذلك (رغم أن هذا <emphasis>غير</emphasis> مستحسن) معاملة حزم التوزيعة <emphasis role="distribution">التجريبية</emphasis> مثل حزم التوزيعات الأخرى بإعطائها الأولوية 500. يتم هذا من خلال مدخلة خاصة في <filename dir="ltr">/etc/apt/preferences</filename>:
			</para>
			 <informalexample> 
<programlisting>Package: *
Pin: release a=experimental
Pin-Priority: 500
</programlisting>
			 </informalexample> </sidebar> <para>
				لنفترض أنك تريد استعمال الحزم من النسخة المستقرة من دبيان فقط. وأن تلك الحزم المتوفرة في الإصدارات الأخرى يجب ألا تثبت إلا إذا طلبت صراحة. يمكن كتابة المدخلات التالية في ملف <filename dir="ltr">/etc/apt/preferences</filename>:
			</para>
			 <informalexample> 
<programlisting>Package: *
Pin: release a=stable
Pin-Priority: 900

Package: *
Pin: release o=Debian
Pin-Priority: -10
</programlisting>
			 </informalexample> <para>
				يُعرِّف <literal>a=stable</literal> اسم التوزيعة المختارة. ويَقْصُر <literal>o=Debian</literal> المجال على الحزم ذات المنشأ ”Debian“.
			</para>
			 <para>
				دعنا الآن نتخيل أنك تملك مخدماً عليه عدة برامج محلية تعتمد على النسخة 5.14 من بيرل وأنك تريد التأكد أن التحديثات لن تسبب تثبيت نسخة أخرى منها. يمكنك استخدام هذه المدخلة:
			</para>
			 <informalexample> 
<programlisting>Package: perl
Pin: version 5.14*
Pin-Priority: 1001
</programlisting>
			 </informalexample> <para>
				الوثائق المرجعية لملف الضبط هذا متوفرة في صفحة الدليل <citerefentry><refentrytitle>apt_preferences</refentrytitle>
				<manvolnum>5</manvolnum></citerefentry>‎، التي يمكن عرضها بالأمر <command>man apt_preferences</command>.
			</para>
			 <sidebar> <title><emphasis>تلميح</emphasis> التعليقات في الملف <filename dir="ltr">/etc/apt/preferences</filename></title>
			 <indexterm>
				<primary><literal>Explanation</literal></primary>
			</indexterm>
			 <indexterm>
				<primary><literal>Pin</literal></primary>
			</indexterm>
			 <indexterm>
				<primary><literal>Pin-Priority</literal></primary>
			</indexterm>
			 <para>
				لا توجد صيغة رسمية للتعليقات في ملف <filename dir="ltr">/etc/apt/preferences</filename>، لكن يمكن تقديم بعض الأوصاف النصية بوضع حقل”<literal>Explanation</literal>“ أو أكثر في بداية كل مدخلة:
			</para>
			 <informalexample> 
<programlisting>Explanation: The package xserver-xorg-video-intel provided
Explanation: in experimental can be used safely
Package: xserver-xorg-video-intel
Pin: release a=experimental
Pin-Priority: 500
</programlisting>
			 </informalexample> </sidebar>
		</section>
		 <section id="sect.apt-mix-distros">
			<title>العمل مع عدة توزيعات</title>
			 <para>
				بما أن <command>apt</command> أداة رائعة فعلاً، فهي تغريك بالتقاط حزم من توزيعات أخرى. مثلاً، بعد تثبيت التوزيعة <emphasis role="distribution">المستقرة</emphasis>، قد ترغب بتجربة حزمة برمجية متوفرة في التوزيعة <emphasis role="distribution">الاختبارية</emphasis> أو <emphasis role="distribution">غير المستقرة</emphasis> دون الانحراف بعيداً عن حالة النظام الأولية.
			</para>
			 <para>
				حتى لو كنت ستواجه أحياناً مشاكل نتيجة خلط الحزم من توزيعات مختلفة، يدير <command>apt</command> مثل هذه الحالات بشكل جيد جداً وتقلل المخاطر بصورة فعالة. أفضل طريقة للمتابعة تكون بإضافة جميع التوزيعات المستخدمة في <filename dir="ltr">/etc/apt/sources.list</filename> (بعض الناس يضعون التوزيعات الثلاثة دائماً، لكن تذكر أن التوزيعة <emphasis role="distribution">غير المستقرة</emphasis> محجوزة للمستخدمين المخضرمين) و تعريف توزيعتك المرجعية بالمتغير <literal>APT::Default-Release</literal> (انظر <xref linkend="sect.apt-upgrade" />).
			</para>
			 <para>
				دعنا نفرض أن <emphasis role="distribution">المستقرة</emphasis> هي توزيعتك المرجعية لكن <emphasis role="distribution">الاختبارية</emphasis> و<emphasis role="distribution">غير المستقرة</emphasis> موجودتان في ملف <filename>sources.list</filename> الخاص بك أيضاً. في هذه الحالة، يمكنك استخدام <command>apt install <replaceable>package</replaceable>/testing</command> لتثبيت حزمة من <emphasis role="distribution">الاختبارية</emphasis>. إذا فشل التثبيت نتيجة اعتماديات لا يمكن تلبيتها، دع apt-get تحل هذه الاعتماديات ضمن التوزيعة <emphasis role="distribution">الاختبارية</emphasis> بإضافة المتغير <literal dir="ltr">-t testing</literal>. من الواضح أن الشيء نفسه ينطبق على <emphasis role="distribution">غير المستقرة</emphasis>.
			</para>
			 <para>
				في هذه الحالة، التحديثات (<command>upgrade</command> و <command>full-upgrade</command>) تتم ضمن التوزيعة <emphasis role="distribution">المستقرة</emphasis> ما عدا الحزم التي حُدِّثت مسبقاً إلى توزيعة أخرى: هذه الحزم ستتبع التحديثات المتوفرة في التوزيعات الأخرى. سنشرح هذا السلوك بمساعدة الأولويات الافتراضية التي تضبطها APT أدناه. لا تتردد باستخدام <command>apt-cache policy</command> (انظر الملاحظة الجانبية <xref linkend="sidebar.apt-cache-policy" />) للتحقق من الأولويات المعطاة.
			</para>
			 <para>
				يدور كل شيء حول حقيقة أن APT تنظر إلى الحزم ذات الأولويات الأعلى أو المساوية لأولويات الحزم المثبتة (بفرض أن <filename dir="ltr">/etc/apt/preferences</filename> لم يُستخدم لفرض أولويات أعلى من 1000 لبعض الحزم).
			</para>
			 <sidebar id="sidebar.apt-cache-policy"> <title><emphasis>تلميح</emphasis> <command>apt-cache policy</command></title>
			 <para>
				حتى تستوعب آلية الأولويات أكثر، لا تتردد بتنفيذ الأمر <command>apt-cache policy</command> لعرض الأولويات الافتراضية المعينة لكل مصدر للحزم. يمكنك أيضاً استخدام <command>apt-cache policy <replaceable>package</replaceable></command> لعرض الأولويات لجميع النسخ المتوفرة لحزمة معينة.
			</para>
			 </sidebar> <para>
				دعنا نفترض أنك تملك الإصدارة 1 مثبتة من حزمة أولى من التوزيعة <emphasis role="distribution">المستقرة</emphasis> وأن الإصدارتين 2 و 3 متوفرتان على الترتيب في <emphasis role="distribution">الاختبارية</emphasis> و<emphasis role="distribution">غير المستقرة</emphasis>. للإصدارة المثبتة أولوية قدرها 100 لكن النسخة المتوفرة في <emphasis role="distribution">المستقرة</emphasis> (الإصدارة نفسها) لها أولوية تساوي 990 (لأنها تنتمي للتوزيعة الهدف). تملك الحزم في <emphasis role="distribution">الاختبارية</emphasis> و<emphasis role="distribution">غير المستقرة</emphasis> أولوية قدرها 500 (الأولوية الافتراضية للإصدارات غير المثبتة). الرابح إذا هو الإصدار 1 صاحب الأولوية 990. إذاً ”تبقى الحزمة في التوزيعة <emphasis role="distribution">المستقرة</emphasis>“.
			</para>
			 <para>
				دعنا نأخذ مثالاً عن حزمة أخرى تم تثبيت الإصدار 2 منها من التوزيعة <emphasis role="distribution">الاختبارية</emphasis>. والإصدار 1 متاح ضمن <emphasis role="distribution">المستقرة</emphasis> والإصدار 3 ضمن <emphasis role="distribution">غير المستقرة</emphasis>. يُهمَل الإصدار 1 (أولويته 990 – أي أنها أقل من 1000) لأنه أقدم من النسخة المثبتة. هذا يدع النسختين 2 و 3، ولكل منهما الأولوية 500. تختار APT الإصدار الأحدث، الذي ينتمي للتوزيعة <emphasis role="distribution">غير المستقرة</emphasis>. إذا لم ترغب أن تهاجر الحزم المثبتة من <emphasis role="distribution">الاختبارية</emphasis> إلى التوزيعة <emphasis role="distribution">غير المستقرة</emphasis>، عليك تعيين أولوية أقل من 500 (490 مثلا) للحزم القادمة من <emphasis role="distribution">غير المستقرة</emphasis>. يمكنك تعديل الملف <filename dir="ltr">/etc/apt/preferences</filename> للوصول إلى هذه النتيجة:
			</para>
			 
<programlisting>Package: *
Pin: release a=unstable
Pin-Priority: 490
</programlisting>

		</section>
		 <section id="sect.automatic-tracking">
			<title>متابعة الحزم المثبتة آلياً</title>
			 <para>
				إحدى وظائف <command>apt</command> الأساسية هي تتبع الحزم التي ثبتت على النظام فقط لأنها اعتماديات. هذه الحزم تدعى ”آلية automatic“، وغالباً ما تنتمي المكتبات مثلاً لهذه الفئة.
			</para>
			 <para>
				اعتماداً على هذه المعلومات، يستطيع مدير الحزم عند طلب إزالة حزمة، حساب لائحة بالحزم الآلية التي لم تعد لها حاجة (لعدم وجود حزم أخرى ”مثبتة يدوياً“ تعتمد عليها). يتخلص الأمر <command>apt-get autoremove</command> من هذه الحزم. أما <command>aptitude</command> و<command>apt</command> فليس لهما مثل هذا الأمر لأن الأول يزيل هذه الحزم فور التعرف عليها، أما الثاني فغالباً لأن المستخدم لا يجب أن يستدعي هكذا أمر يدوياً. في كل الحالات، ستعرض الأداة التي تستخدمها رسالة واضحة تبين الحزم المتأثرة.
			</para>
			 <indexterm>
				<primary><command>apt-mark auto</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>apt-mark manual</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>aptitude markauto</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>aptitude unmarkauto</command></primary>
			</indexterm>
			 <para>
				من الجيد تعليم أي حزمة لا تحتاجها بشكل مباشر على أنها آلية حتى تزال آلياً عندما لا تبقى لها ضرورة. سوف يضع الأمر <command>apt-mark auto <replaceable>package</replaceable></command> علامة حزمة آلية على الحزمة المحددة، بينما الأمر <command>apt-mark manual <replaceable>package</replaceable></command> يفعل العكس. يعمل الأمران <command>aptitude markauto</command> و <command>aptitude unmarkauto</command> بنفس الأسلوب، إلا أن لهما ميزات إضافية لتعليم عدة حزم دفعة واحدة (انظر <xref linkend="sect.aptitude" />). كما أن الواجهة التفاعلية التي تقدمها <command>aptitude</command> في الطرفية تُسهِّل مراجعة ”الأعلام الآلية automatic flag“ على أعداد كبيرة من الحزم.
			</para>
			 <indexterm>
				<primary><command>aptitude why</command></primary>
			</indexterm>
			 <para>
				قد يرغب بعض الأشخاص بمعرفة سبب وجود حزمة آلية مثبتة على النظام. للحصول على هذه المعلومات من سطر الأوامر، يمكنك استخدام <command>aptitude why <replaceable>package</replaceable></command> (لا تملك <command>apt</command> ولا <command>apt-get</command> ميزة مشابهة):
			</para>
			 
<screen><computeroutput>$ </computeroutput><userinput>aptitude why python-debian
</userinput><computeroutput>i   aptitude         Recommends apt-xapian-index         
i A apt-xapian-index Depends    python-debian (&gt;= 0.1.15)
</computeroutput></screen>
			 <sidebar> <title><emphasis>بدائل</emphasis> <command>deborphan</command> و<command>debfoster</command></title>
			 <indexterm>
				<primary><command>deborphan</command></primary>
			</indexterm>
			 <indexterm>
				<primary><command>debfoster</command></primary>
			</indexterm>
			 <para>
				في الأيام الغابرة عندما لم تكن <command>apt</command> ولا <command>apt-get</command> ولا <command>aptitude</command> قادرة على تتبع الحزم الآلية، كان هناك أداتين تولدان قوائم الحزم غير الضرورية: <command>deborphan</command> و<command>debfoster</command>.
			</para>
			 <para>
				<command>deborphan</command> هو الأكثر تخلفاً بينهما. تفحص هذه الأداة أقسام <literal>libs</literal> و<literal>oldlibs</literal> ببساطة (ما لم يعطى تعليمات إضافية) بحثاً عن الحزم المثبتة حالياً ولا تعتمد عليها أي حزمة أخرى. يمكن أن تخدم اللائحة الناتجة كأساس لإزالة الحزم غير المرغوبة.
			</para>
			 <para>
				يتميز <command>debfoster</command> بطريقة أكثر تطوراً، وقريبة جداً من أسلوب APT: فهو يحتفظ بلائحة بالحزم التي تم تثبيتها بشكل مقصود، ويتذكر الحزم التي اللازمة فعلاً بين كل استدعائين. إذا ظهرت حزم جديدة على النظام ولم يعرف <command>debfoster</command> الأسباب التي تدعو لوجود تلك الحزم، سوف يظهرها على الشاشة مع اعتمادياتها. بعدها يقدم البرنامج لك عدة خيارات: إزالة الحزمة (مع الحزم التي تعتمد عليها أيضاً إذا أردت)، تعليم الحزمة على أنها حزمة مطلوبة صراحة، أو تجاهلها مؤقتاً.
			</para>
			 </sidebar>
		</section>

	</section>
	 <section id="sect.apt-cache">
		<title>الأمر <command>apt-cache</command></title>
		 <indexterm>
			<primary><command>apt-cache</command></primary>
		</indexterm>
		 <indexterm>
			<primary>APT</primary>
			<secondary>البحث عن حزم</secondary>
		</indexterm>
		 <indexterm>
			<primary>APT</primary>
			<secondary>عرض الترويسة</secondary>
		</indexterm>
		 <indexterm>
			<primary>بحث عن الحزم</primary>
		</indexterm>
		 <indexterm>
			<primary>حزمة</primary>
			<secondary>بحث</secondary>
		</indexterm>
		 <para>
			يعرض الأمر <command>apt-cache</command> الكثير من المعلومات المخزنة في قاعدة بيانات APT الداخلية. هذه المعلومات هي نوع من الكاش أو الذاكرة المخبئية لأنها تُجمَع من مصادر مختلفة موجودة في الملف <filename>sources.list</filename>. يحدث هذا خلال عملية <command>apt update</command>.
		</para>
		 <sidebar id="sidebar.cache"> <title><emphasis>مصطلحات</emphasis> المخبأ (Cache)</title>
		 <para>
			الكاش أو المخبأ (أو الذاكرة المخبئية) هو نظام تخزين مؤقت يُستَخدم لتسريع الوصول المتكرر للبيانات عندما تكون عملية الوصول المباشرة مكلفة (من ناحية الأداء). يمكن تطبيق هذا المفهوم في حالات عديدة وعلى مستويات مختلفة، من نوى المعالجات المصغرة إلى نظم التخزين المتطورة.
		</para>
		 <para>
			في حالة APT، ملفات <filename>Packages</filename> المرجعية هي ملفات <filename>Packages</filename> الموجودة على مرايا دبيان. ومع ذلك، سوف يكون الذهاب إلى الشبكة لكل عملية بحث قد نرغب بإجرائها في قاعدة بيانات الحزم المتوفرة غير فعال على الإطلاق. لهذا تخزّن APT نسخة من هذه الملفات (في <filename dir="ltr">/var/lib/apt/lists/</filename>) ويتم البحث ضمن هذه الملفات المحلية. أيضاً، يحتوي <filename dir="ltr">/var/cache/apt/archives/</filename> على نسخة كاش من الحزم التي تم تنزيلها لتفادي تنزيلها ثانية إذا احتجت لإعادة تثبيتها بعد إزالتها.
		</para>
		 </sidebar> <indexterm>
			<primary><command>apt show</command></primary>
		</indexterm>
		 <indexterm>
			<primary><command>apt search</command></primary>
		</indexterm>
		 <indexterm>
			<primary><command>apt-cache show</command></primary>
		</indexterm>
		 <indexterm>
			<primary><command>apt-cache search</command></primary>
		</indexterm>
		 <indexterm>
			<primary><command>aptitude show</command></primary>
		</indexterm>
		 <indexterm>
			<primary><command>aptitude search</command></primary>
		</indexterm>
		 <para>
			يمكن أن يبحث الأمر <command>apt-cache</command> اعتماداً على كلمات مفتاحية وذلك باستخدام <command>apt-cache search <replaceable>keyword</replaceable></command>. يستطيع هذا الأمر أيضاً عرض ترويسات النسخ المتوفرة من الحزمة باستخدام <command>apt-cache show <replaceable>package</replaceable></command>. يقدّم هذا الأمر وصف الحزمة، اعتمادياتها، اسم المشرف، الخ. لاحظ أن <command>apt search</command> و<command>apt show</command> و<command>aptitude search</command> و<command>aptitude show</command> تعمل بالأسلوب نفسه.
		</para>
		 <sidebar> <title><emphasis>بدائل</emphasis> <command>axi-cache</command></title>
		 <indexterm>
			<primary><command>axi-cache</command></primary>
		</indexterm>
		 <indexterm>
			<primary><emphasis role="pkg">apt-xapian-index</emphasis></primary>
		</indexterm>
		 <para>
			الأداة <command>apt-cache search</command> بدائية جداً، تعتمد أساساً على تطبيق <command>grep</command> على أوصاف الحزم. غالباً ما تعيد هذه الأداة عدداً كبيراً من النتائج أو لا تعيد أي نتيجة عندما تضع الكثير من الكلمات المفتاحية.
		</para>
		 <para>
			لكن <command>axi-cache search <replaceable>term</replaceable></command> من ناحية أخرى، تقدم نتائج أفضل، مرتبة حسب مطابقتها لمعايير البحث. تعتمد هذه الأداة على محرك البحث <emphasis>Xapian</emphasis> وهي جزء من الحزمة <emphasis role="pkg">apt-xapian-index</emphasis> التي تفهرس معلومات الحزم كافة (وتفهرس أشياء أخرى، مثل ملفات <filename dir="ltr">.desktop</filename> من جميع حزم دبيان). تدرك هذه الأداة وجود الوسوم (انظر الملاحظة الجانبية<xref linkend="sidebar.debtags" />) وتعيد نتائج البحث في أجزاء من الثانية.
		</para>
		 
<screen>$ <userinput>axi-cache search package use::searching</userinput>
105 results found.
Results 1-20:
100% packagesearch - GUI for searching packages and viewing package information
98% debtags - Enables support for package tags
94% debian-goodies - Small toolbox-style utilities 
93% dpkg-awk - Gawk script to parse /var/lib/dpkg/{status,available} and Packages
93% goplay - games (and more) package browser using DebTags
[...]
87% apt-xapian-index - maintenance and search tools for a Xapian index of Debian packages
[...]
More terms: search debian searching strigi debtags bsearch libbsearch
More tags: suite::debian works-with::software:package role::program interface::commandline implemented-in::c++ admin::package-management use::analysing
`axi-cache more' will give more results
</screen>
		 </sidebar> <indexterm>
			<primary><command>apt-cache policy</command></primary>
		</indexterm>
		 <indexterm>
			<primary><command>apt-cache dumpavail</command></primary>
		</indexterm>
		 <indexterm>
			<primary><command>apt-cache pkgnames</command></primary>
		</indexterm>
		 <para>
			توجد مزايا نادراً ما تستخدم. مثلاً، يعرض <command>apt-cache policy</command> أولويات مصادر الحزم بالإضافة إلى أولويات الحزم المفردة. من الأمثلة الأخرى <command>apt-cache dumpavail</command> الذي يعرض ترويسات جميع النسخ المتوفرة لجميع الحزم. يعرض <command>apt-cache pkgnames</command> قائمة بجميع الحزم التي تظهر في الكاش مرة واحدة على الأقل.
		</para>

	</section>
	 <section id="sect.apt-frontends">
		<title>واجهات APT: ‏<command>aptitude</command>، ‏<command>synaptic</command></title>
		 <indexterm>
			<primary><command>aptitude</command></primary>
		</indexterm>
		 <indexterm>
			<primary><command>synaptic</command></primary>
		</indexterm>
		 <indexterm>
			<primary>APT</primary>
			<secondary>واجهات</secondary>
		</indexterm>
		 <para>
			الأداة APT هي برنامج مكتوب بلغة ++C تقبع شفرته في المكتبة المشتركة <command>libapt-pkg</command> بشكل أساسي. يسهّل استخدام المكتبة المشتركة إنشاء واجهات استخدام (front-ends)، نظراً لسهولة إعادة استخدام الكود الموجود في المكتبة. تاريخياً، صُمِّمَت <command>apt-get</command> كواجهة اختبارية فقط للمكتبة <command>libapt-pkg</command> لكن نجاحها طغى على هذه الحقيقة.
		</para>
		 <section id="sect.aptitude">
			<title>‏<command>aptitude</command></title>
			 <para>
				<command>aptitude</command> هو برنامج تفاعلي يمكن استخدامه في وضع شبه رسومي في الطرفية. يمكنك استعراض قائمة بالحزم المثبتة والمتوفرة، والبحث في جميع المعلومات المتوفرة، واختيار الحزم التي تريد تثبيتها أو إزالتها. صمم البرنامج خصيصاً ليستخدمه مديرو النظم، لذلك فإن سلوكه الافتراضي أذكى بكثير من سلوك <command>apt-get</command>، كما أن واجهته أسهل بكثير للفهم.
			</para>
			 <figure>
				<title>مدير الحزم <command>aptitude</command></title>
				 <mediaobject>
					<imageobject>
						<imagedata fileref="images/aptitude.png" format="PNG" scalefit="1" width="75%" />
					</imageobject>

				</mediaobject>

			</figure>
			 <para>
				عندما يعمل، يعرض <command>aptitude</command> قائمة بالحزم مرتبة حسب حالتها (مثبتة، غير مثبتة، أو مثبتة لكنها غير متوفرة على المرايا — كما توجد أقسام أخرى تعرض المهام، والحزم الظاهرية، والحزم الجديدة التي ظهرت حديثاً على المرايا). توجد أوضاع عرض أخرى، لتسهيل التصفح حسب الموضوع. في جميع الحالات، يعرض <command>aptitude</command> لائحة تجمع الفئات والحزم على الشاشة. تصنف الفئات وفق بنية شجرية، يمكن فردها وطيُّها بالتبادل باستخدام مفتاح <keycombo><keycap>Enter</keycap></keycombo>، أو مفتاحي <keycombo><keycap>[</keycap></keycombo> و <keycombo><keycap>]</keycap></keycombo>. يجب استخدام <keycombo><keycap>+</keycap></keycombo> لتعليم الحزمة للتثبيت، و <keycombo><keycap>-</keycap></keycombo> لتعليمها للإزالة و <keycombo><keycap>_</keycap></keycombo> للتطهير (لاحظ أنه يمكن استخدام هذه المفاتيح أيضاً مع الفئات، حيث يُطبَّق الأمر المطلوب على جميع حزم الفئة). يحدّث <keycombo><keycap>u</keycap></keycombo> قائمة الحزم المتوفرة و يحضّر <keycombo action="simul"><keycap>Shift</keycap><keycap>u</keycap></keycombo> تحديثاً كاملاً للنظام. يحوّل <keycombo><keycap>g</keycap></keycombo> إلى وضع يعرض ملخصاً بالتغييرات المطلوبة (وطباعة <keycombo><keycap>g</keycap></keycombo> ثانية ستطبّق التغييرات)، و <keycombo><keycap>q</keycap></keycombo> يخرج من الوضع الحالي. إذا كنت في الوضع الابتدائي، سوف يغلق هذا المفتاح <command>aptitude</command>.
			</para>
			 <sidebar> <title><emphasis>توثيق</emphasis> <command>aptitude</command></title>
			 <para>
				لا يغطي هذا القسم التفاصيل الدقيقة لاستخدامات <command>aptitude</command>، بل يركز على إعطاءك علبة إسعافات أولية للتعامل معه. <command>aptitude</command> موثق جيداً ونحن ننصحك باستخدام دليله الكامل المتوفر في الحزمة <emphasis role="pkg">aptitude-doc-en</emphasis> (انظر <filename>/usr/share/doc/aptitude/html/en/index.html</filename>).
			</para>
			 </sidebar> <para>
				للبحث عن حزمة، يمكنك كتابة <keycombo><keycap>/</keycap></keycombo> متبوعاً بنموذج بحث ما. يطابق هذا النموذج اسم الحزمة، لكن يمكن تطبيقه على وصفها أيضاً (إذا سُبِق بـ <literal dir="ltr">~d</literal>)، أو على قسمها (مع <literal dir="ltr">~s</literal>) أو على الخصائص الأخرى المذكورة في الوثائق. كما يمكن أن ترشح هذه النماذج نفسها قائمة الحزم المعروضة: اضغط المفتاح <keycombo><keycap>l</keycap></keycombo> (أول حرف من <foreignphrase>limit</foreignphrase>) وأدخل النموذج.
			</para>
			 <para>
				تُسهِّل aptitude إدارة ”الأعلام الآلية automatic flags“ (انظر <xref linkend="sect.automatic-tracking" />) كثيراً. يمكن تصفح قائمة الحزم المثبتة وتعليم الحزم على أنها آلية باستخدام <keycombo action="simul"><keycap>Shift</keycap> <keycap>m</keycap></keycombo> أو إزالة العلامة بالمفتاح <keycombo><keycap>m</keycap></keycombo>. يعرض الحرف ”A“ في قائمة الحزم بجوار ”الحزم الآلية“. تقدم هذه الميزة أيضاً وسيلة لعرض الحزم المثبتة ”فعلياً“ على النظام، دون عرض المكتبات والاعتماديات التي لا تهمنا. نموذج البحث الذي يمكن استخدامه مع <keycombo><keycap>l</keycap></keycombo> (لتفعيل وضع الفلترة) هو <literal dir="ltr">~i!~M</literal>. يحدد هذا النموذج أنك تريد عرض الحزم المثبتة (<literal dir="ltr">~i</literal>) غير الآلية (<literal dir="ltr">!~M</literal>).
			</para>
			 <sidebar> <title><emphasis>أدوات</emphasis> استخدام <command>aptitude</command> من الواجهة النصية</title>
			 <para>
				يمكن الوصول لمعظم مزايا <command>aptitude</command> من الواجهة التفاعلية كما يمكن من خلال الأوامر النصية. ستبدو هذه الأوامر مألوفة لمستخدمي <command>apt-get</command> و<command>apt-cache</command>.
			</para>
			 <para>
				تتوفر مزايا <command>aptitude</command> المتقدمة أيضاً من سطر الأوامر. يمكنك استخدام نفس نماذج البحث عن الحزم التي تستخدم في الواجهة التفاعلية. مثلاً، إذا أردت تنظيف مجموعة الحزم ”المثبتة يدوياً“، وكنت تعرف أن جميع البرامج المثبتة محلياً لا تتطلب أي مكتبة معينة أو وحدة بيرل، يمكنك تعليم الحزم المذكورة على أنها آلية بأمر واحد:
			</para>
			 
<screen><computeroutput># </computeroutput><userinput>aptitude markauto '~slibs|~sperl'</userinput></screen>
			 <para>
				يمكنك هنا رؤية قوة نظام نماذج البحث في <command>aptitude</command> بوضوح، الذي يسمح بالتحديد المباشر لجميع الحزم في القسمين <literal>libs</literal> و<literal>perl</literal>.
			</para>
			 <para>
				كن حذراً، إذا حُدِّدت بعض الحزم على أنها آلية ولم تعتمد عليها أي حزم أخرى، فسوف تزال فوراً (بعد طلب التأكيد).
			</para>
			 </sidebar> <section>
				<title>إدارة التوصيات، والاقتراحات والمهام</title>
				 <para>
					من مزايا <command>aptitude</command> المثيرة الأخرى هي أنها تحترم التوصيات بين الحزم مع السماح للمستخدمين بإلغاء عملية تثبيت أي من هذه الحزم. مثلاً، توصي الحزمة <emphasis role="pkg">gnome</emphasis> بالحزمة <emphasis role="pkg">gdebi</emphasis> (مع حزم أخرى). عندما تختار تثبيت الأولى، سيتم اختيار الثانية للتثبيت أيضاً (وتحدَّد كحزمة آلية إذا لم تكن مثبتة مسبقاً على النظام). طباعة <keycombo><keycap>g</keycap></keycombo> سيوضح ذلك: تظهر <emphasis role="pkg">gdebi</emphasis> في شاشة تلخيص الأعمال المعلقة في لائحة الحزم المثبتة آلياً لتلبية الاعتماديات. على أي حال، يمكنك اتخاذ القرار بعدم تثبيتها بإلغاء اختيارها قبل تأكيد العمليات.
				</para>
				 <para>
					لاحظ أن ميزة تتبع التوصيات هذه لا تطبّق على التحديثات. مثلاً، إذا قَدَّمَتْ نسخةٌ جديدة من <emphasis role="pkg">gnome</emphasis> توصيةً بحزمة لم توصِ بها سابقاً، لن تُحدَّد الحزمة الجديدة للتثبيت. ومع ذلك، فسوف تُسرَد في شاشة التحديث بحيث يمكن لمدير النظام اختيارها للتثبيت.
				</para>
				 <para>
					تؤخذ الاقتراحات بين الحزم بعين الاعتبار أيضاً، لكن بطريقة توافق حالتها الخاصة. مثلاً، نظراً لأن <emphasis role="pkg">gnome</emphasis> تقترح <emphasis role="pkg">dia-gnome</emphasis>، ستعرض الأخيرة على شاشة تلخيص الأعمال المعلّقة (في قسم الحزم التي تقترحها الحزم الأخرى). بهذا الشكل ستظهر الحزم، وسيتمكن مدير النظام من اتخاذ قرار بأخذ المقترحات بعين الاعتبار أم لا. بما أنها مجرد اقتراح وليست اعتمادية ولا توصية، لن تُحدَّد الحزمة تلقائياً — بل يحتاج اختيارها لتدخل يدوي من المستخدم (بالتالي، لن تُعتَبر هذه الحزمة آلية).
				</para>
				 <para>
					في السياق ذاته، تذكر أن <command>aptitude</command> تستخدم مفهوم المهام بذكاء. بما أن المهام تُعرَض بشكل تصنيفات في شاشات لوائح الحزم، فيمكنك أن تختار مهمة كاملة للتثبيت أو للإزالة، أو أن تتصفح مجموعة الحزم المضمنة في المهمة حتى تختار منها مجموعة جزئية أصغر.
				</para>

			</section>
			 <section>
				<title>خوارزميات حل أفضل</title>
				 <para>
					حتى نختتم هذا القسم، دعنا نذكر أن <command>aptitude</command> تستخدم خوارزميات أفضل مقارنة بخوارزميات <command>apt-get</command> عند مواجهة المواقف الصعبة. عند طلب مجموعة إجراءات تؤدي مجتمعة إلى نظام غير متماسك، تقيّم <command>aptitude</command> عدة سيناريوهات محتملة وتعرضها بترتيب تنازلي بدءاً من أنسبها. ومع ذلك، فإن هذه الخوارزميات ليست منيعة ضد الإخفاق. لحسن الحظ، هناك دائماً إمكانية لاختيار الإجراءات يدوياً لتنفيذها. إذا أدّت الإجراءات المختارة إلى تضارب، سوف يشير الجزء العلوي من الشاشة إلى عدد الحزم ”المعطوبة“ (ويمكنك الانتقال إلى هذه الحزم مباشرة بالضغط على <keycombo><keycap>b</keycap></keycombo>). من الممكن عندئذ بناء حل للمشكلة يدوياً. بالأخص، يمكنك الوصول إلى الإصدارات المختلفة المتوفرة ببساطة من خلال اختيار الحزمة بالمفتاح <keycombo><keycap>Enter</keycap></keycombo>. إذا كان اختيار أحد هذه الإصدارات يحل المشكلة، عليك ألا تتردد باختياره. عند وصول عدد الحزم المعطوبة إلى الصفر، يمكنك العودة بأمان إلى شاشة تلخيص الأعمال المعلقة للتحقق منها مرة أخيرة قبل تطبيقها.
				</para>
				 <sidebar> <title><emphasis>ملاحظة</emphasis> سجل <command>aptitude</command></title>
				 <para>
					مثل حال <command>dpkg</command>، تحتفظ <command>aptitude</command> بأثر الإجراءات المنفذة في سجلها (<filename dir="ltr">/var/log/aptitude</filename>). ومع ذلك، لا يمكنك العثور على المعلومات نفسها في سجلاتهما، لأن كلّاً منهما يعمل على مستوى مختلف. ففي حين أن <command>dpkg</command> يُسجِّل جميع العمليات المنفّذة على الحزم المفردة خطوة بخطوة، تعطي <command>aptitude</command> رؤية أوسع للعمليات عالية المستوى مثل تحديث النظام بالكامل.
				</para>
				 <para>
					كن حذراً، يحتوي هذا السجل على ملخص العمليات التي أجرتها <command>aptitude</command> فقط. أما إذا استُخدِمَت واجهات أخرى (أو حتى <command>dpkg</command> نفسه) بين الحين والآخر، فإن سجل <command>aptitude</command> سيحتوي على صورة جزئية فقط للعمليات، لذلك لا يمكنك الاعتماد عليه لبناء تاريخ موثوق للنظام.
				</para>
				 </sidebar>
			</section>

		</section>
		 <section>
			<title>‏<command>synaptic</command></title>
			 <para>
				<command>synaptic</command> هو مدير حزم رسومي لدبيان، يقدّم واجهة رسومية نظيفة وفعالة مبنية على أساس GTK+/GNOME. تمنح فلاتره العديدة الجاهزة للاستخدام وصولاً سريعاً للحزم المتوفرة حديثاً، أو الحزم المثبتة، أو الحزم القابلة للتحديث، والحزم الميتة وغيرها. إذا تجولت بين هذه القوائم، يمكنك اختيار العمليات التي تريد تنفيذها على الحزم (تثبيت، تحديث، إزالة، تطهير)؛ لا تُنَفَّذ هذه العمليات مباشرة، بل توضع في لائحة مهام. وبعدها تؤكد هذه العمليات بنقرة واحدة على الزر، وتُنفَّذ دفعة واحدة.
			</para>
			 <figure>
				<title>مدير الحزم <command>synaptic</command></title>
				 <mediaobject>
					<imageobject>
						<imagedata fileref="images/synaptic.png" format="PNG" scalefit="1" width="75%" />
					</imageobject>

				</mediaobject>

			</figure>

		</section>

	</section>
	 <section id="sect.package-authentication">
		<title>التحقق من سلامة الحزم</title>
		 <indexterm>
			<primary>حزمة</primary>
			<secondary>التحقق من السلامة</secondary>
		</indexterm>
		 <indexterm>
			<primary>حزمة</primary>
			<secondary>ختم</secondary>
		</indexterm>
		 <indexterm>
			<primary>حزمة</primary>
			<secondary>توقيع</secondary>
		</indexterm>
		 <indexterm>
			<primary>توقيع</primary>
			<secondary>توقيع حزمة</secondary>
		</indexterm>
		 <indexterm>
			<primary>استيثاق</primary>
			<secondary>الاستيثاق من الحزم</secondary>
		</indexterm>
		 <para>
			الأمن هام جداً بالنسبة لمدراء النظم في شركة فلكوت. لذا، فهم يحتاجون للتأكد من تثبيت الحزم التي يوثق بأنها جاءت من دبيان وأنها لم تُعدّل على الطريق. يمكن أن يحاول المخرب إضافة شفرة خبيثة إلى حزمة شرعية. إذا تم تثبيت حزمة كهذه، فقد تنفذ أي شيء صممها المخرب لتنفيذه، بما في ذلك مثلا كشف كلمات السر أو معلومات سريّة. لتفادي هذا الخطر، تقدّم دبيان ختماً مقاوماً للعبث يضمن — ساعة تثبيت الحزمة — ورود الحزمة من مشرفها الرسمي وأن أية أطراف ثالثة لم تُعدِّلها.
		</para>
		 <para>
			يعمل نظام الختم باستخدام سلسلة من شفرات التحقق وتوقيع. الملف الموقَّع هو الملف <filename>Release</filename>، المتوفر على مرايا دبيان. يحوي الملف قائمة بملفات <filename>Packages</filename> (متضمنة الصيغ المضغوطة لهذه الملفات، <filename>Packages.gz</filename> و<filename>Packages.xz</filename>، والنسخ التصاعدية منها)، بالإضافة إلى قيم MD5، و SHA1 و SHA256 لهذه الملفات، التي تضمن أن أحداً لم يعبث بها. تحوي ملفات <filename>Packages</filename> هذه قائمة بحزم دبيان المتوفرة على المرآة، بالإضافة إلى شِفرات التحقق الخاصة بها، التي تضمن بدورها أن أحداً لم يعبث بمحتوى الحزم نفسها.
		</para>
		 <indexterm>
			<primary><command>apt-key</command></primary>
		</indexterm>
		 <indexterm>
			<primary><emphasis role="pkg">debian-archive-keyring</emphasis></primary>
		</indexterm>
		 <indexterm>
			<primary><filename>/etc/apt/trusted.gpg.d/</filename></primary>
		</indexterm>
		 <indexterm>
			<primary><filename>Release.gpg</filename></primary>
		</indexterm>
		 <para>
			يدير الأمر <command>apt-key</command> من الحزمة <emphasis role="pkg">apt</emphasis> المفاتيح الموثوقة. يحافظ هذا البرنامج على حلقة (keyring) مفاتيح GnuPG عامة، تستخدم للتحقق من التواقيع في ملفات <filename>Release.gpg</filename> المتوفرة على المرايا. يمكن استخدامه لإضافة مفاتيح جديدة يدوياً (عند الحاجة لمرايا غير رسمية). على أي حال، ستحتاج مفاتيح دبيان الرسمية فقط في العادة. تُحدّث هذه المفاتيح آلياً من خلال الحزمة <emphasis role="pkg">debian-archive-keyring</emphasis> (التي تضع حلقات المفاتيح المذكورة في <filename dir="ltr">/etc/apt/trusted.gpg.d</filename>). على أي حال، يتطلب تثبيت هذه الحزمة بذاتها أول مرة بعض الحذر: حتى لو كانت الحزمة موقّعة مثل غيرها، لا يمكن التحقق من هذا التوقيع من خارجها. يجب أن يتحقق مديرو النظم الحريصون إذن من بصمات المفاتيح المستوردة قبل الوثوق بها لتثبيت الحزم الجديدة:
		</para>
		 
<screen role="scale"># <userinput>apt-key fingerprint</userinput>
/etc/apt/trusted.gpg.d/debian-archive-jessie-automatic.gpg
----------------------------------------------------------
pub   4096R/2B90D010 2014-11-21 [expires: 2022-11-19]
      Key fingerprint = 126C 0D24 BD8A 2942 CC7D  F8AC 7638 D044 2B90 D010
uid                  Debian Archive Automatic Signing Key (8/jessie) &lt;ftpmaster@debian.org&gt;

/etc/apt/trusted.gpg.d/debian-archive-jessie-security-automatic.gpg
-------------------------------------------------------------------
pub   4096R/C857C906 2014-11-21 [expires: 2022-11-19]
      Key fingerprint = D211 6914 1CEC D440 F2EB  8DDA 9D6D 8F6B C857 C906
uid                  Debian Security Archive Automatic Signing Key (8/jessie) &lt;ftpmaster@debian.org&gt;

/etc/apt/trusted.gpg.d/debian-archive-jessie-stable.gpg
-------------------------------------------------------
pub   4096R/518E17E1 2013-08-17 [expires: 2021-08-15]
      Key fingerprint = 75DD C3C4 A499 F1A1 8CB5  F3C8 CBF8 D6FD 518E 17E1
uid                  Jessie Stable Release Key &lt;debian-release@lists.debian.org&gt;

/etc/apt/trusted.gpg.d/debian-archive-squeeze-automatic.gpg
-----------------------------------------------------------
pub   4096R/473041FA 2010-08-27 [expires: 2018-03-05]
      Key fingerprint = 9FED 2BCB DCD2 9CDF 7626  78CB AED4 B06F 4730 41FA
uid                  Debian Archive Automatic Signing Key (6.0/squeeze) &lt;ftpmaster@debian.org&gt;

/etc/apt/trusted.gpg.d/debian-archive-squeeze-stable.gpg
--------------------------------------------------------
pub   4096R/B98321F9 2010-08-07 [expires: 2017-08-05]
      Key fingerprint = 0E4E DE2C 7F3E 1FC0 D033  800E 6448 1591 B983 21F9
uid                  Squeeze Stable Release Key &lt;debian-release@lists.debian.org&gt;

/etc/apt/trusted.gpg.d/debian-archive-wheezy-automatic.gpg
----------------------------------------------------------
pub   4096R/46925553 2012-04-27 [expires: 2020-04-25]
      Key fingerprint = A1BD 8E9D 78F7 FE5C 3E65  D8AF 8B48 AD62 4692 5553
uid                  Debian Archive Automatic Signing Key (7.0/wheezy) &lt;ftpmaster@debian.org&gt;

/etc/apt/trusted.gpg.d/debian-archive-wheezy-stable.gpg
-------------------------------------------------------
pub   4096R/65FFB764 2012-05-08 [expires: 2019-05-07]
      Key fingerprint = ED6D 6527 1AAC F0FF 15D1  2303 6FB2 A1C2 65FF B764
uid                  Wheezy Stable Release Key &lt;debian-release@lists.debian.org&gt;</screen>
		 <sidebar> <title><emphasis>ممارسة عملية</emphasis> إضافة مفاتيح موثوقة</title>
		 <indexterm>
			<primary>مفتاح موثوق</primary>
		</indexterm>
		 <indexterm>
			<primary>مفتاح</primary>
			<secondary>مفاتيح المصادقة في APT</secondary>
		</indexterm>
		 <para>
			عند إضافة مصدر حزم لأطراف ثالثة إلى الملف <filename>sources.list</filename>، يجب أن تطلب من APT أن تثق بمفتاح GPG الخاص بها (وإلا ستظل تتذمر من أنها لا تضمن لك سلامة الحزم القادمة من ذلك المستودع). الخطوة الأولى طبعاً هي الحصول على المفتاح العام. في معظم الأوقات، سيعطى المفتاح بشكل ملف نصي صغير، سندعوه <filename>key.asc</filename> في الأمثلة التالية.
		</para>
		 <para>
			لإضافة المفتاح إلى حلقة المفاتيح الموثوقة، يمكن لمدير النظام استدعاء <command>apt-key add &lt; key.asc</command>. توجد طريقة أخرى باستخدام واجهة <command>synaptic</command> الرسومية: يعطي التبويب ”Authentication“ في القائمة <menuchoice><guimenu>Settings</guimenu> <guisubmenu>Repositories</guisubmenu></menuchoice> إمكانية استيراد مفتاح من الملف <filename>key.asc</filename>.
		</para>
		 <indexterm>
			<primary><emphasis role="pkg">gui-apt-key</emphasis></primary>
		</indexterm>
		 <para>
			بالنسبة للأشخاص الذين يريدون برنامجاً مخصصاً وتفاصيل أكثر عن المفاتيح الموثوقة، يمكن استخدام <command>gui-apt-key</command> (في الحزمة ذات الاسم نفسه)، وهو برنامج صغير ذو واجهة رسومية يدير الحلقة الموثوقة.
		</para>
		 </sidebar> <para>
			بمجرد وضع المفاتيح المناسبة في الحلقة، ستتحقق APT من التواقيع قبل أي عملية فيها مخاطرة، بحيث تعرض الواجهات النهائية تحذيراً إذا طُلِبَ منها تثبيت حزمة لا يمكن تأكيد سلامتها.
		</para>

	</section>
	 <section id="sect.dist-upgrade">
		<title>الانتقال من توزيعة مستقرة إلى التالية</title>
		 <para>
			إحدى أكثر مزايا دبيان شهرة هي قدرتها على تحديث النظام المُنَصَّب من إصدارة مستقرة إلى تاليتها: أضافت <foreignphrase>dist-upgrade</foreignphrase> –عبارة شهيرة جداً– إلى سمعة المشروع كثيراً. مع الإجراءات الوقائية، يمكن لتحديث الحاسوب أن يستغرق عدة دقائق، أو عدة عشرات من الدقائق، حسب سرعة التنزيل من مستودعات الحزم.
		</para>
		 <section>
			<title>إجراءات مستحسنة</title>
			 <para>
				بما أن دبيان تستغرق زمناً طويلاً في مرحلة التطور بين الإصدارات المستقرة، عليك قراءة ملاحظات الإصدار قبل التحديث.
			</para>
			 <sidebar> <title><emphasis>أساسيات</emphasis> ملاحظات الإصدار</title>
			 <para>
				ملاحظات إصدار نظام التشغيل (وبشكل أعم، ملاحظات إصدار أي برنامج) هي وثائق تعطي لمحة عامة عن البرمجية، مع بعض التفاصيل المتعلقة بخصوصيات ذلك الإصدار. هذه الوثائق قصيرة عموماً مقارنة بالتوثيق الكامل، وهي تحوي المزايا التي قُدِّمت منذ الإصدار السابق عادة. كما تحوي تفاصيل عن إجراءات التحديث، وتحذيرات لمستخدمي الإصدار السابق، وأحياناً العلل المعروفة في الإصدار الجديد.
			</para>
			 <para>
				تتوفر ملاحظات الإصدار على الإنترنت: ملاحظات الإصدار الخاصة بالنسخة المستقرة الحالية لها URL مخصص، في حين يمكن العثور على ملاحظات الإصدارات الأقدم وفقاً لأسمائها الرمزية: <ulink type="block" url="http://www.debian.org/releases/stable/releasenotes" /> <ulink type="block" url="http://www.debian.org/releases/wheezy/releasenotes" />
			</para>
			 </sidebar> <para>
				في هذا القسم، سنركز على تحديث نظام <emphasis role="distribution">ويزي</emphasis> إلى <emphasis role="distribution">جيسي</emphasis>. هذه عملية كبيرة تجريها على النظام؛ ولذلك، فهي ليست آمنة 100%، ويجب ألا تجريها قبل أخذ نسخة احتياطية عن كافة البيانات المهمة.
			</para>
			 <para>
				من العادات الحسنة الأخرى التي تسهّل عملية التحديث (وتقصّرها أيضاً) هي ترتيب الحزم المُثبَّتَة وإبقاء الحزم التي تحتاجها فعلاً فقط. من الأدوات المفيدة التي تنفذ ذلك هي <command>aptitude</command>، و <command>deborphan</command> و<command>debfoster</command> (انظر <xref linkend="sect.automatic-tracking" />). مثلا، يمكنك استخدام الأمر التالي، ثم استخدم الوضع التفاعلي في <command>aptitude</command> للتأكد ثانية وضبط عمليات الإزالة الآلية:
			</para>
			 
<screen># <userinput>deborphan | xargs aptitude --schedule-only remove</userinput></screen>
			 <para>
				الآن حان وقت التحديث نفسه. أولاً، عليك تغيير الملف <filename dir="ltr">/etc/apt/sources.list</filename> حتى تجلب APT حزمها من <emphasis role="distribution">جيسي</emphasis> بدلاً من <emphasis role="distribution">ويزي</emphasis>. إذا كان الملف يشير فقط إلى التوزيعة <emphasis role="distribution">المستقرة</emphasis> بدلاً من أسماء رمزية صريحة، فلا حاجة لتغيير أي شيء أصلاً، لأن <emphasis role="distribution">المستقرة</emphasis> تشير دائماً إلى الإصدار الأخير لدبيان. في كلا الحالتين، يجب تحديث قاعدة بيانات الحزم المتوفرة (بالأمر <command>apt update</command> أو من خلال زر التحديث في <command>synaptic</command>).
			</para>
			 <para>
				بمجرد تسجيل مصادر الحزم الجديدة هذه، عليك أولاً تنفيذ تحديث أصغري باستخدام <command>apt upgrade</command>. عند تنفيذ التحديث على دفعتين، نُسهِّل عمل أدوات إدارة الحزم ونضمن غالباً أننا نستخدم أحدث الإصدارات من هذه الأدوات، التي قد تقدم إصلاحات للعلل وتحسينات ضرورية لإتمام التحديث الكامل للتوزيعة.
			</para>
			 <para>
				بعد إنهاء هذه الخطوات الأولية، يحين وقت تنفيذ التحديث نفسه، إما باستخدام <command>apt full-upgrade</command>، أو <command>aptitude</command>، أو <command>synaptic</command>. عليك التحقق من الإجراءات المقترحة بعناية قبل تطبيقها: قد ترغب بإضافة حزم مقترحة أو إلغاء حزم موصى بها تعرف أنها لا تفيدك. في كلا الحالتين، يجب أن تخرج الواجهة بسيناريو تكون نهايته نظام <emphasis role="distribution">جيسي</emphasis> متماسك ومحدّث. بعدها، كل ما عليك هو الانتظار حتى تنزل الحزم المطلوبة، والإجابة على أسئلة Debconf وربما أسئلة متعلقة بملفات ضبط معدّلة محلياً، والاسترخاء على كرسيك بينما تنجز APT خلطتها السحرية.
			</para>

		</section>
		 <section>
			<title>حل المشاكل بعد التحديث</title>
			 <para>
				بالرغم من أن مشرفي حزم دبيان يبذلون أفضل ما لديهم، إلا أن تحديث النظام بالكامل لا يجري بالسلاسة التي تتمناها دائماً. قد لا تتوافق إصدارات البرمجيات الجديدة مع القديمة (مثلا، قد يتغير سلوكها الافتراضي أو الصيغة التي تحفظ فيها البيانات). أيضاً، قد تتسلل بعض العلل من هنا وهناك بالرغم من طور الاختبار الذي يسبق إطلاق دبيان دائماً.
			</para>
			 <para>
				لاستباق بعض هذه المشاكل، يمكنك تثبيت الحزمة <emphasis role="pkg">apt-listchanges</emphasis>، التي تعرض معلومات عن المشاكل المحتملة في بداية تحديث كل حزمة. يجمع مشرفو الحزم هذه المعلومات ويقدمونها للمستخدمين في ملفات <filename dir="ltr">/usr/share/doc/<replaceable>package</replaceable>/NEWS.Debian</filename>. يجب أن تساعدك قراءة هذه الملفات (ربما من خلال <emphasis role="pkg">apt-listchanges</emphasis>) على تفادي المفاجآت السيئة.
			</para>
			 <para>
				قد تجد أحياناً أن النسخة الجديدة من البرنامج لا تعمل على الإطلاق. هذا يحدث عادة إذا لم يكن التطبيق شهيراً بما يكفي ولم يُختَبَر كما يجب؛ وقد يسبب تحديث البرنامج في اللحظات الأخيرة انتكاسات لا يُعثَر عليها إلا بعد إطلاق الإصدار المستقر. في كلا الحالتين، أول شيء يجب عمله هو إلقاء نظرة على نظام تتبع العلل على <literal>https://bugs.debian.org/<replaceable>package</replaceable></literal>، والتحقق فيما لو تم التبليغ عن العلة مسبقاً. إذا لم يبلغ عنها أحد، عليك التبليغ عنها بنفسك باستخدام <command>reportbug</command>. أما إذا كانت معروفة مسبقاً، فإن تقرير العلة والرسائل المرتبطة به مصدر ممتاز للمعلومات المتعلقة بالعلة عادة:
			</para>
			 <itemizedlist>
				<listitem>
					<para>
						أحياناً تكون الرقعة موجودة، ومتوفرة في تقرير العلة؛ يمكنك عندها إعادة ترجمة نسخة مصححة من الحزمة المعطوبة محلياً (انظر <xref linkend="sect.rebuilding-package" />)؛
					</para>

				</listitem>
				 <listitem>
					<para>
						في الحالات الأخرى، قد يعثر المستخدمون على طريقة للالتفاف حول المشكلة ويشاركون خبرتهم بها في ردودهم على التقرير؛
					</para>

				</listitem>
				 <listitem>
					<para>
						بل ثمة حالات يُحضِّر فيها المشرف حزمة مصححة وينشرها للعموم.
					</para>

				</listitem>

			</itemizedlist>
			 <para>
				تبعاً لخطورة العلة، قد يُحضَّر إصدار جديد من الحزمة خصيصاً لإحدى النسخ المنقحة من الإصدارة المستقرة. عند حدوث ذلك، تتوفر الحزمة المصححة في القسم <literal>proposed-updates</literal> في مرايا دبيان (انظر <xref linkend="sect.proposed-updates" />). يمكن إضافة المدخلة المطلوبة مؤقتاً إلى الملف <filename>sources.list</filename>، ويمكن تثبيت الحزم المحدّثة باستخدام <command>apt</command> أو <command>aptitude</command>.
			</para>
			 <para>
				أحياناً لا تتوفر الحزمة المصححة في هذا القسم لأنها تنتظر مصادقة مديري الإصدارة المستقرة عليها. يمكنك التأكد من ذلك من صفحتهم على الوب. الحزم المذكورة هناك غير متوفرة بعد، لكنك ستعرف على الأقل أن عملية نشرها في تَقدُّم. <ulink type="block" url="https://release.debian.org/proposed-updates/stable.html" />
			</para>

		</section>

	</section>
	 <section id="sect.regular-upgrades">
		<title>إبقاء النظام محدّثاً</title>
		 <para>
			توزيعة دبيان ديناميكية وتتغير باستمرار. معظم التغيرات تجري في الإصدارة <emphasis role="distribution">الاختبارية</emphasis> و <emphasis role="distribution">غير المستقرة</emphasis>، لكن حتى <emphasis role="distribution">المستقرة</emphasis> تُحدَّث من وقت إلى آخر، غالباً بسبب الإصلاحات الأمنية. مهما كانت نسخة دبيان التي يعمل بها النظام، من الجيد عموماً تحديثها بانتظام، حتى تستفيد من أحدث التطورات وإصلاحات العلل.
		</para>
		 <para>
			في حين أنه يمكن تشغيل أداة للتحقق من التحديثات المتوفرة وتثبيتها دورياً، إلا أن هذه المهمة المتكررة مملة، خصوصاً عندما تحتاج لتنفيذها على عدة أجهزة. لحسن الحظ، يمكن أتمتة هذه العملية جزئياً، مثل العديد من المهام المتكررة الأخرى، وقد طُوِّرَتْ مجموعة من الأدوات مسبقاً لهذا الغرض.
		</para>
		 <para>
			أولى هذه الأدوات هي <command>apticron</command>، في الحزمة ذات الاسم نفسه. مهمتها الأساسية تشغيل سكربت يومياً (من خلال <command>cron</command>). يحدّث السكربت قائمة الحزم المتوفرة، وفي حال وجود إصدارات أحدث لبعض الحزم المثبتة، سيرسل قائمة بهذه الحزم في بريد إلكتروني مرفقة بالتغيُّرات التي طرأت على الإصدارات الحديثة. من الوضح أن هذه الحزمة تستهدف مستخدمي دبيان <emphasis role="distribution">المستقرة</emphasis>، لأن الرسائل اليومية ستكون طويلة جداً بالنسبة لنسخ دبيان الأخرى الأكثر تقلباً. عند وجود تحديثات، تنزلها <command>apticron</command> آلياً. لكن لا تثبتها (يبقى مدير النظام مسؤولاً عن تثبيتها) لكن بما أن الحزم قد نزلت مسبقاً و أصبحت متوفرة محلياً (في مخبأ APT) فستكون العملية أسرع.
		</para>
		 <para>
			لا شك أن مديري النظم المسؤولون عن عدة حواسيب سيقدّرون ميزة إعلامهم بالتحديثات المنتظرة، لكن التحديث بحد ذاته يبقى مملاً كما كان، وهنا يبرز دور السكربت <filename dir="ltr">/etc/cron.daily/apt</filename> (في حزمة <emphasis role="pkg">apt</emphasis>). يعمل هذا السكربت يومياً أيضاً (دون الحاجة لتدخل المستخدم) بوساطة <command>cron</command>. للتحكم بسلوكه، استعمل متغيرات ضبط APT (المخزّنة طبعاً في <filename>/etc/apt/apt.conf.d/</filename>). المتغيرات الأساسية هي:
		</para>
		 <variablelist>
			<varlistentry>
				<term><literal>APT::Periodic::Update-Package-Lists</literal></term>
				 <listitem>
					<para>
						يسمح لك هذا الخيار بتحديد تواتر تحديث لوائح الحزم (بالأيام). يستطيع مستخدمو <command>apticron</command> تحديد هذا دون استخدام هذا المتغير، لأن <command>apticron</command> يقوم بهذه المهمة أصلاً.
					</para>

				</listitem>

			</varlistentry>
			 <varlistentry>
				<term><literal>APT::Periodic::Download-Upgradeable-Packages</literal></term>
				 <listitem>
					<para>
						هذا الخيار يحدد عدد مرات التكرار أيضًا (بالأيام)، لكنه يتحكم بتنزيل الحزم الفعلية. لا يحتاج مستخدمو <command>apticron</command> لهذا الخيار أيضًا.
					</para>

				</listitem>

			</varlistentry>
			 <varlistentry>
				<term><literal>APT::Periodic::AutocleanInterval</literal></term>
				 <listitem>
					<para>
						يغطي هذا الخيار ميزة لا تملكها <command>apticron</command>. فهو يتحكم بمدى تكرار إزالة الحزم المَيْتَة (التي لم تعد أي توزيعة تشير إليها) من مخبأ APT. تبقي هذه العملية حجم مخبأ APT معقولاً وهذا يعني أن لا داع للقلق بخصوص هذه المهمة بعد الآن.
					</para>

				</listitem>

			</varlistentry>
			 <varlistentry>
				<term><literal>APT::Periodic::Unattended-Upgrade</literal></term>
				 <listitem>
					<indexterm><primary><emphasis role="pkg">unattended-upgrades</emphasis></primary></indexterm> <para>
						عند تفعيل هذا الخيار، سوف يُنفِّذ السكربت اليومي الأمر <command>unattended-upgrade</command> (من الحزمة <emphasis role="pkg">unattended-upgrades</emphasis>) الذي يعمل (كما يدل اسمه) على تحديث بعض الحزم آلياً (يهتم هذا الأمر افتراضياً بالتحديثات الأمنية فقط، لكن يمكن تخصيصه عبر الملف <filename dir="ltr">/etc/apt/apt.conf.d/50unattended-upgrades</filename>). لاحظ أنه يمكن تفعيل هذا الخيار بمساعدة debconf عبر استدعاء الأمر <command>dpkg-reconfigure -plow unattended-upgrades</command>.
					</para>

				</listitem>

			</varlistentry>

		</variablelist>
		 <para>
			تسمح لك خيارات أخرى بالتحكم بأسلوب تنظيف المخبأ بدقة أكبر. هذه الخيارات غير مذكورة هنا، لكنها موصوفة في السكربت <filename dir="ltr">/etc/cron.daily/apt</filename>.
		</para>
		 <indexterm>
			<primary><emphasis role="pkg">gnome-packagekit</emphasis></primary>
		</indexterm>
		 <para>
			هذه الأدوات مناسبة جداً للمخدّمات، لكن مستخدمي الحواسيب المكتبية يفضلون عادة نظاماً تفاعلياً أكثر. لهذا السبب تثبِّت المهمة ”Debian desktop environment“ الحزمة <emphasis role="pkg">gnome-packagekit</emphasis> (على الأقل عندما تختار بيئة سطح المكتب GNOME). تُظهِر هذه الحزمة أيقونة في منطقة التنبيهات في بيئة سطح المكتب عند توفر تحديثات؛ وبنقر هذه الأيقونة تعمل <command>gpk-update-viewer</command>، وهي واجهة مبسطة لتحديث النظام. يمكنك تصفح التحديثات المتوفرة، وقراءة الأوصاف القصيرة للحزم التي صدرت نسخ جديدة منها، والاطلاع على محتويات سجلات التغيرات المرتبطة بها (<filename>changelog</filename>)، واختيار تطبيق التحديث أو عدمه على كل حزمة من الحزم.
		</para>
		 <figure>
			<title>التحديث باستخدام <command>gpk-update-viewer</command></title>
			 <mediaobject>
				<imageobject>
					<imagedata fileref="images/gnome-packagekit.png" format="PNG" scalefit="1" width="70%" />
				</imageobject>

			</mediaobject>

		</figure>

	</section>
	 <section id="sect.automatic-upgrades">
		<title>التحديثات الآلية</title>
		 <indexterm>
			<primary>تحديث</primary>
			<secondary>تحديث آلي للنظام</secondary>
		</indexterm>
		 <indexterm>
			<primary>آلي، تحديث</primary>
		</indexterm>
		 <para>
			بما أن شركة فلكوت تملك الكثير من الحواسيب لكن مواردها البشرية محدودة، فإن مدراء النظم فيها يحاولون أتمتة التحديثات قدر الإمكان. بالتالي، يجب أن تعمل البرامج المسؤولة عن هذه العمليات دون تدخل البشر.
		</para>
		 <section>
			<title>إعداد <command>dpkg</command></title>
			 <para>
				كما ذكرنا سابقاً (انظر الملاحظة الجانبية <xref linkend="sidebar.questions-conffiles" />)، يمكن توجيه <command>dpkg</command> حتى لا يسأل عن تأكيد استبدال ملف الإعداد (باستخدام الخيارين <literal dir="ltr">--force-confdef --force-confold</literal>). لكن توجد ثلاثة مصادر أخرى لطلبات التفاعل على أي حال: بعضها يصدر عن APT نفسها، وبعضها يعالجها <command>debconf</command>، وبعضها يحدث على سطر الأوامر نتيجة سكربتات ضبط خاصة بالحزمة.
			</para>

		</section>
		 <section>
			<title>إعداد APT</title>
			 <para>
				حالة APT بسيطة: يطلب الخيار <literal dir="ltr">-y</literal> (أو <literal dir="ltr">--assume-yes</literal>) من APT أن تعتبر الإجابة عن جميع أسئلتها هي ”نعم“.
			</para>

		</section>
		 <section>
			<title>إعداد <command>debconf</command></title>
			 <para>
				تستحق حالة <command>debconf</command> تفصيلاً أكثر. لقد صُمِّم هذا البرنامج، منذ البداية، للتحكم بكمية ومستوى الأسئلة الموجهة للمستخدم، بالإضافة إلى طريقة عرضها. لهذا فإن إعداده يتطلب تحديد أولوية دنيا للأسئلة؛ وتعرض الأسئلة التي تتجاوز هذه الأولوية الدنيا فقط. يستخدم <command>debconf</command> الإجابة الافتراضية (التي حددها مشرف الحزمة) للأسئلة التي يراد تخطيها.
			</para>
			 <para>
				إن عنصر الضبط الآخر المرتبط بهذا الموضوع هو النمط الذي تستخدمه الواجهة. إذا اخترت <literal>noninteractive</literal> من بين الخيارات، سيُعطِّل التفاعل مع المستخدم بالكامل. إذا حاولت الحزمة عرض ملاحظة إعلامية، فسوف تُرسِل إلى مدير النظام بالبريد الإلكتروني.
			</para>
			 <para>
				لإعادة ضبط <command>debconf</command>، استخدم أداة <command>dpkg-reconfigure</command> من الحزمة <emphasis role="pkg">debconf</emphasis>؛ الأمر المطلوب هو <command>dpkg-reconfigure debconf</command>. لاحظ أن القيم المضبوطة يمكن تجاوزها مؤقتاً باستخدام متغيرات البيئة عند الحاجة (مثلاً، يتحكم <varname>DEBIAN_FRONTEND</varname> بالواجهة، كما هو موثق في صفحة الدليل <citerefentry><refentrytitle>debconf</refentrytitle>
				<manvolnum>7</manvolnum></citerefentry>‎).
			</para>

		</section>
		 <section>
			<title>معالجة تفاعلات سطر الأوامر</title>
			 <para>
				آخر مصدر لطلب التفاعل، وأصعب مصدر للتخلص منه، هو سكربتات الإعداد التي يُشغّلها <command>dpkg</command>. لا يوجد أي حل قياسي للأسف، ولا توجد إجابة أفضل من غيرها.
			</para>
			 <para>
				الطريقة الشائعة هي إغلاق مجرى الدخل القياسي بإعادة توجيهه إلى المحتوى الفارغ للملف <filename>/dev/null</filename> باستخدام <command><replaceable>command</replaceable> &lt;/dev/null</command>، أو تغذيته بعدد لانهائي من محارف newline. كلا الطريقتين غير مضمونة 100%، لكنها تؤدي عموماً إلى استخدام الإجابات الافتراضية، نظراً لأن معظم السكربتات تعتبر الصمت قبولاً بالقيمة الافتراضية.
			</para>

		</section>
		 <section>
			<title>الخلطة المعجزة</title>
			 <para>
				إذا جمعنا العناصر السابقة، يمكننا تصميم سكربت صغير لكنه موثوق يتولى التحديثات آلياً.
			</para>
			 <example id="example.non-interactive-upgrade">
				<title>سكربت التحديث اللاتفاعلي</title>
				 
<programlisting>export DEBIAN_FRONTEND=noninteractive
yes '' | apt-get -y -o DPkg::options::="--force-confdef" -o DPkg::options::="--force-confold" dist-upgrade</programlisting>

			</example>
			 <sidebar> <title><emphasis>ممارسة عملية</emphasis> حالة شركة فلكوت</title>
			 <para>
				الحواسيب في شركة فلكوت متباينة، ولها وظائف متنوعة. لذلك سيختار مديرو النظم الحل الأنسب لكل جهاز.
			</para>
			 <para>
				عملياً، أُعدّت المخدّمات التي تعمل بنظام <emphasis role="distribution">جيسي</emphasis> باستخدام ”الخلطة المعجزة“ المذكورة أعلاه، وهي تُحدَّث آلياً. المخدّمات الحيوية فقط (الجدران النارية، مثلا) تعدُّ باستخدام <command>apticron</command>، بحيث تجري التحديثات تحت مراقبة مدير النظام دائماً.
			</para>
			 <para>
				تعمل محطات العمل المكتبية في خدمات الإدارة بنظام <emphasis role="distribution">جيسي</emphasis> أيضاً، لكنها مزودة بالحزمة <emphasis role="pkg">gnome-packagekit</emphasis>، حتى يتحكم المستخدمون بالتحديثات بأنفسهم. إن الداعي لهذا القرار هو أن سلوك الحاسوب قد يتغير بصورة غير متوقعة إذا حُدِّث بدون إعطاء أمر صريح، وهذا قد يربك المستخدمين الرئيسيين.
			</para>
			 <para>
				في المختبر، توجد عدة حواسيب تستخدم <emphasis role="distribution">الاختبارية</emphasis> –للاستفادة من آخر إصدارات البرمجيات– ولا تُحدّث هذه الأجهزة تلقائياً هي الأخرى. ضبط مديرو النظم APT بحيث تجهز التحديثات لكن دون أن تجريها؛ وعندما يقررون تحديث النظام (يدوياً)، سيتجاوزون مرحلتي تحديث قوائم الحزم المتوفرة وتنزيل الحزم، وسيتمكنون من التركيز على الجزء المفيد فعلياً.
			</para>
			 </sidebar>
		</section>

	</section>
	 <section id="sect.searching-packages">
		<title>البحث عن الحزم</title>
		 <para>
			مع كمية البرمجيات الكبيرة في دبيان والتي تنمو باستمرار، تظهر مفارقة: لدى دبيان عادة أدوات لمعظم المهام، لكن العثور على تلك الأدوات من بين آلاف الحزم الأخرى قد يكون صعباً جداً. كان الافتقار للأساليب الملائمة للبحث عن الأداة الصحيحة (والعثور عليها) مشكلة منذ فترة طويلة. لقد حُلّت هذه المشكلة بالكامل تقريباً لحسن الحظ.
		</para>
		 <para>
			أبسط عملية بحث ممكنة هي البحث عن اسم حزمة كما هو. إذا أعاد الأمر <command>apt show <replaceable>package</replaceable></command> نتيجة ما، فالحزمة موجودة. للأسف، هذا يتطلب معرفة اسم الحزمة أو ربما تخمينه، وهذا غير ممكن دائماً.
		</para>
		 <sidebar> <title><emphasis>تلميح</emphasis> عادات تسمية الحزم</title>
		 <para>
			تسمى بعض أنواع الحزم وفقاً لأسلوب تسمية تقليدي؛ قد تسمح لك معرفة الأسلوب بتخمين اسم الحزمة الدقيق أحياناً. مثلاً، بالنسبة لوحدات بيرل، تنص التقاليد على أن الوحدة المسماة <literal>XML::Handler::Composer</literal> في منبعها يجب تحزيمها في <emphasis role="pkg">libxml-handler-composer-perl</emphasis>. مكتبة بايثون التي تسمح باستخدام نظام <command>gconf</command> تحزم باسم <emphasis role="pkg">python-gconf</emphasis>. لا يمكن للأسف تعريف أساليب تسمية عامة لكل الحزم، ولو أن مشرفي الحزم يحاولون عادة اتباع خيارات المطورين المنبعيين.
		</para>
		 </sidebar> <para>
			البحث عن نص بسيط في أسماء الحزم هي طريقة بحث أخرى أنجع قليلاً من سابقتها، لكنها تظل محدودة جداً. يمكن عموماً العثور على نتائج بالبحث في أوصاف الحزم: البحث عن الكلمات المفتاحية في أوصاف الحزم سيثمر غالباً، إذ تملك كل حزمة وصفاً مفصلاً كثيراً أو قليلاً بالإضافة إلى اسمها. <command>apt-cache</command> و<command>axi-cache</command> هما الأداتان اللازمتان لهذا النوع من البحث؛ مثلاً، <command>apt-cache search video</command> ستعيد لائحة بجميع الحزم التي يحتوي اسمها أو وصفها على الكلمة المفتاحية ”video“.
		</para>
		 <para>
			بالنسبة لعمليات البحث الأكثر تعقيداً، ستحتاج لأداة أقوى مثل <command>aptitude</command>. تسمح لك <command>aptitude</command> بالبحث وفقاً لتعبير منطقي مبني على أساس حقول البيانات الفوقية للحزمة. مثلاً، يبحث الأمر التالي عن الحزم التي يحتوي اسمها على <literal>kino</literal>، ووصفها يحوي كلمة <literal>video</literal>، واسم المشرف عليها <literal>paul</literal>:
		</para>
		 
<screen>$ <userinput>aptitude search kino~dvideo~mpaul</userinput>
p   kino  - Non-linear editor for Digital Video data
$ <userinput>aptitude show kino</userinput>
Package: kino
State: not installed
Version: 1.3.4-2.1+b1
Priority: extra
Section: video
Maintainer: Paul Brossier &lt;piem@debian.org&gt;
Architecture: amd64
Uncompressed Size: 8,472 k
Depends: libasound2 (&gt;= 1.0.16), libatk1.0-0 (&gt;= 1.12.4), libavc1394-0 (&gt;=
         0.5.3), libavcodec56 (&gt;= 6:11~beta1) | libavcodec-extra-56 (&gt;=
         6:11~beta1), libavformat56 (&gt;= 6:11~beta1), libavutil54 (&gt;=
         6:11~beta1), libc6 (&gt;= 2.14), libcairo2 (&gt;= 1.2.4), libdv4,
         libfontconfig1 (&gt;= 2.11), libfreetype6 (&gt;= 2.2.1), libgcc1 (&gt;=
         1:4.1.1), libgdk-pixbuf2.0-0 (&gt;= 2.22.0), libglade2-0 (&gt;= 1:2.6.4-2~),
         libglib2.0-0 (&gt;= 2.12.0), libgtk2.0-0 (&gt;= 2.24.0), libice6 (&gt;=
         1:1.0.0), libiec61883-0 (&gt;= 1.2.0), libpango-1.0-0 (&gt;= 1.14.0),
         libpangocairo-1.0-0 (&gt;= 1.14.0), libpangoft2-1.0-0 (&gt;= 1.14.0),
         libquicktime2 (&gt;= 2:1.2.2), libraw1394-11, libsamplerate0 (&gt;= 0.1.7),
         libsm6, libstdc++6 (&gt;= 4.9), libswscale3 (&gt;= 6:11~beta1), libx11-6,
         libxext6, libxml2 (&gt;= 2.7.4), libxv1, zlib1g (&gt;= 1:1.1.4)
Recommends: ffmpeg, curl
Suggests: udev | hotplug, vorbis-tools, sox, mjpegtools, lame, ffmpeg2theora
Conflicts: kino-dvtitler, kino-timfx, kinoplus
Replaces: kino-dvtitler, kino-timfx, kinoplus
Provides: kino-dvtitler, kino-timfx, kinoplus
Description: Non-linear editor for Digital Video data
 Kino allows you to record, create, edit, and play movies recorded with DV
 camcorders. This program uses many keyboard commands for fast navigating and
 editing inside the movie. 
 
 The kino-timfx, kino-dvtitler and kinoplus sets of plugins, formerly
 distributed as separate packages, are now provided with Kino.
Homepage: http://www.kinodv.org/

Tags: field::arts, hardware::camera, implemented-in::c, implemented-in::c++,
      interface::x11, role::program, scope::application, suite::gnome,
      uitoolkit::gtk, use::editing, use::learning, works-with::video,
      x11::application</screen>
		 <para>
			يعيد البحث حزمة واحدة فقط، وهي <emphasis role="pkg">kino</emphasis>، التي تفي بجميع معايير البحث.
		</para>
		 <para>
			حتى عمليات البحث متعددة المعايير هذه غير عمليّة، ما يفسر عدم استخدام الناس لها كما ينبغي. بالتالي تم تطوير نظام وسم جديد، وهو يقدم أسلوباً جديداً للبحث. تعطى الحزم وسوماً تقدّم تصنيفاً بحسب الموضوع من عدة نواحي، يعرف باسم ”التصنيف الموشوري“ (facet-based classification). في حالة <emphasis role="pkg">kino</emphasis> المبينة أعلاه، تشير وسوم الحزمة إلى أن Kino هو برنامج مبني على Gnome وهو يعالج الفيديو وغرضه الأساسي هو التحرير.
		</para>
		 <para>
			قد يساعدك تصفح هذه التصنيفات على البحث عن حزمة مرتبطة بحاجة معروفة؛ حتى لو أعاد عدداً (معتدلاً) من الاحتمالات، فيمكن إكمال البحث يدوياً. لعمل ذلك، يمكنك استخدام نموذج البحث <literal dir="ltr">~G</literal> في <command>aptitude</command>، لكن من الأسهل غالباً تصفح الموقع الذي تدار فيه الوسوم: <ulink type="block" url="http://debtags.alioth.debian.org/cloud/" />
		</para>
		 <indexterm>
			<primary><emphasis role="pkg">debtags</emphasis></primary>
		</indexterm>
		 <indexterm>
			<primary>وسم</primary>
		</indexterm>
		 <para>
			إن اختيار الوسمين <literal>works-with::video</literal> و<literal>use::editing</literal> يعطي حفنة حزم، منها محرري الفيديو <emphasis role="pkg">kino</emphasis> و<emphasis role="pkg">pitivi</emphasis>. إن نظام التصنيف هذا في طريقه نحو الانتشار أكثر وأكثر مع مرور الوقت، وستقدم برامج إدارة الحزم واجهات بحث فعالة مبنية على أساسه.
		</para>
		 <para>
			لتلخيص الموضوع، يعتمد اختيار أفضل أداة على مدى تعقيد البحث الذي ترغب بتنفيذه:
		</para>
		 <itemizedlist>
			<listitem>
				<para>
					تسمح لك <command>apt-cache</command> بالبحث في أسماء الحزم وأوصافها فقط، وهي مناسبة جداً عند البحث عن حزمة معينة توافق بضعة كلمات مفتاحية مستهدفة؛
				</para>

			</listitem>
			 <listitem>
				<para>
					عندما تحتوي معايير البحث أيضاً على علاقات بين الحزم أو بيانات فوقية أخرى مثل اسم المشرف عليها، سيكون <command>synaptic</command> أكثر فائدة؛
				</para>

			</listitem>
			 <listitem>
				<para>
					عند الحاجة إلى بحث مبني على أساس الوسوم، فإن <command>packagesearch</command> أداة جيدة لهذا الغرض، وهي واجهة رسومية مخصصة للبحث ضمن الحزم المتوفرة اعتماداً على عدة معايير (بما فيها أسماء الملفات التي تحويها). أما إذا أردت البحث من سطر الأوامر، فعليك باستخدام <command>axi-cache</command>.
				</para>
				 <indexterm>
					<primary><emphasis role="pkg">packagesearch</emphasis></primary>
				</indexterm>
				 <indexterm>
					<primary><command>axi-cache</command></primary>
				</indexterm>

			</listitem>
			 <listitem>
				<para>
					أخيراً، عندما يحوي البحث تعابير معقدة وعمليات منطقية، سيكون نظام <command>aptitude</command> للبحث عن النماذج الأداة المثلى لذلك، فهو قوي فعلاً بغض النظر عن غموضه نوعاً ما؛ وهو يعمل في النمطين النصي والتفاعلي.
				</para>

			</listitem>

		</itemizedlist>

	</section>
</chapter>

