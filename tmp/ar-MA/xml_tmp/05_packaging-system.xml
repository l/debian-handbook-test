<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
]>
<chapter id="packaging-system">
  <chapterinfo>
    <mediaobject condition="pdf">
      <imageobject>
        <imagedata fileref="images/chap-packaging-system.png" scalefit="1" />
      </imageobject>
    </mediaobject>
    <keywordset>
      <keyword>حزمة ثنائية</keyword>
      <keyword>حزمة مصدرية</keyword>
      <keyword>dpkg</keyword>
      <keyword>اعتماديات</keyword>
      <keyword>تضارب</keyword>
    </keywordset>
  </chapterinfo>
  <title>نظام الحزم: الأدوات والمبادئ الأساسية</title>
  <highlights>
    <para>بما أنك مدير دبيان، فسوف تتعامل مع حزم <filename dir="ltr">.deb</filename> بشكل متكرر، التي تحوي عناصر وظيفية مترابطة (تطبيقات، وثائق... الخ)، تُسهِّل هذه الحزم تثبيتها وصيانتها. فمن الجيد إذن أن تعرف مما تتألف هذه الحزم وكيف تستخدمها.</para>
  </highlights>

  <para>يصف هذا الفصل بنية ومحتويات الحزم ”الثنائية“ و ”المصدرية“. الأولى هي ملفات <filename dir="ltr">.deb</filename>، يمكن الاستفادة منها مباشرة باستخدام <command>dpkg</command>، في حين تحوي الأخيرة شفرة البرنامج المصدرية، بالإضافة إلى تعليمات بناء حزم ثنائية.</para>
  <section id="sect.binary-package-structure">
    <title>بنية الحزمة الثنائية</title>
    <indexterm><primary>حزمة</primary><secondary>حزمة ثنائية</secondary></indexterm>
    <indexterm><primary><command>ar</command></primary></indexterm>

    <para>صيغة حزم دبيان مصممة بحيث يمكن استخراج محتوياتها على أي نظام يونكس يملك الأوامر الكلاسيكية <command>ar</command>، و <command>tar</command>، و <command>gzip</command> (وأحياناً <command>xz</command> أو <command>bzip2</command>). هذه الخاصية التافهة ظاهريًا حاسمة بالنسبة للمحمولية والإنقاذ في حالات الكوارث.</para>

    <para>تخيل، مثلا، أنك حذفت برنامج <command>dpkg</command> عن طريق الخطأ، وأنك لا تستطيع بالتالي تثبيت حزم دبيان بعد ذلك. ولأن <command>dpkg</command> هو حزمة دبيان بحد ذاته، يبدو أن نظامك قد انتهى أمره... لحسن الحظ، أنت تعرف صيغة الحزمة ويمكنك بالتالي تنزيل ملف <filename>.deb</filename> الخاص بحزمة <emphasis role="pkg">dpkg</emphasis> ثم تثبته يدوياً (انظر الملاحظة الجانبية <xref linkend="sidebar.dpkg-apt-ar" />). إذا اختفى واحد أو أكثر من البرامج <command>ar</command> ،<command>tar</command> أو <command>gzip</command>/<command>xz</command>/<command>bzip2</command> بسبب سوء الحظ، فكل ما تحتاج له هو نسخ البرنامج المفقود من نظام آخر (بما أن كل واحد من هذه البرامج يعمل بطريقة مستقلة تماماً، وليس له اعتماديات، فالنسخ البسيط سيكفي). حتى لو عاندتك الظروف التي يعاني منها نظامك أكثر من ذلك، وحتى لو لم تعمل هذه أيضاً (ربما اختفت بعض أهم المكتبات من النظام؟)، عليك تجربة النسخة الستاتيكية من <command>busybox</command> (المتوفر في الحزمة <emphasis role="pkg">busybox-static</emphasis>)، التي تعمل بشكل مستقل أكثر، وتوفر أوامر فرعية مثل <command>busybox ar</command>، و<command>busybox tar</command>، و<command>busybox gunzip</command>.</para>

    <sidebar id="sidebar.dpkg-apt-ar">
      <title><emphasis>أدوات</emphasis> <command>dpkg</command> ،<command>APT</command> و <command>ar</command></title>
      <indexterm><primary><command>dpkg</command></primary></indexterm>
      <indexterm><primary><command>ar</command></primary></indexterm>
      <indexterm><primary>APT</primary></indexterm>

      <para><command>dpkg</command> هو البرنامج الذي يعالج ملفات <filename dir="ltr">.deb</filename>، بالأخص الاستخراج، والتحليل، وفك الضغط عنها.</para>

      <para><command>APT</command> هي مجموعة من البرامج تسمح بتنفيذ تعديلات ذات مستوى أعلى على النظام: تثبيت أو إزالة حزمة (مع تلبية الاعتماديات)، وتحديث النظام، سرد الحزم المتوفرة، الخ.</para>
    
      <indexterm><primary><command>ar</command></primary></indexterm>
      <para>أما بالنسبة للبرنامج <command>ar</command>، فهو يسمح بمعالجة الملفات ذات الاسم نفسه: يعرض الأمر <command>ar t <replaceable>archive</replaceable></command> قائمة بالملفات الموجودة في أرشيف ar، يستخرج الأمر <command>ar x <replaceable>archive</replaceable></command> الملفات من الأرشيف إلى مجلد العمل الحالي، يحذف الأمر <command>ar d <replaceable>archive</replaceable> <replaceable>file</replaceable></command> ملفًا من الأرشيف، الخ. تُوثّق صفحة الدليل الخاصة به (<citerefentry><refentrytitle>ar</refentrytitle><manvolnum>1</manvolnum></citerefentry>‎) عملياته العديدة الأخرى. <command>ar</command> أداة بدائية جدًا يمكن أن يستخدمها مدير يونكس في مناسبات نادرة، لكن مديري النظم يستخدمون <command>tar</command> كثيرًا، وهو برنامج أرشفة وإدارة ملفات أكثر تطوراً. لهذا تكون استعادة <command>dpkg</command> سهلة في حال حذفه خطأً. كل ما عليك فعله هو تنزيل حزمة دبيان واستخراج محتويات الأرشيف <filename>data.tar.gz</filename> في جذر النظام (<filename>/</filename>):</para>

      <screen>
<computeroutput># </computeroutput><userinput>ar x dpkg_1.17.23_amd64.deb</userinput>
<computeroutput># </computeroutput><userinput>tar -C / -p -xzf data.tar.gz</userinput></screen>
    </sidebar>

    <sidebar>
      <title><emphasis>أساسيات</emphasis> ترقيم صفحات الدليل</title>

      <para>قد يُذهَل المبتدئون لوجود إشارة إلى ”<citerefentry><refentrytitle>ar</refentrytitle><manvolnum>1</manvolnum></citerefentry>‎“ في النص. هذه عادةً طريقة مناسبة للإشارة إلى صفحة الدليل ذات الاسم <literal>ar</literal> في القسم 1.</para>

      <para>يستخدم هذا التدوين أحيانًا لرفع الالتباس، مثلاً للتفريق بين الأمر <command>printf</command> الذي يمكن الإشارة إليه بـ <citerefentry><refentrytitle>printf</refentrytitle><manvolnum>1</manvolnum></citerefentry>‎ أيضًا وبين الدالة <function>printf</function> في لغة البرمجة C، التي يمكن الإشارة إليها بـ <citerefentry><refentrytitle>printf</refentrytitle><manvolnum>3</manvolnum></citerefentry>‎.</para>

      <para>يناقش <xref linkend="solving-problems" /> صفحات الدليل بتفصيل أكثر (انظر <xref linkend="sect.manual-pages" />).</para>
    </sidebar>

    <para>لنلقِ نظرة على محتويات ملف <filename dir="ltr">.deb</filename>:</para>

    <screen><computeroutput>$ </computeroutput><userinput>ar t dpkg_1.17.23_amd64.deb</userinput>
<computeroutput>debian-binary
control.tar.gz
data.tar.gz
$ </computeroutput><userinput>ar x dpkg_1.17.23_amd64.deb</userinput>
<computeroutput>$ </computeroutput><userinput>ls</userinput>
<computeroutput>control.tar.gz  data.tar.gz  debian-binary  dpkg_1.17.23_amd64.deb
$ </computeroutput><userinput>tar tzf data.tar.gz | head -n 15</userinput>
<computeroutput>./
./var/
./var/lib/
./var/lib/dpkg/
./var/lib/dpkg/parts/
./var/lib/dpkg/info/
./var/lib/dpkg/alternatives/
./var/lib/dpkg/updates/
./etc/
./etc/logrotate.d/
./etc/logrotate.d/dpkg
./etc/dpkg/
./etc/dpkg/dpkg.cfg.d/
./etc/dpkg/dpkg.cfg
./etc/alternatives/
$ </computeroutput><userinput>tar tzf control.tar.gz</userinput>
<computeroutput>./
./conffiles
./postinst
./md5sums
./prerm
./preinst
./control
./postrm
$ </computeroutput><userinput>cat debian-binary</userinput>
<computeroutput>2.0</computeroutput></screen>

    <para>كما ترى، يتألف أرشيف <command>ar</command> الذي يضم حزمة دبيان من ثلاثة ملفات:</para>
    <itemizedlist>
      <listitem>
	<para><filename>debian-binary</filename>. هذا ملف نصي يشير ببساطة إلى نسخة ملف <filename dir="ltr">.deb</filename> المستخدم (في 2015: الإصدارة 2.0).</para>
      </listitem>
      <listitem>
	<para><filename>control.tar.gz</filename>. ملف الأرشيف هذا يحوي جميع المعلومات الفوقية المتاحة، مثل اسم الحزمة وإصدارها. تسمح بعض هذه المعلومات الفوقية لأدوات إدارة الحزم بأن تقرر إذا كان يمكن تثبيت الحزمة أو إزالتها، حسب قائمة الحزم المتوفرة مسبقاً على الجهاز مثلاً.</para>
      </listitem>
      <listitem>
	<para><filename>data.tar.gz</filename>. يحوي هذا الأرشيف على جميع الملفات التي يجب استخراجها من الحزمة؛ هذا هو المكان حيث تخزن الملفات التنفيذية، الوثائق، الخ. قد تستخدم بعض الحزم صيغ ضغط مختلفة، حيث يتغير اسم الملف في تلك الحالة (<filename>data.tar.bz2</filename> بالنسبة لصيغة bzip2،‏ <filename>data.tar.xz</filename> بالنسبة لصيغة XZ).</para>
      </listitem>
    </itemizedlist>
  </section>

  <section id="sect.package-meta-information">
    <title>المعلومات الفوقية للحزمة</title>
    <indexterm><primary>المعلومات الفوقية للحزمة</primary></indexterm>
    <indexterm><primary>حزمة</primary><secondary>معلومات فوقية</secondary></indexterm>

    <para>حزمة دبيان ليست مجرد أرشيف ملفات مُعدٌّ للتثبيت. بل هي جزء من كيان أكبر، وهي تصف العلاقة بينها وبين حزم دبيان الأخرى (اعتماد، تضارب، اقتراح). كما توفر سكربتات تسمح بتنفيذ الأوامر في مختلف المراحل في دورة حياة الحزمة (تثبيت، إزالة، تحديث). تستخدم أدوات إدارة الحزم هذه البيانات لكنها ليست جزءاً من البرمجية المُحزَّمة؛ بل تكوّن – داخل الحزمة – ما يدعى ”بالمعلومات الفوقية meta-information“ (معلومات عن المعلومات).</para>

    <section id="sect.control">
      <title>وصف: الملف <filename>control</filename></title>
      <indexterm><primary>المعلومات الفوقية للحزمة</primary></indexterm>
      <indexterm><primary>حزمة</primary><secondary>معلومات فوقية</secondary></indexterm>
      <indexterm><primary><filename>control</filename></primary></indexterm>

      <para>يستعمل هذا الملف بنية مشابهة لترويسات البريد الإلكتروني (كما عرَّفها RFC 2822). مثلاً، يبدو ملف <filename>control</filename> الخاص بحزمة <emphasis role="pkg">apt</emphasis> كالتالي:</para>

      <screen>
<computeroutput>$ </computeroutput><userinput>apt-cache show apt</userinput>
<computeroutput>Package: apt
Version: 1.0.9.6
Installed-Size: 3788
Maintainer: APT Development Team &lt;deity@lists.debian.org&gt;
Architecture: amd64
Replaces: manpages-it (&lt;&lt; 2.80-4~), manpages-pl (&lt;&lt; 20060617-3~), openjdk-6-jdk (&lt;&lt; 6b24-1.11-0ubuntu1~), sun-java5-jdk (&gt;&gt; 0), sun-java6-jdk (&gt;&gt; 0)
Depends: libapt-pkg4.12 (&gt;= 1.0.9.6), libc6 (&gt;= 2.15), libgcc1 (&gt;= 1:4.1.1), libstdc++6 (&gt;= 4.9), debian-archive-keyring, gnupg
Suggests: aptitude | synaptic | wajig, dpkg-dev (&gt;= 1.17.2), apt-doc, python-apt
Conflicts: python-apt (&lt;&lt; 0.7.93.2~)
Breaks: manpages-it (&lt;&lt; 2.80-4~), manpages-pl (&lt;&lt; 20060617-3~), openjdk-6-jdk (&lt;&lt; 6b24-1.11-0ubuntu1~), sun-java5-jdk (&gt;&gt; 0), sun-java6-jdk (&gt;&gt; 0)
Description-en: commandline package manager
 This package provides commandline tools for searching and
 managing as well as querying information about packages
 as a low-level access to all features of the libapt-pkg library.
 .
 These include:
  * apt-get for retrieval of packages and information about them
    from authenticated sources and for installation, upgrade and
    removal of packages together with their dependencies
  * apt-cache for querying available information about installed
    as well as installable packages
  * apt-cdrom to use removable media as a source for packages
  * apt-config as an interface to the configuration settings
  * apt-key as an interface to manage authentication keys
Description-md5: 9fb97a88cb7383934ef963352b53b4a7
Tag: admin::package-management, devel::lang:ruby, hardware::storage,
 hardware::storage:cd, implemented-in::c++, implemented-in::perl,
 implemented-in::ruby, interface::commandline, network::client,
 protocol::ftp, protocol::http, protocol::ipv6, role::program,
 role::shared-lib, scope::application, scope::utility, sound::player,
 suite::debian, use::downloading, use::organizing, use::searching,
 works-with::audio, works-with::software:package, works-with::text
Section: admin
Priority: important
Filename: pool/main/a/apt/apt_1.0.9.6_amd64.deb
Size: 1107560
MD5sum: a325ccb14e69fef2c50da54e035a4df4
SHA1: 635d09fcb600ec12810e3136d51e696bcfa636a6
SHA256: 371a559ce741394b59dbc6460470a9399be5245356a9183bbeea0f89ecaabb03</computeroutput></screen>

      <sidebar>
        <title><emphasis>أساسيات</emphasis> RFC — معايير الإنترنت</title>
        <indexterm><primary>RFC</primary></indexterm>
        <indexterm><primary>Request For Comments</primary></indexterm>

	<para>RFC هو اختصار للعبارة ”Request For Comments“ أي طلب التعليقات. RFC عادة هو مستند تقني يصف ما سيصبح معيار إنترنت لاحقًا. قبل توحيد وتجميد هذه المعايير، ترسل للمراجعة العلنية (من هنا جاء الاسم). تقرر IETF‏ (Internet Engineering Task Force) مدى تطور حالة هذه المستندات (معيار مقترح، مسودة معيار، أو معيار).</para>

	<para>يُعرِّف RFC 2026 عملية توحيد بروتوكولات الإنترنت. <ulink type="block" url="http://www.faqs.org/rfcs/rfc2026.html" /></para>
      </sidebar>
      <section>
        <title>الاعتماديات: حقل <literal>Depends</literal></title>
        <indexterm><primary>اعتمادية</primary></indexterm>
        <indexterm><primary><literal>Depends</literal>، حقل ترويسة</primary></indexterm>
        <indexterm><primary>حزمة</primary><secondary>اعتمادية</secondary></indexterm>

	<para>تُعرَّف الاعتماديات في حقل <literal>Depends</literal> في ترويسة الحزمة. الاعتماديات هي لائحة بالشروط الواجب إيفاؤها حتى تعمل الحزمة بشكل صحيح — تستخدم بعض الأدوات هذه المعلومات مثل <command>apt</command> في سبيل تثبيت المكتبات المطلوبة، بالإصدارات المناسبة التي تلبي اعتماديات البرنامج المثبت. بالنسبة لكل اعتمادية، يمكن تقييد نطاق إصداراتها التي تحقق الشرط. بكلمات أخرى، من الممكن التعبير عن حقيقة أننا نحتاج إصدارة أكبر أو تساوي ”2.15“ من الحزمة <emphasis role="pkg">libc6</emphasis> (نكتب ذلك ”<command dir="ltr">libc6(&gt;= 2.15)</command>“). عمليات مقارنة الإصدارات هي كالتالي:</para>
        <itemizedlist>
          <listitem>
	    <para><command dir="ltr">&lt;&lt;</command>: أقل من؛</para>
          </listitem>
          <listitem>
	    <para><command dir="ltr">&lt;=</command>: أقل من أو يساوي؛</para>
          </listitem>
          <listitem>
	    <para><command>=</command>: يساوي (لاحظ أن ”<literal>2.6.1</literal>“ لا يساوي ”<literal dir="ltr">2.6.1-1‎</literal>“)؛</para>
          </listitem>
          <listitem>
	    <para><command dir="ltr">&gt;=</command>: أكبر من أو يساوي؛</para>
          </listitem>
          <listitem>
	    <para><command dir="ltr">&gt;&gt;</command>: أكبر من؛</para>
          </listitem>
        </itemizedlist>

	<para>تخدم الفاصلة كحرف فصل في لائحة الشروط الواجب تحقيقها. يمكن تفسير معناها على أنها ”and“ منطقية. وفي لائحة الشروط أيضًا، يعبِّر الخط الشاقولي (”|“) عن عملية ”or“ المنطقية (عملية ”أو“ تضمنية ”inclusive or“ وليست عملية ”إما كذا أو كذا exclusive or“). ولأن أولويتها أكبر من أولوية ”and“، يمكن استخدامها قدر الحاجة. بالتالي، تُكتَب الاعتمادية ”A or B) and C)“ بالشكل <command>A | B, C</command>. وفي المقابل، التعبير ”(A or (B and C“ يجب كتابته بالشكل ”(A or B) and (A or C)“، لأن حقل <literal>Depends</literal> لا يسمح بالأقواس التي تُغيِّر ترتيب الأولويات بين العمليات المنطقية ”or“ و ”and“. سيُكتب إذاً كالتالي <command>A | B, A | C</command>.  <ulink type="block" url="http://www.debian.org/doc/debian-policy/ch-relationships.html" /></para>

        <indexterm><primary>حزمة فوقية</primary></indexterm>
	<para>نظام الاعتماديات وسيلة جيدة لضمان عمل البرنامج، لكن له استخدام آخر عبر ”الحزم الفوقية“. هذه الحزم هي حزم فارغة تُعرّف فقط اعتماديات. وهي تُسهِّل تثبيت مجموعة مترابطة من البرامج التي يختارها مشرف الحزمة الفوقية مسبقاً؛ بالتالي، سيثبت الأمر <command>apt install <replaceable>meta-package</replaceable></command> جميع هذه البرامج آلياً باستخدام اعتماديات الحزمة الفوقية. الحزم <emphasis role="pkg">gnome</emphasis>، و <emphasis role="pkg">kde-full</emphasis> و <emphasis role="pkg">linux-image-amd64</emphasis> هي أمثلة عن الحزم الفوقية.</para>

        <sidebar>
          <title><emphasis>سياسة دبيان</emphasis>  الاعتمادية الاستباقية، اعتمادية تلبيتها أصعب</title>
          <indexterm><primary><literal>Pre-Depends</literal>، حقل ترويسة</primary></indexterm>
          <indexterm><primary>اعتمادية استباقية</primary></indexterm>

	  <para>”الاعتماديات الاستباقية pre-dependencies“، التي تذكر في الحقل ”<literal>Pre-Depends</literal>“ في ترويسة الحزمة، تكمل الاعتماديات الطبيعية؛ وصيغة توصيفها مطابقة لها. تُبيّن الاعتمادية العادية أنه يجب فك الضغط عن الحزمة المطلوبة وإعدادها قبل إعداد الحزمة التي صَرَّحت عن الاعتمادية. أما الاعتمادية الاستباقية فهي تشترط فك الضغط عن الحزمة المطلوبة وإعدادها قبل تنفيذ سكربت الإعداد السابق للتثبيت الخاص بالحزمة التي صرحت عن الاعتمادية الاستباقية، أي قبل البدء بتثبيتها.</para>

	  <para>الاعتماديات الاستباقية تُقيّد <command>apt</command> كثيراً، لأنها تضيف قيداً على ترتيب الحزم التي يجب تثبيتها. لذلك، لا ينصح باستخدام الاعتماديات الاستباقية إلا في حال الضرورة القصوى. بل إن الأفضل استشارة المطورين الآخرين على <email> debian-devel@lists.debian.org</email> قبل إضافة اعتمادية استباقية. من الممكن عموماً إيجاد حل آخر للالتفاف حول المشكلة.</para>
        </sidebar>

        <sidebar>
          <title><emphasis>سياسة دبيان</emphasis> حقول <literal>Recommends</literal> و <literal>Suggests</literal> و <literal>Enhances</literal></title>
          <indexterm><primary><literal>Recommends</literal>، حقل ترويسة</primary></indexterm>
          <indexterm><primary><literal>Suggests</literal>، حقل ترويسة</primary></indexterm>

	  <para>يصف الحقلين <literal>Recommends</literal> و <literal>Suggests</literal> اعتماديات غير إلزامية. الاعتماديات في حقل ”recommended“ (المستحسنة أو الموصى بها)، أكثرها أهمية، تزيد وظائفية الحزمة بشكل واضح لكنها ليست ضرورية لتشغيلها. الاعتماديات في حقل ”suggested“ (المقترحة)، ذات أهمية ثانوية، وتشير إلى حزم معينة يمكن لها إكمال الأداة المثبتة وزيادة فائدتها، لكن من المنطقي تماماً تثبيت واحدة منها فقط دون البقية.</para>

	  <para>عليك تثبيت الحزم ”الموصى بها“ دائماً، إلا إذا كنت تعلم سبب عدم حاجتك لها بدقة. بالمقابل، لا حاجة بثبيت الحزم ”المقترحة“ ما لم تعلم سبب حاجتك لها.</para>

          <indexterm><primary><literal>Enhances</literal>، حقل ترويسة</primary></indexterm>

	  <para>يصف الحقل <literal>Enhances</literal> اقتراحات أيضاً، ولكن في سياق مختلف. يقع هذا الحقل في الحقيقة في الحزمة المُقتَرَحة، وليس في الحزمة التي تستفيد من الاقتراح. تكمن فائدته في أنه يمكن إضافة اقتراحات دون الحاجة لتعديل الحزمة المستفيدة. وهكذا، يمكن أن تظهر الإضافات، والامتدادات وغيرها من زيادات البرامج في قائمة المقترحات الخاصة بها. رغم أن هذا الحقل كان موجوداً منذ عدة سنوات، إلا أن البرامج مثل <command>apt</command> أو <command>synaptic</command> لا تزال تتجاهله غالباً. الهدف منه هو ظهور المقترحات المذكورة في حقل <literal>Enhances</literal> للمستخدم بالإضافة للمقترحات التقليدية — التي تجدها في الحقل <literal>Suggests</literal>.</para>
        </sidebar>
      </section>
      <section>
        <title>تضارب: حقل <literal>Conflicts</literal></title>
        <indexterm><primary>تضارب</primary></indexterm>
        <indexterm><primary><literal>Conflicts</literal>، حقل ترويسة</primary></indexterm>
        <indexterm><primary>حزمة</primary><secondary>تضارب</secondary></indexterm>

	<para>يبين الحقل <literal>Conflicts</literal> أن الحزمة لا يمكن تثبيتها على النظام عند وجود حزمة أخرى. أكثر الأسباب شيوعاً لهذا التضارب هي أن الحزمتين تحويان ملفاً له الاسم نفسه، أو تقدمان الخدمة ذاتها على نفس منفذ TCP، أو أنهما تتعارضان في عملهما.</para>

	<para>يرفض <command>dpkg</command> تثبيت حزمة تتعارض مع حزمة مثبتة سابقاً، إلا إذا كانت الحزمة الجديدة تبين أنها ”تستبدل“ الحزمة المثبتة، في تلك الحالة، يختار <command>dpkg</command> استبدال الحزمة القديمة بالجديدة. أما <command>apt</command> فتتبع إرشاداتك دوماً: إذا اخترت تثبيت حزمة جديدة، سوف تعرض عليك تلقائياً إزالة الحزمة التي تسبب مشكلة.</para>
      </section>
      <section>
        <title>عدم التوافق: حقل <literal>Breaks</literal></title>
        <indexterm><primary>عدم توافق</primary></indexterm>
        <indexterm><primary><literal>Breaks</literal>، حقل ترويسة</primary></indexterm>
        <indexterm><primary>حزمة</primary><secondary>عدم توافق</secondary></indexterm>

	<para>تأثير الحقل <literal>Breaks</literal> يشبه تأثير الحقل <literal>Conflicts</literal>، لكن له معنى خاص. يشير هذا الحقل إلى أن تثبيت الحزمة سوف ”يعطب“ حزمة أخرى (أو نسخة محددة منها). عموماً، هذا النوع من عدم التوافق بين الحزم انتقالي، وغالباً ما تحدد علاقة <literal>Breaks</literal> الإصدارات غير المتوافقة فيما بينها.</para>

	<para>يرفض <command>dpkg</command> تثبيت حزمة تعطب حزمة مثبتة مسبقاً، أما <command>apt</command> فتحاول حل المشكلة بتحديث الحزمة التي كانت ستتعطل إلى إصدار أحدث (الذي يفترض أنه قد أُصلِح، وأنه قد عاد متوافقاً من جديد).</para>

	<para>يحدث هذا النوع من الحالات في حال صدور تحديثات بدون توافق عكسي: هذا ما يحدث عندما لا تتوافق النسخة الجديدة مع النسخة القديمة، وتسبب أعطالاً في برامج أخرى ما لم تتخذ الاحتياطات المناسبة. يستخدم الحقل <literal>Breaks</literal> لمنع المستخدم من الخوض في هذه المشاكل.</para>
      </section>
      <section>
        <title>العناصر المقدَّمة: حقل <literal>Provides</literal></title>
        <indexterm><primary><literal>Provides</literal>، حقل ترويسة</primary></indexterm>

	<para>يقدم هذا الحقل مفهوم ”الحزمة الظاهرية“. لهذا الحقل أدوار عديدة، لكن اثنين منها لهما أهمية خاصة. يتمثل الدور الأول في استخدام الحزمة الظاهرية لربطها مع خدمة عامة (الحزمة ”توفر provides“ الخدمة). أما الدور الثاني فهو أن هذا الحقل يشير إلى أن الحزمة تستبدل حزمة أخرى بالكامل، وأنها تستطيع أيضاً تلبية اعتماديات الحزم التي تعتمد على الحزمة المُستَبدَلَة. بالتالي، يمكن إنشاء حزمة بديلة دون الاضطرار لاستخدام اسم الحزمة نفسه.</para>

        <sidebar>
          <title><emphasis>مصطلحات</emphasis> الحزمة الفوقية والحزمة الظاهرية</title>
          <indexterm><primary>حزمة فوقية</primary></indexterm>
          <indexterm><primary>حزمة</primary><secondary>حزمة ظاهرية</secondary></indexterm>
          <indexterm><primary>حزمة ظاهرية</primary></indexterm>

	  <para>من المهم التمييز بوضوح بين الحزم الفوقية وبين الحزم الظاهرية. الأولى هي حزم حقيقية (ولها ملفات <filename dir="ltr">‎.deb</filename> حقيقية)، غرضها الوحيد التصريح عن اعتماديات.</para>

	  <para>أما الحزم الظاهرية، فلا وجود لها فيزيائياً؛ بل هي مجرد وسيلة لمطابقة الحزم الحقيقية اعتماداً على معايير منطقية مشتركة (الخدمات المقدَّمة، التوافق مع برنامج معياري أو حزمة سابقة، الخ).</para>
        </sidebar>
        <section>
          <title>تقديم ”خدمة“</title>

	  <para>دعنا نناقش الحالة الأولى بتفصيل أكثر من خلال مثال: نقول أن جميع مخدمات البريد الإلكتروني، مثل <emphasis role="pkg">postfix</emphasis> أو <emphasis role="pkg">sendmail</emphasis> ”تُقدِّم“ الحزمة الظاهرية <emphasis role="pkg"> mail-transport-agent</emphasis>. بالتالي، أي حزمة تحتاج هذه الخدمة (مثل برامج إدارة قوائم بريدية، مثل <emphasis role="pkg">smartlist</emphasis> أو <emphasis role="pkg">sympa</emphasis>) تصرح ببساطة أنها تحتاج <emphasis role="pkg">mail-transport-agent</emphasis> في اعتمادياتها بدلاً من تحديد قائمة طويلة وغير كاملة للحلول الممكنة (مثل <command>postfix‏ | sendmail‏ | exim4 | …</command>). بالإضافة لذلك، لا فائدة من تثبيت مخدمي بريد إلكتروني على نفس الجهاز، ولذلك تصرح كل واحدة من هذه الحزم عن تعارض مع الحزمة الظاهرية <emphasis role="pkg">mail-transport-agent</emphasis>. يتجاهل النظام تعارض الحزمة مع نفسها، لكن هذه التقنية تمنع تثبيت أكثر من مخدم بريد إلكتروني واحد على نفس الجهاز.</para>

          <sidebar>
            <title><emphasis>سياسة دبيان</emphasis> قائمة الحزم الظاهرية</title>
            <indexterm><primary>حزمة</primary><secondary>حزمة ظاهرية</secondary></indexterm>

	    <para>حتى تتحقق الفائدة من الحزم الظاهرية، يجب أن يتوافق الجميع على أسمائها. لذلك تجعل سياسة دبيان هذه الحزم قياسية. تتضمن اللائحة <emphasis role="pkg">mail-transport-agent</emphasis> لمخدمات البريد، و <emphasis role="pkg">c-compiler</emphasis> لمترجمات لغة C، و <emphasis role="pkg">www-browser</emphasis> لمتصفحات الوب، و <emphasis role="pkg">httpd</emphasis> لمخدمات الوب، و <emphasis role="pkg">ftp-server</emphasis> لمخدمات FTP، و <emphasis role="pkg">x-terminal-emulator</emphasis> لمحاكيات الطرفية في الوضع الرسومي (<command>xterm</command>)، و <emphasis role="pkg">x-window-manager</emphasis> لبرامج إدارة النوافذ، بالإضافة إلى العديد من الأسماء الأخرى.</para>

	    <para>يمكنك الحصول على اللائحة الكاملة من الوب. <ulink type="block" url="http://www.debian.org/doc/packaging-manuals/virtual-package-names-list.txt" /></para>
          </sidebar>
        </section>
        <section>
          <title>إبدال الحزم</title>

	  <para>يفيد الحقل <literal>Provides</literal> أيضاً عندما تدرج محتويات الحزمة في حزمة أكبر. مثلاً، وحدة بيرل <emphasis role="pkg">libdigest-md5-perl</emphasis> كانت وحدة اختيارية في بيرل 5.6، وبعدها دُمِجَت كوحدة قياسية في بيرل 5.8 (والإصدارات اللاحقة أيضاً، كالإصدار 5.20 المتوفر في <emphasis role="distribution">جيسي</emphasis>). نتيجة لذلك، أضافت الحزمة <emphasis role="pkg">perl</emphasis> منذ الإصدار 5.8 التصريح <literal>Provides: libdigest-md5-perl</literal> بحيث تتم تلبية اعتماد الحزم الأخرى على هذه الحزمة إذا ثبَّت المستخدم بيرل 5.8 (أو أحدث). لقد حُذِفَت الحزمة <emphasis role="pkg">libdigest-md5-perl</emphasis> في النهاية، بما أنه لم يبق لها أي عمل بعد إزالة الإصدارات القديمة من بيرل.</para>

          <figure>
            <title>استعمال الحقل <literal>Provides</literal> للحفاظ على سلامة علاقات الاعتماد بين الحزم</title>
            <mediaobject>
              <imageobject>
                <imagedata fileref="images/virtual-package.png" width="50%" />
              </imageobject>
            </mediaobject>
          </figure>

	  <para>هذه الميزة مفيدة جداً، لأنه لا يمكن أبداً التنبؤ بتقلبات التطوير، ومن المهم أن يكون هناك مجال للتكيف مع إعادة التسمية وغيرها من الاستبدالات الآلية للبرمجيات الميتة.</para>

          <sidebar>
            <title><emphasis>أساسيات</emphasis> بيرل، لغة برمجة</title>
            <indexterm><primary>بيرل</primary></indexterm>
            <indexterm><primary>CPAN</primary></indexterm>

	    <para>بيرل (Perl = Practical Extraction and Report Language) هي لغة برمجة شهيرة جدًا. لها الكثير من الوحدات الجاهزة للاستخدام التي تغطي طيفًا واسعًا من التطبيقات، والتي توزعها مخدمات CPAN (شبكة أرشيفات بيرل الشاملة، Comprehensive Perl Archive Network)، وهي شبكة عملاقة لحزم بيرل. <ulink type="block" url="http://www.perl.org/‎" />‎ <ulink dir="ltr" type="block" url="http://www.cpan.org/" />‎</para>

	    <para>بما أنها لغة مفسرة، فلا يحتاج البرنامج المكتوب بها لترجمة قبل تنفيذه. ولهذا تدعى البرامج المكتوبة بها ”سكربتات بيرل“.</para>
          </sidebar>
        </section>
        <section>
          <title>القيود السابقة</title>

	  <para>كانت الحزم الظاهرية تعاني من بعض القيود، وكان أهمها عدم وجود رقم للإصدار. بالعودة إلى مثالنا السابق، لا يمكن لنظام الحزم أن يعتبر الاعتمادية <literal dir="ltr">Depends: libdigest-md5-perl (&gt;= 1.6)</literal> مثلاً محققة أبداً، حتى مع تثبيت بيرل 5.10 — رغم أنها على الأغلب محققة فعلاً. لكن نظام الحزم لا يدرك هذا، ويفضل الخيار الأقل مخاطرة، ويفترض أن الإصدارين غير متناسبين.</para>

          <para>أزيل هذا القيد في <emphasis role="pkg">dpkg</emphasis> 1.17.11، ولم يعد له تأثير في جيسي. تستطيع الحزم إسناد رقم إصدار للحزم الظاهرية التي توفرها عبر اعتمادية مثل <literal>Provides: libdigest-md5-perl (= 1.8)</literal>.</para>
        </section>
      </section>

      <section>
        <title>استبدال الملفات: حقل <literal>Replaces</literal></title>
        <indexterm><primary>استبدال</primary></indexterm>
        <indexterm><primary><literal>Replaces</literal>، حقل ترويسة</primary></indexterm>
        <indexterm><primary>حزمة</primary><secondary>استبدال</secondary></indexterm>

	<para>يشير الحقل <literal>Replaces</literal> إلى أن الحزمة تحوي ملفات تتوفر أيضاً في حزم أخرى، لكن هذه الحزمة مخولة باستبدالها شرعاً. بدون هذا التصريح، سيخفق <command>dpkg</command>، ويعلن أنه لا يستطيع استبدال ملفات الحزمة الأخرى (تقنياً، يمكن إجبار <command>dpkg</command> على ذلك باستخدام الخيار <literal>‎--force-overwrite</literal>، لكن هذه العملية لا تعتبر عملية قياسية). هذا يسمح بالتعرف على المشاكل التي يُحتَمَل ظهورها، كما يفرض على المشرف دراسة الوضع قبل أن يقرر إضافة حقل كهذا.</para>

	<para>يُبرَّر استخدام هذا الحقل عند تغيير اسم الحزمة أو عند تضمين حزمة في حزمة أخرى. كما يحدث هذا أيضاً عندما يقرر المشرف توزيع الملفات الناتجة عن حزمة مصدرية واحدة بشكل متفاوت بين عدة حزم ثنائية متنوعة: لم يعد الملف المستبدل ينتمي للحزمة القديمة، بل فقط للحزمة الجديدة.</para>

	<para>إذا استبدلت جميع ملفات إحدى الحزم المثبتة، تعتبر الحزمة مزالة. أخيراً، يشجع هذا الحقل <command>dpkg</command> على إزالة الحزمة المستبدَلَة عند حدوث تضارب.</para>

        <sidebar id="sidebar.debtags">
          <title><emphasis>التعمق أكثر</emphasis> حقل <literal>Tag</literal></title>

	  <para>في مثال <emphasis role="pkg">apt</emphasis> السابق، يمكننا أن نرى حقلاً لم نشرحه بعد، وهو الحقل <literal>Tag</literal>. لا يُعرِّف هذا الحقل علاقة بين الحزم، بل يُستخدَم ببساطة لتصنيف الحزمة ضمن فئات حسب الموضوع. لقد كان تصنيف الحزم وفقاً لعدد من المعايير (نوع الواجهة، اللغة البرمجية، مجال التطبيق، الخ) متاحاً منذ زمن طويل. ورغم ذلك، هناك حزم ليس لها وسوم دقيقة، كما أن هذا التصنيف غير مدعوم في جميع أدوات دبيان؛ تعرض <command>aptitude</command> هذه الوسوم، وتسمح باستخدامها كمعايير للبحث. بالنسبة لمن ينفرون من معايير البحث في <command>aptitude</command>، يمكنهم التوجه للموقع التالي الذي يسمح بتصفح قاعدة بيانات هذه الوسوم: <ulink type="block" url="http://debtags.alioth.debian.org/" />‎</para>
        </sidebar>
      </section>
    </section>
    <section id="sect.configuration-scripts">
      <title>سكربتات الإعداد</title>
      <indexterm><primary><filename>postinst</filename></primary></indexterm>
      <indexterm><primary><filename>preinst</filename></primary></indexterm>
      <indexterm><primary><filename>postrm</filename></primary></indexterm>
      <indexterm><primary><filename>prerm</filename></primary></indexterm>
      <indexterm><primary><filename>control.tar.gz</filename></primary></indexterm>

      <para>بالإضافة إلى ملف <filename>control</filename>، قد يحتوي أرشيف <filename>control.tar.gz</filename> الموجود في كل حزمة دبيان على عدد من السكربتات، يستدعيها <command>dpkg</command> في مراحل مختلفة من معالجة الحزمة. تصف سياسة دبيان الحالات المحتملة بالتفصيل، مُحدِّدَةً السكربتات المستدعاة والمتغيرات التي تستقبلها. هذه التسلسلات قد تكون معقدة، لأنه إذا فشل تنفيذ أحد السكربتات، سيحاول <command>dpkg</command> العودة إلى حالة مُرضِيَة عبر إلغاء عملية التثبيت أو الإزالة الجارية (طالما كان ذلك ممكناً).</para>

      <sidebar>
        <title><emphasis>التعمق أكثر</emphasis> قاعدة بيانات <command>dpkg</command></title>
        <indexterm><primary><filename>/var/lib/dpkg/</filename></primary></indexterm>
	<indexterm><primary>dpkg</primary><secondary>قاعدة بيانات</secondary></indexterm>

	<para>تُخزَّن جميع سكربتات الإعداد الخاصة بالحزم المثبتة في المجلد <filename>/var/lib/dpkg/info/</filename>، بشكل ملف مسبوق باسم الحزمة. يحوي هذا المجلد أيضًا على ملف امتداده <filename dir="ltr">.list</filename> لكل حزمة، يحوي قائمة بالملفات التي تنتمي لتلك الحزمة.</para>

	<para>يحتوي الملف <filename dir="ltr">/var/lib/dpkg/status</filename> على سلسلة من كتل البيانات (بتنسيق ترويسات البريد الشهير، RFC 2822) تصف حالة كل حزمة. كما تُنسَخ المعلومات من ملف <filename>control</filename> الخاص بالحزمة المثبتة هناك أيضًا.</para>
      </sidebar>

      <para>عموماً، يُنفَّذ السكربت <filename>preinst</filename> قبل تثبيت الحزمة، في حين يتبعه <filename>postinst</filename>. كذلك، يُستدعى <filename>prerm</filename> قبل إزالة الحزمة و <filename>postrm</filename> بعد ذلك. تحديث الحزمة يكافئ إزالة النسخة القديمة وتثبيت الجديدة. لا يمكن وصف جميع الحالات الممكنة هنا، لكننا سنناقش الحالتين الأكثر شيوعاً: التثبيت أو التحديث، والإزالة.</para>

      <sidebar>
        <title><emphasis>تحذير</emphasis> أسماء السكربتات الرمزية</title>

	<para>الأحداث الموصوفة في هذا القسم تدعو السكربتات بأسماء خاصة، مثل <command>old-prerm</command> أو <command>new-postinst</command>. هذه تعني السكربت <command>prerm</command> الموجود في النسخة القديمة من الحزمة (المثبتة قبل التحديث) والسكربت <command>postinst</command> الموجود في النسخة الجديدة (المثبتة بعد التحديث).</para>
      </sidebar>

      <sidebar>
        <title><emphasis>تلميح</emphasis> مخططات الحالة</title>

	<para>صنع Manoj Srivastava مخططات تشرح كيف يستدعي <command>dpkg</command> سكربتات الإعداد. طَوَّر مشروع نساء دبيان (Debian Women) مخططات مشابهة أيضًا؛ وهي أيسر للفهم قليلاً، لكنها أقل اكتمالاً. <ulink type="block" url="https://people.debian.org/~srivasta/MaintainerScripts.html" /> <ulink type="block" url="https://wiki.debian.org/MaintainerScripts" /></para>
      </sidebar>
      <section>
        <title>التثبيت والتحديث</title>
        <indexterm><primary>dpkg</primary><secondary>عمل داخلي</secondary></indexterm>

	<para>إليك ما يحدث خلال التثبيت (أو التحديث):</para>
        <orderedlist>
          <listitem>
	    <para>بالنسبة للتحديث، يستدعي <command>dpkg</command> الأمر <command>old-prerm upgrade <replaceable>new-version</replaceable></command>.</para>
          </listitem>
          <listitem>
	    <para>في التحديث أيضاً، ينفذ <command>dpkg</command> بعدها <command>new-preinst upgrade <replaceable>old-version</replaceable></command>؛ أما بالنسبة للتثبيت للمرة الأولى فيستدعي <command>new-preinst install</command>. قد يضيف <command>dpkg</command> الإصدار القديم إلى ذيل البارامترات إذا كانت الحزمة مثبتة ومزالة من قبل (لكن لم يتم تطهيرها، أي أن ملفات إعداداتها لا تزال موجودة).</para>
          </listitem>
          <listitem>
	    <para>بعدها يفك الضغط عن ملفات الحزمة الجديدة. تستبدل الملفات الموجودة سابقاً، لكن مع الاحتفاظ بنسخة احتياطية مؤقتة.</para>
          </listitem>
          <listitem>
	    <para>بالنسبة للتحديث، يستدعي <command>dpkg</command> الأمر <command>old-postrm upgrade <replaceable>new-version</replaceable></command>.</para>
          </listitem>
          <listitem>
	    <para>يُحدِّث <command>dpkg</command> جميع البيانات الداخلية (لائحة الملفات، سكربتات الإعداد، الخ) ويحذف النسخ الاحتياطية للملفات المستبدلة. هذه هي نقطة اللاعودة: عند هذه اللحظة لا يعود <command>dpkg</command> قادراً على الوصول إلى جميع العناصر اللازمة للرجوع إلى الحالة السابقة.</para>
          </listitem>
          <listitem>
	    <para>بعدها يُحدِّث <command>dpkg</command> ملفات الضبط، ويطلب من المستخدم اتخاذ قرار إذا لم يستطع إدارة هذه المهمة آلياً. تفاصيل هذه العملية مشروحة في <xref linkend="sect.conffiles" />.</para>
          </listitem>
          <listitem>
	    <para>أخيراً، يضبط <command>dpkg</command> الحزمة بتنفيذ <command>new-postinst configure <replaceable>last-version-configured</replaceable></command>.</para>
          </listitem>
        </orderedlist>
      </section>
      <section>
        <title>إزالة حزمة</title>

	<para>إليك ما يحدث أثناء إزالة حزمة:</para>
        <orderedlist>
          <listitem>
	    <para>يستدعي <command>dpkg</command> الأمر <command>prerm remove</command>.</para>
          </listitem>
          <listitem>
	    <para>يزيل <command>dpkg</command> جميع ملفات الحزمة، عدا ملفات الضبط وسكربتات الإعداد.</para>
          </listitem>
          <listitem>
	    <para>ينفذ <command>dpkg</command> الأمر <command>postrm remove</command>. تُحذَف جميع سكربتات الإعداد، عدا <filename>postrm</filename>. إذا لم يطلب المستخدم خيار ”التطهير“، تنتهي العملية هنا.</para>
          </listitem>
          <listitem>
	    <para>لتطهير الحزمة بالكامل (يطلب هذا الأمر بالشكل <command>dpkg --purge</command> أو <command>dpkg -P</command>)، تُحذَف ملفات الإعدادات أيضاً، بالإضافة لعدد معين من النسخ (<filename>dpkg-tmp.*</filename>، <filename>‏dpkg-old.*</filename>، <filename>‏dpkg-new.*</filename>) والملفات المؤقتة؛ بعدها ينفذ <command>dpkg</command> الأمر <command>postrm purge</command>.</para>
          </listitem>
        </orderedlist>

        <sidebar>
          <title><emphasis>مصطلحات</emphasis> التطهير، إزالة الحزمة بالكامل</title>
          <indexterm><primary>تطهير حزمة</primary></indexterm>

	  <para>عند إزالة حزمة دبيان، تبقى ملفات الإعداد في سبيل تسهيل إعادة التثبيت في المستقبل. كما يُحتَفظ عادةً بالبيانات التي تولدها الخِدْمات (مثل محتويات مجلد مخدم LDAP، أو محتويات قاعدة بيانات مخدم SQL).</para>

	  <para>لإزالة جميع البيانات المتعلقة بالحزمة، يجب ”تطهير“ الحزمة بالأمر <command>dpkg -P <replaceable>package</replaceable></command> أو الأمر <command>apt-get remove --purge <replaceable>package</replaceable></command> أو <command>aptitude purge <replaceable>package</replaceable></command>.</para>

	  <para>يجب عدم الاستخفاف عند استعمال أمر التطهير لأن إزالة هذه البيانات نهائية.</para>
        </sidebar>

        <indexterm><primary><filename>config</filename>، سكربت <command>debconf</command></primary></indexterm>

	<para>هناك سكربت <filename>config</filename> يكمل السكربتات الأربعة المذكورة سابقاً، توفره الحزم التي تعتمد على <command>debconf</command> للحصول على معلومات من المستخدم لضبط الحزمة. يُحدِّد هذا السكربت أثناء التثبيت الأسئلة التي تطرحها <command>debconf</command> بالتفصيل. تُسجَّل الإجابات في قاعدة بيانات <command>debconf</command> للرجوع إليها مستقبلاً. تستدعي <command>apt</command> هذا السكربت عموماً قبل تثبيت الحزم واحدة تلو الأخرى وذلك لتجميع كل الأسئلة وطرحها جميعاً على المستخدم في بداية العملية. يمكن بعدها أن تستفيد سكربتات ما قبل وما بعد التثبيت من هذه المعلومات حتى تتبع رغبات المستخدم.</para>

        <sidebar>
          <title><emphasis>أدوات</emphasis> <command>debconf</command></title>
          <indexterm><primary><command>debconf</command></primary></indexterm>

	  <para>لقد أُنشِئَت <command>debconf</command> لحل مشكلة متكررة في دبيان. لقد كانت الحزم التي لا يمكن أن تعمل دون حد أدنى من الإعداد تطرح الأسئلة باستدعاء الأمرين <command>echo</command> و <command>read</command> في سكربتات <filename>postinst</filename> (وغيره من السكربتات المشابهة). لكن هذا يعني أيضاً أن المستخدم أثناء عمليات التثبيت أو التحديث الكبيرة يجب أن يبقى مع الحاسوب للإجابة على الأسئلة المتنوعة التي قد تظهر في أي لحظة. لقد تخلصنا تماماً تقريباً من هذه التفاعلات اليدوية بعد استخدام الأداة <command>debconf</command>.</para>

	  <para>تتمتع <command>debconf</command> بالعديد من المزايا المثيرة: فهي تفرض على المطور تحديد التفاعلات مع المستخدم؛ وتسمح بترجمة جميع النصوص المعروضة للمستخدم (تُخزَّن جميع الترجمات في ملف <filename>templates</filename> الذي يُعرَّف التفاعلات)؛ ولها واجهات مختلفة لعرض الأسئلة على المستخدم (الوضع النصي، الوضع الرسومي، الوضع غير التفاعلي)؛ كما تسمح بإنشاء قاعدة بيانات مركزية للإجابات لمشاركة الإعدادات نفسها بين عدة حواسيب... لكن أهم ميزة هي أنه يمكن الآن طرح جميع الأسئلة على المستخدم على التعاقب، قبل بدء عمليات التثبيت أو التحديث الطويلة.  يستطيع المستخدم بعدها أن ينطلق لأداء أعماله الأخرى بينما يتولى النظام عملية التثبيت وحده، دون الحاجة لبقاء المستخدم أمامه يحدِّق في الشاشة وينتظر الأسئلة.</para>
        </sidebar>
      </section>
    </section>
    <section id="sect.conffiles">
      <title>شفرات التحقق، لائحة ملفات الضبط</title>
      <indexterm><primary><filename>md5sums</filename></primary></indexterm>
      <indexterm><primary><filename>conffiles</filename></primary></indexterm>
      <indexterm><primary>شفرات تحقق</primary></indexterm>
      <indexterm><primary>ملفات</primary><secondary>ملفات الإعدادات</secondary></indexterm>
      <indexterm><primary>إعدادات</primary><secondary>ملفات</secondary></indexterm>

      <para>قد يحوي أرشيف <filename>control.tar.gz</filename> في حزمة دبيان ملفات مهمة أخرى بالإضافة لسكربتات الإعداد وبيانات التحكم المذكورة في الأقسام السابقة. أولها، <filename>md5sums</filename>، يحوي شفرات MD5 لجميع ملفات الحزمة. فائدته الأساسية هي أنه يسمح للأداة <command>dpkg --verify</command> (التي سندرسها في <xref linkend="sect.dpkg-verify" />) للتأكد أن هذه الملفات لم تُعدَّل منذ تثبيتها. لاحظ أنه عند عدم وجود هذا الملف، سوف يولده dpkg ديناميكياً أثناء عملية التثبيت (ويخزنه في قاعدة بيانات dpkg مثل ملفات التحكم الأخرى).</para>

      <para>يسرد الملف <filename>conffiles</filename> ملفات الحزمة التي يجب معاملتها كملفات ضبط. قد يُعدِّل مدير النظام ملفات الضبط، وسوف يحاول <command>dpkg</command> الحفاظ على هذه التعديلات عند تحديث الحزمة.</para>

      <para>في الواقع، يتصرف <command>dpkg</command> بأذكى ما يمكن في هذه الحالات: إذا لم يتغيَّر ملف الإعدادات القياسي بين النسختين، لا يفعل أي شيء. لكن إذا تَغيَّر الملف، سيحاول تحديث هذا الملف. هناك احتمالين هنا: إما أن مدير النظام لم يلمس ملف الإعداد هذا، وفي تلك الحالة يُثبِّت <command>dpkg</command> النسخة الجديدة آلياً؛ أو أن الملف قد عُدِّل، وفي تلك الحالة يسأل <command>dpkg</command> مدير النظام عن النسخة التي يريد أن يستخدمها (النسخة القديمة المعدلة، أو الجديدة الموفرة مع الحزمة). حتى يساعد <command>dpkg</command> في اتخاذ هذا القرار، يعرض عليك إظهار ”<command>diff</command>“ يُبيِّنُ الاختلاف بين النسختين. إذا اختار المستخدم إبقاء النسخة القديمة، سوف تُخزَّن الجديدة في نفس المكان في ملف له اللاحقة <filename>‎.dpkg-dist</filename>. أما إذا اختار المستخدم النسخة الجديدة، تحفظ النسخة القديمة في ملف له اللاحقة <filename>‎.dpkg-old</filename>. هناك خيار آخر متاح وهو مقاطعة <command>dpkg</command> مؤقتاً لتحرير الملف ومحاولة استرجاع التعديلات المناسبة (التي تم التعرف عليها باستخدام <command>diff</command>).</para>

      <sidebar id="sidebar.questions-conffiles">
        <title><emphasis>التعمق أكثر</emphasis> تفادي أسئلة المتعلقة بملفات الضبط</title>

	<para>يعالج <command>dpkg</command> تحديث ملفات الضبط، لكنه يقطع عمله بانتظام أثناء هذه العملية، حتى يطلب مدخلات من مدير النظام. هذا لا يناسب الذين يبحثون عن تشغيل التحديثات بطريقة غير تفاعلية. لذلك يوفر هذا البرنامج خيارات تسمح للنظام بالاستجابة آلياً وفق منطق ثابت: يحفظ الخيار <command>‎--force-confold</command> النسخة القديمة من الملف؛ أما <command>‎--force-confnew</command> سيستخدم النسخة الجديدة منه (يلتزم البرنامج بهذه الخيارات حتى لو لم يكن مدير النظام قد عدَّل الملف، وهذا نادراً ما يكون الهدف المقصود). إذا أضيف الخيار <command>‎--force-confdef</command> فسوف يتخذ <command>dpkg</command> القرار بنفسه إذا كان ذلك ممكناً (أي عندما لا يكون ملف الإعدادات الأصلي معدلاً)، ويلتزم بالخيار <command>‎--force-confnew</command> أو <command>‎--force-confold</command> في الحالات الأخرى.</para>

	<para>هذه الخيارات تعمل مع <command>dpkg</command>، لكن مدير النظام سيتعامل مباشرة مع <command>aptitude</command> أو <command>apt-get</command> في معظم الأحيان. بالتالي، يجب أن تعرف الصيغة المستخدمة لتحديد الخيارات بحيث يتم تمريرها إلى الأمر <command>dpkg</command> (الصيغة المستخدمة متشابهة جداً في البرنامجين).</para>

        <screen>
<computeroutput># </computeroutput><userinput>apt -o DPkg::options::="--force-confdef" -o DPkg::options::="--force-confold" full-upgrade</userinput></screen>

	<para>يمكن تخزين هذه الخيارات مباشرة في إعدادات <command>apt</command>. لعمل ذلك، أضف السطر التالي إلى الملف <filename>‎/etc/apt/apt.conf.d/local</filename> ببساطة:</para>
        <informalexample>
          <programlisting>
DPkg::options { "--force-confdef"; "--force-confold"; }
</programlisting>
        </informalexample>

	<para>إن تضمين هذا الخيار في ملف الإعداد يعني أنه سيستخدم أيضاً مع الواجهات الرسومية مثل <command>aptitude</command>.</para>
      </sidebar>

      <sidebar id="sidebar.questions-conffiles-bis">
        <title><emphasis>التعمق أكثر</emphasis> إجبار dpkg على طرح أسئلة عن ملفات الإعداد</title>

	<para>يطلب الخيار <command>‎--force-confask</command> من <command>dpkg</command> أن يعرض الأسئلة المتعلقة بملفات الإعداد، حتى في الحالات التي لا تكون فيها هذه الأسئلة ضرورية. إذن، عند إعادة تثبيت حزمة مع هذا الخيار، سوف يسأل <command>dpkg</command> الأسئلة ثانية لجميع ملفات الإعداد التي عدَّلها مدير النظام. هذا مفيد جداً، خصوصاً بالنسبة لإعادة تثبيت ملف الإعداد الأصلي إذا حُذِف ولم تكن هناك نسخة أخرى متوفرة: إعادة التثبيت العادية لن تفيد، لأن <command>dpkg</command> يعتبر إزالة الملفات نوع مشروع من التعديل عليها، وبالتالي لن يُثبِّت ملف الإعداد المطلوب.</para>
      </sidebar>
    </section>
  </section>
  <section id="sect.source-package-structure">
    <title>بنية الحزمة المصدرية</title>
    <indexterm><primary>حزمة</primary><secondary>حزمة مصدرية</secondary></indexterm>
    <indexterm><primary>مصدر</primary><secondary>حزمة</secondary></indexterm>
    <section>
      <title>الصيغة</title>
      <indexterm><primary>ملف DSC</primary></indexterm>
      <indexterm><primary>ملف <filename>diff.gz</filename></primary></indexterm>
      <indexterm><primary>ملف <filename>debian.tar.gz</filename></primary></indexterm>
      <indexterm><primary>ملف <filename>orig.tar.gz</filename></primary></indexterm>

      <para>تتألف الحزمة المصدرية عادة من ثلاثة ملفات، ملف <filename>‎.dsc</filename>، وملف <filename>‎.orig.tar.gz</filename>، و <filename>‎.debian.tar.gz</filename> (أو <filename>‎.diff.gz</filename>). تسمح هذه الملفات بإنشاء حزمة ثنائية (ملف <filename>‎.deb</filename> الذي تحدثنا عنه) من الشفرة المصدرية للبرنامج، المكتوبة بإحدى اللغات البرمجية.</para>

      <para>ملف <filename>‎.dsc</filename> (‏Debian Source Control) هو ملف نصي يحوي ترويسة RFC2822 (مثل ملف <filename>control</filename> الذي درسناه في <xref linkend="sect.control" />) الذي يصف الحزمة المصدرية ويحدد الملفات الأخرى التي تنتمي إليها. يوقّع المشرف على الحزمة هذا الملف، لضمان سلامته. انظر <xref linkend="sect.package-authentication" /> لمزيد من التفاصيل على هذا الموضوع.</para>

      <example>
        <title>ملف <filename>‎.dsc</filename></title>

        <programlisting>
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

Format: 3.0 (quilt)
Source: zim
Binary: zim
Architecture: all
Version: 0.62-3
Maintainer: Emfox Zhou &lt;emfox@debian.org&gt;
Uploaders: Raphaël Hertzog &lt;hertzog@debian.org&gt;
Homepage: http://zim-wiki.org
Standards-Version: 3.9.6
Vcs-Browser: http://anonscm.debian.org/gitweb/?p=collab-maint/zim.git
Vcs-Git: git://anonscm.debian.org/collab-maint/zim.git
Build-Depends: debhelper (&gt;= 9), xdg-utils, python (&gt;= 2.6.6-3~), libgtk2.0-0 (&gt;= 2.6), python-gtk2, python-xdg
Package-List:
 zim deb x11 optional arch=all
Checksums-Sha1:
 ad8de170826682323c10195b65b9f1243fd75637 1772246 zim_0.62.orig.tar.gz
 a4f70d6f7fb404022c9cc4870a4e62ea3ca08388 14768 zim_0.62-3.debian.tar.xz
Checksums-Sha256:
 19d62aebd2c1a92d84d80720c6c1dcdb779c39a2120468fed01b7f252511bdc2 1772246 zim_0.62.orig.tar.gz
 fc2e827e83897d5e33f152f124802c46c3c01c5158b75a8275a27833f1f6f1de 14768 zim_0.62-3.debian.tar.xz
Files:
 43419efba07f7086168442e3d698287a 1772246 zim_0.62.orig.tar.gz
 725a69663a6c2961f07673ae541298e4 14768 zim_0.62-3.debian.tar.xz

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2
Comment: Signed by Raphael Hertzog

iQEcBAEBCAAGBQJUR2jqAAoJEAOIHavrwpq5WFcH/RsdzCHc1oXXxHitU23hEqMj
T6ok29M1UFDJDowMXW75jQ1nT4WPUtvEGygkCHeoO/PvjEvB0sjU8GQlX+N9ddSB
aHfqfAYmVhADNGxrXQT5inZXUa8qGeeq2Sqf6YcWtsnuD56lDbvxkyf/XYopoIEl
oltfl05z/AI+vYsW482YrCz0fxNAKAvkyuPhDebYI8jnKWeAANoqmKpsNc/HYyvT
+ZiA5o57OiGdOKT6XGy3/FiF3dkHiRY8lXW7xdr1BbIgulwl9UmiUNwuxwOYbQO7
edtjiTJqOaFUA0x1zB/XGv5tHr1MjP8naT+kfVoVHTOox51CDbeu5D3DZY4imcY=
=Wtoa
-----END PGP SIGNATURE-----</programlisting>
      </example>

      <indexterm><primary><literal>Build-Depends</literal>، حقل ترويسة</primary></indexterm>

      <para>لاحظ أن الحزمة المصدرية لها اعتماديات أيضاً (<literal>Build-Depends</literal>) تختلف تماماً عن اعتماديات الحزم الثنائية، لأن الاعتماديات هنا تُبيّن الأدوات اللازمة لترجمة البرنامج الذي تحويه وبناء حزمته الثنائية.</para>

      <sidebar>
        <title><emphasis>تحذير</emphasis> فضاءات أسماء منفصلة</title>

	<para>من المهم الانتباه هنا إلى عدم وجود نوع من الارتباط الإلزامي بين اسم الحزمة المصدرية والحزمة (أو الحزم) الثنائية التي تنتج عنها. فهم هذه القضية سهل عند معرفة أن الحزمة المصدرية قد تولِّد عدة حزم ثنائية. لهذا يحوي الملف <filename>‎.dsc</filename> الحقلين <literal>Source</literal> و <literal>Binary</literal> للتصريح عن اسم الحزمة المصدرية وتخزين قائمة الحزم الثنائية التي تنتج عنها.</para>
      </sidebar>

      <sidebar>
        <title><emphasis>ثقافة</emphasis> سبب التقسيم لعدة حزم</title>

	<para>في كثير من الأوقات، يمكن أن تولّد الحزمة المصدرية (لبرمجية معينة) عدة حزم ثنائية. سبب التقسيم هو إمكانية استخدام (أجزاء من) البرنامج في مجالات مختلفة. خذ المكتبات المشتركة على سبيل المثال، يمكن تثبيتها لتشغيل برنامج آخر (مثل <emphasis role="pkg">libc6</emphasis>)، أو يمكن تثبيتها لتطوير برنامج جديد (عندها ستستخدم الحزمة <emphasis role="pkg">libc6-dev</emphasis>). كما أن القضية نفسها تنطبق على خدمات المخدم/عميل التي نريد فيها تثبيت جزء المخدم على جهاز ما وقسم العميل على جهاز آخر (هذه هي حالة <emphasis role="pkg">openssh-server</emphasis> و <emphasis role="pkg">openssh-client</emphasis>، مثلاً).</para>

	<para>وفي أوقات كثيرة أيضاً، تُقدَّم الوثائق في حزمة خاصة: قد يثبتها المستخدم بشكل مستقل عن البرنامج، وقد يختار إزالتها في أي وقت لتحرير مساحة القرص الصلب. بالإضافة لذلك، هذا يحفظ المساحة التخزينية على مرايا دبيان، بما أن حزم الوثائق مشتركة بين جميع المعماريات (بدلاً من تكرار الوثائق في حزم كل معمارية من المعماريات).</para>
      </sidebar>

      <sidebar>
        <title><emphasis>منظور</emphasis> الصيغ المختلفة للحزم المصدرية</title>

	<para>لقد كان هناك صيغة وحيدة للحزم المصدرية في الأصل. هي الصيغة <literal>1.0</literal>، التي تجمع أرشيف <filename>‎.orig.tar.gz</filename> مع رقعة ”الدَبيَنَـة debianization“‏ <filename>‎.diff.gz</filename> (هناك أيضاً صيغة بديلة، تتألف من أرشيف <filename>‎.tar.gz</filename> وحيد، الذي يُستَخدَم آلياً إذا لم يكن هناك <filename>‎.orig.tar.gz</filename> متوفر).</para>

	<para>لكن منذ دبيان <emphasis role="distribution">سكويز</emphasis>، يستطيع المطورون استخدام الصيغ الجديدة التي تعالج العديد من مشكلات الصيغة العتيقة. تستطيع الصيغة <literal>3.0 (quilt)</literal> أن تجمع عدة أرشيفات منبعية (upstream) في حزمة مصدرية واحدة: بالإضافة إلى الأرشيف المعتاد <filename>‎.orig.tar.gz</filename>، يمكن تضمين أرشيفات <filename>‎.orig-<replaceable>component</replaceable>.tar.gz</filename> متممة. يفيد هذا إذا كان البرنامج الأصلي يُوزَّع في عدة مكونات منبعية لكن هناك رغبة بتقديم حزمة مصدرية واحدة له. كما يمكن ضغط هذه الأرشيفات باستخدام <command>bzip2</command> أو <command>xz</command> بدلاً من <command>gzip</command>، وذلك لحفظ المساحة التخزينية والموارد الشبكية. أخيراً، استبدلت الرقعة الوحيدة <filename>‎.diff.gz</filename> بالأرشيف <filename>‎.debian.tar.gz</filename> الذي يحوي تعليمات الترجمة ومجموعة من الترقيعات للبرنامج المنبعي يضيفها المشرف على الحزمة. تُحفظ هذه الترقيعات الأخيرة بصيغة متوافقة مع <command>quilt</command> – وهي أداة تُسهِّل إدارة سلسلة من الترقيعات.</para>
      </sidebar>

      <para>الملف <filename>‎.orig.tar.gz</filename> هو أرشيف يحوي الشفرة المصدرية بالشكل الذي يقدمه المطور الأصلي. يُطلَب من مشرفي حزم دبيان عدم تعديل هذا الأرشيف حتى يمكن التحقق بسهولة من مصدر الملف وسلامته (بمقارنة بسيطة بين شفرات التحقق) ولاحترام رغبات بعض المطورين.</para>

      <para>يحوي <filename>‎.debian.tar.gz</filename> جميع التعديلات التي يجريها مشرف دبيان، خصوصاً إضافة مجلد <filename>debian</filename> الذي يحوي التعليمات الواجب تنفيذها لبناء حزمة دبيان.</para>

      <sidebar>
        <title><emphasis>أدوات</emphasis> فك الضغط عن حزمة مصدرية</title>
        <indexterm><primary><command>dpkg-source</command></primary></indexterm>
	<indexterm><primary>فك الضغط، حزمة مصدرية</primary></indexterm>
	<indexterm><primary>فك الضغط، حزمة مصدرية</primary></indexterm>
	<indexterm><primary>فك ضغط</primary><secondary>حزمة مصدرية</secondary></indexterm>

	<para>إذا كان لديك حزمة مصدرية، يمكنك استخدام الأمر <command>dpkg-source</command> ( من الحزمة <emphasis role="pkg">dpkg-dev</emphasis>) لفك الضغط عنها:</para>

        <screen><computeroutput>$ </computeroutput><userinput>dpkg-source -x package_0.7-1.dsc</userinput>
</screen>

	<para>يمكنك أيضاً استخدام <command>apt-get</command> لتنزيل الحزمة المصدرية وفك الضغط عنها مباشرة. لكن هذا يحتاج لإضافة سطور <literal>deb-src</literal> المناسبة في الملف <filename>‎/etc/apt/sources.list</filename> (لمزيد من التفاصيل، انظر <xref linkend="sect.apt-sources.list" />). تستخدم هذه السطور لإضافة ”مصادر“ الحزم المصدرية (أي المخدمات التي تستضيف مجموعات من الحزم المصدرية).</para>

        <screen><computeroutput>$ </computeroutput><userinput>apt-get source <replaceable>package</replaceable></userinput>
</screen>
      </sidebar>
    </section>
    <section>
      <title>الاستخدام في دبيان</title>

      <para>الحزم المصدرية هي أساس كل شيء في دبيان. جميع الحزم الدبيانية تنشأ من حزم مصدرية، وكل تعديل في حزمة دبيانية هو نتيجة تعديل في الحزمة المصدرية. يتعامل مشرفو دبيان مع الحزم المصدرية، لكن مع معرفة تبعات تعديلاتهم على الحزم الثنائية. فثمرات جهودهم إذن تراها في الحزم المصدرية التي توفرها دبيان: يمكنك الرجوع لها ولكل شيء ينتج عنها بسهولة.</para>

      <para>عند وصول نسخة جديدة من الحزمة (حزمة مصدرية وحزمة ثنائية واحدة أو أكثر) إلى مخدم دبيان، الحزمة المصدرية هي الأهم. وفعلاً، سوف تعمل شبكة من الأجهزة ذات المعماريات المختلفة على ترجمتها للمعماريات المتنوعة التي تدعمها دبيان. إن إرسال المطور لحزمة ثنائية واحدة أو أكثر لمعمارية معينة (عادة i386 أو amd64) غير مهم نسبياً، لأنه يمكن توليد هذه الحزم آلياً أيضاً.</para>
    </section>
  </section>
  <section id="sect.manipulating-packages-with-dpkg">
    <title>معالجة الحزم باستخدام <command>dpkg</command></title>
    <indexterm><primary><command>dpkg</command></primary></indexterm>

    <para><command>dpkg</command> هو الأمر الأساسي لمعالجة حزم دبيان في النظام. إذا كنت تملك حزم <filename>‎.deb</filename>، فإن <command>dpkg</command> هو المسؤول عن تثبيتها أو تحليل محتوياتها. لكن رؤية هذا البرنامج لعالم دبيان جزئية: فهو يعرف ما هو مُثبَّت على النظام، وما يُعطَى له في سطر الأوامر، لكن لا يعرف شيئاً عن الحزم المتوفرة الأخرى. ولذلك فهو يفشل إذا لم تكن الاعتماديات محققة. أما الأدوات الأخرى مثل <command>apt</command>، من ناحية أخرى، سوف تنشئ قائمة بالاعتماديات لتثبيت كل شيء آلياً قدر المستطاع.</para>

    <sidebar>
      <title><emphasis>ملاحظة</emphasis> <command>dpkg</command> أو <command>apt</command>؟</title>

      <para>يجب اعتبار <command>dpkg</command> أداة نظام (backend)، و <command>apt</command> كأداة أقرب للمستخدم، تتجاوز قيود الأداة الأولى. تعمل هذه الأدوات معاً، ولكل منها خصوصياتها، وتتناسب مع مهام محددة.</para>
    </sidebar>
    <section>
      <title>تثبيت الحزم</title>
      <indexterm><primary>تثبيت</primary><secondary>تثبيت حزمة</secondary></indexterm>
      <indexterm><primary>حزمة</primary><secondary>تثبيت</secondary></indexterm>

      <para><command>dpkg</command> هي، وقبل كل شيء، أداة لتثبيت حزم دبيان المتوفرة مسبقاً (لأنها لا تنزل أي شيء من الشبكة). لتثبيت حزمة، نستخدم الخيار <literal>‎-i</literal> أو <literal>‎--install</literal>.</para>

      <example>
        <title>تثبيت حزمة باستخدام <command>dpkg</command></title>

        <screen role="scale">
<computeroutput># </computeroutput><userinput>dpkg -i man-db_2.7.0.2-5_amd64.deb</userinput>
<computeroutput>(Reading database ... 86425 files and directories currently installed.)
Preparing to unpack man-db_2.7.0.2-5_amd64.deb ...
Unpacking man-db (2.7.0.2-5) over (2.7.0.2-4) ...
Setting up man-db (2.7.0.2-5) ...
Updating database of manual pages ...
Processing triggers for mime-support (3.58) ...</computeroutput></screen>
      </example>

      <para>يمكننا أن نرى الخطوات المختلفة التي تجريها <command>dpkg</command>؛ وبذلك نعلم عند أي نقطة حدث الخطأ في حال حدوثه. يمكن أيضاً إجراء التثبيت على مرحلتين: أولاً فك الضغط، بعدها الإعداد. تستفيد <command>apt-get</command> من هذه النقطة، لتقليل عدد استدعاءات <command>dpkg</command> (بما أن كل استدعاء له كلفة، بسبب تحميل قاعدة البيانات إلى الذاكرة، خصوصاً لائحة الملفات المثبتة على النظام).</para>

      <example>
        <title>فك الضغط والإعداد على مرحلتين</title>

        <screen role="scale">
<computeroutput># </computeroutput><userinput>dpkg --unpack man-db_2.7.0.2-5_amd64.deb</userinput>
<computeroutput>(Reading database ... 86425 files and directories currently installed.)
Preparing to unpack man-db_2.7.0.2-5_amd64.deb ...
Unpacking man-db (2.7.0.2-5) over (2.7.0.2-5) ...
Processing triggers for mime-support (3.58) ...
# </computeroutput><userinput>dpkg --configure man-db</userinput>
<computeroutput>Setting up man-db (2.7.0.2-5) ...
Updating database of manual pages ...
</computeroutput></screen>
      </example>
      <indexterm><primary>حزمة</primary><secondary>فك الضغط</secondary></indexterm>
      <indexterm><primary>فك ضغط</primary><secondary>حزمة ثنائية</secondary></indexterm>

      <para>أحياناً يخفق <command>dpkg</command> في تثبيت الحزمة ويعيد خطأ؛ إذا طلب المستخدم منه تجاهل هذا الخطأ، سوف يصدر تحذيراً فقط؛ لهذا السبب تجد خيارات <literal>‎--force-*‎</literal>‎ المختلفة. استدعاء الأمر <command>dpkg --force-help</command>، أو وثائق هذا الأمر، يعطيك قائمة كاملة بهذه الخيارات. أكثر الأخطاء تكراراً، والذي سيواجهك عاجلاً أو آجلاً، هو تضارب الملفات. عندما تحوي الحزمة ملفاً ثبّتته حزمة أخرى من قبل، يرفض <command>dpkg</command> تثبيت الحزمة. في تلك الحالة تظهر الرسائل التالية:</para>

      <screen>
<computeroutput>Unpacking libgdm (from .../libgdm_3.8.3-2_amd64.deb) ...
dpkg: error processing /var/cache/apt/archives/libgdm_3.8.3-2_amd64.deb (--unpack):
 trying to overwrite '/usr/bin/gdmflexiserver', which is also in package gdm3 3.4.1-9</computeroutput>
</screen>

      <para>في هذه الحالة، إذا كنت تعتقد أن استبدال الملف لن يكون خطراً على استقرار النظام (وهذه هي الحال عادة)، يمكنك استخدام الخيار <literal>‎--force-overwrite</literal>، الذي يطلب من <command>dpkg</command> تجاهل هذا الخطأ واستبدال الملف.</para>

      <para>مع أن هناك العديد من خيارات <literal>‎--force-*‎</literal>‎، إلا أن <literal>‎--force-overwrite</literal> هو الوحيد الذي يُحتَمل أن يستخدم بانتظام. هذه الخيارات موجودة فقط للحالات الاستثنائية، ومن الأفضل تركها وشأنها قدر المستطاع لاحترام القواعد التي يفرضها نظام الحزم. لا تنس، وضعت هذه القواعد لضمان تناسق واستقرار النظام.</para>

      <sidebar>
        <title><emphasis>تحذير</emphasis> الاستخدام الفعال لخيارات <literal>‎--force-*‎</literal></title>
        <indexterm><primary>اعتمادية معطوبة</primary></indexterm>

	<para>إذا لم تأخذ حذرك، فقد يوصلك استخدام أحد خيارات <literal>‎--force-*‎</literal>‎ إلى نظام ترفض عائلة أوامر APT العمل فيه. في الحقيقة، تسمح بعض هذه الخيارات بتثبيت حزمة دون تلبية اعتمادياتها، أو عند وجود تضارب. النتيجة ستكون نظاماً غير متناسق من ناحية الاعتماديات، وسترفض أوامر APT تنفيذ أي عمل إلا الأعمال التي تعيد النظام إلى حالة متناسقة (مثل تثبيت الاعتماديات الناقصة أو إزالة الحزمة التي تسبب المشاكل). غالباً سيؤدي هذا لظهور رسالة تشبه التالية، التي تظهر بعد تثبيت نسخة جديدة من <emphasis role="pkg">rdesktop</emphasis> مع تجاهل اعتمادها على نسخة أحدث من <emphasis role="pkg">libc6</emphasis>:</para>

        <screen><computeroutput># </computeroutput><userinput>apt full-upgrade
</userinput><computeroutput>[...]
You might want to run 'apt-get -f install' to correct these.
The following packages have unmet dependencies:
  rdesktop: Depends: libc6 (&gt;= 2.5) but 2.3.6.ds1-13etch7 is installed
E: Unmet dependencies. Try using -f.</computeroutput></screen>

	<para>قد يختار مدير النظام الشجاع الواثق من صحة تحليلاته تجاهل اعتمادية أو تضارب ما ويستخدم خيار <literal>‎--force-*‎</literal>‎ الموافق. في هذه الحالة، إذا كان يريد أن يبقى قادراً على استخدام <command>apt</command> أو <command>aptitude</command>، عليه تحرير الملف <filename>‎/var/lib/dpkg/status</filename> لحذف أو تعديل الاعتمادية، أو التضارب، الذي اختار تجاوزه.</para>

	<para>هذا التعديل تعديل بشع، ويجب عدم استخدامه أبداً، إلا في حال الضرورة القصوى. في أغلب الأحيان، يكون الحل الأنسب هو إعادة ترجمة الحزمة التي تسبب المشكلة (انظر <xref linkend="sect.rebuilding-package" />) أو استخدام نسخة جديدة (ربما كانت مصححة) من مستودع آخر مثل <literal>stable-backports</literal> (انظر <xref linkend="sect.backports" />).</para>
      </sidebar>
    </section>
    <section>
      <title>إزالة حزمة</title>
      <indexterm><primary>إزالة حزمة</primary></indexterm>
      <indexterm><primary>تطهير حزمة</primary></indexterm>
      <indexterm><primary>حزمة</primary><secondary>إزالة</secondary></indexterm>
      <indexterm><primary>حزمة</primary><secondary>تطهير</secondary></indexterm>

      <para>استدعاء <command>dpkg</command> مع الخيار <literal>‎-r</literal> أو <literal>‎--remove</literal> متبوعاً باسم الحزمة، يزيل تلك الحزمة. لكن هذه الإزالة غير كاملة: إذا تبقى جميع ملفات الضبط وسكربتات الإعداد وملفات السجلات (سجلات النظام) وغيرها من بيانات المستخدم التي تعالجها الحزمة. بهذه الطريقة يمكن تعطيل البرنامج بسهولة عبر إزالته، ومن الممكن إعادة تثبيته بسرعة باستخدام نفس الإعدادات. أما لإزالة كل شيء متعلق بالحزمة بشكل كامل، استخدام الخيار <literal>‎-P</literal> أو <literal>‎--purge</literal>، يليه اسم الحزمة.</para>

      <example>
        <title>إزالة وتطهير الحزمة <emphasis role="pkg">debian-cd</emphasis></title>

        <screen><computeroutput># </computeroutput><userinput>dpkg -r debian-cd</userinput>
<computeroutput>(Reading database ... 97747 files and directories currently installed.)
Removing debian-cd (3.1.17) ...
# </computeroutput><userinput>dpkg -P debian-cd</userinput>
<computeroutput>(Reading database ... 97401 files and directories currently installed.)
Removing debian-cd (3.1.17) ...
Purging configuration files for debian-cd (3.1.17) ...</computeroutput></screen>
      </example>
    </section>
    <section>
      <title>الاستعلام في قاعدة بيانات <command>dpkg</command> وفحص ملفات <filename>‎.deb</filename></title>
      <indexterm><primary>حزمة</primary><secondary>حالة</secondary></indexterm>
      <indexterm><primary>حزمة</primary><secondary>قائمة الملفات</secondary></indexterm>
      <indexterm><primary>حزمة</primary><secondary>فحص المحتويات</secondary></indexterm>

      <sidebar>
        <title><emphasis>أساسيات</emphasis> صيغة الخيارات</title>

	<para>معظم الخيارات متوفرة بالنسخة ”الطويلة“ (كلمة أو أكثر، مسبوقة بشرطتين) أو نسخة ”قصيرة“ (حرف مفرد، غالبًا أول حرف من إحدى كلمات النسخة الطويلة، ويسبق بشرطة مفردة). هذا العرف منتشر جدًا لدرجة أنه أحد معايير POSIX.</para>
      </sidebar>

      <para>قبل ختام هذا القسم، سوف ندرس خيارات <command>dpkg</command> التي تستعلم عن المعلومات في قاعدة بياناته الداخلية. سوف نأخذ أولاً الخيارات الطويلة وبعدها الخيارات القصيرة المقابلة لها (التي ستأخذ نفس المتغيرات). سوف نذكر <literal>‎--listfiles <replaceable>package</replaceable></literal> (أو <literal>‎-L</literal>)، الذي يذكر الملفات التي ثبتتها الحزمة؛ <literal>‎--search <replaceable>file</replaceable></literal> (أو <literal>‎-S</literal>)، الذي يبحث عن الحزمة (أو الحزم) التي تحوي الملف؛ <literal>‎--status <replaceable>package</replaceable></literal> (أو <literal>‎-s</literal>)، الذي يعرض ترويسات الحزمة المثبتة؛ <literal>‎--list</literal> (أو <literal>‎-l</literal>)، الذي يعرض قائمة بالحزم المعروفة للنظام وحالة تثبيتها؛ <literal>‎--contents <replaceable>file.deb</replaceable></literal> (أو <literal>‎-c</literal>)، الذي يسرد الملفات في حزمة دبيان المحددة، <literal>‎--info<replaceable> file.deb </replaceable></literal> (أو <literal>‎-I</literal>)، الذي يعرض ترويسات حزمة دبيان هذه.</para>

      <example>
        <title>الاستعلامات المختلفة باستخدام <command>dpkg</command></title>

        <screen role="scale" width="80">
<computeroutput>$ </computeroutput><userinput>dpkg -L base-passwd</userinput>
<computeroutput>/.
/usr
/usr/sbin
/usr/sbin/update-passwd
/usr/share
/usr/share/lintian
/usr/share/lintian/overrides
/usr/share/lintian/overrides/base-passwd
/usr/share/doc-base
/usr/share/doc-base/users-and-groups
/usr/share/base-passwd
/usr/share/base-passwd/group.master
/usr/share/base-passwd/passwd.master
/usr/share/man
/usr/share/man/pl
/usr/share/man/pl/man8
/usr/share/man/pl/man8/update-passwd.8.gz
/usr/share/man/ru
/usr/share/man/ru/man8
/usr/share/man/ru/man8/update-passwd.8.gz
/usr/share/man/ja
/usr/share/man/ja/man8
/usr/share/man/ja/man8/update-passwd.8.gz
/usr/share/man/fr
/usr/share/man/fr/man8
/usr/share/man/fr/man8/update-passwd.8.gz
/usr/share/man/es
/usr/share/man/es/man8
/usr/share/man/es/man8/update-passwd.8.gz
/usr/share/man/de
/usr/share/man/de/man8
/usr/share/man/de/man8/update-passwd.8.gz
/usr/share/man/man8
/usr/share/man/man8/update-passwd.8.gz
/usr/share/doc
/usr/share/doc/base-passwd
/usr/share/doc/base-passwd/users-and-groups.txt.gz
/usr/share/doc/base-passwd/changelog.gz
/usr/share/doc/base-passwd/copyright
/usr/share/doc/base-passwd/README
/usr/share/doc/base-passwd/users-and-groups.html
$ </computeroutput><userinput>dpkg -S /bin/date</userinput>
<computeroutput>coreutils: /bin/date
$ </computeroutput><userinput>dpkg -s coreutils</userinput>
<computeroutput>Package: coreutils
Essential: yes
Status: install ok installed
Priority: required
Section: utils
Installed-Size: 13855
Maintainer: Michael Stone &lt;mstone@debian.org&gt;
Architecture: amd64
Multi-Arch: foreign
Version: 8.23-3
Replaces: mktemp، realpath، timeout
Pre-Depends: libacl1 (&gt;= 2.2.51-8)، libattr1 (&gt;= 1:2.4.46-8)، libc6 (&gt;= 2.17)، libselinux1 (&gt;= 2.1.13)
Conflicts: timeout
Description: GNU core utilities
 This package contains the basic file، shell and text manipulation
 utilities which are expected to exist on every operating system.
 .
 Specifically، this package includes:
 arch base64 basename cat chcon chgrp chmod chown chroot cksum comm cp
 csplit cut date dd df dir dircolors dirname du echo env expand expr
 factor false flock fmt fold groups head hostid id install join link ln
 logname ls md5sum mkdir mkfifo mknod mktemp mv nice nl nohup nproc numfmt
 od paste pathchk pinky pr printenv printf ptx pwd readlink realpath rm
 rmdir runcon sha*sum seq shred sleep sort split stat stty sum sync tac
 tail tee test timeout touch tr true truncate tsort tty uname unexpand
 uniq unlink users vdir wc who whoami yes
Homepage: http://gnu.org/software/coreutils
$ </computeroutput><userinput>dpkg -l 'b*'</userinput>
<computeroutput>Desired=Unknown/Install/Remove/Purge/Hold
| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend
|/ Err؟=(none)/Reinst-required (Status،Err: uppercase=bad)
||/ Name                    Version          Architecture     Description
+++-=======================-================-================-====================================================
un  backupninja             &lt;none&gt;           &lt;none&gt;           (no description available)
ii  backuppc                3.3.0-2          amd64            high-performance، enterprise-grade system for backin
un  base                    &lt;none&gt;           &lt;none&gt;           (no description available)
un  base-config             &lt;none&gt;           &lt;none&gt;           (no description available)
ii  base-files              8                amd64            Debian base system miscellaneous files
ii  base-passwd             3.5.37           amd64            Debian base system master password and group files
[...]
$ </computeroutput><userinput>dpkg -c /var/cache/apt/archives/gnupg_1.4.18-6_amd64.deb</userinput>
<computeroutput>drwxr-xr-x root/root         0 2014-12-04 23:03 ./
drwxr-xr-x root/root         0 2014-12-04 23:03 ./lib/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./lib/udev/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./lib/udev/rules.d/
-rw-r--r-- root/root      2711 2014-12-04 23:03 ./lib/udev/rules.d/60-gnupg.rules
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/lib/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/lib/gnupg/
-rwxr-xr-x root/root     39328 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_ldap
-rwxr-xr-x root/root     92872 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_hkp
-rwxr-xr-x root/root     47576 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_finger
-rwxr-xr-x root/root     84648 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_curl
-rwxr-xr-x root/root      3499 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_mailto
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/bin/
-rwxr-xr-x root/root     60128 2014-12-04 23:03 ./usr/bin/gpgsplit
-rwxr-xr-x root/root   1012688 2014-12-04 23:03 ./usr/bin/gpg
[...]
$ </computeroutput><userinput>dpkg -I /var/cache/apt/archives/gnupg_1.4.18-6_amd64.deb</userinput>
<computeroutput> new debian package، version 2.0.
 size 1148362 bytes: control archive=3422 bytes.
    1264 bytes،    26 lines      control              
    4521 bytes،    65 lines      md5sums              
     479 bytes،    13 lines   *  postinst             #!/bin/sh
     473 bytes،    13 lines   *  preinst              #!/bin/sh
 Package: gnupg
 Version: 1.4.18-6
 Architecture: amd64
 Maintainer: Debian GnuPG-Maintainers &lt;pkg-gnupg-maint@lists.alioth.debian.org&gt;
 Installed-Size: 4888
 Depends: gpgv، libbz2-1.0، libc6 (&gt;= 2.15)، libreadline6 (&gt;= 6.0)، libusb-0.1-4 (&gt;= 2:0.1.12)، zlib1g (&gt;= 1:1.1.4)
 Recommends: gnupg-curl، libldap-2.4-2 (&gt;= 2.4.7)
 Suggests: gnupg-doc، libpcsclite1، parcimonie، xloadimage | imagemagick | eog
 Section: utils
 Priority: important
 Multi-Arch: foreign
 Homepage: http://www.gnupg.org
 Description: GNU privacy guard - a free PGP replacement
  GnuPG is GNU's tool for secure communication and data storage.
  It can be used to encrypt data and to create digital signatures.
  It includes an advanced key management facility and is compliant
  with the proposed OpenPGP Internet standard as described in RFC 4880.
[...]</computeroutput></screen>
      </example>

      <sidebar>
        <title><emphasis>التعمق أكثر</emphasis> المقارنة بين الإصدارات</title>
        <indexterm><primary>إصدار، مقارنة</primary></indexterm>
        <indexterm><primary>مقارنة بين الإصدارات</primary></indexterm>

	<para>بما أن <command>dpkg</command> هو برنامج معالجة حزم دبيان، فهو يمثل أيضاً التطبيق المرجعي في المقارنة المنطقية بين أرقام الإصدارات. لذلك تراه يملك خيار <literal>‎--compare-versions</literal>، يمكن استخدامه بالبرامج الخارجية (خصوصاً سكربتات الإعداد التي يستدعيها <command>dpkg</command> نفسه). يحتاج هذا الخيار ثلاثة بارامترات: رقم الإصدار، عامل مقارنة، ورقم إصدار آخر. عوامل المقارنة المختلفة المتاحة هي <literal>lt</literal> (أصغر تماماً من)، و <literal>le</literal> (أصغر من أو يساوي)، و <literal>eq</literal> (يساوي)، <literal>ne</literal> (لا يساوي)، <literal>ge</literal> (أكبر من أو يساوي)، و <literal>gt</literal> (أكبر تماماً من). إذا كانت المقارنة صحيحة، يرجع <command>dpkg</command> القيمة 0 (نجاح)؛ وإلا، فإنه يعطي قيمة مرجعة غير صفرية (تدل على خطأ).</para>

        <screen>
<computeroutput>$ </computeroutput><userinput>dpkg --compare-versions 1.2-3 gt 1.1-4</userinput>
<computeroutput>$ </computeroutput><userinput>echo $?</userinput>
<computeroutput>0
$ </computeroutput><userinput>dpkg --compare-versions 1.2-3 lt 1.1-4</userinput>
<computeroutput>$ </computeroutput><userinput>echo $?</userinput>
<computeroutput>1
$ </computeroutput><userinput>dpkg --compare-versions 2.6.0pre3-1 lt 2.6.0-1</userinput>
<computeroutput>$ </computeroutput><userinput>echo $?</userinput>
<computeroutput>1</computeroutput>
</screen>

	<para>لاحظ كيف أعطى أن المقارنة الأخيرة خاطئة على عكس ما هو متوقع: كلمة <literal>pre</literal>، التي تعني عادة pre-release (إصدار أولي)، لا تعني شيئاً من وجهة نظر <command>dpkg</command>، ويقارن هذا البرنامج بين الحروف الأبجدية تماماً كما يقارن بين الأرقام (a &lt; b &lt; c ...‎)، حسب ترتيبها الهجائي. لذلك فإنه يعتبر ”<literal>0pre3</literal>“ أكبر من ”<literal>0</literal>“. عندما نريد أن يُعبِّر رقم إصدار الحزمة على أنها إصدار أولي، نستخدم محرف التيلدا ”<literal>~</literal>“:</para>

        <screen>
<computeroutput>$ </computeroutput><userinput>dpkg --compare-versions 2.6.0~pre3-1 lt 2.6.0-1</userinput>
<computeroutput>$ </computeroutput><userinput>echo $?</userinput>
<computeroutput>0</computeroutput>
</screen>
      </sidebar>
    </section>
    <section>
      <title>سجلات <command>dpkg</command></title>

      <para>يحتفظ <command>dpkg</command> بسجل يحفظ جميع أعماله في ‎<filename>‎/var/log/dpkg.log</filename>. هذا السجل طويل جداً، لأنه يُفصّل كل مرحلة من المراحل التي تمر بها الحزم التي يعالجها <command>dpkg</command>. بالإضافة إلى إمكانية تتبع سلوك dpkg عبر هذه السجلات، يمكنها أن تساعد – قبل كل شيء – في متابعة تاريخ تطور النظام: حيث يمكن العثور على اللحظات الدقيقة التي تم فيها تثبيت أو تحديث كل حزمة، ويمكن أن تكون فائدة هذه المعلومات عظيمة لفهم التغيرات الحديثة في سلوك النظام. كما تُسجَّل جميع أرقام الإصدارات، وبالتالي يسهل مقارنة المعلومات مع ملف <filename>changelog.Debian.gz</filename> للحزمة المطلوبة، أو حتى مع تقارير العلل على الإنترنت.</para>
    </section>
    <section id="sect.multi-arch">
      <title>دعم تعدد المعماريات</title>
      <indexterm><primary>تعدد المعماريات</primary></indexterm>
      <indexterm><primary>معمارية</primary><secondary>دعم تعدد المعماريات</secondary></indexterm>

      <para>تحوي جميع حزم دبيان حقل <literal>Architecture</literal> في معلومات التحكم. إما أن يحوي هذا الحقل القيمة ”<literal>all</literal>“ (للحزم المستقلة عن معمارية النظام) أو اسم المعمارية التي تستهدفها (مثل ”amd64“، أو ”armhf“، …). في الحالة الثانية، يقبل <command>dpkg</command> – افتراضياً – تثبيت الحزم ذات المعمارية التي تطابق معمارية النظام التي يمكن الحصول عليها باستدعاء الأمر <command>dpkg --print-architecture</command>.</para>

      <para>يضمن هذا القيد أن لا ينتهي الحال بالمستخدمين مع ملفات ثنائية مترجمة لمعمارية خاطئة. كان كل شيء مثالياً لولا أن (بعض) الحواسيب تستطيع تشغيل ملفات ثنائية لأكثر من معمارية، سواء بشكل مباشر (نظام بمعمارية ”amd64“ يستطيع تشغيل ملفات ”i386“ الثنائية) أو عبر محاكيات.</para>
      
      <section>
        <title>تفعيل تعدد المعماريات</title>
	<para>يسمح تعدد المعماريات في <command>dpkg</command> للمستخدمين بتعريف ”معماريات أجنبية“ يمكن تثبيت ملفاتها الثنائية على النظام. يتم هذا بسهولة عبر الأمر <command>dpkg --add-architecture</command> كما في المثال التالي. هناك أمر مقابل لإسقاط دعم معمارية أجنبية هو <command>dpkg --remove-architecture</command>، لكن لا يمكن استخدامه إلا عندما لا تبقى أي حزمة من حزم تلك المعمارية على النظام.</para>

	<screen>
<computeroutput># </computeroutput><userinput>dpkg --print-architecture</userinput>
<computeroutput>amd64
# </computeroutput><userinput>dpkg --print-foreign-architectures</userinput>
<computeroutput># </computeroutput><userinput>dpkg -i gcc-4.9-base_4.9.1-19_armhf.deb</userinput>
<computeroutput>dpkg: error processing archive gcc-4.9-base_4.9.1-19_armhf.deb (--install):
 package architecture (armhf) does not match system (amd64)
Errors were encountered while processing:
 gcc-4.9-base_4.9.1-19_armhf.deb
# </computeroutput><userinput>dpkg --add-architecture armhf</userinput>
<computeroutput># </computeroutput><userinput>dpkg --add-architecture armel</userinput>
<computeroutput># </computeroutput><userinput>dpkg --print-foreign-architectures</userinput>
<computeroutput>armhf
armel
# </computeroutput><userinput>dpkg -i gcc-4.9-base_4.9.1-19_armhf.deb</userinput>
<computeroutput>Selecting previously unselected package gcc-4.9-base:armhf.
(Reading database ... 86425 files and directories currently installed.)
Preparing to unpack gcc-4.9-base_4.9.1-19_armhf.deb ...
Unpacking gcc-4.9-base:armhf (4.9.1-19) ...
Setting up gcc-4.9-base:armhf (4.9.1-19) ...
# </computeroutput><userinput>dpkg --remove-architecture armhf</userinput>
<computeroutput>dpkg: error: cannot remove architecture 'armhf' currently in use by the database
# </computeroutput><userinput>dpkg --remove-architecture armel</userinput>
<computeroutput># </computeroutput><userinput>dpkg --print-foreign-architectures</userinput>
<computeroutput>armhf</computeroutput></screen>

	<sidebar>
	  <title><emphasis>ملاحظة</emphasis> دعم تعدد المعماريات في APT</title>
	  <para>تشعر APT تلقائياً عند ضبط dpkg لدعم معماريات أجنبية وتبدأ بتنزيل ملفات <filename>Packages</filename> المقابلة لها أثناء عملية تحديث لوائح الحزم.</para>
	  <para>يمكن بعدها تثبيت الحزم الأجنبية باستخدام <command>apt install <replaceable>package</replaceable>:<replaceable>architecture</replaceable></command>.</para>
	</sidebar>

	<sidebar>
	  <title><emphasis>ممارسة عملية</emphasis> استخدام ملفات i386 الثنائية على amd64</title>
	  <para>هناك عدة حالات يستفاد فيها من تعدد المعماريات، لكن أشهرها هي إمكانية تنفيذ ملفات 32 بت الثنائية (i386) على نظم 64 بت (amd64)، خصوصاً وأن بعض البرمجيات المحتكرة (مثل سكايب) متوفرة فقط بنسخ 32 بت.</para>
	</sidebar>
      </section>
      <section>
	<title>التعديلات المتعلقة بتعدد المعماريات</title>

	<para>للاستفادة فعلاً من تعدد المعماريات، يجب إعادة تحزيم المكتبات ونقلها إلى مجلد خاص بالمعمارية بحيث يمكن تثبيت عدة نسخ من المكتبة نفسها (كل نسخة تستهدف معمارية مختلفة) بجوار بعضها. هذه الحزم المحدّثة تحوي حقل ”<literal>Multi-Arch: same</literal>“ في ترويستها لإعلام نظام الحزم أنه يمكن تثبيت المعماريات المختلفة من الحزمة مع بعضها بأمان (وأن هذه الحزم يمكن أن تلبي اعتماديات الحزم من المعمارية نفسها فقط). بما أن الظهور الأول لتعدد المعماريات كان في دبيان <emphasis role="distribution">ويزي</emphasis>، فلم تُحوَّل جميع المكتبات بعد.</para>

	<screen><computeroutput>$ </computeroutput><userinput>dpkg -s gcc-4.9-base
</userinput><computeroutput>dpkg-query: error: --status needs a valid package name but 'gcc-4.9-base' is not: ambiguous package name 'gcc-4.9-base' with more than one installed instance

Use --help for help about querying packages.
$ </computeroutput><userinput>dpkg -s gcc-4.9-base:amd64 gcc-4.9-base:armhf | grep ^Multi
</userinput><computeroutput>Multi-Arch: same
Multi-Arch: same
$ </computeroutput><userinput>dpkg -L libgcc1:amd64 |grep .so
</userinput><computeroutput>/lib/x86_64-linux-gnu/libgcc_s.so.1
$ </computeroutput><userinput>dpkg -S /usr/share/doc/gcc-4.9-base/copyright
</userinput><computeroutput>gcc-4.9-base:amd64, gcc-4.9-base:armhf: /usr/share/doc/gcc-4.9-base/copyright
</computeroutput></screen>

	<para>يجدر بالملاحظة أن أسماء حزم <literal>Multi-Arch: same</literal> يجب أن توسم بمعماريتها حتى يتم التعرف عليها دون التباس. كما يمكن لها أن تشترك بالملفات مع النسخ الأخرى من الحزمة نفسها؛ يضمن <command>dpkg</command> أن جميع الملفات المشتركة بين الحزم متطابقة بت مع بت. وأخيراً وليس آخراً، يجب أن يكون إصدار جميع نسخ الحزمة متطابقاً. أي يجب تحديث جميع النسخ معاً.</para>

	<para>كما يُسبِّب تعدد المعماريات أيضاً بعض التحدّيات الملفتة في مجال إدارة الاعتماديات. لتلبية اعتمادية يجب تثبيت الحزمة عليها علامة ”<literal>Multi-Arch: foreign</literal>“ أو حزمة تطابق معماريتها معمارية الحزمة التي تصرح عن الاعتمادية (في عملية حل الاعتماديات هذه، تعتبر معمارية الحزم المستقلة عن المعماريات مطابقة لمعمارية النظام). يمكن أيضاً تضعيف الاعتمادية للسماح لأي معمارية بتلبيتها، باستخدام الصيغة <literal><replaceable>package</replaceable>:any</literal>، لكن لا تستطيع الحزم الأجنبية تلبية هذه الاعتمادية إلا إذا كانت تحوي علامة ”<literal>Multi-Arch: allowed</literal>“.</para>
      </section>
    </section>
  </section>
  <section id="sect.coexistence-with-other-packaging-systems">
    <title>التعايش مع نظم التحزيم الأخرى</title>
    <indexterm><primary>RPM</primary></indexterm>
    <indexterm><primary>مدير حزم ريدهات</primary></indexterm>
    <indexterm><primary><command>alien</command></primary></indexterm>

    <para>حزم دبيان ليست الحزم البرمجية الوحيدة المستخدمة في عالم البرمجيات الحرة. المنافس الرئيسي هي صيغة RPM الخاصة بتوزيعة Red Hat Linux ومشتقاتها العديدة. ريدهات توزيعة تجارية شهيرة جداً، ولذلك من الشائع توفير البرمجيات التي تزودها أطراف خارجية بشكل حزم RPM بدلاً من حزم دبيان.</para>

    <para>في هذه الحالة، عليك أن تعرف أن البرنامج <command>rpm</command>، الذي يعالج حزم RPM، متوفر بشكل حزمة دبيان، لذلك يمكن استخدام صيغة الحزم هذه في دبيان. لكن يجب أخذ الحيطة على أي حال، وحصر استخدام هذه الأداة في استخراج المعلومات من الحزمة أو التحقق من سلامتها فقط. في الحقيقة، ليس من المنطق استخدام <command>rpm</command> لتثبيت حزمة RPM على نظام دبيان؛ لأن RPM يستخدم قاعدة بيانات خاصة، منفصلة عن قاعدة بيانات برمجيات دبيان الأصلية (مثل <command>dpkg</command>). ولذلك لا يمكن ضمان تعايش نظامي التحزيم معاً بشكل مستقر.</para>

    <para>على صعيد آخر، تستطيع الأداة <emphasis role="pkg">alien</emphasis> تحويل حزم RPM إلى حزم دبيان، والعكس.</para>

    <sidebar>
      <title><emphasis>مجتمع</emphasis> تشجيع تبني صيغة <filename>‎.deb</filename></title>

      <para>إذا كنت تستخدم البرنامج <command>alien</command> بانتظام لتثبيت حزم RPM ترد إليك من أحد المزودين، فلا تتردد بمراسلتهم والتعبير بلطف عن تفضيلك الشديد لصيغة <filename>‎.deb</filename>. لاحظ أن صيغة الحزمة ليست كل شيء: فحزمة <filename>‎.deb</filename> المبنية باستخدام <command>alien</command> أو التي تُجهَّز لإصدارة دبيان مختلفة عن التي تستخدمها، أو المجهزة لإحدى التوزيعات المشتقة عن دبيان مثل أوبنتو، لن تُقدِّم على الأغلب الدرجة نفسها من الجودة والتكامل مثل الحزم المطورة خصيصاً لدبيان <emphasis role="distribution">جيسي</emphasis>.</para>
    </sidebar>

    <screen>
<computeroutput>$ </computeroutput><userinput>fakeroot alien --to-deb phpMyAdmin-2.0.5-2.noarch.rpm</userinput> 
<computeroutput>phpmyadmin_2.0.5-2_all.deb generated
$ </computeroutput><userinput>ls -s phpmyadmin_2.0.5-2_all.deb</userinput>
<computeroutput>  64 phpmyadmin_2.0.5-2_all.deb</computeroutput></screen>

    <para>ستجد أن هذه العملية فائقة البساطة. لكن عليك أن تدرك أن الحزمة الناتجة لا تحوي أي معلومات عن الاعتماديات، لعدم وجود تقابل منهجي بين الاعتماديات في هاتين الصيغتين. على مدير النظام إذن أن يضمن يدوياً أن الحزمة المحوّلة ستعمل بشكل صحيح، ولذلك يجب تفادي حزم دبيان المولدة بهذه الطريقة قدر المستطاع. لحسن الحظ، تتمتع دبيان بأكبر مجموعة من الحزم البرمجية من بين كل التوزيعات، والغالب أن ما تبحث عنه – مهما كان – موجود هناك.</para>

    <para>بالاطلاع على صفحة الدليل الخاصة بالأمر <command>alien</command>، ستلاحظ أيضاً أن هذا البرنامج يعالج صيغ تحزيم أخرى، خاصة الصيغة التي تعتمدها توزيعة سلاكوير (وهي أرشيفات <filename>tar.gz</filename> بسيطة).</para>

    <para>إن استقرار البرمجيات التي تثبتها الأداة <command>dpkg</command> يسهم في شعبية دبيان. ومجموعة أدوات APT، التي سنشرحها في الفصل التالي، تحفظ هذه الميزة، وتعفي مدير النظام من إدارة حالة الحزم، وهي مهمة لازمة لكنها شاقة.</para>
  </section>
</chapter>
