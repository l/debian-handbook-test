<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
]>
<chapter id="existing-setup">
  <chapterinfo>
    <mediaobject condition="pdf">
      <imageobject>
        <imagedata fileref="images/chap-existing-setup.png" scalefit="1" />
      </imageobject>
    </mediaobject>
    <keywordset>
      <keyword>الإعداد السابق</keyword>
      <keyword>إعادة الاستخدام </keyword>
      <keyword>الهجرة</keyword>
    </keywordset>
  </chapterinfo>
  <title>تحليل التثبيت السابق والهجرة</title>
  <highlights>
    <para>أي تعديل على النظام المعلوماتي يجب أن يأخذ النظام السابق بعين الاعتبار. هذا يسمح بإعادة استخدام الموارد المتاحة لأقصى حد ممكن ويضمن التوافق السليم بين العناصر المختلفة التي تؤلف النظام. ستقدم هذه الدراسة إطار عمل عام يمكن اتباعه في حالات تهجير البنية التحتية الحاسوبية إلى لينكس.</para>
  </highlights>
  <section id="sect.heterogeneous-environments">
    <title>التعايش المشترك في البيئات غير المتجانسة</title>
    <indexterm><primary>بيئة</primary><secondary>بيئة غير متجانسة</secondary></indexterm>

    <para>يتكامل دبيان بشكل جيد جداً في كل أنواع البيئات السابقة ويتناغم مع أي نظام تشغيل آخر. هذا الانسجام شبه المثالي ناتج عن ضغط السوق الذي يطلب التزام ناشري البرمجيات بتطوير برامج تتبع المعايير القياسية. يسمح هذا الالتزام بالمعايير لمديري النظم باستبدال البرامج: سواء المخدمات أو العملاء، وسواء كانت حرة أم لا.</para>
    <section>
      <title>التكامل مع أجهزة ويندوز</title>

      <para>يضمن دعم Samba لبروتوكول SMB/CIFS التواصل بشكل ممتاز في بيئات ويندوز. يتيح Samba (سامبا) مشاركة الملفات وأرتال الطباعة مع العملاء التي تستخدم ويندوز، ويتضمن برمجيات تسمح لأجهزة لينكس باستخدام الموارد المتاحة على مخدمات ويندوز.</para>

      <sidebar>
        <title><emphasis>أدوات</emphasis> سامبا</title>
        <indexterm><primary>سامبا</primary></indexterm>

        <para>تستطيع إصدارة سامبا الأخيرة استبدال معظم مزايا ويندوز: من أبسط مزايا مخدم ويندوز NT (مصادقة، ملفات، أرتال الطباعة، تنزيل تعاريف الطابعات، DFS، الخ) وحتى أعقدها (تقديم متحكم نطاق (domain controller) متوافق مع Active Directory).</para>
      </sidebar>
    </section>
    <section>
      <title>التكامل مع أجهزة OS X</title>

      <indexterm><primary>Zeroconf</primary></indexterm>
      <indexterm><primary>Bonjour</primary></indexterm>
      <indexterm><primary>Avahi</primary></indexterm>
      <para>توفر أجهزة OS X خدمات شبكية مثل مخدمات الملفات ومشاركة الطابعات، كما تستطيع استخدام هذا النوع من الخدمات. تنشر هذه الخدمات على الشبكة المحلية، حتى تتمكن الأجهزة الأخرى من اكتشافها والاستفادة منها دون الحاجة لضبطها يدوياً، وذلك عبر استخدام Bonjour الذي يطبق مجموعة بروتوكولات Zeroconf. يتضمن دبيان تطبيقاً آخر لهذه البروتوكولات، يدعى Avahi، وهو يقدم الوظائف نفسها.</para>

      <indexterm><primary>AFP</primary></indexterm>
      <indexterm><primary>AppleShare</primary></indexterm>
      <para>على صعيد آخر، يمكن استخدام الخدمة Netatalk لتقديم مخدمات ملفات لأجهزة OS X على الشبكة. تُطبِّق هذه الخدمة بروتوكول AFB ‏(AppleShare) بالإضافة إلى الإشعارات اللازمة بحيث يستطيع عملاء OS X اكتشاف الخدمات آلياً.</para>

      <indexterm><primary>AppleTalk</primary></indexterm>
      <para>كانت شبكات Mac OS الأقدم (قبل OS X) تستخدم بروتوكولاً مختلفاً يدعى AppleTalk. بالنسبة للبيئات التي تحوي أجهزة تستخدم هذا البروتوكول، توفر Netatalk أيضاً بروتوكول AppleTalk (في الواقع، بدأت هذه الخدمة كتطبيق لذلك البروتوكول). تضمن هذه الخدمة عمل مخدمات الملفات وأرتال الطباعة، بالإضافة لمخدم الوقت (مزامنة الساعة). كما تسمح وظيفة التوجيه فيها بالارتباط مع شبكات AppleTalk.</para>
    </section>
    <section>
      <title>التكامل مع أجهزة لينكس/يونكس الأخرى</title>

      <para>أخيراً، يسمح كلاً من NFS و NIS ‒كلاهما متوفر في دبيان‒ بالتفاعل مع نظم يونكس. يضمن NFS عمل وظيفة مخدم الملفات، بينما ينشئ NIS فهارس المستخدمين (user directories). كما تسمح طبقة BSD للطباعة، التي تستخدمها معظم نظم يونكس، بمشاركة أرتال الطباعة أيضاً.</para>

      <figure>
        <title>تعايش دبيان مع OS X، وويندوز ونظم يونكس</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/existing-setup-1.png" width="25%" />
          </imageobject>
        </mediaobject>
      </figure>
    </section>
  </section>
  <section id="sect.how-to-migrate">
    <title>طريقة الهجرة</title>
    <indexterm><primary>هجرة</primary></indexterm>

    <para>حتى نضمن استمرار عمل الخدمات، يجب التخطيط لهجرة كل حاسوب وتنفيذ العملية وفقاً للخطة. هذا المبدأ صحيح مهما كان نظام التشغيل المستخدم.</para>
    <section>
      <title>تفقد الخدمات وتحديدها</title>

      <para>على الرغم من بساطة هذا الخطوة، إلا أنها أساسية. يعلم مدير النظم الجاد حقاً الأدوار الرئيسية لكل واحد من المخدمات، لكن هذه الأدوار قد تتغير، وأحياناً قد يُثبِّت المستخدمون المتقدمون بعض الخدمات ”الشاردة“ (wild services). تسمح لك معرفة وجود هذه الخدمات على أن تقرر ماذا ستفعل فيها على الأقل، بدلاً من حذفها اعتباطياً.</para>

      <para>لذلك كان من الحكمة إعلام مستخدميك بالمشروع قبل تهجير المخدم. قد يفيدك تثبيت أشهر البرمجيات الحرة التي سيعملون عليها بعد هجرتهم إلى دبيان على حواسيبهم المكتبية قبل الهجرة لإشراكهم في المشروع؛ لعل Libre Office ومجموعة برمجيات موزيلا أفضل الأمثلة هنا.</para>
      <section>
        <title>الشبكة والعمليات</title>
        <indexterm><primary>nmap</primary></indexterm>
       
	<para>تتعرف الأداة <command>nmap</command> (في الحزمة ذات الاسم نفسه) سريعاً على خدمات الإنترنت التي تستضيفها الأجهزة المتصلة بالشبكة دون الحاجة للدخول إلى تلك الأجهزة حتى. فقط استدع الأمر التالي على جهاز آخر متصل بالشبكة نفسها:</para>

        <screen>
<computeroutput>$ </computeroutput><userinput>nmap mirwiz</userinput>
<computeroutput>Starting Nmap 7.40 ( https://nmap.org ) at 2017-06-06 14:41 CEST
Nmap scan report for mirwiz (192.168.1.104)
Host is up (0.00062s latency).
Not shown: 992 closed ports
PORT     STATE SERVICE
22/tcp   open  ssh
25/tcp   open  smtp
80/tcp   open  http
111/tcp  open  rpcbind
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
5666/tcp open  nrpe
9999/tcp open  abyss

Nmap done: 1 IP address (1 host up) scanned in 0.06 seconds</computeroutput>
</screen>

        <sidebar>
          <title><emphasis>بدائل</emphasis> استخدام <command>netstat</command> للعثور على قائمة الخدمات المتاحة</title>

	  <para>على أجهزة لينكس، يظهر الأمر <command>netstat -tupan</command> قائمة جلسات TCP النشطة أو المؤجلة، بالإضافة لمنافذ UDP التي تنصت لها البرامج الفعالة. هذا يسهل التعر فعلى الخدمات الموفرة على الشبكة.</para>
        </sidebar>

        <sidebar>
          <title><emphasis>التعمق أكثر</emphasis> IPv6</title>

	  <para>قد تعمل بعض أوامر الشبكات مع IPv4 فقط (الافتراضي عادة) أو مع IPv6. هذا يشمل <command>nmap</command> و <command>netstat</command>، كما يشمل غيرهما أيضاً، مثل <command>route</command> أو <command>ip</command>. جرت العادة على استخدام الخيار <parameter dir="ltr">-6</parameter> في سطر الأوامر لتفعيل سلوك IPv6.</para>
        </sidebar>

	<para>إذا كان المخدم يعمل بنظام يونكس ويقدم حسابات shell لمستخدميه، فمن المهم تحديد إمكانية السماح بتنفيذ العمليات في الخلفية في حال غياب مالكيها. يعرض الأمر <command>ps auxw</command> لائحة بجميع العمليات مع هوية المستخدمين الذي شغلوها. ومع مقارنة هذه المعلومات مع خرج الأمر <command>who</command>، الذي يعطي قائمة بالمستخدمين المسجلين دخولهم إلى الجهاز، يمكن التعرف على الخدمات الشاردة أو غير المصرح عنها أو البرامج التي تعمل في الخلفية. يمكن الحصول على معلومات إضافية غالباً بالإطلاع على <filename>crontabs</filename> (الجداول التي تسرد الأعمال الآلية التي يجدولها المستخدمون) تفيد في معرفة الوظائف التي يلبيها هذا المخدم (هناك شرح كامل لخدمة <command>cron</command> في <xref linkend="sect.task-scheduling-cron-atd" />). </para>

	<para>في جمع الحالات، من الضروري أخذ نسخة احتياطية عن مخدماتك: فهذا يسمح باستعادة المعلومات في وقت لاحق، عندما يشتكي المستخدمون من مشاكل معينة نتجت عن الهجرة.</para>
      </section>
    </section>
    <section>
      <title>النسخ الاحتياطي للإعدادات</title>

      <para>من الحكمة الاحتفاظ بإعدادات كل خدمة تكتشفها حتى تستطيع تثبيت ما يقابلها على المخدم بعد التغيير. أضعف الإيمان أن تأخذ نسخة احتياطية عن ملفات الضبط.</para>

      <para>بالنسبة لأجهزة يونكس، تكون ملفات الضبط عادة في المجلد <filename>/etc/</filename>، لكنها قد تُخزَّن أيضاً في مجلد فرعي في <filename>/usr/local/</filename>. هذه هي حال البرامج التي ثبتت من الكود المصدري، بدلاً من تثبيتها من حزمة. في بعض الحالات، قد تجد بعض هذه الملفات في <filename>/opt/</filename>.</para>

      <para>بالنسبة لخدمات إدارة البيانات (مثل قواعد البيانات)، أفضل حل هو تصدير البيانات إلى صيغة قياسية يستطيع البرنامج الجديد استيرادها بسهولة. تكون هذه الصيغ نصية عادة ولها توثيق يشرحها؛ قد تكون SQL dump مثلاً بالنسبة لقواعد البيانات، أو ملف LDIF بالنسبة لمخدمات LDAP.</para>

      <figure>
        <title>النسخ الاحتياطي لقواعد البيانات</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/existing-setup-2.png" width="50%" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>برمجيات المخدمات مختلفة، ومن المستحيل شرح جميع الحالات الموجودة بالتفصيل. قارن بين وثائق البرامج الحالية والبرامج الجديدة حتى تتعرف على الأجزاء القابلة للتصدير (وبالتالي، قابلة للاستيراد ثانية) والأجزاء التي تحتاج معالجة يدوية. ستوضح لك قراءة هذا الكتاب طريق إعداد البرامج الرئيسية في مخدمات لينكس.</para>
    </section>
    <section>
      <title>السيطرة على مخدم دبيان سابق</title>
      <indexterm><primary>استعادة جهاز دبيان</primary></indexterm>
      <indexterm><primary>استكشاف جهاز دبيان</primary></indexterm>
      <indexterm><primary>السيطرة على مخدم دبيان</primary></indexterm>

      <para>يمكننا تحليل جهاز يعمل مسبقاً بنظام دبيان حتى نتمكن من السيطرة عليه بشكل فعال.</para>

      <para>أول الملفات التي سنتحقق منها هو <filename dir="ltr">/etc/debian_version</filename>، الذي يحوي عادة رقم إصدار نسخة دبيان المُثبَّتة (هذا الملف جزء من الحزمة <emphasis>base-files</emphasis>). إذا حوى الملف <literal><replaceable>codename</replaceable>/sid</literal>، فهذا يعني أن النظام قد حُدِّث باستخدام حزم من إحدى التوزيعات التطويرية (سواء الاختبارية أو غير المستقرة).</para>

      <para>يفحص البرنامج <command>apt-show-versions</command> (من حزمة دبيان ذات الاسم نفسه) قائمة الحزم المُثبّتة ويتعرف على النسخ المتوفرة. يمكن استخدام <command>aptitude</command> أيضاً لأداء هذه المهام، ولو أن عملها ليس آلياً بالكامل.</para>

      <para>بنظرة سريعة على الملف <filename dir="ltr">/etc/apt/sources.list</filename> (والمجلد <filename>/etc/apt/sources.list.d/</filename>) سنعرف أماكن ورود حزم دبيان إلى النظام. إذا ظهرت مصادر عديدة غير معروفة، فقد يختار مدير النظام إعادة تثبيت نظام التشغيل على الحاسوب بالكامل لضمان التوافق التام مع البرمجيات التي يوفرها دبيان.</para>

      <para>الملف <filename>sources.list</filename> مؤشر جيد عادة: يحتفظ معظم مديري النظم بقائمة مصادر APT التي استُخدِمَت من قبل، حتى لو في التعليقات. لكن عليك ألا تنسى أن المصادر التي استخدمت في الماضي قد تحذف، كما يحتمل أن بعض الحزم العشوائية المسحوبة من الإنترنت قد ثُبِّتت يدوياً (باستخدام الأمر <command>dpkg</command>). في هذه الحالة، سيضللك الجهاز وستظن أنه دبيان ”قياسي“. لذلك يجب أن تنتبه إلى أي إشارة تدل على وجود حزم خارجية (ظهور ملفات <filename>deb</filename> في مجلدات غير عادية، أرقام إصدار الحزم لها لواحق خاصة تُبيِّن أن منشأها من خارج مشروع دبيان، مثل <literal>ubuntu</literal> أو <literal>lmde</literal>، الخ).</para>

      <para>وبالمثل، من المفيد تحليل محتويات المجلد <filename>/usr/local/</filename>، الذي يفترض أن يحوي البرامج المترجمة والمُثبَّتة يدوياً. معرفة البرمجيات المُثبّتة بهذه الطريقة مفيد جداً، لأن هذا يطرح أسئلة عن سبب عدم استخدام حزم دبيان الموافقة، إذا كانت هذه الحزم متوفرة.</para>

      <sidebar>
        <title><emphasis>نظرة سريعة</emphasis> <emphasis role="pkg">cruft</emphasis></title>

	<para>تعرض عليك حزمة <emphasis role="pkg">cruft</emphasis> ذكر الملفات الموجودة التي لا تملكها أي حزمة. لهذه الأداة بعض المُرشّحات (فعاليتها مختلفة، ولا تتناسب كلها مع أحدث التطورات) لتفادي الإبلاغ عن بعض الملفات النظامية (الملفات التي ولّدتها حزم دبيان، أو ملفات الضبط المولدة آلياً التي لا يديرها <command>dpkg</command>، الخ).</para>

	<para>كن حذراً ولا تحذف كل ما تذكره لك <command>cruft</command> جُزَافاً!</para>
      </sidebar>
    </section>
    <section>
      <title>تثبيت دبيان</title>

      <para>بعد أن نعرف كل المعلومات المطلوبة من المخدم الحالي، يمكننا إيقاف عمله والبدء بتثبيت دبيان عليه.</para>
      <indexterm><primary>معمارية</primary></indexterm>

      <para>يجب أن نعرف معمارية الجهاز حتى نختار النسخة المناسبة له. إذا كان الجهاز حاسوباً شخصياً جديداً نوعاً ما، فالغالب أن يكون amd64 (الحواسيب الشخصية القديمة كانت i386 عادة). في الحالات الأخرى، يمكننا تضييق الاحتمالات حسب نظام التشغيل المستخدم سابقاً.</para>

      <para><xref linkend="tab-corresp" xrefstyle="select: label nopage" /> ليس شاملاً، لكنه قد يساعدك. في جميع الحالات، الوثائق الأصلية للحاسوب هي أكثر مصدر موثوق لمعرفة هذه المعلومات.</para>

      <table colsep="1" id="tab-corresp">
        <title>تقابل نظم التشغيل مع المعماريات</title>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>نظام التشغيل</entry>
              <entry>المعماريات</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>DEC Unix (OSF/1)‎</entry>
              <entry>alpha, mipsel</entry>
            </row>
            <row>
              <entry>HP Unix</entry>
              <entry>ia64, hppa</entry>
            </row>
            <row>
              <entry>IBM AIX</entry>
              <entry>powerpc</entry>
            </row>
            <row>
              <entry>Irix</entry>
              <entry>mips</entry>
            </row>
            <row>
              <entry>OS X</entry>
              <entry>amd64, powerpc, i386</entry>
            </row>
            <row>
              <entry>z/OS, MVS</entry>
              <entry>s390x, s390</entry>
            </row>
            <row>
              <entry>Solaris, SunOS</entry>
              <entry>sparc, i386, m68k</entry>
            </row>
            <row>
              <entry>Ultrix</entry>
              <entry>mips</entry>
            </row>
            <row>
              <entry>VMS</entry>
              <entry>alpha</entry>
            </row>
            <row>
              <entry>Windows 95/98/ME</entry>
              <entry>i386</entry>
            </row>
            <row>
              <entry>Windows NT/2000</entry>
              <entry>i386, alpha, ia64, mipsel</entry>
            </row>
            <row>
              <entry>Windows XP / Windows Server 2008</entry>
              <entry>i386, amd64, ia64</entry>
            </row>
            <row>
              <entry>Windows RT</entry>
              <entry>armel, armhf, arm64</entry>
            </row>
            <row>
              <entry>Windows Vista / Windows 7-8-10</entry>
              <entry>i386, amd64</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <sidebar>
        <title><emphasis>عتاد</emphasis> مقارنة حواسيب 64بت مع حواسيب 32بت</title>
        <indexterm><primary>amd64</primary></indexterm>
        <indexterm><primary>i386</primary></indexterm>

	<para>معظم الحواسيب الحديثة تحوي معالجات 64بت سواء Intel أو AMD، تتوافق مع معالجات 32بت الأقدم؛ ولذلك يمكن تشغيل البرامج المترجمة لمعمارية ”i386“ عليها. من ناحية أخرى، لا يستغل وضع التوافق هذا قدرات هذه المعالجات الجديدة بشكل كامل. لذلك توفر دبيان معمارية ”amd64“، التي تعمل على شرائح AMD الحديثة بالإضافة إلى معالجات إنتل ”em64t“ (بما فيها معظم معالجات السلسلة Core)، التي تشبه AMD64 كثيراً.</para>
      </sidebar>
    </section>
    <section>
      <title>تثبيت الخدمات المختارة وإعدادها</title>

      <para>بعد تثبيت دبيان، علينا تثبيت وإعداد كل خدمة من الخدمات التي يجب أن يستضيفها هذ الحاسوب. يجب أن يأخذ الإعداد الجديد الإعدادات السابقة بعين الاعتبار حتى نضمن الانتقال السلس. ستفيدنا كل المعلومات التي جمعناها في الخطوتين الأوليتين لإكمال هذه المرحلة بنجاح.</para>

      <figure>
        <title>تثبيت الخدمات المختارة</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/existing-setup-4.png" width="66%" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>قبل الغوص في هذه العملية بقدميك الاثنتين، نحن ننصحك بشدة بإكمال قراءة هذا الكتاب. بعد ذلك ستفهم طريقة إعداد الخدمات المطلوبة بشكل أدق.</para>

      <para></para>
    </section>
  </section>
</chapter>
