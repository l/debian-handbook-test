<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">فصل 15. إنشاء حزمة دبيان</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ar-MA-1.0-1" /><meta
        name="keywords"
        content="نقل خلفي, إعادة بناء, حزمة مصدرية, أرشيف, حزمة فوقية, مطور دبيان, مشرف" /><link
        rel="home"
        href="index.html"
        title="دفتر مدير دبيان" /><link
        rel="up"
        href="index.html"
        title="دفتر مدير دبيان" /><link
        rel="prev"
        href="sect.dealing-with-compromised-machine.html"
        title="14.7. التعامل مع جهاز مُختَرَق" /><link
        rel="next"
        href="sect.building-first-package.html"
        title="15.2. بناء حزمتك الأولى" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ar-MA/stable/debian-packaging.html" /></head><body
      dir="rtl"><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>السابق</strong></a></li><li
          class="home">دفتر مدير دبيان</li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>التالي</strong></a></li></ul><div
        xml:lang="ar-MA"
        class="chapter"
        lang="ar-MA"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  xmlns=""
                  id="debian-packaging"></a>فصل 15. إنشاء حزمة دبيان</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="debian-packaging.html#sect.rebuilding-package">15.1. إعادة بناء حزمة من المصدر</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.3">15.1.1. الحصول على المصادر</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.4">15.1.2. إجراء التغييرات</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.5">15.1.3. بدء إعادة البناء</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.building-first-package.html">15.2. بناء حزمتك الأولى</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#id-1.18.5.2">15.2.1. الحزم الفوقية أو الحزم الزائفة</a></span></dt><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#id-1.18.5.3">15.2.2. أرشيف ملفات بسيط</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.setup-apt-package-repository.html">15.3. إنشاء مستودع حزم للأداة APT</a></span></dt><dt><span
                class="section"><a
                  href="sect.becoming-package-maintainer.html">15.4. كيف تصبح مشرف حزم</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#id-1.18.7.2">15.4.1. تعلم إنشاء الحزم</a></span></dt><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#id-1.18.7.3">15.4.2. عملية القبول</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		من الشائع جداً، بين مديري النظم الذين يتعاملون مع حزم دبيان بشكل منتظم، أن يصلوا إلى مرحلة يحتاجون فيها لإنشاء حزم خاصة بهم، أو لتعديل حزمة سابقة. يهدف هذا الفصل للإجابة عن أكثر الأسئلة شيوعاً في هذا المجال، وتقديم العناصر اللازمة للاستفادة من بنية دبيان التحتية بأفضل طريقة ممكنة. ومع بعض الحظ، قد تشعر ‒بعد تجربة مهاراتك في الحزم المحلية‒ بالحاجة للغوص أكثر من ذلك وتنضم لمشروع دبيان نفسه!
	</div></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    xmlns=""
                    id="sect.rebuilding-package"></a>15.1. إعادة بناء حزمة من المصدر</h2></div></div></div><div
            class="para">
			تحتاج إعادة بناء حزمة ثنائية في عدد من الظروف. في بعض الحالات، يحتاج مدير النظام ميزة برمجية تتطلب ترجمة البرنامج من المصدر، مع استخدام خيار ترجمة معين؛ وفي حالات أخرى، لا يكون البرنامج المُحزَّم في النسخة المُبّتة من دبيان حديثاً بما يكفي. في الحالة الأخيرة، سيعمد مدير النظام عادة لبناء حزمة جديدة مأخوذة من نسخة دبيان أحدث — مثل <span
              class="distribution distribution">الاختبارية</span> أو حتى <span
              class="distribution distribution">غير المستقرة</span> — بحيث تعمل هذه الحزمة الجديدة في توزيعته <span
              class="distribution distribution">المستقرة</span>؛ تدعى هذه العملية ”بالنقل الخلفي“ (backporting). كالعادة، عليك الانتباه، قبل أن تجري هذه المهمة، إلى التحقق من أن أحداً لم يسبقك إليها — نظرة سريعة على صفحة متتبع حزم دبيان الخاصة بتلك الحزمة ستعطيك هذه المعلومة. <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="https://tracker.debian.org/">https://tracker.debian.org/</a></div> <a
              id="id-1.18.4.2.5"
              class="indexterm"></a>
		</div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.18.4.3"></a>15.1.1. الحصول على المصادر</h3></div></div></div><div
              class="para">
				تبدأ إعادة بناء حزمة دبيان بالحصول على الشفرة المصدرية. أسهل طريقة هي استخدام الأمر <code
                class="command">apt-get source <em
                  class="replaceable">source-package-name</em></code>. يحتاج هذا الأمر لإضافة سطر <code
                class="literal">deb-src</code> في الملف <code
                dir="ltr"
                class="filename">/etc/apt/sources.list</code>، وتحديث ملف الفهارس (عبر <code
                class="command">apt-get update</code>). يجب أن تكون هذه الشروط محققة مسبقاً إذا اتبعت التعليمات من الفصل الذي يتحدث عن إعدادات APT (انظر <a
                class="xref"
                href="apt.html#sect.apt-sources.list">قسم 6.1, “تعبئة الملف <code
                  class="filename">sources.list</code>”</a>). لكن لاحظ أنك سوف تنزّل الحزم المصدرية من نسخة دبيان المحددة في سطر <code
                class="literal">deb-src</code>. إذا كنت تريد الحصول عليها من نسخة دبيان أخرى، قد تضطر لتنزيلها يدوياً من مرآة دبيان أو من موقع الوب. هذا يعني تنزيل ملفين أو ثلاثة (امتداداتها <code
                dir="ltr"
                class="filename">*.dsc</code> — أي <span
                class="emphasis"><em>Debian Source Control</em></span> — و <code
                dir="ltr"
                class="filename">*.tar.<em
                  class="replaceable">comp</em></code> وأحياناً <code
                dir="ltr"
                class="filename">*.diff.gz</code> أو <code
                dir="ltr"
                class="filename">*.debian.tar.<em
                  class="replaceable">comp</em></code> — حيث تأخذ <em
                class="replaceable">comp</em> إحدى القيم <code
                class="literal">gz</code>، ‏<code
                class="literal">bz2</code> أو <code
                class="literal">xz</code> حسب أداة الضغط المستخدمة)، بعدها استدعاء الأمر <code
                class="command">dpkg-source -x <em
                  class="replaceable">file.dsc</em></code>. إذا كان الوصول للملف <code
                dir="ltr"
                class="filename">*.dsc</code> ممكناً بشكل مباشر من عنوان URL، فيمكنك استخدام طريقة أبسط من هذه للحصول على جميع الملفات، وهي استخدام الأمر <code
                class="command">dget <em
                  class="replaceable">URL</em></code>. يجلب هذا الأمر (الذي تجده في الحزمة <span
                class="pkg pkg">devscripts</span>) ملف <code
                dir="ltr"
                class="filename">*.dsc</code> من العنوان المحدد، بعدها يحلل محتوياته، ويحضر الملف أو الملفات التي يشار إليها فيه. بعد تنزيل كل شيء، سوف يفك الضغط عن الحزمة المصدرية (ما لم تستخدم الخيار <code
                dir="ltr"
                class="literal">-d</code> أو <code
                dir="ltr"
                class="literal">--download-only</code>).
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.18.4.4"></a>15.1.2. إجراء التغييرات</h3></div></div></div><div
              class="para">
				أصبح مصدر الحزمة متوفراً الآن في مجلد اسمه يتألف من اسم الحزمة المصدرية وإصدارها (مثلاً، <span
                class="emphasis"><em>samba-4.1.17+dfsg</em></span>)؛ سنجري تعديلاتنا المحلية في هذا المجلد.
			</div><div
              class="para">
				أول شيء تفعله هو تغيير رقم إصدار الحزمة، حتى تميّز الحزم المعاد بناؤها عن الحزم الأصلية التي توفرها دبيان. على فرض أن الإصدار الحالي هو <code
                dir="ltr"
                class="literal">2:4.1.17+dfsg-2</code>، يمكننا إنشاء الإصدار <code
                class="literal">2:4.1.17+dfsg-2falcot1</code>، الذي يبيّن منشأ الحزمة بوضوح. هذا يجعل رقم إصدار الحزمة أعلى من الإصدار الذي توفره دبيان، بحيث يمكن تثبيت الحزمة بسهولة كتحديث للحزمة الأصلية. أفضل طريقة جراء هذا التغيير هي استخدام الأمر <code
                class="command">dch</code>‏ (<span
                class="emphasis"><em>Debian CHangelog</em></span>) من الحزمة <span
                class="pkg pkg">devscripts</span>، عبر استدعائه بالشكل <code
                class="command">dch --local falcot</code> مثلاً. سيستدعي هذا الأمر محرر نصوص (<code
                class="command">sensible-editor</code> — يجب أن يكون هذا محررك الافتراضي إذا كان مذكوراً في أحد متغيري البيئة <code
                class="varname">VISUAL</code> أو <code
                class="varname">EDITOR</code> ، وإلا فسوف يستدعى المحرر الافتراضي) ليسمح لك بتوثيق الاختلاف الذي تقدمه هذه الإصدارة. يظهر لنا هذا المحرر أن <code
                class="command">dch</code> قد غيّر <code
                class="filename">debian/changelog</code> بالفعل.
			</div><div
              class="para">
				عندما تحتاج تغيير خيارات البناء، يجب إجراء التغيير في <code
                class="filename">debian/rules</code>، الذي يقود الخطوات المختلفة في عملية بناء الحزمة. في أبسط الحالات، ستجد السطور التي تتعلق بالإعدادات الافتراضية (<code
                dir="ltr"
                class="literal">./configure …</code>) أو عملية البناء الفعلية (<code
                dir="ltr"
                class="literal">$(MAKE) …</code> or <code
                class="literal">make …</code>) بسهولة. إذا لم تُستَدعى هذه الأوامر صراحة، فالأغلب أن هناك أمر صريح آخر يستدعيها، وفي تلك الحالة عليك الرجوع إلى وثائق تلك الأوامر حتى تعرف طريقة تغيير السلوك الافتراضي. قد تحتاج في الحزم التي تستخدم الأمر <code
                class="command">dh</code> لتعديل سلوك الأمرين <code
                class="command">dh_auto_configure</code> و<code
                class="command">dh_auto_build</code> (انظر صفحات الدليل الخاصة بهما لمعرفة طريقة عمل هذا).
			</div><div
              class="para">
				قد تحتاج تحديث الملف <code
                class="filename">debian/control</code> أيضاً اعتماداً على طبيعة التغييرات المحلية التي أجريتها على الحزمة، يحوي هذا الملف وصفاً للحزم المولّدة. على وجه الخصوص، يحوي هذا الملف سطور <code
                class="literal">Build-Depends</code> تتحكم بقائمة الاعتماديات التي يجب تلبيتها عند بناء الحزمة. تشير هذه الاعتماديات غالباً إلى نسخ الحزم الموجودة في التوزيعة التي أتت منها الحزمة المصدرية، لكنها قد لا تكون متوفرة في التوزيعة المستخدمة للبناء. لا توجد طريقة مؤتمتة تبيّن هل الاعتمادية حقيقية أم أنها محددة فقط لضمان محاولة البناء باستخدام آخر نسخة من المكتبة — هذه هي الطريقة الوحيدة المتاحة لإجبار البانيات الآلية (<span
                class="emphasis"><em>autobuilder</em></span>) على استخدام نسخة معينة من الحزمة أثناء البناء، لذلك يستخدم مشرفو دبيان في كثير من الأحيان اعتماديات لها أرقام محددة.
			</div><div
              class="para">
				إذا كنت متأكداً أن هذه الاعتماديات صارمة أكثر من اللازم، يمكنك تخفيفها محلياً. ستساعدك قراءة الملفات التي توثق الطريقة المعيارية لبناء البرنامج — هذه الملفات تدعى <code
                class="filename">INSTALL</code> غالباً — على معرفة الاعتماديات المناسبة. في الحالة المثالية، يجب أن تتمكن من تلبية الاعتماديات ضمن التوزيعة المستخدمة للبناء؛ إذا لم تتمكن من ذلك، ستبدأ عملية تعاودية، حيث يجب نقل الحزم المذكورة في الحقل <code
                class="literal">Build-Depends</code> خلفاً قبل أن تتمكن من نقل الحزمة المستهدفة. قد لا تحتاج بعض الحزم أن تنقلها خلفياً، ويمكن تثبيتها كما هي أثناء عملية البناء (إحدى الأمثلة البارزة هي <span
                class="pkg pkg">debhelper</span>). لاحظ أن عملية النقل الخلفي قد تتعقد سريعاً إذا لم تكن حذراً. لذلك، يجب تقليل المنقولات الخلفية إلى أقل ما يمكن.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>تلميح</em></span> تثبيت <code
                          class="literal">Build-Depends</code></strong></p></div></div></div><a
                id="id-1.18.4.4.7.2"
                class="indexterm"></a><div
                class="para">
				تسمح <code
                  class="command">apt-get</code> بتثبيت كل الحزم المذكورة في حقول <code
                  class="literal">Build-Depends</code> في حزمة مصدرية ما متوفرة في توزيعة مذكورة في سطر <code
                  class="literal">deb-src</code> في الملف <code
                  dir="ltr"
                  class="filename">/etc/apt/sources.list</code>. كل ما تحتاجه هو استدعاء الأمر <code
                  class="command">apt-get build-dep <em
                    class="replaceable">source-package</em></code>.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.18.4.5"></a>15.1.3. بدء إعادة البناء</h3></div></div></div><div
              class="para">
				بعد تطبيق كل التغييرات التي تحتاجها إلى الكود المصدري، يمكننا توليد الحزمة الثنائية (ملف <code
                dir="ltr"
                class="filename">.deb</code>). يدير الأمر <code
                class="command">dpkg-buildpackage</code> العملية كلها.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.18.4.5.3"></a><p
                class="title"><strong>مثال 15.1. إعادة بناء حزمة</strong></p><div
                class="example-contents"><pre
                  class="screen"><code
                    class="computeroutput">$ </code><strong
                    class="userinput"><code>dpkg-buildpackage -us -uc
</code></strong><code
                    class="computeroutput">[...]
</code></pre></div></div><div
              class="sidebar"><a
                xmlns=""
                id="sidebar.fakeroot"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>أدوات</em></span> <code
                          class="command">fakeroot</code></strong></p></div></div></div><div
                class="para">
				في الحقيقة، عملية إنشاء الحزم ما هي إلا تجميع لمجموعة ملفات سابقة (أو مبنية) في أرشيف واحد؛ ينتهي الحال بمعظم الملفات داخل الأرشيف بأن تصبح ملكاً للمستخدم <span
                  class="emphasis"><em>root</em></span>. لكن بناء الحزمة بالكامل تحت صلاحيات هذا المستخدم يعني زيادة المخاطر؛ لحسن الحظ، يمكنك تفادي ذلك باستخدام الأمر <code
                  class="command">fakeroot</code>. يمكن استخدام هذه الأداة لتشغيل برنامج وإعطائه انطباعاً أنه يعمل بصلاحيات <span
                  class="emphasis"><em>root</em></span> وينشئ ملفات لها ملكية وصلاحيات كيفيّة. عندما ينشئ البرنامج الأرشيف الذي سيصبح حزمة دبيان، سوف يخدع وينشئ أرشيفاً يحوي ملفات تنتمي لمالكين غير محددين، بما فيهم <span
                  class="emphasis"><em>root</em></span>. هذه العملية مريحة جداً لدرجة أن <code
                  class="command">dpkg-buildpackage</code> يستخدم <code
                  class="command">fakeroot</code> افتراضياً عند بناء الحزم.
			</div><div
                class="para">
				لاحظ أن البرنامج يخدع فقط حتى ”يصدق“ أنه يعمل بصلاحيات حساب إداري، لكن العملية تعمل فعلياً تحت صلاحيات المستخدم الحالي الذي استدعى <code
                  class="command">fakeroot <em
                    class="replaceable">program</em></code> (وسوف تنشأ الملفات في الحقيقة بصلاحيات ذلك المستخدم). لا تمنح أي صلاحيات إدارية يستطيع البرنامج إساءة استخدامها نهائياً.
			</div></div><div
              class="para">
				قد يفشل الأمر السابق إذا لم تُحدَّث حقول <code
                class="literal">Build-Depends</code>، أو إذا لم تُثبَّت الحزم المناسبة. في هذه الحالات، يمكن تجاوز عملية التحقق عبر تمرير الخيار <code
                dir="ltr"
                class="literal">-d</code> إلى <code
                class="command">dpkg-buildpackage</code>. لكن تجاهل هذه الاعتماديات صراحة يعرضك لخطر إخفاق عملية البناء في مرحلة لاحقة. وأسوأ من ذلك، قد يبدو أن الحزمة تبنى بشكل صحيح لكنها لا تعمل بشكل سليم لاحقاً: فبعض البرامج تعطّل بعض مزاياها آلياً إذا لم تعثر على إحدى المكتبات المطلوبة أثناء البناء.
			</div><div
              class="para">
				في معظم الأحيان، يستخدم مطورو دبيان برنامجاً عالي المستوى مثل <code
                class="command">debuild</code>؛ الذي يستدعي <code
                class="command">dpkg-buildpackage</code> كالعادة لكنه يضيف أيضاً استدعاءً لبرنامج يجري عدة فحوصات للتحقق من اتفاق الحزم المولّدة مع سياسة دبيان. كما يُنظِّف هذا السكربت البيئة بحيث لا ”تُلوّث“ متغيرات البيئة المحلية عملية بناء الحزمة. الأمر <code
                class="command">debuild</code> هو أحد الأدوات من المجموعة <span
                class="emphasis"><em>devscripts</em></span>، التي تتناسق مع بعضها وتشترك في بعض الإعدادات حتى تسهِّل مهمة مشرف الحزمة.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>نظرة سريعة</em></span> <code
                          class="command">pbuilder</code></strong></p></div></div></div><a
                id="id-1.18.4.5.7.2"
                class="indexterm"></a><div
                class="para">
				يسمح البرنامج <code
                  class="command">pbuilder</code> (في الحزمة ذات الاسم نفسه) ببناء حزمة دبيان في بيئة لها جذر مختلف (<span
                  class="emphasis"><em>chrooted</em></span> environment). ينشئ البرنامج أولاً مجلداً مؤقتاً يحوي النظام المصغر اللازم لبناء الحزمة (يتضمن الحزم المذكورة في <span
                  class="emphasis"><em>Build-Depends</em></span> أيضاً). بعدها يستخدم هذا المجلد كمجلد جذر (<code
                  class="filename">/</code>) أثناء عملية البناء، وذلك باستخدام الأمر <code
                  class="command">chroot</code>.
			</div><div
                class="para">
				تسمح هذه الأداة بإجراء عملية البناء في بيئة لم تمسها تعديلات المستخدمين. يسمح هذا باكتشاف اعتماديات البناء المفقودة فوراً (لأن البناء لن ينجح ما لم تكن الاعتماديات المناسبة موثقة). أخيراً، تسمح هذه الأداة أيضاً ببناء حزمة لنسخة دبيان تختلف عن النسخة التي يستخدمها النظام ككل: فقد يستخدم الجهاز دبيان <span
                  class="distribution distribution">المستقرة</span> في أعماله العادية، وتستطيع <code
                  class="command">pbuilder</code> على الجهاز نفسه استخدام <span
                  class="distribution distribution">غير المستقرة</span> لبناء الحزم.
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>السابق</strong>14.7. التعامل مع جهاز مُختَرَق</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>أعلى</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>البداية</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>التالي</strong>15.2. بناء حزمتك الأولى</a></li></ul></body></html>
