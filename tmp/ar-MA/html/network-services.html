<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">فصل 11. خدمات الشبكة: Postfix،‏ Apache،‏ NFS،‏ Samba،‏ Squid،‏ LDAP،‏ SIP،‏ XMPP،‏ TURN</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-ar-MA-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="دفتر مدير دبيان" /><link
        rel="up"
        href="index.html"
        title="دفتر مدير دبيان" /><link
        rel="prev"
        href="sect.network-diagnosis-tools.html"
        title="10.8. أدوات تشخيص الشبكات" /><link
        rel="next"
        href="sect.http-web-server.html"
        title="11.2. مخدم الوب (HTTP)" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/ar-MA/stable/network-services.html" /></head><body
      dir="rtl"><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>السابق</strong></a></li><li
          class="home">دفتر مدير دبيان</li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>التالي</strong></a></li></ul><div
        xml:lang="ar-MA"
        class="chapter"
        lang="ar-MA"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  xmlns=""
                  id="network-services"></a>فصل 11. خدمات الشبكة: Postfix،‏ Apache،‏ NFS،‏ Samba،‏ Squid،‏ LDAP،‏ SIP،‏ XMPP،‏ TURN</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="network-services.html#sect.smtp-mail-server">11.1. مخدم البريد الإلكتروني</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.7">11.1.1. تثبيت Postfix</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.configuring-virtual-domains">11.1.2. إعداد النطاقات الظاهرية</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.restrictions-for-receiving-and-sending">11.1.3. قيود الاستقبال والإرسال</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.setting-up-greylisting">11.1.4. إعداد <span
                        class="foreignphrase"><em
                          class="foreignphrase">القوائم الرمادية</em></span></a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.11">11.1.5. تخصيص المرشحات حسب المستقبل</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.postfix-antivirus">11.1.6. التكامل مع مضاد فيروسات</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.authenticated-smtp">11.1.7. SMTP مع مصادقة</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-web-server.html">11.2. مخدم الوب (HTTP)</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.9">11.2.1. تثبيت أباتشي</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.10">11.2.2. إعداد مضيف ظاهري</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.11">11.2.3. التعليمات التوجيهية الشائعة</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.12">11.2.4. محللات السجلات</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ftp-file-server.html">11.3. مخدم الملفات FTP</a></span></dt><dt><span
                class="section"><a
                  href="sect.nfs-file-server.html">11.4. مخدم الملفات NFS</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.10">11.4.1. تأمين NFS</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.11">11.4.2. مخدم NFS</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.12">11.4.3. عميل NFS</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.windows-file-server-with-samba.html">11.5. إعداد مشاركات ويندوز باستخدام سامبا</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.9">11.5.1. مخدم سامبا</a></span></dt><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.10">11.5.2. عميل سامبا</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-ftp-proxy.html">11.6. بروكسي HTTP/FTP</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.8">11.6.1. التثبيت</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.9">11.6.2. إعداد خدمة التخبئة</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.10">11.6.3. إعداد خدمة الترشيح</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ldap-directory.html">11.7. دليل LDAP</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.7">11.7.1. التثبيت</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.8">11.7.2. تعبئة الدليل</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.9">11.7.3. إدارة الحسابات باستخدام LDAP</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.rtc-services.html">11.8. خدمات التواصل في الزمن الحقيقي</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-dns-settings">11.8.1. إعدادات DNS لخدمات RTC</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.turn-server">11.8.2. مخدم TURN</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.sip-server">11.8.3. مخدم بروكسي SIP</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.xmpp-server">11.8.4. مخدم XMPP</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-port-443">11.8.5. تشغيل الخدمات على المنفذ 443</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-webrtc">11.8.6. إضافة WebRTC</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		خدمات الشبكة هي البرامج التي يتعامل معها المستخدمون مباشرة في عملهم اليومي. هذه الخدمات هي قمة هرم النظام المعلوماتي، ويركز هذا الفصل عليها؛ أما جذع ذاك الهرم فهي البنية التحتية التي تعرضنا لها من قبل.
	</div><div
            class="para">
		تتطلب العديد من الخدمات الشبكية تقنية تشفير حتى تعمل بشكل آمن وموثوق، خصوصاً عند استخدامها عبر الإنترنت العمومي. تستخدم شهادات X.509 (التي يشار إليها أيضاً باسم شهادات SSL أو شهادات TLS) عادة لهذا الغرض. يمكن تشارك شهادة النطاق الواحدة عادة بين عدة خدمات من الخدمات التي سنناقشها في هذا الفصل.
	</div><a
            id="id-1.14.3.3"
            class="indexterm"></a><a
            id="id-1.14.3.4"
            class="indexterm"></a><a
            id="id-1.14.3.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    xmlns=""
                    id="sect.smtp-mail-server"></a>11.1. مخدم البريد الإلكتروني</h2></div></div></div><div
            class="para">
			اختار مديرو النظم في شركة فلكوت Postfix كمخدم للبريد الإلكتروني، وذلك لموثوقيته وسهولة إعداده. وفعلاً، يفرض تصميمه استخدام عملية منفصلة تتمتع مجموعة صغيرة من الصلاحيات لكل واحدة من مهماته، وهذا إجراء ممتاز للحد من ضرر المشاكل الأمنية.
		</div><a
            id="id-1.14.4.3"
            class="indexterm"></a><a
            id="id-1.14.4.4"
            class="indexterm"></a><a
            id="id-1.14.4.5"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>بدائل</em></span> مخدم Exim4</strong></p></div></div></div><a
              id="id-1.14.4.6.2"
              class="indexterm"></a><div
              class="para">
			تستخدم دبيان مخدم Exim4 كمخدم افتراضي للبريد الإلكتروني (لذلك يرفق Exim4 مع التثبيت الأولي). الإعدادات متوفرة في حزمة منفصلة، هي <span
                class="pkg pkg">exim4-config</span>، وهي تخصص آلياً اعتماداً على إجابات مجموعة من أسئلة Debconf تشبه كثيراً الأسئلة التي تطرحها الحزمة <span
                class="pkg pkg">postfix</span>.
		</div><div
              class="para">
			إما أن تكون الإعدادات في ملف مفرد (<code
                dir="ltr"
                class="filename">/etc/exim4/exim4.conf.template</code>) أو منفصلة في عدد من ملفات الضبط المخزنة في المجلد <code
                dir="ltr"
                class="filename">/etc/exim4/conf.d/</code>. في كلا الحالتين، يستخدم <code
                class="command">update-exim4.conf</code> الملفات كقالب لتوليد الملف <code
                dir="ltr"
                class="filename">/var/lib/exim4/config.autogenerated</code>. يستخدم Exim4 الملف الأخير. بفضل هذه الآلية، يمكن حقن القيم المأخوذة من إعدادات debconf للمخدم Exim —المخزَّنة في <code
                dir="ltr"
                class="filename">/etc/exim4/update-exim4.conf.conf</code>— في ملف إعداد Exim، حتى عندما يُعدِّل مدير النظام أو الحزم الأخرى على إعدادات Exim الافتراضية.
		</div><div
              class="para">
			صيغة إعدادات Exim4 لها خصوصياتها وتحتاج زمناً لتعلمها؛ لكن إذا فهمت هذه الخصوصيات، فإن Exim4 هو مخدم بريد إلكتروني مكتمل وقوي جداً، كما تشهد عشرات صفحات الوثائق. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.exim.org/docs.html">http://www.exim.org/docs.html</a></div>
		</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.14.4.7"></a>11.1.1. تثبيت Postfix</h3></div></div></div><div
              class="para">
				تتضمن الحزمة <span
                class="pkg pkg">postfix</span> خدمة SMTP الرئيسية. أما الحزم الأخرى (مثل <span
                class="pkg pkg">postfix-ldap</span> و<span
                class="pkg pkg">postfix-pgsql</span>) فهي تضيف وظائف زائدة إلى Postfix، منها الوصول إلى قواعد معطيات جهات الاتصال. عليك تثبيتها فقط إذا كنت تعرف أنك تحتاجها.
			</div><div
              class="sidebar"><a
                xmlns=""
                id="sidebar.smtp"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>أساسيات</em></span> SMTP</strong></p></div></div></div><a
                id="id-1.14.4.7.3.2"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.3"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.4"
                class="indexterm"></a><div
                class="para">
				SMTP‏ (<span
                  class="emphasis"><em>Simple Mail Transfer Protocol</em></span>) هو البروتوكول الذي تستخدمه مخدمات البريد الإلكتروني لتبادل وتوجيه الرسائل الإلكترونية.
			</div></div><div
              class="para">
				تطرح Debconf عدة أسئلة أثناء تثبيت الحزمة. تسمح الإجابات بتوليد نسخة أولية من ملف الإعداد <code
                dir="ltr"
                class="filename">/etc/postfix/main.cf</code>.
			</div><div
              class="para">
				يستفسر السؤال الأول عن نوع الإعداد. هناك إجابتين فقط من الإجابات المقترحة تناسب حالة المخدمات المتصلة بالإنترنت، هما ”Internet site“ و ”Internet with smarthost“. الأول مناسب للمخدمات التي تستقبل البريد الوارد وترسل البريد الصادر مباشرة إلى متلقيه، ولذلك فهو يناسب حالة شركة فلكوت تماماً. أما الثاني فيلائم المخدمات التي تستقبل البريد الوارد بشكل طبيعي، لكنها ترسل البريد الصادر عبر مخدم SMTP وسيط —”المضيف الذكي smarthost“— بدلاً من إرسالها مباشرة إلى المخدم المتلقي. يناسب هذا الخيار كثيراً الأفراد الذين يملكون عناوين IP ديناميكية، لأن العديد من مخدمات البريد الإلكتروني ترفض الرسائل الواردة من هذه العناوين. في هذه الحالة، سيكون المضيف الذكي عادة مخدم SMTP تابع لمزود خدمة الإنترنت، ويكون مُعدّاً بحيث يستقبل دوماً البريد الوارد من زبائن المزود وتوجيهها بشكل مناسب. هذا الإعداد (مع المضيف الذكي) يناسب أيضاً المخدمات التي لا تتصل بالإنترنت دائماً، حتى تتفادى إدارة رتل من الرسائل غير المسلّمة التي يجب إعادة محاولة إرسالها لاحقاً.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>مصطلحات</em></span> ISP</strong></p></div></div></div><a
                id="id-1.14.4.7.6.2"
                class="indexterm"></a><div
                class="para">
				ISP هو اختصار للعبارة ”Internet Service Porvider“ (مزود خدمة الإنترنت). يشير المصطلح إلى الهيئة (غالباً شركة تجارية) التي تزود اتصالات بالإنترنت والخدمات الأساسية المرتبطة بها (بريد إلكتروني، أخبار، وغيرها) إلى زبائنها.
			</div><div
                class="para">
			</div></div><div
              class="para">
				يهتم السؤال الثاني بالاسم الكامل للجهاز، الذي سيستخدم لتوليد عناوين البريد الإلكتروني اعتماداً على اسم المستخدم المحلي (هذا هو الجزء الذي يوضع خلف علامة ”@“). في حالة فلكوت، يجب أن تكون الإجابة <code
                class="literal">mail.falcot.com</code>. هذا هو السؤال الوحيد الذي يطرح افتراضياً، لكن الإعداد الناتج ليس كاملاً كفاية بالنسبة لحاجات فلكوت، لذلك استدعى مديرو النظم الأمر <code
                class="command">dpkg-reconfigure postfix</code> حتى يتمكنوا من تخصيص المزيد من المتغيرات.
			</div><div
              class="para">
				أحد الأسئلة الإضافية يطلب جميع أسماء النطاقات المرتبطة بهذا الجهاز. تتضمن القائمة الافتراضية الاسم الكامل بالإضافة لبضعة مرادفات للاسم <code
                class="literal">localhost</code>. لكن يجب إضافة النطاق الرئيسي <code
                class="literal">falcot.com</code> يدوياً. بصورة عامة، يجب إجابة هذا السؤال بإعطاءه جميع أسماء النطاقات التي سيعمل هذا المخدم معها كمخدم MX؛ بكلمات أخرى، جميع أسماء النطاقات التي يبين مخدم DNS أنها تستطيع استقبال البريد الإلكتروني. ينتهي المطاف بهذه المعلومات في المتغير <code
                class="literal">mydestination</code> في الملف <code
                dir="ltr"
                class="filename">/etc/postfix/main.cf</code> (ملف الإعداد الرئيسي لمخدم Postfix).
			</div><a
              id="id-1.14.4.7.9"
              class="indexterm"></a><a
              id="id-1.14.4.7.10"
              class="indexterm"></a><div
              class="figure"><a
                xmlns=""
                id="id-1.14.4.7.11"></a><div
                class="figure-contents"><div
                  class="mediaobject"><img
                    src="images/mail-server.png"
                    alt="دور السجل MX (سجل DNS) أثناء إرسال البريد" /></div></div><p
                class="title"><strong>شكل 11.1. دور السجل <span
                    class="emphasis"><em>MX</em></span> (سجل DNS) أثناء إرسال البريد</strong></p></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>إضافة</em></span> الاستعلام عن سجلات MX</strong></p></div></div></div><div
                class="para">
				عندما لا يحوي DNS سجل MX لنطاق ما، سيحاول مخدم البريد إرسال الرسائل إلى المضيف نفسه، عبر استخدام سجل A الموافق (أو AAAA في IPv6).
			</div></div><div
              class="para">
				في بعض الحالات، قد يسأل التثبيت أيضاً عن الشبكات التي يجب السماح لها بإرسال البريد عبر الجهاز. في الإعداد الافتراضي، يقبل Postfix الرسائل الإلكترونية التي ترد من الجهاز نفسه فقط؛ لذلك نحتاج إضافة الشبكة المحلية عادة. أضاف مديرو النظم في شركة فلكوت <code
                class="literal">192.168.0.0/16</code> إلى الإجابة الافتراضية. إذا لم يطرح عليك هذا السؤال، فالمتغير الموافق له في ملف الإعداد هو <code
                class="literal">mynetworks</code>، كما هو واضح في المثال أدناه.
			</div><div
              class="para">
				كما يمكن أيضاً توصيل البريد المحلي عبر <code
                class="command">procmail</code>. تسمح هذه الأداة للمستخدمين بترتيب بريدهم الوارد وفق القواعد المخزنة في ملف <code
                dir="ltr"
                class="filename">~/.procmailrc</code> الخاص بكل مستخدم.
			</div><a
              id="id-1.14.4.7.15"
              class="indexterm"></a><a
              id="id-1.14.4.7.16"
              class="indexterm"></a><a
              id="id-1.14.4.7.17"
              class="indexterm"></a><div
              class="para">
				بعد هذه الخطوة الأولى، حصل مديرو النظم على ملف الإعداد التالي؛ الذي سيستخدمونه كنقطة انطلاق لإضافة بعض الوظائف الأخرى كما هو مشروح في الأقسام التالية.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.7.19"></a><p
                class="title"><strong>مثال 11.1. ملف <code
                    dir="ltr"
                    class="filename">/etc/postfix/main.cf</code> الأولي</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# See /usr/share/postfix/main.cf.dist for a commented, more complete version


# Debian specific:  Specifying a file name will cause the first
# line of that file to be used as the name.  The Debian default
# is /etc/mailname.
#myorigin = /etc/mailname

smtpd_banner = $myhostname ESMTP $mail_name (Debian/GNU)
biff = no

# appending .domain is the MUA's job.
append_dot_mydomain = no

# Uncomment the next line to generate "delayed mail" warnings
#delay_warning_time = 4h

readme_directory = no

# TLS parameters
smtpd_tls_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
smtpd_tls_key_file=/etc/ssl/private/ssl-cert-snakeoil.key
smtpd_use_tls=yes
smtpd_tls_session_cache_database = btree:${data_directory}/smtpd_scache
smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache

# See /usr/share/doc/postfix/TLS_README.gz in the postfix-doc package for
# information on enabling SSL in the smtp client.

smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination
myhostname = mail.falcot.com
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
myorigin = /etc/mailname
mydestination = mail.falcot.com, falcot.com, localhost.localdomain, localhost
relayhost = 
mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 192.168.0.0/16
mailbox_command = procmail -a "$EXTENSION"
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
inet_protocols = all</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>أمن</em></span> شهادات <span
                          class="emphasis"><em>زيت الثعبان</em></span></strong></p></div></div></div><div
                class="para">
				الشهادات التي تدعى شهادات <span
                  class="emphasis"><em>زيت الثعبان</em></span> (snake oil)، مثل ”دواء“ <span
                  class="emphasis"><em>زيت الثعبان</em></span> الذي كان يبيعه المشعوذون عديمو الضمير في الأيام الخالية، ليس لها أي قيمة على الإطلاق: فلا يمكنك الاعتماد عليها للتحقق من هوية المخدم لأنها تولَّد آلياً ومُوقّعة ذاتياً (self-signed). لكنها تفيد في زيادة خصوصية التبادلات على أي حال.
			</div><div
                class="para">
				بصورة عامة، يجب استخدام هذه الشهادات لأغراض الاختبار فقط، أما الخدمات النظامية فيجب أن تستخدم شهادات حقيقية؛ التي تُولَّد حسب الطريقة المبيّنة في <a
                  class="xref"
                  href="sect.virtual-private-network.html#sect.easy-rsa">قسم 10.2.1.1, “البنية التحتية للمفاتيح العامة: <span
                    class="emphasis"><em>easy-rsa</em></span>”</a>.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.configuring-virtual-domains"></a>11.1.2. إعداد النطاقات الظاهرية</h3></div></div></div><a
              id="id-1.14.4.8.2"
              class="indexterm"></a><a
              id="id-1.14.4.8.3"
              class="indexterm"></a><div
              class="para">
				يستطيع مخدم البريد استقبال الرسائل الإلكترونية المرسلة إلى نطاقات أخرى بالإضافة إلى النطاق الرئيسي؛ تُعرَف هذه النطاقات باسم النطاقات الظاهرية (Virtual Domains). في معظم الحالات التي يحدث فيها هذا، لا تكون الرسائل موجهة في النهاية إلى المستخدمين المحليين. يُقدِّم Postfix ميزتين تفيدان في إدارة النطاقات الظاهرية.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>تحذير</em></span> النطاقات الظاهرية والنطاقات الأصلية</strong></p></div></div></div><div
                class="para">
				يجب عدم الإشارة لأي نطاق ظاهري في المتغير <code
                  class="literal">mydestination</code>؛ فهذا المتغير يحوي فقط أسماء النطاقات ”الاصلية canonical“ التي ترتبط مباشرة مع الجهاز مستخدميه المحليين.
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.8.6"></a>11.1.2.1. النطاقات الظاهرية للأسماء المستعارة</h4></div></div></div><a
                id="id-1.14.4.8.6.2"
                class="indexterm"></a><a
                id="id-1.14.4.8.6.3"
                class="indexterm"></a><div
                class="para">
					لا يحوي نطاق الأسماء المستعارة الظاهري إلا أسماء مستعارة (aliases) فقط، أي عناوين تستخدم لتوجيه الرسائل إلى عناوين أخرى فقط.
				</div><div
                class="para">
					تُنشّط هذه النطاقات بإضافة أسمائها إلى المتغير <code
                  class="literal">virtual_alias_domains</code>، والإشارة إلى ملف مقابلة الأسماء في المتغير <code
                  class="literal">virtual_alias_maps</code>.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.6.6"></a><p
                  class="title"><strong>مثال 11.2. السطور التي ستضاف إلى الملف <code
                      class="filename">/etc/postfix/main.cf</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_alias_domains = falcotsbrand.com
virtual_alias_maps = hash:/etc/postfix/virtual
</pre></div></div><div
                class="para">
					يُعرِّف الملف <code
                  dir="ltr"
                  class="filename">/etc/postfix/virtual</code> التقابلات بصيغة بسيطة نوعاً ما: كل سطر يحوي حقلين تفصلهما مسافة بيضاء؛ الحقل الأول هو الاسم المستعار، أما الحقل الثاني فيحوي قائمة بالعناوين البريدية التي يشير إليها ذلك الاسم. تغطي الصيغة الخاصة <code
                  dir="ltr"
                  class="literal">@domain.com</code> جميع الأسماء المستعارة المتبقية في النطاق.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.6.8"></a><p
                  class="title"><strong>مثال 11.3. مثال عن الملف <code
                      dir="ltr"
                      class="filename">/etc/postfix/virtual</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
webmaster@falcotsbrand.com  jean@falcot.com
contact@falcotsbrand.com    laure@falcot.com, sophie@falcot.com
# The alias below is generic and covers all addresses within 
# the falcotsbrand.com domain not otherwise covered by this file.
# These addresses forward email to the same user name in the
# falcot.com domain.
@falcotsbrand.com           @falcot.com
</pre></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.8.7"></a>11.1.2.2. نطاقات صناديق البريد الظاهرية</h4></div></div></div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>تحذير</em></span> نطاقات ظاهرية مزدوجة ?</strong></p></div></div></div><div
                  class="para">
					لا يسمح Postfix باستخدام النطاق نفسه في <code
                    class="literal">virtual_alias_domains</code> و <code
                    class="literal">virtual_mailbox_domains</code> معاً، لكن جميع النطاقات في <code
                    class="literal">virtual_mailbox_domains</code> تضاف ضمنياً إلى <code
                    class="literal">virtual_alias_domains</code>، وهذا يسمح بالجمع بين الأسماء المستعارة والصناديق البريدية في نطاق ظاهري واحد.
				</div></div><a
                id="id-1.14.4.8.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.8.7.4"
                class="indexterm"></a><div
                class="para">
					تُخزَّن الرسائل المرسلة إلى نطاقات صناديق البريد الظاهرية في صناديق بريدية غير مرتبطة بأي مستخدم محلي للنظام.
				</div><div
                class="para">
					لتفعيل نطاق صناديق بريد ظاهري يجب إضافة اسم هذا النطاق إلى المتغير <code
                  class="literal">virtual_mailbox_domains</code>، والإشارة إلى ملف تقابل الصناديق البريدية في المتغير <code
                  class="literal">virtual_mailbox_maps</code>. أما المتغير <code
                  class="literal">virtual_mailbox_base</code> فيحوي المجلد الذي تخزن الصناديق البريدية فيه.
				</div><div
                class="para">
					يشير المتغير <code
                  class="literal">virtual_uid_maps</code> (أو المتغير <code
                  class="literal">virtual_gid_maps</code>) إلى الملف الذي يحوي التقابلات بين العنوان البريدي ومستخدم النظام (أو المجموعة) الذي ”يملك“ هذا الصندوق البريدي. لمنح ملكية جميع الصناديق البريدية إلى مستخدم واحد أو مجموعة، يمكن استخدام الصيغة <code
                  class="literal">static:5000</code> التي تسند قيمة UID/GID ثابتة (القيمة 5000 هنا).
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.7.8"></a><p
                  class="title"><strong>مثال 11.4. السطور التي ستضاف إلى الملف <code
                      class="filename">/etc/postfix/main.cf</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_mailbox_domains = falcot.org
virtual_mailbox_maps = hash:/etc/postfix/vmailbox
virtual_mailbox_base = /var/mail/vhosts
</pre></div></div><div
                class="para">
					صيغة الملف <code
                  dir="ltr"
                  class="filename">/etc/postfix/vmailbox</code> بسيطة جداً أيضاً: حقلين تفصلهما مسافة بيضاء. الحقل الأول هو عنوان بريد إلكتروني ضمن أحد النطاقات الظاهرية، والثاني موقع صندوق البريد المرتبط معه (نسبةً إلى المجلد المحدّد في <span
                  class="emphasis"><em>virtual_mailbox_base</em></span>). إذا انتهى اسم صندوق البريد بشرطة مائلة امامية (<code
                  class="literal">/</code>)، ستخزّن الرسائل الإلكترونية في صيغة <span
                  class="emphasis"><em>maildir</em></span>؛ وإلا سوف تستخدم صيغة <span
                  class="emphasis"><em>mbox</em></span> التقليدية بدلاً منها. تَستخدِم صيغة <span
                  class="emphasis"><em>maildir</em></span> مجلداً كاملاً لتخزين صندوق البريد، وكل رسالة مفردة تُخزَّن في ملف منفصل. أما في صيغة <span
                  class="emphasis"><em>mbox</em></span>، فيخزن صندوق البريد كله في ملف واحد، وكل سطر يبدأ بالصيغة ”<code
                  dir="ltr"
                  class="literal">From </code>“ (كلمة <code
                  class="literal">From</code> تليها مسافة) تشير إلى بداية رسالة جديدة.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.7.10"></a><p
                  class="title"><strong>مثال 11.5. الملف <code
                      dir="ltr"
                      class="filename">/etc/postfix/vmailbox</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
# Jean's email is stored as maildir, with
# one file per email in a dedicated directory
jean@falcot.org falcot.org/jean/
# Sophie's email is stored in a traditional "mbox" file,
# with all mails concatenated into one single file
sophie@falcot.org falcot.org/sophie
</pre></div></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.restrictions-for-receiving-and-sending"></a>11.1.3. قيود الاستقبال والإرسال</h3></div></div></div><div
              class="para">
				تتطلب الأعداد المتزايدة من الرسائل غير المرغوبة (<span
                class="emphasis"><em>spam</em></span>) زيادة التشديدات على السائل التي يجب أن يقبلها مخدم البريد. يعرض هذا القسم بعض الاستراتيجيات المضمنة في Postfix.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ثقافة</em></span> مشكلة الرسائل الدعائية</strong></p></div></div></div><a
                id="id-1.14.4.9.3.2"
                class="indexterm"></a><div
                class="para">
				الرسائل الدعائية أو ”spam“ هو مصطلح عام يستخدم للإشارة إلى كل الرسائل التجاريو غير المرغوبة (تدعى أيضاً UCE، أي unsolicited commercial emails) التي تُغرق صناديق البريد؛ ويدعى الأشخاص عديمو الضمير الذين يرسلونها باسم spammers. لا يهتم هؤلاء إلا قليلاً بالإزعاج الذي يسببونه، لأن كلفة إرسال الرسائل الإلكترونية منخفضة جداً، ويكفي جذب نسبة صغيرة جداً من مستقبلي رسائل هذه العروض حتى تجني العملية الدعائية أموالاً تفوق كلفتها. العملية مؤتمتة في معظمها، وأي عنوان بريد ينشر علناً (مثلاً، في منتدى، أو في أرشيف قائمة بريدية، أو على مدونة، وغيرها) ستكتشفها روبوتات الرسائل الدعائية، وستتعرض لسيل لا ينقطع من الرسائل غير المرغوبة.
			</div><div
                class="para">
				يحاول جميع مديرو النظم مجابهة هذا الإزعاج بمرشحات الرسائل الدعائية، لكن طبعاً يستمر spammers في التكيف في سبيل المرور عبر هذه المرشحات. بل إن بعضهم يطلب خدمات من جماعات إجرامية لاستئجار شبكات من الأجهزة المصابة بدودة. تقدر الإحصائيات الأخيرة أن الرسائل الدعائية تشكل حتى 95% من مجمل الرسائل الإلكترونية التي تنتقل عبر الإنترنت!
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.4"></a>11.1.3.1. تقييد الوصول حسب عناوين IP</h4></div></div></div><div
                class="para">
					يتحكم المتغير <code
                  class="literal">smtpd_client_restrictions</code> بالأجهزة التي يسمح لها بالتواصل مع مخدم البريد الإلكتروني.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.4.3"></a><p
                  class="title"><strong>مثال 11.6. القيود المفروضة اعتماداً على عنوان العميل</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_client_restrictions = permit_mynetworks,
    warn_if_reject reject_unknown_client,
    check_client_access hash:/etc/postfix/access_clientip,
    reject_rbl_client sbl-xbl.spamhaus.org,
    reject_rbl_client list.dsbl.org
</pre></div></div><div
                class="para">
					عندما يحوي المتغير مجموعة من القواعد، كما في المثال أعلاه، تقيّم هذه القواعد بالترتيب، من الأولى حتى الأخيرة. كل قاعدة إما أن تقبل الرسالة، أو ترفضها، أو تترك القرار للقاعدة التالية. ولذلك فالترتيب مهم، ومجرد التبديل بين قاعدتين قد يؤدي لتغيير كبير في السلوك.
				</div><div
                class="para">
					تقبل التعليمة التوجيهية <code
                  class="literal">permit_mynetworks</code> المستخدمة كقاعدة أولى كل الرسائل الإلكترونية التي ترد من جهاز من الشبكة المحلية (المحددة في متغير الإعداد <span
                  class="emphasis"><em>mynetworks</em></span>).
				</div><div
                class="para">
					أما التعليمة التوجيهية الثانية فترفض في الحالة الطبيعية الرسائل التي ترد من الأجهزة التي لا تملك إعدادات DNS صحيحة بالكامل. هذه الإعدادات الصحيحة بالكامل تعني أن استبيان عنوان IP يعطي اسماً، وأن استبيان الاسم يعطي بدوره عنوان IP نفسه. هذا القيد صارم جداً غالباً، لأن معظم مخدمات البريد الإلكتروني لا تملك DNS عكسي لعناوين IP الخاصة بها. ولهذا السبب سبق مديرو النظم في فلكوت التعليمة <code
                  class="literal">reject_unknown_client</code> بالخيار <code
                  class="literal">warn_if_reject</code>: يؤدي هذا الخيار لاستبدال عملية الرفض بتحذير بسيط يُسجَّل في السجلات. يستطيع بعدها مديرو النظم متابعة عدد الرسائل التي كانت سترفض لو كانت القاعدة نشطة فعلاً، واتخاذ قرار لاحق بعد حسن اطلاع لتفعيل هذا القيد أو عدم تفعيله.
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>تلميح</em></span> جداول <span
                            class="emphasis"><em>access</em></span></strong></p></div></div></div><div
                  class="para">
					تتضمن معايير التقييد جداول يستطيع تعديلها مدير النظام تحوي مجموعاغت من المرسلين، وعناوين IP، وأسماء الأجهزة المحظورة أو المسموحة. يمكن إنشاء هذه الجداول اعتماداً على نسخة غير مضغوطة من الملف <code
                    dir="ltr"
                    class="filename">/usr/share/doc/postfix-doc/examples/access.gz</code>. هذا القالب يشرح نفسه بالتعليقات التي يحويها، أي أن كل جدول يشرح الصيغة الخاصة به.
				</div><div
                  class="para">
					يسرد الجدول <code
                    dir="ltr"
                    class="filename">/etc/postfix/access_clientip</code> عناوين IP والشبكات؛ أما <code
                    dir="ltr"
                    class="filename">/etc/postfix/access_helo</code> فيسرد أسماء النطاقات؛ ويحوي <code
                    dir="ltr"
                    class="filename">/etc/postfix/access_sender</code> العناوين البريدية للمرسلين. يجب تحويل هذه الملفات إلى جداول تهشير (صيغة محسنة للوصول السريع) بعد كل تعديل باستخدام الأمر <code
                    dir="ltr"
                    class="command">postmap /etc/postfix/<em
                      class="replaceable">file</em></code>.
				</div></div><div
                class="para">
					تسمح التعليمة الثالثة لمدير النظام بإعداد قائمة سوداء وقائمة بيضاء لمخدمات البريد الإلكتروني، تُخزَّن في الملف <code
                  dir="ltr"
                  class="filename">/etc/postfix/access_clientip</code>. تعتبر المخدمات في القائمة البيضاء موثوقة، وبالتالي لا تمر الرسائل الواردة منها عبر قواعد الترشيح التالية.
				</div><div
                class="para">
					ترفض آخر قاعدتين أي رسائل ترد من مخدم مذكور في إحدى القوائم السوداء المحددة. RBL هو اختصار <span
                  class="emphasis"><em>Remote Black List</em></span>؛ هناك كثير من هذه القوائم، لكن كلها تذكر المخدمات ذات الإعدادات السيئة التي تسمح بترحيل الرسائل الدعائية، بالإضافة إلى مرحلات البريد غير المتوقعة مثل الأجهزة المصابة بالديدان أو الفيروسات.
				</div><a
                id="id-1.14.4.9.4.10"
                class="indexterm"></a><a
                id="id-1.14.4.9.4.11"
                class="indexterm"></a><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>تلميح</em></span> القوائم البيضاء وقوائم RBL</strong></p></div></div></div><div
                  class="para">
					أحياناً تتضمن القوائم السوداء مخدمات شرعية كانت ضحية حادثة طارئة. في هذه الحالات، سوف تُرفَض جميع الرسائل الإلكترونية التي ترد من أحد هذه المخدمات ما لم يذكر المخدم في قائمة بيضاء مُعرّفة في <code
                    dir="ltr"
                    class="filename">/etc/postfix/access_clientip</code>.
				</div><div
                  class="para">
					تقتضي الحكمة إذاً إضافة جميع المخدمات الموثوقة التي ترد منها رسائل كثيرة عادة إلى القائمة البيضاء.
				</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.5"></a>11.1.3.2. التحقق من صحة أوامر <code
                        class="literal">EHLO</code> أو <code
                        class="literal">HELO</code></h4></div></div></div><div
                class="para">
					كل عملية تبادل SMTP تبدأ بأمر <code
                  class="literal">HELO</code> (أو <code
                  class="literal">EHLO</code>)، يتبعه اسم مخدم البريد المرسل؛ قد يكون التحقق من سلامة هذا الاسم مفيداً.
				</div><a
                id="id-1.14.4.9.5.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.5.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.5.5"></a><p
                  class="title"><strong>مثال 11.7. القيود المفروضة على الاسم المُعلَن في <code
                      class="literal">EHLO</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_helo_restrictions = permit_mynetworks,
    reject_invalid_hostname,
    check_helo_access hash:/etc/postfix/access_helo,
    reject_non_fqdn_hostname,
    warn_if_reject reject_unknown_hostname
</pre></div></div><div
                class="para">
					تسمح التعليمة التوجيهية <code
                  class="literal">permit_mynetworks</code> لجميع الأجهزة في الشبكة المحلية بتقديم نفسها كيفما اتفق. هذه مهم، لأن بعض برامج البريد الإلكتروني لا تحترم هذا الجزء من بروتوكول SMTP بشكل كاف، ويمكن أن تقدم نفسها بأسماء غير منطقية.
				</div><div
                class="para">
					ترفض القاعدة <code
                  class="literal">reject_invalid_hostname</code> الرسائل الإلكترونية عندما يعلن <code
                  class="literal">EHLO</code> اسم مضيف صيغته غير صحيحة. وترفض القاعدة <code
                  class="literal">reject_non_fqdn_hostname</code> الرسائل عندما لا يكون اسم المضيف المذكور اسم نطاق كامل التوصيف (fully-qualified، أي يتضمن اسم النطاق بالإضافة لاسم المضيف). ترفض القاعدة <code
                  class="literal">reject_unknown_hostname</code> الرسائل إذا لم يكن الاسم المعلن مذكوراً في DNS. بما أن هذه القاعدة الأخيرة تؤدي لعمليات رفض كثيرة جداً لسوء الحظ، فقد حوّل مديرو النظم تأثيرها إلى مجرد تحذير باستخدام الخيار <code
                  class="literal">warn_if_reject</code> كخطوة أولى؛ وقد يقررون إزالة هذا الخيار في مرحلة لاحقة، بعد فحص نتائج هذه القاعدة.
				</div><div
                class="para">
					استخدام <code
                  class="literal">permit_mynetworks</code> كقاعدة أولى له أثر جانبي ملفت: فالقواعد التالية ستُطبَّق فقط على المضيفات خارج الشبكة المحلية. يسمح هذا بحظر جميع المضيفات التي تعلن أنها جزء من <code
                  class="literal">falcot.com</code>، عبر إضافة السطر <code
                  class="literal">falcot.com REJECT You're not in our network!</code> مثلاً إلى الملف <code
                  dir="ltr"
                  class="filename">/etc/postfix/access_helo</code>.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.6"></a>11.1.3.3. القبول أو الرفض اعتماداً على المرسِل المُعلَن</h4></div></div></div><div
                class="para">
					لكل رسالة هناك مرسل، يُعلِن عنه الأمر <code
                  class="literal">MAIL FROM</code> من بروتوكول SMTP؛ يمكن التحقق من هذه المعلومات أيضاً بأساليب عديدة.
				</div><a
                id="id-1.14.4.9.6.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.6.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.6.5"></a><p
                  class="title"><strong>مثال 11.8. التحقق من المرسل</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_sender_restrictions = 
    check_sender_access hash:/etc/postfix/access_sender,
    reject_unknown_sender_domain, reject_unlisted_sender,
    reject_non_fqdn_sender
</pre></div></div><div
                class="para">
					يربط الجدول <code
                  dir="ltr"
                  class="filename">/etc/postfix/access_sender</code> بعض المعاملات الخاصة ببعض المرسلين. هذا يعني إضافة بعض المرسلين إلى قائمة بيضاء أو سوداء عادة.
				</div><div
                class="para">
					تتطلب القاعدة <code
                  class="literal">reject_unknown_sender_domain</code> أن يكون نطاق المرسل سليماً، لأنه لازم للعناوين الصحيحة. ترفض القاعدة <code
                  class="literal">reject_unlisted_sender</code> المرسلين المحليين إذا لم يكن العنوان موجوداً؛ هذا يمنع إرسال الرسائل الإلكنرونية من عنوان غير صحيح في النطاق <code
                  class="literal">falcot.com</code>، ولن تُقبَل الرسائل المنبعثة من <code
                  class="literal">joe.bloggs@falcot.com</code> مثلاً إلا إذا كان هذا العنوان موجوداً فعلاً.
				</div><div
                class="para">
					أخيراً، ترفض القاعدة <code
                  class="literal">reject_non_fqdn_sender</code> الرسائل الإلكترونية التي تدّعي أنها ترد من عناوين ليس لها اسم نطاق كامل التوصيف. عملياً، هذا يعني رفض الرسائل الواردة من <code
                  class="literal">user@machine</code>: ولذلك يجب إعلان العنوان على أنه <code
                  class="literal">user@machine.example.com</code> أو <code
                  class="literal">user@example.com</code>.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.7"></a>11.1.3.4. القبول أو الرفض اعتماداً على المستقبل</h4></div></div></div><div
                class="para">
					لكل رسالة مستقبل واحد على الأقل، يعلن عنه الأمر <code
                  class="literal">RCPT TO</code> في بروتوكول SMTP. يضمن التحقق من هذه العناوين أيضاً شرعية الرسالة، حتى لو كانت أقل أهمية من التحقق من عنوان المرسل.
				</div><a
                id="id-1.14.4.9.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.7.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.7.5"></a><p
                  class="title"><strong>مثال 11.9. التحقق من المستقبل</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks, 
    reject_unauth_destination, reject_unlisted_recipient, 
    reject_non_fqdn_recipient
</pre></div></div><div
                class="para">
					<code
                  class="literal">reject_unauth_destination</code> هي القاعدة الأساسية التي تتطلب أن تكون الرسائل الخارجية معنونة إلينا؛ أما الرسائل المرسلة إلى عنوان لا يخدمه هذا المخدم فسوف تُرفَض. دون هذه القاعدة، يسصبح المخدم محطة ترحيل مفتوحة تسمح بإرسال الرسائل الدعائية؛ أي أن هذه القاعدة إلزامية، والأفضل وضعها قرب بداية القائمة بحيث نقطع احتمال أن تسمح قاعدة أخرى للرسالة بالمرور قبل التحقق من وجهتها.
				</div><div
                class="para">
					ترفض القاعدة <code
                  class="literal">reject_unlisted_recipient</code> الرسائل المرسلة إلى مستخدمين محليين لا وجود لهم، وهذا منطقي. أخيراً، ترفض القاعدة <code
                  class="literal">reject_non_fqdn_recipient</code> العناوين ذات التوصيف غير الكامل؛ هذا يمنع إرسال رسالة إلى <code
                  class="literal">jean</code> أو <code
                  class="literal">jean@machine</code>، بل يجب استخدام العنوان الكامل بدلاً من ذلك، مثل <code
                  class="literal">jean@machine.falcot.com</code> أو <code
                  class="literal">jean@falcot.com</code>.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.8"></a>11.1.3.5. القيود المتعلقة بالأمر <code
                        class="literal">DATA</code></h4></div></div></div><div
                class="para">
					يُرسَل الأمر <code
                  class="literal">DATA</code> التابع لبروتوكول SMTP قبل إرسال محتويات الرسالة. لا يقدّم هذا الأمر أي معلومات بحد ذاته، فيما عدا الإعلان عما سيرد تالياً. لكن لا يزال إخضاعه للفحوصات ممكناً.
				</div><a
                id="id-1.14.4.9.8.3"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.8.4"></a><p
                  class="title"><strong>مثال 11.10. التحقق من <code
                      class="literal">DATA</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_data_restrictions = reject_unauth_pipelining
</pre></div></div><div
                class="para">
					تسبب التعليمات <code
                  class="literal">reject_unauth_pipelining</code> رفض الرسائل إذا أرسلت الجهة المرسلة أمراً قبل إرسال الرد على الأمر السابق. هذا يحمي من عمليات التسريع الشائعة التي تستخدمها روبوتات الرسائل الدعائية، إذا أنها عادة لا تهتم أبداً بالردود وتركز فقط على إرسال أكبر عدد ممكن من الرسائل بأقصر زمن ممكن.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.9"></a>11.1.3.6. تطبيق القيود</h4></div></div></div><div
                class="para">
					رغم أن الأوامر السابقة تتحقق من المعلومات في المراحل المختلفة من عملية تبادل SMTP، إلا أن Postfix يرسل الرفض الفعلي كردٍّ على الأمر <code
                  class="literal">RCPT TO</code>.
				</div><div
                class="para">
					هذا يعني أنه حتى لو رفضت الرسالة نتيجة أمر <code
                  class="literal">EHLO</code> خاطئ، سيعلم Postfix من هو المرسل ومن المستقبل عند إعلان الرفض. ويستطيع عندها تسجيل رسالة أوضح في السجلات وهذا غير ممكن إذا قوطعت عملية التبادل منذ البداية. بالإضافة لذلك، لا يتوقع بعض عملاء SMTP إخفاق عملية التبادل عند أوامر SMTP الأولية، وسيقل تشوش هذه العملاء عند استلام الرفض في وقت متأخر.
				</div><div
                class="para">
					هناك ميزة أخيرة لهذا الخيار هي أن القواعد تستطيع جمع المعلومات أثناء المراحل المتنوعة لعملية تبادل SMTP؛ وهذا يسمح بتعريف صلاحيات أدق، مثل رفض اتصال غير محلي إذا أعلن أن مرسله مرسل محلي.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.10"></a>11.1.3.7. الترشيح اعتماداً على محتويات الرسالة</h4></div></div></div><div
                class="para">
					لن يكتمل نظام التقييد والتحقق دون طريقو لتطبيق الفحوضات على محتويات الرسائل. يفرق Postfix بين الفحوصات المطبّقة على ترويسات البريد الإلكتروني من تلك التي تطبق على متن (body) الرسالة.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.10.3"></a><p
                  class="title"><strong>مثال 11.11. تفعيل المرشحات التي تعتمد على المحتوى</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
header_checks = regexp:/etc/postfix/header_checks
body_checks = regexp:/etc/postfix/body_checks
</pre></div></div><a
                id="id-1.14.4.9.10.4"
                class="indexterm"></a><div
                class="para">
					يحوي كل ملف قائمة من التعابير المنتظمة (تعرف عادة باسم <span
                  class="emphasis"><em>regexps</em></span> أو <span
                  class="emphasis"><em>regexes</em></span>) والإجراءات المرتبطة معها التي تنشط عند مطابقة ترويسات الرسالة (أو متنها) للتعبير المنتظم:
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>نظرة سريعة</em></span> جداول التعابير المنتظمة</strong></p></div></div></div><div
                  class="para">
					يحوي الملف <code
                    dir="ltr"
                    class="filename">/usr/share/doc/postfix-doc/examples/header_checks.gz</code> تعليقات توضيحية عديدة ويمكن استخدامه كنقطة انطلاق لإنشاء الملفين <code
                    class="filename">/etc/postfix/header_checks</code> و<code
                    class="filename">/etc/postfix/body_checks</code>.
				</div></div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.10.7"></a><p
                  class="title"><strong>مثال 11.12. مثال عن الملف <code
                      dir="ltr"
                      class="filename">/etc/postfix/header_checks</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
/^X-Mailer: GOTO Sarbacane/ REJECT I fight spam (GOTO Sarbacane)
/^Subject: *Your email contains VIRUSES/ DISCARD virus notification
</pre></div></div><div
                class="sidebar"><a
                  xmlns=""
                  id="sidebar.regexp"></a><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>أساسيات</em></span> التعابير المنتظمة</strong></p></div></div></div><div
                  class="para">
					يشير المصطلح ”تعبير منتظم“ (<span
                    class="emphasis"><em>regular expression</em></span>، ويختصر إلى <span
                    class="emphasis"><em>regexp</em></span> أو <span
                    class="emphasis"><em>regex</em></span>) إلى صيغة تدوين عامة لتمثيل محتويات أو بنية سلسلة من المحارف. تسمح بعض المحارف الخاصة بتعريف بدائل (مثلاً، <code
                    class="literal">foo|bar</code> تطابق إما ”foo“ أو ”bar“)، أو مجموعات من المحارف المسموحة (مثلاً، <code
                    class="literal">[0-9]</code> تعني أي رقم، و <code
                    class="literal">.</code> (نقطة) تعني أي محرف)، أو كميات (تطابق <code
                    dir="ltr"
                    class="literal">s?</code> إما <code
                    class="literal">s</code> أو السلسلة الفارغة، أي ورود الحرف <code
                    class="literal">s</code> مرة واحدة أو عدم وروده أبداً؛ أما <code
                    dir="ltr"
                    class="literal">s+</code> فيطابق ورود <code
                    class="literal">s</code> مرة واحدة أو أي عدد من المرات؛ وهكذا). تسمح الأقواس بتجميع نتائج البحث.
				</div><div
                  class="para">
					تختلف صيغة كتابة هذه التعابير بين الأدوات التي تستخدمها، لكن المزايا الأساسية متشابهة. <div
                    xmlns=""
                    class="url">→ <a
                      xmlns="http://www.w3.org/1999/xhtml"
                      href="http://en.wikipedia.org/wiki/Regular_expression">http://en.wikipedia.org/wiki/Regular_expression</a></div>
				</div></div><div
                class="para">
					يتحقق الأول من الترويسة التي تذكر برنامج البريد الإلكتروني؛ فإذا وجدت العبارة <code
                  class="literal">GOTO Sarbacane</code> (برنامج لإرسال البريد بالكميات)، سوف ترفض الرسالة. يتحكم التعبير الثاني بموضوع الرسالة؛ فإذا كان يذكر تحذيراً من فيروس، يمكننا ألا نرفض الرسالة ولكن نحذفها مباشرة بدلاً من ذلك.
				</div><div
                class="para">
					استخدام هذه المرشحات سيف ذو حدين، لأنه يسهل بناء قواعد عامة جداً وخسارة رسائل مشروعة نتيجة لذلك. في هذه الحالات، لن نخسر الرسائل وحسب، بل سيحصل مرسلوا هذه الرسائل على رسائل أخطاء غير مرغوبة (ومزعجة غالباً).
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.setting-up-greylisting"></a>11.1.4. إعداد <span
                      class="foreignphrase"><em
                        class="foreignphrase">القوائم الرمادية</em></span></h3></div></div></div><a
              id="id-1.14.4.10.2"
              class="indexterm"></a><div
              class="para">
				“القوائم الرمادية“ (Greylisting) هي تقنية ترشيح تعتمد على رفض الرسالة في البداية مع الرد برمز خطأ مؤقت، وقبولها إذا أعيدت محاولة إرسالها ثانية بعد بعض الوقت. هذه التقنية فعالة خصوصاً لترشيح الرسائل الدعائية التي ترسلها العديد من الجهزة المصابة بالديدان والفيروسات، لأن هذه البرمجيات نادراً ما تتصرف كعميل SMTP كامل؛ فهي لا تتحقق من رمز الخطأ وتحاول إعادة إرسال الرسائل التي فشل إرسالها لاحقاً، خصوصاً وأن معظم العناوين المحصودة غير صحيحة أصلاً وإعادة محاولة الإرسال لا تعني إلا خسارة الوقت.
			</div><div
              class="para">
				لا يدعم Postfix القوائم الرمادية داخلياً، لكن هناك ميزة تسمح بتوكيل برنامج خارجي لاتخاذ قرار قبول أو رفض رسالة معينة. هناك برنامج كهذا في الحزمة <span
                class="pkg pkg">postgrey</span>، مصمم ليرتبط مع خدمة توكيل سياسة القبول.
			</div><div
              class="para">
				بعد تثبيت <span
                class="pkg pkg">postgrey</span>، سوف يعمل كخدمة وينصت للمنفذ 10023. يمكن عندها ضبط Postfix لاستخدامه، بإضافة المتغير <code
                class="literal">check_policy_service</code> كقيد إضافي:
			</div><pre
              class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks,
    [...]
    check_policy_service inet:127.0.0.1:10023
</pre><div
              class="para">
				في كل مرة يصل فيها Postfix لهذه القاعدة، سيتصل بخدمة <code
                class="command">postgrey</code> ويرسل لها معلومات تخص الرسالة المعنية. ينظر Postgrey بدوره إلى ثلاثية (عنوان IP، المرسل، المستقبل) ويتحقق من رؤيته لهذه الثلاثية نفسها مؤخراً عبر قاعدة بياناته. إذا حدث ذلك، يرد Postgrey بأن الرسالة يجب أن تُقبَل؛ وإلا فإنه يرد بأن الرسالة يجب رفضها مؤقتاً، وتُسجَّل الثلاثية في قاعدة البيانات.
			</div><div
              class="para">
				السيئة الرئيسية للقوائم الرمادية هي تأخر استلام الرسائل المشروعة، وهذا غير مقبول دائماً. كما يزيد العبئ على المخدمات التي ترسل الكثير من الرسائل المشروعة.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ممارسة عملية</em></span> عيوب القوائم الرمادية</strong></p></div></div></div><div
                class="para">
				نظرياً، يفترض أن تؤخر القوائم الرمادية الرسالة الأولى من مرسل معين إلى مستقبل معين، وأن التأخير نموذجياً لا يتعدى دقائق. لكن الواقع قد يختلف قليلاً. بعض ISP يستخدمون عناقيد من مخدمات SMTP، وعند رفض الرسالة اول مرة، قد يحاول مخدم آخر مختلف عن الأول إعادة إرسالها. عندما يحدث ذلك، يحصل المخدم الثاني أيضاً على رسالة خطأ مؤقت نتيجة استخدام القوائم الرمادية، وهكذا؛ قد تستغرق عملية الإرسال عدة ساعات قبل أن يحاول أحد المخدمات التي حاولت من قبل إعادة الإرسال، وذلك لأن مخدمات SMTP ترزيد عادة التأخير بين المحاولات بعد كل محاولة فاشلة.
			</div><div
                class="para">
				نتيجة لذلك، قد يتغير مع الزمن عنوان IP لنفس المخدم المرسل أيضاً. بل وأكثر من ذلك، قد يتغير عنوان المرسل حتى. مثلاً، تُشفِّر الكثير من مخدمات القوائم البريدية معلومات إضافية في عنوان المرسل بحيث تتمكن من معالجة رسائل الأخطاء (تدعى <span
                  class="emphasis"><em>bounces</em></span>). كل رسالة جديدة ترسل إلى القائمة البريدية عليها عنئذ المرور عبر القوائم الرمادية، وهذا يعني أنه يجب تخزينها (مؤقتاً) على مخدم المرسل. بالنسبة للقوائم البريدية الكبيرة جداً (التي تحوي عشرات ألوف المشتركين)، سرعان ما يصبح هذا الأمر مشكلة.
			</div><div
                class="para">
				لتخفيف هذه الأضرار، يدير Postgrey قائمة بيضاء بهذه المواقع، ويقبل الرسائل التي ترد منها فوراً. يمكن ملائمة هذه القائمة مع الاحتياجات المحلية بسهولة، إذ أنها مخزنة في الملف <code
                  dir="ltr"
                  class="filename">/etc/postgrey/whitelist_clients</code>.
			</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>التعمق أكثر</em></span> الاستخدام الانتقائي للقوائم الرمادية باستخدام <span
                          class="pkg pkg">milter-greylist</span></strong></p></div></div></div><div
                class="para">
				يمكن تخفيف أضرار القوائم الرمادية باستخدامها فقط على مجموعة جزئية من العملاء الذي اعتبروا كمصدر للرسائل الدعائية مسبقاً (لأنهم مذكورون في قائمة DNS سوداء). هذا غير ممكن في <span
                  class="pkg pkg">postgrey</span> ولكن يمكن استخدام <span
                  class="pkg pkg">milter-greylist</span> بهذه الطريقة.
			</div><div
                class="para">
				في تلك الحالة، يصبح استخدام القوائم السوداء الصارمة حلاً منطقياً، بما فيها القوائم التي تذكر جميع عناوين IP الديناميكة التابعة لعملاء ISP ما (مثل <code
                  class="literal">pbl.spamhaus.org</code> أو <code
                  class="literal">dul.dnsbl.sorbs.net</code>)، لأن قوائم DNS السوداء لن تسبب رفضاً قاطعاً.
			</div><div
                class="para">
				بما أن milter-greylist يستخدم واجهة milter القياسية الخاصة ببرنامج Sendmail، يقتصر إعداد Postfix لاستخدامه على ”<code
                  class="literal">smtpd_milters = unix:/var/run/milter-greylist/milter-greylist.sock</code>“. تشرح صفحة الدليل <span
                  class="citerefentry"><span
                    class="refentrytitle">greylist.conf</span>(5)</span>‎ الملف <code
                  dir="ltr"
                  class="filename">/etc/milter-greylist/greylist.conf</code> والطرق العديدة لإعداد milter-greylist. ستحتاج أيضاً لتحرير الملف <code
                  dir="ltr"
                  class="filename">/etc/default/milter-greylist</code> لتفعيل الخدمة.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.14.4.11"></a>11.1.5. تخصيص المرشحات حسب المستقبل</h3></div></div></div><div
              class="para">
				عرض <a
                class="xref"
                href="network-services.html#sect.restrictions-for-receiving-and-sending">قسم 11.1.3, “قيود الاستقبال والإرسال”</a> و<a
                class="xref"
                href="network-services.html#sect.setting-up-greylisting">قسم 11.1.4, “إعداد <span
                  class="foreignphrase"><em
                    class="foreignphrase">القوائم الرمادية</em></span>”</a> عدة قيود متاحة للاستخدام. لكل منها فائدته في الحد من كمية الرسائل الدعائية المستقبلة، لكن لكل منها عيوبه أيضاً. ولذلك يتزايد انتشار تخصيص مجموعة المرشحات اعتماداً على المستقبل أكثر فأكثر. في شركة فلكوت، تنفع القوائم الرمادية معظم المستخدمين، لكنها تعيق عمل بعض المستخدمين الذين يحتاجون وصول رسائلهم بتأخير قصير (مثل خدمة الدعم الفني). كما تعاني خدمة التجارة أحياناً من مشاكل في استلام ردود بعض المزودين الآسيويين لأنهم مذكورين في القوائم السوداء؛ وقد طلبت هذه الخدمة عنواناً دون ترشيح حتى يتمكنون من التواصل معهم.
			</div><div
              class="para">
				يقدم Postfix ميزة تخصيص للمرشحات عبر مفهوم ”فئات التقييد restriction class“. يصرح عن الفئات في المتغير <code
                class="literal">smtpd_restriction_classes</code>، وتُعرَّف بنفس أسلوب <code
                class="literal">smtpd_recipient_restrictions</code>. بعدها تحدد التعليمة <code
                class="literal">check_recipient_access</code> جدولاً يقابل بين المستقبل المحدد ومجموعة القيود المناسبة.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.11.4"></a><p
                class="title"><strong>مثال 11.13. تعريف فئات التقييد في <code
                    class="filename">main.cf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">smtpd_restriction_classes = greylisting, aggressive, permissive

greylisting = check_policy_service inet:127.0.0.1:10023
aggressive = reject_rbl_client sbl-xbl.spamhaus.org,
        check_policy_service inet:127.0.0.1:10023
permissive = permit

smtpd_recipient_restrictions = permit_mynetworks,
        reject_unauth_destination,
        check_recipient_access hash:/etc/postfix/recipient_access
</pre></div></div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.11.5"></a><p
                class="title"><strong>مثال 11.14. الملف <code
                    dir="ltr"
                    class="filename">/etc/postfix/recipient_access</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Unfiltered addresses
postmaster@falcot.com  permissive
support@falcot.com     permissive
sales-asia@falcot.com  permissive

# Aggressive filtering for some privileged users
joe@falcot.com         aggressive

# Special rule for the mailing-list manager
sympa@falcot.com       reject_unverified_sender

# Greylisting by default
falcot.com             greylisting
</pre></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.postfix-antivirus"></a>11.1.6. التكامل مع مضاد فيروسات</h3></div></div></div><a
              id="id-1.14.4.12.2"
              class="indexterm"></a><div
              class="para">
				الفيروسات العديدة التي تتجوّل كمرفقات بريدية تضطرنا لإعداد مضاد فيروسات عند نقطة الدخول إلى شبكة الشركة، لأن بعض المستخدمين سيفتحون الملفات المرفقة مع الرسائل التي تبدو مشبوهة بشكل واضح، رغم حملات التوعية.
			</div><div
              class="para">
				اختار مديرو النظم في شركة فلكوت <code
                class="command">clamav</code> كمضاد فيروسات مجاني. الحزمة الرئيسية هي <span
                class="pkg pkg">clamav</span>، لكنهم ثبّتوا أيضاً حزماً إضافية مثل <span
                class="pkg pkg">arj</span>، و<span
                class="pkg pkg">unzoo</span>، و<span
                class="pkg pkg">unrar</span> و<span
                class="pkg pkg">lha</span>، لأن مضاد الفيروسات يحتاجها حتى يتمكن من تحليل المرفقات المضغوطة بإحدى هذه الصيغ.
			</div><a
              id="id-1.14.4.12.5"
              class="indexterm"></a><a
              id="id-1.14.4.12.6"
              class="indexterm"></a><div
              class="para">
				يتولى <code
                class="command">clamav-milter</code> مهمة الوصل ما بين مضاد الفيروسات وبين مخدم البريد الإلكتروني. الملتر (<span
                class="emphasis"><em>milter</em></span>، اختصار <span
                class="emphasis"><em>mail filter</em></span>) هو برنامج ترشيح مصمم خصيصاً للتواصل مع مخدمات البريد الإلكتروني. يستخدم الملتر واجهة برمجية تطبيقات (API أو application programming interface) تعطي أداءً أفضل بكثير من المرشحات الخارجية. قدم <span
                class="emphasis"><em>Sendmail</em></span> الملاتر أول مرة، لكن سرعان ما لحق <span
                class="emphasis"><em>Postfix</em></span> به.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>نظرة سريعة</em></span> ملتر Spamassassin</strong></p></div></div></div><a
                id="id-1.14.4.12.8.2"
                class="indexterm"></a><div
                class="para">
				تقدم الحزمة <span
                  class="pkg pkg">spamass-milter</span> ملتراً يعتمد على <span
                  class="emphasis"><em>SpamAssassin</em></span>، البرنامج الشهير لاكتشاف البريد الإلكتروني غير المرغوب. يمكن استخدامه لتحديد الرسائل على أنها يحتمل أن تكون دعائية (إضافة ترويسة زائدة) أو رفض الرسالة كلها إذا تجاوز مستوى ”spamminess“ عتبة محددة.
			</div></div><div
              class="para">
				فور تثبيت الحزمة <span
                class="pkg pkg">clamav-milter</span>، يجب إعادة ضبط الملتر ليعمل على منفذ TCP بدلاً من استخدام المقبس الشبكي المسمّى الافتراضي. يمكن تنفيذ ذلك باستخدام <code
                class="command">dpkg-reconfigure clamav-milter</code>. عند طلب ”Communication interface with Sendmail“، أجب عليه بإدخال ”<code
                class="literal">inet:10002@127.0.0.1</code>“.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ملاحظة</em></span> منفذ TCP حقيقي أو مقبس مسمّى</strong></p></div></div></div><div
                class="para">
				سبب استعمالنا لمنفذ TCP حقيقي بدلاً من مقبس شبكي مسمّى هو أن خدمات Postfix تعمل تحت جذر مختلف (chrooted) غالباً ولا يمكنها الوصول للمجلد الذي يحوي المقبس المسمّى. يمكنك أيضاً أن تختار استخدام مقبس مسمّى لكن مع اختيار موقع ضمن الجذر المغيّر إليه (وهو <code
                  class="filename">/var/spool/postfix/</code>).
			</div></div><div
              class="para">
				تناسب إعدادات ClamAV القياسية معظم الحالات، لكن لا يزال تخصيص بعض البارامترات المهمة ممكناً عبر <code
                class="command">dpkg-reconfigure clamav-base</code>.
			</div><div
              class="para">
				الخطوة الأخيرة هي أن نطلب من Postfix استخدام المرشح الجديد؛ لتحقيق ذلك، يكفي إضافة التعليمة التالية إلى <code
                dir="ltr"
                class="filename">/etc/postfix/main.cf</code>:
			</div><pre
              class="programlisting">
# Virus check with clamav-milter
smtpd_milters = inet:[127.0.0.1]:10002
</pre><div
              class="para">
				إذا سبب مضاد الفيروسات مشاكل، يمكن تعليق هذا السطر، وبعدها تنفيذ <code
                class="command">service postfix reload</code> حتى يؤخذ هذا التغيير بعين الاعتبار.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ممارسة عملية</em></span> اختبار مضاد الفيروسات</strong></p></div></div></div><div
                class="para">
				فور إعداد مضاد الفيروسات، يجب اختبار سلامة سلوكه. أبسط طريقة هي إرسال رسالة اختبار وإرفاق الملف <code
                  class="filename">eicar.com</code> (أو <code
                  class="filename">eicar.com.zip</code>) بها، يمكن تنزيل هذا الملف من الإنترنت: <div
                  xmlns=""
                  class="url">→ <a
                    xmlns="http://www.w3.org/1999/xhtml"
                    href="http://www.eicar.org/86-0-Intended-use.html">http://www.eicar.org/86-0-Intended-use.html</a></div>
			</div><div
                class="para">
				هذا الملف ليس فيروساً حقيقياً، لكنه ملف اختبار تعتبره جميع برامج مكافحة الفيروسات في السوق فيروساً لاستخدامه في اختبار صحة عملية التثبيت.
			</div></div><div
              class="para">
				ستمر جميع الرسائل التي يعالجها Postfix الآن عبر مرشح مكافحة الفيروسات.
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.authenticated-smtp"></a>11.1.7. SMTP مع مصادقة</h3></div></div></div><div
              class="para">
				حتى تتمكن من إرسال الرسائل الإلكترونية يجب أن تتمكن من الوصول لمخدم SMTP؛ كما تحتاج أيضاً أن يسمح لك مخدم SMTP ذاك بإرسال رسائلك عبره. هذا قد يتطلب تحديث إعدادات عميل SMTP بشكل متكرر بالنسبة للمستخدمين المتنقلين، لأن مخدم SMTP في شركة فلكوت يرفض الرسائل التي ترد من عناوين IP لا تنتمي لشبكة الشركة. هناك حلان: إما أن يثبّت المستخدم الرحالة مخدم SMTP على حاسوبه، أو أن يستخدم مخدم الشركة عبر أسلوب مصادقة يثبت أنه موظف في الشركة. الحل الأول غير مستحسن لأن الحاسوب لن يكون متصلاً بالإنترنت دائماً، ولن يتمكن من إعادة إرسال الرسائل في حال مواجهة مشاكل؛ سوف نركز على الحل الأخير.
			</div><div
              class="para">
				تعتمد مصادقة SMTP في Postfix على SASL‏ (<span
                class="emphasis"><em>Simple Authentication and Security Layer</em></span>). هذا يتطلب تثبيت الحزمتين <span
                class="pkg pkg">libsasl2-modules</span> و<span
                class="pkg pkg">sasl2-bin</span>، ثم تسجيل كلمة سر في قاعدة بيانات SASL لكل مستخدم يحتاج المصادقة مع مخدم SMTP. هذا يتم بوساطة الأمر <code
                class="command">saslpasswd2</code>، الذي يأخذ عدة بارامترات. يحدد الخيار <code
                dir="ltr"
                class="literal">-u</code> نطاق المصادقة، الذي يجب أن يطابق المتغير <code
                class="literal">smtpd_sasl_local_domain</code> في إعدادات Postfix. يسمح الخيار <code
                dir="ltr"
                class="literal">-c</code>بإنشاء مستخدم، ويسمح <code
                dir="ltr"
                class="literal">-f</code> بتحديد الملف الذي تريد استخدامه لتخزين قاعدة بيانات SASL إذا كنت تريد تخزينها في مكان مختلف عن المكان الافتراضي (<code
                dir="ltr"
                class="filename">/etc/sasldb2</code>).
			</div><pre
              class="screen scale">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>saslpasswd2 -u `postconf -h myhostname` -f /var/spool/postfix/etc/sasldb2 -c jean</code></strong>
<code
                class="computeroutput">[... type jean's password twice ...]</code></pre><div
              class="para">
				لاحظ أن قاعدة بيانات SASL قد أنشئت في مجلد Postfix. لضمان التوافق، سوف نجعل <code
                dir="ltr"
                class="filename">/etc/sasldb2</code> أيضاً رابطاً رمزياً يشير إلى قاعدة البيانات التي يستخدمها Postfix، باستخدام الأمر <code
                class="command">ln -sf /var/spool/postfix/etc/sasldb2 /etc/sasldb2</code>.
			</div><div
              class="para">
				نحتاج الآن إعداد Postfix بحيث يستخدم SASL. أولاً يجب إضافة المستخدم <code
                class="literal">postfix</code> إلى المجموعة <code
                class="literal">sasl</code>، حتى يستطيع الوصول لقاعدة البيانات التي يملكها حساب SASL. كما نحتاج لبضعة بارامترات جديدة لتفعيل SASL، ويجب ضبط المتغير <code
                class="literal">smtpd_recipient_restrictions</code> للسماح للعملاء الذين صادقوا هويتهم باستخدام SASL بإرسال البريد الإلكتروني دون قيود.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.13.7"></a><p
                class="title"><strong>مثال 11.15. تفعيل SASL في <code
                    dir="ltr"
                    class="filename">/etc/postfix/main.cf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Enable SASL authentication
smtpd_sasl_auth_enable = yes
# Define the SASL authentication domain to use
smtpd_sasl_local_domain = $myhostname
[...]
# Adding permit_sasl_authenticated before reject_unauth_destination
# allows relaying mail sent by SASL-authenticated users
smtpd_recipient_restrictions = permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination,
[...]
</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>إضافة</em></span> عميل SMTP مع مصادقة</strong></p></div></div></div><div
                class="para">
				تستطيع معظم عملاء البريد الإلكتروني المصادقة مع مخدم SMTP قبل إرسال الرسائل الصادرة، ولاستخدام تلك الميزة يكفي ضبط المتغيرات المناسبة. إذا كان العميل المستخدم لا يدعم هذه الميزة، فالحل هو استخدام مخدم Postfix محلي وضبطه بحيث يرحل البريد الإلكتروني إلى مخدم SMTP البعيد. في تلك الحالة، يصبح مخدم Posfix المحلي نفسه عميلاً يجري عملية المصادقة باستخدام SASL. إليك المتغيرات اللازمة:
			</div><pre
                class="programlisting">
smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
relay_host = [mail.falcot.com]
</pre><div
                class="para">
				يجب أن يحوي الملف <code
                  dir="ltr"
                  class="filename">/etc/postfix/sasl_passwd</code> اسم المستخدم وكلمة السر التي ستستخدم عند المصادقة مع المخدم <code
                  class="literal">mail.falcot.com</code>. هذا مثال:
			</div><pre
                class="programlisting">
[mail.falcot.com]   joe:LyinIsji
</pre><div
                class="para">
				كما هو حال جميع جداول التقابلات في Postfix، يجب تحويل هذا الملف إلى <code
                  dir="ltr"
                  class="filename">/etc/postfix/sasl_passwd.db</code> باستخدام الأمر <code
                  class="command">postmap</code>.
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>السابق</strong>10.8. أدوات تشخيص الشبكات</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>أعلى</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>البداية</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>التالي</strong>11.2. مخدم الوب (HTTP)</a></li></ul></body></html>
