<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
]>
<chapter id="installation">
  <chapterinfo>
    <mediaobject condition="pdf">
      <imageobject>
        <imagedata fileref="images/chap-installation.png" scalefit="1" />
      </imageobject>
    </mediaobject>
    <keywordset>
      <keyword>Installation</keyword>
      <keyword>Partitionnement</keyword>
      <keyword>Formatage</keyword>
      <keyword>Système de fichiers</keyword>
      <keyword>Secteur d'amorçage</keyword>
      <keyword>Détection de matériel</keyword>
    </keywordset>
  </chapterinfo>
  <title>Installation</title>
  <highlights>
    <para>Pour utiliser la distribution Debian, il faut l'avoir installée sur un ordinateur, tâche complexe prise en charge par le programme <emphasis>debian-installer</emphasis>. Une bonne installation implique de nombreuses opérations. Ce chapitre les passe en revue dans l'ordre dans lequel elles sont habituellement effectuées.</para>
  </highlights>
  <indexterm><primary>installation</primary><secondary>du système</secondary></indexterm>

  <sidebar>
    <title><emphasis>B.A.-BA</emphasis> Cours de rattrapage en annexe</title>

    <para>L'installation d'un ordinateur est toujours plus simple lorsque l'on est familier avec son fonctionnement. Si ce n'est pas votre cas, il est peut-être temps de faire un détour par l'<xref linkend="short-remedial-course" /> avant de revenir à la lecture de ce chapitre capital.</para>
  </sidebar>

  <para>L'installateur de <emphasis role="distribution">Jessie</emphasis> est toujours basé sur <command>debian-installer</command>. Sa conception modulaire le rend opérationnel dans de nombreux scénarios et lui a permis d'évoluer pour s'adapter aux inévitables changements. Malgré les nombreuses contraintes imposées par la prise en charge d'une large palette d'architectures, cet installateur est très accessible au débutant puisqu'il assiste l'utilisateur à chaque étape du processus. La détection automatique du matériel, le partitionnement assisté et l'interface graphique ont résolu l'essentiel des problèmes que les néophytes pouvaient rencontrer dans les premières années de Debian.</para>
  <indexterm><primary>installateur</primary></indexterm>
  <indexterm><primary><command>debian-installer</command></primary></indexterm>

  <para>L'installation requiert 80 Mo de mémoire vive et au moins 700 Mo d'espace disque. Tous les ordinateurs de Falcot répondent largement à ces critères. Notons toutefois que ces chiffres s'appliquent à l'installation d'un système très limité dénué d'un bureau graphique. Il vaut mieux prévoir un minimum de 512 Mo de mémoire vive et de 5 Go d'espace disque pour un poste bureautique de base.</para>

  <sidebar>
    <title><emphasis>ATTENTION</emphasis> Mise à jour depuis Wheezy</title>

    <para>Si vous avez déjà Debian Wheezy installée sur votre ordinateur, ce chapitre n'est pas pour vous ! En effet, contrairement à d'autres distributions, Debian permet la mise à jour du système d'une version à la suivante sans passer par une réinstallation. Celle-ci, en plus de ne pas être nécessaire, serait même dangereuse, puisqu'elle écraserait probablement les programmes installés au préalable.</para>

    <para>Cette démarche de migration sera décrite dans la <xref linkend="sect.dist-upgrade" />.</para>
  </sidebar>
  <section id="sect.installation-methods">
    <title>Méthodes d'installation</title>

    <para>L'installation d'un système Debian est possible depuis divers types de supports, pour peu que le BIOS de la machine le permette. On pourra ainsi amorcer grâce à un CD-Rom, une clé USB, voire à travers un réseau.</para>

    <sidebar>
      <title><emphasis>B.A.-BA</emphasis> BIOS, l'interface matériel/logiciel</title>
      <indexterm><primary>BIOS</primary></indexterm>
      <indexterm><primary><foreignphrase>Basic Input/Output System</foreignphrase></primary></indexterm>

      <para>Le BIOS (abréviation de <foreignphrase>Basic Input/Output System</foreignphrase>, ou système élémentaire d'entrées-sorties) est un logiciel intégré à la carte mère (carte électronique reliant tous les périphériques) et exécuté au démarrage du PC pour charger un système d'exploitation (par l'intermédiaire d'un chargeur d'amorçage adapté). Il reste ensuite présent en arrière-plan pour assurer une interface entre le matériel et le logiciel (en l'occurrence, le noyau Linux).</para>
    </sidebar>
    <section id="sect.install-cd">
      <title>Installation depuis un CD-Rom/DVD-Rom</title>

      <para>Le support d'installation le plus employé est le CD-Rom (ou le DVD-Rom, qui se comporte exactement de la même manière) : l'ordinateur s'amorce sur ce dernier et le programme d'installation prend la main.</para>

      
      <para>Divers types de CD-Rom ciblent chacun des usages différents. <emphasis>netinst</emphasis> (installation réseau) contient l'installateur et le système de base de Debian ; tous les autres logiciels seront téléchargés. Son « image », c'est-à-dire le système de fichiers ISO-9660 présentant le contenu exact du disque, n'occupe pas plus de 150 à 280 Mo (selon l'architecture). À l'opposé, le jeu complet de disques propose tous les paquets et permet d'installer le système sur un ordinateur n'ayant pas accès à Internet — il nécessite environ 84 CD-Rom (ou 12 DVD-Rom, ou encore deux disques Blu-ray). Mais les logiciels sont répartis sur les disques en fonction de leur popularité et de leur importance ; les trois premiers suffiront donc à la majorité des installations car ils contiennent les logiciels les plus utilisés.</para>

      <para>Il existe un autre type d'image, <filename>mini.iso</filename>, qui n'est disponible que comme un sous-produit de l'installateur.  Cette image contient seulement le strict minimum requis pour configurer le réseau, tout le reste est téléchargé lors de l'installation (y compris d'autres portions du programme d'installation lui-même, ce qui explique que ces images ont tendance à ne plus fonctionner lorsqu'une nouvelle version du programme d'installation est publiée). Ces images se trouvent sur les miroirs Debian habituels, dans le dossier  <filename>dists/<replaceable>release</replaceable>/main/installer-<replaceable>arch</replaceable>/current/images/netboot/</filename>.</para>
      <indexterm><primary><filename>mini.iso</filename></primary></indexterm>

      <sidebar>
        <title><emphasis>ASTUCE</emphasis> Disques multi-architectures</title>

	<para>La plupart des CD-Rom et DVD-Rom d'installation correspondent à une seule architecture matérielle. Si l'on souhaite télécharger les images complètes, il faudra donc prendre soin de choisir celles qui correspondent à l'architecture matérielle de l'ordinateur sur lequel on souhaite les utiliser.</para>

	<para>Quelques images CD-Rom/DVD-Rom présentent la particularité de fonctionner sur plusieurs architectures. On trouve ainsi une image de CD-Rom combinant les images <emphasis>netinst</emphasis> des architectures <emphasis>i386</emphasis> et <emphasis>amd64</emphasis>. Il existe aussi une image de DVD-Rom comprenant l'installateur et une sélection de paquets binaires pour <emphasis>i386</emphasis> et <emphasis>amd64</emphasis>, ainsi que les paquets sources correspondants.</para>
      </sidebar>
      <indexterm><primary>CD-Rom</primary><secondary>d'installation</secondary></indexterm>
      <indexterm><primary>CD-Rom</primary><secondary><emphasis>netinst</emphasis></secondary></indexterm>
      <indexterm><primary>DVD-Rom</primary><secondary>d'installation</secondary></indexterm>
      <indexterm><primary>DVD-Rom</primary><secondary><emphasis>netinst</emphasis></secondary></indexterm>

      <para>Pour se procurer des CD-Rom Debian, on peut bien sûr télécharger et graver leur image. Il est aussi possible de les acheter et de faire par la même occasion un petit don au projet. Consultez le site web pour connaître la liste des vendeurs et des sites de téléchargement des images de ces CD-Rom. <ulink type="block" url="http://www.debian.org/CD/index.fr.html" /></para>
    </section>
    <section id="sect.install-usb">
      <title>Démarrage depuis une clé USB</title>
      <indexterm><primary>clé USB</primary></indexterm>

      <para>Comme la plupart des ordinateurs sont capables de démarrer depuis un périphérique USB, il est également possible d'installer Debian à partir d'une clé USB (qui n'est rien de plus qu'un petit disque à mémoire flash).</para>

      <para>Le manuel d'installation explique comment créer une clé USB contenant <command>debian-installer</command>. La procédure est très simple puisque les images ISO des architectures i386 et amd64 sont des images hybrides qui peuvent démarrer aussi bien depuis un CD-Rom que depuis une clé USB.</para>

      <para>Il faut tout d'abord identifier le nom de périphérique de la clé USB (ex : <literal>/dev/sdb</literal>). Le plus simple pour cela est de consulter les messages émis par le noyau à l'aide de la commande <command>dmesg</command>. Ensuite, il faut copier l'image ISO préalablement récupérée (par exemple <filename>debian-8.0.0-amd64-i386-netinst.iso</filename>) avec la commande <command>cat debian-8.0.0-amd64-i386-netinst.iso &gt;/dev/sdb; sync</command>. Cette commande requiert les droits administrateurs car elle accède directement à la clé USB et écrase aveuglément son contenu.</para>

      <para>Une explication plus détaillée est disponible dans le manuel de l'installateur. Elle couvre notamment une méthode alternative (et plus complexe) pour préparer votre clé USB mais qui permet de personnaliser les options par défaut de l'installateur (celles consignées dans la ligne de commande du noyau). <ulink type="block" url="http://www.debian.org/releases/stable/amd64/ch04s03.html" /></para>
    </section>
    <section id="sect.install-net">
      <title>Installation par <foreignphrase>boot</foreignphrase> réseau</title>
      <indexterm><primary>installation</primary><secondary><emphasis>netboot</emphasis></secondary></indexterm>
      <indexterm><primary>installation</primary><secondary><emphasis>PXE</emphasis></secondary></indexterm>
      <indexterm><primary>installation</primary><secondary><emphasis>TFTP</emphasis></secondary></indexterm>

      <para>De nombreux BIOS permettent d'amorcer directement sur le réseau en téléchargeant un noyau et un système de fichiers minimal. Cette méthode (que l'on retrouve sous différents noms, notamment <acronym>PXE</acronym> ou <foreignphrase>boot</foreignphrase> <acronym>TFTP</acronym>) peut être salvatrice si l'ordinateur ne dispose pas de lecteur de CD-Rom ou si le BIOS ne peut amorcer sur un tel support.</para>

      <para>Cette méthode d'initialisation fonctionne en deux étapes. Premièrement, lors du démarrage de l'ordinateur, le BIOS (ou la carte réseau) émet une requête BOOTP/DHCP pour obtenir une adresse IP de manière automatique. Lorsqu'un serveur BOOTP ou DHCP renvoie une réponse, celle-ci inclut un nom de fichier en plus des paramètres réseau. Après avoir configuré le réseau, l'ordinateur client émet alors une requête TFTP <foreignphrase>(Trivial File Transfer Protocol)</foreignphrase> pour obtenir le fichier qui lui a été indiqué. Ce fichier récupéré, il est exécuté comme s'il s'agissait d'un chargeur de démarrage, ce qui permet de lancer le programme d'installation Debian — celui-ci s'exécute alors comme s'il provenait d'un disque dur, d'un CD-Rom ou d'une clé USB.</para>

      <para>Tous les détails de cette méthode sont disponibles dans le guide d'installation (section « Préparer les fichiers pour amorcer depuis le réseau avec TFTP »). <ulink type="block" url="http://www.debian.org/releases/stable/amd64/ch05s01.html#boot-tftp" /> <ulink type="block" url="http://www.debian.org/releases/stable/amd64/ch04s05.html" /></para>
    </section>
    <section id="sect.install-auto">
      <title>Autres méthodes d'installation</title>

      <para>Lorsqu'il s'agit de déployer des installations personnalisées sur un grand nombre d'ordinateurs, on opte généralement pour des approches plus automatisées. Selon les cas et la complexité des installations à effectuer, on emploiera plutôt FAI (<foreignphrase>Fully Automatic Installer</foreignphrase>, voir <xref linkend="sect.fai" />), ou un CD-Rom d'installation personnalisé avec préconfiguration (voir <xref linkend="sect.d-i-preseeding" />).</para>
    </section>
  </section>
  <section id="sect.installation-steps">
    <title>Étapes du programme d'installation</title>
    <section id="sect.install-boot">
      <title>Exécution du programme d'installation</title>

      <para>Dès que le BIOS a lancé l'amorçage sur le CD-Rom (ou le DVD-Rom), le menu du chargeur d'amorçage Isolinux apparaît. À ce stade, le noyau Linux n'est pas encore chargé ; ce menu permet justement de choisir le noyau à démarrer et de saisir d'éventuelles options à lui passer.</para>

      <para>Pour une installation standard, il suffit de sélectionner (avec les touches flèches) <guimenuitem>Install</guimenuitem> ou <guimenuitem>Graphical install</guimenuitem>, puis d'appuyer sur la touche <keycap>Entrée</keycap> pour enchaîner sur la suite de l'installation. Si le DVD-Rom est de type « Multi-arch » et si la machine dispose d'un processeur 64 bits de Intel ou AMD, des entrées de menu <guimenuitem>64 bit install</guimenuitem> et <guimenuitem>64 bit graphical install</guimenuitem> permettent d'installer la variante 64 bits <emphasis>(amd64)</emphasis> au lieu de celle par défaut (<emphasis>i386</emphasis> en 32 bits). Dans la pratique, la variante 64 bits peut être utilisée de manière quasi systématique : les processeurs récents fonctionnent tous en 64 bits et cette variante gère mieux les grosses quantités de mémoire vive dont disposent les ordinateurs récents.</para>

      <sidebar>
        <title><emphasis>POUR ALLER PLUS LOIN</emphasis> 32 ou 64 bits ?</title>
        <indexterm><primary>PAE</primary></indexterm>
        <indexterm><primary><foreignphrase>Physical Address Extension</foreignphrase></primary></indexterm>
        <indexterm><primary>32/64 bits, choix</primary></indexterm>

	<para>La différence fondamentale entre les systèmes 32 et 64 bits est la taille des adresses mémoire. En théorie, un système 32 bits ne peut exploiter plus de 4 Go de mémoire vive (2<superscript>32</superscript> octets). En pratique, il est possible de contourner cette limite en utilisant la variante <literal>686-pae</literal> du noyau à condition que le processeur gère la fonctionnalité PAE <foreignphrase>(Physical Address Extension)</foreignphrase>. Son usage a toutefois un impact non négligeable sur les performances du système. C'est pourquoi un serveur disposant d'une grande quantité de mémoire vive a tout intérêt à exploiter le mode 64 bits.</para>

	<para>Pour un poste bureautique (où quelques pour cent de performance sont négligeables), on sera plus sensible au fait que certains logiciels propriétaires ne sont pas disponibles en version 64 bits (Skype par exemple). Il est techniquement possible de les faire fonctionner sur le système 64 bits, mais il faudra installer les versions 32 bits de toutes les bibliothèques nécessaires (voir <xref linkend="sect.multi-arch" />) et éventuellement faire usage de <command>setarch</command> ou <command>linux32</command> (dans le paquet <emphasis role="pkg">util-linux</emphasis>) pour tromper les applications sur la nature du système. <indexterm><primary><command>setarch</command></primary></indexterm> <indexterm><primary><command>linux32</command></primary></indexterm></para>
      </sidebar>

      <sidebar>
        <title><emphasis>EN PRATIQUE</emphasis> Installation à côté d'un Windows existant</title>
        <indexterm><primary><foreignphrase>dual boot</foreignphrase></primary></indexterm>

	<para>Si l'ordinateur fonctionne déjà sous Windows, il n'est pas nécessaire de supprimer ce système pour installer Debian. On peut en effet disposer des deux systèmes à la fois, chacun installé sur un disque ou une partition, et choisir lequel lancer au démarrage de l'ordinateur. Cette configuration est souvent appelée <foreignphrase>dual boot</foreignphrase> et le système d'installation de Debian peut tout à fait la mettre en place. Elle intervient lors de la phase de partitionnement du disque dur et lors de la mise en place du chargeur de démarrage (voir les encadrés <xref linkend="sidebar.shrinking-partition" /> et <xref linkend="sidebar.bootloader-dual-boot" />).</para>

	<para>Si l'on a déjà un Windows fonctionnel, on pourra même se passer de la récupération des CD-Rom ; Debian propose un programme Windows permettant de télécharger un installateur Debian allégé et de le mettre en place sur le disque dur. Il suffit alors de redémarrer l'ordinateur pour choisir entre le lancement normal de Windows et celui du programme d'installation. On le trouve également sur un site web dédié au nom plutôt explicite… <ulink type="block" url="http://ftp.fr.debian.org/debian/tools/win32-loader/stable/" /> <ulink type="block" url="http://www.goodbye-microsoft.com/" /></para>
      </sidebar>

      <sidebar>
        <title><emphasis>B.A.-BA</emphasis> Chargeur d'amorçage</title>
        <indexterm><primary>chargeur</primary><secondary>de démarrage</secondary></indexterm>
        <indexterm><primary>amorçage, chargeur de</primary></indexterm>
        <indexterm><primary>démarrage</primary><secondary>chargeur de</secondary></indexterm>

	<para>Le chargeur d'amorçage (ou de démarrage), <foreignphrase>bootloader</foreignphrase> en anglais, est un programme de bas niveau chargé de démarrer le noyau Linux juste après que le BIOS lui a passé la main. Pour mener cette mission à bien, il doit être capable de « retrouver » sur le disque le noyau Linux à démarrer. Sur les architecture amd64 et i386, les deux programmes les plus employés pour effectuer cette tâche sont LILO, le plus ancien, et GRUB, son successeur plus moderne. Isolinux et Syslinux sont des alternatives souvent employées pour démarrer depuis des supports amovibles.</para>
      </sidebar>

      <para>Derrière chaque entrée de menu se cache une ligne de commande de démarrage spécifique que l'on peut personnaliser au besoin en appuyant sur <keycap>TAB</keycap> avant de valider et démarrer. L'entrée de menu <guimenuitem>Help</guimenuitem> fait apparaître l'ancienne interface en ligne de commande où les touches <keycap>F1</keycap> à <keycap>F10</keycap> affichent différents écrans d'aide détaillant les options possibles à l'invite. Sauf exceptions, vous n'aurez normalement pas besoin de vous servir de cette possibilité.</para>

      <para>Le mode « expert » (accessible dans le menu <guimenuitem>Advanced options</guimenuitem>, « Options avancées ») détaille toutes les options possibles au cours de l'installation et permet de naviguer entre les différentes étapes sans qu'elles s'enchaînent automatiquement. Attention, ce mode très verbeux pourra dérouter par la multitude des choix de configuration qu'il propose.</para>

      <figure>
        <title>Écran de démarrage</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-boot.png" scalefit="1" width="65%" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>Une fois démarré, le programme d'installation nous guide d'étape en étape tout au long du processus. Cette section détaille chacune d'entre elles, leurs tenants et leurs aboutissants. Nous suivons le déroulement correspondant à un DVD-Rom Multi-Arch (plus précisément, la version beta4 de l'installateur de Jessie) ; les autres types d'installations (<emphasis>netinst</emphasis> notamment) peuvent varier quelque peu. Nous allons également nous concentrer sur l'installation en mode graphique, mais elle ne diffère de l'installation « classique » que par l'aspect visuel.</para>
    </section>
    <section id="sect.install-lang">
      <title>Choix de la langue</title>
      <indexterm><primary>choix</primary><secondary>de la langue</secondary></indexterm>

      <para>Le programme d'installation débute en anglais mais la toute première étape consiste à choisir la langue utilisée par la suite. Opter pour le français fournira une installation entièrement traduite (et un système configuré en français à l'issue du processus). Cela permettra également de proposer des choix par défaut plus pertinents lors des étapes suivantes (la disposition du clavier notamment).</para>

      <sidebar>
        <title><emphasis>B.A.-BA</emphasis> Naviguer grâce au clavier</title>

	<para>Certaines étapes du processus d'installation nécessitent une saisie d'informations. Ces écrans disposent alors de plusieurs zones qui peuvent « avoir le <foreignphrase>focus</foreignphrase> » (zone de saisie de texte, cases à cocher, liste de choix, boutons <guibutton>OK</guibutton> et <guibutton>Annuler</guibutton>), et la touche <keycap>Tabulation</keycap> permet de circuler entre elles.</para>

	<para>En mode graphique, on utilise la souris comme on l'utiliserait sur un bureau graphique fonctionnel.</para>
      </sidebar>

      <figure role="flow.inline">
        <title>Choix de la langue</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-lang.png" scalefit="1" width="50%" />
          </imageobject>
        </mediaobject>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-lang-txt.png" scalefit="1" width="50%" />
          </imageobject>
        </mediaobject>
      </figure>
    </section>
    <section id="sect.install-country">
      <title>Choix du pays</title>
      <indexterm><primary>choix</primary><secondary>du pays</secondary></indexterm>

      <para>La deuxième étape consiste à choisir le pays. Combinée à la langue, cette information permettra de proposer une disposition de clavier encore plus adaptée. Elle influera aussi sur la configuration du fuseau horaire. Dans le cas de la France, un clavier de type AZERTY sera proposé et le fuseau horaire sera <guimenuitem>Europe/Paris</guimenuitem></para>

      <figure role="flow.inline">
        <title>Choix du pays</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-country.png" scalefit="1" width="50%" />
          </imageobject>
        </mediaobject>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-country-txt.png" scalefit="1" width="50%" />
          </imageobject>
        </mediaobject>
      </figure>
    </section>
    <section id="sect.install-keyboard">
      <title>Choix de la disposition du clavier</title>
      <indexterm><primary>disposition du clavier</primary></indexterm>
      <indexterm><primary>clavier, disposition du</primary></indexterm>

      <para>Le clavier <guimenuitem>Français</guimenuitem> proposé convient pour les claviers AZERTY traditionnels. Il prend en charge le symbole euro.</para>

      <figure role="flow.inline">
        <title>Choix du clavier</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-keyboard.png" scalefit="1" width="50%" />
          </imageobject>
        </mediaobject>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-keyboard-txt.png" scalefit="1" width="50%" />
          </imageobject>
        </mediaobject>
      </figure>
    </section>
    <section id="sect.install-detect-hardware">
      <title>Détection du matériel</title>

      <para>Cette étape est entièrement automatique dans la plupart des cas. L'installateur détecte le matériel et cherche notamment à identifier le lecteur de CD-Rom employé afin de pouvoir accéder à son contenu. Il charge les modules correspondant aux différents éléments détectés, puis « monte » le CD-Rom afin de pouvoir le lire. Les étapes précédentes étaient entièrement contenues dans l'image de démarrage intégrée au CD-Rom, fichier de taille limitée et chargé en mémoire par le BIOS lors de l'amorçage du CD-Rom.</para>

      <para>L'installateur gère l'immense majorité des lecteurs, en particulier les périphériques ATAPI (parfois appelés IDE ou EIDE) standards. Toutefois, si la détection du lecteur de CD-Rom échoue, l'installateur propose de charger (par exemple depuis une clé USB) un module noyau correspondant au pilote du CD-Rom.</para>
    </section>
    <section id="sect.install-load-components">
      <title>Chargement des composants</title>

      <para>Le contenu du CD-Rom désormais accessible, l'installateur rapatrie tous les fichiers nécessaires à la poursuite de sa tâche. Cela comprend des pilotes supplémentaires pour le reste du matériel (et notamment la carte réseau) ainsi que tous les composants du programme d'installation.</para>
    </section>
    <section id="sect.install-detect-network">
      <title>Détection du matériel réseau</title>

      <para>Cette étape automatique cherche à identifier la carte réseau et à charger le module correspondant. À défaut de reconnaissance automatique, il est possible de sélectionner manuellement le module à charger. Si aucun module ne fonctionne, il est possible de charger un module spécifique depuis un périphérique amovible. Cette dernière solution ne sert réellement que si le pilote adéquat n'est pas intégré au noyau Linux standard s'il est disponible par ailleurs, par exemple sur le site du fabricant.</para>

      <para>Cette étape doit absolument réussir pour les installations de type <emphasis>netinst</emphasis> puisque les paquets Debian doivent y être chargés sur le réseau.</para>
    </section>
    <section id="sect.install-network-config">
      <title>Configuration du réseau</title>
      <indexterm><primary>configuration</primary><secondary>du réseau</secondary><tertiary>statique</tertiary></indexterm>
      <indexterm><primary>configuration</primary><secondary>du réseau</secondary><tertiary>DHCP</tertiary></indexterm>

      <para>Soucieux d'automatiser au maximum le processus, l'installateur tente une configuration automatique du réseau par DHCP (pour IPv4) et par découverte du réseau IPv6. Si celle-ci échoue, il propose plusieurs choix : réessayer une configuration DHCP normale, effectuer une configuration DHCP en annonçant un nom de machine, ou mettre en place une configuration statique du réseau.</para>

      <para>Cette dernière demande successivement une adresse IP, un masque de sous-réseau, une adresse IP pour une éventuelle passerelle, un nom de machine et un nom de domaine.</para>

      <sidebar>
        <title><emphasis>ASTUCE</emphasis> Configuration sans DHCP</title>

	<para>Si le réseau local est équipé d'un serveur DHCP que vous ne souhaitez pas utiliser car vous préférez définir une adresse IP statique pour la machine en cours d'installation, vous pourrez lors du démarrage sur le CD-Rom ajouter l'option <userinput>netcfg/use_dhcp=false</userinput>. Il suffit de se placer sur l'entrée de menu désirée, d'appuyer sur <keycap>TAB</keycap> et d'ajouter l'option ci-dessus avant de valider par <keycap>Entrée</keycap>.</para>
      </sidebar>

      <sidebar>
        <title><emphasis>ATTENTION</emphasis> Ne pas improviser</title>

	<para>Beaucoup de réseaux locaux reposant sur une confiance concédée a priori à toutes les machines, une configuration inadéquate d'un ordinateur y cause souvent des dysfonctionnements. Par conséquent, ne connectez pas votre machine à un réseau sans convenir au préalable avec son administrateur des modalités correspondantes (par exemple le numéro IP, le masque réseau, l'adresse de <foreignphrase>broadcast</foreignphrase>...).</para>
      </sidebar>
    </section>
    <section>
      <title>Mot de passe administrateur</title>
      <indexterm><primary>compte</primary><secondary>administrateur</secondary></indexterm>

      <para>Le compte super-utilisateur <literal>root</literal>, réservé à l'administrateur de la machine, est automatiquement créé lors de l'installation : c'est pourquoi un mot de passe est demandé. Une confirmation (ou deuxième saisie identique) évitera toute erreur de saisie, difficile à retrouver ensuite !</para>

      <figure>
        <title>Mot de passe administrateur</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-rootpw.png" scalefit="1" width="65%" />
          </imageobject>
        </mediaobject>
      </figure>

      <sidebar>
        <title><emphasis>SÉCURITÉ</emphasis> Mot de passe administrateur</title>

	<para>Le mot de passe de l'utilisateur <literal>root</literal> doit être long (8 caractères ou plus) et impossible à deviner. En effet, tout ordinateur (et a fortiori tout serveur) connecté à Internet fait régulièrement l'objet de tentatives de connexions automatisées avec les mots de passe les plus évidents. Parfois, il fera même l'objet d'attaques au dictionnaire, où diverses combinaisons de mots et de chiffres sont testées en tant que mots de passe. Évitez aussi les noms des enfants ou parents et autres dates de naissance : de nombreux collègues les connaissent et il est rare que l'on souhaite leur donner libre accès à l'ordinateur concerné.</para>

	<para>Ces remarques valent également pour les mots de passe des autres utilisateurs, mais les conséquences d'une compromission sont moindres dans le cas d'un utilisateur sans droits particuliers.</para>

	<para>Si l'inspiration vient à manquer, il ne faut pas hésiter à utiliser des générateurs de mot de passe comme <command>pwgen</command> (dans le paquet de même nom).</para>
      </sidebar>
    </section>
    <section>
      <title>Création du premier utilisateur</title>

      <para>Debian impose également de créer un compte utilisateur standard pour que l'administrateur ne prenne pas la mauvaise habitude de travailler en tant que <literal>root</literal>. Le principe de précaution veut en effet que chaque tâche soit effectuée avec le minimum de droits nécessaires, pour limiter l'impact d'une mauvaise manipulation. C'est pourquoi l'installateur vous demandera successivement le nom complet de ce premier utilisateur, son identifiant et son mot de passe (deux fois, pour limiter les risques d'erreur de saisie).</para>

      <figure>
        <title>Nom du premier utilisateur</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-username.png" scalefit="1" width="65%" />
          </imageobject>
        </mediaobject>
      </figure>
    </section>
    <section id="sect.install-clock-config">
      <title>Configuration de l'horloge</title>

      <para>Si le réseau est disponible, l'horloge interne du système est mise à jour (de façon ponctuelle et instantanée) à l'aide d'un serveur NTP. Les horodatages des logs seront ainsi précis dès le premier démarrage. Pour qu'ils restent précis dans la durée, il faudra tout de même mettre en place un démon NTP après l'installation initiale (voir <xref linkend="sect.time-synchronization" />).</para>
    </section>
    <section id="sect.install-detect-disks">
      <title>Détection des disques et autres périphériques</title>

      <para>Cette étape automatique détecte les disques susceptibles d'accueillir Debian. Ils seront proposés dans l'étape suivante : le partitionnement.</para>
    </section>
    <section id="sect.install-partman">
      <title>Démarrage de l'outil de partitionnement</title>
      <indexterm><primary>partitionnement</primary></indexterm>

      <sidebar>
        <title><emphasis>CULTURE</emphasis> Utilité du partitionnement</title>

	<para>Le partitionnement, étape indispensable de l'installation, consiste à diviser l'espace disponible sur les disques durs (chaque sous-partie étant alors appelée une « partition ») en fonction des données à stocker et de l'usage prévu de l'ordinateur. Cette étape intègre aussi le choix des systèmes de fichiers employés. Toutes ces décisions ont une influence en termes de performances, de sécurité des données et d'administration du serveur.</para>
      </sidebar>

      <para>L'étape du partitionnement est traditionnellement difficile pour les utilisateurs débutants. Il faut en effet définir les différentes portions des disques (ou « partitions ») qui accueilleront le système de fichiers de Linux et sa mémoire virtuelle <foreignphrase>(swap)</foreignphrase>. La tâche se complique si un autre système d'exploitation existe déjà et si on souhaite le conserver. En effet, il faudra alors veiller à ne pas altérer ses partitions (ou à les redimensionner de manière indolore).</para>

      <para>Fort heureusement, le logiciel de partitionnement dispose d'un mode « assisté » qui propose à l'utilisateur les partitions à créer. Dans la majorité des cas, il suffit de valider ses propositions.</para>

      <figure>
        <title>Choix du mode de partitionnement</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-partman.png" scalefit="1" width="65%" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>Le premier écran de l'utilitaire de partitionnement propose d'employer un disque complet pour créer les diverses partitions. Pour un ordinateur (neuf) qui sera dédié à Linux, cette option est vraisemblablement la plus simple et l'on choisira donc l'option <guimenuitem>Assisté - utiliser un disque entier</guimenuitem>. Si l'ordinateur compte deux disques pour deux systèmes d'exploitation, consacrer un disque à chacun est également une solution facilitant le partitionnement. Dans ces deux cas, l'écran suivant permet de choisir le disque à consacrer à Linux en validant l'option correspondante (par exemple, <guimenuitem>SCSI1 (0,0,0) (sda) - 12.9 GB ATA VBOX HARDDISK</guimenuitem> pour installer Debian sur le premier disque). Vous débutez alors un partitionnement assisté.</para>

      <figure>
        <title>Disque à utiliser pour le partitionnement assisté</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-partman-disk.png" scalefit="1" width="65%" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>Le partitionnement assisté est également capable de mettre en place des volumes logiques LVM au lieu de partitions (voir plus bas). Le reste du fonctionnement restant le même, nous ne détaillerons pas les options <guimenuitem>Assisté - utiliser tout un disque avec LVM</guimenuitem> (chiffré ou non).</para>

      <para>Dans les autres cas, quand Linux doit cohabiter avec des partitions déjà présentes, il faudra opter pour un partitionnement manuel.</para>
      <section id="sect.install-autopartman-mode">
        <title>Partitionnement assisté</title>
        <indexterm><primary>partitionnement</primary><secondary>assisté</secondary></indexterm>

	<para>L'outil de partitionnement assisté propose trois méthodes de partitionnement, qui correspondent à des usages différents.</para>

        <figure>
          <title>Partitionnement assisté</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/inst-autopartman-mode.png" scalefit="1" width="65%" />
            </imageobject>
          </mediaobject>
        </figure>

	<para>La première méthode s'intitule <guimenuitem>Tout dans une seule partition</guimenuitem>. Toute l'arborescence du système Linux est stockée dans un seul système de fichiers, correspondant à la racine <filename>/</filename>. Ce partitionnement simple et robuste convient parfaitement pour des ordinateurs personnels ou mono-utilisateurs. En réalité, deux partitions verront le jour : la première abritera le système complet ; la seconde, la mémoire virtuelle.</para>

	<para>La deuxième méthode, <guimenuitem>Partition /home séparée</guimenuitem>, est similaire mais découpe l'arborescence en deux : une partie contient le système Linux (<filename>/</filename>) et la seconde les répertoires personnels (c'est-à-dire les données des utilisateurs, dans les fichiers placés sous <filename>/home/</filename>).</para>

	<para>La dernière méthode de partitionnement, intitulée <guimenuitem>Partitions /home, /var et /tmp séparées</guimenuitem>, convient pour les serveurs et les systèmes multi-utilisateurs. Elle découpe l'arborescence en de nombreuses partitions : en plus de la racine (<filename>/</filename>) et des comptes utilisateurs (<filename>/home/</filename>), elle prévoit des partitions pour les données des logiciels serveurs (<filename>/var/</filename>) et pour les fichiers temporaires (<filename>/tmp/</filename>). Ces divisions ont plusieurs avantages. Les utilisateurs ne pourront pas bloquer le serveur en consommant tout l'espace disque disponible (ils ne pourront remplir que <filename>/tmp/</filename> et <filename>/home/</filename>). Les données des démons (et notamment les logs) ne pourront pas non plus bloquer le reste du système.</para>

        <sidebar>
          <title><emphasis>B.A.-BA</emphasis> Choisir un système de fichiers</title>
          <indexterm><primary>système</primary><secondary>de fichiers</secondary></indexterm>
          <indexterm><primary>fichiers</primary><secondary>système de</secondary></indexterm>

	  <para>Un système de fichiers définit la manière d'organiser les données sur un disque. Chaque système de fichiers existant a ses mérites et ses limitations. Certains sont plus robustes, d'autres plus efficaces : si l'on connaît bien ses besoins, le choix d'un système de fichiers plus adapté est possible. De nombreuses comparaisons ont déjà été réalisées ; il semblerait que ReiserFS soit particulièrement efficace pour la lecture de nombreux petits fichiers ; <emphasis>XFS</emphasis>, quant à lui, est plus véloce avec de gros fichiers. <emphasis>Ext4</emphasis>, le système employé par défaut chez Debian, est un bon compromis, par ailleurs basé sur les trois précédentes versions du système de fichiers historiquement utilisé par Linux (<emphasis>ext</emphasis>, <emphasis>ext2</emphasis>, et <emphasis>ext3</emphasis>). <emphasis>Ext4</emphasis> corrige certaines limitations de <emphasis>ext3</emphasis> et est particulièrement adapté aux disques de très grande capacité. Une autre possibilité est d'expérimenter le très prometteur <emphasis>btrfs</emphasis> qui intègre de nombreuses fonctionnalités qui nécessitaient jusqu'à présent l'usage de LVM et/ou RAID.</para>

	  <para>Un système de fichiers journalisé (comme <emphasis>ext3</emphasis>, <emphasis>ext4</emphasis>, <emphasis>btrfs</emphasis>, <emphasis>reiserfs</emphasis> ou <emphasis>xfs</emphasis>) prend des dispositions particulières afin qu'en cas d'interruption brutale, il soit toujours possible de revenir dans un état cohérent sans être contraint à une analyse complète du disque (comme c'était le cas avec le système <emphasis>ext2</emphasis>). Cette fonctionnalité est obtenue en remplissant un journal décrivant les opérations à effectuer avant de les exécuter réellement. Si une opération est interrompue, il sera possible de la « rejouer » à partir du journal. Inversement, si une interruption a lieu en cours de mise à jour du journal, le dernier changement demandé est simplement ignoré : les données en cours d'écriture sont peut-être perdues, mais les données sur le disque n'ayant pas changé, elles sont restées cohérentes. Il s'agit ni plus ni moins d'un mécanisme transactionnel appliqué au système de fichiers.</para>
        </sidebar>

	<para>Après le choix du type de partitionnement, le logiciel calcule une proposition, qu'il détaille à l'écran et que l'on peut au besoin modifier. On peut notamment choisir un autre système de fichiers si le choix standard (<emphasis>ext4</emphasis>) ne convient pas. Dans la plupart des cas, il suffit cependant d'accepter la proposition de partitionnement en validant l'option <guimenuitem>Terminer le partitionnement et appliquer les changements</guimenuitem>.</para>

        <figure>
          <title>Valider le partitionnement</title>
          <mediaobject>
            <imageobject>
              <imagedata fileref="images/inst-partman-validation.png" scalefit="1" width="65%" />
            </imageobject>
          </mediaobject>
        </figure>
      </section>
      <section id="sect.manual-partitioning">
        <title>Partitionnement manuel</title>
        <indexterm><primary>partitionnement</primary><secondary>manuel</secondary></indexterm>

	<para>Le partitionnement manuel offre plus de souplesse et permet de choisir le rôle et la taille de chaque partition. Par ailleurs, ce mode est inévitable pour employer le RAID logiciel.</para>

        <sidebar id="sidebar.shrinking-partition">
          <title><emphasis>EN PRATIQUE</emphasis> Réduire une partition Windows</title>
          <indexterm><primary>redimensionner une partition</primary></indexterm>
          <indexterm><primary>réduire une partition</primary></indexterm>

	  <para>Pour installer Debian à côté d'un système existant (Windows ou autre), il faut disposer d'un espace sur le disque qui ne soit pas utilisé par cet autre système, de manière à pouvoir y créer les partitions dédiées à Debian. Dans la majorité des cas, cela impliquera de réduire la partition Windows et de réutiliser l'espace ainsi libéré.</para>

	  <para>L'installateur Debian permet d'effectuer cette opération, à condition de l'utiliser en manuel. Il suffit alors de sélectionner la partition Windows et de saisir sa nouvelle taille (cela fonctionne aussi bien avec les partitions FAT que NTFS).</para>
        </sidebar>

	<para>Le premier écran affiche les disques, les partitions qui les composent et tout éventuel espace libre non encore partitionné. On peut sélectionner chaque élément affiché ; une pression sur la touche <keycap>Entrée</keycap> donne alors une liste d'actions possibles.</para>

	<para>On peut effacer toutes les partitions d'un disque en sélectionnant celui-ci.</para>

	<para>En sélectionnant un espace libre d'un disque, on peut créer manuellement une nouvelle partition. Il est également possible d'y effectuer un partitionnement assisté, solution intéressante pour un disque contenant déjà un système d'exploitation mais que l'on souhaite partitionner pour Linux de manière standard. Reportez-vous à la <xref linkend="sect.install-autopartman-mode" /> pour plus de détails sur le partitionnement assisté.</para>

        <sidebar>
          <title><emphasis>B.A.-BA</emphasis> Point de montage</title>
          <indexterm><primary>point de montage</primary></indexterm>
          <indexterm><primary>point de montage</primary></indexterm>

	  <para>Le point de montage est le répertoire de l'arborescence qui abritera le contenu du système de fichiers de la partition sélectionnée. Ainsi, une partition montée sur <filename>/home/</filename> est traditionnellement prévue pour contenir les données des utilisateurs.</para>

	  <para>Si ce répertoire se nomme « <filename>/</filename> », on parle alors de la <emphasis>racine</emphasis> de l'arborescence, donc de la partition qui va réellement accueillir le système Debian.</para>
        </sidebar>

        <sidebar>
          <title><emphasis>B.A.-BA</emphasis> Mémoire virtuelle, <foreignphrase>swap</foreignphrase></title>
          <indexterm><primary>mémoire virtuelle</primary></indexterm>
          <indexterm><primary><foreignphrase>swap</foreignphrase></primary></indexterm>
          <indexterm><primary>partition</primary><secondary>d'échange</secondary></indexterm>
          <indexterm><primary>échange, partition de</primary></indexterm>

	  <para>La mémoire virtuelle permet au noyau Linux en manque de mémoire vive (RAM) de libérer un peu de place en stockant sur la partition d'échange, donc sur le disque dur, une partie du contenu de la RAM restée inactive un certain temps.</para>

	  <para>Pour simuler la mémoire supplémentaire, Windows emploie un fichier d'échange contenu directement sur un système de fichiers. À l'inverse, Linux emploie une partition dédiée à cet usage, d'où le terme de « partition d'échange ».</para>
        </sidebar>

	<para>En sélectionnant une partition, on peut indiquer la manière dont on va l'utiliser :</para>
        <itemizedlist>
          <listitem>
	    <para>la formater et l'intégrer à l'arborescence en choisissant un point de montage ;</para>
          </listitem>
          <listitem>
	    <para>l'employer comme partition d'échange <foreignphrase>(swap)</foreignphrase> ;</para>
          </listitem>
          <listitem>
	    <para>en faire un <guimenuitem>volume physique pour chiffrement</guimenuitem> (pour protéger la confidentialité des données de certaines partitions, voir plus loin) ;</para>
          </listitem>
          <listitem>
	    <para>en faire un <guimenuitem>volume physique pour LVM</guimenuitem> (notion détaillée plus loin dans ce chapitre) ;</para>
          </listitem>
          <listitem>
	    <para>l'utiliser comme périphérique RAID (voir plus loin dans ce chapitre) ;</para>
          </listitem>
          <listitem>
	    <para>ou ne pas l'exploiter et la laisser inchangée.</para>
          </listitem>
        </itemizedlist>
      </section>
      <section id="sect.install-software-raid">
        <title>Emploi du RAID logiciel</title>
        <indexterm><primary>RAID</primary><secondary>RAID logiciel</secondary></indexterm>
        <indexterm><primary>RAID logiciel</primary></indexterm>
        <indexterm><primary>périphérique</primary><secondary>multi-disques</secondary></indexterm>

	<para>Certains types de RAID permettent de dupliquer les informations stockées sur des disques durs pour éviter toute perte de données en cas de problème matériel condamnant l'un d'entre eux. Le RAID de niveau 1 maintient une simple copie fidèle (miroir) d'un disque sur un autre, alors que le RAID de niveau 5 répartit sur plusieurs disques des informations redondantes qui permettront de reconstituer intégralement un disque défaillant.</para>

	<para>Nous traiterons ici du RAID de niveau 1, le plus simple à mettre en œuvre. La première étape est de créer deux partitions de taille identique situées sur deux disques différents et de les étiqueter <guimenuitem>volume physique pour RAID</guimenuitem>.</para>

	<para>Il faut ensuite choisir dans l'outil de partitionnement l'élément <guimenuitem>Configurer le RAID avec gestion logicielle</guimenuitem> pour transformer ces deux partitions en un nouveau disque virtuel et sélectionner <guimenuitem>Créer un périphérique multidisque</guimenuitem> dans cet écran de configuration. Suit alors une série de questions concernant ce nouveau périphérique. La première s'enquiert du niveau de RAID à employer — <guimenuitem>RAID1</guimenuitem> dans notre cas. La deuxième demande le nombre de périphériques actifs — deux ici, soit le nombre de partitions à intégrer dans ce périphérique RAID logiciel. La troisième question concerne le nombre de périphériques de réserve — zéro ; on n'a prévu aucun disque supplémentaire pour prendre immédiatement la relève d'un éventuel disque défectueux. La dernière question demande de choisir les partitions retenues pour le périphérique RAID — soit les deux qu'on a prévues à cet usage (on veillera bien à ne sélectionner que des partitions mentionnant explicitement <guimenuitem>raid</guimenuitem>).</para>

	<para>Au retour dans le menu principal, un nouveau disque virtuel <guimenuitem>RAID</guimenuitem> apparaît. Ce disque est présenté avec une unique partition qu'on ne peut pas supprimer mais que l'on peut affecter à l'usage de son choix (comme n'importe quelle autre partition).</para>

	<para>Pour plus de détails sur le fonctionnement du RAID, on se reportera à la <xref linkend="sect.raid-soft" />.</para>
      </section>
      <section id="sect.install-lvm">
        <title>Emploi de LVM (<foreignphrase>Logical Volume Manager</foreignphrase>)</title>
        <indexterm><primary>LVM</primary> <secondary>à l'installation</secondary></indexterm>
        <indexterm><primary><foreignphrase>Logical Volume Manager</foreignphrase></primary> <secondary>à l'installation</secondary></indexterm>

	<para>LVM permet de créer des partitions « virtuelles » s'étendant sur plusieurs disques. L'intérêt est double : les tailles des partitions ne sont plus limitées par celles des disques individuels mais par leur volume cumulé et on peut à tout moment augmenter la taille d'une partition existante, en ajoutant au besoin un disque supplémentaire.</para>

	<para>LVM emploie une terminologie particulière : une partition virtuelle est un « volume logique », lui-même compris dans un « groupe de volumes », ou association de plusieurs « volumes physiques ». Chacun de ces derniers correspond en fait à une partition « réelle » (ou à une partition RAID logicielle).</para>
        <indexterm><primary>volumes</primary><secondary>logiques</secondary></indexterm>
        <indexterm><primary>volumes</primary><secondary>physiques</secondary></indexterm>
        <indexterm><primary>groupe</primary><secondary>de volumes</secondary></indexterm>
        <indexterm><primary>volumes</primary><secondary>groupe de</secondary></indexterm>

	<para>Cette technique fonctionne assez simplement : chaque volume, physique ou logique, est découpé en blocs de même taille, que LVM fait correspondre entre eux. L'ajout d'un nouveau disque entraîne la création d'un nouveau volume physique et ses nouveaux blocs pourront être associés à n'importe quel groupe de volumes. Toutes les partitions du groupe de volumes ainsi agrandi disposeront alors d'espace supplémentaire pour s'étendre.</para>

	<para>L'outil de partitionnement configure LVM en plusieurs étapes. Il faut d'abord créer sur les disques existants des partitions qui seront les <guimenuitem>volumes physiques LVM</guimenuitem>. Pour activer LVM, on choisira <guimenuitem>Configurer le gestionnaire de volumes logiques (LVM)</guimenuitem>, puis dans cet écran de configuration, <guimenuitem>Créer un groupe de volumes</guimenuitem> — auquel on associera les volumes physiques existants. Enfin, on pourra créer des volumes logiques au sein de ce groupe de volumes. On notera que le système de partitionnement automatique est capable de faire toute cette mise en place.</para>

	<para>Dans le menu du partitionneur, chaque volume logique apparaît comme un disque avec une seule partition que l'on ne peut pas supprimer mais que l'on peut affecter à l'usage de son choix.</para>

	<para>Le fonctionnement de LVM est détaillé dans la <xref linkend="sect.lvm" />.</para>
      </section>
      <section>
        <title>Chiffrement de partitions</title>
        <indexterm><primary>LUKS</primary></indexterm>
        <indexterm><primary>dm-crypt</primary></indexterm>
        <indexterm><primary>partition</primary><secondary>chiffrée</secondary></indexterm>
        <indexterm><primary>chiffrement de partitions</primary></indexterm>
        <indexterm><primary>confidentialité</primary><secondary>fichiers</secondary></indexterm>
        <indexterm><primary>fichier</primary><secondary>confidentialité</secondary></indexterm>

	<para>Pour garantir la confidentialité de vos données, par exemple en cas de perte ou de vol de votre ordinateur ou d'un disque dur, il est possible de chiffrer les données de partitions. Cette fonctionnalité peut se greffer très facilement en amont de n'importe quel système de fichiers puisque, comme pour LVM, Linux (et plus particulièrement le pilote <command>dm-crypt</command>) utilise le <foreignphrase>Device Mapper</foreignphrase> pour créer une partition virtuelle (dont le contenu sera protégé) en s'appuyant sur une partition sous-jacente qui stockera les données sous une forme chiffrée (grâce à LUKS — <foreignphrase>Linux Unified Key Setup</foreignphrase> soit « Configuration de clés unifiée pour Linux » — un format standard permettant de stocker les données chiffrées mais aussi des méta-informations indiquant les algorithmes de chiffrement employés).</para>

        <sidebar id="sidebar.encrypted-swap-partition">
          <title><emphasis>SÉCURITÉ</emphasis> Partition d'échange chiffrée</title>

	  <para>Lorsqu'une partition chiffrée est employée, la clé de chiffrement est stockée en mémoire vive. Obtenir cette clé permet également de déchiffrer les données. Il est donc vital de ne pas en laisser de copie accessible à l'éventuel voleur de l'ordinateur ou du disque, ou à un technicien de maintenance. C'est pourtant quelque chose qui peut facilement arriver avec un portable, puisque, lors d'une mise en veille prolongée, le contenu de la mémoire vive est stockée sur la partition d'échange. Si celle-ci n'est pas elle-même chiffrée, le voleur peut la récupérer et l'utiliser pour déchiffrer les données des partitions chiffrées. C'est pourquoi, lorsque vous employez des partitions chiffrées, il est impératif de chiffrer également la partition d'échange !</para>

	  <para>L'installateur Debian prévient l'utilisateur lorsqu'il essaye de créer une partition chiffrée et que la partition d'échange ne l'est pas.</para>
        </sidebar>

	<para>Pour créer une partition chiffrée, il faut d'abord attribuer une partition disponible à cet usage. Pour cela, il convient de la sélectionner et d'indiquer qu'elle sera utilisée comme <guimenuitem>volume physique pour chiffrement</guimenuitem>. Ensuite, et après que le partitionnement du disque contenant ce volume physique a été effectué, vous devrez sélectionner <guimenuitem>Configurer les volumes chiffrés</guimenuitem>. Il sera alors proposé d'initialiser le volume physique avec des données aléatoires (rendant plus difficile la localisation des données réelles) puis de saisir une <guimenuitem>phrase secrète de chiffrement</guimenuitem> qu'il vous faudra saisir à chaque démarrage de votre ordinateur afin d'accéder au contenu de votre partition chiffrée. Une fois cette étape terminée et de retour au menu de l'outil de partitionnement, une nouvelle partition est disponible dans un <guimenuitem>volume chiffré</guimenuitem> et vous pouvez désormais la configurer comme n'importe quelle autre partition. Le plus souvent, cette partition sera utilisée comme volume physique pour LVM afin de pouvoir protéger plusieurs partitions (volumes logiques LVM) avec la même clé de chiffrement, dont notamment la partition d'échange (voir encadré <xref linkend="sidebar.encrypted-swap-partition" />).</para>
      </section>
    </section>
    <section>
      <title>Installation du système de base Debian</title>
      <indexterm><primary>système</primary><secondary>de base</secondary></indexterm>

      <para>Cette étape, qui ne demande pas d'interaction de la part de l'utilisateur, installe les paquets du « système de base » de Debian. Celui-ci comprend les outils <command>dpkg</command> et <command>apt</command>, qui gèrent les paquets Debian, ainsi que les utilitaires nécessaires pour démarrer le système et commencer à l'exploiter.</para>

      <figure>
        <title>Installation du système de base</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-basesystem.png" scalefit="1" width="65%" />
          </imageobject>
        </mediaobject>
      </figure>
    </section>
    <section>
      <title>Configuration de l'outil de gestion des paquets (<command>apt</command>)</title>
      <indexterm><primary>configuration</primary><secondary>initiale d'APT</secondary></indexterm>
      <indexterm><primary>APT</primary><secondary>configuration initiale</secondary></indexterm>

      <para>Pour que l'on puisse installer des logiciels supplémentaires, il est nécessaire de configurer APT, en lui indiquant où trouver les paquets Debian. Cette étape est aussi automatisée que possible. Elle commence par une question demandant s'il faut utiliser une source de paquets sur le réseau, ou s'il faut se contenter des seuls paquets présents sur le CD-Rom.</para>

      <sidebar>
        <title><emphasis>NOTE</emphasis> CD-Rom Debian dans le lecteur</title>

	<para>Si l'installateur détecte un disque d'installation Debian dans le lecteur de CD-Rom, il n'est pas toujours nécessaire de configurer APT pour aller chercher des paquets sur le réseau : il est automatiquement configuré pour lire les paquets depuis ce lecteur. Si le disque fait partie d'un jeu de plusieurs, il proposera cependant d'« explorer » d'autres disques afin de référencer tous les paquets qu'ils stockent.</para>
      </sidebar>

      <para>S'il faut utiliser des paquets en provenance du réseau, les deux questions suivantes permettent de sélectionner un serveur sur lequel aller chercher ces paquets, en choisissant d'abord un pays, puis un miroir disponible dans ce pays (il s'agit d'un serveur public qui met à disposition une copie de tous les fichiers du serveur de Debian).</para>

      <figure>
        <title>Choix d'un miroir Debian</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-mirror.png" scalefit="1" width="65%" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>Enfin, le programme propose de recourir à un mandataire (proxy) HTTP. En son absence, l'accès à Internet sera direct. Si l'on tape <literal>http://proxy.falcot.com:3128</literal>, APT fera appel au <foreignphrase>proxy/cache</foreignphrase> de Falcot, un programme « Squid ». Il est possible de retrouver ces paramètres en consultant la configuration d'un navigateur web sur une autre machine connectée au même réseau.</para>

      <para>Les fichiers <filename>Packages.gz</filename> et <filename>Sources.gz</filename> sont ensuite automatiquement téléchargés pour mettre à jour la liste des paquets reconnus par APT.</para>

      <sidebar>
        <title><emphasis>B.A.-BA</emphasis> Mandataire HTTP, proxy</title>
        <indexterm><primary>proxy</primary></indexterm>
        <indexterm><primary><foreignphrase>proxy cache</foreignphrase></primary></indexterm>
        <indexterm><primary>cache, proxy</primary></indexterm>
        <indexterm><primary>Squid</primary></indexterm>

	<para>Un mandataire (ou proxy) HTTP est un serveur effectuant une requête HTTP pour le compte des utilisateurs du réseau. Il permet parfois d'accélérer les téléchargements en gardant une copie des fichiers ayant transité par son biais (on parle alors de <foreignphrase>proxy/cache</foreignphrase>). Dans certains cas, c'est le seul moyen d'accéder à un serveur web externe ; il est alors indispensable de renseigner la question correspondante de l'installation pour que le programme puisse récupérer les paquets Debian par son intermédiaire.</para>

	<para>Squid est le nom du logiciel serveur employé par Falcot SA pour offrir ce service.</para>
      </sidebar>
    </section>
    <section>
      <title>Concours de popularité des paquets</title>

      <para>Le système Debian contient un paquet <emphasis role="pkg">popularity-contest</emphasis>, dont le but est de compiler des statistiques d'utilisation des paquets. Ce programme collecte chaque semaine des informations sur les paquets installés et ceux utilisés récemment et les envoie de manière anonyme aux serveurs du projet Debian. Le projet peut alors tirer parti de ces informations pour déterminer l'importance relative de chaque paquet, ce qui influe sur la priorité qui lui sera accordée. En particulier, les paquets les plus « populaires » se retrouveront sur le premier CD-Rom d'installation, ce qui en facilitera l'accès pour les utilisateurs ne souhaitant pas télécharger ou acheter le jeu complet.</para>

      <para>Ce paquet n'est activé que sur demande, par respect pour la confidentialité des usages des utilisateurs.</para>
    </section>
    <section>
      <title>Sélection des paquets à installer</title>

      <para>L'étape suivante permet de choisir de manière très grossière le type d'utilisation de la machine ; les dix tâches présentées correspondent à des listes de paquets à installer. La liste des paquets réellement installés sera affinée et complétée par la suite, mais cette étape donne une bonne base très simplement.</para>

      <para>Certains paquets sont par ailleurs automatiquement installés en fonction du matériel détecté (grâce au programme <command>discover-pkginstall</command> du paquet <emphasis role="pkg">discover</emphasis>). Ainsi, s'il détecte une machine virtuelle VirtualBox, il installera le paquet <emphasis role="pkg">virtualbox-guest-dkms</emphasis> permettant une meilleure intégration de la machine virtuelle avec son système hôte.</para>

      <figure>
        <title>Choix des tâches</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/inst-tasksel.png" scalefit="1" width="65%" />
          </imageobject>
        </mediaobject>
      </figure>
    </section>
    <section id="sect.installing-grub">
      <title>Installation du chargeur d'amorçage GRUB</title>
      <indexterm><primary>chargeur</primary><secondary>de démarrage</secondary></indexterm>
      <indexterm><primary>amorçage, chargeur de</primary></indexterm>
      <indexterm><primary>GRUB</primary></indexterm>

      <para>Le chargeur d'amorçage est le premier programme démarré par le BIOS. Ce programme charge en mémoire le noyau Linux puis l'exécute. Souvent, il propose un menu permettant de choisir le noyau à charger et/ou le système d'exploitation à démarrer.</para>

      <sidebar id="sidebar.bootloader-dual-boot">
        <title><emphasis>ATTENTION</emphasis> Chargeur d'amorçage et <foreignphrase>dual boot</foreignphrase></title>
        <indexterm><primary><foreignphrase>dual boot</foreignphrase></primary></indexterm>

	<para>Cette phase du programme d'installation Debian détecte les systèmes d'exploitation déjà installés sur l'ordinateur et ajoute automatiquement des choix correspondants dans le menu de démarrage ; mais tous les programmes d'installation ne font pas de même.</para>

	<para>En particulier, si l'on installe (ou réinstalle) Windows par la suite, le chargeur de démarrage sera écrasé. Debian sera alors toujours présent sur le disque dur, mais plus accessible par le menu de démarrage. Il faudra alors démarrer sur le système d'installation de Debian en mode <userinput>rescue</userinput> pour remettre en place un chargeur de démarrage moins exclusif. L'opération est décrite en détail dans le manuel d'installation. <ulink type="block" url="http://www.debian.org/releases/stable/amd64/ch08s07.html" /></para>
      </sidebar>

      <para>Le menu proposé par GRUB contient par défaut tous les noyaux Linux installés ainsi que tous les autres systèmes d'exploitation détectés. C'est pourquoi on acceptera la proposition de l'installer dans le <foreignphrase>Master Boot Record</foreignphrase> (MBR). Puisque garder les anciennes versions préserve la capacité à amorcer le système même si le dernier noyau installé est défectueux ou mal adapté au matériel, il est judicieux de conserver quelques anciennes versions de noyau.</para>

      <para>GRUB est le chargeur d'amorçage installé en standard par Debian, en raison de sa supériorité technique : il traite la plupart des systèmes de fichiers et n'a donc pas besoin d'être mis à jour à chaque installation d'un nouveau noyau car, lors de l'amorçage, il lit sa configuration et retrouve la position exacte du nouveau noyau. Sa version 1 (désormais connue sous le nom « Grub Legacy ») ne gérait pas toutes les combinaisons de LVM et de RAID logiciel ; la version 2, installée par défaut, est plus complète. Il peut rester des situations où il faut recommander LILO (autre chargeur d'amorçage) ; l'installateur le proposera automatiquement.</para>

      <para>Pour plus d'informations sur la configuration de GRUB, vous pouvez consulter la <xref linkend="sect.config-grub" />.</para>

      <sidebar>
        <title><emphasis>ATTENTION</emphasis> Chargeurs d'amorçage et architectures</title>

	<para>LILO et GRUB, mentionnés dans ce chapitre, sont des chargeurs d'amorçage pour les architectures <emphasis>i386</emphasis> et <emphasis>amd64</emphasis>. Si vous installez Debian sur une autre architecture, c'est un autre chargeur qui sera employé. Citons entre autres <command>yaboot</command> ou <command>quik</command> pour <emphasis>powerpc</emphasis>, <command>silo</command> pour <emphasis>sparc</emphasis>, <command>aboot</command> pour <emphasis>alpha</emphasis>, <command>arcboot</command> pour <emphasis>mips</emphasis>.</para>
      </sidebar>
    </section>
    <section>
      <title>Terminer l'installation et redémarrer</title>

      <para>L'installation étant maintenant terminée, le programme vous invite à sortir le CD-Rom de son lecteur, puis à redémarrer le PC.</para>
    </section>
  </section>
  <section id="sect.after-first-boot">
    <title>Après le premier démarrage</title>

    <para>Si vous avez activé la tâche <guimenuitem>Environnement graphique de bureau</guimenuitem> sans choisir un environnement de bureau explicitement (ou en choisissant « GNOME »), l'ordinateur affiche le gestionnaire de connexion <command>gdm3</command>.</para>

    <figure>
      <title>Premier démarrage</title>
      <mediaobject>
        <imageobject>
          <imagedata fileref="images/inst-gdm.png" scalefit="1" width="65%" />
        </imageobject>
      </mediaobject>
    </figure>

    <para>L'utilisateur déjà créé peut alors se connecter et commencer à travailler immédiatement.</para>
    <section>
      <title>Installation de logiciels supplémentaires</title>

      <para>Les paquets installés correspondent aux profils sélectionnés pendant l'installation, mais pas nécessairement à l'utilisation réelle qui sera faite de la machine. On lancera donc vraisemblablement un outil de gestion de paquets, pour affiner la sélection des paquets installés. Les deux outils les plus couramment utilisés (et qui sont installés si le profil <guimenuitem>Environnement graphique de bureau</guimenuitem> a été coché) sont <command>apt</command> (accessible en ligne de commande) et <command>synaptic</command> (<guimenuitem>Gestionnaire de paquets Synaptic</guimenuitem> dans les menus).</para>

      <para>Pour faciliter l'installation d'ensembles logiciels cohérents, Debian crée des « tâches » dédiées à des usages spécifiques (serveur de messagerie, serveur de fichiers, etc.). On a déjà pu les sélectionner dans l'installateur et on peut y avoir de nouveau accès dans les outils de gestion de paquets comme <command>aptitude</command> (les tâches sont listées dans une section à part) et <command>synaptic</command> (par le menu, <menuchoice> <guimenu>Édition</guimenu> <guimenuitem>Sélectionner des paquets par tâche</guimenuitem> </menuchoice>) ; tous les programmes qui les composent seront alors automatiquement installés.</para>

      <para><command>aptitude</command> est une interface à APT en mode texte plein écran. Elle permet de naviguer dans la liste des paquets disponibles selon différents classements (paquets installés ou non, par tâche, par section, etc.) et de consulter toutes les informations disponibles à propos de chacun d'entre eux (dépendances, conflits, description, etc.). Chaque paquet peut être marqué <guimenuitem>à installer</guimenuitem> (touche <keycap>+</keycap>) ou <guimenuitem>à supprimer</guimenuitem> (touche <keycap>-</keycap>). Toutes ces opérations seront effectuées simultanément après confirmation par appui sur la touche <keycap>g</keycap> (comme <foreignphrase>go</foreignphrase>, ou « allez ! »). En cas d'oubli de certains logiciels, aucun souci, il sera toujours possible d'exécuter à nouveau <command>aptitude</command> une fois l'installation initiale achevée.</para>
      <indexterm><primary>aptitude</primary></indexterm>

      <sidebar>
        <title><emphasis>ASTUCE</emphasis> Debian pense aux francophones</title>

	<para>Il existe une tâche dédiée à la localisation du système en français. Elle comprend de la documentation en français, des dictionnaires français et divers autres paquets utiles aux francophones. Elle est automatiquement présélectionnée si le <guimenuitem>français</guimenuitem> a été retenu pour la langue d'installation.</para>
      </sidebar>

      <sidebar>
        <title><emphasis>CULTURE</emphasis> <command>dselect</command>, l'ancienne interface pour installer des paquets</title>

	<para>Avant <command>aptitude</command>, le programme standard pour sélectionner les paquets à installer était <command>dselect</command>, ancienne interface graphique associée à <command>dpkg</command>. Difficile d'emploi pour les débutants, il est donc déconseillé.</para>
        <indexterm><primary><command>dselect</command></primary></indexterm>
      </sidebar>

      <para>Bien entendu, il est possible de ne sélectionner aucune tâche. Dans ce cas, il vous suffira d'installer manuellement les logiciels souhaités avec la commande <command>apt-get</command> ou <command>aptitude</command> (tous deux accessibles en ligne de commande).</para>

      <sidebar>
        <title><emphasis>VOCABULAIRE</emphasis> Dépendance, conflit d'un paquet</title>

	<para>Dans le jargon des paquets Debian, une « dépendance » est un autre paquet nécessaire au bon fonctionnement du paquet concerné. Inversement, un « conflit » est un paquet qui ne peut pas cohabiter avec celui-ci.</para>

	<para>Ces notions sont traitées plus en détail dans le <xref linkend="packaging-system" />.</para>
      </sidebar>
    </section>
    <section>
      <title>Mise à jour du système</title>
      <indexterm><primary>safe-upgrade</primary></indexterm>

      <para>Un premier <command>aptitude safe-upgrade</command> (commande de mise à jour automatique des versions des logiciels installés) est généralement de rigueur, notamment en raison d'éventuelles mises à jour de sécurité parues depuis la publication de la dernière version stable de Debian. Ces mises à jour pourront impliquer quelques questions supplémentaires via <command>debconf</command>, l'outil de configuration standard de Debian. Pour plus d'informations sur les mises à jour effectuées par <command>aptitude</command>, on peut consulter la <xref linkend="sect.apt-upgrade" />.</para>
    </section>
  </section>
</chapter>
