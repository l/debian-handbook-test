<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.4. Serveur de fichiers NFS</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-fr-FR-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Le cahier de l'administrateur Debian" /><link
        rel="up"
        href="network-services.html"
        title="Chapitre 11. Services réseau : Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="sect.ftp-file-server.html"
        title="11.3. Serveur de fichiers FTP" /><link
        rel="next"
        href="sect.windows-file-server-with-samba.html"
        title="11.5. Partage Windows avec Samba" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/fr-FR/stable/sect.nfs-file-server.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>Précédent</strong></a></li><li
          class="home">Le cahier de l'administrateur Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>Suivant</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.nfs-file-server"></a>11.4. Serveur de fichiers NFS</h2></div></div></div><div
          class="para">
			NFS <span
            class="foreignphrase"><em
              class="foreignphrase">(Network File System)</em></span> est un protocole qui permet d'accéder à un système de fichiers à distance par le réseau, pris en charge par tous les systèmes Unix. Pour Windows, il faudra employer Samba.
		</div><a
          id="id-1.14.7.3"
          class="indexterm"></a><a
          id="id-1.14.7.4"
          class="indexterm"></a><a
          id="id-1.14.7.5"
          class="indexterm"></a><a
          id="id-1.14.7.6"
          class="indexterm"></a><a
          id="id-1.14.7.7"
          class="indexterm"></a><div
          class="para">
			NFS est un outil très utile. S'il avait de nombreuses limitations auparavant, elles ont pour la plupart disparu avec la version 4 du protocole. L'inconvénient est que la dernière version de NFS est désormais plus difficile à configurer dès que l'on veut utiliser des fonctions de sécurité de base telles que l'authentification et le chiffrement, puisqu'il repose sur Kerberos pour ces fonctionnalités. Et sans ces deux dernières, l'utilisation du protocole NFS doit se limiter à un réseau local de confiance car les données qui circulent sur le réseau ne sont pas chiffrées (un <span
            class="emphasis"><em><span
                class="foreignphrase"><em
                  class="foreignphrase">sniffer</em></span></em></span> peut les intercepter) et les droits d'accès sont accordés en fonction de l'adresse IP du client (qui peut être usurpée).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>DOCUMENTATION</em></span> NFS howto</strong></p></div></div></div><div
            class="para">
			Trouver de la bonne documentation sur NFSv4 est assez difficile. Voici quelques liens vers des explications de qualité variable mais qui donnent au moins quelques indications (en anglais) sur ce qu'il convient de faire. <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="https://help.ubuntu.com/community/NFSv4Howto">https://help.ubuntu.com/community/NFSv4Howto</a></div> <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration">http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration</a></div>
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.10"></a>11.4.1. Sécuriser NFS (au mieux)</h3></div></div></div><a
            id="id-1.14.7.10.2"
            class="indexterm"></a><div
            class="para">
				Si les fonctionnalités de sécurité de Kerberos ne sont pas utilisées, il faut s'assurer que seules les machines autorisées à l'employer peuvent se connecter aux différents serveurs RPC qui lui permettent de fonctionner, car le protocole de base considère les données reçues du réseau comme des données sûres. Le pare-feu doit donc interdire l'usurpation d'adresse IP <span
              class="foreignphrase"><em
                class="foreignphrase">(IP spoofing)</em></span> pour qu'une machine extérieure ne puisse pas se faire passer pour une machine intérieure, et les différents ports employés doivent être restreints aux machines devant accéder aux partages NFS.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>B.A.-BA</em></span> RPC</strong></p></div></div></div><div
              class="para">
				RPC (<span
                class="foreignphrase"><em
                  class="foreignphrase">Remote Procedure Call</em></span>, ou appel de procédure distante) est un standard Unix pour des services distants. NFS est un service RPC.
			</div><a
              id="id-1.14.7.10.4.3"
              class="indexterm"></a><a
              id="id-1.14.7.10.4.4"
              class="indexterm"></a><div
              class="para">
				Les services RPC s'enregistrent dans un annuaire, le <span
                class="foreignphrase"><em
                  class="foreignphrase">portmapper</em></span>. Un client désireux d'effectuer une requête NFS s'adresse au <span
                class="foreignphrase"><em
                  class="foreignphrase">portmapper</em></span> (port 111 en TCP ou UDP) et lui demande où se trouve le serveur NFS. On lui répond généralement en indiquant le port 2049 (port par défaut pour NFS). Tous les services RPC ne disposent pas nécessairement d'un port fixe.
			</div></div><div
            class="para">
				Les anciennes versions du protocole nécessitaient d'autres services RPC qui utilisaient des ports assignés dynamiquement. Heureusement, avec la version 4 de NFS, seul le port 2049 (pour NFS) et 111 (pour l'annuaire, le <span
              class="foreignphrase"><em
                class="foreignphrase">portmapper</em></span>) sont nécessaires et ils sont donc faciles à filtrer avec le pare-feu.
			</div><a
            id="id-1.14.7.10.6"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.11"></a>11.4.2. Serveur NFS</h3></div></div></div><div
            class="para">
				Le serveur NFS est intégré au noyau Linux ; Debian le compile dans ses noyaux sous forme de module. Pour l'activer automatiquement à chaque démarrage, il faut installer le paquet <span
              class="pkg pkg">nfs-kernel-server</span>, qui contient les scripts d'initialisation adéquats.
			</div><div
            class="para">
				Le fichier de configuration du serveur NFS, <code
              class="filename">/etc/exports</code>, donne les répertoires exportés à l'extérieur. À chaque partage NFS sont associées des machines qui ont le droit d'y accéder. Un certain nombre d'options permettent de dicter quelques règles d'accès. Le format de ce fichier est très simple :
			</div><a
            id="id-1.14.7.11.4"
            class="indexterm"></a><a
            id="id-1.14.7.11.5"
            class="indexterm"></a><pre
            class="programlisting">
/repertoire/a/partager machine1(option1,option2,...) machine2(...) ...</pre><div
            class="para">
				Il est important de remarquer qu'avec NFSv4, tous les répertoires exportés doivent faire partie d'une seule et même arborescence, et que le répertoire racine de cette arborescence doit être exporté et identifié avec l'option <code
              class="literal">fsid=0</code> ou <code
              class="literal">fsid=root</code>.
			</div><div
            class="para">
				Chaque machine est identifiée par son nom DNS ou son adresse IP. Il est aussi possible de spécifier un ensemble de machines en employant la syntaxe <code
              class="literal">*.falcot.com</code> ou en décrivant une plage complète d'adresses IP (exemples : <code
              class="literal">192.168.0.0/255.255.255.0</code>, <code
              class="literal">192.168.0.0/24</code>).
			</div><div
            class="para">
				Par défaut, un partage n'est accessible qu'en lecture seule (option <code
              class="literal">ro</code> comme <span
              class="foreignphrase"><em
                class="foreignphrase">read only</em></span>). L'option <code
              class="literal">rw</code> (comme <span
              class="foreignphrase"><em
                class="foreignphrase">read-write</em></span>) donne un accès en lecture/écriture. Les clients NFS doivent se connecter depuis un port réservé à root (c'est-à-dire inférieur à 1 024) à moins que l'option <code
              class="literal">insecure</code> (« pas sûr ») n'ait été employée (l'option <code
              class="literal">secure</code> — « sûr » — est implicite en l'absence de <code
              class="literal">insecure</code>, mais on peut quand même la mentionner).
			</div><a
            id="id-1.14.7.11.10"
            class="indexterm"></a><div
            class="para">
				Le serveur ne répond à une requête NFS que lorsque l'opération sur disque a été complétée (option <code
              class="literal">sync</code>). L'option <code
              class="literal">async</code> (asynchrone) désactive cette fonctionnalité et améliore quelque peu les performances, au détriment de la fiabilité puisqu'il subsiste alors un risque de perte de données en cas de <span
              class="foreignphrase"><em
                class="foreignphrase">crash</em></span> du serveur (des données acquittées par le serveur NFS n'auront pas été sauvegardées sur le disque avant le <span
              class="foreignphrase"><em
                class="foreignphrase">crash</em></span>). La valeur par défaut de cette option ayant changé récemment (par rapport à l'historique de NFS), il est recommandé de toujours mentionner explicitement l'option souhaitée.
			</div><div
            class="para">
				Pour ne pas donner un accès root au système de fichiers à n'importe quel client NFS, toutes les requêtes provenant d'un utilisateur root sont transformées en requêtes provenant de l'utilisateur <code
              class="literal">nobody</code>. Cette option (<code
              class="literal">root_squash</code>) est activée par défaut ; l'option inverse <code
              class="literal">no_root_squash</code> ne doit être employée qu'avec parcimonie étant donné les risques qu'elle comporte. Les options <code
              class="literal">anonuid=<em
                class="replaceable">uid</em></code> et <code
              class="literal">anongid=<em
                class="replaceable">gid</em></code> permettent d'employer un autre utilisateur écran à la place des UID/GID 65534 (qui correspondent à l'utilisateur <code
              class="literal">nobody</code> et au groupe <code
              class="literal">nogroup</code>).
			</div><div
            class="para">
				Avec NFSv4, il est possible d'ajouter une option <code
              class="literal">sec</code> pour préciser le niveau de sécurité souhaité : <code
              class="literal">sec=sys</code> est la valeur par défaut sans aucune sécurité particulière, <code
              class="literal">sec=krb5</code> active uniquement l'authentification, <code
              class="literal">sec=krb5i</code> y ajoute une protection d'intégrité, et <code
              class="literal">sec=krb5p</code> est le plus haut niveau qui inclut la protection de la confidentialité (avec le chiffrement des données). Pour que cela puisse marcher, une installation fonctionnelle de Kerberos est nécessaire (ce service n'est pas traité par ce livre).
			</div><div
            class="para">
				D'autres options existent encore, que vous découvrirez dans la page de manuel <span
              class="citerefentry"><span
                class="refentrytitle">exports</span>(5)</span>.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ATTENTION</em></span> Première installation</strong></p></div></div></div><div
              class="para">
				Le script <code
                class="filename">/etc/init.d/nfs-kernel-server</code> ne démarre rien si le fichier <code
                class="filename">/etc/exports</code> ne prévoit aucun partage NFS. C'est pourquoi il faut démarrer le serveur NFS juste après avoir rempli ce fichier pour la première fois :
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>service nfs-kernel-server start</code></strong></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.12"></a>11.4.3. Client NFS</h3></div></div></div><a
            id="id-1.14.7.12.2"
            class="indexterm"></a><a
            id="id-1.14.7.12.3"
            class="indexterm"></a><div
            class="para">
				Comme tous les systèmes de fichiers, il est nécessaire de le monter pour l'intégrer dans l'arborescence du système. Étant donné qu'il s'agit d'un système de fichiers un peu particulier, il a fallu adapter la syntaxe habituelle de la commande <code
              class="command">mount</code> et le format du fichier <code
              class="filename">/etc/fstab</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.5"></a><p
              class="title"><strong>Exemple 11.22. Montage manuel avec la commande <code
                  class="command">mount</code></strong></p><div
              class="example-contents"><pre
                class="screen">
          <code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>mount -t nfs4 -o rw,nosuid arrakis.interne.falcot.com:/partage /srv/partage</code></strong></pre></div></div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.6"></a><p
              class="title"><strong>Exemple 11.23. Entrée NFS dans le fichier <code
                  class="filename">/etc/fstab</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">
arrakis.interne.falcot.com:/partage /srv/partage nfs4 rw,nosuid 0 0</pre></div></div><div
            class="para">
				L'entrée ci-dessus monte automatiquement à chaque démarrage le répertoire NFS <code
              class="filename">/partage/</code> présent sur le serveur <code
              class="literal">arrakis</code> dans le répertoire local <code
              class="filename">/srv/partage/</code>. L'accès demandé est en lecture/écriture (paramètre <code
              class="literal">rw</code>). L'option <code
              class="literal">nosuid</code> est une mesure de protection qui supprime tout bit <code
              class="literal">setuid</code> ou <code
              class="literal">setgid</code> présent sur les programmes contenus dans le partage NFS. Si le répertoire NFS est dédié au stockage de documents, il est recommandé d'employer de plus l'option <code
              class="literal">noexec</code> qui empêche l'exécution de programmes par NFS. Il est important de noter que sur le serveur, le répertoire <code
              class="filename">partage</code> est situé sous l'export de la racine NFSv4 (par exemple <code
              class="filename">/export/partage</code>), ce n'est pas un répertoire de premier niveau de l'arborescence.
			</div><div
            class="para">
				La page de manuel <span
              class="citerefentry"><span
                class="refentrytitle">nfs</span>(5)</span> détaille toutes les options possibles.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>Précédent</strong>11.3. Serveur de fichiers FTP</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Niveau supérieur</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Sommaire</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>Suivant</strong>11.5. Partage Windows avec Samba</a></li></ul></body></html>
