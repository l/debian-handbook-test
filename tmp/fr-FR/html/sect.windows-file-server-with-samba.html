<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.5. Partage Windows avec Samba</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-fr-FR-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Le cahier de l'administrateur Debian" /><link
        rel="up"
        href="network-services.html"
        title="Chapitre 11. Services réseau : Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="sect.nfs-file-server.html"
        title="11.4. Serveur de fichiers NFS" /><link
        rel="next"
        href="sect.http-ftp-proxy.html"
        title="11.6. Mandataire HTTP/FTP" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/fr-FR/stable/sect.windows-file-server-with-samba.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.nfs-file-server.html"><strong>Précédent</strong></a></li><li
          class="home">Le cahier de l'administrateur Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.http-ftp-proxy.html"><strong>Suivant</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.windows-file-server-with-samba"></a>11.5. Partage Windows avec Samba</h2></div></div></div><div
          class="para">
			Samba est une suite d'outils qui permettent de gérer le protocole SMB (aussi appelé « CIFS ») sous Linux. Ce dernier est employé par Windows pour accéder aux partages réseau et aux imprimantes partagées.
		</div><a
          id="id-1.14.8.3"
          class="indexterm"></a><a
          id="id-1.14.8.4"
          class="indexterm"></a><a
          id="id-1.14.8.5"
          class="indexterm"></a><a
          id="id-1.14.8.6"
          class="indexterm"></a><a
          id="id-1.14.8.7"
          class="indexterm"></a><div
          class="para">
			Samba sait également jouer le rôle de contrôleur de domaine Windows. C'est un outil extraordinaire pour assurer une cohabitation parfaite entre les serveurs sous Linux et les machines de bureautique encore sous Windows.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.8.9"></a>11.5.1. Samba en serveur</h3></div></div></div><div
            class="para">
				Le paquet Debian <span
              class="pkg pkg">samba</span> contient les deux principaux serveurs de Samba 4 (<code
              class="command">smbd</code> et <code
              class="command">nmbd</code>).
			</div><a
            id="id-1.14.8.9.3"
            class="indexterm"></a><a
            id="id-1.14.8.9.4"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>DOCUMENTATION</em></span> Pour aller plus loin</strong></p></div></div></div><div
              class="para">
				Le serveur Samba est extrêmement configurable et peut répondre à de très nombreux cas d'utilisation correspondant à des besoins et des architectures réseau très différents. Le cas traité dans ce livre utilise Samba comme serveur autonome, mais il peut très bien être un contrôleur de domaine NT4 ou un contrôleur de domaine basé sur Active Directory, ou encore un simple membre d'un domaine existant (qui pourrait être géré par un serveur Windows).
			</div><a
              id="id-1.14.8.9.5.3"
              class="indexterm"></a><a
              id="id-1.14.8.9.5.4"
              class="indexterm"></a><div
              class="para">
				Le paquet <span
                class="pkg pkg">samba-doc</span> contient de nombreux exemples commentés dans <code
                class="filename">/usr/share/doc/samba-doc/examples/</code>.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>OUTIL</em></span> Authentifier à l'aide d'un serveur Windows</strong></p></div></div></div><div
              class="para">
				Winbind permet d'utiliser un serveur Windows comme serveur d'authentification et s'intègre à PAM et à NSS. Il est ainsi possible de mettre en place des machines Linux où tous les utilisateurs d'un domaine Windows disposeront automatiquement d'un compte.
			</div><a
              id="id-1.14.8.9.6.3"
              class="indexterm"></a><div
              class="para">
				Vous trouverez plus d'informations à ce sujet dans le répertoire <code
                class="filename">/usr/share/doc/samba-doc/examples/pam_winbind/</code>.
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.9.7"></a>11.5.1.1. Configuration avec <code
                      class="command">debconf</code></h4></div></div></div><div
              class="para">
					Le paquet met en place une configuration minimale en posant quelques questions au cours de l'installation initiale. Il est vraiment recommandé de l'adapter en lançant la commande <code
                class="command">dpkg-reconfigure samba-common</code>:
				</div><div
              class="para">
					La première information nécessaire est le nom du groupe de travail auquel le serveur Samba va appartenir (la réponse est <code
                class="literal">FALCOTNET</code> dans le cas de Falcot).
				</div><div
              class="para">
					Le paquet propose également d'identifier le serveur WINS grâce aux informations fournies par le démon DHCP. Les administrateurs de Falcot ont refusé cette option, puisque leur intention était d'employer Samba pour jouer aussi le rôle de serveur WINS .
				</div><a
              id="id-1.14.8.9.7.5"
              class="indexterm"></a></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.9.8"></a>11.5.1.2. Configuration manuelle</h4></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.14.8.9.8.2"></a>11.5.1.2.1. Modifications à <code
                        class="filename">smb.conf</code></h5></div></div></div><div
                class="para">
						Pour adapter le serveur aux besoins de Falcot, il faut modifier d'autres options dans le fichier de configuration de Samba, <code
                  class="filename">/etc/samba/smb.conf</code>. Les extraits ci-dessous résument les changements effectués au sein de la section <code
                  class="literal">[global]</code>.
					</div><pre
                class="programlisting">
[global]

## Browsing/Identification ###

# Change this to the workgroup/NT-domain name your Samba server will part of
   workgroup = FALCOTNET

# Windows Internet Name Serving Support Section:
# WINS Support - Tells the NMBD component of Samba to enable its WINS Server
   wins support = yes <span
                  id="smb.conf.wins"><img
                    class="callout"
                    src="Common_Content/images/1.png"
                    alt="1" /></span>

[...]

####### Authentication #######

# Server role. Defines in which mode Samba will operate. Possible
# values are "standalone server", "member server", "classic primary
# domain controller", "classic backup domain controller", "active
# directory domain controller". 
#
# Most people will want "standalone sever" or "member server".
# Running as "active directory domain controller" will require first
# running "samba-tool domain provision" to wipe databases and create a
# new domain.
   server role = standalone server

# "security = user" is always a good idea. This will require a Unix account
# in this server for every user accessing the server.
   security = user <span
                  id="smb.conf.security"><img
                    class="callout"
                    src="Common_Content/images/2.png"
                    alt="2" /></span>

[...]</pre><div
                class="calloutlist"><table
                  border="0"
                  summary="Callout list"><tr><td
                      width="5%"
                      valign="top"
                      align="left"><p><a
                          href="#smb.conf.wins"><img
                            class="callout"
                            src="Common_Content/images/1.png"
                            alt="1" /></a> </p></td><td
                      valign="top"
                      align="left"><div
                        class="para">
								Indique que Samba doit jouer le rôle de serveur de noms Netbios (Wins) pour le réseau local.
							</div></td></tr><tr><td
                      width="5%"
                      valign="top"
                      align="left"><p><a
                          href="#smb.conf.security"><img
                            class="callout"
                            src="Common_Content/images/2.png"
                            alt="2" /></a> </p></td><td
                      valign="top"
                      align="left"><div
                        class="para">
								C'est la valeur par défaut de ce paramètre. Comme il est central à la configuration de Samba, il est toutefois raisonnable de le renseigner de manière explicite. Chaque utilisateur doit s'authentifier avant de pouvoir accéder au moindre partage.
							</div></td></tr></table></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        xmlns=""
                        id="id-1.14.8.9.8.3"></a>11.5.1.2.2. Ajout des utilisateurs</h5></div></div></div><div
                class="para">
						Chaque utilisateur de Samba ayant besoin d'un compte sur le serveur, il faut créer les comptes Unix puis enregistrer chaque utilisateur dans la base de données de Samba. La création des comptes Unix se réalise tout à fait normalement (avec la commande <code
                  class="command">adduser</code> par exemple).
					</div><div
                class="para">
						L'ajout d'un utilisateur existant dans la base de données de Samba s'effectue par la commande <code
                  class="command">smbpasswd -a <em
                    class="replaceable">utilisateur</em></code>, qui demande le mot de passe interactivement.
					</div><div
                class="para">
						On supprime un utilisateur avec la commande <code
                  class="command">smbpasswd -x <em
                    class="replaceable">utilisateur</em></code>. Un compte Samba peut n'être que gelé quelque temps avec la commande <code
                  class="command">smbpasswd -d <em
                    class="replaceable">utilisateur</em></code>, puis réactivé avec <code
                  class="command">smbpasswd -e <em
                    class="replaceable">utilisateur</em></code>.
					</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.8.10"></a>11.5.2. Samba en client</h3></div></div></div><div
            class="para">
				Les fonctionnalités clientes de Samba donnent à une machine Linux l'accès à des partages Windows et à des imprimantes partagées. Les paquets Debian <span
              class="pkg pkg">cifs-utils</span> et <span
              class="pkg pkg">smbclient</span> regroupent les programmes clients nécessaires.
			</div><a
            id="id-1.14.8.10.3"
            class="indexterm"></a><a
            id="id-1.14.8.10.4"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.10.5"></a>11.5.2.1. Le programme <code
                      class="command">smbclient</code></h4></div></div></div><div
              class="para">
					Le programme <code
                class="command">smbclient</code> interroge tous les serveurs SMB. Il accepte l'option <code
                class="literal">-U <em
                  class="replaceable">utilisateur</em></code> pour se connecter au serveur sous une autre identité. <code
                class="command">smbclient //<em
                  class="replaceable">serveur</em>/<em
                  class="replaceable">partage</em></code> accède au partage de manière interactive (comme le client FTP en ligne de commande). <code
                class="command">smbclient -L <em
                  class="replaceable">serveur</em></code> donne la liste des partages disponibles (et visibles).
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.10.6"></a>11.5.2.2. Monter un partage Windows</h4></div></div></div><div
              class="para">
					La commande <code
                class="command">mount</code> permet de monter un partage Windows dans l'arborescence du système Linux (avec l'aide de <code
                class="command">mount.cifs</code> fourni par <span
                class="pkg pkg">cifs-utils</span>).
				</div><a
              id="id-1.14.8.10.6.3"
              class="indexterm"></a><a
              id="id-1.14.8.10.6.4"
              class="indexterm"></a><div
              class="example"><a
                xmlns=""
                id="id-1.14.8.10.6.5"></a><p
                class="title"><strong>Exemple 11.24. Montage d'un partage Windows</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
mount -t cifs //arrakis/shared /shared \
      -o credentials=/etc/smb-credentials</pre></div></div><div
              class="para">
					Le fichier <code
                class="filename">/etc/smb-credentials</code> ne sera pas lisible par les utilisateurs et respectera le format suivant :
				</div><pre
              class="programlisting">
username = <em
                class="replaceable">utilisateur</em>
password = <em
                class="replaceable">mot_de_passe</em></pre><div
              class="para">
					On peut préciser d'autres options sur la ligne de commande, que la page de manuel <span
                class="citerefentry"><span
                  class="refentrytitle">mount.cifs</span>(1)</span> détaille. Deux options intéressantes permettent de forcer l'utilisateur (<code
                class="literal">uid</code>) et le groupe (<code
                class="literal">gid</code>) propriétaire des fichiers accessibles sur le montage afin de ne pas restreindre l'accès à root.
				</div><div
              class="para">
					Il est aussi possible de configurer le montage d'un partage Windows dans <code
                class="filename">/etc/fstab</code> :
				</div><pre
              class="programlisting">
//<em
                class="replaceable">serveur</em>/shared /shared cifs credentials=/etc/smb-credentials</pre><div
              class="para">
					Un partage SMB/CIFS peut être démonté avec la commande <code
                class="command">umount</code> standard.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.8.10.7"></a>11.5.2.3. Imprimer sur une imprimante partagée</h4></div></div></div><div
              class="para">
					Cups est une solution élégante pour imprimer sur une imprimante partagée par une machine Windows depuis un poste Linux. Si le paquet <span
                class="pkg pkg">smbclient</span> est installé, Cups offre la possibilité d'installer automatiquement une imprimante partagée par un poste Windows.
				</div><a
              id="id-1.14.8.10.7.3"
              class="indexterm"></a><div
              class="para">
					Voici les étapes à suivre :
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							Entrer dans l'interface de configuration de CUPS : <code
                      class="literal">http://localhost:631/admin</code>
						</div></li><li
                  class="listitem"><div
                    class="para">
							Cliquer sur « Ajouter une imprimante ».
						</div></li><li
                  class="listitem"><div
                    class="para">
							Choisir le périphérique de l'imprimante : <span
                      class="guimenuitem"><strong>Windows Printer via SAMBA</strong></span>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							L'URI décrivant l'imprimante doit avoir la forme suivante :
						</div><div
                    class="para">
							<code
                      class="literal">smb://<em
                        class="replaceable">utilisateur</em>:<em
                        class="replaceable">motdepasse</em>@<em
                        class="replaceable">serveur</em>/<em
                        class="replaceable">imprimante</em></code>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							Saisir le nom qui identifiera cette imprimante de manière unique, puis une description pour cette imprimante et sa localisation. Ces informations seront utiles aux utilisateurs, et leur permettront d'identifier les imprimantes.
						</div></li><li
                  class="listitem"><div
                    class="para">
							Indiquer les noms du fabricant et du modèle de l'imprimante, ou fournir directement un fichier de description d'imprimante (PPD).
						</div></li></ul></div><div
              class="para">
					Et voilà, l'imprimante est fonctionnelle !
				</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.nfs-file-server.html"><strong>Précédent</strong>11.4. Serveur de fichiers NFS</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Niveau supérieur</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Sommaire</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.http-ftp-proxy.html"><strong>Suivant</strong>11.6. Mandataire HTTP/FTP</a></li></ul></body></html>
