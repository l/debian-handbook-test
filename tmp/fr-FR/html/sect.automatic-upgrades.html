<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">6.8. Mise à jour automatique</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-fr-FR-1.0-1" /><meta
        name="keywords"
        content="apt, apt-get, apt-cache, aptitude, synaptic, sources.list, apt-cdrom" /><link
        rel="home"
        href="index.html"
        title="Le cahier de l'administrateur Debian" /><link
        rel="up"
        href="apt.html"
        title="Chapitre 6. Maintenance et mise à jour : les outils APT" /><link
        rel="prev"
        href="sect.regular-upgrades.html"
        title="6.7. Maintenir un système à jour" /><link
        rel="next"
        href="sect.searching-packages.html"
        title="6.9. Recherche de paquets" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/fr-FR/stable/sect.automatic-upgrades.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.regular-upgrades.html"><strong>Précédent</strong></a></li><li
          class="home">Le cahier de l'administrateur Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.searching-packages.html"><strong>Suivant</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.automatic-upgrades"></a>6.8. Mise à jour automatique</h2></div></div></div><a
          id="id-1.9.17.2"
          class="indexterm"></a><a
          id="id-1.9.17.3"
          class="indexterm"></a><div
          class="para">
			Dans le contexte de Falcot SA, qui inclut de nombreuses machines et des ressources humaines limitées, les administrateurs souhaitent automatiser au maximum les mises à jour. Les programmes chargés de ces opérations doivent donc fonctionner sans intervention humaine.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.17.5"></a>6.8.1. Configuration de <code
                    class="command">dpkg</code></h3></div></div></div><div
            class="para">
				Nous avons déjà vu (encadré <a
              class="xref"
              href="sect.package-meta-information.html#sidebar.questions-conffiles"><span
                class="emphasis"><em>POUR ALLER PLUS LOIN</em></span> Éviter les questions sur les fichiers de configuration</a>) comment interdire à <code
              class="command">dpkg</code> de demander confirmation du remplacement d'un fichier de configuration (avec les options <code
              class="literal">--force-confdef --force-confold</code>). Il reste trois éléments à prendre en compte : les interactions générées par APT lui-même, celles provenant de <code
              class="command">debconf</code> et les interactions en ligne de commande intégrées dans les scripts de configuration des paquets.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.17.6"></a>6.8.2. Configuration d'APT</h3></div></div></div><div
            class="para">
				En ce qui concerne APT, la réponse est simple. Il suffit de lui préciser l'option <code
              class="literal">-y</code> ou <code
              class="literal">--assume-yes</code>, qui répondra « oui » automatiquement à toutes les questions qu'il aurait pu poser.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.17.7"></a>6.8.3. Configuration de <code
                    class="command">debconf</code></h3></div></div></div><div
            class="para">
				Pour <code
              class="command">debconf</code>, la réponse mérite un plus long développement. Dès sa naissance, ce programme fut prévu pour permettre de vérifier la pertinence et le volume des questions posées à l'utilisateur, ainsi que la manière dont elles le seront. C'est pourquoi sa configuration demande la priorité minimale à partir de laquelle <code
              class="command">debconf</code> posera une question. Quand il s'interdit d'interroger l'humain, ce programme utilise automatiquement la valeur par défaut définie par le mainteneur du paquet. Il faut encore choisir une interface pour l'affichage des questions (frontal, ou <span
              class="foreignphrase"><em
                class="foreignphrase">front-end</em></span> en anglais).
			</div><div
            class="para">
				Parmi la liste des interfaces possibles, <code
              class="literal">noninteractive</code> (non interactive) est très particulière : la choisir désactive toute interaction avec l'utilisateur. Si un paquet désire malgré tout lui communiquer une note d'information, celle-ci sera automatiquement transformée en courrier électronique.
			</div><div
            class="para">
				Pour reconfigurer <code
              class="command">debconf</code>, on utilise l'outil <code
              class="command">dpkg-reconfigure</code> inclus dans le paquet <code
              class="command">debconf</code> ; la commande est <code
              class="command">dpkg-reconfigure debconf</code>. Il est aussi possible de changer temporairement les choix de configuration effectués à l'aide de variables d'environnement (<code
              class="varname">DEBIAN_FRONTEND</code> permet ainsi de changer d'interface, comme expliqué dans la page de manuel <span
              class="citerefentry"><span
                class="refentrytitle">debconf</span>(7)</span>).
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.17.8"></a>6.8.4. Gestion des interactions en ligne de commande</h3></div></div></div><div
            class="para">
				Finalement, les interactions en ligne de commande des scripts de configuration exécutés par <code
              class="command">dpkg</code> sont les plus difficiles à éliminer. Il n'existe en effet aucune solution standard et aucune réponse n'est meilleure qu'une autre.
			</div><div
            class="para">
				La solution généralement employée est de supprimer l'entrée standard (en y redirigeant le contenu de <code
              class="filename">/dev/null</code>, par exemple avec la syntaxe <code
              class="command"><em
                class="replaceable">commande</em> &lt;/dev/null</code>), ou d'y brancher un flux continu de retours à la ligne. Aucune de ces méthodes n'est fiable à 100 % mais elles permettent en général d'accepter les choix par défaut, puisque la plupart des scripts interprètent l'absence de réponse explicite comme une validation de la valeur proposée par défaut.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.9.17.9"></a>6.8.5. La combinaison miracle</h3></div></div></div><div
            class="para">
				Si l'on met bout à bout les éléments de configuration exposés dans les sections précédentes, il est possible de rédiger un petit script capable d'effectuer une mise à jour automatique assez fiable.
			</div><div
            class="example"><a
              xmlns=""
              id="example.non-interactive-upgrade"></a><p
              class="title"><strong>Exemple 6.4. Script pour mise à jour non interactive</strong></p><div
              class="example-contents"><pre
                class="programlisting">
export DEBIAN_FRONTEND=noninteractive
yes '' | apt-get -y -o DPkg::options::="--force-confdef" -o DPkg::options::="--force-confold" dist-upgrade
</pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>EN PRATIQUE</em></span> Le cas de Falcot SA</strong></p></div></div></div><div
              class="para">
				Les administrateurs de Falcot doivent s'adapter à un système informatique hétérogène, dont les machines servent des buts différents. Ils choisiront donc pour chaque machine la solution la plus adaptée.
			</div><div
              class="para">
				En pratique, les serveurs (sous <span
                class="distribution distribution">Jessie</span>) utiliseront la « combinaison miracle » évoquée ci-dessus, pour être maintenus à jour automatiquement. Seuls les plus critiques (les pare-feu, par exemple) seront configurés pour utiliser <code
                class="command">apticron</code>, afin que les mises à jour ne se fassent que sous le contrôle d'un administrateur.
			</div><div
              class="para">
				Les postes bureautiques du service administratif (en <span
                class="distribution distribution">Jessie</span> aussi) seront configurés avec <span
                class="pkg pkg">gnome-packagekit</span>, de sorte que les utilisateurs pourront déclencher les mises à jour eux-mêmes ; il est en effet important qu'elles se fassent à l'initiative des utilisateurs principaux des ordinateurs, sans quoi des modifications imprévues et silencieuses (donc mystérieuses) pourraient les perturber.
			</div><div
              class="para">
				Enfin, pour les quelques ordinateurs du laboratoire qui utilisent <span
                class="distribution distribution">Testing</span> pour bénéficier des dernières versions des logiciels, les administrateurs de Falcot décident simplement de configurer APT pour qu'il prépare périodiquement les mises à jour, sans les effectuer. De cette manière, lorsqu'ils voudront mettre à niveau (manuellement) ces machines expérimentales, ils pourront se concentrer sur les actions réellement utiles, les phases fastidieuses de téléchargement ayant déjà été effectuées automatiquement.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.regular-upgrades.html"><strong>Précédent</strong>6.7. Maintenir un système à jour</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Niveau supérieur</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Sommaire</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.searching-packages.html"><strong>Suivant</strong>6.9. Recherche de paquets</a></li></ul></body></html>
