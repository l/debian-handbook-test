<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
]>
<chapter id="existing-setup" lang="fr-FR">
	<chapterinfo>
		 <keywordset>
			<keyword>Existant</keyword>
			 <keyword>Réutilisation</keyword>
			 <keyword>Migration</keyword>

		</keywordset>

	</chapterinfo>
	 <title>Prise en compte de l'existant et migration</title>
	 <highlights> <para>
		Toute refonte du système d'information doit se baser sur l'existant pour réexploiter au maximum les ressources disponibles et garantir l'interopérabilité des différents éléments constituant le système. Cette étude fera apparaître une trame générique, à suivre dans chaque migration d'un service sous Linux.
	</para>
	 </highlights> <section id="sect.heterogeneous-environments">
		<title>Coexistence en environnement hétérogène</title>
		 <indexterm>
			<primary>environnement</primary>
			<secondary>hétérogène</secondary>
		</indexterm>
		 <para>
			Debian s'intègre très bien dans tous les types d'environnements existants et cohabite avec tous les systèmes d'exploitation. Cette quasi parfaite harmonie provient des pressions du marché qui contraignent les éditeurs à développer des logiciels respectueux des normes et standards, donc avec lesquels les autres programmes, libres ou pas, serveurs comme clients, peuvent interagir.
		</para>
		 <section>
			<title>Intégration avec des machines Windows</title>
			 <para>
				La prise en charge de SMB/CIFS par Samba assure une très bonne communication dans un contexte Windows. Il sert des fichiers et des files d'impression aux clients Windows et intègre des logiciels grâce auxquels une machine Linux utilisera des ressources publiées par des serveurs Windows.
			</para>
			 <sidebar> <title><emphasis>OUTIL</emphasis> Samba</title>
			 <indexterm>
				<primary>Samba</primary>
			</indexterm>
			 <para>
				La dernière version de Samba peut remplacer la plupart des fonctionnalités de Windows, depuis celles d'un simple serveur Windows NT (authentification, partage de fichiers et d'imprimantes, téléchargement de pilotes d'imprimantes, DFS, etc.) aux plus avancées (un contrôleur de domaines compatible avec Active Directory).
			</para>
			 </sidebar>
		</section>
		 <section>
			<title>Intégration avec des machines OS X</title>
			 <indexterm>
				<primary>Zeroconf</primary>
			</indexterm>
			 <indexterm>
				<primary>Bonjour</primary>
			</indexterm>
			 <indexterm>
				<primary>Avahi</primary>
			</indexterm>
			 <para>
				Les machines OS X savent fournir et utiliser des services réseau comme le partage de fichiers et d'imprimantes. Ces services sont annoncés sur le réseau local, ce qui permet aux autres machines de les découvrir et de les exploiter sans aucune configuration manuelle. Bonjour est l'implémentation d'Apple du protocole Zeroconf qui rend tout cela possible. Debian inclut une autre implémentation, Avahi, qui fournit les mêmes fonctionnalités.
			</para>
			 <indexterm>
				<primary>AFP</primary>
			</indexterm>
			 <indexterm>
				<primary>AppleShare</primary>
			</indexterm>
			 <para>
				Dans l'autre sens, le démon Netatalk peut être employé pour faire office de serveur de fichiers à destination des machines OS X du réseau. Il implémente le protocole AFP (AppleShare) ainsi que les notifications nécessaires pour que le serveur puisse être identifié automatiquement par les clients OS X.
			</para>
			 <indexterm>
				<primary>AppleTalk</primary>
			</indexterm>
			 <para>
				Les réseaux Mac OS plus anciens (avant OS X) utilisaient un protocole différent appelé AppleTalk. Pour des environnements avec de telles machines, Netatalk sait également fournir ce protocole (en fait, Netatalk était initialement une réimplémentation de ce dernier). Il assure les fonctionnalités de serveur de fichiers, de queues d'impression, ainsi que de serveur de temps (synchronisation horaire). Ses fonctionnalités de routeur permettent de l'interconnecter avec des réseaux AppleTalk.
			</para>

		</section>
		 <section>
			<title>Intégration avec d'autres machines Linux/Unix</title>
			 <para>
				Enfin, NFS et NIS garantiront les interactions avec des systèmes Unix. NFS assure la fonctionnalité de serveur de fichiers, tandis que NIS permet de créer un annuaire des utilisateurs. Signalons également que la couche d'impression BSD, employée par la majorité des Unix, permet aussi de partager des files d'impression.
			</para>
			 <figure>
				<title>Cohabitation de Debian avec OS X, Windows et les systèmes Unix</title>
				 <mediaobject>
					<imageobject>
						<imagedata fileref="images/existing-setup-1.png" format="PNG" width="25%" />
					</imageobject>

				</mediaobject>

			</figure>

		</section>

	</section>
	 <section id="sect.how-to-migrate">
		<title>Démarche de migration</title>
		 <indexterm>
			<primary>migration</primary>
		</indexterm>
		 <para>
			Pour chaque ordinateur à migrer, il faut suivre une démarche garantissant une continuité dans les services offerts. Quel que soit le système d'exploitation utilisé, le principe ne change pas.
		</para>
		 <section>
			<title>Recenser et identifier les services</title>
			 <para>
				Aussi simple qu'elle paraisse, cette étape est indispensable. Un administrateur sérieux connaît vraisemblablement les rôles principaux de chaque serveur, mais ceux-ci évoluent et quelques utilisateurs expérimentés auront parfois installé des services « sauvages ». Connaître leur existence vous permettra au moins de décider de leur sort au lieu de les supprimer par mégarde.
			</para>
			 <para>
				À ce titre, il est souhaitable d'informer vos utilisateurs de votre projet quelque temps avant la migration effective du serveur. Pour les impliquer dans le projet, il pourra être utile d'installer sur les postes bureautiques les logiciels libres les plus courants qu'ils seront amenés à retrouver lors de la migration des postes de travail sous Debian ; on pense bien entendu à Libre Office et aux logiciels de la suite Mozilla.
			</para>
			 <section>
				<title>Réseau et processus</title>
				 <indexterm>
					<primary><command>nmap</command></primary>
				</indexterm>
				 <para>
					L'outil <command>nmap</command> (paquet Debian du même nom) identifiera rapidement les services Internet hébergés par une machine reliée au réseau sans même nécessiter de s'y connecter (<command>login</command>). Il suffit d'invoquer la commande suivante sur une autre machine connectée au même réseau :
				</para>
				 
<screen>
<computeroutput>$ </computeroutput><userinput>nmap mirwiz</userinput>
<computeroutput>Starting Nmap 6.47 ( http://nmap.org ) at 2015-03-24 11:34 CET
Nmap scan report for mirwiz (192.168.1.104)
Host is up (0.0037s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 0.13 seconds</computeroutput></screen>
				 <sidebar> <title><emphasis>ALTERNATIVE</emphasis> Utiliser <command>netstat</command> pour trouver la liste des services disponibles</title>
				 <para>
					Sur une machine Linux, la commande <command>netstat -tupan</command> dresse la liste des sessions TCP actives ou en attente ainsi que des ports UDP que les programmes actifs écoutent. Cela facilite le recensement des services proposés sur le réseau.
				</para>
				 </sidebar> <sidebar> <title><emphasis>POUR ALLER PLUS LOIN</emphasis> IPv6</title>
				 <para>
					Certaines commandes réseau peuvent travailler en IPv4 ou en IPv6. C'est notamment le cas des commandes <command>nmap</command> et <command>netstat</command>, mais aussi d'autres comme <command>route</command> ou <command>ip</command>. La convention est que ce comportement est déclenché par l'option de ligne de commande <parameter>-6</parameter>.
				</para>
				 </sidebar> <para>
					Si le serveur est une machine Unix offrant un compte shell aux utilisateurs, il est intéressant de déterminer si des processus s'exécutent en tâche de fond, en l'absence de leur propriétaire. La commande <command>ps auxw</command> affiche tous les processus et leur identifiant utilisateur associé. En croisant ces informations avec la sortie de la commande <command>who</command> (donnant la liste des utilisateurs connectés), il est possible de retrouver d'éventuels serveurs sauvages ou des programmes fonctionnant en tâche de fond. La consultation des tables de processus planifiés (<filename>crontabs</filename>) fournira souvent des renseignements intéressants sur les fonctions remplies par le serveur (l'explication complète des commandes de <command>cron</command> se trouve dans la section « Planification de tâches » du <xref linkend="unix-services" />).
				</para>
				 <para>
					Dans tous les cas, il est indispensable de prévoir une sauvegarde du serveur : elle permettra de récupérer des informations a posteriori, quand les utilisateurs feront état de problèmes concrets dus à la migration.
				</para>

			</section>

		</section>
		 <section>
			<title>Sauvegarde de la configuration</title>
			 <para>
				Il convient de conserver la configuration de chaque service identifié afin de pouvoir installer l'équivalent sur le serveur mis à jour. Le strict minimum est de faire une copie de sauvegarde des fichiers de configuration.
			</para>
			 <para>
				Pour des machines Unix, la configuration se trouve habituellement sous <filename>/etc/</filename> mais il se peut qu'elle soit placée dans un sous-répertoire de <filename>/usr/local/</filename>. C'est le cas lorsqu'un logiciel est installé depuis ses sources plutôt qu'avec un paquet. On peut même la rencontrer, dans certains cas, sous <filename>/opt/</filename>.
			</para>
			 <para>
				Pour les services gérant des données (comme les bases de données), il est fortement recommandé d'exporter celles-ci dans un format standard, plus facile à reprendre par le nouveau logiciel. Un tel format est généralement en mode texte et documenté : il s'agira par exemple d'un <foreignphrase>dump</foreignphrase> SQL pour une base de données et d'un fichier LDIF pour un serveur LDAP.
			</para>
			 <figure>
				<title>Sauvegarde des bases de données</title>
				 <mediaobject>
					<imageobject>
						<imagedata fileref="images/existing-setup-2.png" format="PNG" width="50%" />
					</imageobject>

				</mediaobject>

			</figure>
			 <para>
				Chaque logiciel serveur est différent et il est impossible de détailler tous les cas existants. Reportez-vous aux documentations du logiciel actuel et du nouveau logiciel pour identifier les portions exportables, puis réimportables, ainsi que celles qui nécessiteront un travail manuel. La lecture de ce livre vous éclairera déjà sur la configuration des principaux logiciels serveurs sous Linux.
			</para>

		</section>
		 <section>
			<title>Prendre en main un serveur Debian existant</title>
			 <indexterm>
				<primary>récupération d'une machine Debian</primary>
			</indexterm>
			 <indexterm>
				<primary>exploration d'une machine Debian</primary>
			</indexterm>
			 <indexterm>
				<primary>prise en main d'un serveur Debian</primary>
			</indexterm>
			 <para>
				Pour en reprendre efficacement l'administration, on pourra analyser une machine déjà animée par Debian.
			</para>
			 <para>
				Le premier fichier à vérifier est <filename>/etc/debian_version</filename>, qui contient habituellement le numéro de version du système Debian installé (il fait partie du paquet <emphasis>base-files</emphasis>). S'il indique <literal>testing/unstable</literal>, c'est que le système a été mis à jour avec des paquets provenant d'une de ces deux distributions en développement.
			</para>
			 <para>
				Le programme <command>apt-show-versions</command> (du paquet Debian éponyme) consulte la liste des paquets installés et identifie les versions disponibles. <command>aptitude</command> permet aussi d'effectuer ces tâches, d'une manière moins systématique.
			</para>
			 <para>
				Un coup d'œil au fichier <filename>/etc/apt/sources.list</filename> (et au répertoire <filename>/etc/apt/sources.list.d/</filename>) montrera la provenance probable des paquets Debian déjà installés. Si beaucoup de sources inconnues apparaissent, l'administrateur pourra choisir de réinstaller complètement l'ordinateur pour assurer une compatibilité optimale avec les logiciels fournis par Debian.
			</para>
			 <para>
				Ce fichier <filename>sources.list</filename> est souvent un bon indicateur : la majorité des administrateurs gardent au moins en commentaires les sources APT employées par le passé. Mais il est toujours possible que des sources employées par le passé aient été supprimées, voire que l'ancien administrateur ait installé manuellement (avec <command>dpkg</command>) des paquets téléchargés sur Internet. Dans ce cas, la machine trompe par son apparence de Debian « standard ». C'est pourquoi il convient d'être attentif à tout indice pouvant trahir la présence de paquets externes (apparition de fichiers <filename>.deb</filename> dans des répertoires inhabituels, numéros de versions de paquet dotés d'un suffixe particulier représentant l'origine du paquet — comme <literal>ubuntu</literal> ou <literal>lmde</literal>, etc.)
			</para>
			 <para>
				De même, il est intéressant d'analyser le contenu du répertoire <filename>/usr/local/</filename>, prévu pour contenir des programmes compilés et installés manuellement. Répertorier les logiciels installés de cette manière est riche d'enseignements, car cela incite à s'interroger sur la raison justifiant le non-emploi du paquet Debian correspondant — si un tel paquet existe.
			</para>
			 <sidebar> <title><emphasis>DÉCOUVERTE</emphasis> <emphasis role="pkg">cruft</emphasis></title>
			 <para>
				Le paquet <emphasis role="pkg">cruft</emphasis> permet de répertorier tous les fichiers présents sur le disque qui ne sont affectés à aucun paquet. Il dispose de quelques filtres (plus ou moins efficaces et plus ou moins à jour) pour éviter d'afficher certains de ces fichiers qui existent légitimement (fichiers générés par les paquets Debian, ou fichiers de configuraton gérés en dehors du contrôle de <command>dpkg</command>, etc.).
			</para>
			 <para>
				Attention à ne pas supprimer aveuglément tout ce que <command>cruft</command> pourrait lister !
			</para>
			 </sidebar>
		</section>
		 <section>
			<title>Installer Debian</title>
			 <para>
				Toutes les informations relatives au serveur actuel étant maintenant connues, il est possible de mettre celui-ci hors service et d'y installer Debian.
			</para>
			 <indexterm>
				<primary>architecture</primary>
			</indexterm>
			 <para>
				Pour en choisir la version adéquate, il faut connaître l'architecture de l'ordinateur. S'il s'agit d'un PC, ce sera vraisemblablement amd64 (les anciens PC peuvent nécessiter l'usage de l'architecture i386). Dans les autres cas, on pourra restreindre les possibilités en fonction du système précédemment employé.
			</para>
			 <para>
				Le <xref linkend="tab-corresp" xrefstyle="select: label nopage" /> ne prétend pas être exhaustif mais pourra vous aider. Dans tous les cas, la documentation d'origine de l'ordinateur vous renseignera de manière plus certaine.
			</para>
			 <table colsep="1" id="tab-corresp">
				<title>Correspondance entre système d'exploitation et architecture</title>
				 <tgroup cols="2">
					<thead>
						<row>
							<entry>Système d'exploitation</entry>
							 <entry>Architecture(s)</entry>

						</row>

					</thead>
					 <tbody>
						<row>
							<entry>DEC Unix (OSF/1)</entry>
							 <entry>alpha, mipsel</entry>

						</row>
						 <row>
							<entry>HP Unix</entry>
							 <entry>ia64, hppa</entry>

						</row>
						 <row>
							<entry>IBM AIX</entry>
							 <entry>powerpc</entry>

						</row>
						 <row>
							<entry>Irix</entry>
							 <entry>mips</entry>

						</row>
						 <row>
							<entry>OS X</entry>
							 <entry>amd64, powerpc, i386</entry>

						</row>
						 <row>
							<entry>z/OS, MVS</entry>
							 <entry>s390x, s390</entry>

						</row>
						 <row>
							<entry>Solaris, SunOS</entry>
							 <entry>sparc, i386, m68k</entry>

						</row>
						 <row>
							<entry>Ultrix</entry>
							 <entry>mips</entry>

						</row>
						 <row>
							<entry>VMS</entry>
							 <entry>alpha</entry>

						</row>
						 <row>
							<entry>Windows 95/98/ME</entry>
							 <entry>i386</entry>

						</row>
						 <row>
							<entry>Windows NT/2000</entry>
							 <entry>i386, alpha, ia64, mipsel</entry>

						</row>
						 <row>
							<entry>Windows XP / Windows Server 2008</entry>
							 <entry>i386, amd64, ia64</entry>

						</row>
						 <row>
							<entry>Windows Vista / Windows 7 / Windows 8</entry>
							 <entry>i386, amd64</entry>

						</row>

					</tbody>

				</tgroup>

			</table>
			 <sidebar> <title><emphasis>MATÉRIEL</emphasis> PC 64 bits ou PC 32 bits</title>
			 <indexterm>
				<primary>amd64</primary>
			</indexterm>
			 <indexterm>
				<primary>i386</primary>
			</indexterm>
			 <para>
				La plupart des ordinateurs récents sont pourvus de processeurs 64 bits d'Intel ou d'AMD, compatibles avec les anciens processeurs 32 bits : les logiciels compilés pour l'architecture « i386 » fonctionneront donc. En revanche, ce mode compatibilité ne met pas à profit les capacités de ces nouveaux processeurs. C'est pourquoi Debian dispose de l'architecture « amd64 », qui gère les processeurs récents d'AMD ainsi que les processeurs « em64t » d'Intel (y compris la plupart des processeurs de la famille « Core »).
			</para>
			 </sidebar>
		</section>
		 <section>
			<title>Installer et configurer les services sélectionnés</title>
			 <para>
				Une fois la distribution Debian installée, il s'agit d'installer et de configurer un à un tous les services que cet ordinateur doit héberger. La nouvelle configuration devra prendre en compte la précédente pour assurer une transition en douceur. Toutes les informations récoltées dans les deux premières étapes sont utiles pour mener à bien cette transition.
			</para>
			 <figure>
				<title>Installer les services sélectionnés</title>
				 <mediaobject>
					<imageobject>
						<imagedata fileref="images/existing-setup-4.png" format="PNG" width="66%" />
					</imageobject>

				</mediaobject>

			</figure>
			 <para>
				Avant de se lancer corps et âme dans cet exercice, il est fortement recommandé de consulter le reste de ce livre, grâce auquel vous aurez une idée plus précise sur la manière de configurer les services prévus.
			</para>
			 <para>
			</para>

		</section>

	</section>
</chapter>

