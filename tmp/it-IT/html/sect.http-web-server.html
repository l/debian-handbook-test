<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.2. Server web (HTTP)</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-it-IT-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Il Manuale dell'Amministratore Debian" /><link
        rel="up"
        href="network-services.html"
        title="Capitolo 11. Servizi di rete: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="network-services.html"
        title="Capitolo 11. Servizi di rete: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="next"
        href="sect.ftp-file-server.html"
        title="11.3. Server di file FTP" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/it-IT/stable/sect.http-web-server.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="network-services.html"><strong>Indietro</strong></a></li><li
          class="home">Il Manuale dell'Amministratore Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.ftp-file-server.html"><strong>Avanti</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.http-web-server"></a>11.2. Server web (HTTP)</h2></div></div></div><div
          class="para">
			Gli amministratori della Falcot Corporation hanno deciso di utilizzare il server HTTP Apache, incluso nella versione 2.4.10 in Debian <span
            class="distribution distribution">Jessie</span>.
		</div><a
          id="id-1.14.5.3"
          class="indexterm"></a><a
          id="id-1.14.5.4"
          class="indexterm"></a><a
          id="id-1.14.5.5"
          class="indexterm"></a><a
          id="id-1.14.5.6"
          class="indexterm"></a><a
          id="id-1.14.5.7"
          class="indexterm"></a><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>ALTERNATIVE</em></span> Altri server web</strong></p></div></div></div><div
            class="para">
			Apache è semplicemente il più noto (e largamente impiegato) tra i server web, ma ne esistono altri: possono offrire prestazioni migliori in caso di determinati carichi di lavoro, ma pagano il prezzo di un numero inferiore di funzionalità e moduli. Ad ogni modo, se la prospettiva del server web è quella di servire file statici oppure agire come proxy le alternative come <span
              class="pkg pkg">nginx</span> e <span
              class="pkg pkg">lighttpd</span> meritano di essere approfondite.
		</div><a
            id="id-1.14.5.8.3"
            class="indexterm"></a><a
            id="id-1.14.5.8.4"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.9"></a>11.2.1. Installare Apache</h3></div></div></div><div
            class="para">
				L'installazione del pacchetto <span
              class="pkg pkg">apache2</span> è tutto ciò che è necessario. Contiene tutti i moduli, compresi <span
              class="emphasis"><em>Multi-Processing Modules</em></span> (MPMs), che influenzano il modo in cui Apache gestisce l'elaborazione in parallelo di numerose richieste (quelle usate per fornire in pacchetti separati <span
              class="pkg pkg">apache2-mpm-*</span>). Installerà anche <span
              class="pkg pkg">apache2-utils</span> contenente le utility a riga di comando che scopriremo dopo.
			</div><div
            class="para">
				L'MPM in uso influenza in modo significativo il modo in cui Apache gestirà richieste simultanee. Con il <span
              class="emphasis"><em>worker</em></span> MPM, utilizza <span
              class="emphasis"><em>threads</em></span> (processi leggeri), mentre con il <span
              class="emphasis"><em>prefork</em></span> MPM utilizza una serie di processi creati in anticipo. Con <span
              class="emphasis"><em>event</em></span> MPM anche utilizza i threads, ma le connessioni inattive (in particolare quelle tenute aperte dalla funzione HTTP <span
              class="emphasis"><em>keep-alive</em></span>) vengono consegnate ad una gestione dedicata del thread.
			</div><div
            class="para">
				Gli amministratori della Falcot installano anche <span
              class="pkg pkg">libapache2-mod-php5</span> per includere il supporto PHP all'interno di Apache. Questo fa si che venga disabilitato il valore predefinito <span
              class="emphasis"><em>event</em></span> di MPM, e che invece al suo posto venga usato <span
              class="emphasis"><em>prefork</em></span>, poiché PHP può funzionare unicamente con quel particolare MPM.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SICUREZZA</em></span> Esecuzione con l'utente <code
                        class="literal">www-data</code></strong></p></div></div></div><a
              id="id-1.14.5.9.5.2"
              class="indexterm"></a><a
              id="id-1.14.5.9.5.3"
              class="indexterm"></a><div
              class="para">
				In via predefinita Apache gestisce le richieste in arrivo come fosse l'utente <code
                class="literal">www-data</code>. Questo significa che una vulnerabilità in uno script CGI eseguito da Apache (per una pagina dinamica) non comprometterebbe l'intero sistema, ma solo i file di proprietà di questo particolare utente.
			</div><div
              class="para">
				Usare i moduli <span
                class="emphasis"><em>suexec</em></span> permette di eludere questa regola per permettere ad alcuni script CGI di essere eseguiti con l'identità di un altro utente. Questo è configurato con una direttiva <code
                class="literal">SuexecUserGroup <em
                  class="replaceable">utente</em><em
                  class="replaceable">gruppo</em></code> nel file di configurazione di Apache.
			</div><a
              id="id-1.14.5.9.5.6"
              class="indexterm"></a><div
              class="para">
				Un'altra possibilità è l'utilizzo di un MPM dedicato, come quello fornito da <span
                class="pkg pkg">apache2-mpm-itk</span>. Questo particolare MPM che ha un comportamento leggermente differente: permette di "isolare" gli host virtuali (in realtà, gruppi di pagine) in modo che possano essere eseguiti ciascuno con un utente differente. Una vulnerabilità in un sito web non potrà quindi compromettere i file appartenenti al proprietario di un altro sito.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>APPROFONDIMENTO</em></span> Lista di moduli</strong></p></div></div></div><div
              class="para">
				L'elenco completo dei moduli standard per Apache può essere consultato online. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://httpd.apache.org/docs/2.4/mod/index.html">http://httpd.apache.org/docs/2.4/mod/index.html</a></div>
			</div></div><div
            class="para">
				Apache è un server modulare e molte funzionalità sono implementate da moduli esterni che il programma principale carica durante la fase di inizializzazione. La configurazione predefinita abilita solo i moduli più comuni ma abilitare un modulo è semplice: basta eseguire <code
              class="command">a2enmod <em
                class="replaceable">modulo</em></code>. Per disabilitare un modulo il comando è <code
              class="command">a2dismod <em
                class="replaceable">modulo</em></code>. Questi programmi non fanno altro che creare (o rimuovere) i collegamenti simbolici in <code
              class="filename">/etc/apache2/mods-enabled/</code> che puntano ai file (conservati in <code
              class="filename">/etc/apache2/mods-available/</code>).
			</div><div
            class="para">
				Con la sua configurazione predefinita, il server web rimane in ascolto sulla porta 80 (come configurato in <code
              class="filename">/etc/apache2/ports.conf</code>), e serve le pagine dalla directory <code
              class="filename">/var/www/html/</code> (come configurato in <code
              class="filename">/etc/apache2/sites-enabled/000-default.conf</code>).
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>APPROFONDIMENTI</em></span> Aggiungere il supporto per SSL</strong></p></div></div></div><a
              id="id-1.14.5.9.9.2"
              class="indexterm"></a><a
              id="id-1.14.5.9.9.3"
              class="indexterm"></a><div
              class="para">
				Apache 2.4 include il modulo SSL richiesto per rendere sicuro HTTP (HTTPS) senza bisogno di aggiunte. Naturalmente è richiesto che sia attivato con <code
                class="command">a2enmod ssl</code>, poi che le direttive richieste siano state aggiunte ai file di configurazione. Un esempio di configurazione è fornito in <code
                class="filename">/etc/apache2/sites-available/default-ssl.conf</code>. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://httpd.apache.org/docs/2.4/mod/mod_ssl.html">http://httpd.apache.org/docs/2.4/mod/mod_ssl.html</a></div>
			</div><div
              class="para">
				Qualche accortezza in più dve essere presa se si vuole permettere connessioni SSL con <span
                class="emphasis"><em>Perfect Forward Secrecy</em></span> (queste connessioni utilizzano chiavi di sessione effimere assicurando così che la compromissione della chiave segreta del server con comporti anche la compromissione del vecchio traffico di dati criptato che avrebbe potuto essere conservato effettuando sniffing sulla rete). Dai un'occhiata alle raccamondazioni di Mozilla, in particolare: <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="https://wiki.mozilla.org/Security/Server_Side_TLS#Apache">https://wiki.mozilla.org/Security/Server_Side_TLS#Apache</a></div>
			</div><a
              id="id-1.14.5.9.9.6"
              class="indexterm"></a></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.10"></a>11.2.2. Configurare gli host virtuali</h3></div></div></div><div
            class="para">
				Un host virtuale è una identità aggiuntiva per il server web.
			</div><a
            id="id-1.14.5.10.3"
            class="indexterm"></a><div
            class="para">
				Apache considera due tipologie differenti di host virtuali: quelli che sono basati sull'indirizzo IP (o sulla porta) e quelli che si affidano al nome di dominio del server web. Il primo metodo richiede di allocare indirizzi IP (o porte) differenti per ogni sito, mentre il secondo metodo può funzionare con un singolo IP (ed una sola porta) e i siti vengono differenziati dal nome host inviato dal client HTTP (cosa che funziona unicamente con la versione 1.1 del protocollo HTTP che comunque è fortunatamente abbastanza vecchia da essere attualmente utilizzata su tutti i client).
			</div><div
            class="para">
				La (crescente) carenza di indirizzi IPv4 favorisce in genere il secondo metodo anche se questo è reso più complesso qualora gli host virtuali necessitino di fornire anche HTTPS poiché il protocollo SSL non è sempre disponibile in caso di host virtuali basati sul nome. L'estensione SNI (<span
              class="emphasis"><em>Server Name Indication</em></span>) che permette questo genere di combinazione non è supportata da tutti i browser. Quando più siti HTTPS necessitano di girare sullo stesso server vengono spesso differenziati utilizzando una porta o un indirizzo IP differente (IPv6 in questo caso può essere d'aiuto).
			</div><div
            class="para">
				La configurazione predefinita per Apache 2 abilita gli host virtuali basati sul nome. Inoltre, è definito un host virtuale predefinito nel file <code
              class="literal">/etc/apache2/sites-enabled/000-default.conf</code>: questo host virtuale viene utilizzato qualora non venga trovato alcun host che corrisponde alla richiesta inviata dal client.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ATTENZIONE</em></span> Il primo host virtuale</strong></p></div></div></div><div
              class="para">
				Le richieste che riguardano host virtuali sconosciuti sono sempre servite dal primo host virtuale definito: ecco perché abbiamo definito <code
                class="literal">www.falcot.com</code> per primo.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>APPROFONDIMENTO</em></span> Apache supporta SNI</strong></p></div></div></div><a
              id="id-1.14.5.10.8.2"
              class="indexterm"></a><div
              class="para">
				Il server Apache supporta un'estensione del protocollo SSL chiamata <span
                class="emphasis"><em>Server Name Indication</em></span> (SNI). Questa estensione permette al browser di inviare il nome host del server web durante l'avvio di una connessione SSL, cioè molto prima della stessa richiesta HTTP, che veniva precedentemente utilizzata per identificare l'host virtuale richiesto tra quelli ospitati sullo stesso server (con lo stesso indirizzo IP e la stessa porta). Questo permette ad Apache di selezionare il certificato SSL più appropriato per la connessione da stabilire.
			</div><div
              class="para">
				Prima di SNI, Apache avrebbe sempre utilizzato il certificato definito nell'host virtuale predefinito. I client che tentavano di accedere ad un altro host virtuale visualizzavano degli avvertimenti poiché il certificato ricevuto non corrispondeva al sito web a cui avevano tentato di accedere. Fortunatamente oggi la maggior parte dei browser supportano SNI: tra questi Microsoft Internet Explorer a partire dalla versione 7.0 (iniziando da Vista), Mozilla Firefox dalla versione 2.0, Apple Safari dalla versione 3.2.1 e Google Chrome in tutte le sue versioni.
			</div><div
              class="para">
				Il pacchetto Apache fornito in Debian è costruito con il supporto per SNI; non è quindi necessaria alcuna configurazione particolare.
			</div><div
              class="para">
				Dev'essere prestata attenzione per assicurare che la configurazione del primo host virtuale (quello predefinito) abiliti TLSv1. Apache utilizza i parametri di questo primo host virtuale per stabilire connessioni sicure ed è bene che tali parametri siano impostati per consentirle!
			</div></div><div
            class="para">
				Ogni host virtuale aggiuntivo viene descritto da un file conservato in <code
              class="filename">/etc/apache2/sites-available/</code>. Quindi impostare un sito web per il dominio <code
              class="literal">falcot.org</code> richiede semplicemente la creazione del file seguente e l'abilitazione dell'host virtuale con <code
              class="command">a2ensite www.falcot.org</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.10.10"></a><p
              class="title"><strong>Esempio 11.16. Il file <code
                  class="filename">/etc/apache2/sites-available/www.falcot.org.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">
&lt;VirtualHost *:80&gt;
ServerName www.falcot.org
ServerAlias falcot.org
DocumentRoot /srv/www/www.falcot.org
&lt;/VirtualHost&gt;</pre></div></div><div
            class="para">
				Il server Apache, configurato come visto, utilizza gli stessi file di log per tutti gli host virtuali (anche se questo può essere modificato inserendo direttive <code
              class="literal">CustomLog</code> nelle definizioni degli host virtuali). Questo è un buon motivo per personalizzare il formato di questo file di log perché includa il nome dell'host virtuale. Questo può essere fatto creando un file <code
              class="filename">/etc/apache2/conf-available/customlog.conf</code> che definisce un nuovo formato per tutti i file di log (con la direttiva <code
              class="literal">LogFormat</code>) ed abilitandolo con <code
              class="command">a2enconf customlog</code>. La riga <code
              class="literal">CustomLog</code> dev'essere quindi rimossa (o commentata) dal file <code
              class="filename">/etc/apache2/sites-available/000-default.conf</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.10.12"></a><p
              class="title"><strong>Esempio 11.17. Il file <code
                  class="filename">/etc/apache2/conf.d/customlog.conf</code></strong></p><div
              class="example-contents"><pre
                class="programlisting scale">
# Nuovo formato di log che include il nome dell'host (virtuale)
LogFormat "%v %h %l %u %t \"%r\" %&gt;s %b \"%{Referer}i\" \"%{User-Agent}i\"" vhost

# Quindi utilizziamo questo formato "vhost" in via predefinita
CustomLog /var/log/apache2/access.log vhost</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.11"></a>11.2.3. Direttive comuni</h3></div></div></div><div
            class="para">
				Questa sezione esamina brevemente alcune delle direttive di configurazione di uso comune di Apache.
			</div><a
            id="id-1.14.5.11.3"
            class="indexterm"></a><a
            id="id-1.14.5.11.4"
            class="indexterm"></a><div
            class="para">
				Il file di configurazione principale include generalmente diversi blocchi <code
              class="literal">Directory</code> che consentono di specificare diversi comportamenti per il server in base alla posizione del file che dev'essere servito. Un blocco generalmente include le direttive <code
              class="literal">Options</code> e <code
              class="literal">AllowOverride</code>.
			</div><a
            id="id-1.14.5.11.6"
            class="indexterm"></a><a
            id="id-1.14.5.11.7"
            class="indexterm"></a><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.11.8"></a><p
              class="title"><strong>Esempio 11.18. Blocco Directory</strong></p><div
              class="example-contents"><pre
                class="programlisting">
&lt;Directory /var/www&gt;
Options Includes FollowSymlinks
AllowOverride All
DirectoryIndex index.php index.html index.htm
&lt;/Directory&gt;</pre></div></div><div
            class="para">
				La direttiva <code
              class="literal">DirectoryIndex</code> contiene una lista di file da provare quando la richiesta del client corrisponde ad una directory. Il primo file nella lista che esiste viene inviato come risposta.
			</div><a
            id="id-1.14.5.11.10"
            class="indexterm"></a><div
            class="para">
				La direttiva <code
              class="literal">Options</code> è seguita da una lista di opzioni da abilitare. Il valore <code
              class="literal">None</code> disabilita tutte le opzioni; così come, <code
              class="literal">All</code> le abilita tutte ad eccezione di <code
              class="literal">MultiViews</code>. Le opzioni disponibili includono:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">ExecCGI</code> indica che gli script CGI possono essere eseguiti. <a
                    id="id-1.14.5.11.12.1.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">FollowSymlinks</code> informa il server che i collegamenti simbolici possono essere seguiti e che la risposta deve contenere i contenuti della destinazione indicata dai collegamenti. <a
                    id="id-1.14.5.11.12.2.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">SymlinksIfOwnerMatch</code> comunica al server di seguire i collegamenti simbolici, ma solo quando il collegamento e la sua destinazione hanno lo stesso proprietario. <a
                    id="id-1.14.5.11.12.3.1.2"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">Includes</code> abilita le <span
                    class="emphasis"><em>inclusioni lato server</em></span> (abbreviato con <span
                    class="emphasis"><em>SSI</em></span> in lingua inglese). Queste sono direttive incorporate nelle pagine HTML ed eseguite in tempo reale ad ogni richiesta. <a
                    id="id-1.14.5.11.12.4.1.4"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">Indexes</code> comunica al server di elencare i contenuti di una directory se la richiesta HTTP inviata dal client punta ad una directory senza file di indice (cioè quando in questa directory non esiste alcun file menzionato dalla direttiva <code
                    class="literal">DirectoryIndex</code>). <a
                    id="id-1.14.5.11.12.5.1.3"
                    class="indexterm"></a>
					</div></li><li
                class="listitem"><div
                  class="para">
						<code
                    class="literal">MultiViews</code> abilita la negoziazione del contenuto: questa opzione può essere utilizzata dal server per fornire una pagina web che corrisponda alla lingua preferita configurata nel browser. <a
                    id="id-1.14.5.11.12.6.1.2"
                    class="indexterm"></a>
					</div></li></ul></div><div
            class="para">
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>FONDAMENTALI</em></span> il file <code
                        class="filename">.htaccess</code></strong></p></div></div></div><div
              class="para">
				Il file <code
                class="filename">.htaccess</code> contiene direttive di configurazione Apache da applicare ogni volta che una richiesta riguarda un elemento della directory dov'è contenuto. Il campo d'applicazione di queste direttive riguarda ricorsivamente anche tutte le sottodirectory al suo interno.
			</div><a
              id="id-1.14.5.11.14.3"
              class="indexterm"></a><div
              class="para">
				La maggior parte delle direttive che possono apparire in un blocco <code
                class="literal">Directory</code> sono anche permesse in un file <code
                class="filename">.htaccess</code>.
			</div></div><div
            class="para">
				La direttiva <code
              class="literal">AllowOverride</code> elenca tutte le opzioni che possono essere abilitate o disabilitate attraverso un file <code
              class="filename">.htaccess</code>. Un utilizzo comune di questa opzione riguarda la limitazione di <code
              class="literal">ExecCGI</code> per permettere all'amministratore di scegliere quali utenti sono autorizzati ad eseguire programmi con l'identità del server web (l'utente <code
              class="literal">www-data</code>).
			</div><a
            id="id-1.14.5.11.16"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.5.11.17"></a>11.2.3.1. Richiedere un'autenticazione</h4></div></div></div><a
              id="id-1.14.5.11.17.2"
              class="indexterm"></a><div
              class="para">
					In alcune circostanze l'accesso a parte dei contenuti di un sito web deve essere ristretto ai soli utenti autorizzati che forniscono un nome utente ed una password.
				</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.5.11.17.4"></a><p
                class="title"><strong>Esempio 11.19. Richiedere l'autenticazione con un file <code
                    class="filename">.htaccess</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
Require valid-user
AuthName "Directory privata"
AuthType Basic
AuthUserFile /etc/apache2/authfiles/htpasswd-private</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>SICUREZZA</em></span> Nessuna sicurezza</strong></p></div></div></div><div
                class="para">
					Il sistema di autenticazione utilizzato nell'esempio visto in precedenza (<code
                  class="literal">Basic</code>) fornisce una sicurezza minima poiché la password è inviata in chiaro (è semplicemente codificata in <span
                  class="emphasis"><em>base64</em></span> che è una semplice codifica anziché un metodo di cifratura). Va inoltre sottolineato che anche i documenti «protetti» da questo meccanismo passano attraverso la rete in chiaro. Se la sicurezza è importante l'intera connessione HTTP dovrebbe essere cifrata con SSL.
				</div></div><div
              class="para">
					Il file <code
                class="filename">/etc/apache2/authfiles/htpasswd-private</code> contiene una lista di utenti e password che sono generalmente manipolati con il comando <code
                class="command">htpasswd</code>. Per esempio il seguente comando è utilizzato per aggiungere un utente o cambiare la sua password: <a
                id="id-1.14.5.11.17.6.3"
                class="indexterm"></a>
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>htpasswd /etc/apache2/authfiles/htpasswd-private <em
                    class="replaceable">utente</em>
</code></strong><code
                class="computeroutput">New password:
Re-type new password:
Adding password for user <em
                  class="replaceable">user</em>
</code></pre></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      xmlns=""
                      id="id-1.14.5.11.18"></a>11.2.3.2. Limitare l'accesso</h4></div></div></div><a
              id="id-1.14.5.11.18.2"
              class="indexterm"></a><div
              class="para">
					La direttiva <code
                class="literal">Require</code> controlla le restrizioni di accesso ad una directory (e ricorsivamente, alle sue sottodirectory).
				</div><a
              id="id-1.14.5.11.18.4"
              class="indexterm"></a><a
              id="id-1.14.5.11.18.5"
              class="indexterm"></a><a
              id="id-1.14.5.11.18.6"
              class="indexterm"></a><div
              class="para">
					Può essere usata per limitare l'accesso in base a molti criteri; ci soffermeremo alla descrizione delle limitazioni di accesso in base all'indirizzo IP del client, ma possono essere apllicate politiche ancora più restrittive, in particolare quando più direttive <code
                class="literal">Require</code> sono combinate all'interno di un blocco <code
                class="literal">RequireAll</code>.
				</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.5.11.18.8"></a><p
                class="title"><strong>Esempio 11.20. Consenti solo dalla rete locale</strong></p><div
                class="example-contents"><pre
                  class="programlisting">Require ip 192.168.0.0/16</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ALTERNATIVA</em></span> Vecchia sintassi</strong></p></div></div></div><div
                class="para">
					La sintassi <code
                  class="literal">Require</code> è disponibile solo in Apache 2.4 (la versione disponibile in <span
                  class="distribution distribution">Jessie</span>). Per gli utenti di <span
                  class="distribution distribution">Wheezy</span>, la sintassi di Apache 2.2 è differente, e qui la descriviamo principalmente per riferimento, anche se può anche essere resa disponibile in Apache 2.4 utilizzando il modulo <code
                  class="literal">mod_access_compact</code>.
				</div><div
                class="para">
					Le direttive <code
                  class="literal">Allow from</code> e <code
                  class="literal">Deny from</code> controllano le restrizioni di accesso ad una directory (e ricorsivamente, le sottodirectory).
				</div><a
                id="id-1.14.5.11.18.9.4"
                class="indexterm"></a><a
                id="id-1.14.5.11.18.9.5"
                class="indexterm"></a><a
                id="id-1.14.5.11.18.9.6"
                class="indexterm"></a><div
                class="para">
					La direttiva <code
                  class="literal">Order</code> comunica al server l'ordine con cui le direttive <code
                  class="literal">Allow from</code> e <code
                  class="literal">Deny from</code> devono essere applicate: l'ultima che corrisponde ha la precedenza. In parole povere, <code
                  class="literal">Order deny,allow</code> consente l'accesso se nessuna direttiva <code
                  class="literal">Deny from</code> è soddisfatta oppure se lo è una direttiva <code
                  class="literal">Allow from</code>. Al contrario <code
                  class="literal">Order allow,deny</code> rifiuta l'accesso se nessuna direttiva <code
                  class="literal">Allow from</code> è soddisfatta (oppure se lo è una direttiva <code
                  class="literal">Deny from</code>).
				</div><div
                class="para">
					Le direttive <code
                  class="literal">Allow from</code> e <code
                  class="literal">Deny from</code> possono essere seguite da un indirizzo IP, da una rete (come <code
                  class="literal">192.168.0.0/255.255.255.0</code>, <code
                  class="literal">192.168.0.0/24</code> o anche <code
                  class="literal">192.168.0</code>), un nome host oppure un nome di dominio, o ancora dalla parola chiave <code
                  class="literal">all</code> che indica tutti.
				</div><div
                class="para">
					Ad esempio, per rifiutare di default le connessioni ma permetterle dalla rete locale, è possibile utilizzare questo:
				</div><pre
                class="programlisting">
Order deny,allow
Allow from 192.168.0.0/16
Deny from all</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.5.12"></a>11.2.4. Analizzatori di log</h3></div></div></div><div
            class="para">
				Nel server web viene spesso installato un analizzatore di log: quest'ultimo fornisce agli amministratori una idea precisa riguardo le modalità d'utilizzo cui è sottoposto.
			</div><div
            class="para">
				Gli amministratori della Falcot Corporation hanno scelto <span
              class="emphasis"><em>AWStats</em></span> (<span
              class="emphasis"><em>Advanced Web Statistics</em></span>) per analizzare i loro file log di Apache.
			</div><a
            id="id-1.14.5.12.4"
            class="indexterm"></a><a
            id="id-1.14.5.12.5"
            class="indexterm"></a><a
            id="id-1.14.5.12.6"
            class="indexterm"></a><a
            id="id-1.14.5.12.7"
            class="indexterm"></a><div
            class="para">
				Il primo passo per la configurazione è personalizzazione del file <code
              class="filename">/etc/awstats/awstats.conf</code>.Gli amministratori della Falcot lo mantengono così com'è modificando solo i parametri seguenti:
			</div><pre
            class="programlisting">
LogFile="/var/log/apache2/access.log"
LogFormat = "%virtualname %host %other %logname %time1 %methodurl %code %bytesd %refererquot %uaquot"
SiteDomain="www.falcot.com"
HostAliases="falcot.com REGEX[^.*\.falcot\.com$]"
DNSLookup=1
LoadPlugin="tooltips"</pre><div
            class="para">
				Tutti questi parametri sono documentati dai commenti nel file modello. In particolare i parametri <code
              class="varname">LogFile</code> e <code
              class="varname">LogFormat</code> descrivono la posizione ed il formato del file di log e le informazioni che contiene: <code
              class="varname">SiteDomain</code> e <code
              class="varname">HostAliases</code> elencano i vari nomi con cui il sito web principale viene indicato.
			</div><div
            class="para">
				Per siti con molto traffico, <code
              class="varname">DNSLookup</code> non dovrebbe essere impostato a <code
              class="literal">1</code> ma per i siti minori, come quello della Falcot descritto in precedenza, questa impostazione permette di avere dei resoconti più leggibili che includono il nome completo delle macchine anziché il semplice indirizzo IP.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SICUREZZA</em></span> Accesso alle statistiche</strong></p></div></div></div><div
              class="para">
				AWStats rende disponibili le sue statistiche sul sito web senza alcuna restrizione in via predefinita ma le restrizioni possono essere attivate così che solo pochi indirizzi IP (probabilmente interni) possano accedervi: la lista degli indirizzi IP autorizzati dev'essere definita nel parametro <code
                class="varname">AllowAccessFromWebToFollowingIPAddresses</code>
			</div></div><div
            class="para">
				AWStats sarà anche attivato per gli altri host virtuali: ogni host virtuale richiede il proprio file di configurazione, come <code
              class="filename">/etc/awstats/awstats.www.falcot.org.conf</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.5.12.14"></a><p
              class="title"><strong>Esempio 11.21. File di configurazione di AWStats per un host virtuale</strong></p><div
              class="example-contents"><pre
                class="programlisting">
Include "/etc/awstats/awstats.conf"
SiteDomain="www.falcot.org"
HostAliases="falcot.org"</pre></div></div><div
            class="para">
				AWStats usa molte delle icone conservate nella directory <code
              class="filename">/usr/share/awstats/icon/</code>. Perché queste icone siano disponibili sul sito web la configurazione di Apache dev'essere adattata per includere la seguente direttiva:
			</div><pre
            class="programlisting">
Alias /awstats-icon/ /usr/share/awstats/icon/</pre><div
            class="para">
				Dopo qualche minuto (e una volta che lo script è stato eseguito qualche volta) i risultati saranno visibili online: <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://www.falcot.com/cgi-bin/awstats.pl">http://www.falcot.com/cgi-bin/awstats.pl</a></div><div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://www.falcot.org/cgi-bin/awstats.pl">http://www.falcot.org/cgi-bin/awstats.pl</a></div>
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ATTENZIONE</em></span> Rotazione dei file di log</strong></p></div></div></div><div
              class="para">
				Perché le statistiche prendano in considerazione tutti i log nell'account,<span
                class="emphasis"><em>AWStats</em></span> necessita di essere eseguito subito prima che i file di log di Apache siano ruotati. Guardando la direttiva <code
                class="literal">prerotate</code> del file <code
                class="filename">/etc/logrotate.d/apache2</code>, questo si può ottenere aggiungendo un link simbolico a <code
                class="filename">/usr/share/awstats/tools/update.sh</code> in <code
                class="filename">/etc/logrotate.d/httpd-prerotate</code>:
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>cat /etc/logrotate.d/apache2
</code></strong><code
                class="computeroutput">/var/log/apache2/*.log {
  daily
  missingok
  rotate 14
  compress
  delaycompress
  notifempty
  create 644 root adm
  sharedscripts
  postrotate
    if /etc/init.d/apache2 status &gt; /dev/null ; then \
      /etc/init.d/apache2 reload &gt; /dev/null; \
    fi;
  endscript
  prerotate
    if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
      run-parts /etc/logrotate.d/httpd-prerotate; \
    fi; \
  endscript
}
$ </code><strong
                class="userinput"><code>sudo mkdir -p /etc/logrotate.d/httpd-prerotate
</code></strong><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>sudo ln -sf /usr/share/awstats/tools/update.sh \
  /etc/logrotate.d/httpd-prerotate/awstats
</code></strong></pre><div
              class="para">
				Notare inoltre che i file di log creati da <code
                class="command">logrotate</code> devono essere leggibili da chiunque, specialmente da AWStats. Nell'esempio visto prima, questo è assicurato dalla riga <code
                class="literal">create 644 root adm</code> (invece dei permessi <code
                class="literal">640</code> predefiniti).
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="network-services.html"><strong>Indietro</strong>Capitolo 11. Servizi di rete: Postfix, Apache, NF...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Risali</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Partenza</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.ftp-file-server.html"><strong>Avanti</strong>11.3. Server di file FTP</a></li></ul></body></html>
