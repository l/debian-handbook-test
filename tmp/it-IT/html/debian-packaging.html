<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">Capitolo 15. Creazione di un pacchetto Debian</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-it-IT-1.0-1" /><meta
        name="keywords"
        content="Backport, Rigenerazione, Pacchetto sorgente, Archivio, Meta-pacchetto, Sviluppatore Debian, Maintainer" /><link
        rel="home"
        href="index.html"
        title="Il Manuale dell'Amministratore Debian" /><link
        rel="up"
        href="index.html"
        title="Il Manuale dell'Amministratore Debian" /><link
        rel="prev"
        href="sect.dealing-with-compromised-machine.html"
        title="14.7. Gestire una macchina compromessa" /><link
        rel="next"
        href="sect.building-first-package.html"
        title="15.2. Creare il primo pacchetto" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/it-IT/stable/debian-packaging.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>Indietro</strong></a></li><li
          class="home">Il Manuale dell'Amministratore Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>Avanti</strong></a></li></ul><div
        xml:lang="it-IT"
        class="chapter"
        lang="it-IT"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  xmlns=""
                  id="debian-packaging"></a>Capitolo 15. Creazione di un pacchetto Debian</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="debian-packaging.html#sect.rebuilding-package">15.1. Rigenerare un pacchetto dai suoi sorgenti</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.3">15.1.1. Ottenere i sorgenti</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.4">15.1.2. Apportare modifiche</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#id-1.18.4.5">15.1.3. Iniziare la rigenerazione del pacchetto</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.building-first-package.html">15.2. Creare il primo pacchetto</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#id-1.18.5.2">15.2.1. Meta-pacchetti o pacchetti finti</a></span></dt><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#id-1.18.5.3">15.2.2. Semplice file di archivio</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.setup-apt-package-repository.html">15.3. Creazione di un repository di pacchetti per APT</a></span></dt><dt><span
                class="section"><a
                  href="sect.becoming-package-maintainer.html">15.4. Diventare un maintainer di pacchetti</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#id-1.18.7.2">15.4.1. Imparare a creare pacchetti</a></span></dt><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#id-1.18.7.3">15.4.2. Processo di accettazione</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		È abbastanza comune, per un amministratore che gestisce regolarmente i pacchetti Debian, sentire la necessità di creare dei propri pacchetti, o di modificarne uno già esistente. Questo capitolo serve proprio a rispondere alle domande più comuni sulla pacchettizzazione e fornire gli elementi necessari per utilizzare l'infrastruttura Debian nel migliore dei modi. Con po' di fortuna, dopo essersi cimentati con i pacchetti locali, si può anche sentire il bisogno di andare oltre e aderire al progetto Debian!
	</div></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    xmlns=""
                    id="sect.rebuilding-package"></a>15.1. Rigenerare un pacchetto dai suoi sorgenti</h2></div></div></div><div
            class="para">
			Rigenerare un pacchetto binario può rendersi necessario per una serie di motivi. In alcuni casi, l'amministratore ha bisogno di una funzionalità presente nel software che richiede la compilazione dello stesso dai sorgenti, con una particolare opzione di compilazione; in altri casi, il software pacchettizzato per la versione di Debian installata non è abbastanza recente. In quest'ultimo caso, l'amministratore di solito costruisce un pacchetto più recente prendendolo da una nuova versione di Debian — come <span
              class="distribution distribution">Testing</span> o addirittura <span
              class="distribution distribution">Unstable</span> — in modo che questo nuovo pacchetto funzioni nella distribuzione <span
              class="distribution distribution">Stable</span>; questa operazione è chiamata "backporting". Come al solito, prima di cominciare, è necessario controllare se qualcun altro ha già effettuato quest'attività — un rapido sguardo alle pagine del sistema di tracciamento dei pacchetti può darci le informazioni che cerchiamo. <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="https://tracker.debian.org/">https://tracker.debian.org/</a></div> <a
              id="id-1.18.4.2.5"
              class="indexterm"></a>
		</div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.18.4.3"></a>15.1.1. Ottenere i sorgenti</h3></div></div></div><div
              class="para">
				La prima cosa da fare per rigenerare un pacchetto Debian è quella di procurarsi i sorgenti. Il modo più semplice è quello di utilizzare il comando <code
                class="command">apt-get source <em
                  class="replaceable">source-package-name</em></code>. Questo comando richiede che sia presente una riga con <code
                class="literal">deb-src</code> nel file <code
                class="filename">/etc/apt/sources.list</code> e che i file di indice siano aggiornati (ad esempio con <code
                class="command">apt-get update</code>). Se si sono seguite le istruzioni nel capitolo che tratta la configurazione di APT (si veda <a
                class="xref"
                href="apt.html#sect.apt-sources.list">Sezione 6.1, «Compilazione del file <code
                  class="filename">sources.list</code>»</a>), questi requisiti dovrebbero già essere soddisfatti. Si noti, tuttavia, che verranno scaricati i pacchetti sorgente della versione di Debian riportata nella riga <code
                class="literal">deb-src</code>. Se si ha bisogno di un'altra versione, potrebbe essere necessario scaricarla manualmente da un mirror Debian o dal sito web. Questo comporta il recupero di due o tre file (con estensione <code
                class="filename">*.dsc</code>, per i <span
                class="emphasis"><em>Debian Source Control</em></span>, <code
                class="filename">*.tar.<em
                  class="replaceable">comp</em></code> e a volte <code
                class="filename">*.diff.gz</code> o <code
                class="filename">*.debian.tar.<em
                  class="replaceable">comp</em></code> — <em
                class="replaceable">comp</em> prendendo un valore tra <code
                class="literal">gz</code>, <code
                class="literal">bz2</code> o <code
                class="literal">xz</code> a seconda dello strumento di compressione che è stato utilizzato), e l'esecuzione del comando <code
                class="command">dpkg-source -x <em
                  class="replaceable">file.dsc</em></code>. Se il file <code
                class="filename">*.dsc</code> è accessibile direttamente da un determinato URL, c'è un modo ancora più semplice per recuperare il tutto, con il comando <code
                class="command">dget <em
                  class="replaceable">URL</em></code>. Questo comando (che si trova nel pacchetto <span
                class="pkg pkg">devscripts</span>) recupera il file <code
                class="filename">*.dsc</code> dall'indirizzo indicato, analizza il suo contenuto, e recupera automaticamente il file o i file a cui fa riferimento. Una volta che tutto è scato scaricato, estrare il pacchetto sorgente (a meno che non venga utilizzata l'opzione <code
                class="literal">-d</code> or <code
                class="literal">--download-only</code>).
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.18.4.4"></a>15.1.2. Apportare modifiche</h3></div></div></div><div
              class="para">
				Il sorgente del pacchetto è ora disponibile in una directory con lo stesso nome del pacchetto sorgente e della sua versione (per esempio, <span
                class="emphasis"><em>samba-4.1.17+dfsg</em></span>); qui è dove verranno effetuate tutte le modifiche locali.
			</div><div
              class="para">
				La prima cosa da fare è cambiare il numero di versione del pacchetto, in modo che i pacchetti rigenerati possano essere distinti dai pacchetti originali forniti da Debian. Supponendo che la versione corrente sia la <code
                class="literal">2:4.1.17+dfsg-2</code>, possiamo creare la versione <code
                class="literal">2:4.1.17+dfsg-2falcot1</code>, che indica chiaramente l'origine del pacchetto. In questo modo il numero di versione del pacchetto sarà superiore a quello fornito da Debian, così il pacchetto verrà installato come un aggiornamento del pacchetto originale. Questa modifica può essere effettuata dal comando <code
                class="command">dch</code> (<span
                class="emphasis"><em>Debian CHangelog</em></span>) del pacchetto <span
                class="pkg pkg">devscripts</span>, eseguendolo in questo modo: <code
                class="command">dch --local falcot</code>. Questo comando richiama un editor di testo (<code
                class="command">sensible-editor</code>, dovrebbe essere l'editor preferito se è stato impostato nelle variabili d'ambiente <code
                class="varname">VISUAL</code> o <code
                class="varname">EDITOR</code> altrimenti verrà utilizzato quello predefinito) per permettere di documentare le modifiche effettuate da questa rigenerazione del pacchetto. Questo editor mostra che <code
                class="command">dch</code> ha modificato veramente il file <code
                class="filename">debian/changelog</code>.
			</div><div
              class="para">
				Quando è necessario cambiare delle opzioni di compilazione, devono essere apportate delle modifiche al file <code
                class="filename">debian/rules</code>, che definisce il processo di compilazione del pacchetto. Nei casi più semplici, le righe che riguardano la configurazione iniziale (<code
                class="literal">./configure …</code>) o la versione corrente (<code
                class="literal">$(MAKE) …</code> o <code
                class="literal">make …</code>) sono facili da individuare. Se questi comandi non sono chiamati esplicitamente, sono probabilmente un effetto collaterale di un altro comando esplicito, in questo caso si rimanda alla loro documentazione per saperne di più su come modificare il comportamento predefinito. Con i pacchetti che usano <code
                class="command">dh</code>, potrebbe essere necessario aggiungere un override per i comandi <code
                class="command">dh_auto_configure</code> o <code
                class="command">dh_auto_build</code> (si vedano le rispettive pagine di manuale per le spiegazioni su come fare).
			</div><div
              class="para">
				A seconda delle modifiche locali apportate ai pacchetti, può essere richiesto un aggiornamento anche nel file <code
                class="filename">debian/control</code>, che contiene una descrizione dei pacchetti generati. In particolare, questo file contiene le righe <code
                class="literal">Build-Depends</code> che permettono di controllare la lista delle dipendenze che devono essere soddisfatte nel momento della generazione del pacchetto. Queste spesso si riferiscono alle versioni dei pacchetti contenuti nella distribuzione da cui proviene il pacchetto sorgente, ma che potrebbero non essere disponibili nella distribuzione utilizzata per la rigenerazione. Non esiste un modo automatico per determinare se una dipendenza è reale o è specificata solamente per garantire che la costruzione deve essere eseguita solamente con l'ultima versione di una libreria. Questo è l'unico modo possibile per forzare un <span
                class="emphasis"><em>autobuilder</em></span> ad utilizzare una determinata versione del pacchetto durante la costruzione, ed è il motivo per cui i maintainer Debian spesso utilizzano le dipendenze per la compilazione con versioni specifiche.
			</div><div
              class="para">
				Se si sa per certo che queste dipendenze per la compilazione sono troppo stringenti, si possono rendere meno rigide localmente. I file che documentano il modo predefinito di costruire il software, spesso chiamati <code
                class="filename">INSTALL</code>, aiuteranno a capire quali sono le dipendenze appropriate. Idealmente, tutte le dipendenze devono poter essere soddisfatte dalla distribuzione utilizzata per la rigenerazione del pacchetto, se non lo sono, si avvia un processo ricorsivo, per cui per i pacchetti indicati nel campo <code
                class="literal">Build-Depends</code> deve essere fatto un «backport» prima che il pacchetto in questione sia costruito. Alcuni pacchetti non necessitano di backporting, e possono essere installati così come sono durante il processo di creazione (un esempio degno di nota è <span
                class="pkg pkg">debhelper</span>). Si noti che il processo di backporting può rapidamente diventare complesso se non si è attenti. Pertanto, i backport dovrebbero essere ridotti al minimo indispensabile, quando possibile.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>SUGGERIMENTO</em></span> Installazione dei <code
                          class="literal">Build-Depends</code></strong></p></div></div></div><a
                id="id-1.18.4.4.7.2"
                class="indexterm"></a><div
                class="para">
				<code
                  class="command">apt-get</code> permette d'installare tutti i pacchetti nei campi <code
                  class="literal">Build-Depends</code> di un pacchetto sorgente disponibile nella distribuzione indicata nella riga <code
                  class="literal">deb-src</code> del file <code
                  class="filename">/etc/apt/sources.list</code>. Per farlo basta eseguire il comando <code
                  class="command">apt-get build-dep <em
                    class="replaceable">source-package</em></code>.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.18.4.5"></a>15.1.3. Iniziare la rigenerazione del pacchetto</h3></div></div></div><div
              class="para">
				Quando sono state apportate tutte le modifiche necessarie ai sorgenti, si può iniziare a generare il pacchetto binario (il file <code
                class="filename">.deb</code>). L'intero processo è gestito dal comando <code
                class="command">dpkg-buildpackage</code>.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.18.4.5.3"></a><p
                class="title"><strong>Esempio 15.1. Rigenerazione di un pacchetto</strong></p><div
                class="example-contents"><pre
                  class="screen"><code
                    class="computeroutput">$ </code><strong
                    class="userinput"><code>dpkg-buildpackage -us -uc
</code></strong><code
                    class="computeroutput">[...]
</code></pre></div></div><div
              class="sidebar"><a
                xmlns=""
                id="sidebar.fakeroot"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>STRUMENTO</em></span> <code
                          class="command">fakeroot</code></strong></p></div></div></div><div
                class="para">
				Il processo di creazione di un pacchetto si occupa, in sostanza, di raccogliere una serie di file già esistenti (o costruiti) in un archivio, molti di questi file saranno di proprietà di <span
                  class="emphasis"><em>root</em></span>. Tuttavia, la costruzione di tutto il pacchetto utilizzando questo utente potrebbe comportare dei rischi, per fortuna questo può essere evitato con il comando <code
                  class="command">fakeroot</code>. Questo strumento può essere utilizzato per eseguire un programma, dandogli l'impressione che sia stato avviato dall'utente <span
                  class="emphasis"><em>root</em></span> e creare file con proprietà e permessi arbitrari. Quando il programma crea l'archivio che diventerà il pacchetto Debian, è indotto a creare un archivio contenente i file contrassegnati come appartenenti a proprietari arbitrari, incluso <span
                  class="emphasis"><em>root</em></span>. Questo è il tipo di configurazione consigliata, tanto che il programma <code
                  class="command">dpkg-buildpackage</code> utilizza <code
                  class="command">fakeroot</code> in maniera predefinita per la creazione dei pacchetti.
			</div><div
                class="para">
				È da notare che il programma è solamente portato a «credere» che è eseguito da un account privilegiato, il realtà il programma viene eseguito con l'utente che lancia il comando <code
                  class="command">fakeroot <em
                    class="replaceable">programma</em></code> (ed i file vengono creati con gli stessi permessi di questo utente). In questo modo non si utilizzano effettivamente i privilegi dell'utente root, dato che potrebbe essere pericoloso.
			</div></div><div
              class="para">
				Il comando precedente può fallire se i campi <code
                class="literal">Build-Depends</code> non sono stati aggiornati o se i relativi pacchetti non sono installati. In questo caso è possibile saltare questo controllo passando l'opzione <code
                class="literal">-d</code> al comando <code
                class="command">dpkg-buildpackage</code>. Tuttavia, ignorando esplicitamente queste dipendenze si corre il rischio che una fase successiva del processo di generazione fallisca. O peggio ancora, il pacchetto può sembrare generato correttamente, ma si comporta in modo anomalo: alcuni programmi disabilitano automaticamente alcune delle loro caratteristiche quando non è disponibile una libreria richiesta in fase di compilazione.
			</div><div
              class="para">
				Il più delle volte, gli sviluppatori Debian utilizzano un programma di alto livello come <code
                class="command">debuild</code>. Questo esegue <code
                class="command">dpkg-buildpackage</code> e richiama un programma che avvia molti controlli per convalidare le policy Debian del pacchetto generato. Questo script fa in modo che le variabili d'ambiente locali non «inquinino» la fase di generazione del pacchetto. Il comando <code
                class="command">debuild</code> è uno degli strumenti della suite <span
                class="emphasis"><em>devscripts</em></span>, che condividono la stessa consistenza e configurazione, per rendere il compito più facile ai maintainer.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>APPROFONDIMENTI</em></span> <code
                          class="command">pbuilder</code></strong></p></div></div></div><a
                id="id-1.18.4.5.7.2"
                class="indexterm"></a><div
                class="para">
				Il programma <code
                  class="command">pbuilder</code> (disponibile nel pacchetto con lo stesso nome) permette di costruire un pacchetto Debian in un ambiente isolato attraverso <span
                  class="emphasis"><em>chroot</em></span>. Prima di tutto viene creata una directory temporanea con il sistema minimale richiesto per la costruzione del pacchetto (inclusi i pacchetti elencati nel campo <span
                  class="emphasis"><em>Build-Depends</em></span> field). Questa directory viene usata come directory radice (<code
                  class="filename">/</code>), utilizzando il comando <code
                  class="command">chroot</code> durante la generazione del pacchetto.
			</div><div
                class="para">
				Questo strumento fa in modo che il processo di generazione del pacchetto avvenga in un ambiente che non può essere alterato dagli utenti. Ciò consente un veloce rilevamento delle mancate dipendenze di compilazione (dal momento che la costruzione non andrà a buon fine, a meno che non vengano documentate le dipendenze appropriate). Infine, permette la costruzione di un pacchetto per una distribuzione di Debian diversa da quella utilizzata nel sistema: la macchina può usare la distribuzione <span
                  class="distribution distribution">Stable</span> per il suo normale lavoro e nella stessa macchina, avviare <code
                  class="command">pbuilder</code> per utilizzare la distribuzione <span
                  class="distribution distribution">Unstable</span> per costruire un pacchetto.
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>Indietro</strong>14.7. Gestire una macchina compromessa</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Risali</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Partenza</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>Avanti</strong>15.2. Creare il primo pacchetto</a></li></ul></body></html>
