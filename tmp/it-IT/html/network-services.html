<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">Capitolo 11. Servizi di rete: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-it-IT-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="Il Manuale dell'Amministratore Debian" /><link
        rel="up"
        href="index.html"
        title="Il Manuale dell'Amministratore Debian" /><link
        rel="prev"
        href="sect.network-diagnosis-tools.html"
        title="10.8. Strumenti di diagnosi di rete" /><link
        rel="next"
        href="sect.http-web-server.html"
        title="11.2. Server web (HTTP)" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/it-IT/stable/network-services.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>Indietro</strong></a></li><li
          class="home">Il Manuale dell'Amministratore Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>Avanti</strong></a></li></ul><div
        xml:lang="it-IT"
        class="chapter"
        lang="it-IT"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  xmlns=""
                  id="network-services"></a>Capitolo 11. Servizi di rete: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="network-services.html#sect.smtp-mail-server">11.1. Server di posta</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.7">11.1.1. Installare Postfix</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.configuring-virtual-domains">11.1.2. Configurare i domini virtuali</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.restrictions-for-receiving-and-sending">11.1.3. Restrizioni per ricezione ed invio</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.setting-up-greylisting">11.1.4. Impostare il <span
                        class="foreignphrase"><em
                          class="foreignphrase">greylisting</em></span></a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#id-1.14.4.11">11.1.5. Personalizzare i filtri in base al destinatario</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.postfix-antivirus">11.1.6. Integrare un antivirus</a></span></dt><dt><span
                    class="section"><a
                      href="network-services.html#sect.authenticated-smtp">11.1.7. SMTP autenticato</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-web-server.html">11.2. Server web (HTTP)</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.9">11.2.1. Installare Apache</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.10">11.2.2. Configurare gli host virtuali</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.11">11.2.3. Direttive comuni</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-web-server.html#id-1.14.5.12">11.2.4. Analizzatori di log</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ftp-file-server.html">11.3. Server di file FTP</a></span></dt><dt><span
                class="section"><a
                  href="sect.nfs-file-server.html">11.4. Server di file NFS</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.10">11.4.1. Mettere in sicurezza NFS</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.11">11.4.2. Server NFS</a></span></dt><dt><span
                    class="section"><a
                      href="sect.nfs-file-server.html#id-1.14.7.12">11.4.3. Client NFS</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.windows-file-server-with-samba.html">11.5. Configurare condivisioni Windows con Samba</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.9">11.5.1. Server Samba</a></span></dt><dt><span
                    class="section"><a
                      href="sect.windows-file-server-with-samba.html#id-1.14.8.10">11.5.2. Client Samba</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.http-ftp-proxy.html">11.6. Proxy HTTP/FTP</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.8">11.6.1. Installazione</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.9">11.6.2. Configurare una cache</a></span></dt><dt><span
                    class="section"><a
                      href="sect.http-ftp-proxy.html#id-1.14.9.10">11.6.3. Configurare un filtro</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.ldap-directory.html">11.7. Directory LDAP</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.7">11.7.1. Installazione</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.8">11.7.2. Riempire la directory</a></span></dt><dt><span
                    class="section"><a
                      href="sect.ldap-directory.html#id-1.14.10.9">11.7.3. Gestire gli account con LDAP</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.rtc-services.html">11.8. Servizi di Comunicazione Real-Time</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-dns-settings">11.8.1. Impostazioni DNS per i servizi RTC</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.turn-server">11.8.2. Server TURN</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.sip-server">11.8.3. Proxy Server SIP</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.xmpp-server">11.8.4. Server XMPP</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-port-443">11.8.5. Servizi in esecuzione sulla porta 443</a></span></dt><dt><span
                    class="section"><a
                      href="sect.rtc-services.html#sect.rtc-webrtc">11.8.6. Aggiungere WebRTC</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		I servizi di rete sono i programmi con cui gli utenti interagiscono direttamente durante le loro attività quotidiane. Essi sono la punta dell'iceberg del sistema informativo ed in questo capitolo ci concentreremo su di loro; le componenti invisibili a cui si affidano sono l'infrastruttura che abbiamo descritto precedentemente.
	</div><div
            class="para">
		Molti servizi di rete moderni richiedono una tecnologia di crittografia per funzionare in modo affidabile e sicuro, soprattutto se usati su Internet pubblico. I Certificati X.509 (che possono essere chiamati anche certificati SSL o certificati TLS) sono spesso utilizzati per questo scopo. Un certificato per uno specifico dominio può spesso essere condiviso tra più di uno dei servizi trattati in questo capitolo.
	</div><a
            id="id-1.14.3.3"
            class="indexterm"></a><a
            id="id-1.14.3.4"
            class="indexterm"></a><a
            id="id-1.14.3.5"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    xmlns=""
                    id="sect.smtp-mail-server"></a>11.1. Server di posta</h2></div></div></div><div
            class="para">
			Gli amministratori della Falcot Corporation hanno scelto Postfix come loro server di posta elettronica per via della sua affidabilità e per la semplicità di configurazione. Allo stesso modo il suo design assicura che ogni operazione sia eseguita in un processo con l'insieme minimo di permessi richiesti, cosa che garantisce una misura ottimale contro i problemi di sicurezza.
		</div><a
            id="id-1.14.4.3"
            class="indexterm"></a><a
            id="id-1.14.4.4"
            class="indexterm"></a><a
            id="id-1.14.4.5"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIVA</em></span> Il server Exim4</strong></p></div></div></div><a
              id="id-1.14.4.6.2"
              class="indexterm"></a><div
              class="para">
			Debian utilizza Exim4 come server di posta predefinito (per questo l'installazione iniziale include Exim4). La configurazione è fornita da un pacchetto separato, <span
                class="pkg pkg">exim4-config</span>, e viene automaticamente personalizzata in base alle risposte fornite ad un insieme di quesiti posti da Debconf in modo molto simile a come avviene con le domande poste dal pacchetto <span
                class="pkg pkg">postfix</span>.
		</div><div
              class="para">
			La configurazione può essere in un singolo file (<code
                class="filename">/etc/exim4/exim4.conf.template</code>) oppure suddivisa in parti all'interno della cartella <code
                class="filename">/etc/exim4/conf.d/</code>. In entrambi i casi, i file non sono utilizzati da <code
                class="command">update-exim4.conf</code> come modelli per la generazione di <code
                class="filename">/var/lib/exim4/config.autogenerated</code>. Quest'ultimo è utilizzato da Exim4. Grazie a questo meccanismo, i valori ottenuti attraverso la configurazione debconf di Exim — che sono memorizzati in <code
                class="filename">/etc/exim4/update-exim4.conf.conf</code> — possono essere inseriti nel file di configurazione di Exim anche quando l'amministratore oppure un'altro pacchetto hanno cambiato la configurazione predefinita di Exim.
		</div><div
              class="para">
			La sintassi dei file di configurazione di Exim4 ha le sue peculiarità e la sua curva di apprendimento. Una volta comprese queste peculiarità Exim4 è un server di posta veramente completo e potente come testimoniano le decine di pagine di documentazione. <div
                xmlns=""
                class="url">→ <a
                  xmlns="http://www.w3.org/1999/xhtml"
                  href="http://www.exim.org/docs.html">http://www.exim.org/docs.html</a></div>
		</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.14.4.7"></a>11.1.1. Installare Postfix</h3></div></div></div><div
              class="para">
				Il pacchetto <span
                class="pkg pkg">postfix</span> include il demone SMTP principale. Altri pacchetti (come <span
                class="pkg pkg">postfix-ldap</span> e <span
                class="pkg pkg">postfix-pgsql</span>) aggiungono funzionalità addizionali a Postfix, incluso l'accesso ai database di mappatura. Dovrebbero essere installati solo se si ritiene di averne bisogno.
			</div><div
              class="sidebar"><a
                xmlns=""
                id="sidebar.smtp"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>FONDAMENTALI</em></span> SMTP</strong></p></div></div></div><a
                id="id-1.14.4.7.3.2"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.3"
                class="indexterm"></a><a
                id="id-1.14.4.7.3.4"
                class="indexterm"></a><div
                class="para">
				SMTP (<span
                  class="emphasis"><em>Simple Mail Transfer Protocol</em></span>) è il protocollo utilizzato dai server di posta per scambiare ed instradare le email.
			</div></div><div
              class="para">
				Saranno posti diversi quesiti Defconf durante l'installazione del pacchetto. Le risposte consentono di generare una prima versione del file di configurazione <code
                class="filename">/etc/postfix/main.cf</code>.
			</div><div
              class="para">
				La prima domanda riguarda la tipologia di configurazione. Solo due delle risposte proposte sono rilevanti nel caso in cui il server sia connesso ad Internet: «Sito internet» e «Sito internet con smarthost». La prima opzione è appropriata per un server che riceve la posta in arrivo ed invia le email in uscita direttamente ai rispettivi destinatari: pertanto si adatta bene al caso della Falcot Corporation. La seconda opzione è appropriata per un server che riceve le email in arrivo normalmente ma che invia le email in uscita attraverso un server SMTP intermedio, lo «smarthost», anziché consegnarle direttamente al server del destinatario. Questo è particolarmente utile per chi ha con un indirizzo IP dinamico poiché molti server di posta rifiutano i messaggi che arrivano direttamente da questo tipo di indirizzo. In questo caso lo smarthost sarà generalmente il server SMTP dell'ISP che a sua volta è configurato per accettare ed inoltrare in modo appropriato le email provenienti dai clienti. Questo tipo di configurazione (con smarthost) è rilevante anche per i server che non sono costantemente connessi ad internet poiché evita di dover gestire una coda di messaggi non consegnabili da dover riprovare a inviare in seguito.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>VOCABOLARIO</em></span> ISP</strong></p></div></div></div><a
                id="id-1.14.4.7.6.2"
                class="indexterm"></a><div
                class="para">
				ISP è l'acronimo per «Internet Service Provider». Rappresenta un'entità, spesso un'azienda, che fornisce connessioni ad Internet ed i servizi base correlati (email, news e così via).
			</div><div
                class="para">
			</div></div><div
              class="para">
				La seconda domanda riguarda il nome completo della macchina, utilizzato per generare gli indirizzi email a partire dal nome utente locale. Il nome completo della macchina appare dopo la chiocciola («@»). Nel caso della Falcot, la risposta dovrebbe essere <code
                class="literal">mail.falcot.com</code>. Questa è l'unica domanda posta in via predefinita tuttavia la configurazione a cui porta non è sufficientemente completa per le necessità della Falcot: per questo motivo gli amministratori eseguono <code
                class="command">dpkg-reconfigure postfix</code> per poter personalizzare altri parametri.
			</div><div
              class="para">
				Una delle domande addizionali chiede tutti i nomi di dominio relativi alla macchina. La lista predefinita include il suo nome completo oltre ad alcuni sinonimi per <code
                class="literal">localhost</code>, ma il dominio principale <code
                class="literal">falcot.com</code> dev'essere aggiunto manualmente. Più generalmente, bisognerebbe rispondere a questa domanda con tutti i nomi di dominio per i quali la macchina agirà come server MX; in altre parole‍, tutti i nomi a dominio per cui il DNS dice che questa macchina accetterà email. Questa informazione finisce nella variabile <code
                class="literal">mydestination</code> del file di configurazione principale di Postfix, <code
                class="filename">/etc/postfix/main.cf</code>.
			</div><a
              id="id-1.14.4.7.9"
              class="indexterm"></a><a
              id="id-1.14.4.7.10"
              class="indexterm"></a><div
              class="figure"><a
                xmlns=""
                id="id-1.14.4.7.11"></a><div
                class="figure-contents"><div
                  class="mediaobject"><img
                    src="images/mail-server.png"
                    alt="Ruolo del record MX nel DNS durante l'invio di un'email" /></div></div><p
                class="title"><strong>Figura 11.1. Ruolo del record <span
                    class="emphasis"><em>MX</em></span> nel DNS durante l'invio di un'email</strong></p></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>EXTRA</em></span> Interrogare i record MX</strong></p></div></div></div><div
                class="para">
				Quando il DNS non ha un record MX per un dominio, il server di posta tenterà di inviare i messaggi allo stesso host utilizzando il record A corrispondente (o AAAA in IPv6).
			</div></div><div
              class="para">
				In alcuni casi l'installazione può anche chiedere quali reti devono essere autorizzate ad inviare email attraverso la macchina. Nella sua configurazione predefinita Postfix accetta unicamente email provenienti dalla macchina che lo ospita; la rete locale viene generalmente aggiunta. Gli amministratori della Falcot Corporation hanno aggiunto <code
                class="literal">192.168.0.0/16</code> alla risposta predefinita. Se la domanda non è posta, la relativa variabile nel file di configurazione è <code
                class="literal">mynetworks</code> come si vede nell'esempio qui sotto.
			</div><div
              class="para">
				Le email locali possono anche essere consegnate con <code
                class="command">procmail</code>. Questo strumento consente agli utenti di elaborare le loro email in arrivo attraverso le regole conservare nel file <code
                class="filename">~/.procmailrc</code>.
			</div><a
              id="id-1.14.4.7.15"
              class="indexterm"></a><a
              id="id-1.14.4.7.16"
              class="indexterm"></a><a
              id="id-1.14.4.7.17"
              class="indexterm"></a><div
              class="para">
				Dopo questa prima fase gli amministratori dispongono del file di configurazione seguente; sarà utilizzato come punto di partenza per aggiungere alcune funzionalità addizionali nelle prossime sezioni.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.7.19"></a><p
                class="title"><strong>Esempio 11.1. File <code
                    class="filename">/etc/postfix/main.cf</code> iniziale</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# See /usr/share/postfix/main.cf.dist for a commented, more complete version


# Debian specific:  Specifying a file name will cause the first
# line of that file to be used as the name.  The Debian default
# is /etc/mailname.
#myorigin = /etc/mailname

smtpd_banner = $myhostname ESMTP $mail_name (Debian/GNU)
biff = no

# appending .domain is the MUA's job.
append_dot_mydomain = no

# Uncomment the next line to generate "delayed mail" warnings
#delay_warning_time = 4h

readme_directory = no

# TLS parameters
smtpd_tls_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
smtpd_tls_key_file=/etc/ssl/private/ssl-cert-snakeoil.key
smtpd_use_tls=yes
smtpd_tls_session_cache_database = btree:${data_directory}/smtpd_scache
smtp_tls_session_cache_database = btree:${data_directory}/smtp_scache

# See /usr/share/doc/postfix/TLS_README.gz in the postfix-doc package for
# information on enabling SSL in the smtp client.

smtpd_relay_restrictions = permit_mynetworks permit_sasl_authenticated defer_unauth_destination
myhostname = mail.falcot.com
alias_maps = hash:/etc/aliases
alias_database = hash:/etc/aliases
myorigin = /etc/mailname
mydestination = mail.falcot.com, falcot.com, localhost.localdomain, localhost
relayhost = 
mynetworks = 127.0.0.0/8 [::ffff:127.0.0.0]/104 [::1]/128 192.168.0.0/16
mailbox_command = procmail -a "$EXTENSION"
mailbox_size_limit = 0
recipient_delimiter = +
inet_interfaces = all
inet_protocols = all</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>SICUREZZA</em></span> Certificati SSL <span
                          class="emphasis"><em>Snake oil</em></span></strong></p></div></div></div><div
                class="para">
				I certificati <span
                  class="emphasis"><em>snake oil</em></span>, come le "medicine" <span
                  class="emphasis"><em>snake oil</em></span> vendute da antichi ciarlatani, non hanno alcun valore: non si può fare affidamento su di loro per autenticare il server poiché sono generati automaticamente da certificati auto-firmati. Tuttavia sono utili per migliorare la privacy degli scambi.
			</div><div
                class="para">
				In generale possono essere utilizzati solo a scopo di test, ed i normali servizi devono utilizzare unicamente certificati reali; essi possono essere generati con la procedura descritta in <a
                  class="xref"
                  href="sect.virtual-private-network.html#sect.easy-rsa">Sezione 10.2.1.1, «Infrastruttura a chiave pubblica: <span
                    class="emphasis"><em>easy-rsa</em></span>»</a>.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.configuring-virtual-domains"></a>11.1.2. Configurare i domini virtuali</h3></div></div></div><a
              id="id-1.14.4.8.2"
              class="indexterm"></a><a
              id="id-1.14.4.8.3"
              class="indexterm"></a><div
              class="para">
				Il server di posta può ricevere anche email indirizzate ad altri domini oltre a quello principale: questi domini sono indicati come «domini virtuali». In molti casi, dove questo avviene, le email non sono destinate ad utenti locali. Postfix fornisce due funzionalità interessanti per gestire i domini virtuali.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ATTENZIONE</em></span> Domini virtuali e domini canonici</strong></p></div></div></div><div
                class="para">
				Nessuno dei domini virtuali dev'essere riportato nella variabile <code
                  class="literal">mydestination</code>. Questa variabile contiene unicamente i nomi dei domini «canonici» direttamente associati alla macchina ed ai suoi utenti locali.
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.8.6"></a>11.1.2.1. Domini virtuali alias</h4></div></div></div><a
                id="id-1.14.4.8.6.2"
                class="indexterm"></a><a
                id="id-1.14.4.8.6.3"
                class="indexterm"></a><div
                class="para">
					Un dominio virtuale alias contiene solo indirizzi alias, cioè indirizzi che si occupano di inoltrare le email ad altri indirizzi.
				</div><div
                class="para">
					Questo tipo di dominio sarà abilitato aggiungendo il suo nome alla variabile <code
                  class="literal">virtual_alias_domains</code> ed indicando un file di mappatura indirizzi nella variabile <code
                  class="literal">virtual_alias_maps</code>.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.6.6"></a><p
                  class="title"><strong>Esempio 11.2. Direttive da aggiungere nel file <code
                      class="filename">/etc/postfix/main.cf</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_alias_domains = falcotsbrand.com
virtual_alias_maps = hash:/etc/postfix/virtual</pre></div></div><div
                class="para">
					Il file <code
                  class="filename">/etc/postfix/virtual</code> descrive le mappature con una sintassi piuttosto lineare: ogni riga contiene due campi separati da uno spazio; il primo campo è il nome dell'alias, il secondo campo è una lista di indirizzi email a cui reindirizza. La sintassi speciale <code
                  class="literal">@domain.com</code> copre tutti i restanti alias di un dominio.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.6.8"></a><p
                  class="title"><strong>Esempio 11.3. File <code
                      class="filename">/etc/postfix/virtual</code> di esempio</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
webmaster@falcotsbrand.com  jean@falcot.com
contact@falcotsbrand.com    laure@falcot.com, sophie@falcot.com
# L'alias qui sotto è generico e copre tutti gli indirizzi all'interno 
# del dominio flacotsbrand.com che non sono altrimenti coperti in questo file.
# Questi indirizzi inoltrano le email allo stesso utente nel
# dominio falcot.com.
@falcotsbrand.com           @falcot.com</pre></div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.8.7"></a>11.1.2.2. Caselle di posta su domini virtuali</h4></div></div></div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>ATTENZIONE</em></span> Domini virtuali combinati?</strong></p></div></div></div><div
                  class="para">
					Postfix non consente di utilizzare contemporaneamente lo stesso dominio in <code
                    class="literal">virtual_alias_domains</code> e <code
                    class="literal">virtual_mailbox_domains</code>. Comunque ogni dominio di <code
                    class="literal">virtual_mailbox_domains</code> viene implicitamente incluso in <code
                    class="literal">virtual_alias_domains</code>, cosa che permette di mescolare caselle ed alias all'interno di un dominio virtuale.
				</div></div><a
                id="id-1.14.4.8.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.8.7.4"
                class="indexterm"></a><div
                class="para">
					I messaggi indirizzati ad una casella su di un dominio virtuale sono conservati in caselle di posta non assegnate ad un utente locale del sistema.
				</div><div
                class="para">
					Abilitare una casella di posta in un dominio virtuale richiede di inserire il dominio nella variabile <code
                  class="literal">virtual_mailbox_domains</code> fornendo un file di mappatura caselle in <code
                  class="literal">virtual_mailbox_maps</code>. Il parametro <code
                  class="literal">virtual_mailbox_base</code> contiene la directory dove le caselle di posta saranno conservate.
				</div><div
                class="para">
					I parametri <code
                  class="literal">virtual_uid_maps</code> e <code
                  class="literal">virtual_gid_maps</code> forniscono le mappature tra un indirizzo email e l'utente di sistema (o gruppo rispettivamente) che "possiede" la casella di posta corrispondente. Per assegnare tutte le caselle di posta allo stesso proprietario/gruppo la sintassi è <code
                  class="literal">static:5000</code>.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.7.8"></a><p
                  class="title"><strong>Esempio 11.4. Direttive da aggiungere nel file <code
                      class="filename">/etc/postfix/main.cf</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
virtual_mailbox_domains = falcot.org
virtual_mailbox_maps = hash:/etc/postfix/vmailbox
virtual_mailbox_base = /var/mail/vhosts</pre></div></div><div
                class="para">
					Ancora una volta, la sintassi del file <code
                  class="filename">/etc/postfix/vmailbox</code> è piuttosto lineare: due campi separati da uno spazio. Il primo campo è un indirizzo email all'interno di uno dei domini virtuali e il secondo campo è la posizione della casella di posta associata (relativamente alla directory specificata in <span
                  class="emphasis"><em>virtual_mailbox_base</em></span>). Se il nome della casella di posta termina con una barra (<code
                  class="literal">/</code>) le email saranno conservate nel formato <span
                  class="emphasis"><em>maildir</em></span>, diversamente sarà utilizzato il formato tradizionale <span
                  class="emphasis"><em>mbox</em></span>. Il formato di <span
                  class="emphasis"><em>maildir</em></span> utilizza l'intera directory per conservare una casella di posta: ogni messaggio sarà conservato in un file separato. Diversamente, nel formato <span
                  class="emphasis"><em>mbox</em></span>, l'intera casella di posta elettronica è conservata in un file ed ogni riga che comincia con «<code
                  class="literal">From </code>» (<code
                  class="literal">From</code> seguito da uno spazio) segnala l'inizio di un nuovo messaggio.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.8.7.10"></a><p
                  class="title"><strong>Esempio 11.5. Il file <code
                      class="filename">/etc/postfix/vmailbox</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
# La posta di Jean è conservata come maildir, con
# un file per email in una directory dedicata
jean@falcot.org falcot.org/jean/
# La posta di Sophie è conservata in un tradizionale file «mbox»,
# dove tutte le email sono concatenate in un unico file
sophie@falcot.org falcot.org/sophie</pre></div></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.restrictions-for-receiving-and-sending"></a>11.1.3. Restrizioni per ricezione ed invio</h3></div></div></div><div
              class="para">
				Il crescente numero di email massive non richieste (<span
                class="emphasis"><em>spam</em></span>) richiede di essere sempre più rigorosi quando si stabilisce quali email devono essere accettate da un server. Questa sezione presenta alcune tra le strategie incluse in Postfix.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>CULTURA</em></span> Il problema dello spam</strong></p></div></div></div><a
                id="id-1.14.4.9.3.2"
                class="indexterm"></a><div
                class="para">
				«Spam» è un termine generico utilizzato per indicare tutte le email commerciali non richieste che inondano le nostre caselle di posta elettronica. Gli individui senza scrupoli che le inviano sono definiti «spammer». Costoro si preoccupano poco del disturbo che causano perché inviare email costa poco e basta che una piccola percentuale di destinatari sia attratta dalle loro offerte perché l'operazione di spam produca più denaro di quanto sia costata. Il processo è quasi completamente automatizzato e qualsiasi indirizzo email reso pubblico (per esempio in un forum, negli archivi di una mail list, in un blog, ecc.) sarà individuato dai robot degli spammer e sottoposto ad un flusso senza fine di messaggi non richiesti.
			</div><div
                class="para">
				Tutti gli amministratori di sistema tentano di affrontare questo disturbo con i filtri anti-spam, ma naturalmente gli spammer continuano a lavorare per aggirare questi filtri. Alcuni di loro prendono persino in affitto da varie organizzazioni criminali reti di macchine compromesse da worm. Recenti statistiche stimano che fino al 95% delle email in circolazione su Internet sono spam!
			</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.4"></a>11.1.3.1. Restrizioni d'accesso basate su IP</h4></div></div></div><div
                class="para">
					La direttiva <code
                  class="literal">smtpd_client_restrictions</code> controlla quali macchine sono autorizzate a comunicare con il server di posta.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.4.3"></a><p
                  class="title"><strong>Esempio 11.6. Restrizioni basate sull'indirizzo del client</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_client_restrictions = permit_mynetworks,
    warn_if_reject reject_unknown_client,
    check_client_access hash:/etc/postfix/access_clientip,
    reject_rbl_client sbl-xbl.spamhaus.org,
    reject_rbl_client list.dsbl.org</pre></div></div><div
                class="para">
					Quando una variabile contiene una lista di regole, come nell'esempio qui sopra, queste regole sono valutate in ordine, dalla prima all'ultima. Ogni regola può accettare il messaggio, rifiutarlo o lasciare la decisione ad una regola seguente. Come conseguenza l'ordine è importante ed invertire due regole può causare un comportamento ampiamente differente.
				</div><div
                class="para">
					La direttiva <code
                  class="literal">permit_mynetworks</code> usata come prima regola accetta tutte le email provenienti da una macchina nella rete locale (così come definita nella variabile di configurazione <span
                  class="emphasis"><em>mynetworks</em></span>).
				</div><div
                class="para">
					La seconda direttiva rifiuta normalmente le email provenienti da macchine che non dispongono di una configurazione DNS completamente valida. Una configurazione è valida quando l'indirizzo IP può essere risolto con un nome e questo nome a sua volta può essere risolto all'indirizzo IP. Questa restrizione è spesso troppo rigorosa poiché molti server di posta non dispongono di un DNS inverso per il loro indirizzo IP. questo spiega perché gli amministratori della Falcot hanno inserito il modificatore <code
                  class="literal">warn_if_reject</code> prima della direttiva <code
                  class="literal">reject_unknown_client</code>: questo modificatore trasforma il rifiuto in un semplice avviso registrato nei log. Gli amministratori possono poi controllare il numero di messaggi che sarebbero rifiutati se la regola fosse applicata e prendere successivamente una decisione informata riguardo l'opportunità di abilitare questa restrizione.
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>SUGGERIMENTO</em></span> Tabelle di <span
                            class="emphasis"><em>accesso</em></span></strong></p></div></div></div><div
                  class="para">
					I criteri di restrizione includono tabelle modificabili dall'amministratore che elencano combinazioni di mittenti, indirizzi IP e nomi host autorizzati oppure vietati. Queste tabelle possono essere create da una copia decompressa del file <code
                    class="filename">/usr/share/doc/postfix-doc/examples/access.gz</code>. Questo modello è documentato dai propri commenti, ovvero ogni tabella descrive la propria sintassi.
				</div><div
                  class="para">
					La tabella <code
                    class="filename">/etc/postfix/access_clientip</code> elenca gli indirizzi IP e le reti; <code
                    class="filename">/etc/postfix/access_helo</code> elenca i nomi di dominio; <code
                    class="filename">/etc/postfix/access_sender</code> contiene gli indirizzi email dei mittenti. Tutti questi file necessitano di essere trasformati in tabelle-hash (un formato ottimizzato per l'accesso veloce) dopo ogni modifica, con il comando <code
                    class="command">postmap /etc/postfix/<em
                      class="replaceable">file</em></code>.
				</div></div><div
                class="para">
					La terza direttiva consente all'amministratore di preparare una blacklist ed una whitelist di server di posta, conservate nel file <code
                  class="filename">/etc/postfix/access_clientip</code>. I server nella whitelist sono considerati affidabili, e le email che provengono da loro non passano attraverso le successive regole di filtraggio.
				</div><div
                class="para">
					Le ultime due regole rifiutano ogni messaggio che proviene da un server elencato in una delle blacklist indicate. RBL è l'acronimo di <span
                  class="emphasis"><em>Remote Black List</em></span>; ci sono diverse di queste liste,ma tutte elencano i server mal configurati che gli spammer utilizzano per inoltrare le loro email, così come le macchine infette da virus o worm che inoltrano email in modo assolutamente non previsto.
				</div><a
                id="id-1.14.4.9.4.10"
                class="indexterm"></a><a
                id="id-1.14.4.9.4.11"
                class="indexterm"></a><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>SUGGERIMENTO</em></span> Whitelist e liste RBL</strong></p></div></div></div><div
                  class="para">
					Le blacklist includono alle volte server legittimi che sono stati vittime di problemi. In queste situazioni, tutte le email che provengono da questi server saranno respinte a meno che il server non sia incluso in una whitelist definita da <code
                    class="filename">/etc/postfix/access_clientip</code>.
				</div><div
                  class="para">
					La prudenza raccomanda di includere nella whitelist tutti i server da cui si ricevono generalmente molte email e che sono considerati affidabili.
				</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.5"></a>11.1.3.2. Controllare la validità dei comandi <code
                        class="literal">EHLO</code> o <code
                        class="literal">HELO</code></h4></div></div></div><div
                class="para">
					Ogni scambio SMTP inizia con un comando <code
                  class="literal">HELO</code> (o <code
                  class="literal">EHLO</code>) seguito dal nome del server di posta mittente; controllare la validità di questo nome può risultare utile.
				</div><a
                id="id-1.14.4.9.5.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.5.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.5.5"></a><p
                  class="title"><strong>Esempio 11.7. Restrizioni sul nome annunciato in <code
                      class="literal">EHLO</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_helo_restrictions = permit_mynetworks,
    reject_invalid_hostname,
    check_helo_access hash:/etc/postfix/access_helo,
    reject_non_fqdn_hostname,
    warn_if_reject reject_unknown_hostname</pre></div></div><div
                class="para">
					La prima direttiva <code
                  class="literal">permit_mynetworks</code> consente a tutte le macchine nella rete locale di presentarsi liberamente. Questo è importante poiché molti programmi di posta non rispettano in modo adeguato questa parte del protocollo SMTP e possono presentarsi con nomi senza senso.
				</div><div
                class="para">
					La regola <code
                  class="literal">reject_invalid_hostname</code> rifiuta le email quando la presentazione <code
                  class="literal">EHLO</code> annuncia un nome host sintatticamente scorretto. La regola <code
                  class="literal">reject_non_fqdn_hostname</code> rifiuta i messaggi quando il nome host presentato non è un nome di dominio completamente qualificato (ovvero include un nome di dominio oltre al nome host). La regola <code
                  class="literal">reject_unknown_hostname</code> rifiuta i messaggi se il nome presentato non esiste nel DNS. Poiché quest'ultima regola sfortunatamente porta a troppi rifiuti gli amministratori hanno modificato i suoi effetti ad un semplice avviso con il modificatore <code
                  class="literal">warn_if_reject</code> come visto inizialmente; possono anche decidere di rimuovere questo modificatore in una fase successiva dopo aver monitorato gli effetti di questa regola.
				</div><div
                class="para">
					Utilizzare <code
                  class="literal">permit_mynetworks</code> come prima regola ha un interessante effetto collaterale: le regole seguenti si applicano unicamente agli host fuori dalla rete locale. Questo consente di inserire in blacklist tutti gli host che si presentano come parte di <code
                  class="literal">falcot.com</code>, per esempio aggiungendo la riga <code
                  class="literal">falcot.com REJECT You are not in our network!</code> al file <code
                  class="filename">/etc/postfix/access_helo</code>.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.6"></a>11.1.3.3. Accettare o rifiutare in base al mittente annunciato</h4></div></div></div><div
                class="para">
					Ogni messaggio ha un mittente annunciato dal comando <code
                  class="literal">MAIL FROM</code> del protocollo SMTP. Ancora una volta questa informazione può essere verificata in diversi modi.
				</div><a
                id="id-1.14.4.9.6.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.6.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.6.5"></a><p
                  class="title"><strong>Esempio 11.8. Controlli sul mittente</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_sender_restrictions = 
    check_sender_access hash:/etc/postfix/access_sender,
    reject_unknown_sender_domain, reject_unlisted_sender,
    reject_non_fqdn_sender</pre></div></div><div
                class="para">
					La tabella <code
                  class="filename">/etc/postfix/access_sender</code> mappa alcuni trattamenti speciali riservati ad alcuni mittenti. Generalmente questo significa elencare alcuni mittenti in una whitelist oppure in una blacklist.
				</div><div
                class="para">
					La regola <code
                  class="literal">reject_unknown_sender_domain</code> richiede un dominio valido per il mittente poiché è necessario per un indirizzo valido. La regola <code
                  class="literal">reject_unlisted_sender</code> rifiuta i mittenti locali se l'indirizzo non esiste: questo impedisce alle email di essere inviate da un indirizzo non valido nel dominio <code
                  class="literal">falcot.com</code> ed i messaggi originati da <code
                  class="literal">joe.bloggs@falcot.com</code> sono accettati esclusivamente se questo indirizzo esiste realmente.
				</div><div
                class="para">
					Per concludere, la regola <code
                  class="literal">reject_non_fqdn_sender</code> rifiuta le email che si presume provengano da un indirizzo senza un nome di dominio pienamente qualificato. In pratica questo significa rifiutare email provenienti da <code
                  class="literal">utente@macchina</code>: l'indirizzo dev'essere annunciato come <code
                  class="literal">utente@macchina.example.com</code> o <code
                  class="literal">utente@example.com</code>.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.7"></a>11.1.3.4. Accettare o rifiutare in base al destinatario</h4></div></div></div><div
                class="para">
					Ogni email ha almeno un destinatario, annunciato con il comando <code
                  class="literal">RCPT TO</code> del protocollo SMTP. Anche questi indirizzi concorrono alla validazione del messaggio, tuttavia sono meno rilevanti rispetto ai controlli effettuati sull'indirizzo del mittente.
				</div><a
                id="id-1.14.4.9.7.3"
                class="indexterm"></a><a
                id="id-1.14.4.9.7.4"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.7.5"></a><p
                  class="title"><strong>Esempio 11.9. Controlli sul destinatario</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks, 
    reject_unauth_destination, reject_unlisted_recipient, 
    reject_non_fqdn_recipient</pre></div></div><div
                class="para">
					<code
                  class="literal">reject_unauth_destination</code> è la regola base che richiede ai messaggi provenienti dall'esterno di essere indirizzati ai noi: messaggi inviati ad indirizzi non gestiti da questo server saranno rifiutati. Senza questa regola un server diviene un open relay che permette agli spammer di inviare posta non richiesta; questa regola è quindi caldamente raccomandata, e dovrebbe essere posizionata preferibilmente vicino all'inizio della lista, per evitare che altre regole possano autorizzare l'inoltro del messaggio prima che la sua destinazione sia stata controllata.
				</div><div
                class="para">
					La regola <code
                  class="literal">reject_unlisted_recipient</code> rifiuta ragionevolmente i messaggi inviati a utenti locali che non esistono. Infine <code
                  class="literal">reject_non_fqdn_recipient</code> rifiuta gli indirizzi non completamente qualificati: questo rende impossibile l'invio di email a <code
                  class="literal">jean</code> o <code
                  class="literal">jean@macchina</code> e richiede invece l'uso dell'indirizzo completo come <code
                  class="literal">jean@macchina.falcot.com</code> o <code
                  class="literal">jean@falcot.com</code>.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.8"></a>11.1.3.5. Restrizioni associate con il comando <code
                        class="literal">DATA</code></h4></div></div></div><div
                class="para">
					Il comando <code
                  class="literal">DATA</code> di SMTP è emesso prima dei contenuti del messaggio. Non fornisce alcuna informazione di per sé, a parte l'annunciare quello che viene immediatamente dopo. Tuttavia può a sua volta essere soggetto a controlli.
				</div><a
                id="id-1.14.4.9.8.3"
                class="indexterm"></a><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.8.4"></a><p
                  class="title"><strong>Esempio 11.10. Controlli su <code
                      class="literal">DATA</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
smtpd_data_restrictions = reject_unauth_pipelining</pre></div></div><div
                class="para">
					La direttiva <code
                  class="literal">reject_unauth_pipelining</code> fa sì che il messaggio sia rifiutato se il mittente invia un comando prima che sia inviata una risposta al comando inviato in precedenza. Questo protegge da una ottimizzazione comunemente utilizzata dagli spammer automatizzati poiché a loro non importa un fico secco delle risposte e si concentrano unicamente nell'invio del maggior numero di email nel minor tempo possibile.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.9"></a>11.1.3.6. Applicare restrizioni</h4></div></div></div><div
                class="para">
					Nonostante i comandi precedenti verificano informazioni a diversi livelli dello scambio SMTP, Postfix invia l'effettivo rifiuto unicamente a seguito del comando <code
                  class="literal">RCPT TO</code>.
				</div><div
                class="para">
					Questo significa che anche se il messaggio viene rifiutato a causa di un comando <code
                  class="literal">EHLO</code> non valido, Postfix conosce il mittente ed il destinatario quando annuncia il rifiuto e pertanto potrà poi inserire nel log un messaggio più esplicito di quanto avesse potuto fare nel caso la transazione si fosse interrotta all'inizio. Inoltre un certo numero di client SMTP non si attende problemi durante i primi comandi SMTP e questi client saranno meno disturbati da questo rifiuto posticipato.
				</div><div
                class="para">
					Il vantaggio finale di questa scelta è di permettere alle regole di accumulare informazioni durante i vari passaggi dello scambio di SMTP; questo consente di definire permessi più dettagliati, come rifiutare una connessione non locale se si annuncia con un mittente locale.
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h4
                      class="title"><a
                        xmlns=""
                        id="id-1.14.4.9.10"></a>11.1.3.7. Filtrare in base al contenuto del messaggio</h4></div></div></div><div
                class="para">
					La validazione ed il sistema di restrizioni non sarebbero completi senza un modo per applicare controlli al contenuto dei messaggi. Postfix distingue tra i controlli applicati all'intestazione e quelli applicati al corpo del messaggio.
				</div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.10.3"></a><p
                  class="title"><strong>Esempio 11.11. Abilitare filtri basati sul contenuto</strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
header_checks = regexp:/etc/postfix/header_checks
body_checks = regexp:/etc/postfix/body_checks</pre></div></div><a
                id="id-1.14.4.9.10.4"
                class="indexterm"></a><div
                class="para">
					Entrambi i file contengono una lista di espressioni regolari (spesso chiamate <span
                  class="emphasis"><em>regexp</em></span> o <span
                  class="emphasis"><em>regex</em></span>) e relative azioni da intraprendere quando l'intestazione (o il corpo) delle email corrisponde con l'espressione.
				</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>APPROFONDIMENTO</em></span> Tabelle regexp</strong></p></div></div></div><div
                  class="para">
					Il file <code
                    class="filename">/usr/share/doc/postfix-doc/examples/header_checks.gz</code> contiene molti commenti esplicativi che possono essere utilizzati come punto di partenza per creare i file <code
                    class="filename">/etc/postfix/header_checks</code> ed <code
                    class="filename">/etc/postfix/body_checks</code>.
				</div></div><div
                class="example"><a
                  xmlns=""
                  id="id-1.14.4.9.10.7"></a><p
                  class="title"><strong>Esempio 11.12. File d'esempio <code
                      class="filename">/etc/postfix/header_checks</code></strong></p><div
                  class="example-contents"><pre
                    class="programlisting">
/^X-Mailer: GOTO Sarbacane/ REJECT Io combatto lo spam (GOTO Sarbacane)
/^Subject: *La tua email contiene dei VIRUS/ DISCARD notifica di virus</pre></div></div><div
                class="sidebar"><a
                  xmlns=""
                  id="sidebar.regexp"></a><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>FONDAMENTALI</em></span> Espressioni regolari</strong></p></div></div></div><div
                  class="para">
					Il termine <span
                    class="emphasis"><em>espressione regolare</em></span> (spesso abbreviato in lingua inglese con <span
                    class="emphasis"><em>regexp</em></span> o <span
                    class="emphasis"><em>regex</em></span>) fa riferimento ad una notazione generica per esprimere la descrizione dei contenuti oppure la struttura di una stringa di caratteri. Certi caratteri speciali permettono di definire: alternative (per esempio <code
                    class="literal">pippo|pluto</code> corrisponde sia con «pippo» che con «pluto»); insiemi di caratteri (per esempio <code
                    class="literal">[0-9]</code> significa qualsiasi numero e <code
                    class="literal">.</code> — un punto — significa qualsiasi carattere); quantità (<code
                    class="literal">s?</code> è compatibile con <code
                    class="literal">s</code> o con una stringa vuota ovvero con zero o una occorrenza di <code
                    class="literal">s</code>, <code
                    class="literal">s+</code> è compatibile con una o più occorrenze consecutive del carattere <code
                    class="literal">s</code>, e così via). Le parentesi permettono di raggruppare i risultati della ricerca.
				</div><div
                  class="para">
					La precisa sintassi di queste espressioni varia tra i vari strumenti che le utilizzano ma le funzionalità base sono similari. <div
                    xmlns=""
                    class="url">→ <a
                      xmlns="http://www.w3.org/1999/xhtml"
                      href="http://it.wikipedia.org/wiki/Espressione_regolare">http://it.wikipedia.org/wiki/Espressione_regolare</a></div>
				</div></div><div
                class="para">
					La prima controlla l'intestazione che fa riferimento al software email; se viene individuato <code
                  class="literal">GOTO Sarbacane</code> (un software per l'invio massivo di email) il messaggio viene rifiutato. La seconda espressione controlla l'oggetto del messaggio: se indica la notifica di un virus possiamo decidere di non respingere il messaggio ma di limitarci a scartarlo immediatamente.
				</div><div
                class="para">
					Utilizzare questi filtri è un'arma a doppio taglio poiché è facile produrre regole troppo generiche e perdere di conseguenza email legittime. In questi casi i messaggi vanno perduti ed inoltre i rispettivi mittenti ricevono messaggi d'errore non desiderati (e fastidiosi).
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.setting-up-greylisting"></a>11.1.4. Impostare il <span
                      class="foreignphrase"><em
                        class="foreignphrase">greylisting</em></span></h3></div></div></div><a
              id="id-1.14.4.10.2"
              class="indexterm"></a><div
              class="para">
				Il "greylisting" è una tecnica di filtraggio per cui un messaggio viene inizialmente rifiutato con un messaggio d'errore temporaneo e viene accettato solo dopo un successivo tentativo trascorso un certo intervallo di tempo. Questo filtraggio è particolarmente efficiente contro lo spam inviato dalle tante macchine infette da virus e worm poiché questi software si comportano raramente come veri e propri agenti SMTP (i quali controllano i codici d'errore e ritentano l'invio dei messaggi successivamente), soprattutto perché molti degli indirizzi raccolti sono davvero validi e riprovare significherebbe soltanto perdere tempo.
			</div><div
              class="para">
				Postfix non fornisce il greylisting nativamente ma esiste una funzionalità che permette di delegare la decisione riguardo il rifiuto o l'accettazione di un messaggio ad un programma esterno. Il pacchetto <span
                class="pkg pkg">postgrey</span> contiene proprio un programma di questo tipo, progettato per interfacciarsi con questo servizio per la delega delle politiche di accesso.
			</div><div
              class="para">
				Una volta installato, <span
                class="pkg pkg">postgrey</span> si attiva come demone e si pone in ascolto sulla porta 10023. Postfix può quindi essere configurato per utilizzarlo, aggiungendo il parametro <code
                class="literal">check_policy_service</code> come restrizione aggiuntiva:
			</div><pre
              class="programlisting">
smtpd_recipient_restrictions = permit_mynetworks,
    [...]
    check_policy_service inet:127.0.0.1:10023</pre><div
              class="para">
				Ogni volta che Postfix raggiunge questa regola si connette al demone <code
                class="command">postgrey</code> e gli invia informazioni a proposito del messaggio in questione. Postgrey prende quindi in considerazione i tre parametri IP/mittente/destinatario e controlla il suo database per verificare se sono già apparsi recentemente. Se è così Postgrey risponde autorizzando il messaggio, altrimenti risponde indicando che il messaggio dev'essere temporaneamente respinto ed i tre parametri vengono inseriti nel database.
			</div><div
              class="para">
				Il principale svantaggio del greylisting è dato dal ritardo causato ai messaggi legittimi, cosa che non è sempre accettabile. Inoltre incrementa il carico sui server che inviano molte email legittime.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>IN PRATICA</em></span> Aspetti negativi del greylisting</strong></p></div></div></div><div
                class="para">
				Teoricamente il greylisting dovrebbe unicamente ritardare la ricezione della prima email da un dato mittente ad un dato destinatario e tipicamente questo ritardo si misura nell'ordine dei minuti. La realtà, purtroppo, può essere leggermente diversa. Alcuni grandi provider utilizzano cluster di server SMTP e quando un messaggio viene inizialmente rifiutato il server che riprova la trasmissione potrebbe non essere lo stesso. Quando ciò accade il secondo server ottiene un ulteriore messaggio d'errore temporaneo dovuto al greylisting e così via: in questi casi possono passare anche diverse ore prima che la trasmissione sia rieseguita da un server già coinvolto poiché normalmente i server SMTP incrementano gli intervalli tra un tentativo e l'altro dopo ogni fallimento.
			</div><div
                class="para">
				Di conseguenza l'indirizzo IP di provenienza può variare nel tempo anche per un singolo mittente. Inoltre anche l'indirizzo email del mittente può cambiare. Per esempio molti server di mailing-list possono includere informazioni extra nell'indirizzo email del mittente per essere in grado di gestire i messaggi d'errore (spesso indicati anche con il termine <span
                  class="emphasis"><em>bounce</em></span>). Ad ogni nuovo messaggio inviato ad una mailing-list potrebbe essere richiesto di attraversare il greylisting cosa che richiede di essere conservato (temporaneamente) nel server del mittente. Questo può diventare presto un problema per le mailing-list molto frequentate (con decine di migliaia di iscritti).
			</div><div
                class="para">
				Per mitigare questi effetti negativi, Postgrey gestisce una whitelist di siti, ed i messaggi da loro originati vengono immediatamente accettati senza passare attraverso il greylisting. Questa lista può essere facilmente adattata in base alle necessità locali, visto che è conservata nel file <code
                  class="filename">/etc/postgrey/whitelist_clients</code>.
			</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>APPROFONDIMENTO</em></span> Greylisting selettivo con <span
                          class="pkg pkg">milter-greylist</span></strong></p></div></div></div><div
                class="para">
				Gli effetti negativi del greylisting possono essere mitigati applicando il greylisting unicamente ad un sottoinsieme di client che sono già considerati come probabile sorgente di spam (poiché sono inseriti in una blacklist DNS). Questo non è possibile con <span
                  class="pkg pkg">postgrey</span> ma <span
                  class="pkg pkg">milter-greylist</span> può essere usato in questo modo.
			</div><div
                class="para">
				In tal scenario, poichè che le blacklist DNS non innescano mai un rifiuto definitivo, diventa ragionevole l'uso di blacklist aggressive, comprese quelle che includono tutti gli indirizzi IP dinamici assegnati dai Provider ai loro clienti (come <code
                  class="literal">pbl.spamhaus.org</code> o <code
                  class="literal">dul.dnsbl.sorbs.net</code>).
			</div><div
                class="para">
				Poichè milter-greylist usa l'intrefaccia milter di Sendmail , il lato postix della sua configurazione è limitato a “<code
                  class="literal">smtpd_milters = unix:/var/run/milter-greylist/milter-greylist.sock</code>”. La pagina del manuale <span
                  class="citerefentry"><span
                    class="refentrytitle">greylist.conf</span>(5)</span> documenta <code
                  class="filename">/etc/milter-greylist/greylist.conf</code> ed i numerosi modi di configurare milter-greylist. Inoltre sarà necessario modificare il file <code
                  class="filename">/etc/default/milter-greylist</code> per consentire effettivamente il servizio.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="id-1.14.4.11"></a>11.1.5. Personalizzare i filtri in base al destinatario</h3></div></div></div><div
              class="para">
				La <a
                class="xref"
                href="network-services.html#sect.restrictions-for-receiving-and-sending">Sezione 11.1.3, «Restrizioni per ricezione ed invio»</a> e la <a
                class="xref"
                href="network-services.html#sect.setting-up-greylisting">Sezione 11.1.4, «Impostare il <span
                  class="foreignphrase"><em
                    class="foreignphrase">greylisting</em></span>»</a> riportano molte delle possibili limitazioni. Tutte hanno un loro metodo per diminuire la quantità di spam ricevuto ma tutte hanno effetti collaterali. Quindi è sempre più comune personalizzare l'insieme di filtri in base al destinatario. Alla Falcot Corporation il greylisting è utile per la maggior parte degli utenti, ma ostacola l'attività di alcuni utenti che necessitano di una bassa latenza per le proprie email (come il servizio di supporto tecnico). Allo stesso modo il servizio di supporto commerciale incontra a volte delle difficoltà nella ricezione di email da alcuni provider asiatici che sono inseriti nelle blacklist: il servizio di supporto commerciale ha quindi richiesto un indirizzo email non filtrato per poter comunicare.
			</div><div
              class="para">
				Postfix fornisce la personalizzazione sui filtri tramite il concetto di «restrizione di classe». Le classi sono dichiarate nel parametro <code
                class="literal">smtpd_restriction_classes</code> e sono definite come in <code
                class="literal">smtpd_recipient_restrictions</code>. La direttiva <code
                class="literal">check_recipient_access</code> definisce quindi una tabella che associa un destinatario ad un insieme appropriato di restrizioni.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.11.4"></a><p
                class="title"><strong>Esempio 11.13. Definire classi di restrizione in <code
                    class="filename">main.cf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">smtpd_restriction_classes = greylisting, aggressive, permissive

greylisting = check_policy_service inet:127.0.0.1:10023
aggressive = reject_rbl_client sbl-xbl.spamhaus.org,
        check_policy_service inet:127.0.0.1:10023
permissive = permit

smtpd_recipient_restrictions = permit_mynetworks,
        reject_unauth_destination,
        check_recipient_access hash:/etc/postfix/recipient_access</pre></div></div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.11.5"></a><p
                class="title"><strong>Esempio 11.14. Il file <code
                    class="filename">/etc/postfix/recipient_access</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Indirizzi non filtrati
postmaster@falcot.com  permissiva
support@falcot.com     permissiva
sales-asia@falcot.com  permissiva

# Filtraggio aggressivo per alcuni utenti privilegiati
joe@falcot.com         aggressiva

# Una regola speciale per il manager della mailing-list
sympa@falcot.com       reject_unverified_sender

# Greylisting predefinito
falcot.com             greylisting</pre></div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.postfix-antivirus"></a>11.1.6. Integrare un antivirus</h3></div></div></div><a
              id="id-1.14.4.12.2"
              class="indexterm"></a><div
              class="para">
				I molti virus che circolano come allegato email rendono importante impostare un antivirus al punto d'ingresso nella rete aziendale dal momento che, nonostante una costante campagna di sensibilizzazione, molti utenti continuano ad aprire anche i file allegati a messaggi palesemente loschi.
			</div><div
              class="para">
				Gli amministratori della Falcot hanno scelto <code
                class="command">clamav</code> come loro antivirus libero. Il pacchetto principale è <span
                class="pkg pkg">clamav</span> ma hanno installato alcuni altri pacchetti aggiuntivi come <span
                class="pkg pkg">arj</span>, <span
                class="pkg pkg">unzoo</span>, <span
                class="pkg pkg">unrar</span> e <span
                class="pkg pkg">lha</span>, poiché sono richiesti dall'antivirus per analizzare gli allegati archiviati in uno di questi formati.
			</div><a
              id="id-1.14.4.12.5"
              class="indexterm"></a><a
              id="id-1.14.4.12.6"
              class="indexterm"></a><div
              class="para">
				Il compito di interfacciare l'antivirus ed il server di posta è affidato a <code
                class="command">clamav-milter</code>. Un <span
                class="emphasis"><em>milter</em></span> (abbreviazione dell'inglese <span
                class="emphasis"><em>mail filter</em></span>) è un programma di filtraggio realizzato appositamente per interfacciarsi con i server di posta. Un milter utilizza un'interfaccia di programmazione standard (API) che fornisce prestazioni nettamente migliori rispetto ai filtri esterni ai server di posta. I milter sono stati introdotti inizialmente da <span
                class="emphasis"><em>Sendmail</em></span> e <span
                class="emphasis"><em>Postfix</em></span> ha presto seguito l'esempio.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>APPROFONDIMENTO</em></span> Un milter per Spamassassin</strong></p></div></div></div><a
                id="id-1.14.4.12.8.2"
                class="indexterm"></a><div
                class="para">
				Il pacchetto <span
                  class="pkg pkg">spamass-milter</span> fornisce un milter basato su <span
                  class="emphasis"><em>SpamAssassin</em></span>, il famoso rilevatore di email non richieste. Può essere impiegato per etichettare i messaggi come probabile spam, aggiungendo un header addizionale, o per rifiutare del tutto i messaggi se il loro punteggio di probabile spam, definito «spamminess» in lingua inglese, supera un determinata soglia.
			</div></div><div
              class="para">
				Una volta che il pacchetto <span
                class="pkg pkg">clamav-milter</span> è installato, il milter deve essere riconfigurato per l'esecuzione su una porta TCP piuttosto che sul socket predefinito. Ciò può essere ottenuto con <code
                class="command">dpkg-reconfigure clamav-milter</code>. Quando viene richiesta "L'interfaccia di comunicazione con Sendmail", verrà risposto “<code
                class="literal">inet:10002@127.0.0.1</code>”.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>NOTA</em></span> Porta TCP reale contro cosiddetta socket</strong></p></div></div></div><div
                class="para">
				Il motivo per cui viene usata una vera e propria porta TCP piuttosto che una socket è che i demoni postfix spesso sono eseguiti sotto chroot e non hanno accesso alla directory che ospita la socket. Si potrebbe anche decidere di continuare ad usare la socket e scegliere una posizione all'interno di chroot (<code
                  class="filename">/var/spool/postfix/</code>).
			</div></div><div
              class="para">
				La configurazione standard di ClamAV è adeguata per molte situazioni, ma alcuni parametri importanti possono comunque essere personalizzati con <code
                class="command">dpkg-reconfigure clamav-base</code>.
			</div><div
              class="para">
				Come ultimo passo è necessario istruire Postfix affinché utilizzi i filtri appena configurati. Per farlo è sufficiente aggiungere la seguente direttiva a <code
                class="filename">/etc/postfix/main.cf</code>:
			</div><pre
              class="programlisting">
# Controllo virus con clamav-milter
smtpd_milters = inet:[127.0.0.1]:10002</pre><div
              class="para">
				Se l'antivirus causa problemi, questa riga può essere commentata, e dev'essere eseguito <code
                class="command">service postfix reload</code> perché la modifica sia applicata.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>IN PRATICA</em></span> Verificare l'antivirus</strong></p></div></div></div><div
                class="para">
				Un volta configurato l'antivirus, è necessario verificare il suo corretto funzionamento. Il metodo più veloce per farlo è inviare un'email di prova con un allegato contenente il file <code
                  class="filename">eicar.com</code> (o <code
                  class="filename">eicar.com.zip</code>), che può essere scaricato online: <div
                  xmlns=""
                  class="url">→ <a
                    xmlns="http://www.w3.org/1999/xhtml"
                    href="http://www.eicar.org/86-0-Intended-use.html">http://www.eicar.org/86-0-Intended-use.html</a></div>
			</div><div
                class="para">
				Questo file non è un vero virus ma un file di test che tutti i software antivirus sul mercato riconoscono come un virus per consentire la verifica delle installazioni.
			</div></div><div
              class="para">
				Tutti i messaggi gestiti da Postfix passano ora attraverso il filtro antivirus.
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      xmlns=""
                      id="sect.authenticated-smtp"></a>11.1.7. SMTP autenticato</h3></div></div></div><div
              class="para">
				Per poter inviare email è necessario un server SMTP che sia raggiungibile; ed inoltre è necessario dire al server SMTP di inviare email attraverso di esso. Per gli utenti in movimento, questo potrebbe dire di dover cambiare regolarmente la configurazione dei propri client SMTP, dato che il server SMTP della Falcot rifiuta i messaggi provenienti da indirizzi IP apparentemente non correlati con l'azienda. Esistono due soluzioni a questo problema: l'utente in movimento può installare un server SMTP sul proprio computer oppure continuare ad utilizzare il server aziendale con qualche tipo di autenticazione che lo riconosca come dipendente. La prima soluzione non è raccomandata dato che il computer non sarà connesso permanentemente e non sarà quindi in grado di ritentare l'invio dei messaggi in caso di problemi: ci concentreremo quindi sulla seconda soluzione.
			</div><div
              class="para">
				L'autenticazione SMTP con Postfix fa affidamento su SASL (<span
                class="emphasis"><em>Simple Authentication and Security Layer</em></span>). Richiede l'installazione dei pacchetti <span
                class="pkg pkg">libsasl2-modules</span> e <span
                class="pkg pkg">sasl2-bin</span> e la registrazione di una password nel database SASL per ogni utente che necessita di autenticarsi sul server SMTP. Questo è realizzabile per mezzo del comando <code
                class="command">saslpasswd2</code> che accetta diversi parametri. L'opzione <code
                class="literal">-u</code> definisce il dominio di autenticazione e deve corrispondere al parametro <code
                class="literal">smtpd_sasl_local_domain</code> nella configurazione di Postfix. L'opzione <code
                class="literal">-c</code> consente di creare un utente e <code
                class="literal">-f</code> permette di specificare il file da usare se il database SASL necessita di essere conservato in una posizione diversa da quella predefinita (<code
                class="filename">/etc/sasldb2</code>).
			</div><pre
              class="screen scale">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>saslpasswd2 -u `postconf -h myhostname` -f /var/spool/postfix/etc/sasldb2 -c jean</code></strong>
<code
                class="computeroutput">[... type jean's password twice ...]</code></pre><div
              class="para">
				Notare che il database di SASL viene creato nella directory di Postfix. Per assicurare la coerenza modifichiamo <code
                class="filename">/etc/sasldb2</code> in un collegamento simbolico che punta al database utilizzato da Postfix con il comando <code
                class="command">ln -sf /var/spool/postfix/etc/sasldb2 /etc/sasldb2</code>.
			</div><div
              class="para">
				A questo punto è necessario configurare Postfix affinché utilizzi SASL. Prima di tutto l'utente <code
                class="literal">postfix</code> dev'essere aggiunto al gruppo <code
                class="literal">sasl</code> così che possa accedere al database degli account SASL. Alcuni nuovi parametri sono inoltre necessari per abilitare SASL e il parametro <code
                class="literal">smtpd_recipient_restrictions</code> dev'essere configurato per consentire ai client autenticati da SASL di inviare email liberamente.
			</div><div
              class="example"><a
                xmlns=""
                id="id-1.14.4.13.7"></a><p
                class="title"><strong>Esempio 11.15. Abilitare SASL nel file <code
                    class="filename">/etc/postfix/main.cf</code></strong></p><div
                class="example-contents"><pre
                  class="programlisting">
# Abilita l'autenticazione SASL
smtpd_sasl_auth_enable = yes
# Definisce il dominio di autenticazione SASL da utilizzare
smtpd_sasl_local_domain = $myhostname
[...]
# Aggiungere permit_sasl_authenticated prima di
# reject_unauth_destination permette l'inoltro delle email inviate
# dagli utenti autenticati con SASL
smtpd_recipient_restrictions = permit_mynetworks,
    permit_sasl_authenticated,
    reject_unauth_destination,
[...]</pre></div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>EXTRA</em></span> Client SMTP autenticati</strong></p></div></div></div><div
                class="para">
				La maggior parte dei client email sono in grado di autenticarsi presso un server SMTP prima di inviare i messaggi in uscita e per utilizzare questa funzionalità basta semplicemente configurare i parametri appropriati. Se il client in uso non fornisce questa funzionalità è possibile utilizzare un server Postfix locale e configurarlo per inoltrare le email attraverso il server SMTP remoto. In questo caso, il Postfix locale diventerà a sua volta il client che andrà ad autenticarsi con SASL. I parametri richiesti sono i seguenti:
			</div><pre
                class="programlisting">
smtp_sasl_auth_enable = yes
smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd
relay_host = [mail.falcot.com]</pre><div
                class="para">
				Il file <code
                  class="filename">/etc/postfix/sasl_passwd</code> deve contenere il nome utente e la password da utilizzare per autenticarsi sul server <code
                  class="literal">mail.falcot.com</code>. Ecco un esempio:
			</div><pre
                class="programlisting">
[mail.falcot.com]   joe:LyinIsji</pre><div
                class="para">
				Così come per tutte le mappe Postfix questo file dev'essere trasformato in <code
                  class="filename">/etc/postfix/sasl_passwd.db</code> con l'impiego del comando <code
                  class="command">postmap</code>.
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.network-diagnosis-tools.html"><strong>Indietro</strong>10.8. Strumenti di diagnosi di rete</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Risali</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Partenza</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.http-web-server.html"><strong>Avanti</strong>11.2. Server web (HTTP)</a></li></ul></body></html>
