<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
]>
<chapter id="existing-setup">
  <chapterinfo>
    <mediaobject condition="pdf">
      <imageobject>
        <imagedata fileref="images/chap-existing-setup.png" scalefit="1" />
      </imageobject>
    </mediaobject>
    <keywordset>
      <keyword>Instalación existente</keyword>
      <keyword>Reutilización</keyword>
      <keyword>Migración</keyword>
    </keywordset>
  </chapterinfo>
  <title>Análisis de la instalación existente y migración</title>
  <highlights>
    <para>Cualquier rediseño de un sistema informático debería tener en cuenta el sistema existente. Esto permite maximizar la reutilización de los recursos disponibles y garantiza la interoperabilidad entre los varios elementos que comprenden al sistema. Este estudio introducirá un marco de trabajo genérico a seguir en cualquier migración de infraestructura informática a Linux.</para>
  </highlights>
  <section id="sect.heterogeneous-environments">
    <title>Coexistencia en entornos heterogéneos</title>
    <indexterm><primary>entorno</primary><secondary>heterogéneo</secondary></indexterm>

    <para>Debian se integra perfectamente en todos los tipos de entornos existentes y funciona muy bien con otros sistemas operativos. Esta armonía casi perfecta es fruto de la presión del mercado que demanda que los distribuidores de software desarrollen programas que cumplan estándares. El cumplimiento de los estándares permite a los administradores cambiar programas por otros: clientes o servidores, sean libres o no.</para>
    <section>
      <title>Integración con equipos Windows</title>

      <para>La compatibilidad con SMB/CIFS de Samba garantiza una comunicación excelente en un contexto Windows. Comparte archivos y colas de impresión con clientes Windows e incluye software que le permite a un equipo Linux utilizar recursos disponibles en servidores Windows.</para>

      <sidebar>
        <title><emphasis>HERRAMIENTA</emphasis> Samba</title>
        <indexterm><primary>Samba</primary></indexterm>

        <para>La última versión de Samba puede remplazar la mayoría de características de Windows: desde las más simples de un simple servidor Windows NT (autenticación, archivos, colas de impresión, descarga de controladores de impresión, DFS «Distributed File System», etc) hasta las más avanzadas (un controlador de dominio compatible con Active Directory).</para>
      </sidebar>
    </section>
    <section>
      <title>Integración con equipos OS X</title>

      <indexterm><primary>Zeroconf</primary></indexterm>
      <indexterm><primary>Bonjour</primary></indexterm>
      <indexterm><primary>Avahi</primary></indexterm>
      <para>Los equipos OS X proveen y pueden utilizar servicios de red como servidores de archivos e impresoras compartidas. Estos servicios se publican en la red local, lo que permite que otros equipos los descubran y utilicen sin necesitar configuración manual, utilizando la implementación Bonjour de la suite de protocolos Zeroconf. Debian incluye otra implementación que provee la misma funcionalidad llamada Avahi.</para>

      <indexterm><primary>AFP</primary></indexterm>
      <indexterm><primary>AppleShare</primary></indexterm>
      <para>De la misma forma, puede utilizar el demonio Netatalk para proveer un servidor de archivos a equipos OS X en la red. El mismo implementa el protocolo AFP (AppleShare) así como también las notificaciones necesarias para que los clientes OS X puedan descubrir automáticamente los servidores.</para>

      <indexterm><primary>AppleTalk</primary></indexterm>
      <para>Las redes Mac OS antiguas (anteriores a OS X) utilizaban un protocolo diferente llamado AppleTalk. Aquellos entornos que involucren equipos que utilizan este protocolo, Netatalk también provee el protocolo Appletalk (de hecho, comenzó como una reimplementación del mismo). Asegura el funcionamiento del servidor de archivos y colas de impresión así como también el servidor de tiempo (sincronización de reloj). Sus funciones de enrutamiento permiten la interconexión con redes AppleTalk.</para>
    </section>
    <section>
      <title>Integración con otros equipos Linux/Unix</title>

      <para>Finalmente, NFS y NIS, ambos incluidos, garantizan la iteracción con sistemas Unix. NFS proporciona la funcionalidad de servidor de archivos mientras que NIS crea los directorios de usuario. La capa de impresión de BSD, utilizada ampliamente por los sistemas Unix, también permite compartir colas de impresión.</para>

      <figure>
        <title>Coexistencia de Debian con sistemas OS X, Windows y Unix</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/existing-setup-1.png" width="25%" />
          </imageobject>
        </mediaobject>
      </figure>
    </section>
  </section>
  <section id="sect.how-to-migrate">
    <title>Cómo migrar</title>
    <indexterm><primary>migración</primary></indexterm>

    <para>Para poder garantizar la continuidad de los servicios, la migración de cada equipo debe ser planificada y realizada de acuerdo al plan. Este principio es aplicable sin importar el sistema operativo que utilice.</para>
    <section>
      <title>Reconocimiento e identificación de servicios</title>

      <para>Simple como parece, este paso es esencial. Un administrador serio realmente conoce los roles principales de cada servidor, pero dichos roles pueden cambiar y a veces usuarios experimentados pueden haber instalado servicios «salvajes». Saber que existen le permitirá, al menos, decidir qué hacer con ellos en lugar de eliminarlos sin orden ni propósito.</para>

      <para>Por ello, es buena idea informar a sus usuarios del proyecto antes de migrar el servidor. Involucrarlos en el proyecto puede ser útil para instalar el software libre más común en sus equipos de escritorio antes de la migración, programas con los que se encontrarán luego de la migración a Debian; LibreOffice.org y la suite Mozilla son los mejores ejemplos de tales programas.</para>
      <section>
        <title>La red y los procesos</title>
        <indexterm><primary><command>nmap</command></primary></indexterm>
       
	<para>La herramienta <command>nmap</command> (en el paquete del mismo nombre) identificará rápidamente servicios de internet hospedados en un equipo conectado a la red sin siquiera necesitar iniciar sesión en el mismo. Simplemente ejecute la siguiente orden en otro equipo conectado a la misma red:</para>

        <screen>
<computeroutput>$ </computeroutput><userinput>nmap mirwiz</userinput>
<computeroutput>Starting Nmap 6.47 ( http://nmap.org ) at 2015-03-24 11:34 CET
Nmap scan report for mirwiz (192.168.1.104)
Host is up (0.0037s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 0.13 seconds</computeroutput></screen>

        <sidebar>
          <title><emphasis>ALTERNATIVA</emphasis> Utilice <command>netstat</command> para encontrar la lista de servicios disponibles</title>

	  <para>En los equipos Linux, la orden <command>netstat -tupan</command> mostrará la lista de sesiones TCP activas o pendientes así como también los puertos UDP en los que escuchan los programas. Esto facilita la identificación de los servicios que se ofrecen en la red.</para>
        </sidebar>

        <sidebar>
          <title><emphasis>YENDO MÁS ALLÁ</emphasis> IPv6</title>

	  <para>Algunas órdenes de red pueden ser utilizados con IPv4 (lo predeterminado normalmente) o con IPv6. Las órdenes <command>nmap</command> y <command>netstat</command> entre ellas, pero también hay otros como <command>route</command> o <command>ip</command>. La convención es que la opción <parameter>-6</parameter> activa este comportamiento.</para>
        </sidebar>

	<para>Si el servidor es un equipo Unix ofreciendo acceso de consola a los usuarios, es interesante determinarlo si se ejecutan procesos en segundo plano en ausencia de su usuario. La orden <command>ps auxw</command> muestra una lista de todos los procesos con la identidad de su usuario. Comparar esta información con la salida de la orden <command>who</command>, que provee la lista de usuarios con sesiones activas, permite identificar servidores no declarados o independientes o programas ejecutando en segundo plano. Revisar <filename>crontab</filename> (tablas de acciones programadas por usuarios) generalmente proveerá información interesante sobre las funciones que cumple el servidor (una explicación completa de <command>cron</command> está disponible en la <xref linkend="sect.task-scheduling-cron-atd" />).</para>

	<para>En cualquier caso, es esencial que haga respaldos de sus servidores: de esta forma se asegurará que la información pueda ser recuperada después del hecho, cuando los usuarios informen acerca de problemas concretos derivados de la migración.</para>
      </section>
    </section>
    <section>
      <title>Respaldos de la configuración</title>

      <para>Es buena idea conservar la configuración de todo servicio identificado para poder instalar el equivalente en el nuevo servidor. Como mínimo debería hacer un respaldo de los archivos de configuración.</para>

      <para>En los equipos Unix, los archivos de configuración se encuentran normalmente en <filename>/etc/</filename> pero puede que se encuentren en un subdirectorio de <filename>/usr/local/</filename>. Este es el caso si el programa se ha instalado desde las fuentes en lugar de utilizar un paquete. En algunos casos podría encontrarlos en <filename>/opt/</filename>.</para>

      <para>Para servicios que administren datos (como bases de datos), es muy recomendable exportar los datos a un formato estándar que pueda ser importado fácilmente por el nuevo software. Tal formato generalmente está documentado y es texto plano; puede ser, por ejemplo, un volcado SQL para una base de datos o un archivo LDIF para un servidor LDAP.</para>

      <figure>
        <title>Respaldos de base de datos</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/existing-setup-2.png" width="50%" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>Cada software de servidor es diferente y es imposible describir en detalle todos los casos posibles. Compare la documentación del software nuevo y el actual para identificar las porciones exportables (y, por lo tanto, importables) y aquellas que necesitarán que intervenga de forma manual. Leer este libro clarificará la configuración de los principales programas de servidor en Linux.</para>
    </section>
    <section>
      <title>Adopción de un servidor Debian existente</title>
      <indexterm><primary>recuperación de un equipo Debian</primary></indexterm>
      <indexterm><primary>explorando un equipo Debian</primary></indexterm>
      <indexterm><primary>tomando el control de un servidor Debian</primary></indexterm>

      <para>Para efectivamente tomar el control de su mantenimiento, uno podría analizar un equipo que ya ejecuta Debian.</para>

      <para>El primer archivo a revisar es <filename>/etc/debian_version</filename> que generalmente contiene el número de versión para el sistema Debian instalado (es parte del paquete <emphasis>base-files</emphasis>. Si indica <literal><replaceable>nombre_código</replaceable>/sid</literal> significa que el sistema fue actualizado con paquetes que provienen de alguna de las distribuciones en desarrollo («Testing» o «Unstable»).</para>

      <para>El programa <command>apt-show-versions</command> (que se encuentra en el paquete Debian que lleva el mismo nombre) comprueba la lista de paquetes instalados e identifica las versiones disponibles. Puede utilizar también <command>aptitude</command> para estas tareas, aunque de un modo menos sistemático.</para>

      <para>Revisar el archivo <filename>/etc/apt/sources.list</filename> (y el directorio <filename>/etc/apt/sources.list.d/</filename>) mostrará de dónde es probable que provengan los paquetes Debian. Si aparecen muchas fuentes desconocidas, el administrador podría elegir reinstalar el sistema completamente para asegurar compatibilidad óptima con el software provisto por Debian.</para>

      <para>El archivo <filename>sources.list</filename> es generalmente un buen indicador: la mayoría de los administradores mantienen, al menos como comentarios, la lista de fuentes APT utilizadas anteriormente. Pero no debe olvidar que fuentes  utilizadas previamente podrían haber sido eliminadas y se podrían haber instalado manualmente paquetes al azar descargados de internet (con la orden <command>dpkg</command>). En este caso, la apariencia del equipo como un Debian estándar es engañosa. Es por eso que debe prestar atención a cualquier indicación que revele la presencia de paquetes externos (archivos <filename>deb</filename> en directorios inusuales, números de versión de paquetes con sufijos especiales que indican su origen fuera del proyecto Debian como <literal>ubuntu</literal> o <literal>lmde</literal>, etc.)</para>

      <para>De la misma forma, es interesante analizar el contenido del directorio <filename>/usr/local/</filename>, cuyo propósito es albergar programas compilados e instalados manualmente. Generar una lista de software instalado de esta forma es instructivo, ya que genera dudas sobre las razones para no utilizar el paquete Debian correspondiente, si es que existe.</para>

      <sidebar>
        <title><emphasis>VISTA RÁPIDA</emphasis> <emphasis role="pkg">cruft</emphasis></title>

	<para>El paquete <emphasis role="pkg">cruft</emphasis> se propone listar todos los archivos disponibles que no son parte de ningún paquete. Tiene algunos filtros (más o menos efectivos y más o menos actualizados) para evitar reportar archivos legítimos (archivos generados por paquetes Debian o archivos de configuración generados que no son administrados por <command>dpkg</command>, etc.).</para>

	<para>¡Tenga cuidado de no borrar ciegamente todo lo que liste <command>cruft</command>!</para>
      </sidebar>
    </section>
    <section>
      <title>Instalación de Debian</title>

      <para>Una vez que conoce toda la información del servidor actual, puede apagarlo y comenzar a instalar Debian en él.</para>
      <indexterm><primary>arquitectura</primary></indexterm>

      <para>Para elegir la versión apropiada, debemos saber la arquitectura del equipo. Si es una PC relativamente reciente, es probable que sea amd64 (equipos más antiguos usualmente eran i386). En otros casos podemos reducir las posibilidades según el sistema utilizado previamente.</para>

      <para>La <xref linkend="tab-corresp" xrefstyle="select: label nopage" /> no pretende ser exhaustiva, pero puede ser útil. En cualquier caso, la documentación original para el equipo es la fuente más confiable para encontrar esta información.</para>

      <table colsep="1" id="tab-corresp">
        <title>Emparejando sistema operativo y arquitectura</title>
        <tgroup cols="2">
          <thead>
            <row>
              <entry>Sistema operativo</entry>
              <entry>Arquitectura(s)</entry>
            </row>
          </thead>
          <tbody>
            <row>
              <entry>DEC Unix (OSF/1)</entry>
              <entry>alpha, mipsel</entry>
            </row>
            <row>
              <entry>HP Unix</entry>
              <entry>ia64, hppa</entry>
            </row>
            <row>
              <entry>IBM AIX</entry>
              <entry>powerpc</entry>
            </row>
            <row>
              <entry>Irix</entry>
              <entry>mips</entry>
            </row>
            <row>
              <entry>OS X</entry>
              <entry>amd64, powerpc, i386</entry>
            </row>
            <row>
              <entry>z/OS, MVS</entry>
              <entry>s390x, s390</entry>
            </row>
            <row>
              <entry>Solaris, SunOS</entry>
              <entry>sparc, i386, m68k</entry>
            </row>
            <row>
              <entry>Ultrix</entry>
              <entry>mips</entry>
            </row>
            <row>
              <entry>VMS</entry>
              <entry>alpha</entry>
            </row>
            <row>
              <entry>Windows 95/98/ME</entry>
              <entry>i386</entry>
            </row>
            <row>
              <entry>Windows NT/2000</entry>
              <entry>i386, alpha, ia64, mipsel</entry>
            </row>
            <row>
              <entry>Windows XP / Windows Server 2008</entry>
              <entry>i386, amd64, ia64</entry>
            </row>
            <row>
              <entry>Windows Vista / Windows 7 / Windows 8</entry>
              <entry>i386, amd64</entry>
            </row>
          </tbody>
        </tgroup>
      </table>

      <sidebar>
        <title><emphasis>HARDWARE</emphasis> Equipos de 64 bits contra equipos de 32 bits</title>
        <indexterm><primary>amd64</primary></indexterm>
        <indexterm><primary>i386</primary></indexterm>

	<para>La mayoría de los equipos recientes tiene procesadores Intel o AMD de 64 bits, compatibles con los procesadores antiguos de 32 bits; por lo tanto funcionará el software compilado para la arquitectura «i386». Por el otro lado, este modo de compatibilidad no aprovecha completamente las capacidades de estos nuevos procesadores. Es por esto que Debian la arquitectura «amd64» para chips AMD recientes así como también procesadores «em64t» de Intel (incluyendo la serie reciente «Core»), que son muy similares a los procesadores AMD64.</para>
      </sidebar>
    </section>
    <section>
      <title>Instalación y configuración de los servicios seleccionados</title>

      <para>Una vez que Debian está instalado debemos instalar y configurar, uno por uno, todos los servicios que debe tener este equipo. La nueva configuración debe tener en cuenta la anterior para asegurar una transición fluida. Toda la información recolectada en los primeros dos pasos será útil para completar esta parte exitosamente.</para>

      <figure>
        <title>Instalación de los servicios seleccionados</title>
        <mediaobject>
          <imageobject>
            <imagedata fileref="images/existing-setup-4.png" width="66%" />
          </imageobject>
        </mediaobject>
      </figure>

      <para>Antes de sumergirse completamente en este ejercicio es muy recomendable que lea el resto de este libro. Luego tendrá un entendimiento más preciso de cómo configurar los servicios esperados.</para>

      <para></para>
    </section>
  </section>
</chapter>
