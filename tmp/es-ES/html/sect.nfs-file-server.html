<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.4. Servidor de archivos NFS</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-9-es-ES-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP, SIP" /><link
        rel="home"
        href="index.html"
        title="El manual del Administrador de Debian" /><link
        rel="up"
        href="network-services.html"
        title="Capítulo 11. Servicios de red: Postfix, Apache, NFS, Samba, Squid, LDAP, SIP, XMPP, TURN" /><link
        rel="prev"
        href="sect.ftp-file-server.html"
        title="11.3. Servidor de archivos FTP" /><link
        rel="next"
        href="sect.windows-file-server-with-samba.html"
        title="11.5. Configuración de espacios compartidos Windows con Samba" /><meta
        xmlns=""
        name="flattr:id"
        content="4pz9jq" /><link
        xmlns=""
        rel="canonical"
        href="https://debian-handbook.info/browse/es-ES/stable/sect.nfs-file-server.html" /></head><body><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="index.html"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>Anterior</strong></a></li><li
          class="home">El manual del Administrador de Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>Siguiente</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  xmlns=""
                  id="sect.nfs-file-server"></a>11.4. Servidor de archivos NFS</h2></div></div></div><div
          class="para">
			NFS (<span
            class="emphasis"><em>sistema de archivos de red</em></span>: «Network File System») es un protocolo que permite acceso remoto a un sistema de archivos a través de la red. Todos los sistemas Unix pueden trabajar con este protocolo; cuando se involucran sistemas Windows, debe utilizar Samba en su lugar.
		</div><a
          id="id-1.14.7.3"
          class="indexterm"></a><a
          id="id-1.14.7.4"
          class="indexterm"></a><a
          id="id-1.14.7.5"
          class="indexterm"></a><a
          id="id-1.14.7.6"
          class="indexterm"></a><a
          id="id-1.14.7.7"
          class="indexterm"></a><div
          class="para">
			NFS es una herramienta muy útil. Si bien anteriormente ha tenido muchas limitaciones, la mayoría ha desaparecido con la versión 4 del protocolo. El inconveniente es qu ela última versión de NFS e más díficil de configurar cuando se quieren utilizar funciones básicas de seguridad como la autenticación y el cifrado, puesto que se basa en Kerberos para estas funcionalidades. Sin éstas, el protocolo NFS tiene que restringirse a la utilización en una red local de confianza puesto que los datos que circulan por la red no están cifrados (un <span
            class="emphasis"><em><span
                class="foreignphrase"><em
                  class="foreignphrase">sniffer</em></span></em></span> los puede interceptar) y los permisos de acceso se conceden en función de la dirección IP del cliente (que puede ser suplantada).
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>DOCUMENTACIÓN</em></span> «HOWTO» de NFS</strong></p></div></div></div><div
            class="para">
			Es relativamente complicado encontrar buena documentación acerca de NFSv4. Incluímos aquí algunos enlaces con explicaciones de distinta calidad que al menos proporcionan algunas pistas (en inglés) sobre lo que debe hacerse. <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="https://help.ubuntu.com/community/NFSv4Howto">https://help.ubuntu.com/community/NFSv4Howto</a></div> <div
              xmlns=""
              class="url">→ <a
                xmlns="http://www.w3.org/1999/xhtml"
                href="http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration">http://wiki.linux-nfs.org/wiki/index.php/Nfsv4_configuration</a></div>
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.10"></a>11.4.1. Protección de NFS</h3></div></div></div><a
            id="id-1.14.7.10.2"
            class="indexterm"></a><div
            class="para">
				Si no se utilizan las características de seguridad basadas en Kerberos, debería asegurarse de que sólo los equipos autorizados a utilizar NFS puedan conectarse a los varios servidores RPC necesarios, porque el protocolo básico confía en la información recibida a través de la red. El firewall debería por tanto prohibir la <span
              class="emphasis"><em>usurpación de IPs</em></span> («IP spoofing») para prevenir que una máquina externa se haga pasar por una interna y el acceso a los puertos apropiados debería estar restringido únicamente a los equipos que deban acceder a espacios compartidos por NFS.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>VOLVER A LOS CIMIENTOS</em></span> RPC</strong></p></div></div></div><div
              class="para">
				RPC (<span
                class="emphasis"><em>llamada a procedimiento remoto</em></span>: «Remote Procedure Call») es un estándar Unix para servicios remotos. NFS es uno de esos servicios.
			</div><a
              id="id-1.14.7.10.4.3"
              class="indexterm"></a><a
              id="id-1.14.7.10.4.4"
              class="indexterm"></a><div
              class="para">
				Los servicios RPC se registran en un directorio conocido como <span
                class="emphasis"><em>portmapper</em></span> («asociador de puertos»). Un cliente que desee realizar una consulta NFS primero debe dirigirse al <span
                class="emphasis"><em>portmapper</em></span> (en el puerto 111, TCP o UDP) y preguntar por el servidor NFS; la respuesta generalmente mencionará el puerto 2049 (el predeterminado para NFS). No todos los servicios RPC utilizan un puerto fijo necesariamente.
			</div></div><div
            class="para">
				Las versiones antiguas del protocolo requerían otros servicios RPC que utilizaban puertos asignados dinámicamente. Afortunadamente, con la versíon 4 de NFS solo son necesarios los puertos 2049 (para el NFS propiamente) y el 111 (para el <span
              class="foreignphrase"><em
                class="foreignphrase">portmapper</em></span>), por lo que son fáciles de filtrar mediante un cortafuegos.
			</div><a
            id="id-1.14.7.10.6"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.11"></a>11.4.2. Servidor NFS</h3></div></div></div><div
            class="para">
				El servidor NFS es parte del núcleo Linux; en los núcleos que Debian provee está compilado como un módulo de núcleo. Si necesita ejecutar el servidor NFS automáticamente al iniciar, debe instalar el paquete <span
              class="pkg pkg">nfs-kernel-server</span>; contiene los scripts de inicio relevantes.
			</div><div
            class="para">
				El archivo de configuración del servidor NFS, <code
              class="filename">/etc/exports</code>, enumera los directorios que estarán disponibles en la red (<span
              class="emphasis"><em>exportados</em></span>). Para cada espacio compartido NFS, sólo tendrán acceso las máquinas especificadas. Puede obtener un control más detallado con unas pocas opciones. La sintaxis para este archivo es bastante simple:
			</div><a
            id="id-1.14.7.11.4"
            class="indexterm"></a><a
            id="id-1.14.7.11.5"
            class="indexterm"></a><pre
            class="programlisting">
/directorio/a/compartir maquina1(opcion1,opcion2,...) maquina2(...) ...</pre><div
            class="para">
				Es importante recalcar que con NFSv4 todas las carpetas exportadas deben ser parte de un único arbol de directorios y que el directorio raiz de este arbol debe ser exportado e identificado con la opción <code
              class="literal">fsid=0</code> o <code
              class="literal">fsid=root</code>.
			</div><div
            class="para">
				Puede identificar cada máquina mediante su nombre DNS o su dirección IP. También puede especificar conjuntos completos de máquinas utilizando una sintaxis como <code
              class="literal">*.falcot.com</code> o un rango de direcciones IP <code
              class="literal">192.168.0.0/255.255.255.0</code> o <code
              class="literal">192.168.0.0/24</code>.
			</div><div
            class="para">
				De forma predeterminada (o si utiliza la opción <code
              class="literal">ro</code>), los directorios están disponibles sólo para lectura. La opción <code
              class="literal">rw</code> permite acceso de lectura y escritura. Los clientes NFS típicamente se conectan desde un puerto restringido sólo a root (en otras palabras, menor a 1024); puede eliminar esta restricción con la opción <code
              class="literal">insecure</code> (la opción <code
              class="literal">secure</code> es implícita, pero puede hacerla explícita para más claridad).
			</div><a
            id="id-1.14.7.11.10"
            class="indexterm"></a><div
            class="para">
				De forma predeterminada, el servidor sólo responderá a peticiones NFS cuando se complete la operación actual de disco (la opción <code
              class="literal">sync</code>); puede desactivar esta funcionalidad con la opción <code
              class="literal">async</code>. Las escrituras asíncronas aumentarán un poco el rendimiento a cambio de una disminución de la fiabilidad, debido al riesgo de pérdida de datos en caso de un cierre inesperado del servidor durante el tiempo que transcurre entre que se recibe la petición de escritura y cuando los datos hayan sido escritos realmente en el disco. Debido a que el valor predeterminado cambió recientemente (comparado con el valor histórico de NFS), se recomienda configurarlo explícitamente.
			</div><div
            class="para">
				Para no proveerle acceso de root al sistema de archivos a ningún cliente NFS, el servidor considerará todas las consultas que parezcan provenir de un usuario root como si provinieran del usuario <code
              class="literal">nobody</code>. Este comportamiento corresponde a la opción <code
              class="literal">root_squash</code> y está activado de forma predeterminada. La opción <code
              class="literal">no_root_squash</code>, que desactiva este comportamiento, es riesgosa y sólo debe ser utilizada en entornos controlados. Las opciones <code
              class="literal">anonuid=<em
                class="replaceable">uid</em></code> y <code
              class="literal">anongid=<em
                class="replaceable">gid</em></code> permiten especificar otro usuario falso que será utilizado en lugar deñ UID/GID 65534 (que corresponden al usuario <code
              class="literal">nobody</code> y al grupo <code
              class="literal">nogroup</code>).
			</div><div
            class="para">
				Con NFSv4 se puede añadir la opción <code
              class="literal">sec</code> para precisar el nivel de seguridad deseado: <code
              class="literal">sec=sys</code> es el valor predeterminado sin ningún tipo de seguridad particular, <code
              class="literal">sec=krb5</code> habilita únicamente la autenticación, <code
              class="literal">sec=krb5i</code> añade una protección de integridad y <code
              class="literal">sec=krb5p</code> es el nivel más alto, que incluye la protección de la confidencialidad (mediante el cifrado de datos). Para que todo esto pueda funcionar es necesaria una instalación funcional de Kerberos (este libro no se trata en este libro).
			</div><div
            class="para">
				Existen otras opciones disponibles; están documentadas en la página de manual <span
              class="citerefentry"><span
                class="refentrytitle">exports</span>(5)</span>.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>PRECAUCIÓN</em></span> Primera instalación</strong></p></div></div></div><div
              class="para">
				El script de inicio <code
                class="filename">/etc/init.d/nfs-kernel-server</code> sólo inicia el servidor si el archivo <code
                class="filename">/etc/exports</code> incluye al menos uno o más espacios compartidos NFS válidos. En la configuración inicial, una vez que editó este archivo para que contenga elementos válidos, deberá iniciar el servidor NFS ejecutando lo siguiente:
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>service nfs-kernel-server start</code></strong></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    xmlns=""
                    id="id-1.14.7.12"></a>11.4.3. Cliente NFS</h3></div></div></div><a
            id="id-1.14.7.12.2"
            class="indexterm"></a><a
            id="id-1.14.7.12.3"
            class="indexterm"></a><div
            class="para">
				Como con cualquier otro sistema de archivos, incorporar un espacio compartido NFS en el jerarquía del sistema es necesario montarlo. Debido a que este sistema de archivos tiene sus peculiaridades fueron necesarios unos pocos ajustes en la sintaxis de <code
              class="command">mount</code> y en el archivo <code
              class="filename">/etc/fstab</code>.
			</div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.5"></a><p
              class="title"><strong>Ejemplo 11.22. Montaje manual con el programa <code
                  class="command">mount</code></strong></p><div
              class="example-contents"><pre
                class="screen">
          <code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>mount -t nfs4 -o rw,nosuid arrakis.internal.falcot.com:/shared /srv/shared</code></strong></pre></div></div><div
            class="example"><a
              xmlns=""
              id="id-1.14.7.12.6"></a><p
              class="title"><strong>Ejemplo 11.23. Elemento NFS en el archivo <code
                  class="filename">/etc/fstab</code></strong></p><div
              class="example-contents"><pre
                class="programlisting">
arrakis.internal.falcot.com:/shared /srv/shared nfs4 rw,nosuid 0 0</pre></div></div><div
            class="para">
				El elemento descrito monta automáticamente en cada arranque del sistema el directorio NFS <code
              class="filename">/shared/</code> desde el servidor <code
              class="literal">arrakis</code> en el directorio local <code
              class="filename">/srv/shared/</code>. Se solicita acceso de lectura y escritura (de ahí el parámetro <code
              class="literal">rw</code>). La opción <code
              class="literal">nosuid</code> es una medida de protección que elimina cualquier bit <code
              class="literal">setuid</code> o <code
              class="literal">setgid</code> de los programas almacenados en el espacio compartido. Si el espacio compartido NFS está destinado únicamente a almacenar documentos, también se recomienda utilizar la opción <code
              class="literal">noexec</code>, que evita la ejecución de programas almacenados en el espacio compartido. Es importante tener en en cuenta que, en el servidor, el directorio <code
              class="filename">shared</code> se encuentra dentro del directorio exportado como raiz de NFSv4 (por ejemplo <code
              class="filename">/export/shared</code>), no es un directorio de primer nivel.
			</div><div
            class="para">
				La página de manual <span
              class="citerefentry"><span
                class="refentrytitle">nfs</span>(5)</span> describe todas las opciones con algo de detalle.
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>Anterior</strong>11.3. Servidor de archivos FTP</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Subir</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Inicio</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>Siguiente</strong>11.5. Configuración de espacios compartidos Windo...</a></li></ul></body></html>
